{
    "features": [
        {
            "feature_idx": 0,
            "name": "commit",
            "type": {
                "dtype": "string",
                "_type": "Value"
            }
        },
        {
            "feature_idx": 1,
            "name": "old_file",
            "type": {
                "dtype": "string",
                "_type": "Value"
            }
        },
        {
            "feature_idx": 2,
            "name": "new_file",
            "type": {
                "dtype": "string",
                "_type": "Value"
            }
        },
        {
            "feature_idx": 3,
            "name": "old_contents",
            "type": {
                "dtype": "string",
                "_type": "Value"
            }
        },
        {
            "feature_idx": 4,
            "name": "new_contents",
            "type": {
                "dtype": "string",
                "_type": "Value"
            }
        },
        {
            "feature_idx": 5,
            "name": "subject",
            "type": {
                "dtype": "string",
                "_type": "Value"
            }
        },
        {
            "feature_idx": 6,
            "name": "message",
            "type": {
                "dtype": "string",
                "_type": "Value"
            }
        },
        {
            "feature_idx": 7,
            "name": "lang",
            "type": {
                "dtype": "string",
                "_type": "Value"
            }
        },
        {
            "feature_idx": 8,
            "name": "license",
            "type": {
                "dtype": "string",
                "_type": "Value"
            }
        },
        {
            "feature_idx": 9,
            "name": "repos",
            "type": {
                "dtype": "string",
                "_type": "Value"
            }
        }
    ],
    "rows": [
        {
            "row_idx": 10200,
            "row": {
                "commit": "5d799eb8f067a9ba50844507407c677ad0848655",
                "old_file": "jquery.formatdate.js",
                "new_file": "jquery.formatdate.js",
                "old_contents": "/*!\n * jquery.formatdate.js\n * @version 1.0\n * (c) 2015 giscafer\n */\n;(function($){\n\tvar defaults={\n\n\t};\n\tvar _format=\"yyyy-MM-dd\";\n\t$.extend({\n\t\t\"formatDate\":function(date,format,options){\n\t\t\tif(!format) format=_format;\n\t\t\tif(!date) date=new Date();\n\t\t\tvar res=$.fn.formatDate(date,format,options);\n\t\t\treturn res;\n\t\t}\n\t});\n\t/**\n\t * @author giscafer\n\t * @version 1.0\n\t * @date    2015-11-20T11:27:32+0800\n\t * @param   {Date}        date    the date to formatting.\n\t * @param   {String}      format  'MMMM yyyy','dddd, MMM d, yyyy',\"yyyy年MM月dd日\",\"yyyy-MM-dd\"\n\t * 'dddd M/d','ddd M/d','ddd'……\n\t * @param   {[type]}                 options [description]\n\t */\n\t$.fn.formatDate=function(date, format, options) {\n\t\treturn $.fn.formatDates(date, null, format, options);\n\t}\n\t/**\n\t * @author giscafer\n\t * @version 1.0\n\t * @date    2015-11-20T11:27:07+0800\n\t * @param   {Date}      date1   [description]\n\t * @param   {Date}      date2   [description]\n\t * @param   {String}    format  MMM d[ yyyy]{ '&#8212;'[ MMM] d yyyy}\n\t * @param   {String}  \n\t */\n\t$.fn.formatDates=function(date1, date2, format, options) {\n\t\toptions = options || defaults;\n\t\tvar date = date1,\n\t\t\totherDate = date2,\n\t\t\ti, len = format.length, c,\n\t\t\ti2, formatter,\n\t\t\tres = '';\n\t\tfor (i=0; i<len; i++) {\n\t\t\tc = format.charAt(i);\n\t\t\tif (c == \"'\") {\n\t\t\t\tfor (i2=i+1; i2<len; i2++) {\n\t\t\t\t\tif (format.charAt(i2) == \"'\") {\n\t\t\t\t\t\tif (date) {\n\t\t\t\t\t\t\tif (i2 == i+1) {\n\t\t\t\t\t\t\t\tres += \"'\";\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tres += format.substring(i+1, i2);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ti = i2;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (c == '(') {\n\t\t\t\tfor (i2=i+1; i2<len; i2++) {\n\t\t\t\t\tif (format.charAt(i2) == ')') {\n\t\t\t\t\t\tvar subres = formatDate(date, format.substring(i+1, i2), options);\n\t\t\t\t\t\tif (parseInt(subres.replace(/\\D/, ''), 10)) {\n\t\t\t\t\t\t\tres += subres;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ti = i2;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (c == '[') {\n\t\t\t\tfor (i2=i+1; i2<len; i2++) {\n\t\t\t\t\tif (format.charAt(i2) == ']') {\n\t\t\t\t\t\tvar subformat = format.substring(i+1, i2);\n\t\t\t\t\t\tvar subres = formatDate(date, subformat, options);\n\t\t\t\t\t\tif (subres != formatDate(otherDate, subformat, options)) {\n\t\t\t\t\t\t\tres += subres;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ti = i2;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (c == '{') {\n\t\t\t\tdate = date2;\n\t\t\t\totherDate = date1;\n\t\t\t}\n\t\t\telse if (c == '}') {\n\t\t\t\tdate = date1;\n\t\t\t\totherDate = date2;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (i2=len; i2>i; i2--) {\n\t\t\t\t\tif (formatter = dateFormatters[format.substring(i, i2)]) {\n\t\t\t\t\t\tif (date) {\n\t\t\t\t\t\t\tres += formatter(date, options);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ti = i2 - 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (i2 == i) {\n\t\t\t\t\tif (date) {\n\t\t\t\t\t\tres += c;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t};\n\n\n\tvar dateFormatters = {\n\t\ts\t: function(d)\t{ return d.getSeconds() },\n\t\tss\t: function(d)\t{ return zeroPad(d.getSeconds()) },\n\t\tm\t: function(d)\t{ return d.getMinutes() },\n\t\tmm\t: function(d)\t{ return zeroPad(d.getMinutes()) },\n\t\th\t: function(d)\t{ return d.getHours() % 12 || 12 },\n\t\thh\t: function(d)\t{ return zeroPad(d.getHours() % 12 || 12) },\n\t\tH\t: function(d)\t{ return d.getHours() },\n\t\tHH\t: function(d)\t{ return zeroPad(d.getHours()) },\n\t\td\t: function(d)\t{ return d.getDate() },\n\t\tdd\t: function(d)\t{ return zeroPad(d.getDate()) },\n\t\tddd\t: function(d,o)\t{ return o.dayNamesShort[d.getDay()] },\n\t\tdddd: function(d,o)\t{ return o.dayNames[d.getDay()] },\n\t\tM\t: function(d)\t{ return d.getMonth() + 1 },\n\t\tMM\t: function(d)\t{ return zeroPad(d.getMonth() + 1) },\n\t\tMMM\t: function(d,o)\t{ return o.monthNamesShort[d.getMonth()] },\n\t\tMMMM: function(d,o)\t{ return o.monthNames[d.getMonth()] },\n\t\tyy\t: function(d)\t{ return (d.getFullYear()+'').substring(2) },\n\t\tyyyy: function(d)\t{ return d.getFullYear() },\n\t\tt\t: function(d)\t{ return d.getHours() < 12 ? 'a' : 'p' },\n\t\ttt\t: function(d)\t{ return d.getHours() < 12 ? 'am' : 'pm' },\n\t\tT\t: function(d)\t{ return d.getHours() < 12 ? 'A' : 'P' },\n\t\tTT\t: function(d)\t{ return d.getHours() < 12 ? 'AM' : 'PM' },\n\t\tu\t: function(d)\t{ return formatDate(d, \"yyyy-MM-dd'T'HH:mm:ss'Z'\") },\n\t\tS\t: function(d)\t{\n\t\t\tvar date = d.getDate();\n\t\t\tif (date > 10 && date < 20) {\n\t\t\t\treturn 'th';\n\t\t\t}\n\t\t\treturn ['st', 'nd', 'rd'][date%10-1] || 'th';\n\t\t},\n\t\tw   : function(d, o) { // local\n\t\t\treturn o.weekNumberCalculation(d);\n\t\t},\n\t\tW   : function(d) { // ISO\n\t\t\treturn iso8601Week(d);\n\t\t}\n\t};\n\t/**\n\t * Set as calculateWeek to determine the week of the year based on the ISO 8601 definition.\n\t * `date` - the date to get the week for\n\t * `number` - the number of the week within the year that contains this date\n\t */\n\tfunction iso8601Week(date) {\n\t\tvar time;\n\t\tvar checkDate = new Date(date.getTime());\n\n\t\t// Find Thursday of this week starting on Monday\n\t\tcheckDate.setDate(checkDate.getDate() + 4 - (checkDate.getDay() || 7));\n\n\t\ttime = checkDate.getTime();\n\t\tcheckDate.setMonth(0); // Compare with Jan 1\n\t\tcheckDate.setDate(1);\n\t\treturn Math.floor(Math.round((time - checkDate) / 86400000) / 7) + 1;\n\t}\n\tfunction zeroPad(n) {\n\t\treturn (n < 10 ? '0' : '') + n;\n\t}\n})(jQuery);",
                "new_contents": "/*!\n * jquery.formatdate.js\n * @version 1.0\n * (c) 2015 giscafer\n */\n;(function($){\n\tvar defaults={\n\t\tmonthNames: ['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月'],\n\t\tmonthNamesShort: ['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月'],\n\t\tdayNames: ['星期日','星期一','星期二','星期三','星期四','星期五','星期六'],\n\t\tdayNamesShort: ['周日','周一','周二','周三','周四','周五','周六']\n\t};\n\tvar _format=\"yyyy-MM-dd\";\n\t$.extend({\n\t\t\"formatDate\":function(date,format,options){\n\t\t\tif(!format) format=_format;\n\t\t\tif(!date) date=new Date();\n\t\t\tvar res=formatDate(date,format,options);\n\t\t\treturn res;\n\t\t},\n\t\t\"formatDates\":function(date1, date2, format, options){\n\t\t\treturn $.fn.formatDates(date1, date2, format, options);\n\t\t}\n\t});\n\t/**\n\t * @author giscafer\n\t * @version 1.0\n\t * @date    2015-11-20T11:27:32+0800\n\t * @param   {Date}        date    the date to formatting.\n\t * @param   {String}      format  'MMMM yyyy','dddd, MMM d, yyyy',\"yyyy年MM月dd日\",\"yyyy-MM-dd\"\n\t * 'dddd M/d','ddd M/d','ddd'……\n\t * @param   {[type]}                 options [description]\n\t */\n\tfunction formatDate(date, format, options) {\n\t\treturn $.fn.formatDates(date, null, format, options);\n\t}\n\t/**\n\t * @author giscafer\n\t * @version 1.0\n\t * @date    2015-11-20T11:27:07+0800\n\t * @param   {Date}      date1   the first date to formatting.\n\t * @param   {Date}      date2   the second date to formatting.\n\t * @param   {String}    format  MMM d[ yyyy]{ '&#8212;'[ MMM] d yyyy}\n\t * @param   {String}  \n\t */\n\t$.fn.formatDates=function(date1, date2, format, options) {\n\t\toptions = options || defaults;\n\t\tvar date = date1,\n\t\t\totherDate = date2,\n\t\t\ti, len = format.length, c,\n\t\t\ti2, formatter,\n\t\t\tres = '';\n\t\tfor (i=0; i<len; i++) {\n\t\t\tc = format.charAt(i);\n\t\t\tif (c == \"'\") {\n\t\t\t\tfor (i2=i+1; i2<len; i2++) {\n\t\t\t\t\tif (format.charAt(i2) == \"'\") {\n\t\t\t\t\t\tif (date) {\n\t\t\t\t\t\t\tif (i2 == i+1) {\n\t\t\t\t\t\t\t\tres += \"'\";\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tres += format.substring(i+1, i2);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ti = i2;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (c == '(') {\n\t\t\t\tfor (i2=i+1; i2<len; i2++) {\n\t\t\t\t\tif (format.charAt(i2) == ')') {\n\t\t\t\t\t\tvar subres = formatDate(date, format.substring(i+1, i2), options);\n\t\t\t\t\t\tif (parseInt(subres.replace(/\\D/, ''), 10)) {\n\t\t\t\t\t\t\tres += subres;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ti = i2;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (c == '[') {\n\t\t\t\tfor (i2=i+1; i2<len; i2++) {\n\t\t\t\t\tif (format.charAt(i2) == ']') {\n\t\t\t\t\t\tvar subformat = format.substring(i+1, i2);\n\t\t\t\t\t\tvar subres = formatDate(date, subformat, options);\n\t\t\t\t\t\tif (subres != formatDate(otherDate, subformat, options)) {\n\t\t\t\t\t\t\tres += subres;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ti = i2;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (c == '{') {\n\t\t\t\tdate = date2;\n\t\t\t\totherDate = date1;\n\t\t\t}\n\t\t\telse if (c == '}') {\n\t\t\t\tdate = date1;\n\t\t\t\totherDate = date2;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (i2=len; i2>i; i2--) {\n\t\t\t\t\tif (formatter = dateFormatters[format.substring(i, i2)]) {\n\t\t\t\t\t\tif (date) {\n\t\t\t\t\t\t\tres += formatter(date, options);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ti = i2 - 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (i2 == i) {\n\t\t\t\t\tif (date) {\n\t\t\t\t\t\tres += c;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t};\n\n\n\tvar dateFormatters = {\n\t\ts\t: function(d)\t{ return d.getSeconds() },\n\t\tss\t: function(d)\t{ return zeroPad(d.getSeconds()) },\n\t\tm\t: function(d)\t{ return d.getMinutes() },\n\t\tmm\t: function(d)\t{ return zeroPad(d.getMinutes()) },\n\t\th\t: function(d)\t{ return d.getHours() % 12 || 12 },\n\t\thh\t: function(d)\t{ return zeroPad(d.getHours() % 12 || 12) },\n\t\tH\t: function(d)\t{ return d.getHours() },\n\t\tHH\t: function(d)\t{ return zeroPad(d.getHours()) },\n\t\td\t: function(d)\t{ return d.getDate() },\n\t\tdd\t: function(d)\t{ return zeroPad(d.getDate()) },\n\t\tddd\t: function(d,o)\t{ return o.dayNamesShort[d.getDay()] },\n\t\tdddd: function(d,o)\t{ return o.dayNames[d.getDay()] },\n\t\tM\t: function(d)\t{ return d.getMonth() + 1 },\n\t\tMM\t: function(d)\t{ return zeroPad(d.getMonth() + 1) },\n\t\tMMM\t: function(d,o)\t{ return o.monthNamesShort[d.getMonth()] },\n\t\tMMMM: function(d,o)\t{ return o.monthNames[d.getMonth()] },\n\t\tyy\t: function(d)\t{ return (d.getFullYear()+'').substring(2) },\n\t\tyyyy: function(d)\t{ return d.getFullYear() },\n\t\tt\t: function(d)\t{ return d.getHours() < 12 ? 'a' : 'p' },\n\t\ttt\t: function(d)\t{ return d.getHours() < 12 ? 'am' : 'pm' },\n\t\tT\t: function(d)\t{ return d.getHours() < 12 ? 'A' : 'P' },\n\t\tTT\t: function(d)\t{ return d.getHours() < 12 ? 'AM' : 'PM' },\n\t\tu\t: function(d)\t{ return formatDate(d, \"yyyy-MM-dd'T'HH:mm:ss'Z'\") },\n\t\tS\t: function(d)\t{\n\t\t\tvar date = d.getDate();\n\t\t\tif (date > 10 && date < 20) {\n\t\t\t\treturn 'th';\n\t\t\t}\n\t\t\treturn ['st', 'nd', 'rd'][date%10-1] || 'th';\n\t\t},\n\t\tw   : function(d, o) { // local\n\t\t\treturn o.weekNumberCalculation(d);\n\t\t},\n\t\tW   : function(d) { // ISO\n\t\t\treturn iso8601Week(d);\n\t\t}\n\t};\n\t/**\n\t * Set as calculateWeek to determine the week of the year based on the ISO 8601 definition.\n\t * `date` - the date to get the week for\n\t * `number` - the number of the week within the year that contains this date\n\t */\n\tfunction iso8601Week(date) {\n\t\tvar time;\n\t\tvar checkDate = new Date(date.getTime());\n\n\t\t// Find Thursday of this week starting on Monday\n\t\tcheckDate.setDate(checkDate.getDate() + 4 - (checkDate.getDay() || 7));\n\n\t\ttime = checkDate.getTime();\n\t\tcheckDate.setMonth(0); // Compare with Jan 1\n\t\tcheckDate.setDate(1);\n\t\treturn Math.floor(Math.round((time - checkDate) / 86400000) / 7) + 1;\n\t}\n\tfunction zeroPad(n) {\n\t\treturn (n < 10 ? '0' : '') + n;\n\t}\n})(jQuery);",
                "subject": "update",
                "message": "update\n",
                "lang": "JavaScript",
                "license": "apache-2.0",
                "repos": "giscafer/jquery.formatdate.js"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10201,
            "row": {
                "commit": "b18658d3162b93f9d9bbaaabebb77df11de80014",
                "old_file": "test/generator-test.js",
                "new_file": "test/generator-test.js",
                "old_contents": "const assert = require('assert');\nconst parse = require('../parser');\nconst analyze = require('../analyzer');\nconst gen = require('../backend/javascript-generator');\n\ndescribe('Code Generator Test', () => {\n  describe('simple program', () => {\n    it('hello world program', () => {\n      const compile = gen('burp(\"HelloWorld\")');\n      const expected = 'console.log(\"HelloWorld\");';\n      assert.equal(ast, expected);\n    });\n  });\n});\n",
                "new_contents": "const assert = require('assert');\nconst parse = require('../parser');\nconst analyze = require('../analyzer');\nconst gen = require('../backend/javascript-generator');\n\ndescribe('Code Generator Test', () => {\n  describe('simple programs', () => {\n    it('hello world program', () => {\n      const compile = gen('burp(\"HelloWorld\")');\n      const expected = 'console.log(\"HelloWorld\");';\n      assert.equal(ast, expected);\n    });\n  });\n  describe('assignment statements', () => {\n    it('simple variable declaration', () => {\n      const compile = gen('let beer = \"beer\"');\n      const expected = 'let beer = \"beer\";';\n      assert.equal(ast, expected);\n    });\n    it('simple constant declaration', () => {\n      const compile = gen('set beer = \"beer\"');\n      const expected = 'const beer = \"beer\";';\n      assert.equal(ast, expected);\n    });\n    it('array variable declaration', () => {\n      const compile = gen('let beers = [\"Blue Moon\", \"Shock Top\"]');\n      const expected = 'let beers = [\"Blue Moon\", \"Shock Top\"];';\n      assert.equal(ast, expected);\n    });\n    it('array constant declaration', () => {\n      const compile = gen('set beers = [\"Blue Moon\", \"Shock Top\"]');\n      const expected = 'const beers = [\"Blue Moon\", \"Shock Top\"];';\n      assert.equal(ast, expected);\n    });\n  });\n});\n",
                "subject": "Add test cases",
                "message": "Add test cases\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "mpmcauley/Boozie,mpmcauley/Boozie"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10202,
            "row": {
                "commit": "19e7199d0e183554aadeccfba93cc133cc7e4112",
                "old_file": "public/js/p3/widget/TaxonomyTopNSummary.js",
                "new_file": "public/js/p3/widget/TaxonomyTopNSummary.js",
                "old_contents": "define([\n\t\"dojo/_base/declare\", \"dijit/_WidgetBase\", \"dojo/on\",\n\t\"dojo/dom-class\",\"dgrid/Grid\",\"../store/TaxonomyJsonRest\",\n\t\"dojo/request\", \"dojo/_base/lang\",\"dgrid/extensions/DijitRegistry\",\n\t\"dojo/when\",\"dojo/_base/lang\"\n], function(declare, WidgetBase, on,\n\t\t\tdomClass, Grid,Store,\n\t\t\txhr, lang, dgridRegistry,\n\t\t\twhen,lang\n){\n\n\tvar store = new Store({});\n\n\treturn declare([Grid,dgridRegistry], {\n\t\tdataModel: \"taxonomy\",\n\t\tstore: store,\n\t\tquery: \"&eq(taxon_rank,genus)&sort(-genomes)\",\n\t\tcount: 10,\n\t\tpostCreate: function(){\n\t\t\tthis.inherited(arguments);\n\t\t\tdomClass.add(this.domNode,\"dgrid-autoheight\");\n\t\t},\n\t\tstartup: function(){\n\t\t\tthis.inherited(arguments);\n\t\t\twhen(this.store.query(this.query + \"&limit(\" + this.count + \")\"), lang.hitch(this,function(results){\n\t\t\t\t// console.log(\"Results: \", results)\n\t\t\t\tthis.renderArray(results);\n\t\t\t}))\n\n\t\t},\n\t\tcolumns: [{\n\t\t\tlabel: \"Name\",\n\t\t\tfield: \"taxon_name\",\n                        renderCell: function(obj, val, node){\n                                node.innerHTML ='<a class=\"navigationLink\" href=\"/view/Taxonomy/' + obj.taxon_id + '\">' + obj.taxon_name +  \"</a>\"\n                        }\n\t\t}, {\n\t\t\tlabel: \"Genomes\",\n\t\t\tfield: \"genomes\"\n\t\t}]\n\t})\n});\n",
                "new_contents": "define([\n\t\"dojo/_base/declare\", \"dojo/_base/lang\",\n\t\"dojo/dom-class\", \"dojo/when\",\n\t\"dgrid/Grid\", \"dgrid/extensions/DijitRegistry\",\n\t\"../store/TaxonomyJsonRest\"\n\n], function(declare, lang,\n\t\t\tdomClass, when,\n\t\t\tGrid, dgridRegistry,\n\t\t\tStore\n){\n\n\tvar store = new Store({});\n\n\treturn declare([Grid, dgridRegistry], {\n\t\tdataModel: \"taxonomy\",\n\t\tstore: store,\n\t\tquery: \"&eq(taxon_rank,genus)&sort(-genomes)&select(taxon_id,taxon_name,genomes)\",\n\t\tcount: 10,\n\t\tpostCreate: function(){\n\t\t\tthis.inherited(arguments);\n\t\t\tdomClass.add(this.domNode, \"dgrid-autoheight\");\n\t\t},\n\t\tstartup: function(){\n\t\t\tthis.inherited(arguments);\n\t\t\twhen(this.store.query(this.query + \"&limit(\" + this.count + \")\"), lang.hitch(this, function(results){\n\t\t\t\t// console.log(\"Results: \", results)\n\t\t\t\tthis.renderArray(results);\n\t\t\t}))\n\n\t\t},\n\t\tcolumns: [{\n\t\t\tlabel: \"Name\",\n\t\t\tfield: \"taxon_name\",\n\t\t\trenderCell: function(obj, val, node){\n\t\t\t\tnode.innerHTML ='<a class=\"navigationLink\" href=\"/view/Taxonomy/' + obj.taxon_id + '\">' + obj.taxon_name +  \"</a>\"\n\t\t\t}\n\t\t}, {\n\t\t\tlabel: \"Genomes\",\n\t\t\tfield: \"genomes\"\n\t\t}]\n\t})\n});\n",
                "subject": "limit query to relevant fields, code formatting",
                "message": "limit query to relevant fields, code formatting\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "nconrad/p3_web,dmachi/p3_web,maovt/p3_web,hyoo/p3_web,dawenx/p3_web,dawenx/p3_web,maovt/p3_web,zreyn/p3_web,dmachi/p3_web,dawenx/p3_web,dmachi/p3_web,aswarren/p3_web,nconrad/p3_web,maovt/p3_web,hyoo/p3_web,zreyn/p3_web,maovt/p3_web,PATRIC3/p3_web,dawenx/p3_web,nconrad/p3_web,hyoo/p3_web,dmachi/p3_web,zreyn/p3_web,aswarren/p3_web,PATRIC3/p3_web,PATRIC3/p3_web,aswarren/p3_web,PATRIC3/p3_web,nconrad/p3_web,hyoo/p3_web,aswarren/p3_web,zreyn/p3_web"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10203,
            "row": {
                "commit": "47f6a24f767e18c12fe6e3482f7e79a114deff13",
                "old_file": "test/geom/Vec3.test.js",
                "new_file": "test/geom/Vec3.test.js",
                "old_contents": "/*\n * Copyright (C) 2014 United States Government as represented by the Administrator of the\n * National Aeronautics and Space Administration. All Rights Reserved.\n */\ndefine([\n    'src/geom/Vec3'\n], function (Vec3) {\n    \"use strict\";\n\n    describe(\"Vec3Test\", function () {\n\n        it(\"Should have the correct three components\", function () {\n            var vec3 = new Vec3(9, 8, 7);\n            expect(vec3[0]).toEqual(9);\n            expect(vec3[1]).toEqual(8);\n            expect(vec3[2]).toEqual(7);\n        });\n\n\n        it(\"Should have three zero components\", function () {\n            var vec3Zero = Vec3.ZERO;\n            expect(vec3Zero[0]).toEqual(0);\n            expect(vec3Zero[1]).toEqual(0);\n            expect(vec3Zero[2]).toEqual(0);\n        });\n\n\n        it(\"Should return the average of a vector\", function () {\n            var vec3_a = new Vec3(1, 2, 3);\n            var vec3_b = new Vec3(3, 2, 1);\n            var vec3_average = Vec3.average([vec3_a, vec3_b], Vec3.ZERO);\n            expect(vec3_average).toEqual(new Vec3(2, 2, 2));\n        });\n\n\n        it(\"Should return the average a specified array of points packed into a single array\", function () {\n            var pointArray = [1, 2, 3, 3, 2, 1];\n            expect(Vec3.averageOfBuffer(pointArray, Vec3.ZERO)).toEqual(new Vec3(2, 2, 2));\n        });\n\n\n        it(\"Test the colinearity of three arrays\", function () {\n            var a = new Vec3(2, 4, 6);\n            var b = new Vec3(4, 8, 12);\n            var c = new Vec3(8, 16, 24);\n            expect(Vec3.areColinear(a, b, c)).toEqual(true);\n        });\n\n        it(\"Compute triangle normals\", function () {\n            var a = new Vec3(0, 0, 0);\n            var b = new Vec3(1, 0, 0);\n            var c = new Vec3(1, 1, 0);\n            expect(Vec3.computeTriangleNormal(a, b, c)).toEqual(new Vec3(0, 0, 1));\n        });\n\n        it(\"Finds three non-colinear points in an array of coordinates\", function () {\n            var a = new Vec3(0, 0, 0);\n            var b = new Vec3(1, 0, 0);\n            var c = new Vec3(1, 1, 0);\n            expect(Vec3.computeTriangleNormal(a, b, c)).toEqual(new Vec3(0, 0, 1));\n        });\n\n        it(\"Finds three independent vertices\", function () {\n            var nonColinearPoints = Vec3.findThreeIndependentVertices([0, 0, 0, 1, 0, 0, 1, 1, 0], 3);\n            var expectednonColinearPoints = [\n                new Vec3(0, 0, 0),\n                new Vec3(1, 0, 0),\n                new Vec3(1, 1, 0)\n            ];\n\n            for (var i = 0; i < nonColinearPoints.length; i++) {\n                expect(nonColinearPoints[i]).toEqual(expectednonColinearPoints[i]);\n            }\n\n        });\n\n        it(\"Computer buffer normals\", function () {\n            var bufferNormal = Vec3.computeBufferNormal([0, 0, 0, 1, 0, 0, 1, 1, 0], 1);\n            expect(bufferNormal).toEqual(new Vec3(-1, 0, 0));\n\n            bufferNormal = Vec3.computeBufferNormal([0, 0, 0, 1, 0, 0, 1, 1, 0], 3);\n            expect(bufferNormal).toEqual(new Vec3(0, 0, 1));\n\n        });\n\n        it(\"Set components of the vector\", function () {\n            var vec = Vec3.ZERO;\n            vec.set(2, 3, 4);\n            expect(vec).toEqual(new Vec3(2, 3, 4));\n\n            vec.set(5, 6, 7);\n            expect(vec[0]).toEqual(5);\n            expect(vec[1]).toEqual(6);\n            expect(vec[2]).toEqual(7);\n        });\n\n\n        it(\"Copies the component of a Vec3\", function () {\n            var destination = Vec3.ZERO;\n            var source = new Vec3(2, 3, 4);\n            destination.copy(source);\n            expect(destination).toEqual(source);\n        });\n\n        it(\"Check if two vectors are equal\", function () {\n            var vec_a = new Vec3(2, 3, 4);\n            var vec_b = new Vec3(2, 3, 4);\n            expect(vec_a.equals(vec_b)).toEqual(true);\n\n            vec_b = new Vec3(4, 5, 6);\n            expect(vec_a.equals(vec_b)).toEqual(false);\n        });\n\n        it(\"Add a vector to the current one\", function () {\n            var vec_a = new Vec3(2, 3, 4);\n            var vec_b = new Vec3(1, 2, 3);\n            expect(vec_a.add(vec_b)).toEqual(new Vec3(3, 5, 7));\n        });\n\n        it(\"Subtract a vector from the current one\", function () {\n            var vec_a = new Vec3(2, 3, 4);\n            var vec_b = new Vec3(1, 2, 3);\n            expect(vec_a.subtract(vec_b)).toEqual(new Vec3(1, 1, 1));\n        });\n\n        it(\"Multiplies current vector by a scalar\", function () {\n            var vec = new Vec3(2, 3, 4);\n            var expected = vec.multiply(3);\n            expect(expected).toEqual(new Vec3(6, 9, 12));\n        });\n\n        it(\"Divides current vector by a scalar\", function () {\n            var vec = new Vec3(6, 8, 4);\n\n            var expected = vec.divide(2);\n            expect(expected).toEqual(new Vec3(3, 4, 2));\n\n            expected = vec.divide(4);\n            expect(expected).toEqual(new Vec3(0.75, 1, 0.5));\n        });\n\n        it(\"Multiplies current vector by 4x4 Matrix\", function () {\n            var vec = new Vec3(2, 3, 4);\n            var matrix = [2, 2, 2, 2, 4, 4, 4, 4, 8, 8, 8, 8, 10, 10, 10, 10];\n            var expected = new Vec3(0.2, 0.4, 0.8);\n            expect(vec.multiplyByMatrix(matrix)).toEqual(expected);\n        });\n\n\n        it(\"Interpolates a specified vector with this vector\", function () {\n            var vec_a = new WorldWind.Vec3(2, 3, 4);\n            var vec_b = new WorldWind.Vec3(4, 6, 8);\n            var expected = new WorldWind.Vec3(3, 4.5, 6);\n            expect(vec_a.mix(vec_b, 0.5)).toEqual(expected);\n\n            expected = new WorldWind.Vec3(8, 12, 16);\n            expect(vec_a.mix(vec_b, 5)).toEqual(expected);\n\n        });\n\n        it(\"Negates the components of the current vector\", function () {\n            var vec_a = new WorldWind.Vec3(2, 3, 4);\n            var expected = new WorldWind.Vec3(-2, -3, -4);\n            expect(vec_a.negate()).toEqual(expected);\n        });\n\n        it(\"Computes the scalar dot product of the current vector and a specified one\", function () {\n            var vec_a = new WorldWind.Vec3(2, 3, 4);\n            var vec_b = new WorldWind.Vec3(4, 5, 6);\n            var expected = 47;\n            expect(vec_a.dot(vec_b)).toEqual(expected);\n        });\n\n        it(\"Computes the cross product of this vector and a specified vector\", function () {\n            var vec_a = new WorldWind.Vec3(2, 3, 4);\n            var vec_b = new WorldWind.Vec3(4, 5, 6);\n            var expected = new Vec3(-2, 4, -2);\n            expect(vec_a.cross(vec_b)).toEqual(expected);\n        });\n\n        it(\"Computes the squared magnitude of this vector\", function () {\n            var vec_a = new WorldWind.Vec3(2, 3, 4);\n            expect(vec_a.magnitudeSquared()).toEqual(29);\n        });\n\n        it(\"Computes the magnitude of this vector\", function () {\n            var vec_a = new WorldWind.Vec3(2, 4, 4);\n            expect(vec_a.magnitude()).toEqual(6);\n\n            vec_a = new WorldWind.Vec3(3, -4, 0);\n            expect(vec_a.magnitude()).toEqual(5);\n        });\n\n        it(\"Normalize this vector to a unit vector\", function () {\n            var vec = new WorldWind.Vec3(2, 4, 4);\n            var expected = new Vec3(1/3, 2/3, 2/3);\n            expect(vec.normalize()).toEqual(expected);\n        });\n\n        it(\"Computes the squared distance from a vector to a specified vector\", function () {\n            var vec_a = new WorldWind.Vec3(2, 3, 4);\n            var vec_b = new WorldWind.Vec3(4, 5, 6);\n            expect(vec_a.distanceToSquared(vec_b)).toEqual(12);\n\n            expect(vec_a.distanceToSquared(vec_a)).toEqual(0);\n        });\n\n        it(\"Computes the distance from a vector to a specified vector\", function () {\n            var vec_a = new WorldWind.Vec3(1, 2, 3);\n            var vec_b = new WorldWind.Vec3(2, 4, 6);\n            expect(vec_a.distanceTo(vec_b)).toEqual(Math.sqrt(14));\n        });\n\n\n\n    });\n});",
                "new_contents": "/*\n * Copyright (C) 2014 United States Government as represented by the Administrator of the\n * National Aeronautics and Space Administration. All Rights Reserved.\n */\ndefine([\n    'src/geom/Vec3'\n], function (Vec3) {\n    \"use strict\";\n\n    describe(\"Vec3Test\", function () {\n\n        it(\"Should have the correct three components\", function () {\n            var vec3 = new Vec3(9, 8, 7);\n            expect(vec3[0]).toEqual(9);\n            expect(vec3[1]).toEqual(8);\n            expect(vec3[2]).toEqual(7);\n        });\n\n\n        it(\"Should have three zero components\", function () {\n            var vec3Zero = Vec3.ZERO;\n            expect(vec3Zero[0]).toEqual(0);\n            expect(vec3Zero[1]).toEqual(0);\n            expect(vec3Zero[2]).toEqual(0);\n        });\n\n\n        it(\"Should return the average of a vector\", function () {\n            var vec3_a = new Vec3(1, 2, 3);\n            var vec3_b = new Vec3(3, 2, 1);\n            var vec3_average = Vec3.average([vec3_a, vec3_b], Vec3.ZERO);\n            expect(vec3_average).toEqual(new Vec3(2, 2, 2));\n        });\n\n\n        it(\"Should return the average a specified array of points packed into a single array\", function () {\n            var pointArray = [1, 2, 3, 3, 2, 1];\n            expect(Vec3.averageOfBuffer(pointArray, Vec3.ZERO)).toEqual(new Vec3(2, 2, 2));\n        });\n\n\n        it(\"Test the colinearity of three arrays\", function () {\n            var a = new Vec3(2, 4, 6);\n            var b = new Vec3(4, 8, 12);\n            var c = new Vec3(8, 16, 24);\n            expect(Vec3.areColinear(a, b, c)).toEqual(true);\n        });\n\n        it(\"Compute triangle normals\", function () {\n            var a = new Vec3(0, 0, 0);\n            var b = new Vec3(1, 0, 0);\n            var c = new Vec3(1, 1, 0);\n            expect(Vec3.computeTriangleNormal(a, b, c)).toEqual(new Vec3(0, 0, 1));\n        });\n\n        it(\"Finds three non-colinear points in an array of coordinates\", function () {\n            var a = new Vec3(0, 0, 0);\n            var b = new Vec3(1, 0, 0);\n            var c = new Vec3(1, 1, 0);\n            expect(Vec3.computeTriangleNormal(a, b, c)).toEqual(new Vec3(0, 0, 1));\n        });\n\n        it(\"Finds three independent vertices\", function () {\n            var nonColinearPoints = Vec3.findThreeIndependentVertices([0, 0, 0, 1, 0, 0, 1, 1, 0], 3);\n            var expectednonColinearPoints = [\n                new Vec3(0, 0, 0),\n                new Vec3(1, 0, 0),\n                new Vec3(1, 1, 0)\n            ];\n\n            for (var i = 0; i < nonColinearPoints.length; i++) {\n                expect(nonColinearPoints[i]).toEqual(expectednonColinearPoints[i]);\n            }\n\n        });\n\n        it(\"Computer buffer normals\", function () {\n            var bufferNormal = Vec3.computeBufferNormal([0, 0, 0, 1, 0, 0, 1, 1, 0], 1);\n            expect(bufferNormal).toEqual(new Vec3(-1, 0, 0));\n\n            bufferNormal = Vec3.computeBufferNormal([0, 0, 0, 1, 0, 0, 1, 1, 0], 3);\n            expect(bufferNormal).toEqual(new Vec3(0, 0, 1));\n\n        });\n\n        it(\"Set components of the vector\", function () {\n            var vec = Vec3.ZERO;\n            vec.set(2, 3, 4);\n            expect(vec).toEqual(new Vec3(2, 3, 4));\n\n            vec.set(5, 6, 7);\n            expect(vec[0]).toEqual(5);\n            expect(vec[1]).toEqual(6);\n            expect(vec[2]).toEqual(7);\n        });\n\n\n        it(\"Copies the component of a Vec3\", function () {\n            var destination = Vec3.ZERO;\n            var source = new Vec3(2, 3, 4);\n            destination.copy(source);\n            expect(destination).toEqual(source);\n        });\n\n        it(\"Check if two vectors are equal\", function () {\n            var vec_a = new Vec3(2, 3, 4);\n            var vec_b = new Vec3(2, 3, 4);\n            expect(vec_a.equals(vec_b)).toEqual(true);\n\n            vec_b = new Vec3(4, 5, 6);\n            expect(vec_a.equals(vec_b)).toEqual(false);\n        });\n\n        it(\"Add a vector to the current one\", function () {\n            var vec_a = new Vec3(2, 3, 4);\n            var vec_b = new Vec3(1, 2, 3);\n            expect(vec_a.add(vec_b)).toEqual(new Vec3(3, 5, 7));\n        });\n\n        it(\"Subtract a vector from the current one\", function () {\n            var vec_a = new Vec3(2, 3, 4);\n            var vec_b = new Vec3(1, 2, 3);\n            expect(vec_a.subtract(vec_b)).toEqual(new Vec3(1, 1, 1));\n        });\n\n        it(\"Multiplies current vector by a scalar\", function () {\n            var vec = new Vec3(2, 3, 4);\n            var expected = vec.multiply(3);\n            expect(expected).toEqual(new Vec3(6, 9, 12));\n        });\n\n        it(\"Divides current vector by a scalar\", function () {\n            var vec = new Vec3(6, 8, 4);\n\n            var expected = vec.divide(2);\n            expect(expected).toEqual(new Vec3(3, 4, 2));\n\n            expected = vec.divide(4);\n            expect(expected).toEqual(new Vec3(0.75, 1, 0.5));\n        });\n\n        it(\"Multiplies current vector by 4x4 Matrix\", function () {\n            var vec = new Vec3(2, 3, 4);\n            var matrix = [2, 2, 2, 2, 4, 4, 4, 4, 8, 8, 8, 8, 10, 10, 10, 10];\n            var expected = new Vec3(0.2, 0.4, 0.8);\n            expect(vec.multiplyByMatrix(matrix)).toEqual(expected);\n        });\n\n\n        it(\"Interpolates a specified vector with this vector\", function () {\n            var vec_a = new WorldWind.Vec3(2, 3, 4);\n            var vec_b = new WorldWind.Vec3(4, 6, 8);\n            var expected = new WorldWind.Vec3(3, 4.5, 6);\n            expect(vec_a.mix(vec_b, 0.5)).toEqual(expected);\n\n            expected = new WorldWind.Vec3(8, 12, 16);\n            expect(vec_a.mix(vec_b, 5)).toEqual(expected);\n\n        });\n\n        it(\"Negates the components of the current vector\", function () {\n            var vec_a = new WorldWind.Vec3(2, 3, 4);\n            var expected = new WorldWind.Vec3(-2, -3, -4);\n            expect(vec_a.negate()).toEqual(expected);\n        });\n\n        it(\"Computes the scalar dot product of the current vector and a specified one\", function () {\n            var vec_a = new WorldWind.Vec3(2, 3, 4);\n            var vec_b = new WorldWind.Vec3(4, 5, 6);\n            var expected = 47;\n            expect(vec_a.dot(vec_b)).toEqual(expected);\n        });\n\n        it(\"Computes the cross product of this vector and a specified vector\", function () {\n            var vec_a = new WorldWind.Vec3(2, 3, 4);\n            var vec_b = new WorldWind.Vec3(4, 5, 6);\n            var expected = new Vec3(-2, 4, -2);\n            expect(vec_a.cross(vec_b)).toEqual(expected);\n        });\n\n        it(\"Computes the squared magnitude of this vector\", function () {\n            var vec_a = new WorldWind.Vec3(2, 3, 4);\n            expect(vec_a.magnitudeSquared()).toEqual(29);\n        });\n\n        it(\"Computes the magnitude of this vector\", function () {\n            var vec_a = new WorldWind.Vec3(2, 4, 4);\n            expect(vec_a.magnitude()).toEqual(6);\n\n            vec_a = new WorldWind.Vec3(3, -4, 0);\n            expect(vec_a.magnitude()).toEqual(5);\n        });\n\n        it(\"Normalize this vector to a unit vector\", function () {\n            var vec = new WorldWind.Vec3(2, 4, 4);\n            var expected = new Vec3(1/3, 2/3, 2/3);\n            expect(vec.normalize()).toEqual(expected);\n        });\n\n        it(\"Computes the squared distance from a vector to a specified vector\", function () {\n            var vec_a = new WorldWind.Vec3(2, 3, 4);\n            var vec_b = new WorldWind.Vec3(4, 5, 6);\n            expect(vec_a.distanceToSquared(vec_b)).toEqual(12);\n\n            expect(vec_a.distanceToSquared(vec_a)).toEqual(0);\n        });\n\n        it(\"Computes the distance from a vector to a specified vector\", function () {\n            var vec_a = new WorldWind.Vec3(1, 2, 3);\n            var vec_b = new WorldWind.Vec3(2, 4, 6);\n            expect(vec_a.distanceTo(vec_b)).toEqual(Math.sqrt(14));\n        });\n\n        it(\"Swap the components of the current vector with another one\", function () {\n            var vec_a = new WorldWind.Vec3(1, 2, 3);\n            var vec_b = new WorldWind.Vec3(2, 4, 6);\n            vec_a.swap(vec_b);\n            expect(vec_a).toEqual(new WorldWind.Vec3(2, 4, 6));\n            expect(vec_b).toEqual(new WorldWind.Vec3(1, 2, 3));\n        });\n\n\n        it(\"Returns a string representation of this vector\", function () {\n            var vec_a = new WorldWind.Vec3(1, 2, 3);\n            expect(vec_a.toString()).toEqual(\"(1, 2, 3)\");\n\n        });\n\n\n\n    });\n});",
                "subject": "Completed basic test on Vec3 Class for all the methods",
                "message": "Completed basic test on Vec3 Class for all the methods\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "NASAWorldWindResearch/AgroSphere,NASAWorldWindResearch/AgroSphere"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10204,
            "row": {
                "commit": "f1a26684f72c357d0143e77b135e65111e89b737",
                "old_file": "chrome/xeit/contentscript.js",
                "new_file": "chrome/xeit/contentscript.js",
                "old_contents": "// derived from xeit.js\nfunction check() {\n    var html = document.head.innerHTML + document.body.innerHTML;\n    return document.getElementById('XEIViewer') ||\n           html.indexOf('IniMasPlugin') > -1 ||\n           html.indexOf('IniCrossMailObj') > -1 ||\n           document.getElementById('JXCEAL') ||\n           document.getElementById('MailDec');\n}\n\n// (almost) copy of link.js\nfunction link() {\n    var xeit = document.getElementById('xeit');\n    if (xeit) {\n        return;\n    }\n\n    window.stop();\n    var attachment = document.getElementsByTagName('html')[0].outerHTML;\n\n    var _body = document.body;\n    document.body = document.createElement('body');\n    document.body.style.margin = 0;\n    document.body.style.padding = 0;\n    document.body.style.height = '100%';\n\n    xeit = document.createElement('iframe');\n    xeit.setAttribute('id', 'xeit');\n    xeit.setAttribute('src', 'http://tomyun.github.io/xeit/xeit.html');\n    xeit.style.width = '100%';\n    xeit.style.height = '100%';\n    xeit.style.border = 0;\n    document.body.appendChild(xeit);\n\n    window.addEventListener('message', function (e) {\n        switch (e.data) {\n            case 'ready':\n            xeit.contentWindow.postMessage(attachment, '*');\n            break;\n\n            case 'fallback':\n            document.body = _body;\n            break;\n        }\n    }, false);\n}\n\nfunction show() {\n    chrome.runtime.sendMessage({});\n}\n\nif (check()) {\n    link();\n    show();\n}\n",
                "new_contents": "// derived from xeit.js\nfunction check() {\n    var html = document.head.innerHTML + document.body.innerHTML;\n    return document.getElementById('XEIViewer') ||\n           html.search(/IniMasPlugin|IniCrossMailObj/) > -1 ||\n           document.getElementById('JXCEAL') ||\n           document.getElementById('MailDec');\n}\n\n// (almost) copy of link.js\nfunction link() {\n    var xeit = document.getElementById('xeit');\n    if (xeit) {\n        return;\n    }\n\n    window.stop();\n    var attachment = document.getElementsByTagName('html')[0].outerHTML;\n\n    var _body = document.body;\n    document.body = document.createElement('body');\n    document.body.style.margin = 0;\n    document.body.style.padding = 0;\n    document.body.style.height = '100%';\n\n    xeit = document.createElement('iframe');\n    xeit.setAttribute('id', 'xeit');\n    xeit.setAttribute('src', 'http://tomyun.github.io/xeit/xeit.html');\n    xeit.style.width = '100%';\n    xeit.style.height = '100%';\n    xeit.style.border = 0;\n    document.body.appendChild(xeit);\n\n    window.addEventListener('message', function (e) {\n        switch (e.data) {\n            case 'ready':\n            xeit.contentWindow.postMessage(attachment, '*');\n            break;\n\n            case 'fallback':\n            document.body = _body;\n            break;\n        }\n    }, false);\n}\n\nfunction show() {\n    chrome.runtime.sendMessage({});\n}\n\nif (check()) {\n    link();\n    show();\n}\n",
                "subject": "Combine two similar search patterns",
                "message": "Combine two similar search patterns\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "tomyun/xeit,tomyun/xeit,kkung/xeit,skyisle/xeit,skyisle/xeit"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10205,
            "row": {
                "commit": "d2d00fad88091f2c2780a2039897e40dcbf9074c",
                "old_file": "src/components/selects/mixins/autocomplete.js",
                "new_file": "src/components/selects/mixins/autocomplete.js",
                "old_contents": "export default {\n  props: {\n    filter: {\n      type: Function,\n      default: () => (item, query, itemText) => typeof itemText === 'string' && itemText.toLowerCase().indexOf(query) !== -1\n    }\n  },\n  data () {\n    return {\n      searchValue: null\n    }\n  },\n\n  methods: {\n    filterSearch () {\n      const query = this.searchValue.toLowerCase()\n      return this.items.filter(i => this.filter(i, query, this.getText(i)))\n    },\n    onKeyDown (e) {\n      this.$refs.menu.changeListIndex(e)\n    }\n  }\n}\n",
                "new_contents": "export default {\n  props: {\n    filter: {\n      type: Function,\n      default: () => (item, query, itemText) => typeof itemText === 'string' && itemText.toLowerCase().indexOf(query.toLowerCase()) !== -1\n    }\n  },\n  data () {\n    return {\n      searchValue: null\n    }\n  },\n\n  methods: {\n    filterSearch () {\n      return this.items.filter(i => this.filter(i, this.searchValue, this.getText(i)))\n    },\n    onKeyDown (e) {\n      this.$refs.menu.changeListIndex(e)\n    }\n  }\n}\n",
                "subject": "remove lowercase transform",
                "message": "remove lowercase transform\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "KaelWD/vuetify,vuetifyjs/vuetify,KaelWD/vuetify,vuetifyjs/vuetify,Phlow2001/vuetify,azaars/vuetify,Webifi/vuetify,Phlow2001/vuetify,Phlow2001/vuetify,azaars/vuetify,Webifi/vuetify,vuetifyjs/vuetify,Phlow2001/vuetify,Webifi/vuetify,KaelWD/vuetify,vuetifyjs/vuetify"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10206,
            "row": {
                "commit": "2759beb74800a11e128902559991cfa2c5a31e95",
                "old_file": "src/svgcanvas/sanitize.js",
                "new_file": "src/svgcanvas/sanitize.js",
                "old_contents": "/**\n * Tools for SVG sanitization.\n * @module sanitize\n * @license MIT\n *\n * @copyright 2010 Alexis Deveria, 2010 Jeff Schiller\n */\n\nimport { getReverseNS, NS } from './namespaces.js';\nimport { isGecko } from '../common/browser.js';\nimport { getHref, setHref, getUrlFromAttr } from './utilities.js';\n\nconst REVERSE_NS = getReverseNS();\n\n// Todo: Split out into core attributes, presentation attributes, etc. so consistent\n/**\n * This defines which elements and attributes that we support (or at least\n * don't remove).\n * @type {PlainObject}\n */\n/* eslint-disable max-len */\nconst svgGenericWhiteList = [ 'class', 'id', 'display', 'transform' ];\nconst svgWhiteList_ = {\n  // SVG Elements\n  a: [ 'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'mask', 'opacity', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'xlink:href', 'xlink:title' ],\n  circle: [ 'clip-path', 'clip-rule', 'cx', 'cy', 'enable-background', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'mask', 'opacity', 'r', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage' ],\n  clipPath: [ 'clipPathUnits', 'id' ],\n  defs: [],\n  style: [ 'type' ],\n  desc: [],\n  ellipse: [ 'clip-path', 'clip-rule', 'cx', 'cy', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'mask', 'opacity', 'requiredFeatures', 'rx', 'ry', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage' ],\n  feBlend: [ 'in', 'in2' ],\n  feColorMatrix: [ 'in', 'type', 'value', 'result', 'values' ],\n  feComposite: [ 'in', 'operator', 'result', 'in2' ],\n  feFlood: [ 'flood-color', 'in',  'result', 'flood-opacity' ],\n  feGaussianBlur: [  'color-interpolation-filters',  'in', 'requiredFeatures', 'stdDeviation', 'result' ],\n  feMerge: [],\n  feMergeNode: [ 'in' ],\n  feMorphology: [ 'in', 'operator', 'radius' ],\n  feOffset: [ 'dx', 'in', 'dy', 'result' ],\n  filter: [ 'color-interpolation-filters', 'filterRes', 'filterUnits', 'height',  'primitiveUnits', 'requiredFeatures', 'style', 'width', 'x', 'xlink:href', 'y' ],\n  foreignObject: [  'font-size', 'height',  'opacity', 'requiredFeatures', 'style', 'width', 'x', 'y' ],\n  g: [ 'clip-path', 'clip-rule',   'fill', 'fill-opacity', 'fill-rule', 'filter', 'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'font-family', 'font-size', 'font-style', 'font-weight', 'text-anchor' ],\n  image: [  'clip-path', 'clip-rule', 'filter', 'height',  'mask', 'opacity', 'requiredFeatures', 'style', 'systemLanguage', 'width', 'x', 'xlink:href', 'xlink:title', 'y' ],\n  line: [  'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter',  'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'x1', 'x2', 'y1', 'y2' ],\n  linearGradient: [   'gradientTransform', 'gradientUnits', 'requiredFeatures', 'spreadMethod', 'systemLanguage', 'x1', 'x2', 'xlink:href', 'y1', 'y2' ],\n  marker: [   'markerHeight', 'markerUnits', 'markerWidth', 'orient', 'preserveAspectRatio', 'refX', 'refY', 'systemLanguage', 'viewBox' ],\n  mask: [  'height',  'maskContentUnits', 'maskUnits', 'width', 'x', 'y' ],\n  metadata: [  'id' ],\n  path: [  'clip-path', 'clip-rule', 'd', 'enable-background', 'fill', 'fill-opacity', 'fill-rule', 'filter',  'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage' ],\n  pattern: [  'height',  'patternContentUnits', 'patternTransform', 'patternUnits', 'requiredFeatures', 'style', 'systemLanguage', 'viewBox', 'width', 'x', 'xlink:href', 'y' ],\n  polygon: [  'clip-path', 'clip-rule',  'fill', 'fill-opacity', 'fill-rule', 'filter',   'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'points', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'sides', 'shape', 'edge', 'point', 'starRadiusMultiplier', 'r', 'radialshift' ],\n  polyline: [  'clip-path', 'clip-rule',  'fill', 'fill-opacity', 'fill-rule', 'filter', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'points', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'se:connector' ],\n  radialGradient: [  'cx', 'cy', 'fx', 'fy', 'gradientTransform', 'gradientUnits',  'r', 'requiredFeatures', 'spreadMethod', 'systemLanguage', 'xlink:href' ],\n  rect: [  'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'height',  'mask', 'opacity', 'requiredFeatures', 'rx', 'ry', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'width', 'x', 'y' ],\n  stop: [   'offset', 'requiredFeatures', 'stop-opacity', 'style', 'systemLanguage', 'stop-color', 'gradientUnits', 'gradientTransform' ],\n  svg: [  'clip-path', 'clip-rule', 'enable-background', 'filter',  'height', 'mask', 'preserveAspectRatio', 'requiredFeatures', 'style', 'systemLanguage', 'version', 'viewBox', 'width', 'x', 'xmlns', 'xmlns:se', 'xmlns:xlink', 'xmlns:oi', 'oi:animations', 'y', 'stroke-linejoin', 'fill-rule', 'aria-label', 'stroke-width', 'fill-rule', 'xml:space' ],\n  switch: [   'requiredFeatures', 'systemLanguage' ],\n  symbol: [  'fill', 'fill-opacity', 'fill-rule', 'filter', 'font-family', 'font-size', 'font-style', 'font-weight',  'opacity', 'overflow', 'preserveAspectRatio', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'viewBox', 'width', 'height' ],\n  text: [  'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'font-family', 'font-size', 'font-style', 'font-weight',  'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'text-anchor', 'x', 'xml:space', 'y' ],\n  textPath: [   'method', 'requiredFeatures', 'spacing', 'startOffset', 'style', 'systemLanguage', 'xlink:href' ],\n  title: [],\n  tspan: [  'clip-path', 'clip-rule', 'dx', 'dy', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'font-family', 'font-size', 'font-style', 'font-weight',  'mask', 'opacity', 'requiredFeatures', 'rotate', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'text-anchor', 'textLength', 'x', 'xml:space', 'y' ],\n  use: [  'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'height',  'mask', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'width', 'x', 'xlink:href', 'y', 'overflow' ],\n\n  // MathML Elements\n  annotation: [ 'encoding' ],\n  'annotation-xml': [ 'encoding' ],\n  maction: [ 'actiontype', 'other', 'selection' ],\n  math: [    'xmlns' ],\n  menclose: [ 'notation' ],\n  merror: [],\n  mfrac: [ 'linethickness' ],\n  mi: [ 'mathvariant' ],\n  mmultiscripts: [],\n  mn: [],\n  mo: [ 'fence', 'lspace', 'maxsize', 'minsize', 'rspace', 'stretchy' ],\n  mover: [],\n  mpadded: [ 'lspace', 'width', 'height', 'depth', 'voffset' ],\n  mphantom: [],\n  mprescripts: [],\n  mroot: [],\n  mrow: [ 'xlink:href', 'xlink:type', 'xmlns:xlink' ],\n  mspace: [ 'depth', 'height', 'width' ],\n  msqrt: [],\n  mstyle: [ 'displaystyle', 'mathbackground', 'mathcolor', 'mathvariant', 'scriptlevel' ],\n  msub: [],\n  msubsup: [],\n  msup: [],\n  mtable: [ 'align', 'columnalign', 'columnlines', 'columnspacing', 'displaystyle', 'equalcolumns', 'equalrows', 'frame', 'rowalign', 'rowlines', 'rowspacing', 'width' ],\n  mtd: [ 'columnalign', 'columnspan', 'rowalign', 'rowspan' ],\n  mtext: [],\n  mtr: [ 'columnalign', 'rowalign' ],\n  munder: [],\n  munderover: [],\n  none: [],\n  semantics: []\n};\n/* eslint-enable max-len */\n// add generic attributes to all elements of the whitelist\nObject.keys(svgWhiteList_).forEach((element) => svgWhiteList_[element] = [ ...svgWhiteList_[element], ...svgGenericWhiteList ]);\n// Produce a Namespace-aware version of svgWhitelist\nconst svgWhiteListNS_ = {};\nObject.entries(svgWhiteList_).forEach(([ elt, atts ]) => {\n  const attNS = {};\n  Object.entries(atts).forEach(function ([ _i, att ]) {\n    if (att.includes(':')) {\n      const v = att.split(':');\n      attNS[v[1]] = NS[(v[0]).toUpperCase()];\n    } else {\n      attNS[att] = att === 'xmlns' ? NS.XMLNS : null;\n    }\n  });\n  svgWhiteListNS_[elt] = attNS;\n});\n\n/**\n* Sanitizes the input node and its children.\n* It only keeps what is allowed from our whitelist defined above.\n* @function module:sanitize.sanitizeSvg\n* @param {Text|Element} node - The DOM element to be checked (we'll also check its children) or text node to be cleaned up\n* @returns {void}\n*/\nexport const sanitizeSvg = function (node) {\n  // Cleanup text nodes\n  if (node.nodeType === 3) { // 3 === TEXT_NODE\n    // Trim whitespace\n    node.nodeValue = node.nodeValue.trim();\n    // Remove if empty\n    if (!node.nodeValue.length) {\n      node.remove();\n    }\n  }\n\n  // We only care about element nodes.\n  // Automatically return for all non-element nodes, such as comments, etc.\n  if (node.nodeType !== 1) { // 1 == ELEMENT_NODE\n    return;\n  }\n\n  const doc = node.ownerDocument;\n  const parent = node.parentNode;\n  // can parent ever be null here?  I think the root node's parent is the document...\n  if (!doc || !parent) {\n    return;\n  }\n\n  const allowedAttrs = svgWhiteList_[node.nodeName];\n  const allowedAttrsNS = svgWhiteListNS_[node.nodeName];\n  // if this element is supported, sanitize it\n  if (typeof allowedAttrs !== 'undefined') {\n    const seAttrs = [];\n    let i = node.attributes.length;\n    while (i--) {\n      // if the attribute is not in our whitelist, then remove it\n      const attr = node.attributes.item(i);\n      const attrName = attr.nodeName;\n      const attrLocalName = attr.localName;\n      const attrNsURI = attr.namespaceURI;\n      // Check that an attribute with the correct localName in the correct namespace is on\n      // our whitelist or is a namespace declaration for one of our allowed namespaces\n      if (!({}.hasOwnProperty.call(allowedAttrsNS, attrLocalName) &&\n        attrNsURI === allowedAttrsNS[attrLocalName] && attrNsURI !== NS.XMLNS\n      ) &&\n        !(attrNsURI === NS.XMLNS && REVERSE_NS[attr.value])) {\n        // Bypassing the whitelist to allow se: prefixes.\n        // Is there a more appropriate way to do this?\n        if (attrName.startsWith('se:') || attrName.startsWith('data-')) {\n          seAttrs.push([ attrName, attr.value ]);\n        }\n        console.warn(`sanitizeSvg: attribute ${attrName} in element ${node.nodeName} not in whitelist is removed`);\n        node.removeAttributeNS(attrNsURI, attrLocalName);\n      }\n\n      // Add spaces before negative signs where necessary\n      if (isGecko()) {\n        switch (attrName) {\n        case 'transform':\n        case 'gradientTransform':\n        case 'patternTransform': {\n          const val = attr.value.replace(/(\\d)-/g, '$1 -');\n          // const val = attr.value.replace(/(?<digit>\\d)-/g, '$<digit> -');\n          node.setAttribute(attrName, val);\n          break;\n        }\n        }\n      }\n\n      // For the style attribute, rewrite it in terms of XML presentational attributes\n      if (attrName === 'style') {\n        const props = attr.value.split(';');\n        let p = props.length;\n        while (p--) {\n          const [ name, val ] = props[p].split(':');\n          const styleAttrName = (name || '').trim();\n          const styleAttrVal = (val || '').trim();\n          // Now check that this attribute is supported\n          if (allowedAttrs.includes(styleAttrName)) {\n            node.setAttribute(styleAttrName, styleAttrVal);\n          }\n        }\n        node.removeAttribute('style');\n      }\n    }\n\n    Object.values(seAttrs).forEach(([ att, val ]) => {\n      node.setAttributeNS(NS.SE, att, val);\n    });\n\n    // for some elements that have a xlink:href, ensure the URI refers to a local element\n    // (but not for links)\n    const href = getHref(node);\n    if (href &&\n      [ 'filter', 'linearGradient', 'pattern',\n        'radialGradient', 'textPath', 'use' ].includes(node.nodeName) && href[0] !== '#') {\n      // remove the attribute (but keep the element)\n      setHref(node, '');\n      console.warn(`sanitizeSvg: attribute href in element ${node.nodeName} pointing to a non-local reference (${href}) is removed`);\n      node.removeAttributeNS(NS.XLINK, 'href');\n    }\n\n    // Safari crashes on a <use> without a xlink:href, so we just remove the node here\n    if (node.nodeName === 'use' && !getHref(node)) {\n      console.warn(`sanitizeSvg: element ${node.nodeName} without a xlink:href is removed`);\n      node.remove();\n      return;\n    }\n    // if the element has attributes pointing to a non-local reference,\n    // need to remove the attribute\n    Object.values([ 'clip-path', 'fill', 'filter', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'stroke' ], function (attr) {\n      let val = node.getAttribute(attr);\n      if (val) {\n        val = getUrlFromAttr(val);\n        // simply check for first character being a '#'\n        if (val && val[0] !== '#') {\n          node.setAttribute(attr, '');\n          console.warn(`sanitizeSvg: attribute ${attr} in element ${node.nodeName} pointing to a non-local reference (${val}) is removed`);\n          node.removeAttribute(attr);\n        }\n      }\n    });\n\n    // recurse to children\n    i = node.childNodes.length;\n    while (i--) { sanitizeSvg(node.childNodes.item(i)); }\n  // else (element not supported), remove it\n  } else {\n    // remove all children from this node and insert them before this node\n    // TODO: in the case of animation elements this will hardly ever be correct\n    console.warn(`sanitizeSvg: element ${node.nodeName} not supported is removed`);\n    const children = [];\n    while (node.hasChildNodes()) {\n      children.push(parent.insertBefore(node.firstChild, node));\n    }\n\n    // remove this node from the document altogether\n    node.remove();\n\n    // call sanitizeSvg on each of those children\n    let i = children.length;\n    while (i--) { sanitizeSvg(children[i]); }\n  }\n};\n",
                "new_contents": "/**\n * Tools for SVG sanitization.\n * @module sanitize\n * @license MIT\n *\n * @copyright 2010 Alexis Deveria, 2010 Jeff Schiller\n */\n\nimport { getReverseNS, NS } from './namespaces.js';\nimport { getHref, setHref, getUrlFromAttr } from './utilities.js';\n\nconst REVERSE_NS = getReverseNS();\n\n// Todo: Split out into core attributes, presentation attributes, etc. so consistent\n/**\n * This defines which elements and attributes that we support (or at least\n * don't remove).\n * @type {PlainObject}\n */\n/* eslint-disable max-len */\nconst svgGenericWhiteList = [ 'class', 'id', 'display', 'transform', 'style' ];\nconst svgWhiteList_ = {\n  // SVG Elements\n  a: [ 'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'mask', 'opacity', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'systemLanguage', 'xlink:href', 'xlink:title' ],\n  circle: [ 'clip-path', 'clip-rule', 'cx', 'cy', 'enable-background', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'mask', 'opacity', 'r', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'systemLanguage' ],\n  clipPath: [ 'clipPathUnits' ],\n  defs: [],\n  desc: [],\n  ellipse: [ 'clip-path', 'clip-rule', 'cx', 'cy', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'mask', 'opacity', 'requiredFeatures', 'rx', 'ry', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'systemLanguage' ],\n  feBlend: [ 'in', 'in2' ],\n  feColorMatrix: [ 'in', 'type', 'value', 'result', 'values' ],\n  feComposite: [ 'in', 'operator', 'result', 'in2' ],\n  feFlood: [ 'flood-color', 'in',  'result', 'flood-opacity' ],\n  feGaussianBlur: [  'color-interpolation-filters',  'in', 'requiredFeatures', 'stdDeviation', 'result' ],\n  feMerge: [],\n  feMergeNode: [ 'in' ],\n  feMorphology: [ 'in', 'operator', 'radius' ],\n  feOffset: [ 'dx', 'in', 'dy', 'result' ],\n  filter: [ 'color-interpolation-filters', 'filterRes', 'filterUnits', 'height',  'primitiveUnits', 'requiredFeatures', 'width', 'x', 'xlink:href', 'y' ],\n  foreignObject: [  'font-size', 'height',  'opacity', 'requiredFeatures', 'width', 'x', 'y' ],\n  g: [ 'clip-path', 'clip-rule',   'fill', 'fill-opacity', 'fill-rule', 'filter', 'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'systemLanguage', 'font-family', 'font-size', 'font-style', 'font-weight', 'text-anchor' ],\n  image: [  'clip-path', 'clip-rule', 'filter', 'height',  'mask', 'opacity', 'requiredFeatures', 'systemLanguage', 'width', 'x', 'xlink:href', 'xlink:title', 'y' ],\n  line: [  'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter',  'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'systemLanguage', 'x1', 'x2', 'y1', 'y2' ],\n  linearGradient: [   'gradientTransform', 'gradientUnits', 'requiredFeatures', 'spreadMethod', 'systemLanguage', 'x1', 'x2', 'xlink:href', 'y1', 'y2' ],\n  marker: [   'markerHeight', 'markerUnits', 'markerWidth', 'orient', 'preserveAspectRatio', 'refX', 'refY', 'systemLanguage', 'viewBox' ],\n  mask: [  'height',  'maskContentUnits', 'maskUnits', 'width', 'x', 'y' ],\n  metadata: [ ],\n  path: [  'clip-path', 'clip-rule', 'd', 'enable-background', 'fill', 'fill-opacity', 'fill-rule', 'filter',  'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'systemLanguage' ],\n  pattern: [  'height',  'patternContentUnits', 'patternTransform', 'patternUnits', 'requiredFeatures', 'systemLanguage', 'viewBox', 'width', 'x', 'xlink:href', 'y' ],\n  polygon: [  'clip-path', 'clip-rule',  'fill', 'fill-opacity', 'fill-rule', 'filter',   'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'points', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'systemLanguage', 'sides', 'shape', 'edge', 'point', 'starRadiusMultiplier', 'r', 'radialshift' ],\n  polyline: [  'clip-path', 'clip-rule',  'fill', 'fill-opacity', 'fill-rule', 'filter', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'points', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'systemLanguage', 'se:connector' ],\n  radialGradient: [  'cx', 'cy', 'fx', 'fy', 'gradientTransform', 'gradientUnits',  'r', 'requiredFeatures', 'spreadMethod', 'systemLanguage', 'xlink:href' ],\n  rect: [  'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'height',  'mask', 'opacity', 'requiredFeatures', 'rx', 'ry', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'systemLanguage', 'width', 'x', 'y' ],\n  stop: [   'offset', 'requiredFeatures', 'stop-opacity', 'systemLanguage', 'stop-color', 'gradientUnits', 'gradientTransform' ],\n  style: [ 'type' ],\n  svg: [  'clip-path', 'clip-rule', 'enable-background', 'filter',  'height', 'mask', 'preserveAspectRatio', 'requiredFeatures', 'systemLanguage', 'version', 'viewBox', 'width', 'x', 'xmlns', 'xmlns:se', 'xmlns:xlink', 'xmlns:oi', 'oi:animations', 'y', 'stroke-linejoin', 'fill-rule', 'aria-label', 'stroke-width', 'fill-rule', 'xml:space' ],\n  switch: [   'requiredFeatures', 'systemLanguage' ],\n  symbol: [  'fill', 'fill-opacity', 'fill-rule', 'filter', 'font-family', 'font-size', 'font-style', 'font-weight',  'opacity', 'overflow', 'preserveAspectRatio', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'systemLanguage', 'viewBox', 'width', 'height' ],\n  text: [  'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'font-family', 'font-size', 'font-style', 'font-weight',  'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'systemLanguage', 'text-anchor', 'x', 'xml:space', 'y' ],\n  textPath: [   'method', 'requiredFeatures', 'spacing', 'startOffset', 'systemLanguage', 'xlink:href' ],\n  title: [],\n  tspan: [  'clip-path', 'clip-rule', 'dx', 'dy', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'font-family', 'font-size', 'font-style', 'font-weight',  'mask', 'opacity', 'requiredFeatures', 'rotate', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'systemLanguage', 'text-anchor', 'textLength', 'x', 'xml:space', 'y' ],\n  use: [  'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'height',  'mask', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'width', 'x', 'xlink:href', 'y', 'overflow' ],\n\n  // MathML Elements\n  annotation: [ 'encoding' ],\n  'annotation-xml': [ 'encoding' ],\n  maction: [ 'actiontype', 'other', 'selection' ],\n  math: [    'xmlns' ],\n  menclose: [ 'notation' ],\n  merror: [],\n  mfrac: [ 'linethickness' ],\n  mi: [ 'mathvariant' ],\n  mmultiscripts: [],\n  mn: [],\n  mo: [ 'fence', 'lspace', 'maxsize', 'minsize', 'rspace', 'stretchy' ],\n  mover: [],\n  mpadded: [ 'lspace', 'width', 'height', 'depth', 'voffset' ],\n  mphantom: [],\n  mprescripts: [],\n  mroot: [],\n  mrow: [ 'xlink:href', 'xlink:type', 'xmlns:xlink' ],\n  mspace: [ 'depth', 'height', 'width' ],\n  msqrt: [],\n  mstyle: [ 'displaystyle', 'mathbackground', 'mathcolor', 'mathvariant', 'scriptlevel' ],\n  msub: [],\n  msubsup: [],\n  msup: [],\n  mtable: [ 'align', 'columnalign', 'columnlines', 'columnspacing', 'displaystyle', 'equalcolumns', 'equalrows', 'frame', 'rowalign', 'rowlines', 'rowspacing', 'width' ],\n  mtd: [ 'columnalign', 'columnspan', 'rowalign', 'rowspan' ],\n  mtext: [],\n  mtr: [ 'columnalign', 'rowalign' ],\n  munder: [],\n  munderover: [],\n  none: [],\n  semantics: []\n};\n/* eslint-enable max-len */\n\n// add generic attributes to all elements of the whitelist\nObject.keys(svgWhiteList_).forEach((element) => svgWhiteList_[element] = [ ...svgWhiteList_[element], ...svgGenericWhiteList ]);\n\n// Produce a Namespace-aware version of svgWhitelist\nconst svgWhiteListNS_ = {};\nObject.entries(svgWhiteList_).forEach(([ elt, atts ]) => {\n  const attNS = {};\n  Object.entries(atts).forEach(function ([ _i, att ]) {\n    if (att.includes(':')) {\n      const v = att.split(':');\n      attNS[v[1]] = NS[(v[0]).toUpperCase()];\n    } else {\n      attNS[att] = att === 'xmlns' ? NS.XMLNS : null;\n    }\n  });\n  svgWhiteListNS_[elt] = attNS;\n});\n\n/**\n* Sanitizes the input node and its children.\n* It only keeps what is allowed from our whitelist defined above.\n* @function module:sanitize.sanitizeSvg\n* @param {Text|Element} node - The DOM element to be checked (we'll also check its children) or text node to be cleaned up\n* @returns {void}\n*/\nexport const sanitizeSvg = function (node) {\n  // Cleanup text nodes\n  if (node.nodeType === 3) { // 3 === TEXT_NODE\n    // Trim whitespace\n    node.nodeValue = node.nodeValue.trim();\n    // Remove if empty\n    if (!node.nodeValue.length) {\n      node.remove();\n    }\n  }\n\n  // We only care about element nodes.\n  // Automatically return for all non-element nodes, such as comments, etc.\n  if (node.nodeType !== 1) { // 1 == ELEMENT_NODE\n    return;\n  }\n\n  const doc = node.ownerDocument;\n  const parent = node.parentNode;\n  // can parent ever be null here?  I think the root node's parent is the document...\n  if (!doc || !parent) {\n    return;\n  }\n\n  const allowedAttrs = svgWhiteList_[node.nodeName];\n  const allowedAttrsNS = svgWhiteListNS_[node.nodeName];\n  // if this element is supported, sanitize it\n  if (typeof allowedAttrs !== 'undefined') {\n    const seAttrs = [];\n    let i = node.attributes.length;\n    while (i--) {\n      // if the attribute is not in our whitelist, then remove it\n      const attr = node.attributes.item(i);\n      const attrName = attr.nodeName;\n      const attrLocalName = attr.localName;\n      const attrNsURI = attr.namespaceURI;\n      // Check that an attribute with the correct localName in the correct namespace is on\n      // our whitelist or is a namespace declaration for one of our allowed namespaces\n      if ( attrNsURI !== allowedAttrsNS[attrLocalName] && attrNsURI !== NS.XMLNS\n       && !(attrNsURI === NS.XMLNS && REVERSE_NS[attr.value]) ) {\n        // Bypassing the whitelist to allow se: and oi: prefixes\n        // We can add specific namepaces on demand for now.\n        // Is there a more appropriate way to do this?\n        if (attrName.startsWith('se:') || attrName.startsWith('oi:')|| attrName.startsWith('data-')) {\n          seAttrs.push([ attrName, attr.value ]);\n        } else {\n          console.warn(`sanitizeSvg: attribute ${attrName} in element ${node.nodeName} not in whitelist is removed`);\n          node.removeAttributeNS(attrNsURI, attrLocalName);\n        }\n      }\n\n      // For the style attribute, rewrite it in terms of XML presentational attributes\n      if (attrName === 'style') {\n        const props = attr.value.split(';');\n        let p = props.length;\n        while (p--) {\n          const [ name, val ] = props[p].split(':');\n          const styleAttrName = (name || '').trim();\n          const styleAttrVal = (val || '').trim();\n          // Now check that this attribute is supported\n          if (allowedAttrs.includes(styleAttrName)) {\n            node.setAttribute(styleAttrName, styleAttrVal);\n          }\n        }\n        node.removeAttribute('style');\n      }\n    }\n\n    Object.values(seAttrs).forEach(([ att, val ]) => {\n      node.setAttributeNS(NS.SE, att, val);\n    });\n\n    // for some elements that have a xlink:href, ensure the URI refers to a local element\n    // (but not for links)\n    const href = getHref(node);\n    if (href &&\n      [ 'filter', 'linearGradient', 'pattern',\n        'radialGradient', 'textPath', 'use' ].includes(node.nodeName) && href[0] !== '#') {\n      // remove the attribute (but keep the element)\n      setHref(node, '');\n      console.warn(`sanitizeSvg: attribute href in element ${node.nodeName} pointing to a non-local reference (${href}) is removed`);\n      node.removeAttributeNS(NS.XLINK, 'href');\n    }\n\n    // Safari crashes on a <use> without a xlink:href, so we just remove the node here\n    if (node.nodeName === 'use' && !getHref(node)) {\n      console.warn(`sanitizeSvg: element ${node.nodeName} without a xlink:href is removed`);\n      node.remove();\n      return;\n    }\n    // if the element has attributes pointing to a non-local reference,\n    // need to remove the attribute\n    Object.values([ 'clip-path', 'fill', 'filter', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'stroke' ], function (attr) {\n      let val = node.getAttribute(attr);\n      if (val) {\n        val = getUrlFromAttr(val);\n        // simply check for first character being a '#'\n        if (val && val[0] !== '#') {\n          node.setAttribute(attr, '');\n          console.warn(`sanitizeSvg: attribute ${attr} in element ${node.nodeName} pointing to a non-local reference (${val}) is removed`);\n          node.removeAttribute(attr);\n        }\n      }\n    });\n\n    // recurse to children\n    i = node.childNodes.length;\n    while (i--) { sanitizeSvg(node.childNodes.item(i)); }\n  // else (element not supported), remove it\n  } else {\n    // remove all children from this node and insert them before this node\n    // TODO: in the case of animation elements this will hardly ever be correct\n    console.warn(`sanitizeSvg: element ${node.nodeName} not supported is removed`);\n    const children = [];\n    while (node.hasChildNodes()) {\n      children.push(parent.insertBefore(node.firstChild, node));\n    }\n\n    // remove this node from the document altogether\n    node.remove();\n\n    // call sanitizeSvg on each of those children\n    let i = children.length;\n    while (i--) { sanitizeSvg(children[i]); }\n  }\n};\n",
                "subject": "refactor sanitize, allow oi namespace",
                "message": "refactor sanitize, allow oi namespace\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "SVG-Edit/svgedit,SVG-Edit/svgedit,SVG-Edit/svgedit"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10207,
            "row": {
                "commit": "e669a0943e09aec5ad00e01415d46433f7e54bb1",
                "old_file": "react-components/oodt_opsui_sample_app/src/components/fileManager/ProductList/SearchBar.js",
                "new_file": "react-components/oodt_opsui_sample_app/src/components/fileManager/ProductList/SearchBar.js",
                "old_contents": "/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { Component } from \"react\";\nimport Paper from \"@material-ui/core/Paper\";\nimport InputBase from \"@material-ui/core/InputBase\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport SearchIcon from \"@material-ui/icons/Search\";\nimport { withStyles } from \"@material-ui/core\";\nimport PropTypes from \"prop-types\";\n\nconst styles = theme => ({\n  root: {\n    padding: \"2px 4px\",\n    display: \"flex\",\n    alignItems: \"center\",\n    width: 400\n  },\n  input: {\n    marginLeft: 8,\n    flex: 1\n  },\n  iconButton: {\n    padding: 10\n  },\n  divider: {\n    width: 1,\n    height: 28,\n    margin: 4\n  }\n});\n\nclass SearchBar extends Component {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n    this.keyPress = this.keyPress.bind(this);\n    this.click = this.click.bind(this);\n  }\n\n  state = {\n    productTypeName: \"\"\n  };\n\n  handleChange(e) {\n    this.setState({ productTypeName: e.target.value });\n  }\n\n  keyPress(e) {\n    if (e.keyCode === 13) {\n      console.log(e.target.value);\n      this.props.productTypeNameProp(this.state.productTypeName);\n      this.click();\n    }\n  }\n\n  click() {\n    this.props.loadProducts();\n  }\n\n  render() {\n    const { classes } = this.props;\n    return (\n      <Paper className={classes.root}>\n        <InputBase\n          className={classes.input}\n          placeholder=\"Search Products by Product Type Name\"\n          inputProps={{ \"aria-label\": \"Search Products\" }}\n          onKeyDown={this.keyPress}\n          onChange={this.handleChange}\n        />\n        <IconButton className={classes.iconButton} aria-label=\"Search\">\n          <SearchIcon />\n        </IconButton>\n      </Paper>\n    );\n  }\n}\n\nSearchBar.propTypes = {\n  classes: PropTypes.object.isRequired\n};\n\nexport default withStyles(styles)(SearchBar);\n",
                "new_contents": "/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { Component } from \"react\";\nimport { OutlinedInput,Button } from \"@material-ui/core\";\nimport Select from \"@material-ui/core/Select\";\nimport FormControl from \"@material-ui/core/FormControl\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport InputLabel from \"@material-ui/core/InputLabel\";\nimport SearchIcon from \"@material-ui/icons/Search\";\nimport { withStyles } from \"@material-ui/core\";\nimport PropTypes from \"prop-types\";\n\nconst styles = theme => ({\n  root: {\n    padding: \"2px 4px\",\n    display: \"flex\",\n    alignItems: \"center\",\n    width: 400\n  },\n  row: {\n    width: \"100%\",\n    display: \"flex\",\n    flexDirection: \"row\",\n    justifyContent: \"space-between\"\n  },\n  formControl: {\n    margin: 1,\n    minWidth: 120\n  },\n  input: {\n    marginLeft: 8,\n    flex: 1\n  },\n  iconButton: {\n    padding: 10\n  },\n  divider: {\n    width: 1,\n    height: 28,\n    margin: 4\n  }\n});\n\nclass SearchBar extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  state = {\n    selectedProductType: \"\",\n    selectedProductStructure: \"FLAT\",\n    selectedMIMEType: \"\",\n    selectedTransferStatus: \"RECEIVED\",\n    isSearching: false\n  };\n\n  componentDidMount(){\n    if(this.props) {\n      this.setState({selectedProductType: this.props.availableProductTypes[0]})\n    }\n  }\n\n  componentDidUpdate(prevProps){\n    if(prevProps !== this.props){\n      this.setState({selectedProductType: this.props.availableProductTypes[0]})\n    }\n  }\n\n  handleChange = (e) => {\n    this.setState({ [e.target.name]: e.target.value });\n  }\n\n  onSearch = () => {\n    setTimeout(() => {\n        this.props.onQueryTimeout({ isQueryTimedOut: true });\n    },3000);\n    this.setState({isSearching: true})\n    this.props.onSearch()\n  }\n\n  render() {\n    const { classes } = this.props;\n    return (\n      <div className={classes.row}>\n        <FormControl\n          variant=\"outlined\"\n          className={classes.formControl}\n          style={{ width: \"200px\" }}\n        >\n          <InputLabel htmlFor=\"outlined-product-Type-simple\">\n            Product Type\n          </InputLabel>\n          <Select\n            value={this.state.selectedProductType}\n            onChange={this.handleChange}\n            input={\n              <OutlinedInput\n                labelWidth={100}\n                name=\"selectedProductType\"\n                id=\"outlined-product-Type-simple\"\n              />\n            }\n          >\n            {\n              this.props.availableProductTypes.map((productType,index) => (\n                <MenuItem selected={index === 0} value={productType}>\n                  {productType}\n                </MenuItem>\n              ))\n            } \n          </Select>\n        </FormControl>\n\n        \n        <FormControl\n          variant=\"outlined\"\n          className={classes.formControl}\n          style={{ width: \"200px\" }}\n        >\n          <InputLabel htmlFor=\"outlined-product-Type-simple\">\n            Structure\n          </InputLabel>\n          <Select\n           value={this.state.selectedProductStructure}\n            onChange={this.handleChange}\n            input={\n              <OutlinedInput\n                labelWidth={100}\n                name=\"selectedProductStructure\"\n                id=\"outlined-product-structure-simple\"\n              />\n            }\n          >\n            <MenuItem value=\"FLAT\">\n            Flat\n          </MenuItem>\n          <MenuItem value=\"HIERARCHICAL\">\n            Hierarchical\n          </MenuItem>\n          </Select>\n        </FormControl>\n\n        <FormControl\n          variant=\"outlined\"\n          className={classes.formControl}\n          style={{ width: \"200px\" }}\n        >\n          <InputLabel htmlFor=\"outlined-product-Type-simple\">\n            MIME type\n          </InputLabel>\n          <Select\n            value={this.state.selectedMIMEType}\n            onChange={this.handleChange}\n            input={\n              <OutlinedInput\n                labelWidth={100}\n                name=\"selectedMIMEType\"\n                id=\"outlined-mime-type-simple\"\n              />\n            }\n          >\n            {this.props && this.props.availableMIMETypes.map(MIMEType => (\n            <MenuItem selected={true} value={MIMEType}>\n            {MIMEType}\n          </MenuItem>\n            ))}\n          </Select>\n        </FormControl>\n\n        <FormControl\n          variant=\"outlined\"\n          className={classes.formControl}\n          style={{ width: \"200px\" }}\n        >\n          <InputLabel htmlFor=\"outlined-product-Type-simple\">\n            Transfer status\n          </InputLabel>\n          <Select\n            value={this.state.selectedTransferStatus}\n            onChange={this.handleChange}\n            input={\n              <OutlinedInput\n                labelWidth={100}\n                name=\"selectedTransferStatus\"\n                id=\"outlined-transfer-status-simple\"\n              />\n            }\n          >\n            <MenuItem value=\"TRANSFERING\">\n            Tranfering\n            </MenuItem>\n            <MenuItem selected={true} value=\"RECEIVED\">\n              Received\n            </MenuItem>\n          </Select>\n        </FormControl>\n\n\n        <Button\n          variant=\"contained\"\n          size=\"medium\"\n          color=\"primary\"\n          onClick={this.onSearch}\n        >\n          <SearchIcon />\n        </Button>\n      </div>\n    );\n  }\n}\n\nSearchBar.propTypes = {\n  classes: PropTypes.object.isRequired,\n  onSearch: PropTypes.func.isRequired,\n  onQueryTimeout:PropTypes.func,\n  availableProductTypes: PropTypes.array.isRequired,\n  availableMIMETypes: PropTypes.array.isRequired,\n};\n\nexport default withStyles(styles)(SearchBar);\n",
                "subject": "add more select input to search bar",
                "message": "add more select input to search bar\n",
                "lang": "JavaScript",
                "license": "apache-2.0",
                "repos": "apache/oodt,apache/oodt,apache/oodt,apache/oodt,apache/oodt,apache/oodt,apache/oodt,apache/oodt"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10208,
            "row": {
                "commit": "74d894263cf46d5546d2af8fb16a98fccc7bdd74",
                "old_file": "test/http-server-v1.js",
                "new_file": "test/http-server-v1.js",
                "old_contents": "'use strict';\n\nrequire('should');\nconst StorageService = require('../lib/storage-service');\nconst HttpTestUtils = require('./utils/http');\nconst testServerPort = 3000;\n\nclass MockProvider {\n  constructor() {}\n}\n\nclass StorageServiceMock {\n  lookup(endpoint, MockProvider, callback) {\n    callback(null, null);\n  }\n}\n\nclass StorageServiceMockWithTokenResponse {\n  lookup(endpoint, MockProvider, callback) {\n    callback(null, 'token');\n  }\n}\n\nclass StorageServiceMockWithSecretResponse {\n  lookup(endpoint, MockProvider, callback) {\n    callback(null, {\n      username: 'bob',\n      password: 'my-awesome-password123'\n    });\n  }\n}\n\nclass StorageServiceMockWithError {\n  lookup(endpoint, MockProvider, callback) {\n    callback(new Error('Funky looking error message'), null);\n  }\n}\n\nfunction makeServer(storage) {\n  const app = require('express')();\n\n  storage = (!storage) ? new StorageServiceMock() : storage;\n\n  require('../lib/control/v1/index').attach(app, storage);\n  return app.listen(testServerPort);\n}\n\ndescribe('v1 API', function () {\n  let server = null,\n      util = null;\n\n  beforeEach(() => {\n    server = makeServer();\n    util = new HttpTestUtils(server);\n  });\n\n  afterEach((done) => {\n    server.close(done);\n    util = null;\n  });\n\n  describe('/v1/health endpoint', function() {\n    const endpoint = '/v1/health';\n\n    it('accepts GET requests', function(done) {\n      util.acceptGETRequest(endpoint).end(done);\n    });\n\n    it('rejects all other request types', function(done) {\n      util.rejectOtherRequests(endpoint).end(done);\n    });\n\n    it('returns the service health', function(done) {\n      util.testEndpointResponse(endpoint, (err, res) => {\n        res.body.should.have.property('uptime');\n        res.body.should.have.property('status');\n        res.body.should.have.property('version');\n        done();\n      });\n    });\n  });\n\n  describe('/v1/token/default endpoint', function() {\n    const endpoint = '/v1/token/default';\n\n    it('accepts GET requests', function(done) {\n      util.acceptGETRequest(endpoint).end(done);\n    });\n\n    it('rejects all other request types', function(done) {\n      util.rejectOtherRequests(endpoint).end(done);\n    });\n\n    it('returns the initial token', function(done) {\n      server.close();\n      server = makeServer(new StorageServiceMockWithTokenResponse());\n      util = new HttpTestUtils(server);\n\n      util.testEndpointResponse(endpoint, (err, res) => {\n        res.body.should.eql('token');\n        done();\n      });\n    });\n\n    it('returns an error if the token cannot be retrieved', function (done) {\n      server.close();\n      server = makeServer(new StorageServiceMockWithError());\n      util = new HttpTestUtils(server);\n\n      util.testEndpointResponse(endpoint, (err, res) => {\n        res.body.should.eql({\n          error: 'Funky looking error message'\n        });\n        done();\n      });\n    });\n  });\n\n  describe('/v1/secret/default/:mount/:role endpoint', function() {\n    const endpoint = '/v1/secret/default/foo/bar';\n\n    it('accepts GET requests', function(done) {\n      util.acceptGETRequest(endpoint).end(done);\n    });\n\n    it('rejects all other request types', function(done) {\n      util.rejectOtherRequests(endpoint).end(done);\n    });\n\n    it('returns a secret for the specified mount and role', function(done) {\n      server.close();\n      server = makeServer(new StorageServiceMockWithSecretResponse());\n      util = new HttpTestUtils(server);\n\n      util.testEndpointResponse(endpoint, (err, res) => {\n        res.body.should.eql({\n          username: 'bob',\n          password: 'my-awesome-password123'\n        });\n        done();\n      });\n    });\n\n    it('returns an error if the specified mount and role combination doesn\\'t exist', function(done) {\n      server.close();\n      server = makeServer(new StorageServiceMockWithError());\n      util = new HttpTestUtils(server);\n\n      util.testEndpointResponse(endpoint, (err, res) => {\n        res.body.should.eql({\n          error: 'Funky looking error message'\n        });\n        done();\n      });\n    });\n  });\n});\n",
                "new_contents": "'use strict';\n\nrequire('should');\nconst StorageService = require('../lib/storage-service');\nconst HttpTestUtils = require('./utils/http');\nconst testServerPort = 3000;\n\nclass MockProvider {\n  constructor() {}\n}\n\nclass StorageServiceMock {\n  lookup(endpoint, MockProvider, callback) {\n    callback(null, null);\n  }\n}\n\nclass StorageServiceMockWithTokenResponse {\n  lookup(endpoint, MockProvider, callback) {\n    callback(null, 'token');\n  }\n}\n\nclass StorageServiceMockWithSecretResponse {\n  lookup(endpoint, MockProvider, callback) {\n    callback(null, {\n      username: 'bob',\n      password: 'my-awesome-password123'\n    });\n  }\n}\n\nclass StorageServiceMockWithError {\n  lookup(endpoint, MockProvider, callback) {\n    callback(new Error('Funky looking error message'), null);\n  }\n}\n\nfunction makeServer(storage) {\n  const app = require('express')();\n\n  storage = (!storage) ? new StorageServiceMock() : storage;\n\n  require('../lib/control/v1/index').attach(app, storage);\n  return app.listen(testServerPort);\n}\n\ndescribe('v1 API', function () {\n  let server = null,\n      util = null;\n\n  beforeEach(() => {\n    server = makeServer();\n    util = new HttpTestUtils(server);\n  });\n\n  afterEach((done) => {\n    server.close(done);\n    util = null;\n  });\n\n  describe('/v1/health endpoint', function() {\n    const endpoint = '/v1/health';\n\n    it('accepts GET requests', function(done) {\n      util.acceptGETRequest(endpoint).end(done);\n    });\n\n    it('rejects all other request types', function(done) {\n      util.rejectOtherRequests(endpoint).end(done);\n    });\n\n    it('returns the service health', function(done) {\n      util.testEndpointResponse(endpoint, (err, res) => {\n        res.body.should.have.property('uptime');\n        res.body.should.have.property('status');\n        res.body.should.have.property('version');\n        done();\n      });\n    });\n  });\n\n  describe('/v1/token/default endpoint', function() {\n    const endpoint = '/v1/token/default';\n\n    it('accepts GET requests', function(done) {\n      util.acceptGETRequest(endpoint).end(done);\n    });\n\n    it('rejects all other request types', function(done) {\n      util.rejectOtherRequests(endpoint).end(done);\n    });\n\n    it('returns the initial token', function(done) {\n      server.close();\n      server = makeServer(new StorageServiceMockWithTokenResponse());\n      util = new HttpTestUtils(server);\n\n      util.testEndpointResponse(endpoint, (err, res) => {\n        res.body.should.eql('token');\n        done();\n      });\n    });\n\n    it('returns an error if the token cannot be retrieved', function (done) {\n      server.close();\n      server = makeServer(new StorageServiceMockWithError());\n      util = new HttpTestUtils(server);\n\n      util.testEndpointResponse(endpoint, (err, res) => {\n        res.body.should.eql({\n          error: 'Funky looking error message'\n        });\n        done();\n      });\n    });\n  });\n\n  describe('/v1/secret/:token/:path endpoint', function() {\n    const endpoint = '/v1/secret/default/foo/bar';\n\n    it('accepts GET requests', function(done) {\n      util.acceptGETRequest(endpoint).end(done);\n    });\n\n    it('rejects all other request types', function(done) {\n      util.rejectOtherRequests(endpoint).end(done);\n    });\n\n    it('returns a secret for the specified mount and role', function(done) {\n      server.close();\n      server = makeServer(new StorageServiceMockWithSecretResponse());\n      util = new HttpTestUtils(server);\n\n      util.testEndpointResponse(endpoint, (err, res) => {\n        res.body.should.eql({\n          username: 'bob',\n          password: 'my-awesome-password123'\n        });\n        done();\n      });\n    });\n\n    it('returns an error if the specified mount and role combination doesn\\'t exist', function(done) {\n      server.close();\n      server = makeServer(new StorageServiceMockWithError());\n      util = new HttpTestUtils(server);\n\n      util.testEndpointResponse(endpoint, (err, res) => {\n        res.body.should.eql({\n          error: 'Funky looking error message'\n        });\n        done();\n      });\n    });\n  });\n});\n",
                "subject": "Renamed describe block to the new endpoint pattern.",
                "message": "Renamed describe block to the new endpoint pattern.\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "rapid7/tokend,rapid7/tokend,rapid7/tokend"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10209,
            "row": {
                "commit": "2589f03b19eb5340b52e065c4a666581ed2263dc",
                "old_file": "index.sjs",
                "new_file": "index.sjs",
                "old_contents": "macro fmt {\n  case { _ ( $val:expr ) } => {\n    function fmt(v) {\n      return v.map(function(x){\n        return x.token.inner ?\n          x.token.value[0] + fmt(x.token.inner) + x.token.value[1] :\n          x.token.value;\n      }).join('');\n    }\n    return [makeValue(fmt(#{$val}), #{here})];\n  }\n}\n\nlet assert = macro {\n  case { _ ( $tok:expr ) } => {\n    var tok = #{$tok}[0];\n    var x = makeIdent('assert', #{$tok}[0]);\n    x.context = tok.deferredContext || tok.context;\n    return [x];\n  }\n}\n\n// This is workaround for https://github.com/mozilla/sweet.js/issues/232\nmacro scope {\n  rule { { $body ... } } => {\n    !(function () {\n      $body ...\n    })();\n  }\n}\n\nmacro should {\n  rule infix { $lhs:expr | == $rhs:expr } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).deepEqual(\n        lhs, rhs,\n        fmt($lhs) + \" should be equal to \" + fmt($rhs) +\n        \" but got \" + lhs + \" != \" + rhs)\n    }\n  }\n\n  rule infix { $lhs:expr | != $rhs:expr } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).notDeepEqual(\n        lhs, rhs,\n        fmt($lhs) + \" should not be equal to \" + fmt($rhs) +\n        \" but got \" + lhs + \" == \" + rhs)\n    }\n  }\n\n  rule infix { $lhs:expr | > $rhs:expr } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).ok(\n        lhs > rhs,\n        fmt($lhs) + \" should be greater than \" + fmt($rhs) +\n        \" but got \" + lhs + \" <= \" + rhs)\n    }\n  }\n  rule infix { $lhs:expr | >= $rhs:expr } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).ok(\n        lhs >= rhs,\n        fmt($lhs) + \" should be greater or equal than \" + fmt($rhs) +\n        \" but got \" + lhs + \" < \" + rhs)\n    }\n  }\n  rule infix { $lhs:expr | < $rhs:expr } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).ok(\n        lhs < rhs,\n        fmt($lhs) + \" should be less than \" + fmt($rhs) +\n        \" but got \" + lhs + \" >= \" + rhs)\n    }\n  }\n  rule infix { $lhs:expr | <= $rhs:expr } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).ok(\n        lhs <= rhs,\n        fmt($lhs) + \" should be less or equal than \" + fmt($rhs) +\n        \" but got \" + lhs + \" > \" + rhs)\n    }\n  }\n\n  rule infix { $lhs:expr | have $rhs:expr } => {\n    scope {\n      var lhs = $lhs;\n      assert($lhs).ok(\n        typeof $lhs.$rhs !== 'undefined',\n        fmt($lhs) + \" should have \" + fmt($rhs) + \" property\" +\n        \" but \" + lhs + \" has such property\")\n    }\n  }\n\n  rule infix { $lhs:expr | be truthy } => {\n    scope {\n      var lhs = $lhs;\n      assert($lhs).ok(\n        lhs,\n        fmt($lhs) + \" should be truthy\" +\n        \" but it is \" + lhs)\n    }\n  }\n  rule infix { $lhs:expr | be falsy } => {\n    scope {\n      var lhs = $lhs;\n      assert($lhs).ok(\n        !lhs,\n        fmt($lhs) + \" should be falsy\" +\n        \" but it is \" + lhs)\n    }\n  }\n\n  rule infix { $lhs:expr | contain $rhs } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).ok(\n        lhs.indexOf(rhs) > -1,\n        fmt($lhs) + \" should contain \" + fmt($rhs) +\n        \" but \" + lhs + \" doesn't contain \" + rhs)\n    }\n  }\n\n  rule infix { $lhs:expr | throw } => {\n    scope {\n      assert($lhs).throws(\n        function() { $lhs },\n        Error,\n        fmt($lhs) + \" should throw\")\n    }\n  }\n  rule infix { $lhs:expr | not throw } => {\n    scope {\n      assert($lhs).doesNotThrow(\n        function() { $lhs },\n        fmt($lhs) + \" should not throw\")\n    }\n  }\n\n  rule infix { $lhs:expr | be $rhs } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).ok(\n        lhs === rhs,\n        fmt($lhs) + \" should be \" + fmt($rhs) +\n        \" but \" + lhs + \" isn't \" + rhs)\n    }\n  }\n}\n\nexport should;\n",
                "new_contents": "macro fmt {\n  case { _ ( $val:expr ) } => {\n    function fmt(v) {\n      return v.map(function(x){\n        return x.token.inner ?\n          x.token.value[0] + fmt(x.token.inner) + x.token.value[1] :\n          x.token.value;\n      }).join('');\n    }\n    return [makeValue(fmt(#{$val}), #{here})];\n  }\n}\n\nlet assert = macro {\n  case { _ ( $tok:expr ) } => {\n    var tok = #{$tok}[0];\n    var x = makeIdent('assert', #{$tok}[0]);\n    x.context = tok.deferredContext || tok.context;\n    return [x];\n  }\n}\n\n// This is workaround for https://github.com/mozilla/sweet.js/issues/232\nmacro scope {\n  rule { { $body ... } } => {\n    void (function () {\n      $body ...\n    })();\n  }\n}\n\nmacro should {\n  rule infix { $lhs:expr | == $rhs:expr } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).deepEqual(\n        lhs, rhs,\n        fmt($lhs) + \" should be equal to \" + fmt($rhs) +\n        \" but got \" + lhs + \" != \" + rhs)\n    }\n  }\n\n  rule infix { $lhs:expr | != $rhs:expr } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).notDeepEqual(\n        lhs, rhs,\n        fmt($lhs) + \" should not be equal to \" + fmt($rhs) +\n        \" but got \" + lhs + \" == \" + rhs)\n    }\n  }\n\n  rule infix { $lhs:expr | > $rhs:expr } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).ok(\n        lhs > rhs,\n        fmt($lhs) + \" should be greater than \" + fmt($rhs) +\n        \" but got \" + lhs + \" <= \" + rhs)\n    }\n  }\n  rule infix { $lhs:expr | >= $rhs:expr } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).ok(\n        lhs >= rhs,\n        fmt($lhs) + \" should be greater or equal than \" + fmt($rhs) +\n        \" but got \" + lhs + \" < \" + rhs)\n    }\n  }\n  rule infix { $lhs:expr | < $rhs:expr } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).ok(\n        lhs < rhs,\n        fmt($lhs) + \" should be less than \" + fmt($rhs) +\n        \" but got \" + lhs + \" >= \" + rhs)\n    }\n  }\n  rule infix { $lhs:expr | <= $rhs:expr } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).ok(\n        lhs <= rhs,\n        fmt($lhs) + \" should be less or equal than \" + fmt($rhs) +\n        \" but got \" + lhs + \" > \" + rhs)\n    }\n  }\n\n  rule infix { $lhs:expr | have $rhs:expr } => {\n    scope {\n      var lhs = $lhs;\n      assert($lhs).ok(\n        typeof $lhs.$rhs !== 'undefined',\n        fmt($lhs) + \" should have \" + fmt($rhs) + \" property\" +\n        \" but \" + lhs + \" has such property\")\n    }\n  }\n\n  rule infix { $lhs:expr | be truthy } => {\n    scope {\n      var lhs = $lhs;\n      assert($lhs).ok(\n        lhs,\n        fmt($lhs) + \" should be truthy\" +\n        \" but it is \" + lhs)\n    }\n  }\n  rule infix { $lhs:expr | be falsy } => {\n    scope {\n      var lhs = $lhs;\n      assert($lhs).ok(\n        !lhs,\n        fmt($lhs) + \" should be falsy\" +\n        \" but it is \" + lhs)\n    }\n  }\n\n  rule infix { $lhs:expr | contain $rhs } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).ok(\n        lhs.indexOf(rhs) > -1,\n        fmt($lhs) + \" should contain \" + fmt($rhs) +\n        \" but \" + lhs + \" doesn't contain \" + rhs)\n    }\n  }\n\n  rule infix { $lhs:expr | throw } => {\n    scope {\n      assert($lhs).throws(\n        function() { $lhs },\n        Error,\n        fmt($lhs) + \" should throw\")\n    }\n  }\n  rule infix { $lhs:expr | not throw } => {\n    scope {\n      assert($lhs).doesNotThrow(\n        function() { $lhs },\n        fmt($lhs) + \" should not throw\")\n    }\n  }\n\n  rule infix { $lhs:expr | be $rhs } => {\n    scope {\n      var lhs = $lhs;\n      var rhs = $rhs;\n      assert($lhs).ok(\n        lhs === rhs,\n        fmt($lhs) + \" should be \" + fmt($rhs) +\n        \" but \" + lhs + \" isn't \" + rhs)\n    }\n  }\n}\n\nexport should;\n",
                "subject": "use void instead of !",
                "message": "use void instead of !\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "andreypopp/sweet-assertions"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10210,
            "row": {
                "commit": "258c8cd2e2d2929dcc82264fd94acb3ac82c9527",
                "old_file": "public/javascripts/pagestack.js",
                "new_file": "public/javascripts/pagestack.js",
                "old_contents": "/**\n * pagestack.js - Customized PageView stack data-structure\n *      for url/view tracking.\n * Authors: Dave Zimmelman\n * Modified: 22 Apr 15\n */\n\n(function (window) {\n    'use strict';\n    \n    /**\n     * @callback PageEventCallback - Event listener function.\n     *      PageEventCallback functions must respond to the caller\n     *      through Event.complete() when asynchrounous work is done,\n     *      otherwise endless loops will occur.\n     * @param {PageEvent} Event - The event object fired.\n     */\n    \n    /**\n     * PageEvent - Event object passed by onLoad and onUnload page events.\n     * @property {Bool} incomplete - Status of callback event.\n     * @property {String} type - The type of event ('load' / 'unload').\n     * @property {Mixed} data - The data of the current page.\n     * @property {String} page - The identifier of the current page.\n     * @function complete - Used to designate async functions in callback\n     *      have finished.\n     * @function isEnd - Check if current page is at the end of the stack.\n     */\n    var PageEvent = function (type, state) {\n        return {\n            incomplete: true,\n            type: type,\n            data: state.data,\n            page: state.page,\n            complete: function () {\n                this.incomplete = false;\n            },\n            isEnd: function () {\n                return (PageStack._cur === PageStack._stack.length - 1);\n            }\n        };\n    };\n    /**\n     * LoadPageEvent:PageEvent\n     * @property {Mixed} prev_data - The data of the previous page.\n     * @property {String} prev_page - The identifier for the previous page.\n     */\n    var LoadPageEvent = function (state, prev) {\n        var e = new window.PageStack.PageEvent('load', state);\n        if (prev) {\n            e.prev_page = prev.page;\n            e.prev_data = prev.data;\n        }\n        return e;\n    };\n    /**\n     * UnloadPageEvent:PageEvent\n     * @property {Mixed} next_data - The data of the next page.\n     * @property {String} next_page - The identifier for the next page.\n     */\n    var UnloadPageEvent = function (state, prev) {\n        var e = new window.PageStack.PageEvent('unload', prev);\n        e.next_page = state.page;\n        e.next_data = state.data;\n        return e;\n    };\n    \n    /**\n     * PageStack - Stack structure for managing and tracking client urls and\n     *      page views.\n     * @function init - Initialize the PageStack when the client page is first\n     *      loaded.\n     * @function load - Load a new page into the client's view.\n     * @function update - Reload the current state.\n     * @function replace - Replace the current page state, without changing\n     *      the client's view.\n     * @function back - A safe alternative to window.history.back that will not\n     *      take the client away from the current page session.\n     * @function onLoad - Add a new LoadPageEvent listener.\n     * @function onUnload - Add a new UnloadPageEvent listener.\n     * @function offLoad - Remove all LoadPageEvent listeners for a specific page.\n     * @function offUnload - Remove all UnloadPageEvent listeners for a specific page.\n     * @function getState - Get the current page state object.\n     * @function getPage - Get the current page identifier.\n     * @function getData - Get the current page data (if any).\n     * @function getPath - get the localized path of the current page.\n     */\n    var PageStack = {\n        /**\n         * Initiliaze PageStack to page `index`.\n         * @param {Object} options - Initialization options.\n         *      : {String} options.index - Default page identifier for '/' path.\n         * @param {Function} onReady - Optional callback func.\n         */\n        init : function (options, onReady) {\n            this._stack = [];\n            this._cur = 0;\n            if (options && options.index) {\n                this._index = options.index;\n            }\n            this.replace({page: this._index}, '/');\n            this._fireLoad(this._index, this.getState(), false, onReady);\n        },\n        /**\n         * Load new page onto the stack.\n         * @param {String} page - The page identifier.\n         * @param {Mixed} data - The optional page data.\n         * @param {String} path - The localized path to display.\n         */\n        load : function (page, data, path) {\n            var s = {page: page.toLowerCase(), data: data};\n            if (this._cur > 0 && this._pages_eq(this.getState(-1), s)) {\n                // New page is same as one page back in the history.\n                this.back();\n            }\n            else {\n                this._push(s, path);\n            }\n        },\n        /**\n         * Update the user's view by reloading the current page state.\n         * @param {Object} ow_state - Optional state to overwrite with.\n         */\n        update : function (offset) {\n            var state = this.getState(offset), path = this.getPath(offset);\n            if (offset) this._cur + offset;\n            this._stack = this._stack.slice(0, this._cur);\n            this.replace(state.page, state.data, path);\n            this._fireLoad(this._index, {page: this._index}, false, function () {\n                if (state.page !== this._index) {\n                    this._fireLoad(state.page, state, {page: this._index});\n                }\n            });\n        },\n        /** \n         * Replace current state in the navigation history.\n         * @param {String} page - Page identifier.\n         *                          Keeps current identifier if falsy.\n         * @param {Object} data - State data to associate with page.\n         *                          Keeps current data if falsy.\n         * @param {String} path - The localized path to display.\n         *                          Keeps current path if falsy.\n         */\n        replace : function (page, data, path) {\n            var n_page = (page) ? page : this.getPage(),\n                n_data = (data) ? state : this.getData(),\n                n_path = (path) ? path : this.getPath();\n            this._stack[this._cur] = {state: {\n                                        page: n_page,\n                                        data: n_data},\n                                      path: n_path};\n            window.history.replaceState({}, document.title, n_path);\n            this._checkBack();\n        },\n        /**\n         *\n         */\n        back : function () {\n            if (this._cur > 0) {\n                window.history.back();\n            }\n            else {\n                throw new Error('PageStack cannot move back any further.');\n            }\n        },\n        /**\n         * Remove all LoadPageEvent listeners for a given page.\n         * @param {String} page - The page identifier.\n         */\n        offLoad : function (page) {\n            this._on_loads[page.toLowerCase()] = false;\n        },\n        /**\n         * Remove all UnloadPageEvent listeners for a given page.\n         * @param {String} page - The page identifier.\n         */\n        offUnload : function (page) {\n            this._on_unloads[page.toLowerCase()] = false;\n        },\n        /**\n         * Add OnLoad Event listener for given page.\n         * @param {String} page - The state.page value to listen for.\n         * @param {PageEventCallback} listenerCallback\n         */\n        onLoad : function (page, listenerCallback) {\n            page = page.toLowerCase();\n            if (!listenerCallback.toString()\n                    .match(/(e|event|Event)\\.complete\\(\\)/)) {\n                console.log('WARNING: onLoad listener added that has no ' +\n                            'call to `PageEvent.complete`. This may result ' +\n                            'in a non-terminating script.');\n            }\n            if (!this._on_loads[page]) this._on_loads[page] = [];\n            this._on_loads[page].push(listenerCallback);\n        },\n        /**\n         * Add OnLoad Event listener for given page.\n         * @param {String} page - The state.page value to listen for.\n         * @param {PageEventCallback} listenerCallback\n         */\n        onUnload : function (page, listenerCallback) {\n            page = page.toLowerCase();\n            if (!listenerCallback.toString()\n                    .match(/(e|event|Event)\\.complete\\(\\)/)) {\n                console.log('WARNING: onUnload listener added that has no ' +\n                            'call to `PageEvent.complete`. This may result ' +\n                            'in a non-terminating script.');\n            }\n            if (!this._on_unloads[page]) this._on_unloads[page] = [];\n            this._on_unloads[page].push(listenerCallback);\n        },\n        /** \n         * Get the state object of the current page.\n         * @param {Number} offset_index - Optional positive or negative\n         *      offset from the current stack pointer to check.\n         * @return {Object} - The state object, if exists, else false.\n         */\n        getState : function (offset_index) {\n            var i = (offset_index)\n                ? this._cur + offset_index\n                : this._cur;\n            if (i >= 0 && i < this._stack.length) {\n                return this._stack[i].state;\n            }\n            return false;\n        },\n        /**\n         * Get the state data of the current page.\n         * @param {Number} offset_index - Optional positive or negative\n         *      offset from the current stack pointer to check.\n         * @return {Mixed} - The state data, if exists, else false.\n         */\n        getData : function (offset_index) {\n            var s = this.getState(offset_index);\n            if (!s) return false;\n            return s.data;\n        },\n        /**\n         * Get the page identifier of the current page.\n         * @param {Number} offset_index - Optional positive or negative\n         *      offset from the current stack pointer to check.\n         * @return {String} - The page identifier, if exists, else false.\n         */\n        getPage : function (offset_index) {\n            var s = this.getState(offset_index);\n            if (!s) return false;\n            return s.page;\n        },\n        /** \n         * Get the localized path of the current page.\n         * @param {Number} offset_index - Optional positive or negative\n         *      offset from the current stack pointer to check.\n         * @return {String} - The path, if exists, else false.\n         */\n        getPath : function (offset_index) {\n            var i = (offset_index)\n                ? this._cur + offset_index\n                : this._cur;\n            if (i >= 0 && i < this._stack.length) {\n                return this._stack[i].path;\n            }\n            return false;\n        },\n        \n        _index : 'index', // Default page identifier\n        _cur : 0, // Current stack pointer\n        _stack : [], // Stack\n        _on_loads : {}, // OnLoad Event listeners\n        _on_unloads : {}, // OnUnload Event listeners\n        \n        /**\n         * Handle the soft-back button visibility.\n         */\n        _checkBack : function () {\n            var val = (this._cur === 0) ? 'hidden' : 'visible';\n            $('#soft-back-btn').css('visibility', val);\n        },\n        /**\n         * Wait for async events to complete, then execute callback.\n         * @param {Array} events - List of PageEvents.\n         * @param {Function} cb - Optional generic callback function.\n         */\n        _waitForEvents : function (events, cb) {\n            var i = true;\n            while (i) {\n                i = false;\n                for (var e in events) {\n                    if (events[e].incomplete) {\n                        i = true;\n                    }\n                }\n            }\n            cb();\n        },\n        /**\n         * Execute load listeners for given page.\n         * @param {String} page - The page identifier.\n         * @param {Object} state - The state of the current page.\n         * @param {Object} prev - The state of the previous page.\n         * @param {Function} cb - Optional generic callback function.\n         */\n        _fireLoad : function (page, state, prev, cb) {\n            var events = [], e;\n            if (this._on_loads[page]) {\n                for (var i in this._on_loads[page]) {\n                    e = new this.LoadPageEvent(state, prev);\n                    events.push(e);\n                    this._on_loads[page](e);\n                }\n            }\n            if (cb) this._waitForEvents(events, cb);\n        },\n        /**\n         * Execute unload listeners for given page.\n         * @param {String} page - The page identifier.\n         * @param {Object} state - The state of the current page.\n         * @param {Object} prev - The state of the previous page.\n         * @param {Function} cb - Optional generic callback function.\n         */\n        _fireUnload : function (page, state, prev, cb) {\n            var events = [], e;\n            if (this._on_unloads[page]) {\n                for (var i in this._on_unloads[page]) {\n                    e = new this.UnloadPageEvent(state, prev);\n                    events.push(e);\n                    this._on_unloads[page](e);\n                }\n            }\n            if (cb) this._waitForEvents(events, cb);\n        },\n        /** \n         * Push new state into the navigation history.\n         * @param {Object} state - State data to associate with page.\n         * @param {String} path - The localized path to display.\n         * @param {Function} onReady - Optional callback func.\n         */\n        _push : function (state, path) {\n            if (this._stack.length === 0) {\n                throw new Error('Cannot push to uninitialized PageStack.');\n            }\n            var prev_state = this.getState(); // Get old state.\n            this._cur++; // Increment current stack pointer.\n            this._stack = this._stack.slice(0, this._cur); // Trim stack to _cur\n            this._stack[this._cur] = {state: state, path: path}; // Set new state\n            window.history.pushState({}, document.title, path); // Push path to window\n            this._checkBack(); // Check back-button for visibility\n            this._fireUnload(prev_state.page, state, prev_state,\n                             function () {\n                PageStack._fireLoad(state.page, state, prev_state);\n            });\n        },\n        /** \n         * Move back in the page stack.\n         * @return {Bool} - True if moved backward.\n         *                - False if cannot move backward.\n         */\n        _handle_back : function () {\n            var state, prev_state = this.getState();\n            if (this._cur === 0) return false;\n            this._cur--;\n            this._checkBack();\n            state = this.getState();\n            this._fireUnload(prev_state.page, state, prev_state,\n                             function () {\n                PageStack._fireLoad(state.page, state, prev_state);\n            });\n            return true;\n        },\n        /** \n         * Move forward in the page stack.\n         * @return {Bool} - True if moved forward.\n         *                - False if cannot move forward.\n         */\n        _handle_forward : function () {\n            var state, prev_state = this.getState();\n            if (this._cur + 1 >= this._stack.length) return false;\n            this._cur++;\n            this._checkBack();\n            state = this.getState();\n            this._fireUnload(prev_state.page, state, prev_state,\n                             function () {\n                PageStack._fireLoad(state.page, state, prev_state);\n            });\n            return true;\n        },\n        /**\n         * Compares two page states for equality.\n         * @param {Object} state1\n         * @param {Object} state2\n         * @return {Bool} True if pages are identical, else False.\n         */\n        _pages_eq : function (state1, state2) {\n            return (JSON.stringify(state1) === JSON.stringify(state2));\n        }\n    };\n    \n    /**\n     * Handle popstate events.\n     */\n    window.onpopstate = function () {\n        var state = PageStack.getState(),\n            prev = (PageStack._pages_eq(state, PageStack.getState(-1)))\n                    ? PageStack._handle_back()\n                    : ((PageStack._pages_eq(state, PageStack.getState(1)))\n                        ? PageStack._handle_forward()\n                        : false);\n        if (!prev_state) {\n            console.log('Popped to state not found in PageStack.');\n            window.location.replace(document.location.pathname);\n        }\n    };\n    \n    /**\n     * Expose to window.\n     */\n    window.PageStack = PageStack;\n    \n}(window));",
                "new_contents": "/**\n * pagestack.js - Customized PageView stack data-structure\n *      for url/view tracking.\n * Authors: Dave Zimmelman\n * Modified: 22 Apr 15\n */\n\n(function (window) {\n    'use strict';\n    \n    /**\n     * @callback PageEventCallback - Event listener function.\n     *      PageEventCallback functions must respond to the caller\n     *      through Event.complete() when asynchrounous work is done,\n     *      otherwise endless loops will occur.\n     * @param {PageEvent} Event - The event object fired.\n     */\n    \n    /**\n     * PageEvent - Event object passed by onLoad and onUnload page events.\n     * @property {Bool} incomplete - Status of callback event.\n     * @property {String} type - The type of event ('load' / 'unload').\n     * @property {Mixed} data - The data of the current page.\n     * @property {String} page - The identifier of the current page.\n     * @function complete - Used to designate async functions in callback\n     *      have finished.\n     * @function isEnd - Check if current page is at the end of the stack.\n     */\n    var PageEvent = function (type, state) {\n        return {\n            incomplete: true,\n            type: type,\n            data: state.data,\n            page: state.page,\n            complete: function () {\n                this.incomplete = false;\n            },\n            isEnd: function () {\n                return (PageStack._cur === PageStack._stack.length - 1);\n            }\n        };\n    };\n    /**\n     * LoadPageEvent:PageEvent\n     * @property {Mixed} prev_data - The data of the previous page.\n     * @property {String} prev_page - The identifier for the previous page.\n     */\n    var LoadPageEvent = function (state, prev) {\n        var e = new window.PageStack.PageEvent('load', state);\n        if (prev) {\n            e.prev_page = prev.page;\n            e.prev_data = prev.data;\n        }\n        return e;\n    };\n    /**\n     * UnloadPageEvent:PageEvent\n     * @property {Mixed} next_data - The data of the next page.\n     * @property {String} next_page - The identifier for the next page.\n     */\n    var UnloadPageEvent = function (state, prev) {\n        var e = new window.PageStack.PageEvent('unload', prev);\n        e.next_page = state.page;\n        e.next_data = state.data;\n        return e;\n    };\n    \n    /**\n     * PageStack - Stack structure for managing and tracking client urls and\n     *      page views.\n     * @function init - Initialize the PageStack when the client page is first\n     *      loaded.\n     * @function load - Load a new page into the client's view.\n     * @function update - Reload the current state.\n     * @function replace - Replace the current page state, without changing\n     *      the client's view.\n     * @function back - A safe alternative to window.history.back that will not\n     *      take the client away from the current page session.\n     * @function onLoad - Add a new LoadPageEvent listener.\n     * @function onUnload - Add a new UnloadPageEvent listener.\n     * @function offLoad - Remove all LoadPageEvent listeners for a specific page.\n     * @function offUnload - Remove all UnloadPageEvent listeners for a specific page.\n     * @function getState - Get the current page state object.\n     * @function getPage - Get the current page identifier.\n     * @function getData - Get the current page data (if any).\n     * @function getPath - get the localized path of the current page.\n     */\n    var PageStack = {\n        /**\n         * Initiliaze PageStack to page `index`.\n         * @param {Object} options - Initialization options.\n         *      : {String} options.index - Default page identifier for '/' path.\n         * @param {Function} onReady - Optional callback func.\n         */\n        init : function (options, onReady) {\n            this._stack = [];\n            this._cur = 0;\n            if (options && options.index) {\n                this._index = options.index;\n            }\n            this.replace({page: this._index}, '/');\n            this._fireLoad(this._index, this.getState(), false, onReady);\n        },\n        /**\n         * Load new page onto the stack.\n         * @param {String} page - The page identifier.\n         * @param {Mixed} data - The optional page data.\n         * @param {String} path - The localized path to display.\n         */\n        load : function (page, data, path) {\n            var s = {page: page.toLowerCase(), data: data};\n            if (this._cur > 0 && this._pages_eq(this.getState(-1), s)) {\n                // New page is same as one page back in the history.\n                this.back();\n            }\n            else {\n                this._push(s, path);\n            }\n        },\n        /**\n         * Update the user's view by reloading the current page state.\n         * @param {Object} ow_state - Optional state to overwrite with.\n         */\n        update : function (offset) {\n            var state = this.getState(offset), path = this.getPath(offset);\n            if (offset) this._cur + offset;\n            this._stack = this._stack.slice(0, this._cur);\n            this.replace(state.page, state.data, path);\n            this._fireLoad(this._index, {page: this._index}, false, function () {\n                if (state.page !== this._index) {\n                    this._fireLoad(state.page, state, {page: this._index});\n                }\n            });\n        },\n        /** \n         * Replace current state in the navigation history.\n         * @param {String} page - Page identifier.\n         *                          Keeps current identifier if falsy.\n         * @param {Object} data - State data to associate with page.\n         *                          Keeps current data if falsy.\n         * @param {String} path - The localized path to display.\n         *                          Keeps current path if falsy.\n         */\n        replace : function (page, data, path) {\n            var n_page = (page) ? page : this.getPage(),\n                n_data = (data) ? data : this.getData(),\n                n_path = (path) ? path : this.getPath();\n            this._stack[this._cur] = {state: {\n                                        page: n_page,\n                                        data: n_data},\n                                      path: n_path};\n            window.history.replaceState({}, document.title, n_path);\n            this._checkBack();\n        },\n        /**\n         *\n         */\n        back : function () {\n            if (this._cur > 0) {\n                window.history.back();\n            }\n            else {\n                throw new Error('PageStack cannot move back any further.');\n            }\n        },\n        /**\n         * Remove all LoadPageEvent listeners for a given page.\n         * @param {String} page - The page identifier.\n         */\n        offLoad : function (page) {\n            this._on_loads[page.toLowerCase()] = false;\n        },\n        /**\n         * Remove all UnloadPageEvent listeners for a given page.\n         * @param {String} page - The page identifier.\n         */\n        offUnload : function (page) {\n            this._on_unloads[page.toLowerCase()] = false;\n        },\n        /**\n         * Add OnLoad Event listener for given page.\n         * @param {String} page - The state.page value to listen for.\n         * @param {PageEventCallback} listenerCallback\n         */\n        onLoad : function (page, listenerCallback) {\n            page = page.toLowerCase();\n            if (!listenerCallback.toString()\n                    .match(/(e|event|Event)\\.complete\\(\\)/)) {\n                console.log('WARNING: onLoad listener added that has no ' +\n                            'call to `PageEvent.complete`. This may result ' +\n                            'in a non-terminating script.');\n            }\n            if (!this._on_loads[page]) this._on_loads[page] = [];\n            this._on_loads[page].push(listenerCallback);\n        },\n        /**\n         * Add OnLoad Event listener for given page.\n         * @param {String} page - The state.page value to listen for.\n         * @param {PageEventCallback} listenerCallback\n         */\n        onUnload : function (page, listenerCallback) {\n            page = page.toLowerCase();\n            if (!listenerCallback.toString()\n                    .match(/(e|event|Event)\\.complete\\(\\)/)) {\n                console.log('WARNING: onUnload listener added that has no ' +\n                            'call to `PageEvent.complete`. This may result ' +\n                            'in a non-terminating script.');\n            }\n            if (!this._on_unloads[page]) this._on_unloads[page] = [];\n            this._on_unloads[page].push(listenerCallback);\n        },\n        /** \n         * Get the state object of the current page.\n         * @param {Number} offset_index - Optional positive or negative\n         *      offset from the current stack pointer to check.\n         * @return {Object} - The state object, if exists, else false.\n         */\n        getState : function (offset_index) {\n            var i = (offset_index)\n                ? this._cur + offset_index\n                : this._cur;\n            if (i >= 0 && i < this._stack.length) {\n                return this._stack[i].state;\n            }\n            return false;\n        },\n        /**\n         * Get the state data of the current page.\n         * @param {Number} offset_index - Optional positive or negative\n         *      offset from the current stack pointer to check.\n         * @return {Mixed} - The state data, if exists, else false.\n         */\n        getData : function (offset_index) {\n            var s = this.getState(offset_index);\n            if (!s) return false;\n            return s.data;\n        },\n        /**\n         * Get the page identifier of the current page.\n         * @param {Number} offset_index - Optional positive or negative\n         *      offset from the current stack pointer to check.\n         * @return {String} - The page identifier, if exists, else false.\n         */\n        getPage : function (offset_index) {\n            var s = this.getState(offset_index);\n            if (!s) return false;\n            return s.page;\n        },\n        /** \n         * Get the localized path of the current page.\n         * @param {Number} offset_index - Optional positive or negative\n         *      offset from the current stack pointer to check.\n         * @return {String} - The path, if exists, else false.\n         */\n        getPath : function (offset_index) {\n            var i = (offset_index)\n                ? this._cur + offset_index\n                : this._cur;\n            if (i >= 0 && i < this._stack.length) {\n                return this._stack[i].path;\n            }\n            return false;\n        },\n        \n        _index : 'index', // Default page identifier\n        _cur : 0, // Current stack pointer\n        _stack : [], // Stack\n        _on_loads : {}, // OnLoad Event listeners\n        _on_unloads : {}, // OnUnload Event listeners\n        \n        /**\n         * Handle the soft-back button visibility.\n         */\n        _checkBack : function () {\n            var val = (this._cur === 0) ? 'hidden' : 'visible';\n            $('#soft-back-btn').css('visibility', val);\n        },\n        /**\n         * Wait for async events to complete, then execute callback.\n         * @param {Array} events - List of PageEvents.\n         * @param {Function} cb - Optional generic callback function.\n         */\n        _waitForEvents : function (events, cb) {\n            var i = true;\n            while (i) {\n                i = false;\n                for (var e in events) {\n                    if (events[e].incomplete) {\n                        i = true;\n                    }\n                }\n            }\n            cb();\n        },\n        /**\n         * Execute load listeners for given page.\n         * @param {String} page - The page identifier.\n         * @param {Object} state - The state of the current page.\n         * @param {Object} prev - The state of the previous page.\n         * @param {Function} cb - Optional generic callback function.\n         */\n        _fireLoad : function (page, state, prev, cb) {\n            var events = [], e;\n            if (this._on_loads[page]) {\n                for (var i in this._on_loads[page]) {\n                    e = new this.LoadPageEvent(state, prev);\n                    events.push(e);\n                    this._on_loads[page](e);\n                }\n            }\n            if (cb) this._waitForEvents(events, cb);\n        },\n        /**\n         * Execute unload listeners for given page.\n         * @param {String} page - The page identifier.\n         * @param {Object} state - The state of the current page.\n         * @param {Object} prev - The state of the previous page.\n         * @param {Function} cb - Optional generic callback function.\n         */\n        _fireUnload : function (page, state, prev, cb) {\n            var events = [], e;\n            if (this._on_unloads[page]) {\n                for (var i in this._on_unloads[page]) {\n                    e = new this.UnloadPageEvent(state, prev);\n                    events.push(e);\n                    this._on_unloads[page](e);\n                }\n            }\n            if (cb) this._waitForEvents(events, cb);\n        },\n        /** \n         * Push new state into the navigation history.\n         * @param {Object} state - State data to associate with page.\n         * @param {String} path - The localized path to display.\n         * @param {Function} onReady - Optional callback func.\n         */\n        _push : function (state, path) {\n            if (this._stack.length === 0) {\n                throw new Error('Cannot push to uninitialized PageStack.');\n            }\n            var prev_state = this.getState(); // Get old state.\n            this._cur++; // Increment current stack pointer.\n            this._stack = this._stack.slice(0, this._cur); // Trim stack to _cur\n            this._stack[this._cur] = {state: state, path: path}; // Set new state\n            window.history.pushState({}, document.title, path); // Push path to window\n            this._checkBack(); // Check back-button for visibility\n            this._fireUnload(prev_state.page, state, prev_state,\n                             function () {\n                PageStack._fireLoad(state.page, state, prev_state);\n            });\n        },\n        /** \n         * Move back in the page stack.\n         * @return {Bool} - True if moved backward.\n         *                - False if cannot move backward.\n         */\n        _handle_back : function () {\n            var state, prev_state = this.getState();\n            if (this._cur === 0) return false;\n            this._cur--;\n            this._checkBack();\n            state = this.getState();\n            this._fireUnload(prev_state.page, state, prev_state,\n                             function () {\n                PageStack._fireLoad(state.page, state, prev_state);\n            });\n            return true;\n        },\n        /** \n         * Move forward in the page stack.\n         * @return {Bool} - True if moved forward.\n         *                - False if cannot move forward.\n         */\n        _handle_forward : function () {\n            var state, prev_state = this.getState();\n            if (this._cur + 1 >= this._stack.length) return false;\n            this._cur++;\n            this._checkBack();\n            state = this.getState();\n            this._fireUnload(prev_state.page, state, prev_state,\n                             function () {\n                PageStack._fireLoad(state.page, state, prev_state);\n            });\n            return true;\n        },\n        /**\n         * Compares two page states for equality.\n         * @param {Object} state1\n         * @param {Object} state2\n         * @return {Bool} True if pages are identical, else False.\n         */\n        _pages_eq : function (state1, state2) {\n            return (JSON.stringify(state1) === JSON.stringify(state2));\n        }\n    };\n    \n    /**\n     * Handle popstate events.\n     */\n    window.onpopstate = function () {\n        var state = PageStack.getState(),\n            prev = (PageStack._pages_eq(state, PageStack.getState(-1)))\n                    ? PageStack._handle_back()\n                    : ((PageStack._pages_eq(state, PageStack.getState(1)))\n                        ? PageStack._handle_forward()\n                        : false);\n        if (!prev_state) {\n            console.log('Popped to state not found in PageStack.');\n            window.location.replace(document.location.pathname);\n        }\n    };\n    \n    /**\n     * Expose to window.\n     */\n    window.PageStack = PageStack;\n    \n}(window));",
                "subject": "[Fix] Typo",
                "message": "[Fix] Typo\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "zimmed/podplay,zimmed/podplay"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10211,
            "row": {
                "commit": "f38329826729d440f95292e42c258abc52b4dec0",
                "old_file": "src/components/views/messages/MStickerBody.js",
                "new_file": "src/components/views/messages/MStickerBody.js",
                "old_contents": "/*\nCopyright 2018 New Vector Ltd\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n'use strict';\n\nimport MImageBody from './MImageBody';\nimport sdk from '../../../index';\nimport TintableSVG from '../elements/TintableSvg';\n\nexport default class MStickerBody extends MImageBody {\n    displayName: 'MStickerBody'\n\n    constructor(props) {\n      super(props);\n\n      this._onMouseEnter = this._onMouseEnter.bind(this);\n      this._onMouseLeave = this._onMouseLeave.bind(this);\n      this._onImageLoad = this._onImageLoad.bind(this);\n    }\n\n    _onMouseEnter() {\n        this.setState({showTooltip: true});\n    }\n\n    _onMouseLeave() {\n        this.setState({showTooltip: false});\n    }\n\n    _onImageLoad() {\n        this.setState({\n            placeholderClasses: 'mx_MStickerBody_placeholder_invisible',\n        });\n        const hidePlaceholderTimer = setTimeout(() => {\n            this.setState({\n                placeholderVisible: false,\n                imageClasses: 'mx_MStickerBody_image_visible',\n            });\n        }, 500);\n        this.setState({hidePlaceholderTimer});\n    }\n\n    _afterComponentDidMount() {\n        if (this.refs.image.complete) {\n            // Image already loaded\n            this.setState({\n                placeholderVisible: false,\n                placeholderClasses: '.mx_MStickerBody_placeholder_invisible',\n                imageClasses: 'mx_MStickerBody_image_visible',\n            });\n        } else {\n            // Image not already loaded\n            this.setState({\n                placeholderVisible: true,\n                placeholderClasses: '',\n                imageClasses: '',\n            });\n        }\n    }\n\n    _afterComponentWillUnmount() {\n        if (this.state.hidePlaceholderTimer) {\n            clearTimeout(this.state.hidePlaceholderTimer);\n            this.setState({hidePlaceholderTimer: null});\n        }\n    }\n\n    _messageContent(contentUrl, thumbUrl, content) {\n        let tooltip;\n        const tooltipBody = (\n            this.props.mxEvent &&\n            this.props.mxEvent.getContent() &&\n            this.props.mxEvent.getContent().body) ?\n            this.props.mxEvent.getContent().body : null;\n        if (this.state.showTooltip && tooltipBody) {\n            const RoomTooltip = sdk.getComponent('rooms.RoomTooltip');\n            tooltip = <RoomTooltip\n                className='mx_RoleButton_tooltip'\n                label={tooltipBody} />;\n        }\n\n        const gutterSize = 0;\n        let placeholderSize = 75;\n        let placeholderFixupHeight = '100px';\n        let placeholderTop = 0;\n        let placeholderLeft = 0;\n\n        if (content.info) {\n            placeholderTop = Math.floor((content.info.h/2) - (placeholderSize/2)) + 'px';\n            placeholderLeft = Math.floor((content.info.w/2) - (placeholderSize/2) + gutterSize) + 'px';\n            placeholderFixupHeight = content.info.h + 'px';\n        }\n\n        placeholderSize = placeholderSize + 'px';\n\n        return (\n            <span className='mx_MStickerBody'\n                style={{\n                    height: placeholderFixupHeight,\n                }}>\n                <div className={'mx_MStickerBody_image_container'}>\n                  { this.state.placeholderVisible &&\n                    <div\n                        className={'mx_MStickerBody_placeholder ' + this.state.placeholderClasses}\n                        style={{\n                            top: placeholderTop,\n                            left: placeholderLeft,\n                        }}\n                    >\n                        <TintableSVG\n                            src={'img/icons-show-stickers.svg'}\n                            width={placeholderSize}\n                            height={placeholderSize} />\n                    </div> }\n                    <img\n                        className={'mx_MStickerBody_image ' + this.state.imageClasses}\n                        src={contentUrl}\n                        ref='image'\n                        alt={content.body}\n                        onLoad={this.props.onWidgetLoad}\n                        onLoad={this._onImageLoad}\n                        onMouseEnter={this._onMouseEnter}\n                        onMouseLeave={this._onMouseLeave}\n                    />\n                    { tooltip }\n                </div>\n            </span>\n        );\n    }\n\n    onClick() {\n    }\n}\n",
                "new_contents": "/*\nCopyright 2018 New Vector Ltd\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n'use strict';\n\nimport MImageBody from './MImageBody';\nimport sdk from '../../../index';\nimport TintableSVG from '../elements/TintableSvg';\n\nexport default class MStickerBody extends MImageBody {\n    displayName: 'MStickerBody'\n\n    constructor(props) {\n      super(props);\n\n      this._onMouseEnter = this._onMouseEnter.bind(this);\n      this._onMouseLeave = this._onMouseLeave.bind(this);\n      this._onImageLoad = this._onImageLoad.bind(this);\n    }\n\n    _onMouseEnter() {\n        this.setState({showTooltip: true});\n    }\n\n    _onMouseLeave() {\n        this.setState({showTooltip: false});\n    }\n\n    _onImageLoad() {\n        this.setState({\n            placeholderClasses: 'mx_MStickerBody_placeholder_invisible',\n        });\n        const hidePlaceholderTimer = setTimeout(() => {\n            this.setState({\n                placeholderVisible: false,\n                imageClasses: 'mx_MStickerBody_image_visible',\n            });\n        }, 500);\n        this.setState({hidePlaceholderTimer});\n        if (this.props.onWidgetLoad) {\n            this.props.onWidgetLoad();\n        }\n    }\n\n    _afterComponentDidMount() {\n        if (this.refs.image.complete) {\n            // Image already loaded\n            this.setState({\n                placeholderVisible: false,\n                placeholderClasses: '.mx_MStickerBody_placeholder_invisible',\n                imageClasses: 'mx_MStickerBody_image_visible',\n            });\n        } else {\n            // Image not already loaded\n            this.setState({\n                placeholderVisible: true,\n                placeholderClasses: '',\n                imageClasses: '',\n            });\n        }\n    }\n\n    _afterComponentWillUnmount() {\n        if (this.state.hidePlaceholderTimer) {\n            clearTimeout(this.state.hidePlaceholderTimer);\n            this.setState({hidePlaceholderTimer: null});\n        }\n    }\n\n    _messageContent(contentUrl, thumbUrl, content) {\n        let tooltip;\n        const tooltipBody = (\n            this.props.mxEvent &&\n            this.props.mxEvent.getContent() &&\n            this.props.mxEvent.getContent().body) ?\n            this.props.mxEvent.getContent().body : null;\n        if (this.state.showTooltip && tooltipBody) {\n            const RoomTooltip = sdk.getComponent('rooms.RoomTooltip');\n            tooltip = <RoomTooltip\n                className='mx_RoleButton_tooltip'\n                label={tooltipBody} />;\n        }\n\n        const gutterSize = 0;\n        let placeholderSize = 75;\n        let placeholderFixupHeight = '100px';\n        let placeholderTop = 0;\n        let placeholderLeft = 0;\n\n        if (content.info) {\n            placeholderTop = Math.floor((content.info.h/2) - (placeholderSize/2)) + 'px';\n            placeholderLeft = Math.floor((content.info.w/2) - (placeholderSize/2) + gutterSize) + 'px';\n            placeholderFixupHeight = content.info.h + 'px';\n        }\n\n        placeholderSize = placeholderSize + 'px';\n\n        return (\n            <span className='mx_MStickerBody'\n                style={{\n                    height: placeholderFixupHeight,\n                }}>\n                <div className={'mx_MStickerBody_image_container'}>\n                  { this.state.placeholderVisible &&\n                    <div\n                        className={'mx_MStickerBody_placeholder ' + this.state.placeholderClasses}\n                        style={{\n                            top: placeholderTop,\n                            left: placeholderLeft,\n                        }}\n                    >\n                        <TintableSVG\n                            src={'img/icons-show-stickers.svg'}\n                            width={placeholderSize}\n                            height={placeholderSize} />\n                    </div> }\n                    <img\n                        className={'mx_MStickerBody_image ' + this.state.imageClasses}\n                        src={contentUrl}\n                        ref='image'\n                        alt={content.body}\n                        onLoad={this._onImageLoad}\n                        onMouseEnter={this._onMouseEnter}\n                        onMouseLeave={this._onMouseLeave}\n                    />\n                    { tooltip }\n                </div>\n            </span>\n        );\n    }\n\n    onClick() {\n    }\n}\n",
                "subject": "Remove duplicate event handler.",
                "message": "Remove duplicate event handler.\n",
                "lang": "JavaScript",
                "license": "apache-2.0",
                "repos": "matrix-org/matrix-react-sdk,aperezdc/matrix-react-sdk,aperezdc/matrix-react-sdk,matrix-org/matrix-react-sdk,aperezdc/matrix-react-sdk,aperezdc/matrix-react-sdk,matrix-org/matrix-react-sdk,matrix-org/matrix-react-sdk,matrix-org/matrix-react-sdk,matrix-org/matrix-react-sdk"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10212,
            "row": {
                "commit": "32abb0be93fe2112bc1c064a13856c992aa03050",
                "old_file": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/impl/prov.sjs",
                "new_file": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/impl/prov.sjs",
                "old_contents": "/**\n  Copyright 2012-2019 MarkLogic Corporation\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n'use strict';\nconst defaultConfig = require(\"/com.marklogic.hub/config.sjs\");\nconst ps = require('/MarkLogic/provenance');\nconst op = require('/MarkLogic/optic');\n\nclass Provenance {\n  /**\n   * @desc Provenance Class constructor\n   * @param {Object} [config] \n   * @param {string} [config.granularityLevel=coarse] - for setting the Prov object granularity level (currently unused)\n   */\n  constructor(config = null, datahub = null) {\n    this.OFF_LEVEL = 'off';\n    this.FINE_LEVEL = 'fine';\n    this.COARSE_LEVEL = 'coarse';\n    this.granularityLevels          = [this.FINE_LEVEL,this.COARSE_LEVEL];\n    this.config = {};\n    this.config.granularityLevel    = config && config.granularityLevel || 'coarse';\n    this.config.JOBDATABASE         = defaultConfig.JOBDATABASE || 'data-hub-JOBS';\n    this.config.autoCommit          = config && config.autoCommit !== undefined ? config.autoCommit : true;\n    this.config.commitQueue         = [];\n    if (datahub) {\n      this.hubutils = datahub.hubUtils;\n    } else {\n      this.hubutils = {\n        capitalize: (str) => { return (str) ? str.charAt(0).toUpperCase() + str.slice(1) : str; }\n      };\n    }\n  }\n\n  granularityLevel(level = null) {\n    if (level) {\n      this.config.granularityLevel = level;\n    }\n    return this.config.granularityLevel;\n  }\n\n  /**\n   * Get array of provTypes for a given step type for provenance record creation\n   * @param {string} stepDefinitionType - step definition type ['ingestion','mapping','mastering','custom']\n   */\n  _validStepDefinitionType(stepDefinitionType) {\n    return ['ingestion','mapping','mastering','custom'].includes(stepDefinitionType)\n  }\n  /**\n   * Validate that the info Object to ensure the metadata passed doesn't stomp on roles or location values\n   * @param {Object} info - object representing the information required to create prov info\n   */\n  _validProvInfoMetadata(info) {\n    let protectedAttributeProps = ['roles', 'roleNames', 'location'];\n    let isValid = info && info.metdata ? \n      info.metdata.every(val => !(protectedAttributeProps.includes(val))) :\n      true;  // safe, because no metadata\n    return isValid || Error(`The following metadata properties on \"info\" are not allowed: ${JSON.stringify(requiredInfoParams[stepType])}`);\n  }\n\n  /**\n   * Validate that the info Object\n   * @param {string} stepDefinitionType - step type ['ingestion','mapping','mastering','custom']\n   * @param {Object} info - object representing the information required to create prov info\n   */\n  _validProvInfoForStepType(stepDefinitionType, info) {\n    let requiredInfoParams = { \n      'ingestion': ['derivedFrom'],  // the entity, file or document URI that this ingested document was derived from\n      'mapping': ['derivedFrom','influencedBy'],\n      'mastering': ['derivedFrom','influencedBy'],\n      'custom': ['derivedFrom','influencedBy']\n    };\n    let provTypes = {\n      'ingestion': function () {\n        return requiredInfoParams['ingestion'].every(val => Object.keys(info).includes(val));\n      },\n      'mapping': function () {\n        return requiredInfoParams['mapping'].every(val => Object.keys(info).includes(val));\n      },\n      'mastering': function () {\n        return requiredInfoParams['mastering'].every(val => Object.keys(info).includes(val));\n      },\n      'custom': function () {\n        return requiredInfoParams['custom'].every(val => Object.keys(info).includes(val));\n      }\n    };\n    let isValid = provTypes[stepDefinitionType]();\n    return isValid || Error(`For Step Definition type ${stepDefinitionType}, the following properties on \"info\" are required: ${JSON.stringify(requiredInfoParams[stepDefinitionType])}`);\n  }\n\n  /**\n   * @desc Validate a provenance record params\n   * @param {string} [jobId] - the ID of the job being executed (unique), this will generate \n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} stepDefinitionType - the type of step definition within a flow ['ingestion','mapping','mastering','custom']\n   * @param {string} [docURI] - the URI of the document being modified by this step\n   * @param {Object} info\n   * @param {string} info.status - the status of the step: \n   *                               ie. created/updated/deleted.  \n   *                               Value is passed through to \"provTypes\".\n   * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n   */\n  _validateCreateStepParams(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, docURI, info) {\n    let isValid;\n    if (flowId && stepName && stepDefinitionName && stepDefinitionType && info) {\n      // check step type valid\n      if (this._validStepDefinitionType(stepDefinitionType)) {\n        let isProvInfoForStepTypeValid = (jobId) ? this._validProvInfoForStepType(stepDefinitionType, info) : true;\n        let isProvInfoMetaValid = this._validProvInfoMetadata(info);\n        // check prov info valid per type passed\n        let hasError = isProvInfoForStepTypeValid instanceof Error || isProvInfoMetaValid instanceof Error;\n        if (!hasError) {\n          // function params are valid\n          isValid = true;\n        } else {\n          // return Error that relates to prov info object\n          isValid = (isProvInfoForStepTypeValid instanceof Error) ? isProvInfoForStepTypeValid : isProvInfoMetaValid;  \n        }\n      } else {\n        isValid = new Error(`Step type ${stepDefinitionType} not defined.  Must be of type: 'ingestion','mapping','mastering','custom'.`);\n      }\n    } else {\n      let missingParams = [\n        ['flowId',flowId],\n        ['stepName',stepName],\n        ['stepDefinitionName',stepDefinitionName],\n        ['stepDefinitionType',stepDefinitionType],\n        ['info', info]\n      ].filter((pair) => !pair[1])\n        .reduce((pair) => pair[0]);\n      isValid = new Error(`Function requires all params 'flowId', 'stepName', 'stepDefinitionName', 'stepDefinitionType' and 'info' to be defined. Missing: ${missingParams.join(', ')}`);\n    }\n    return isValid;\n  }  \n\n  /**\n   * General create provenance record function that adds the same relations, \n   * attributes, dateTime & namespaces info each record requires.\n   * @param {string} id - the identifier of this provenance information\n   * @param {Object} options - provenance record options (see individual type requirements below)\n   */\n  _createRecord(id, options, metadata) {\n    metadata = metadata || null;\n    xdmp.eval(`\n      const ps = require('/MarkLogic/provenance');\n      xdmp.securityAssert(\"http://marklogic.com/xdmp/privileges/ps-user\", \"execute\");\n\n      options = options || {};\n      options.dateTime = String(fn.currentDateTime());\n      options.namespaces = { \"dhf\":\"http://marklogic.com/dhf\" }; // for user defined provenance types\n\n      // relations\n      options.relations = options.relations || {};\n      options.relations.attributedTo = xdmp.getCurrentUser();\n\n      // attributes\n      options.attributes = options.attributes || {};\n      options.attributes.roles = xdmp.getCurrentRoles().toArray().join(',');\n      options.attributes.roleNames = xdmp.getCurrentRoles().toArray().map((r) => xdmp.roleName(r)).join(',');\n\n      metadata = metadata || {};\n      if (metadata)\n        Object.assign(options.attributes, metadata)\n\n      var record = ps.provenanceRecord(id, options);\n      ps.provenanceRecordInsert(record);\n      `,\n      { id, options, metadata },\n      {\n        database: xdmp.database(this.config.JOBDATABASE),\n        commit: 'auto',\n        update: 'true',\n        ignoreAmps: true\n    })\n    return id;\n  }\n\n  /**\n   * @desc Create a provenance record when a document is run through an ingestion step\n   * @param {string} jobId - the ID of the job being executed (unique), this will generate \n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} docURI - the URI of the document being modified by this step\n   * @param {Object} info\n   * @param {string} info.derivedFrom - the entity, file or document URI that this ingested document was derived from\n   * @param {string} info.influencedBy - the ingestion step the document was modified by\n   * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n   *   Ingest document from outside source\n   *    provTypes: [ \"ps:Flow\", \"ps:File\" ],\n   *    relations: \n   *      - generatedBy (job id)\n   *      - derivedFrom (file)\n   *      - derivedFrom (uri)\n   *      - influencedBy (mapping)\n   *      - associatedWith [flow id, step name, step definition name]\n   *    attributes:\n   *      - location (doc URI)\n   */\n  _createIngestionStepRecord(jobId, flowId, stepName, stepDefinitionName, docURI, info) {\n    let provId = `${jobId + flowId + 'ingestion' + docURI}`;\n    let provTypes = ['ps:Flow','ps:Entity','dhf:Entity','dhf:IngestionStep','dhf:IngestionStepEntity'];\n    if (info && info.status)\n      provTypes.push('dhf:Doc' + this.hubutils.capitalize(info.status));\n\n    let recordOpts = {\n      provTypes,\n      relations: {\n        associatedWith: [flowId, stepName, stepDefinitionName],\n        generatedBy: jobId,\n        derivedFrom: info && info.derivedFrom,\n      },\n      attributes: { location: docURI }\n    };\n\n    return (this.config.autoCommit) ? \n      this._createRecord(provId, recordOpts, info.metadata) : \n      this.config.commitQueue.push([provId, recordOpts, info.metadata]);\n  }\n\n  /**\n   * @desc Create a provenance record when a document is run through a mapping step\n   * @param {string} jobId - the ID of the job being executed (unique), this will generate\n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} [docURI] - the URI of the document being modified by this step\n   * @param {Object} info\n   * @param {string} info.derivedFrom - the entity, file or document URI that this ingested document was derived from\n   * @param {string} info.influencedBy - the mapping step the document was modified by\n   * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n   *   Map Source document property to Entity Instance property\n   *    provTypes: [ \"ps:Flow\", \"ps:EntityProperty\", \"ps:Mapping\", \"dhf:ModelToModelMapping\" ],\n   *    relations:\n   *      - generatedBy (job id)\n   *      - derivedFrom (uri)\n   *      - derivedFrom (array of uris) - not supported in current QuickStart\n   *      - influencedBy (mapping)\n   *      - influencedBy (component [aka. custom code])\n   *      - associatedWith [flow id, step name, step definition name]\n   *    attributes:\n   *      - location (doc URI)\n   */\n  _createMappingStepRecord(jobId, flowId, stepName, stepDefinitionName, docURI, info) {\n    let provId = `${jobId + flowId + 'mapping' + docURI}`;\n    let provTypes = ['ps:Flow','ps:Entity','dhf:Entity','dhf:MappingStep','dhf:MappingStepEntity'];\n    if (info && info.status)\n      provTypes.push('dhf:Doc' + this.hubutils.capitalize(info.status));\n\n    let recordOpts = {\n      provTypes,\n      relations: {\n        associatedWith: [flowId, stepName, stepDefinitionName],\n        generatedBy: jobId,\n        derivedFrom: info && info.derivedFrom,\n        influencedBy: info && info.influencedBy,\n      },\n      attributes: { location: docURI }\n    };\n\n    return (this.config.autoCommit) ? \n      this._createRecord(provId, recordOpts, info.metadata) : \n      this.config.commitQueue.push([provId, recordOpts, info.metadata]);\n  }\n\n  /**\n   * @desc Create a provenance record when a document is run through a mastering step\n   * @param {string} jobId - the ID of the job being executed (unique), this will generate\n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} [docURI] - the URI of the document being modified by this step\n   * @param {Object} info\n   * @param {string} info.derivedFrom - the entity, file or document URI that this ingested document was derived from\n   * @param {string} info.influencedBy - the mastering step the document was modified by\n   * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n   *   Master Source doc property to Entity Instance property\n   *    provTypes: [ \"ps:Flow\", \"ps:EntityProperty\", \"dhf:Mastering\" ],\n   *    relations:\n   *      - generatedBy (job id)\n   *      - derivedFrom (uri)\n   *      - derivedFrom (array of uris)\n   *      - influencedBy (mastering)\n   *      - influencedBy (component [aka. custom code])\n   *      - associatedWith [flow id, step name, step definition name]\n   *    attributes:\n   *      - location (doc URI)\n   */\n  _createMasteringStepRecord(jobId, flowId, stepName, stepDefinitionName, docURI, info) {\n    let provId = `${jobId + flowId + 'mastering' + docURI}`;\n    let provTypes = ['ps:Flow','ps:Entity','dhf:Entity','dhf:MasteringStep','dhf:MasteringStepEntity'];\n    if (info && info.status)\n      provTypes.push('dhf:Doc' + this.hubutils.capitalize(info.status));\n\n    let recordOpts = {\n      provTypes,\n      relations: {\n        associatedWith: [flowId, stepName, stepDefinitionName],\n        generatedBy: jobId,\n        derivedFrom: info && info.derivedFrom,\n        influencedBy: info && info.influencedBy,\n      },\n      attributes: { location: docURI }\n    };\n\n    return (this.config.autoCommit) ? \n      this._createRecord(provId, recordOpts, info.metadata) : \n      this.config.commitQueue.push([provId, recordOpts, info.metadata]);\n  }\n\n  /**\n   * @desc Create a provenance record when a document is run through a custom step\n   * @param {string} jobId - the ID of the job being executed (unique), this will generate\n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} [docURI] - the URI of the document being modified by this step\n   * @param {Object} info\n   * @param {string} info.derivedFrom - the entity, file or document URI that this ingested document was derived from\n   * @param {string} info.influencedBy - the custom step the document was modified by\n   * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n   * Custom code transformations of source doc (prior to mapping/mastering) or Entity Instance (after mapping/mastering)\n   *  provTypes: [ \"ps:Flow\", \"ps:Entity\", \"dhf:Custom\" ],\n   *  relations:\n   *    - generatedBy (job id)\n   *    - derivedFrom (uri)\n   *    - derivedFrom (array of uris)\n   *    - influencedBy (component [aka. custom code])\n   *    - associatedWith [flow id, step name, step definition name]\n   *  attributes:\n   *    - location (doc URI)\n   */\n  _createCustomStepRecord(jobId, flowId, stepName, stepDefinitionName, docURI, info) {\n    let provId = `${jobId + flowId + 'custom' + docURI}`;\n    let provTypes = ['ps:Flow','ps:Entity','dhf:Entity','dhf:CustomStep','dhf:CustomStepEntity'];\n    if (info && info.status)\n      provTypes.push('dhf:Doc' + this.hubutils.capitalize(info.status));\n    \n    let recordOpts = {\n      provTypes,\n      relations: {\n        associatedWith: [flowId, stepName, stepDefinitionName],\n        generatedBy: jobId,\n        derivedFrom: info && info.derivedFrom,\n        influencedBy: info && info.influencedBy,\n      },\n      attributes: { location: docURI }\n    };\n\n    return (this.config.autoCommit) ? \n      this._createRecord(provId, recordOpts, info.metadata) : \n      this.config.commitQueue.push([provId, recordOpts, info.metadata]);\n  }\n\n  /**\n   * @desc Create a provenance record when a document is run through a Flow step\n   * @param {string} [jobId] - the ID of the job being executed (unique), this will generate \n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} stepDefinitionType - the type of step definition within a flow ['ingestion','mapping','mastering','custom']\n   * @param {string} [docURI] - the URI of the document being modified by this step\n   * @param {Object} info\n   * @param {string} info.status - the status of the step: \n   *                               ie. created/updated/deleted.  \n   *                               Value is passed through to \"provTypes\".\n   * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n   */\n  createStepRecord(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, docURI, info) {\n    let resp;\n    let isValid = this._validateCreateStepParams(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, docURI, info);\n    if (!(isValid instanceof Error)) {\n      let capitalizedStepType = this.hubutils.capitalize(stepDefinitionType);\n      resp = this['_create' + capitalizedStepType + 'StepRecord'](jobId, flowId, stepName, stepDefinitionName, docURI, info);\n    } else {\n      resp = isValid\n    }\n    return resp;\n  }\n\n  /**\n   * @desc Create a provenance record for a documents properties.  These records will be used to record property merges.\n   * @param {string} jobId - the ID of the job being executed (unique), this will generate \n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} stepDefinitionType - the type of step definition within a flow ['ingestion','mapping','mastering','custom']\n   * @param {string} [docURI] - the URI of the document being modified by this step\n   * @param {string} docURI - the URI of the document being processed by this step\n   * @param {Array}  properties - the properties of the document being processed by this step\n   * @param {Object} info\n   * @param {string} info.influencedBy - the Step ID assoicated this record\n   * @return {Array} Document Prov ID, Document Prov IDs for properties as an Object of \n   *                  key/value pairs mapping property names to their provenance IDs, \n   *                  for use with follow-up createStepPropertyMergeRecords() call\n   */\n  createStepPropertyRecords(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, docURI, properties, info) {\n    let resp;\n    let docProvId;\n    let docPropertyProvIds = {};\n    let docPropertyProvIdsArray = [];\n    let isValid = this._validateCreateStepParams(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, docURI, info);\n    if (!(isValid instanceof Error)) {\n      if (properties && properties.length > 0) {\n        let capitalizedStepType = this.hubutils.capitalize(stepDefinitionType);\n        for (let i=0; i<properties.length; i++) {\n          let property = properties[i];\n          let encodedPropertyName = property;\n          if (!xdmp.castableAs(\"http://www.w3.org/2001/XMLSchema\", \"QName\", encodedPropertyName)) {\n            encodedPropertyName = xdmp.encodeForNCName(encodedPropertyName);\n          }\n          let docPropProvId = `${jobId + flowId + stepDefinitionType + docURI}_${property}`\n          let docPropProvOptions = {\n            provTypes: [ 'ps:Flow', 'ps:EntityProperty', `dhf:${capitalizedStepType}`, 'dhf:EntityProperty', encodedPropertyName ],\n            relations: {\n              associatedWith: [flowId, stepName, stepDefinitionName],\n              generatedBy: jobId,\n              influencedBy: info && info.influencedBy,\n            },\n            attributes: { location: docURI }        \n          };\n          // append to return Object  \n          docPropertyProvIds[property] = docPropProvId; \n          docPropertyProvIdsArray.push(docPropProvId);\n          (this.config.autoCommit) ? \n            this._createRecord(docPropProvId, docPropProvOptions, info.metadata) : \n            this.config.commitQueue.push([docPropProvId, docPropProvOptions, info.metadata]);\n        }\n\n        // create document record\n        docProvId = `${jobId + flowId + stepDefinitionType + docURI}`;\n        let provTypes = ['ps:Flow','ps:Entity','dhf:Entity',`dhf:${capitalizedStepType}Entity`];\n        let recordOpts = {\n          provTypes,\n          relations: {\n            associatedWith: [flowId, stepName, stepDefinitionName],\n            generatedBy: jobId,\n            hadMember: docPropertyProvIdsArray,\n            influencedBy: info && info.influencedBy,\n          },\n          attributes: { location: docURI }\n        };\n\n        (this.config.autoCommit) ? \n          this._createRecord(docProvId, recordOpts, info.metadata) : \n          this.config.commitQueue.push([docProvId, recordOpts, info.metadata]);\n\n        // construct response\n        resp = [docProvId, docPropertyProvIds];\n      } else {\n        resp = new Error(`Function requires param 'properties' to be defined.`);\n      }\n    } else {\n      resp = isValid\n    }\n    return resp;\n  }  \n\n  /**\n   * @desc Create a provenance for altered property record for multiple property records\n   * @param {string} jobId - the ID of the job being executed (unique), this will generate \n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} stepDefinitionType - the type of step definition within a flow ['ingestion','mapping','mastering','custom']\n   * @param {string} propertyName - the name of the property being merged\n   * @param {Array}  docURIs - the URIs of the documents associated with this merge\n   * @param {Array}  propertyProvIds - the provenance record ids of the properties being merged by this step\n   * @param {Object} info\n   * @param {string} info.influencedBy - the Step ID assoicated this record\n   * @return {Object} key/value pairs mapping property names to their provenance IDs, \n   *                  for use with follow-up createStepPropertyAlterationRecords() call\n   */\n  createStepPropertyAlterationRecord(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, propertyName, docURIs, propertyProvIds, info) {\n    let resp = [];\n    let isValid = this._validateCreateStepParams(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, docURIs, info);\n    let activity = 'altered';\n    if (stepDefinitionType === 'mapping') {\n      activity = 'mapped';\n    } else if (stepDefinitionType === 'mastering') {\n      activity = 'merged';\n    }\n    if (!(isValid instanceof Error)) {\n      if (docURIs && docURIs.length > 0 &&\n        propertyProvIds && propertyProvIds.length > 0) {\n        let capitalizedStepType = this.hubutils.capitalize(stepDefinitionType);\n        let provId = `${jobId + flowId + stepDefinitionType + docURIs.concat()}_${propertyName}_${activity}`;\n        let encodedPropertyName = propertyName;\n        if (!xdmp.castableAs(\"http://www.w3.org/2001/XMLSchema\", \"QName\", encodedPropertyName)) {\n          encodedPropertyName = xdmp.encodeForNCName(encodedPropertyName);\n        }\n        let provTypes = ['ps:Flow','ps:Entity','dhf:AlteredEntityProperty',`dhf:${capitalizedStepType}AlteredEntityProperty`, encodedPropertyName];\n        let recordOpts = {\n          provTypes,\n          relations: {\n            associatedWith: [flowId, stepName, stepDefinitionName],\n            generatedBy: jobId,\n            derivedFrom: propertyProvIds,\n            influencedBy: info && info.influencedBy,\n          }\n        };\n        (this.config.autoCommit) ? \n          this._createRecord(provId, recordOpts, info.metadata) : \n          this.config.commitQueue.push([provId, recordOpts, info.metadata]);\n\n        resp = provId;\n      } else {\n        resp = new Error(`Function requires param 'docURIs' & 'propertyProvIds' to be defined.`);\n      }\n    } else {\n      resp = isValid\n    }\n    return resp;\n  }\n\n  /**\n   * @desc Create a provenance alteration record for multiple property records\n   * @param {string} jobId - the ID of the job being executed (unique), this will generate \n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} stepDefinitionType - the type of step definition within a flow ['ingestion','mapping','mastering','custom']\n   * @param {Array}  docURI - the new URI of the document created after the merge\n   * @param {Array}  propertyProvIds - the provenance record ids of the properties being altered by this step\n   * @param {Object} info\n   * @param {string} info.influencedBy - the Step ID assoicated this record\n   * @return {Object} key/value pairs mapping property names to their provenance IDs, \n   *                  for use with follow-up createStepDocumentAlterationRecords() call\n   */\n  createStepDocumentAlterationRecord(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, newDocURI, documentProvIds, alteredPropertyProvIds, info) {\n    let resp = [];\n    let isValid = this._validateCreateStepParams(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, documentProvIds, info);\n    if (!(isValid instanceof Error)) { \n      if (documentProvIds && documentProvIds.length > 0 &&\n        alteredPropertyProvIds && alteredPropertyProvIds.length > 0) {\n        let capitalizedStepType = this.hubutils.capitalize(stepDefinitionType);\n        let provId = `${jobId + flowId + stepDefinitionType + newDocURI}`;\n        let provTypes = ['ps:Flow','ps:Entity','dhf:AlteredEntity',`dhf:${capitalizedStepType}AlteredEntity`];\n        let recordOpts = {\n          provTypes,\n          relations: {\n            associatedWith: [flowId, stepName, stepDefinitionName],\n            generatedBy: jobId,\n            derivedFrom: documentProvIds,\n            hadMember: alteredPropertyProvIds,\n            influencedBy: info && info.influencedBy,\n          },\n          attributes: { location: newDocURI }\n        };\n        (this.config.autoCommit) ? \n          this._createRecord(provId, recordOpts, info.metadata) : \n          this.config.commitQueue.push([provId, recordOpts, info.metadata]);\n        resp = provId;\n      } else {\n        resp = new Error(`Function requires param 'documentProvIds' & 'alteredPropertyProvIds' to be defined.`);\n      }\n    } else {\n      resp = isValid\n    }\n    return resp;\n  }\n\n  /**\n   * @desc Commit all queued Provenance records.  Only works if config.autoCommit === false\n   *       and records are being saved, rather than committed instantly.\n   */\n  commit() { \n    if (this.config.autoCommit === false && this.config.commitQueue.length > 0) {\n      while (this.config.commitQueue.length) {\n        this._createRecord( ...(this.config.commitQueue.shift()) );\n      }\n    }\n  }\n\n  /**\n   * @desc Discard all queued Provenance records.  Only works if config.autoCommit === false\n   *       and records are being saved, rather than committed instantly.\n   */\n  discard() { \n    if (this.config.autoCommit === false && this.config.commitQueue.length > 0) {\n      this.config.commitQueue = [];\n    }\n  }\n\n  // /**\n  //  * @desc Create a provenance record when a Job is created immediately executed\n  //  * @param {string} jobId - the ID of the job being executed (unique), this will generate \n  //  * @param {string} flowId - the unique ID of the flow\n  //  * @param {Object} info\n  //  * @param {string} info.status - the status of the job: \n  //  *                               ie. created/updated/deleted.  \n  //  *                               Value is passed through to \"provTypes\".\n  //  * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n  //  */\n  // createJobRecord(jobId, flowId, info) {\n  //   let resp;\n  //   let provId = this.hubutils.uuid();\n  //   let isProvInfoMetaValid = this._validProvInfoMetadata(info);\n\n  //   if (!(isProvInfoMetaValid instanceof Error)) {\n  //     let jobProvTypes = (info.status === 'started') ?\n  //       ['ps:FlowRun', 'dhf:Job', 'dhf:Job' + this.hubutils.capitalize(info.status)] :\n  //       ['ps:Flow', 'dhf:Job', 'dhf:Job' + this.hubutils.capitalize(info.status)];\n  //     let recordOpts = {\n  //       \"provTypes\" : jobProvTypes,\n  //       \"relations\":{\n  //         \"generatedBy\": jobId,\n  //         \"associatedWith\": flowId\n  //       }\n  //     }\n      \n  //     if (this.config.autoCommit)\n  //       resp = this._createRecord(provId, recordOpts, info.metadata);\n  //     else {\n  //       this.config.commitQueue.push([provId, recordOpts, info.metadata]);\n  //       resp = provId; // will commit later, _createRecord just returns provId\n  //     }\n  //   } else {\n  //     resp = isProvInfoMetaValid;\n  //   }\n\n  //   return resp;\n  // }\n  \n  // /**\n  //  * @desc Create a provenance record when a Flow is created\n  //  * @param flowId - the name of the flow (unique)\n  //  * @param {Object} info\n  //  * @param {string} info.status - the status of the flow: \n  //  *                               ie. created/updated/deleted.  \n  //  *                               Value is passed through to \"provTypes\".\n  //  * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n  //  */\n  // createFlowRecord(flowId, info) { \n  //   let resp;\n  //   let provId = this.hubutils.uuid();\n  //   let isProvInfoMetaValid = this._validProvInfoMetadata(info);\n\n  //   if (!(isProvInfoMetaValid instanceof Error)) {\n  //     let flowProvTypes = ['ps:Flow', 'dhf:Flow', 'dhf:Flow' + this.hubutils.capitalize(info.status)];\n  //     let recordOpts = {\n  //       \"provTypes\" : flowProvTypes,\n  //       \"relations\":{\n  //         \"associatedWith\": flowId\n  //       }\n  //     }\n  //     if (this.config.autoCommit)\n  //       resp = this._createRecord(provId, recordOpts, info.metadata);\n  //     else {\n  //       this.config.commitQueue.push([provId, recordOpts, info.metadata]);\n  //       resp = provId; // will commit later, _createRecord just returns provId\n  //     }\n  //   } else {\n  //     resp = isProvInfoMetaValid;\n  //   }\n\n  //   return resp;\n  // }\n\n  /**\n   * @desc Create a provenance record when a Flow is created\n   * @param docURI - The URI of the document\n   * @param {Object} [info]\n   * TODO: create more convenient ways to query\n   */\n  queryDocRecords(docURI, info) { \n    let resp;\n    if (docURI)\n      resp = xdmp.eval(`\n        const ps = require('/MarkLogic/provenance');\n        const op = require('/MarkLogic/optic');\n        var match = {\n          attributes: {\n            location: docURI\n          }\n        };\n        // TODO: change \"out\" so output for a single prov record is \n        // combined into a single Object in the Array\n        var out = {\n          dateTime: '?',\n          provTypes: '?',  \n          attributes : {'location' : '?'}\n        };\n        let kvPattern = ps.opTriplePattern(match, out);\n        op.fromTriples(kvPattern).result().toArray();  \n        `,\n        { docURI },\n        {\n          database: xdmp.database(this.config.JOBDATABASE),\n          commit: 'auto',\n          update: 'true',\n          ignoreAmps: true\n      })\n    else \n       resp = new Error(`Function requires param 'docURI' to be defined.`);\n    \n    return resp;\n  }\n\n\n  /**\n   * @desc Create a provenance record when a Flow is created\n   * @param docURI - The URI of the document\n   * @param {Object} [info]\n   * TODO: create more convenient ways to query\n   */\n  queryDocRecordsNoEval(docURI, info) { \n    let resp;\n    if (docURI) {\n      var match = {\n        attributes: {\n          location: docURI\n        }\n      };\n      // TODO: change \"out\" so output for a single prov record is \n      // combined into a single Object in the Array\n      var out = {\n        dateTime: '?',\n        provTypes: '?',  \n        attributes : {'location' : '?'}\n      };\n      let kvPattern = ps.opTriplePattern(match, out);\n      resp = op.fromTriples(kvPattern).result().toArray();  \n    }\n    else \n       resp = new Error(`Function requires param 'docURI' to be defined.`);\n    \n    return resp;\n  }  \n}\n\nmodule.exports = Provenance\n",
                "new_contents": "/**\n  Copyright 2012-2019 MarkLogic Corporation\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n'use strict';\nconst defaultConfig = require(\"/com.marklogic.hub/config.sjs\");\nconst ps = require('/MarkLogic/provenance');\nconst op = require('/MarkLogic/optic');\n\nclass Provenance {\n  /**\n   * @desc Provenance Class constructor\n   * @param {Object} [config] \n   * @param {string} [config.granularityLevel=coarse] - for setting the Prov object granularity level (currently unused)\n   */\n  constructor(config = null, datahub = null) {\n    this.OFF_LEVEL = 'off';\n    this.FINE_LEVEL = 'fine';\n    this.COARSE_LEVEL = 'coarse';\n    this.granularityLevels          = [this.FINE_LEVEL,this.COARSE_LEVEL];\n    this.config = {};\n    this.config.granularityLevel    = config && config.granularityLevel || 'coarse';\n    this.config.JOBDATABASE         = defaultConfig.JOBDATABASE || 'data-hub-JOBS';\n    this.config.autoCommit          = config && config.autoCommit !== undefined ? config.autoCommit : true;\n    this.config.commitQueue         = [];\n    if (datahub) {\n      this.hubutils = datahub.hubUtils;\n    } else {\n      this.hubutils = {\n        capitalize: (str) => { return (str) ? str.charAt(0).toUpperCase() + str.slice(1) : str; }\n      };\n    }\n  }\n\n  granularityLevel(level = null) {\n    if (level) {\n      this.config.granularityLevel = level;\n    }\n    return this.config.granularityLevel;\n  }\n\n  /**\n   * Get array of provTypes for a given step type for provenance record creation\n   * @param {string} stepDefinitionType - step definition type ['ingestion','mapping','mastering','custom']\n   */\n  _validStepDefinitionType(stepDefinitionType) {\n    return ['ingestion','mapping','mastering','custom'].includes(stepDefinitionType)\n  }\n  /**\n   * Validate that the info Object to ensure the metadata passed doesn't stomp on roles or location values\n   * @param {Object} info - object representing the information required to create prov info\n   */\n  _validProvInfoMetadata(info) {\n    let protectedAttributeProps = ['roles', 'roleNames', 'location'];\n    let isValid = info && info.metdata ? \n      info.metdata.every(val => !(protectedAttributeProps.includes(val))) :\n      true;  // safe, because no metadata\n    return isValid || Error(`The following metadata properties on \"info\" are not allowed: ${JSON.stringify(requiredInfoParams[stepType])}`);\n  }\n\n  /**\n   * Validate that the info Object\n   * @param {string} stepDefinitionType - step type ['ingestion','mapping','mastering','custom']\n   * @param {Object} info - object representing the information required to create prov info\n   */\n  _validProvInfoForStepType(stepDefinitionType, info) {\n    let requiredInfoParams = { \n      'ingestion': ['derivedFrom'],  // the entity, file or document URI that this ingested document was derived from\n      'mapping': ['derivedFrom','influencedBy'],\n      'mastering': ['derivedFrom','influencedBy'],\n      'custom': ['derivedFrom','influencedBy']\n    };\n    let provTypes = {\n      'ingestion': function () {\n        return requiredInfoParams['ingestion'].every(val => Object.keys(info).includes(val));\n      },\n      'mapping': function () {\n        return requiredInfoParams['mapping'].every(val => Object.keys(info).includes(val));\n      },\n      'mastering': function () {\n        return requiredInfoParams['mastering'].every(val => Object.keys(info).includes(val));\n      },\n      'custom': function () {\n        return requiredInfoParams['custom'].every(val => Object.keys(info).includes(val));\n      }\n    };\n    let isValid = provTypes[stepDefinitionType]();\n    return isValid || Error(`For Step Definition type ${stepDefinitionType}, the following properties on \"info\" are required: ${JSON.stringify(requiredInfoParams[stepDefinitionType])}`);\n  }\n\n  /**\n   * @desc Validate a provenance record params\n   * @param {string} [jobId] - the ID of the job being executed (unique), this will generate \n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} stepDefinitionType - the type of step definition within a flow ['ingestion','mapping','mastering','custom']\n   * @param {string} [docURI] - the URI of the document being modified by this step\n   * @param {Object} info\n   * @param {string} info.status - the status of the step: \n   *                               ie. created/updated/deleted.  \n   *                               Value is passed through to \"provTypes\".\n   * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n   */\n  _validateCreateStepParams(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, docURI, info) {\n    let isValid;\n    if (flowId && stepName && stepDefinitionName && stepDefinitionType && info) {\n      // check step type valid\n      if (this._validStepDefinitionType(stepDefinitionType)) {\n        let isProvInfoForStepTypeValid = (jobId) ? this._validProvInfoForStepType(stepDefinitionType, info) : true;\n        let isProvInfoMetaValid = this._validProvInfoMetadata(info);\n        // check prov info valid per type passed\n        let hasError = isProvInfoForStepTypeValid instanceof Error || isProvInfoMetaValid instanceof Error;\n        if (!hasError) {\n          // function params are valid\n          isValid = true;\n        } else {\n          // return Error that relates to prov info object\n          isValid = (isProvInfoForStepTypeValid instanceof Error) ? isProvInfoForStepTypeValid : isProvInfoMetaValid;  \n        }\n      } else {\n        isValid = new Error(`Step type ${stepDefinitionType} not defined.  Must be of type: 'ingestion','mapping','mastering','custom'.`);\n      }\n    } else {\n      let missingParams = [\n        ['flowId',flowId],\n        ['stepName',stepName],\n        ['stepDefinitionName',stepDefinitionName],\n        ['stepDefinitionType',stepDefinitionType],\n        ['info', info]\n      ].filter((pair) => !pair[1])\n        .reduce((pair) => pair[0]);\n      isValid = new Error(`Function requires all params 'flowId', 'stepName', 'stepDefinitionName', 'stepDefinitionType' and 'info' to be defined. Missing: ${missingParams.join(', ')}`);\n    }\n    return isValid;\n  }  \n\n  /**\n   * General create provenance record function that adds the same relations, \n   * attributes, dateTime & namespaces info each record requires.\n   * @param {string} id - the identifier of this provenance information\n   * @param {Object} options - provenance record options (see individual type requirements below)\n   * @param {Object} metadata - provenance record metadata\n   */\n  _createRecord(id, options, metadata) {\n    this._createRecords([{id, options, metadata}]);\n    return id;\n  }\n\n  /**\n   * General create provenance record function that adds the same relations,\n   * attributes, dateTime & namespaces info each record requires.\n   * @param {Array} recordsQueue - array of objects with identifier of this provenance information, options, and metadata\n   */\n  _createRecords(recordsQueue) {\n    xdmp.eval(`\n      const ps = require('/MarkLogic/provenance');\n      xdmp.securityAssert(\"http://marklogic.com/xdmp/privileges/ps-user\", \"execute\");\n      \n      for (let recordDetails of recordsQueue) {\n        let options = recordDetails.options || {};\n        options.dateTime = String(fn.currentDateTime());\n        options.namespaces = { \"dhf\":\"http://marklogic.com/dhf\" }; // for user defined provenance types\n\n        // relations\n        options.relations = options.relations || {};\n        options.relations.attributedTo = xdmp.getCurrentUser();\n\n        // attributes\n        options.attributes = options.attributes || {};\n        options.attributes.roles = xdmp.getCurrentRoles().toArray().join(',');\n        options.attributes.roleNames = xdmp.getCurrentRoles().toArray().map((r) => xdmp.roleName(r)).join(',');\n\n        let metadata = recordDetails.metadata || {};\n        if (metadata)\n            Object.assign(options.attributes, metadata)\n\n        let record = ps.provenanceRecord(recordDetails.id, options);\n        ps.provenanceRecordInsert(record);\n       }\n      `,\n      { recordsQueue },\n      {\n        database: xdmp.database(this.config.JOBDATABASE),\n        commit: 'auto',\n        update: 'true',\n        ignoreAmps: true\n      });\n    return recordsQueue.map((recordDetails) => recordDetails.id);\n  };\n\n  /**\n   * General function for adding to the commit queue\n   * @param {string} id - the identifier of this provenance information\n   * @param {Object} options - provenance record options (see individual type requirements below)\n   * @param {Object} metadata - provenance record metadata\n   */\n  _queueForCommit(id, options, metadata) {\n    let existingForId = this.config.commitQueue.find((recordDetails) => recordDetails.id === id);\n    if (existingForId) {\n      Object.assign(existingForId, {id, options, metadata});\n    } else {\n      this.config.commitQueue.push({id, options, metadata});\n    }\n  };\n\n  /**\n   * @desc Create a provenance record when a document is run through an ingestion step\n   * @param {string} jobId - the ID of the job being executed (unique), this will generate \n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} docURI - the URI of the document being modified by this step\n   * @param {Object} info\n   * @param {string} info.derivedFrom - the entity, file or document URI that this ingested document was derived from\n   * @param {string} info.influencedBy - the ingestion step the document was modified by\n   * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n   *   Ingest document from outside source\n   *    provTypes: [ \"ps:Flow\", \"ps:File\" ],\n   *    relations: \n   *      - generatedBy (job id)\n   *      - derivedFrom (file)\n   *      - derivedFrom (uri)\n   *      - influencedBy (mapping)\n   *      - associatedWith [flow id, step name, step definition name]\n   *    attributes:\n   *      - location (doc URI)\n   */\n  _createIngestionStepRecord(jobId, flowId, stepName, stepDefinitionName, docURI, info) {\n    let provId = `${jobId + flowId + 'ingestion' + docURI}`;\n    let provTypes = ['ps:Flow','ps:Entity','dhf:Entity','dhf:IngestionStep','dhf:IngestionStepEntity'];\n    if (info && info.status)\n      provTypes.push('dhf:Doc' + this.hubutils.capitalize(info.status));\n\n    let recordOpts = {\n      provTypes,\n      relations: {\n        associatedWith: [flowId, stepName, stepDefinitionName],\n        generatedBy: jobId,\n        derivedFrom: info && info.derivedFrom,\n      },\n      attributes: { location: docURI }\n    };\n\n    return (this.config.autoCommit) ? \n      this._createRecord(provId, recordOpts, info.metadata) : \n      this._queueForCommit(provId, recordOpts, info.metadata);\n  }\n\n  /**\n   * @desc Create a provenance record when a document is run through a mapping step\n   * @param {string} jobId - the ID of the job being executed (unique), this will generate\n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} [docURI] - the URI of the document being modified by this step\n   * @param {Object} info\n   * @param {string} info.derivedFrom - the entity, file or document URI that this ingested document was derived from\n   * @param {string} info.influencedBy - the mapping step the document was modified by\n   * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n   *   Map Source document property to Entity Instance property\n   *    provTypes: [ \"ps:Flow\", \"ps:EntityProperty\", \"ps:Mapping\", \"dhf:ModelToModelMapping\" ],\n   *    relations:\n   *      - generatedBy (job id)\n   *      - derivedFrom (uri)\n   *      - derivedFrom (array of uris) - not supported in current QuickStart\n   *      - influencedBy (mapping)\n   *      - influencedBy (component [aka. custom code])\n   *      - associatedWith [flow id, step name, step definition name]\n   *    attributes:\n   *      - location (doc URI)\n   */\n  _createMappingStepRecord(jobId, flowId, stepName, stepDefinitionName, docURI, info) {\n    let provId = `${jobId + flowId + 'mapping' + docURI}`;\n    let provTypes = ['ps:Flow','ps:Entity','dhf:Entity','dhf:MappingStep','dhf:MappingStepEntity'];\n    if (info && info.status)\n      provTypes.push('dhf:Doc' + this.hubutils.capitalize(info.status));\n\n    let recordOpts = {\n      provTypes,\n      relations: {\n        associatedWith: [flowId, stepName, stepDefinitionName],\n        generatedBy: jobId,\n        derivedFrom: info && info.derivedFrom,\n        influencedBy: info && info.influencedBy,\n      },\n      attributes: { location: docURI }\n    };\n\n    return (this.config.autoCommit) ? \n      this._createRecord(provId, recordOpts, info.metadata) : \n      this._queueForCommit(provId, recordOpts, info.metadata);\n  }\n\n  /**\n   * @desc Create a provenance record when a document is run through a mastering step\n   * @param {string} jobId - the ID of the job being executed (unique), this will generate\n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} [docURI] - the URI of the document being modified by this step\n   * @param {Object} info\n   * @param {string} info.derivedFrom - the entity, file or document URI that this ingested document was derived from\n   * @param {string} info.influencedBy - the mastering step the document was modified by\n   * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n   *   Master Source doc property to Entity Instance property\n   *    provTypes: [ \"ps:Flow\", \"ps:EntityProperty\", \"dhf:Mastering\" ],\n   *    relations:\n   *      - generatedBy (job id)\n   *      - derivedFrom (uri)\n   *      - derivedFrom (array of uris)\n   *      - influencedBy (mastering)\n   *      - influencedBy (component [aka. custom code])\n   *      - associatedWith [flow id, step name, step definition name]\n   *    attributes:\n   *      - location (doc URI)\n   */\n  _createMasteringStepRecord(jobId, flowId, stepName, stepDefinitionName, docURI, info) {\n    let provId = `${jobId + flowId + 'mastering' + docURI}`;\n    let provTypes = ['ps:Flow','ps:Entity','dhf:Entity','dhf:MasteringStep','dhf:MasteringStepEntity'];\n    if (info && info.status)\n      provTypes.push('dhf:Doc' + this.hubutils.capitalize(info.status));\n\n    let recordOpts = {\n      provTypes,\n      relations: {\n        associatedWith: [flowId, stepName, stepDefinitionName],\n        generatedBy: jobId,\n        derivedFrom: info && info.derivedFrom,\n        influencedBy: info && info.influencedBy,\n      },\n      attributes: { location: docURI }\n    };\n\n    return (this.config.autoCommit) ? \n      this._createRecord(provId, recordOpts, info.metadata) : \n      this._queueForCommit(provId, recordOpts, info.metadata);\n  }\n\n  /**\n   * @desc Create a provenance record when a document is run through a custom step\n   * @param {string} jobId - the ID of the job being executed (unique), this will generate\n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} [docURI] - the URI of the document being modified by this step\n   * @param {Object} info\n   * @param {string} info.derivedFrom - the entity, file or document URI that this ingested document was derived from\n   * @param {string} info.influencedBy - the custom step the document was modified by\n   * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n   * Custom code transformations of source doc (prior to mapping/mastering) or Entity Instance (after mapping/mastering)\n   *  provTypes: [ \"ps:Flow\", \"ps:Entity\", \"dhf:Custom\" ],\n   *  relations:\n   *    - generatedBy (job id)\n   *    - derivedFrom (uri)\n   *    - derivedFrom (array of uris)\n   *    - influencedBy (component [aka. custom code])\n   *    - associatedWith [flow id, step name, step definition name]\n   *  attributes:\n   *    - location (doc URI)\n   */\n  _createCustomStepRecord(jobId, flowId, stepName, stepDefinitionName, docURI, info) {\n    let provId = `${jobId + flowId + 'custom' + docURI}`;\n    let provTypes = ['ps:Flow','ps:Entity','dhf:Entity','dhf:CustomStep','dhf:CustomStepEntity'];\n    if (info && info.status)\n      provTypes.push('dhf:Doc' + this.hubutils.capitalize(info.status));\n    \n    let recordOpts = {\n      provTypes,\n      relations: {\n        associatedWith: [flowId, stepName, stepDefinitionName],\n        generatedBy: jobId,\n        derivedFrom: info && info.derivedFrom,\n        influencedBy: info && info.influencedBy,\n      },\n      attributes: { location: docURI }\n    };\n\n    return (this.config.autoCommit) ? \n      this._createRecord(provId, recordOpts, info.metadata) : \n      this._queueForCommit(provId, recordOpts, info.metadata);\n  }\n\n  /**\n   * @desc Create a provenance record when a document is run through a Flow step\n   * @param {string} [jobId] - the ID of the job being executed (unique), this will generate \n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} stepDefinitionType - the type of step definition within a flow ['ingestion','mapping','mastering','custom']\n   * @param {string} [docURI] - the URI of the document being modified by this step\n   * @param {Object} info\n   * @param {string} info.status - the status of the step: \n   *                               ie. created/updated/deleted.  \n   *                               Value is passed through to \"provTypes\".\n   * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n   */\n  createStepRecord(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, docURI, info) {\n    let resp;\n    let isValid = this._validateCreateStepParams(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, docURI, info);\n    if (!(isValid instanceof Error)) {\n      let capitalizedStepType = this.hubutils.capitalize(stepDefinitionType);\n      resp = this['_create' + capitalizedStepType + 'StepRecord'](jobId, flowId, stepName, stepDefinitionName, docURI, info);\n    } else {\n      resp = isValid\n    }\n    return resp;\n  }\n\n  /**\n   * @desc Create a provenance record for a documents properties.  These records will be used to record property merges.\n   * @param {string} jobId - the ID of the job being executed (unique), this will generate \n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} stepDefinitionType - the type of step definition within a flow ['ingestion','mapping','mastering','custom']\n   * @param {string} [docURI] - the URI of the document being modified by this step\n   * @param {string} docURI - the URI of the document being processed by this step\n   * @param {Array}  properties - the properties of the document being processed by this step\n   * @param {Object} info\n   * @param {string} info.influencedBy - the Step ID assoicated this record\n   * @return {Array} Document Prov ID, Document Prov IDs for properties as an Object of \n   *                  key/value pairs mapping property names to their provenance IDs, \n   *                  for use with follow-up createStepPropertyMergeRecords() call\n   */\n  createStepPropertyRecords(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, docURI, properties, info) {\n    let resp;\n    let docProvId;\n    let docPropertyProvIds = {};\n    let docPropertyProvIdsArray = [];\n    let isValid = this._validateCreateStepParams(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, docURI, info);\n    if (!(isValid instanceof Error)) {\n      if (properties && properties.length > 0) {\n        let capitalizedStepType = this.hubutils.capitalize(stepDefinitionType);\n        for (let i=0; i<properties.length; i++) {\n          let property = properties[i];\n          let encodedPropertyName = property;\n          if (!xdmp.castableAs(\"http://www.w3.org/2001/XMLSchema\", \"QName\", encodedPropertyName)) {\n            encodedPropertyName = xdmp.encodeForNCName(encodedPropertyName);\n          }\n          let docPropProvId = `${jobId + flowId + stepDefinitionType + docURI}_${property}`\n          let docPropProvOptions = {\n            provTypes: [ 'ps:Flow', 'ps:EntityProperty', `dhf:${capitalizedStepType}`, 'dhf:EntityProperty', encodedPropertyName ],\n            relations: {\n              associatedWith: [flowId, stepName, stepDefinitionName],\n              generatedBy: jobId,\n              influencedBy: info && info.influencedBy,\n            },\n            attributes: { location: docURI }        \n          };\n          // append to return Object  \n          docPropertyProvIds[property] = docPropProvId; \n          docPropertyProvIdsArray.push(docPropProvId);\n          (this.config.autoCommit) ? \n            this._createRecord(docPropProvId, docPropProvOptions, info.metadata) : \n            this._queueForCommit(docPropProvId, docPropProvOptions, info.metadata);\n        }\n\n        // create document record\n        docProvId = `${jobId + flowId + stepDefinitionType + docURI}`;\n        let provTypes = ['ps:Flow','ps:Entity','dhf:Entity',`dhf:${capitalizedStepType}Entity`];\n        let recordOpts = {\n          provTypes,\n          relations: {\n            associatedWith: [flowId, stepName, stepDefinitionName],\n            generatedBy: jobId,\n            hadMember: docPropertyProvIdsArray,\n            influencedBy: info && info.influencedBy,\n          },\n          attributes: { location: docURI }\n        };\n\n        (this.config.autoCommit) ? \n          this._createRecord(docProvId, recordOpts, info.metadata) : \n          this._queueForCommit(docProvId, recordOpts, info.metadata);\n\n        // construct response\n        resp = [docProvId, docPropertyProvIds];\n      } else {\n        resp = new Error(`Function requires param 'properties' to be defined.`);\n      }\n    } else {\n      resp = isValid\n    }\n    return resp;\n  }  \n\n  /**\n   * @desc Create a provenance for altered property record for multiple property records\n   * @param {string} jobId - the ID of the job being executed (unique), this will generate \n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} stepDefinitionType - the type of step definition within a flow ['ingestion','mapping','mastering','custom']\n   * @param {string} propertyName - the name of the property being merged\n   * @param {Array}  docURIs - the URIs of the documents associated with this merge\n   * @param {Array}  propertyProvIds - the provenance record ids of the properties being merged by this step\n   * @param {Object} info\n   * @param {string} info.influencedBy - the Step ID assoicated this record\n   * @return {Object} key/value pairs mapping property names to their provenance IDs, \n   *                  for use with follow-up createStepPropertyAlterationRecords() call\n   */\n  createStepPropertyAlterationRecord(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, propertyName, docURIs, propertyProvIds, info) {\n    let resp = [];\n    let isValid = this._validateCreateStepParams(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, docURIs, info);\n    let activity = 'altered';\n    if (stepDefinitionType === 'mapping') {\n      activity = 'mapped';\n    } else if (stepDefinitionType === 'mastering') {\n      activity = 'merged';\n    }\n    if (!(isValid instanceof Error)) {\n      if (docURIs && docURIs.length > 0 &&\n        propertyProvIds && propertyProvIds.length > 0) {\n        let capitalizedStepType = this.hubutils.capitalize(stepDefinitionType);\n        let provId = `${jobId + flowId + stepDefinitionType + docURIs.concat()}_${propertyName}_${activity}`;\n        let encodedPropertyName = propertyName;\n        if (!xdmp.castableAs(\"http://www.w3.org/2001/XMLSchema\", \"QName\", encodedPropertyName)) {\n          encodedPropertyName = xdmp.encodeForNCName(encodedPropertyName);\n        }\n        let provTypes = ['ps:Flow','ps:Entity','dhf:AlteredEntityProperty',`dhf:${capitalizedStepType}AlteredEntityProperty`, encodedPropertyName];\n        let recordOpts = {\n          provTypes,\n          relations: {\n            associatedWith: [flowId, stepName, stepDefinitionName],\n            generatedBy: jobId,\n            derivedFrom: propertyProvIds,\n            influencedBy: info && info.influencedBy,\n          }\n        };\n        (this.config.autoCommit) ? \n          this._createRecord(provId, recordOpts, info.metadata) : \n          this._queueForCommit(provId, recordOpts, info.metadata);\n\n        resp = provId;\n      } else {\n        resp = new Error(`Function requires param 'docURIs' & 'propertyProvIds' to be defined.`);\n      }\n    } else {\n      resp = isValid\n    }\n    return resp;\n  }\n\n  /**\n   * @desc Create a provenance alteration record for multiple property records\n   * @param {string} jobId - the ID of the job being executed (unique), this will generate \n   * @param {string} flowId - the unique ID of the flow\n   * @param {string} stepName - the name of the step within a flow\n   * @param {string} stepDefinitionName - the name of step definition within a flow\n   * @param {string} stepDefinitionType - the type of step definition within a flow ['ingestion','mapping','mastering','custom']\n   * @param {Array}  docURI - the new URI of the document created after the merge\n   * @param {Array}  propertyProvIds - the provenance record ids of the properties being altered by this step\n   * @param {Object} info\n   * @param {string} info.influencedBy - the Step ID assoicated this record\n   * @return {Object} key/value pairs mapping property names to their provenance IDs, \n   *                  for use with follow-up createStepDocumentAlterationRecords() call\n   */\n  createStepDocumentAlterationRecord(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, newDocURI, documentProvIds, alteredPropertyProvIds, info) {\n    let resp = [];\n    let isValid = this._validateCreateStepParams(jobId, flowId, stepName, stepDefinitionName, stepDefinitionType, documentProvIds, info);\n    if (!(isValid instanceof Error)) { \n      if (documentProvIds && documentProvIds.length > 0 &&\n        alteredPropertyProvIds && alteredPropertyProvIds.length > 0) {\n        let capitalizedStepType = this.hubutils.capitalize(stepDefinitionType);\n        let provId = `${jobId + flowId + stepDefinitionType + newDocURI}`;\n        let provTypes = ['ps:Flow','ps:Entity','dhf:AlteredEntity',`dhf:${capitalizedStepType}AlteredEntity`];\n        let recordOpts = {\n          provTypes,\n          relations: {\n            associatedWith: [flowId, stepName, stepDefinitionName],\n            generatedBy: jobId,\n            derivedFrom: documentProvIds,\n            hadMember: alteredPropertyProvIds,\n            influencedBy: info && info.influencedBy,\n          },\n          attributes: { location: newDocURI }\n        };\n        (this.config.autoCommit) ? \n          this._createRecord(provId, recordOpts, info.metadata) : \n          this._queueForCommit(provId, recordOpts, info.metadata);\n        resp = provId;\n      } else {\n        resp = new Error(`Function requires param 'documentProvIds' & 'alteredPropertyProvIds' to be defined.`);\n      }\n    } else {\n      resp = isValid\n    }\n    return resp;\n  }\n\n  /**\n   * @desc Commit all queued Provenance records.  Only works if config.autoCommit === false\n   *       and records are being saved, rather than committed instantly.\n   */\n  commit() { \n    if (this.config.autoCommit === false && this.config.commitQueue.length > 0) {\n      this._createRecords(this.config.commitQueue);\n      this.config.commitQueue = [];\n    }\n  }\n\n  /**\n   * @desc Discard all queued Provenance records.  Only works if config.autoCommit === false\n   *       and records are being saved, rather than committed instantly.\n   */\n  discard() { \n    if (this.config.autoCommit === false && this.config.commitQueue.length > 0) {\n      this.config.commitQueue = [];\n    }\n  }\n\n  // /**\n  //  * @desc Create a provenance record when a Job is created immediately executed\n  //  * @param {string} jobId - the ID of the job being executed (unique), this will generate \n  //  * @param {string} flowId - the unique ID of the flow\n  //  * @param {Object} info\n  //  * @param {string} info.status - the status of the job: \n  //  *                               ie. created/updated/deleted.  \n  //  *                               Value is passed through to \"provTypes\".\n  //  * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n  //  */\n  // createJobRecord(jobId, flowId, info) {\n  //   let resp;\n  //   let provId = this.hubutils.uuid();\n  //   let isProvInfoMetaValid = this._validProvInfoMetadata(info);\n\n  //   if (!(isProvInfoMetaValid instanceof Error)) {\n  //     let jobProvTypes = (info.status === 'started') ?\n  //       ['ps:FlowRun', 'dhf:Job', 'dhf:Job' + this.hubutils.capitalize(info.status)] :\n  //       ['ps:Flow', 'dhf:Job', 'dhf:Job' + this.hubutils.capitalize(info.status)];\n  //     let recordOpts = {\n  //       \"provTypes\" : jobProvTypes,\n  //       \"relations\":{\n  //         \"generatedBy\": jobId,\n  //         \"associatedWith\": flowId\n  //       }\n  //     }\n      \n  //     if (this.config.autoCommit)\n  //       resp = this._createRecord(provId, recordOpts, info.metadata);\n  //     else {\n  //       this._queueForCommit(provId, recordOpts, info.metadata);\n  //       resp = provId; // will commit later, _createRecord just returns provId\n  //     }\n  //   } else {\n  //     resp = isProvInfoMetaValid;\n  //   }\n\n  //   return resp;\n  // }\n  \n  // /**\n  //  * @desc Create a provenance record when a Flow is created\n  //  * @param flowId - the name of the flow (unique)\n  //  * @param {Object} info\n  //  * @param {string} info.status - the status of the flow: \n  //  *                               ie. created/updated/deleted.  \n  //  *                               Value is passed through to \"provTypes\".\n  //  * @param {string} [info.metadata] - key/value pairs to document with the provenance record\n  //  */\n  // createFlowRecord(flowId, info) { \n  //   let resp;\n  //   let provId = this.hubutils.uuid();\n  //   let isProvInfoMetaValid = this._validProvInfoMetadata(info);\n\n  //   if (!(isProvInfoMetaValid instanceof Error)) {\n  //     let flowProvTypes = ['ps:Flow', 'dhf:Flow', 'dhf:Flow' + this.hubutils.capitalize(info.status)];\n  //     let recordOpts = {\n  //       \"provTypes\" : flowProvTypes,\n  //       \"relations\":{\n  //         \"associatedWith\": flowId\n  //       }\n  //     }\n  //     if (this.config.autoCommit)\n  //       resp = this._createRecord(provId, recordOpts, info.metadata);\n  //     else {\n  //       this._queueForCommit(provId, recordOpts, info.metadata);\n  //       resp = provId; // will commit later, _createRecord just returns provId\n  //     }\n  //   } else {\n  //     resp = isProvInfoMetaValid;\n  //   }\n\n  //   return resp;\n  // }\n\n  /**\n   * @desc Create a provenance record when a Flow is created\n   * @param docURI - The URI of the document\n   * @param {Object} [info]\n   * TODO: create more convenient ways to query\n   */\n  queryDocRecords(docURI, info) { \n    let resp;\n    if (docURI)\n      resp = xdmp.eval(`\n        const ps = require('/MarkLogic/provenance');\n        const op = require('/MarkLogic/optic');\n        var match = {\n          attributes: {\n            location: docURI\n          }\n        };\n        // TODO: change \"out\" so output for a single prov record is \n        // combined into a single Object in the Array\n        var out = {\n          dateTime: '?',\n          provTypes: '?',  \n          attributes : {'location' : '?'}\n        };\n        let kvPattern = ps.opTriplePattern(match, out);\n        op.fromTriples(kvPattern).result().toArray();  \n        `,\n        { docURI },\n        {\n          database: xdmp.database(this.config.JOBDATABASE),\n          commit: 'auto',\n          update: 'true',\n          ignoreAmps: true\n      })\n    else \n       resp = new Error(`Function requires param 'docURI' to be defined.`);\n    \n    return resp;\n  }\n\n\n  /**\n   * @desc Create a provenance record when a Flow is created\n   * @param docURI - The URI of the document\n   * @param {Object} [info]\n   * TODO: create more convenient ways to query\n   */\n  queryDocRecordsNoEval(docURI, info) { \n    let resp;\n    if (docURI) {\n      var match = {\n        attributes: {\n          location: docURI\n        }\n      };\n      // TODO: change \"out\" so output for a single prov record is \n      // combined into a single Object in the Array\n      var out = {\n        dateTime: '?',\n        provTypes: '?',  \n        attributes : {'location' : '?'}\n      };\n      let kvPattern = ps.opTriplePattern(match, out);\n      resp = op.fromTriples(kvPattern).result().toArray();  \n    }\n    else \n       resp = new Error(`Function requires param 'docURI' to be defined.`);\n    \n    return resp;\n  }  \n}\n\nmodule.exports = Provenance\n",
                "subject": "DHFPROD-1982: Performance changes for PROV commit",
                "message": "DHFPROD-1982: Performance changes for PROV commit\n",
                "lang": "JavaScript",
                "license": "apache-2.0",
                "repos": "marklogic/data-hub-in-a-box,marklogic/data-hub-in-a-box,marklogic/data-hub-in-a-box,marklogic/data-hub-in-a-box"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10213,
            "row": {
                "commit": "909a4351a4082110324aa53f951e72c1e623f91c",
                "old_file": "jquery.geolocator.js",
                "new_file": "jquery.geolocator.js",
                "old_contents": "(function($, window, document, undefined){\n\t'use strict';\n\n\t/*jshint eqnull: true */\n\n\t// plugin name, used with $.data\n\tvar pluginName = 'jquery-geolocator',\n\n\t// Default settings / how to read these settings:\n\t// Setting name | setting default value | setting type (Boolean/Number/String) | setting instructions\n\tdefaultSettings = {\n\t\tmanualCheck:        false, // Boolean - Set to true if you want your visitor to be able to manually check geolocation.\n\t\tsorting:            true, // Boolean - Set to false if you don't want to sort addresses by distance.\n\t\tdebugMode:          false, // Boolean - Set to true to enable error debugging (only works in browsers that have window.console).\n\t\tenableHighAccuracy: false, //Boolean - Setting for HTML5 geolocation \"enableHighAccuracy\". Setting to true locating takes longer but is more accurate.\n\t\ttimeout:            6000, // Number - Setting for HTML5 geolocation \"timeout\". Default: times out in 6 seconds.\n\t\tmaximumAge:         60000, // Number - Setting for HTML geolocation \"maximunAge\". Default: don't re-get geolocation if it is less than 1min old.\n\t\tapiKey:             null, // String - Google API key for loading Google JS API & Maps API\n\t\tlocationsElem:      null, // String - This is the container element for your address list(s) (e.g. #locations)\n\t\tgeodataElem:        '#geodata', // String - Element for displaying visitors current location. This element should be unique for each instance.\n\t\trecheckElem:        '#recheck', // String - Element for enabling re-checking of distances. this element should be unique for each instance.\n\t\tcheckElem:          '#check', // String - Element to use to check distances if \"manualCheck\" is enabled. This element should be unique for each instance.\n\t\tnotificationElem:   '.notification', // String - Notification element (e.g. \"Getting geolocation...\")\n\t\tdistanceElem:       '.distance', // String - Element which shows the distance of each address\n\t\tgeoAdrElem:         '.adr', // String - Microformats hcard .adr element that has address data inside it\n\t\tmapsLinkElem:       '.maps-link', // String - Class for Google Maps link element\n\t\tlistParentElem:     'ul', // String - Container element for list items (e.g. ul, ol or div).\n\t\tlistElem:           'li', // String - List item element (e.g. li or span)\n\t\tnotificationStyle:  'show', // String - Notification display style. Options: 'fade', 'slide' or 'show'.\n\t\tdistanceBigStr:     'miles', // String - Default string for distance is in miles, changes to kilometers if set to anything else\n\t\tdistanceSmallStr:   'meters', // String - Default string for meters, change to your own language if needed\n\t\tdistanceUnknownStr: 'unknown', // String - Default string for unknown distance, change to your own language if needed\n\t\tnotFoundStr:        'Could not get your location', // String - Default string for own location not found\n\t\tmapsLinkStr:        'Show directions' // String - Default string for Google Maps link text\n\t};\n\n\tfunction GeoLocator(element, settings) {\n\t\tthis.settings          = settings;\n\t\tthis.el                = settings.locationsElem || element;\n\t\tthis.addressArr        = []; // array for holding address lists\n\t\tthis.$el               = $(this.el); // element that has all location data\n\t\tthis.$recheckElem      = $(settings.recheckElem);\n\t\tthis.$checkElem        = $(settings.checkElem);\n\t\tthis.$notificationElem = $(settings.notificationElem);\n\t\tthis.$geodataElem      = $(settings.geodataElem);\n\n\t\tthis.prepare();\n\n\t\treturn this;\n\t}\n\n\tGeoLocator.prototype = {\n\n\t\tconstructor: GeoLocator,\n\n\t\tprepare: function() {\n\t\t\tvar self = this,\n\t\t\tsettings = self.settings,\n\t\t\t$checkElem = self.$checkElem;\n\n\t\t\t// reset and query the DOM\n\n\t\t\tself.$lists            = self.$el.children(settings.listParentElem); // re-select lists\n\t\t\tself.listLength        = self.$lists.children(settings.listElem).length; // re-select total length of list items\n\t\t\tself.ownLatLng         = null;\n\t\t\tself.tCount            = 0; // Geolocation timeout counter\n\t\t\tself.lCount            = 0; // List item counter\n\t\t\tthis.html5Geo          = false;\n\t\t\tself.addressArr.length = 0; // make sure the address list array is empty\n\n\t\t\t// Bind a click handler if manual check is enabled\n\t\t\t// or initialize the plugin\n\n\t\t\tif ( settings.manualCheck && $checkElem.length ) {\n\t\t\t\t$checkElem.show().click(function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tself.init();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tself.init();\n\t\t\t}\n\t\t},\n\n\t\tinit: function() {\n\t\t\tvar self = this,\n\t\t\tgoogle = window.google,\n\t\t\t$notificationElem = self.$notificationElem,\n\t\t\t$recheckElem = self.$recheckElem,\n\t\t\tnotificationStyle = self.settings.notificationStyle;\n\n\t\t\t// Check if google is defined, if not, load google API\n\n\t\t\tif ( typeof google === 'undefined' || typeof google.load === 'undefined' || typeof google.maps === 'undefined' ) {\n\t\t\t\t// load google API and return\n\t\t\t\tself.loadGoogleAPI();\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\t// google API is loaded\n\t\t\t\tself.google = google;\n\t\t\t\tself.googleMaps = google.maps;\n\n\t\t\t\t// Show notification element\n\n\t\t\t\tif ( $notificationElem.length && !$notificationElem.is(':visible') ) {\n\t\t\t\t\tif ( notificationStyle === 'fade' ) {\n\t\t\t\t\t\t$notificationElem.fadeIn(300);\n\t\t\t\t\t} else if ( notificationStyle === 'slide' ) {\n\t\t\t\t\t\t$notificationElem.slideDown(300);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$notificationElem.show();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Hide recheck element\n\n\t\t\t\tif ( $recheckElem.length && $recheckElem.is(':visible') ) {\n\t\t\t\t\t$recheckElem.unbind('click').hide();\n\t\t\t\t}\n\n\t\t\t\t// call getGeolocation\n\t\t\t\tself.getGeolocation();\n\t\t\t}\n\n\t\t},\n\n\t\tloadGoogleAPI: function() {\n\t\t\tvar self = this,\n\t\t\tgoogle = window.google;\n\n\t\t\t// if google is already there but maps isn't, load Google Maps API v3 and return\n\t\t\tif ( typeof google !== 'undefined' && typeof google.load !== 'undefined' && typeof google.maps === 'undefined' ) {\n\t\t\t\tgoogle.load('maps', '3', { 'other_params': 'sensor=true', 'callback': function() {\n\t\t\t\t\tself.init();\n\t\t\t\t}});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Load Google JS API\n\t\t\t$.getScript('http://www.google.com/jsapi?key=' + self.settings.apiKey)\n\t\t\t.done(function() {\n\t\t\t\tself.init();\n\t\t\t})\n\t\t\t.fail(function(jqxhr, settings, exception) {\n\t\t\t\tself.debug(exception, 1);\n\t\t\t});\n\n\t\t},\n\n\t\tgetGeolocation: function() {\n\t\t\tvar self = this,\n\t\t\tsettings = self.settings,\n\t\t\t$geodataElem = self.$geodataElem,\n\t\t\tgeolocation = window.navigator.geolocation,\n\t\t\tgoogleMaps = self.googleMaps,\n\t\t\tgoogleLoader = self.google.loader,\n\t\t\tgoogleClientLoc = googleLoader.ClientLocation,\n\t\t\tgoogleLatitude = null,\n\t\t\tgoogleLongitude = null,\n\t\t\tgeoTimeout = null,\n\t\t\townLocation = null;\n\n\t\t\tif ( googleClientLoc != null ) {\n\t\t\t\tgoogleLatitude = googleClientLoc.latitude;\n\t\t\t\tgoogleLongitude = googleClientLoc.longitude;\n\t\t\t}\n\n\t\t\t// check that current timeout count is 0\n\t\t\t// timeout geolocation request, fallback on google.loader.ClientLocation\n\t\t\tif ( !self.tCount ) {\n\n\t\t\t\tgeoTimeout = window.setTimeout(function() {\n\t\t\t\t\tself.tCount++;\n\t\t\t\t\tself.getGeolocation();\n\t\t\t\t}, 500);\n\t\t\t}\n\n\t\t\t// try to get HTML5 Geolocation - fallback on google.loader.ClientLocation\n\t\t\tif ( !self.tCount && geolocation ) {\n\n\t\t\t\tgeolocation.getCurrentPosition(function(position) {\n\t\t\t\t\tvar positionCoords = position.coords,\n\t\t\t\t\t\tHTML5Latitude = positionCoords.latitude,\n\t\t\t\t\t\tHTML5Longitude = positionCoords.longitude;\n\n\t\t\t\t\tif ( position && positionCoords != null ) {\n\n\t\t\t\t\t\t// successful with Geolocation coords so\n\t\t\t\t\t\t// make sure that everything else is canceled\n\t\t\t\t\t\tself.html5Geo = true;\n\t\t\t\t\t\twindow.clearTimeout(geoTimeout);\n\n\t\t\t\t\t\t// visitor's current location lat & lng\n\t\t\t\t\t\townLocation = new googleMaps.LatLng(HTML5Latitude, HTML5Longitude);\n\n\t\t\t\t\t\tself.ownLatLng = HTML5Latitude + ', ' + HTML5Longitude;\n\n\t\t\t\t\t\t// update own location and lists with lat & lng from HTML5 Geolocation API\n\t\t\t\t\t\tself.updateOwnLocation(ownLocation);\n\t\t\t\t\t\tself.loopAddressLists(ownLocation);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t}, function(error) {\n\t\t\t\t\t// Error handler for HTML5 Geolocation API\n\t\t\t\t\tself.geolocationError(error);\n\t\t\t\t}, {\n\t\t\t\t\t// Settings for HTML5 Geolocation API\n\t\t\t\t\tmaximumAge: settings.maximumAge,\n\t\t\t\t\ttimeout: settings.timeout,\n\t\t\t\t\tenableHighAccuracy: settings.enableHighAccuracy\n\t\t\t\t});\n\n\t\t\t} else if ( self.tCount < 2 && !self.html5Geo ) {\n\n\t\t\t\t// HTML5 Geolocation API did not respond fast enough, so make sure that\n\t\t\t\t// we have Google's IP address based location specified\n\t\t\t\t// and update own location and lists with Google's lat & lng\n\t\t\t\tif ( typeof self.google === 'object' && googleLoader != null && googleClientLoc != null ) {\n\n\t\t\t\t\t// visitor's current location lat & lng\n\t\t\t\t\townLocation = new googleMaps.LatLng(googleLatitude, googleLongitude);\n\n\t\t\t\t\tself.ownLatLng = googleLatitude + ', ' + googleLongitude;\n\n\t\t\t\t\tself.updateOwnLocation(ownLocation);\n\t\t\t\t\tself.loopAddressLists(ownLocation);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( self.tCount > 0 && googleClientLoc == null && !self.html5Geo ) {\n\n\t\t\t\t\t// reset timer counter\n\t\t\t\t\tself.tCount = 0;\n\n\t\t\t\t\t// We could not get visitor's location from Google, so make sure\n\t\t\t\t\t// that we reset settings and notify the visitor about it\n\t\t\t\t\tself.resetElements();\n\n\t\t\t\t\tif ( settings.debugMode ) {\n\t\t\t\t\t\tself.debug('== Google API warning ==\\nmessage: '+ settings.notFoundStr, 2);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( $geodataElem.length ) {\n\t\t\t\t\t\t$geodataElem.text(settings.notFoundStr);\n\t\t\t\t\t}\n\n\t\t\t\t\t// trigger a \"fail\" custom event\n\t\t\t\t\tself.$el.trigger('geolocator:fail');\n\t\t\t}\n\n\t\t},\n\n\t\tupdateOwnLocation: function(ownLocation)\t{\n\t\t\tvar self = this,\n\t\t\tsettings = self.settings,\n\t\t\t$geodataElem = self.$geodataElem,\n\t\t\tgoogleMaps = self.googleMaps,\n\t\t\tgoogleMapsGeocoder = new googleMaps.Geocoder();\n\n\t\t\t// Use Google Maps geocoder to get visitors own location\n\t\t\tgoogleMapsGeocoder.geocode({ latLng: ownLocation }, function(responses, status) {\n\t\t\t\tvar debugMsg = '';\n\n\t\t\t\t// Check for returned status code\n\t\t\t\t// http://code.google.com/intl/en-US/apis/maps/documentation/geocoding/#StatusCodes\n\n\t\t\t\tif ( status === 'OK' ) {\n\n\t\t\t\t\tif ( $geodataElem.length ) {\n\t\t\t\t\t\t$geodataElem.text(responses[0].formatted_address);\n\t\t\t\t\t}\n\n\t\t\t\t\t// trigger a \"done\" custom event\n\t\t\t\t\tself.$el.trigger('geolocator:own-done');\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// trigger a \"fail\" custom event\n\t\t\t\t\tself.$el.trigger('geolocator:own-fail');\n\n\t\t\t\t\tif ( settings.debugMode ) {\n\n\t\t\t\t\t\t// Status was not ok, so it's most likely an error\n\t\t\t\t\t\tif ( status === 'OVER_QUERY_LIMIT' ) {\n\t\t\t\t\t\t\tdebugMsg = 'You are over your quota.';\n\t\t\t\t\t\t} else if ( status === 'ZERO_RESULTS' ) {\n\t\t\t\t\t\t\tdebugMsg = 'Geocode was successful but returned no results.';\n\t\t\t\t\t\t} else if ( status === 'REQUEST_DENIED' ) {\n\t\t\t\t\t\t\tdebugMsg = 'Your request was denied.';\n\t\t\t\t\t\t} else if ( status === 'INVALID_REQUEST' ) {\n\t\t\t\t\t\t\tdebugMsg = 'The query (address or latlng) is missing.';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself.debug('== Google Geocoding API error ==\\nmessage: ' + debugMsg, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n \n\t\t\t});\n\t\t},\n\n\t\tloopAddressLists: function(ownLocation) {\n\t\t\tvar self = this,\n\t\t\tgoogleMaps = self.googleMaps,\n\t\t\tnumOfTotalListItems = self.listLength,\n\t\t\tgoogleMapsDirections = new googleMaps.DirectionsService();\n\n\t\t\t// Loop each list element that is inside the main container element\n\n\t\t\t$.each(self.$lists, function(i, el) {\n\t\t\t\tself.getDistances(i, el, numOfTotalListItems, googleMaps, googleMapsDirections, ownLocation);\n\t\t\t});\n\n\t\t},\n\n\t\tgetDistances: function(i, el, numOfTotalListItems, googleMaps, googleMapsDirections, ownLocation) {\n\t\t\tvar self = this,\n\t\t\tsettings = self.settings,\n\t\t\taddressArr = self.addressArr;\n\n\t\t\t// clone our current list element's list items into a new object with address related information\n\t\t\taddressArr[i] = $(el).children(settings.listElem).clone(true).map(function(i, el) {\n\t\t\tvar\t$el = $(el), // current single list item element\n\t\t\t\t$adr = $el.find(settings.geoAdrElem),\n\t\t\t\tdataLat = null,\n\t\t\t\tdataLng = null,\n\t\t\t\tlatLng = (dataLat = $adr.data('latitude')) && (dataLng = $adr.data('longitude')) ? new googleMaps.LatLng(dataLat, dataLng) : null;\n\t\t\t\t\t\n\t\t\t\treturn {\n\t\t\t\t\t'addresstxt': $.text($adr.find('.street-address')) + ', ' + $.text($adr.find('.postal-code')) + ', ' + $.text($adr.find('.locality')) + ' ' + $.text($adr.find('.region')),\n\t\t\t\t\t'latLng': latLng,\n\t\t\t\t\t'element': $el,\n\t\t\t\t\t'distance': null,\n\t\t\t\t\t'endloc': null\n\t\t\t\t};\n\t\t\t});\n\n\t\t\t// after we have the new objects, loop each to query for a location\n\t\t\t$.each(addressArr[i], function(i, address) {\n\t\t\t\tvar destination = address.latLng || address.addresstxt;\n\t\t\t\tgoogleMapsDirections.route({\n\t\t\t\t\t'origin': ownLocation,\n\t\t\t\t\t'destination': destination,\n\t\t\t\t\t'travelMode': googleMaps.DirectionsTravelMode.DRIVING\n\t\t\t\t}, function(result, status) {\n\n\t\t\t\t\tif ( status === 'OK' ) {\n\t\t\t\t\t\tvar resultRoute = result.routes[0].legs[0],\n\t\t\t\t\t\tresultRouteEnd = resultRoute.end_location;\n\n\t\t\t\t\t\taddress.distance = resultRoute.distance.value;\n\t\t\t\t\t\taddress.endloc = resultRouteEnd.Ya + ', ' + resultRouteEnd.Za;\n\t\t\t\t\t} else {\n\t\t\t\t\t\taddress.distance = settings.distanceUnknownStr;\n\t\t\t\t\t\taddress.endloc = null;\n\t\t\t\t\t}\n\n\t\t\t\t\t// add one to our looped address count\n\t\t\t\t\tself.lCount++;\n\n\t\t\t\t\t// if we have looped all list items\n\t\t\t\t\tif ( self.lCount === numOfTotalListItems ) {\n\t\t\t\t\t\tself.finishLocating();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t},\n\n\t\tfinishLocating: function() {\n\t\t\tvar self = this,\n\t\t\taddressArr = self.addressArr,\n\t\t\ti = addressArr.length;\n\n\t\t\t// reset total address count\n\t\t\tself.lCount = 0;\n\n\t\t\t// loop address array and update each address list\n\t\t\twhile (i--) {\n\t\t\t\tself.updateAddresslist(i);\n\t\t\t}\n\n\t\t\t// all addresses have been looped and updated,\n\t\t\t// so empty the address array\n\t\t\taddressArr.length = 0;\n\n\t\t\t// finally reset elements\n\t\t\tself.resetElements();\n\n\t\t\t// trigger a \"done\" custom event\n\t\t\tself.$el.trigger('geolocator:done');\n\n\t\t},\n\n\t\tupdateAddresslist: function(i) {\n\t\t\tvar self = this,\n\t\t\tsettings = self.settings,\n\t\t\tlistElem = settings.listElem,\n\t\t\tclientLoc = self.google.loader.ClientLocation,\n\t\t\taddressArr = self.addressArr,\n\t\t\tlen = addressArr[i].length,\n\t\t\taddressesStr = '',\n\t\t\tj = 0,\n\t\t\townLoc = null,\n\t\t\tmapsHref = null,\n\t\t\taddress = null,\n\t\t\t$el = null,\n\t\t\t$mapsLinkElem = null;\n\n\t\t\t// Sort by shortest distance if sorting is enabled\n\t\t\t// ...and if there are more than 1 address inside the current jQuery object\n\t\t\tif ( settings.sorting && len > 1 ) {\n\t\t\t\taddressArr[i].sort(function(a, b) {\n\t\t\t\t\treturn a.distance < b.distance ? -1 : a.distance > b.distance ? 1 : 0;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Own latitude and longitude for google maps link, fallback on google.loader.ClientLocation latitude and longitude\n\t\t\townLoc = self.ownLatLng || clientLoc.latitude + ', ' + clientLoc.longitude;\n\n\t\t\t// 1. Loop all addresses inside the current jQuery object\n\t\t\t// 2. Check if we have end_location\n\t\t\t// 3. Add a map link if we have latitude and longitude of the address\n\t\t\t// 4. Format the distance of each address\n\t\t\t// 5. Add the address element's HTML to a string\n\n\t\t\tfor ( ; j < len; j++ ) { // 1\n\t\t\t\taddress = addressArr[i][j];\n\t\t\t\t$el = address.element;\n\t\t\t\t$mapsLinkElem = $el.find(settings.mapsLinkElem);\n\n\t\t\t\tif ( address.endloc ) { // 2\n\t\t\t\t\tmapsHref = 'http://maps.google.com/maps?saddr=' + ownLoc + '&daddr=' + address.endloc;\n\n\t\t\t\t\tif ( !$mapsLinkElem.length ) { // 3\n\t\t\t\t\t\t$el.append('<a href=\"' + mapsHref + '\" class=\"' + settings.mapsLinkElem.substring(1) +  '\">' + settings.mapsLinkStr + '</a>');\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$mapsLinkElem.attr('href', mapsHref);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$el.find(settings.distanceElem).text(self.formatDistance(address.distance)); // 4\n\t\t\t\taddressesStr += $el.outerHTML(); // 5\n\t\t\t}\n\n\t\t\t// replace the old HTML inside the current list\n\t\t\t// with a HTML string that contains all fetched distances\n\t\t\tself.$lists.eq(i).html(addressesStr);\n\t\t},\n\n\t\tformatDistance: function(distance) {\n\t\t\tvar metersToMile = 1609.344,\n\t\t\tsettings = this.settings,\n\t\t\tbigStr = ' ' + settings.distanceBigStr,\n\t\t\tmiles = ' miles';\n\n\t\t\t// 1. Check if distance setting is 'miles'\n\t\t\t// 2. If it isn't 'miles' then it is kilometers\n\t\t\t// 3. Show short distances in meters\n\t\t\tif ( distance > (metersToMile / 10) && bigStr === miles ) { // 1\n\t\t\t\tdistance = (Math.round((distance / metersToMile) * 10 ) / 10) + bigStr;\n\t\t\t} else if ( distance > 100 && bigStr !== miles ) { // 2\n\t\t\t\tdistance = (distance * 0.001).toFixed(1) + bigStr;\n\t\t\t} else { // 3\n\t\t\t\tdistance = (parseFloat(distance) === distance) ? distance + ' ' + settings.distanceSmallStr : settings.distanceUnknownStr;\n\t\t\t}\n\n\t\t\treturn distance;\n\t\t},\n\n\t\tresetElements: function() {\n\t\t\tvar self = this,\n\t\t\tsettings = self.settings,\n\t\t\t$notificationElem = self.$notificationElem,\n\t\t\t$recheckElem = self.$recheckElem,\n\t\t\t$checkElem = self.$checkElem,\n\t\t\tnotificationStyle = settings.notificationStyle;\n\n\t\t\t// Hide notification with a style defined in settings\n\t\t\tif ( $notificationElem.length && $notificationElem.is(':visible') ) {\n\t\t\t\tif ( notificationStyle === 'fade' ) {\n\t\t\t\t\t$notificationElem.fadeOut(300);\n\t\t\t\t} else if ( notificationStyle === 'slide' ) {\n\t\t\t\t\t$notificationElem.slideUp(300);\n\t\t\t\t} else {\n\t\t\t\t\t$notificationElem.hide();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// setup recheck element\n\t\t\tif ( $recheckElem.length && !$recheckElem.is(':visible') ) {\n\n\t\t\t\tif ( $checkElem.length && $checkElem.is(':visible') ) {\n\t\t\t\t\t$checkElem.unbind('click').hide();\n\t\t\t\t}\n\n\t\t\t\tself.$recheckElem.show().click(function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t$(this).unbind('click').hide();\n\t\t\t\t\tself.prepare();\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t},\n\n\t\tgeolocationError: function(error) {\n\t\t\tvar self = this;\n\n\t\t\t// Log errors only if debugging is enabled\n\t\t\tif ( self.settings.debugMode ) {\n\t\t\t\tself.debug('== HTML5 Geolocation API warning ==\\nmessage: ' + error.message + '\\ncode: ' + error.code, 2);\n\t\t\t}\n\t\t},\n\n\t\tdebug: function(message, type) {\n\t\t\tvar console = window.console;\n\n\t\t\t// Log debug messages if window.console is supported by the browser\n\t\t\t// debug types:\n\t\t\t// 1 = error\n\t\t\t// 2 = warning\n\t\t\tif ( console ) {\n\n\t\t\t\tif ( console.error && type === 1 ) {\n\t\t\t\t\tconsole.error(message);\n\t\t\t\t} else if ( console.warn && type === 2 ) {\n\t\t\t\t\tconsole.warn(message);\n\t\t\t\t} else if ( console.log ) {\n\t\t\t\t\tconsole.log(message);\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\t$.fn.geolocator = function(options) {\n\n\t\tif ( !this.length ) {\n\t\t\treturn this;\n\t\t}\n\n\t\treturn this.each(function() {\n\t\t\tvar plugin = $.data(this, pluginName);\n\t\t\tif ( !plugin ) {\n\t\t\t\toptions = $.extend({}, defaultSettings, options);\n\t\t\t\t$.data(this, pluginName, new GeoLocator(this, options));\n\t\t\t} else {\n\t\t\t\tplugin.prepare();\n\t\t\t}\n \n\t\t});\n\t};\n\n\t// outerHTML plugin - https://gist.github.com/889005\n\t$.fn.outerHTML = function() {\n\n\t\t// IE, Chrome & Safari will comply with the non-standard outerHTML, all others (FF) will have a fall-back for cloning\n\t\treturn ( !this.length ) ? this : (this[0].outerHTML || (function(el) {\n\t\t\tvar div = document.createElement('div'), contents;\n\t\t\tdiv.appendChild(el.cloneNode(true));\n\t\t\tcontents = div.innerHTML;\n\t\t\tdiv = null;\n\t\t\treturn contents;\n\t\t})(this[0]));\n\n\t};\n\n}(window.jQuery, window, window.document));",
                "new_contents": "(function($, window, document, undefined){\n\t'use strict';\n\n\t/*jshint eqnull: true */\n\n\t// plugin name, used with $.data\n\tvar pluginName = 'jquery-geolocator',\n\n\t// Default settings / how to read these settings:\n\t// Setting name | setting default value | setting type (Boolean/Number/String) | setting instructions\n\tdefaultSettings = {\n\t\tmanualCheck:        false, // Boolean - Set to true if you want your visitor to be able to manually check geolocation.\n\t\tsorting:            true, // Boolean - Set to false if you don't want to sort addresses by distance.\n\t\tdebugMode:          false, // Boolean - Set to true to enable error debugging (only works in browsers that have window.console).\n\t\tenableHighAccuracy: false, //Boolean - Setting for HTML5 geolocation \"enableHighAccuracy\". Setting to true locating takes longer but is more accurate.\n\t\ttimeout:            6000, // Number - Setting for HTML5 geolocation \"timeout\". Default: times out in 6 seconds.\n\t\tmaximumAge:         60000, // Number - Setting for HTML geolocation \"maximunAge\". Default: don't re-get geolocation if it is less than 1min old.\n\t\tapiKey:             null, // String - Google API key for loading Google JS API & Maps API\n\t\tlocationsElem:      null, // String - This is the container element for your address list(s) (e.g. #locations)\n\t\tgeodataElem:        '#geodata', // String - Element for displaying visitor's current location. This element should be unique for each instance.\n\t\trecheckElem:        '#recheck', // String - Element for enabling re-checking of distances. this element should be unique for each instance.\n\t\tcheckElem:          '#check', // String - Element to use to check distances if \"manualCheck\" is enabled. This element should be unique for each instance.\n\t\tnotificationElem:   '.notification', // String - Notification element (e.g. \"Getting geolocation...\")\n\t\tdistanceElem:       '.distance', // String - Element which shows the distance of each address\n\t\tgeoAdrElem:         '.adr', // String - Microformats hcard .adr element that has address data inside it\n\t\tmapsLinkElem:       '.maps-link', // String - Class for Google Maps link element\n\t\tlistParentElem:     'ul', // String - Container element for list items (e.g. ul, ol or div).\n\t\tlistElem:           'li', // String - List item element (e.g. li or span)\n\t\tnotificationStyle:  'show', // String - Notification display style. Options: 'fade', 'slide' or 'show'.\n\t\tdistanceBigStr:     'miles', // String - Default string for distance is in miles, changes to kilometers if set to anything else\n\t\tdistanceSmallStr:   'meters', // String - Default string for meters, change to your own language if needed\n\t\tdistanceUnknownStr: 'unknown', // String - Default string for unknown distance, change to your own language if needed\n\t\tnotFoundStr:        'Could not get your location', // String - Default string for own location not found\n\t\tmapsLinkStr:        'Show directions' // String - Default string for Google Maps link text\n\t};\n\n\tfunction GeoLocator(element, settings) {\n\t\tthis.settings          = settings;\n\t\tthis.el                = settings.locationsElem || element;\n\t\tthis.addressArr        = []; // array for holding address lists\n\t\tthis.$el               = $(this.el); // element that has all location data\n\t\tthis.$recheckElem      = $(settings.recheckElem);\n\t\tthis.$checkElem        = $(settings.checkElem);\n\t\tthis.$notificationElem = $(settings.notificationElem);\n\t\tthis.$geodataElem      = $(settings.geodataElem);\n\n\t\tthis.prepare();\n\n\t\treturn this;\n\t}\n\n\tGeoLocator.prototype = {\n\n\t\tconstructor: GeoLocator,\n\n\t\tprepare: function() {\n\t\t\tvar self = this,\n\t\t\tsettings = self.settings,\n\t\t\t$checkElem = self.$checkElem;\n\n\t\t\t// reset and query the DOM\n\n\t\t\tself.$lists            = self.$el.children(settings.listParentElem); // re-select lists\n\t\t\tself.listLength        = self.$lists.children(settings.listElem).length; // re-select total length of list items\n\t\t\tself.ownLatLng         = null;\n\t\t\tself.tCount            = 0; // Geolocation timeout counter\n\t\t\tself.lCount            = 0; // List item counter\n\t\t\tthis.html5Geo          = false;\n\t\t\tself.addressArr.length = 0; // make sure the address list array is empty\n\n\t\t\t// Bind a click handler if manual check is enabled\n\t\t\t// or initialize the plugin\n\n\t\t\tif ( settings.manualCheck && $checkElem.length ) {\n\t\t\t\t$checkElem.show().click(function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tself.init();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tself.init();\n\t\t\t}\n\t\t},\n\n\t\tinit: function() {\n\t\t\tvar self = this,\n\t\t\tgoogle = window.google,\n\t\t\t$notificationElem = self.$notificationElem,\n\t\t\t$recheckElem = self.$recheckElem,\n\t\t\tnotificationStyle = self.settings.notificationStyle;\n\n\t\t\t// Check if google is defined, if not, load google API\n\n\t\t\tif ( typeof google === 'undefined' || typeof google.load === 'undefined' || typeof google.maps === 'undefined' ) {\n\t\t\t\t// load google API and return\n\t\t\t\tself.loadGoogleAPI();\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\t// google API is loaded\n\t\t\t\tself.google = google;\n\t\t\t\tself.googleMaps = google.maps;\n\n\t\t\t\t// Show notification element\n\n\t\t\t\tif ( $notificationElem.length && !$notificationElem.is(':visible') ) {\n\t\t\t\t\tif ( notificationStyle === 'fade' ) {\n\t\t\t\t\t\t$notificationElem.fadeIn(300);\n\t\t\t\t\t} else if ( notificationStyle === 'slide' ) {\n\t\t\t\t\t\t$notificationElem.slideDown(300);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$notificationElem.show();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Hide recheck element\n\n\t\t\t\tif ( $recheckElem.length && $recheckElem.is(':visible') ) {\n\t\t\t\t\t$recheckElem.unbind('click').hide();\n\t\t\t\t}\n\n\t\t\t\t// call getGeolocation\n\t\t\t\tself.getGeolocation();\n\t\t\t}\n\n\t\t},\n\n\t\tloadGoogleAPI: function() {\n\t\t\tvar self = this,\n\t\t\tgoogle = window.google;\n\n\t\t\t// if google is already there but maps isn't, load Google Maps API v3 and return\n\t\t\tif ( typeof google !== 'undefined' && typeof google.load !== 'undefined' && typeof google.maps === 'undefined' ) {\n\t\t\t\tgoogle.load('maps', '3', { 'other_params': 'sensor=true', 'callback': function() {\n\t\t\t\t\tself.init();\n\t\t\t\t}});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Load Google JS API\n\t\t\t$.getScript('http://www.google.com/jsapi?key=' + self.settings.apiKey)\n\t\t\t.done(function() {\n\t\t\t\tself.init();\n\t\t\t})\n\t\t\t.fail(function(jqxhr, settings, exception) {\n\t\t\t\tself.debug(exception, 1);\n\t\t\t});\n\n\t\t},\n\n\t\tgetGeolocation: function() {\n\t\t\tvar self = this,\n\t\t\tsettings = self.settings,\n\t\t\t$geodataElem = self.$geodataElem,\n\t\t\tgeolocation = window.navigator.geolocation,\n\t\t\tgoogleMaps = self.googleMaps,\n\t\t\tgoogleLoader = self.google.loader,\n\t\t\tgoogleClientLoc = googleLoader.ClientLocation,\n\t\t\tgoogleLatitude = null,\n\t\t\tgoogleLongitude = null,\n\t\t\tgeoTimeout = null,\n\t\t\townLocation = null;\n\n\t\t\tif ( googleClientLoc != null ) {\n\t\t\t\tgoogleLatitude = googleClientLoc.latitude;\n\t\t\t\tgoogleLongitude = googleClientLoc.longitude;\n\t\t\t}\n\n\t\t\t// check that current timeout count is 0\n\t\t\t// timeout geolocation request, fallback on google.loader.ClientLocation\n\t\t\tif ( !self.tCount ) {\n\n\t\t\t\tgeoTimeout = window.setTimeout(function() {\n\t\t\t\t\tself.tCount++;\n\t\t\t\t\tself.getGeolocation();\n\t\t\t\t}, 500);\n\t\t\t}\n\n\t\t\t// try to get HTML5 Geolocation - fallback on google.loader.ClientLocation\n\t\t\tif ( !self.tCount && geolocation ) {\n\n\t\t\t\tgeolocation.getCurrentPosition(function(position) {\n\t\t\t\t\tvar positionCoords = position.coords,\n\t\t\t\t\t\tHTML5Latitude = positionCoords.latitude,\n\t\t\t\t\t\tHTML5Longitude = positionCoords.longitude;\n\n\t\t\t\t\tif ( position && positionCoords != null ) {\n\n\t\t\t\t\t\t// successful with Geolocation coords so\n\t\t\t\t\t\t// make sure that everything else is canceled\n\t\t\t\t\t\tself.html5Geo = true;\n\t\t\t\t\t\twindow.clearTimeout(geoTimeout);\n\n\t\t\t\t\t\t// visitor's current location lat & lng\n\t\t\t\t\t\townLocation = new googleMaps.LatLng(HTML5Latitude, HTML5Longitude);\n\n\t\t\t\t\t\tself.ownLatLng = HTML5Latitude + ', ' + HTML5Longitude;\n\n\t\t\t\t\t\t// update own location and lists with lat & lng from HTML5 Geolocation API\n\t\t\t\t\t\tself.updateOwnLocation(ownLocation);\n\t\t\t\t\t\tself.loopAddressLists(ownLocation);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t}, function(error) {\n\t\t\t\t\t// Error handler for HTML5 Geolocation API\n\t\t\t\t\tself.geolocationError(error);\n\t\t\t\t}, {\n\t\t\t\t\t// Settings for HTML5 Geolocation API\n\t\t\t\t\tmaximumAge: settings.maximumAge,\n\t\t\t\t\ttimeout: settings.timeout,\n\t\t\t\t\tenableHighAccuracy: settings.enableHighAccuracy\n\t\t\t\t});\n\n\t\t\t} else if ( self.tCount < 2 && !self.html5Geo ) {\n\n\t\t\t\t// HTML5 Geolocation API did not respond fast enough, so make sure that\n\t\t\t\t// we have Google's IP address based location specified\n\t\t\t\t// and update own location and lists with Google's lat & lng\n\t\t\t\tif ( typeof self.google === 'object' && googleLoader != null && googleClientLoc != null ) {\n\n\t\t\t\t\t// visitor's current location lat & lng\n\t\t\t\t\townLocation = new googleMaps.LatLng(googleLatitude, googleLongitude);\n\n\t\t\t\t\tself.ownLatLng = googleLatitude + ', ' + googleLongitude;\n\n\t\t\t\t\tself.updateOwnLocation(ownLocation);\n\t\t\t\t\tself.loopAddressLists(ownLocation);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( self.tCount > 0 && googleClientLoc == null && !self.html5Geo ) {\n\n\t\t\t\t\t// reset timer counter\n\t\t\t\t\tself.tCount = 0;\n\n\t\t\t\t\t// We could not get visitor's location from Google, so make sure\n\t\t\t\t\t// that we reset settings and notify the visitor about it\n\t\t\t\t\tself.resetElements();\n\n\t\t\t\t\tif ( settings.debugMode ) {\n\t\t\t\t\t\tself.debug('== Google API warning ==\\nmessage: '+ settings.notFoundStr, 2);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( $geodataElem.length ) {\n\t\t\t\t\t\t$geodataElem.text(settings.notFoundStr);\n\t\t\t\t\t}\n\n\t\t\t\t\t// trigger a \"fail\" custom event\n\t\t\t\t\tself.$el.trigger('geolocator:fail');\n\t\t\t}\n\n\t\t},\n\n\t\tupdateOwnLocation: function(ownLocation)\t{\n\t\t\tvar self = this,\n\t\t\tsettings = self.settings,\n\t\t\t$geodataElem = self.$geodataElem,\n\t\t\tgoogleMaps = self.googleMaps,\n\t\t\tgoogleMapsGeocoder = new googleMaps.Geocoder();\n\n\t\t\t// Use Google Maps geocoder to get visitors own location\n\t\t\tgoogleMapsGeocoder.geocode({ latLng: ownLocation }, function(responses, status) {\n\t\t\t\tvar debugMsg = '';\n\n\t\t\t\t// Check for returned status code\n\t\t\t\t// http://code.google.com/intl/en-US/apis/maps/documentation/geocoding/#StatusCodes\n\n\t\t\t\tif ( status === 'OK' ) {\n\n\t\t\t\t\tif ( $geodataElem.length ) {\n\t\t\t\t\t\t$geodataElem.text(responses[0].formatted_address);\n\t\t\t\t\t}\n\n\t\t\t\t\t// trigger a \"done\" custom event\n\t\t\t\t\tself.$el.trigger('geolocator:own-done');\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// trigger a \"fail\" custom event\n\t\t\t\t\tself.$el.trigger('geolocator:own-fail');\n\n\t\t\t\t\tif ( settings.debugMode ) {\n\n\t\t\t\t\t\t// Status was not ok, so it's most likely an error\n\t\t\t\t\t\tif ( status === 'OVER_QUERY_LIMIT' ) {\n\t\t\t\t\t\t\tdebugMsg = 'You are over your quota.';\n\t\t\t\t\t\t} else if ( status === 'ZERO_RESULTS' ) {\n\t\t\t\t\t\t\tdebugMsg = 'Geocode was successful but returned no results.';\n\t\t\t\t\t\t} else if ( status === 'REQUEST_DENIED' ) {\n\t\t\t\t\t\t\tdebugMsg = 'Your request was denied.';\n\t\t\t\t\t\t} else if ( status === 'INVALID_REQUEST' ) {\n\t\t\t\t\t\t\tdebugMsg = 'The query (address or latlng) is missing.';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself.debug('== Google Geocoding API error ==\\nmessage: ' + debugMsg, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n \n\t\t\t});\n\t\t},\n\n\t\tloopAddressLists: function(ownLocation) {\n\t\t\tvar self = this,\n\t\t\tgoogleMaps = self.googleMaps,\n\t\t\tnumOfTotalListItems = self.listLength,\n\t\t\tgoogleMapsDirections = new googleMaps.DirectionsService();\n\n\t\t\t// Loop each list element that is inside the main container element\n\n\t\t\t$.each(self.$lists, function(i, el) {\n\t\t\t\tself.getDistances(i, el, numOfTotalListItems, googleMaps, googleMapsDirections, ownLocation);\n\t\t\t});\n\n\t\t},\n\n\t\tgetDistances: function(i, el, numOfTotalListItems, googleMaps, googleMapsDirections, ownLocation) {\n\t\t\tvar self = this,\n\t\t\tsettings = self.settings,\n\t\t\taddressArr = self.addressArr;\n\n\t\t\t// clone our current list element's list items into a new object with address related information\n\t\t\taddressArr[i] = $(el).children(settings.listElem).clone(true).map(function(i, el) {\n\t\t\tvar\t$el = $(el), // current single list item element\n\t\t\t\t$adr = $el.find(settings.geoAdrElem),\n\t\t\t\tdataLat = null,\n\t\t\t\tdataLng = null,\n\t\t\t\tlatLng = (dataLat = $adr.data('latitude')) && (dataLng = $adr.data('longitude')) ? new googleMaps.LatLng(dataLat, dataLng) : null;\n\t\t\t\t\t\n\t\t\t\treturn {\n\t\t\t\t\t'addresstxt': $.text($adr.find('.street-address')) + ', ' + $.text($adr.find('.postal-code')) + ', ' + $.text($adr.find('.locality')) + ' ' + $.text($adr.find('.region')),\n\t\t\t\t\t'latLng': latLng,\n\t\t\t\t\t'element': $el,\n\t\t\t\t\t'distance': null,\n\t\t\t\t\t'endloc': null\n\t\t\t\t};\n\t\t\t});\n\n\t\t\t// after we have the new objects, loop each to query for a location\n\t\t\t$.each(addressArr[i], function(i, address) {\n\t\t\t\tvar destination = address.latLng || address.addresstxt;\n\t\t\t\tgoogleMapsDirections.route({\n\t\t\t\t\t'origin': ownLocation,\n\t\t\t\t\t'destination': destination,\n\t\t\t\t\t'travelMode': googleMaps.DirectionsTravelMode.DRIVING\n\t\t\t\t}, function(result, status) {\n\n\t\t\t\t\tif ( status === 'OK' ) {\n\t\t\t\t\t\tvar resultRoute = result.routes[0].legs[0],\n\t\t\t\t\t\tresultRouteEnd = resultRoute.end_location;\n\n\t\t\t\t\t\taddress.distance = resultRoute.distance.value;\n\t\t\t\t\t\taddress.endloc = resultRouteEnd.Ya + ', ' + resultRouteEnd.Za;\n\t\t\t\t\t} else {\n\t\t\t\t\t\taddress.distance = settings.distanceUnknownStr;\n\t\t\t\t\t\taddress.endloc = null;\n\t\t\t\t\t}\n\n\t\t\t\t\t// add one to our looped address count\n\t\t\t\t\tself.lCount++;\n\n\t\t\t\t\t// if we have looped all list items\n\t\t\t\t\tif ( self.lCount === numOfTotalListItems ) {\n\t\t\t\t\t\tself.finishLocating();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t},\n\n\t\tfinishLocating: function() {\n\t\t\tvar self = this,\n\t\t\taddressArr = self.addressArr,\n\t\t\ti = addressArr.length;\n\n\t\t\t// reset total address count\n\t\t\tself.lCount = 0;\n\n\t\t\t// loop address array and update each address list\n\t\t\twhile (i--) {\n\t\t\t\tself.updateAddresslist(i);\n\t\t\t}\n\n\t\t\t// all addresses have been looped and updated,\n\t\t\t// so empty the address array\n\t\t\taddressArr.length = 0;\n\n\t\t\t// finally reset elements\n\t\t\tself.resetElements();\n\n\t\t\t// trigger a \"done\" custom event\n\t\t\tself.$el.trigger('geolocator:done');\n\n\t\t},\n\n\t\tupdateAddresslist: function(i) {\n\t\t\tvar self = this,\n\t\t\tsettings = self.settings,\n\t\t\tlistElem = settings.listElem,\n\t\t\tclientLoc = self.google.loader.ClientLocation,\n\t\t\taddressArr = self.addressArr,\n\t\t\tlen = addressArr[i].length,\n\t\t\taddressesStr = '',\n\t\t\tj = 0,\n\t\t\townLoc = null,\n\t\t\tmapsHref = null,\n\t\t\taddress = null,\n\t\t\t$el = null,\n\t\t\t$mapsLinkElem = null;\n\n\t\t\t// Sort by shortest distance if sorting is enabled\n\t\t\t// ...and if there are more than 1 address inside the current jQuery object\n\t\t\tif ( settings.sorting && len > 1 ) {\n\t\t\t\taddressArr[i].sort(function(a, b) {\n\t\t\t\t\treturn a.distance < b.distance ? -1 : a.distance > b.distance ? 1 : 0;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Own latitude and longitude for google maps link, fallback on google.loader.ClientLocation latitude and longitude\n\t\t\townLoc = self.ownLatLng || clientLoc.latitude + ', ' + clientLoc.longitude;\n\n\t\t\t// 1. Loop all addresses inside the current jQuery object\n\t\t\t// 2. Check if we have end_location\n\t\t\t// 3. Add a map link if we have latitude and longitude of the address\n\t\t\t// 4. Format the distance of each address\n\t\t\t// 5. Add the address element's HTML to a string\n\n\t\t\tfor ( ; j < len; j++ ) { // 1\n\t\t\t\taddress = addressArr[i][j];\n\t\t\t\t$el = address.element;\n\t\t\t\t$mapsLinkElem = $el.find(settings.mapsLinkElem);\n\n\t\t\t\tif ( address.endloc ) { // 2\n\t\t\t\t\tmapsHref = 'http://maps.google.com/maps?saddr=' + ownLoc + '&daddr=' + address.endloc;\n\n\t\t\t\t\tif ( !$mapsLinkElem.length ) { // 3\n\t\t\t\t\t\t$el.append('<a href=\"' + mapsHref + '\" class=\"' + settings.mapsLinkElem.substring(1) +  '\">' + settings.mapsLinkStr + '</a>');\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$mapsLinkElem.attr('href', mapsHref);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$el.find(settings.distanceElem).text(self.formatDistance(address.distance)); // 4\n\t\t\t\taddressesStr += $el.outerHTML(); // 5\n\t\t\t}\n\n\t\t\t// replace the old HTML inside the current list\n\t\t\t// with a HTML string that contains all fetched distances\n\t\t\tself.$lists.eq(i).html(addressesStr);\n\t\t},\n\n\t\tformatDistance: function(distance) {\n\t\t\tvar metersToMile = 1609.344,\n\t\t\tsettings = this.settings,\n\t\t\tbigStr = ' ' + settings.distanceBigStr,\n\t\t\tmiles = ' miles';\n\n\t\t\t// 1. Check if distance setting is 'miles'\n\t\t\t// 2. If it isn't 'miles' then it is kilometers\n\t\t\t// 3. Show short distances in meters\n\t\t\tif ( distance > (metersToMile / 10) && bigStr === miles ) { // 1\n\t\t\t\tdistance = (Math.round((distance / metersToMile) * 10 ) / 10) + bigStr;\n\t\t\t} else if ( distance > 100 && bigStr !== miles ) { // 2\n\t\t\t\tdistance = (distance * 0.001).toFixed(1) + bigStr;\n\t\t\t} else { // 3\n\t\t\t\tdistance = (parseFloat(distance) === distance) ? distance + ' ' + settings.distanceSmallStr : settings.distanceUnknownStr;\n\t\t\t}\n\n\t\t\treturn distance;\n\t\t},\n\n\t\tresetElements: function() {\n\t\t\tvar self = this,\n\t\t\tsettings = self.settings,\n\t\t\t$notificationElem = self.$notificationElem,\n\t\t\t$recheckElem = self.$recheckElem,\n\t\t\t$checkElem = self.$checkElem,\n\t\t\tnotificationStyle = settings.notificationStyle;\n\n\t\t\t// Hide notification with a style defined in settings\n\t\t\tif ( $notificationElem.length && $notificationElem.is(':visible') ) {\n\t\t\t\tif ( notificationStyle === 'fade' ) {\n\t\t\t\t\t$notificationElem.fadeOut(300);\n\t\t\t\t} else if ( notificationStyle === 'slide' ) {\n\t\t\t\t\t$notificationElem.slideUp(300);\n\t\t\t\t} else {\n\t\t\t\t\t$notificationElem.hide();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// setup recheck element\n\t\t\tif ( $recheckElem.length && !$recheckElem.is(':visible') ) {\n\n\t\t\t\tif ( $checkElem.length && $checkElem.is(':visible') ) {\n\t\t\t\t\t$checkElem.unbind('click').hide();\n\t\t\t\t}\n\n\t\t\t\tself.$recheckElem.show().click(function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t$(this).unbind('click').hide();\n\t\t\t\t\tself.prepare();\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t},\n\n\t\tgeolocationError: function(error) {\n\t\t\tvar self = this;\n\n\t\t\t// Log errors only if debugging is enabled\n\t\t\tif ( self.settings.debugMode ) {\n\t\t\t\tself.debug('== HTML5 Geolocation API warning ==\\nmessage: ' + error.message + '\\ncode: ' + error.code, 2);\n\t\t\t}\n\t\t},\n\n\t\tdebug: function(message, type) {\n\t\t\tvar console = window.console;\n\n\t\t\t// Log debug messages if window.console is supported by the browser\n\t\t\t// debug types:\n\t\t\t// 1 = error\n\t\t\t// 2 = warning\n\t\t\tif ( console ) {\n\n\t\t\t\tif ( console.error && type === 1 ) {\n\t\t\t\t\tconsole.error(message);\n\t\t\t\t} else if ( console.warn && type === 2 ) {\n\t\t\t\t\tconsole.warn(message);\n\t\t\t\t} else if ( console.log ) {\n\t\t\t\t\tconsole.log(message);\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\t$.fn.geolocator = function(options) {\n\n\t\tif ( !this.length ) {\n\t\t\treturn this;\n\t\t}\n\n\t\treturn this.each(function() {\n\t\t\tvar plugin = $.data(this, pluginName);\n\t\t\tif ( !plugin ) {\n\t\t\t\toptions = $.extend({}, defaultSettings, options);\n\t\t\t\t$.data(this, pluginName, new GeoLocator(this, options));\n\t\t\t} else {\n\t\t\t\tplugin.prepare();\n\t\t\t}\n \n\t\t});\n\t};\n\n\t// outerHTML plugin - https://gist.github.com/889005\n\t$.fn.outerHTML = function() {\n\n\t\t// IE, Chrome & Safari will comply with the non-standard outerHTML, all others (FF) will have a fall-back for cloning\n\t\treturn ( !this.length ) ? this : (this[0].outerHTML || (function(el) {\n\t\t\tvar div = document.createElement('div'), contents;\n\t\t\tdiv.appendChild(el.cloneNode(true));\n\t\t\tcontents = div.innerHTML;\n\t\t\tdiv = null;\n\t\t\treturn contents;\n\t\t})(this[0]));\n\n\t};\n\n}(window.jQuery, window, window.document));",
                "subject": "visitors -> visitor's",
                "message": "visitors -> visitor's\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "kristerkari/jQuery-Geolocator"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10214,
            "row": {
                "commit": "4533a7f711137dfbcc04be4a4ff683f11e56acb0",
                "old_file": "buildjs/webpack.config.js",
                "new_file": "buildjs/webpack.config.js",
                "old_contents": "'use strict';\n\nconst path = require('path');\nconst fs = require('fs');\n\nconst findPackage = require('./src/find_package.js');\n\nconst webpack = require('webpack');\nconst resolve = require('resolve');\nconst mkdirp = require('mkdirp');\n\n// We must place our files in a special folder for integration /w the android\n// build system.\nconst destination = process.env.SILK_BUILDJS_DEST;\nconst babelCache = path.join(destination, '../.babelcache');\nconst modulePath = findPackage(process.env.SILK_BUILDJS_SOURCE);\nconst pkg = require(path.join(modulePath, 'package.json'));\nconst localWebpack = path.join(modulePath, 'webpack.config.js');\n\nmkdirp.sync(babelCache);\n\nconst name = pkg.name;\nlet main = pkg.main || './index.js';\nif (!path.extname(main)) {\n  main += '.js';\n}\n\nif (main.indexOf('./') !== 0) {\n  main = `./${main}`;\n}\n\n// XXX: Would be nicer to abort this in the bash script rather than after we\n// have booted up node here...\nif (\n  main.indexOf('build/Release') === 0 ||\n  main.indexOf('./build/Release') === 0 ||\n  /\\.node$/.test(main)\n) {\n  console.log(`Module contains no JS main skipping webpack ...`);\n  process.exit(0);\n}\n\nif (!main) {\n  throw new Error(`package.json must have main in ${process.cwd()}`);\n}\n\nconst externals = [\n  // TODO: auto generate these ...\n  'base_version',\n  'bleno',\n  'mic',\n  'noble',\n  'node-webrtc',\n  'opencv',\n  'segfault-handler',\n  'silk-alog',\n  'silk-battery',\n  'silk-camera',\n  'silk-core-version',\n  'silk-cv',\n  'silk-gc1',\n  'silk-input',\n  'silk-lights',\n  'silk-movie',\n  'silk-ntp',\n  'silk-properties',\n  'silk-sensors',\n  'silk-sysutils',\n  'silk-vibrator',\n  'silk-wifi',\n  'v8-profiler',\n  /\\.node$/,\n  (context, request, callback) => {\n    if (resolve.isCore(request)) {\n      callback(null, true);\n      return;\n    }\n\n    // For extra fun node will allow resolving .main without a ./ this behavior\n    // makes .main look nicer but is completely different than how requiring\n    // without a specific path is handled elsewhere... To ensure we don't\n    // accidentally resolve a node module to a local file we handle this case\n    // very specifically.\n    if (context === modulePath && pkg.main === request) {\n      const resolvedPath = path.resolve(context, request);\n      if (!fs.existsSync(resolvedPath)) {\n        callback(new Error(`${modulePath} has a .main which is missing ...`));\n        return;\n      }\n    }\n\n    resolve(request,  {\n      basedir: context,\n      package: pkg,\n      extensions: ['.js', '.json'],\n    }, (err, resolvedPath) => {\n      if (err) {\n        console.log(`Missing module imported from ${context} (${request})`);\n        callback(null, true);\n        return;\n      }\n      callback(null, false);\n    });\n  }\n];\n\nconst entry = {};\nentry[main] = main;\n\nconst config = {\n  context: modulePath,\n  externals,\n  target: 'node',\n  node: {\n    __dirname: false,\n    __filename: false,\n  },\n  devtool: 'source-map',\n  entry,\n  output: {\n    path: path.join(destination),\n    libraryTarget: 'commonjs2',\n    filename: `[name]`,\n  },\n  resolve: {\n    extensions: ['', '.js', '.json'],\n    // Common \"gothcha\" modules ...\n    alias: {\n      'any-promise': require.resolve('./shims/any-promise.js'),\n      'json3': require.resolve('./shims/json3.js'),\n    },\n  },\n  babel: {\n    cacheDirectory: babelCache,\n    presets: [\n      require('babel-preset-silk-node4'),\n    ],\n  },\n  module : {\n    loaders: [\n      { test: /\\.json$/, loader: require.resolve('json-loader') },\n      {\n        test: /\\.js$/,\n        loader: require.resolve('babel-loader'),\n        query: {\n          babelrc: false,\n        }\n      }\n    ]\n  }\n}\n\nif (fs.existsSync(localWebpack)) {\n  console.log(`${localWebpack} found agumenting buildjs ...`);\n  const rules = Object.assign({}, require(localWebpack));\n  if (rules.externals && Array.isArray(rules.externals)) {\n    // Order is important here the rules should be ordered such that the\n    // webpack.config comes from the module first and our global rules second.\n    config.externals = rules.externals.concat(config.externals);\n    delete rules.externals;\n  }\n  Object.assign(config, rules);\n}\n\nmodule.exports = config;\n",
                "new_contents": "'use strict';\n\nconst path = require('path');\nconst fs = require('fs');\n\nconst findPackage = require('./src/find_package.js');\n\nconst webpack = require('webpack');\nconst resolve = require('resolve');\nconst mkdirp = require('mkdirp');\n\n// We must place our files in a special folder for integration /w the android\n// build system.\nconst destination = process.env.SILK_BUILDJS_DEST;\nconst babelCache = path.join(destination, '../.babelcache');\nconst modulePath = findPackage(process.env.SILK_BUILDJS_SOURCE);\nconst pkg = require(path.join(modulePath, 'package.json'));\nconst localWebpack = path.join(modulePath, 'webpack.config.js');\n\nmkdirp.sync(babelCache);\n\nconst name = pkg.name;\nlet main = pkg.main || './index.js';\nif (!path.extname(main)) {\n  main += '.js';\n}\n\nif (main.indexOf('./') !== 0) {\n  main = `./${main}`;\n}\n\n// XXX: Would be nicer to abort this in the bash script rather than after we\n// have booted up node here...\nif (\n  main.indexOf('build/Release') === 0 ||\n  main.indexOf('./build/Release') === 0 ||\n  /\\.node$/.test(main)\n) {\n  console.log(`Module contains no JS main skipping webpack ...`);\n  process.exit(0);\n}\n\nif (!main) {\n  throw new Error(`package.json must have main in ${process.cwd()}`);\n}\n\nconst externals = [\n  // TODO: auto generate these ...\n  'base_version',\n  'bleno',\n  'mic',\n  'noble',\n  'node-webrtc',\n  'opencv',\n  'segfault-handler',\n  'silk-alog',\n  'silk-battery',\n  'silk-camera',\n  'silk-core-version',\n  'silk-cv',\n  'silk-gc1',\n  'silk-input',\n  'silk-lights',\n  'silk-movie',\n  'silk-ntp',\n  'silk-properties',\n  'silk-sensors',\n  'silk-sysutils',\n  'silk-vibrator',\n  'silk-wifi',\n  'v8-profiler',\n  'kissfft',\n  /\\.node$/,\n  (context, request, callback) => {\n    if (resolve.isCore(request)) {\n      callback(null, true);\n      return;\n    }\n\n    // For extra fun node will allow resolving .main without a ./ this behavior\n    // makes .main look nicer but is completely different than how requiring\n    // without a specific path is handled elsewhere... To ensure we don't\n    // accidentally resolve a node module to a local file we handle this case\n    // very specifically.\n    if (context === modulePath && pkg.main === request) {\n      const resolvedPath = path.resolve(context, request);\n      if (!fs.existsSync(resolvedPath)) {\n        callback(new Error(`${modulePath} has a .main which is missing ...`));\n        return;\n      }\n    }\n\n    resolve(request,  {\n      basedir: context,\n      package: pkg,\n      extensions: ['.js', '.json'],\n    }, (err, resolvedPath) => {\n      if (err) {\n        console.log(`Missing module imported from ${context} (${request})`);\n        callback(null, true);\n        return;\n      }\n      callback(null, false);\n    });\n  }\n];\n\nconst entry = {};\nentry[main] = main;\n\nconst config = {\n  context: modulePath,\n  externals,\n  target: 'node',\n  node: {\n    __dirname: false,\n    __filename: false,\n  },\n  devtool: 'source-map',\n  entry,\n  output: {\n    path: path.join(destination),\n    libraryTarget: 'commonjs2',\n    filename: `[name]`,\n  },\n  resolve: {\n    extensions: ['', '.js', '.json'],\n    // Common \"gothcha\" modules ...\n    alias: {\n      'any-promise': require.resolve('./shims/any-promise.js'),\n      'json3': require.resolve('./shims/json3.js'),\n    },\n  },\n  babel: {\n    cacheDirectory: babelCache,\n    presets: [\n      require('babel-preset-silk-node4'),\n    ],\n  },\n  module : {\n    loaders: [\n      { test: /\\.json$/, loader: require.resolve('json-loader') },\n      {\n        test: /\\.js$/,\n        loader: require.resolve('babel-loader'),\n        query: {\n          babelrc: false,\n        }\n      }\n    ]\n  }\n}\n\nif (fs.existsSync(localWebpack)) {\n  console.log(`${localWebpack} found agumenting buildjs ...`);\n  const rules = Object.assign({}, require(localWebpack));\n  if (rules.externals && Array.isArray(rules.externals)) {\n    // Order is important here the rules should be ordered such that the\n    // webpack.config comes from the module first and our global rules second.\n    config.externals = rules.externals.concat(config.externals);\n    delete rules.externals;\n  }\n  Object.assign(config, rules);\n}\n\nmodule.exports = config;\n",
                "subject": "Mark kissfft as external for webpack",
                "message": "Mark kissfft as external for webpack\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "silklabs/silk,silklabs/silk,silklabs/silk,silklabs/silk,silklabs/silk,silklabs/silk"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10215,
            "row": {
                "commit": "502d6a835c014f54794f8c442fc68bcafda92f1d",
                "old_file": "test/indexeddb_test.js",
                "new_file": "test/indexeddb_test.js",
                "old_contents": "\ngoog.require('goog.debug.Console');\ngoog.require('goog.testing.jsunit');\ngoog.require('ydn.async');\ngoog.require('ydn.db.Storage');\n\n\nvar reachedFinalContinuation, basic_schema;\nvar table_name = 't1';\n\nvar setUp = function() {\n  var c = new goog.debug.Console();\n  c.setCapturing(true);\n  goog.debug.LogManager.getRoot().setLevel(goog.debug.Logger.Level.FINE);\n  //goog.debug.Logger.getLogger('ydn.gdata.MockServer').setLevel(goog.debug.Logger.Level.FINEST);\n  goog.debug.Logger.getLogger('ydn.db').setLevel(goog.debug.Logger.Level.FINEST);\n  goog.debug.Logger.getLogger('ydn.db.IndexedDb').setLevel(goog.debug.Logger.Level.FINEST);\n\n\n\tbasic_schema = new ydn.db.DatabaseSchema(1);\n\tbasic_schema.addStore(new ydn.db.StoreSchema(table_name, 'id'));\n};\n\nvar tearDown = function() {\n  assertTrue('The final continuation was not reached', reachedFinalContinuation);\n};\n\nvar db_name = 'test123';\n\n\n\nvar test_1_put = function() {\n\n  var db = new ydn.db.IndexedDb(db_name, basic_schema);\n\n  var hasEventFired = false;\n  var put_value;\n\n  waitForCondition(\n      // Condition\n      function() { return hasEventFired; },\n      // Continuation\n      function() {\n        assertEquals('put a', 'a', put_value);\n        // Remember, the state of this boolean will be tested in tearDown().\n        reachedFinalContinuation = true;\n      },\n      100, // interval\n      2000); // maxTimeout\n\n\n  db.put(table_name, {id: 'a', value: '1', remark: 'put test'}).addCallback(function(value) {\n    console.log('receiving value callback.');\n    put_value = value;\n    hasEventFired = true;\n  }).addErrback(function(e) {\n      hasEventFired = true;\n      console.log('Error: ' + e);\n    });\n};\n\n\nvar test_2_put_arr = function() {\n  var db_name = 'test_2';\n  var db = new ydn.db.IndexedDb(db_name, basic_schema);\n\n  var arr = [\n    {id: 'a' + Math.random(),\n      value: 'a' + Math.random(), remark: 'put test'},\n    {id: 'b' + Math.random(),\n      value: 'b' + Math.random(), remark: 'put test'},\n    {id: 'c' + Math.random(),\n      value: 'c' + Math.random(), remark: 'put test'}\n  ];\n\n  var hasEventFired = false;\n  var put_value;\n\n  waitForCondition(\n      // Condition\n      function() { return hasEventFired; },\n      // Continuation\n      function() {\n        assertArrayEquals('put a', [arr[0].id, arr[1].id, arr[2].id], put_value);\n        // Remember, the state of this boolean will be tested in tearDown().\n        reachedFinalContinuation = true;\n      },\n      100, // interval\n      2000); // maxTimeout\n\n\n  db.put(table_name, arr).addCallback(function(value) {\n    console.log('receiving value callback.');\n    put_value = value;\n    hasEventFired = true;\n  }).addErrback(function(e) {\n      hasEventFired = true;\n      console.log('Error: ' + e);\n    });\n};\n\n\n\nvar _test_3_empty_get = function() {\n\n  var db = new ydn.db.IndexedDb(db_name, basic_schema);\n\n  var hasEventFired = false;\n  var put_value;\n\n  waitForCondition(\n      // Condition\n      function() { return hasEventFired; },\n      // Continuation\n      function() {\n        assertUndefined('retriving non existing value', put_value);\n        // Remember, the state of this boolean will be tested in tearDown().\n        reachedFinalContinuation = true;\n      },\n      100, // interval\n      2000); // maxTimeout\n\n\n  db.get(table_name, 'no_data').addCallback(function(value) {\n    console.log('receiving value callback.');\n    put_value = value;\n    hasEventFired = true;\n  }).addErrback(function(e) {\n      hasEventFired = true;\n      console.log('Error: ' + e);\n    });\n};\n\n\nvar test_4_get_all = function() {\n\n  var db_name = 'test_get_all';\n  var table_name = 'no_data_table';\n  var basic_schema = new ydn.db.DatabaseSchema(1);\n  basic_schema.addStore(new ydn.db.StoreSchema(table_name, 'id'));\n  var db = new ydn.db.IndexedDb(db_name, basic_schema);\n\n  var hasEventFired = false;\n  var put_value;\n\n  waitForCondition(\n      // Condition\n      function() { return hasEventFired; },\n      // Continuation\n      function() {\n        assertArrayEquals('get empty table', [], put_value);\n        // Remember, the state of this boolean will be tested in tearDown().\n        reachedFinalContinuation = true;\n      },\n      100, // interval\n      2000); // maxTimeout\n\n\n  db.get(table_name).addCallback(function(value) {\n    console.log('receiving value callback.');\n    put_value = value;\n    hasEventFired = true;\n  });\n};\n\n\n\nvar test_5_clear = function() {\n\tvar db = new ydn.db.IndexedDb(db_name, basic_schema);\n\n  var hasEventFired = false;\n  var put_value;\n\n  waitForCondition(\n      // Condition\n      function() { return hasEventFired; },\n      // Continuation\n      function() {\n        assertEquals('clear', true, put_value);\n        // Remember, the state of this boolean will be tested in tearDown().\n      },\n      100, // interval\n      1000); // maxTimeout\n\n  var dfl = db.clear(table_name);\n  dfl.addCallback(function(value) {\n    put_value = value;\n    hasEventFired = true;\n  }).addErrback(function(v) {\n    fail('should not get error.');\n  });\n\n  var countValue;\n  var countDone;\n  waitForCondition(\n      // Condition\n      function() { return countDone; },\n      // Continuation\n      function() {\n        assertEquals('count 0 after clear', 0, countValue);\n        // Remember, the state of this boolean will be tested in tearDown().\n        reachedFinalContinuation = true;\n      },\n      100, // interval\n      1000); // maxTimeout\n\n  db.count(table_name).addCallback(function(value) {\n    countValue = value;\n    countDone = true;\n  });\n\n};\n\n\n/**\n */\nvar test_6_special_keys = function() {\n  var db_name = 'test_6';\n\tvar db = new ydn.db.IndexedDb(db_name, basic_schema);\n\n  var key_test = function(key) {\n    console.log('testing ' + key);\n    var key_value = 'a' + Math.random();\n\n    var a_done;\n    var a_value;\n    waitForCondition(\n        // Condition\n        function() { return a_done; },\n        // Continuation\n        function() {\n          assertEquals('put a', key, a_value);\n        },\n        100, // interval\n        2000); // maxTimeout\n\n    db.put(table_name, {id: key, value: key_value}).addCallback(function(value) {\n      console.log('receiving put value callback for ' + key + ' = ' + key_value);\n      a_value = value;\n      a_done = true;\n    });\n\n    var b_done;\n    var b_value;\n    waitForCondition(\n        // Condition\n        function() { return b_done; },\n        // Continuation\n        function() {\n          assertEquals('get', key_value, b_value.value);\n          reachedFinalContinuation = true;\n        },\n        100, // interval\n        2000); // maxTimeout\n\n\n    db.get(table_name, key).addCallback(function(value) {\n      console.log('receiving get value callback ' + key + ' = ' + value);\n      b_value = value;\n      b_done = true;\n    });\n  };\n\n  key_test('x');\n\n  key_test('t@som.com');\n\n  key_test('http://www.ok.com');\n\n};\n\n\n\nvar test_7_put_nested_keyPath = function() {\n  var store_name = 'ts1';\n  var put_obj_dbname = 'putodbtest2';\n\tvar schema = new ydn.db.DatabaseSchema(1);\n\tschema.addStore(new ydn.db.StoreSchema(store_name, 'id.$t'));\n\tvar db = new ydn.db.IndexedDb(put_obj_dbname, schema);\n\n  var key = 'a';\n  var put_done = false;\n  var put_value = {value: Math.random()};\n  put_value.id = {$t: key};\n  var put_value_received;\n\n  waitForCondition(\n      // Condition\n      function() { return put_done; },\n      // Continuation\n      function() {\n        assertEquals('put a 1', key, put_value_received);\n        // Remember, the state of this boolean will be tested in tearDown().\n      },\n      100, // interval\n      2000); // maxTimeout\n\n  db.put(store_name, put_value).addCallback(function(value) {\n    console.log('receiving value callback.');\n    put_value_received = value;\n    put_done = true;\n  });\n\n  var get_done;\n  var get_value_received;\n  waitForCondition(\n      // Condition\n      function() { return get_done; },\n      // Continuation\n      function() {\n        assertObjectEquals('get', put_value, get_value_received);\n        reachedFinalContinuation = true;\n      },\n      100, // interval\n      2000); // maxTimeout\n\n\n  db.get(store_name, key).addCallback(function(value) {\n    console.log('receiving get value callback ' + key + ' = ' + JSON.stringify(value) + ' ' + typeof value);\n    get_value_received = value;\n    get_done = true;\n  });\n\n};\n\n\nvar test_81_fetch_keys = function () {\n  var store_name = 'st';\n  var dbname = 'test81';\n  var indexSchema = new ydn.db.IndexSchema('id', true);\n  var store_schema = new ydn.db.StoreSchema(store_name, 'id', false, [indexSchema]);\n  var schema = new ydn.db.DatabaseSchema(1, undefined, [store_schema]);\n  var db = new ydn.db.IndexedDb(dbname, schema);\n\n  var objs = [\n    {id:'qs1', value:Math.random()},\n    {id:'at2', value:Math.random()},\n    {id:'bs2', value:Math.random()},\n    {id:'st', value:Math.random()}\n  ];\n\n  var put_value_received;\n  var put_done;\n  waitForCondition(\n      // Condition\n      function () {\n        return put_done;\n      },\n      // Continuation\n      function () {\n\n        var get_done;\n        var get_value_received;\n        waitForCondition(\n            // Condition\n            function () {\n              return get_done;\n            },\n            // Continuation\n            function () {\n              assertEquals('obj length', keys.length, put_value_received.length);\n              assertObjectEquals('get', objs[1], put_value_received[0]);\n              assertObjectEquals('get', objs[2], put_value_received[1]);\n\n              reachedFinalContinuation = true;\n            },\n            100, // interval\n            2000); // maxTimeout\n\n\n        var keys = [\n          new ydn.db.Key(store_name, objs[1].id),\n          new ydn.db.Key(store_name, objs[2].id)];\n        db.fetch(keys).addCallback(function (value) {\n          console.log('fetch value: ' + JSON.stringify(value));\n          put_value_received = value;\n\n          get_done = true;\n        });\n\n      },\n      100, // interval\n      2000); // maxTimeout\n\n\n  db.put(store_name, objs).addCallback(function (value) {\n    console.log(['receiving value callback.', value]);\n    put_value_received = value;\n    put_done = true;\n  });\n\n};\n\n\nvar test_85_query_start_with = function () {\n  var store_name = 'ts1';\n  var dbname = 'test_8';\n  var schema = new ydn.db.DatabaseSchema(1);\n  // NOTE: key also need to be indexed.\n  var indexSchema = new ydn.db.IndexSchema('id', true);\n  schema.addStore(new ydn.db.StoreSchema(store_name, 'id', false, [indexSchema]));\n  //schema.addStore(new ydn.db.StoreSchema(store_name, 'id'));\n  var db = new ydn.db.IndexedDb(dbname, schema);\n\n  var objs = [\n    {id:'qs1', value:Math.random()},\n    {id:'qs2', value:Math.random()},\n    {id:'qt', value:Math.random()}\n  ];\n\n  var put_value_received;\n  var put_done;\n  waitForCondition(\n    // Condition\n    function () {\n      return put_done;\n    },\n    // Continuation\n    function () {\n      assertArrayEquals('put objs', [objs[0].id, objs[1].id, objs[2].id],\n        put_value_received);\n\n      var get_done;\n      var get_value_received;\n      waitForCondition(\n        // Condition\n        function () {\n          return get_done;\n        },\n        // Continuation\n        function () {\n          reachedFinalContinuation = true;\n        },\n        100, // interval\n        2000); // maxTimeout\n\n\n      var q = new ydn.db.Query(store_name, 'id').startsWith('qs');\n      db.fetch(q).addCallback(function (value) {\n        console.log('fetch value: ' + JSON.stringify(value));\n        assertEquals('obj length', objs.length - 1, value.length);\n        assertObjectEquals('get', objs[0], value[0]);\n        assertObjectEquals('get', objs[1], value[1]);\n\n        get_done = true;\n      });\n\n    },\n    100, // interval\n    2000); // maxTimeout\n\n\n  db.put(store_name, objs).addCallback(function (value) {\n    console.log(['receiving value callback.', value]);\n    put_value_received = value;\n    put_done = true;\n  });\n\n};\n\nvar testCase = new goog.testing.ContinuationTestCase();\ntestCase.autoDiscoverTests();\nG_testRunner.initialize(testCase);\n\n\n\n",
                "new_contents": "\ngoog.require('goog.debug.Console');\ngoog.require('goog.testing.jsunit');\ngoog.require('ydn.async');\ngoog.require('ydn.db.Storage');\n\n\nvar reachedFinalContinuation, basic_schema;\nvar table_name = 't1';\n\nvar setUp = function() {\n  var c = new goog.debug.Console();\n  c.setCapturing(true);\n  goog.debug.LogManager.getRoot().setLevel(goog.debug.Logger.Level.FINE);\n  //goog.debug.Logger.getLogger('ydn.gdata.MockServer').setLevel(goog.debug.Logger.Level.FINEST);\n  goog.debug.Logger.getLogger('ydn.db').setLevel(goog.debug.Logger.Level.FINEST);\n  goog.debug.Logger.getLogger('ydn.db.IndexedDb').setLevel(goog.debug.Logger.Level.FINEST);\n\n\n\tbasic_schema = new ydn.db.DatabaseSchema(1);\n\tbasic_schema.addStore(new ydn.db.StoreSchema(table_name, 'id'));\n};\n\nvar tearDown = function() {\n  assertTrue('The final continuation was not reached', reachedFinalContinuation);\n};\n\nvar db_name = 'test123';\n\n\n\nvar test_1_put = function() {\n\n  var db = new ydn.db.IndexedDb(db_name, basic_schema);\n\n  var hasEventFired = false;\n  var put_value;\n\n  waitForCondition(\n      // Condition\n      function() { return hasEventFired; },\n      // Continuation\n      function() {\n        assertEquals('put a', 'a', put_value);\n        // Remember, the state of this boolean will be tested in tearDown().\n        reachedFinalContinuation = true;\n      },\n      100, // interval\n      2000); // maxTimeout\n\n\n  db.put(table_name, {id: 'a', value: '1', remark: 'put test'}).addCallback(function(value) {\n    console.log('receiving value callback.');\n    put_value = value;\n    hasEventFired = true;\n  }).addErrback(function(e) {\n      hasEventFired = true;\n      console.log('Error: ' + e);\n    });\n};\n\n\nvar test_2_put_arr = function() {\n  var db_name = 'test_2';\n  var db = new ydn.db.IndexedDb(db_name, basic_schema);\n\n  var arr = [\n    {id: 'a' + Math.random(),\n      value: 'a' + Math.random(), remark: 'put test'},\n    {id: 'b' + Math.random(),\n      value: 'b' + Math.random(), remark: 'put test'},\n    {id: 'c' + Math.random(),\n      value: 'c' + Math.random(), remark: 'put test'}\n  ];\n\n  var hasEventFired = false;\n  var put_value;\n\n  waitForCondition(\n      // Condition\n      function() { return hasEventFired; },\n      // Continuation\n      function() {\n        assertArrayEquals('put a', [arr[0].id, arr[1].id, arr[2].id], put_value);\n        // Remember, the state of this boolean will be tested in tearDown().\n        reachedFinalContinuation = true;\n      },\n      100, // interval\n      2000); // maxTimeout\n\n\n  db.put(table_name, arr).addCallback(function(value) {\n    console.log('receiving value callback.');\n    put_value = value;\n    hasEventFired = true;\n  }).addErrback(function(e) {\n      hasEventFired = true;\n      console.log('Error: ' + e);\n    });\n};\n\n\n\nvar _test_3_empty_get = function() {\n\n  var db = new ydn.db.IndexedDb(db_name, basic_schema);\n\n  var hasEventFired = false;\n  var put_value;\n\n  waitForCondition(\n      // Condition\n      function() { return hasEventFired; },\n      // Continuation\n      function() {\n        assertUndefined('retriving non existing value', put_value);\n        // Remember, the state of this boolean will be tested in tearDown().\n        reachedFinalContinuation = true;\n      },\n      100, // interval\n      2000); // maxTimeout\n\n\n  db.get(table_name, 'no_data').addCallback(function(value) {\n    console.log('receiving value callback.');\n    put_value = value;\n    hasEventFired = true;\n  }).addErrback(function(e) {\n      hasEventFired = true;\n      console.log('Error: ' + e);\n    });\n};\n\n\nvar test_4_get_all = function() {\n\n  var db_name = 'test_get_all';\n  var table_name = 'no_data_table';\n  var basic_schema = new ydn.db.DatabaseSchema(1);\n  basic_schema.addStore(new ydn.db.StoreSchema(table_name, 'id'));\n  var db = new ydn.db.IndexedDb(db_name, basic_schema);\n\n  var hasEventFired = false;\n  var put_value;\n\n  waitForCondition(\n      // Condition\n      function() { return hasEventFired; },\n      // Continuation\n      function() {\n        assertArrayEquals('get empty table', [], put_value);\n        // Remember, the state of this boolean will be tested in tearDown().\n        reachedFinalContinuation = true;\n      },\n      100, // interval\n      2000); // maxTimeout\n\n\n  db.get(table_name).addCallback(function(value) {\n    console.log('receiving value callback.');\n    put_value = value;\n    hasEventFired = true;\n  });\n};\n\n\n\nvar test_5_clear = function() {\n\tvar db = new ydn.db.IndexedDb(db_name, basic_schema);\n\n  var hasEventFired = false;\n  var put_value;\n\n  waitForCondition(\n      // Condition\n      function() { return hasEventFired; },\n      // Continuation\n      function() {\n        assertEquals('clear', true, put_value);\n        // Remember, the state of this boolean will be tested in tearDown().\n      },\n      100, // interval\n      1000); // maxTimeout\n\n  var dfl = db.clear(table_name);\n  dfl.addCallback(function(value) {\n    put_value = value;\n    hasEventFired = true;\n  }).addErrback(function(v) {\n    fail('should not get error.');\n  });\n\n  var countValue;\n  var countDone;\n  waitForCondition(\n      // Condition\n      function() { return countDone; },\n      // Continuation\n      function() {\n        assertEquals('count 0 after clear', 0, countValue);\n        // Remember, the state of this boolean will be tested in tearDown().\n        reachedFinalContinuation = true;\n      },\n      100, // interval\n      1000); // maxTimeout\n\n  db.count(table_name).addCallback(function(value) {\n    countValue = value;\n    countDone = true;\n  });\n\n};\n\n\n/**\n */\nvar test_6_special_keys = function() {\n  var db_name = 'test_6';\n\tvar db = new ydn.db.IndexedDb(db_name, basic_schema);\n\n  var key_test = function(key) {\n    console.log('testing ' + key);\n    var key_value = 'a' + Math.random();\n\n    var a_done;\n    var a_value;\n    waitForCondition(\n        // Condition\n        function() { return a_done; },\n        // Continuation\n        function() {\n          assertEquals('put a', key, a_value);\n        },\n        100, // interval\n        2000); // maxTimeout\n\n    db.put(table_name, {id: key, value: key_value}).addCallback(function(value) {\n      console.log('receiving put value callback for ' + key + ' = ' + key_value);\n      a_value = value;\n      a_done = true;\n    });\n\n    var b_done;\n    var b_value;\n    waitForCondition(\n        // Condition\n        function() { return b_done; },\n        // Continuation\n        function() {\n          assertEquals('get', key_value, b_value.value);\n          reachedFinalContinuation = true;\n        },\n        100, // interval\n        2000); // maxTimeout\n\n\n    db.get(table_name, key).addCallback(function(value) {\n      console.log('receiving get value callback ' + key + ' = ' + value);\n      b_value = value;\n      b_done = true;\n    });\n  };\n\n  key_test('x');\n\n  key_test('t@som.com');\n\n  key_test('http://www.ok.com');\n\n};\n\n\n\nvar test_7_put_nested_keyPath = function() {\n  var store_name = 'ts1';\n  var put_obj_dbname = 'putodbtest2';\n\tvar schema = new ydn.db.DatabaseSchema(1);\n\tschema.addStore(new ydn.db.StoreSchema(store_name, 'id.$t'));\n\tvar db = new ydn.db.IndexedDb(put_obj_dbname, schema);\n\n  var key = 'a';\n  var put_done = false;\n  var put_value = {value: Math.random()};\n  put_value.id = {$t: key};\n  var put_value_received;\n\n  waitForCondition(\n      // Condition\n      function() { return put_done; },\n      // Continuation\n      function() {\n        assertEquals('put a 1', key, put_value_received);\n        // Remember, the state of this boolean will be tested in tearDown().\n      },\n      100, // interval\n      2000); // maxTimeout\n\n  db.put(store_name, put_value).addCallback(function(value) {\n    console.log('receiving value callback.');\n    put_value_received = value;\n    put_done = true;\n  });\n\n  var get_done;\n  var get_value_received;\n  waitForCondition(\n      // Condition\n      function() { return get_done; },\n      // Continuation\n      function() {\n        assertObjectEquals('get', put_value, get_value_received);\n        reachedFinalContinuation = true;\n      },\n      100, // interval\n      2000); // maxTimeout\n\n\n  db.get(store_name, key).addCallback(function(value) {\n    console.log('receiving get value callback ' + key + ' = ' + JSON.stringify(value) + ' ' + typeof value);\n    get_value_received = value;\n    get_done = true;\n  });\n\n};\n\n\nvar test_81_fetch_keys = function () {\n  var store_name = 'st';\n  var dbname = 'test81';\n  var indexSchema = new ydn.db.IndexSchema('id', true);\n  var store_schema = new ydn.db.StoreSchema(store_name, 'id', false, [indexSchema]);\n  var schema = new ydn.db.DatabaseSchema(1, undefined, [store_schema]);\n  var db = new ydn.db.IndexedDb(dbname, schema);\n\n  var objs = [\n    {id:'qs1', value:Math.random()},\n    {id:'at2', value:Math.random()},\n    {id:'bs2', value:Math.random()},\n    {id:'st', value:Math.random()}\n  ];\n\n  var put_value_received;\n  var put_done;\n  waitForCondition(\n      // Condition\n      function () {\n        return put_done;\n      },\n      // Continuation\n      function () {\n\n        var get_done;\n        var get_value_received;\n        waitForCondition(\n            // Condition\n            function () {\n              return get_done;\n            },\n            // Continuation\n            function () {\n              assertEquals('obj length', keys.length, put_value_received.length);\n              assertObjectEquals('get', objs[1], put_value_received[0]);\n              assertObjectEquals('get', objs[2], put_value_received[1]);\n\n              reachedFinalContinuation = true;\n            },\n            100, // interval\n            2000); // maxTimeout\n\n        var keys = [\n          new ydn.db.Key(store_name, objs[1].id),\n          new ydn.db.Key(store_name, objs[2].id)];\n        db.fetch(keys).addCallback(function (value) {\n          console.log('fetch value: ' + JSON.stringify(value));\n          put_value_received = value;\n\n          get_done = true;\n        });\n\n      },\n      100, // interval\n      2000); // maxTimeout\n\n\n  db.put(store_name, objs).addCallback(function (value) {\n    console.log(['receiving value callback.', value]);\n    put_value_received = value;\n    put_done = true;\n  });\n\n};\n\n\nvar test_85_query_start_with = function () {\n  var store_name = 'ts1';\n  var dbname = 'test_8';\n  var schema = new ydn.db.DatabaseSchema(1);\n  // NOTE: key also need to be indexed.\n  var indexSchema = new ydn.db.IndexSchema('id', true);\n  schema.addStore(new ydn.db.StoreSchema(store_name, 'id', false, [indexSchema]));\n  //schema.addStore(new ydn.db.StoreSchema(store_name, 'id'));\n  var db = new ydn.db.IndexedDb(dbname, schema);\n\n  var objs = [\n    {id:'qs1', value:Math.random()},\n    {id:'qs2', value:Math.random()},\n    {id:'qt', value:Math.random()}\n  ];\n\n  var put_value_received;\n  var put_done;\n  waitForCondition(\n    // Condition\n    function () {\n      return put_done;\n    },\n    // Continuation\n    function () {\n      assertArrayEquals('put objs', [objs[0].id, objs[1].id, objs[2].id],\n        put_value_received);\n\n      var get_done;\n      var get_value_received;\n      waitForCondition(\n        // Condition\n        function () {\n          return get_done;\n        },\n        // Continuation\n        function () {\n          reachedFinalContinuation = true;\n        },\n        100, // interval\n        2000); // maxTimeout\n\n\n      var q = new ydn.db.Query(store_name, 'id').startsWith('qs');\n      db.fetch(q).addCallback(function (value) {\n        console.log('fetch value: ' + JSON.stringify(value));\n        assertEquals('obj length', objs.length - 1, value.length);\n        assertObjectEquals('get', objs[0], value[0]);\n        assertObjectEquals('get', objs[1], value[1]);\n\n        get_done = true;\n      });\n\n    },\n    100, // interval\n    2000); // maxTimeout\n\n\n  db.put(store_name, objs).addCallback(function (value) {\n    console.log(['receiving value callback.', value]);\n    put_value_received = value;\n    put_done = true;\n  });\n\n};\n\nvar testCase = new goog.testing.ContinuationTestCase();\ntestCase.autoDiscoverTests();\nG_testRunner.initialize(testCase);\n\n\n\n",
                "subject": "fetch list of keys",
                "message": "fetch list of keys\n",
                "lang": "JavaScript",
                "license": "apache-2.0",
                "repos": "kakadiya91/ydn-db,yathit/ydn-db,kakadiya91/ydn-db,kakadiya91/ydn-db,kakadiya91/ydn-db,yathit/ydn-db,yathit/ydn-db,kakadiya91/ydn-db,yathit/ydn-db,yathit/ydn-db"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10216,
            "row": {
                "commit": "0e1255b1639db94996f9208540521c9417e4f6b6",
                "old_file": "public/javascripts/take_quiz.js",
                "new_file": "public/javascripts/take_quiz.js",
                "old_contents": "/**\n * Copyright (C) 2011 Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\ndefine([\n  'i18n!quizzes.take_quiz',\n  'jquery' /* $ */,\n  'quiz_timing',\n  'compiled/behaviors/autoBlurActiveInput',\n  'compiled/tinymce',\n  'jquery.ajaxJSON' /* ajaxJSON */,\n  'jquery.instructure_date_and_time' /* friendlyDatetime, friendlyDate */,\n  'jquery.instructure_forms' /* getFormData, errorBox */,\n  'jqueryui/dialog',\n  'jquery.instructure_misc_helpers' /* scrollSidebar */,\n  'compiled/jquery.rails_flash_notifications',\n  'tinymce.editor_box' /* editorBox */,\n  'vendor/jquery.scrollTo' /* /\\.scrollTo/ */,\n  'compiled/behaviors/quiz_selectmenu',\n  'sketcher',\n  'vendor/raphael',\n  'i18n!editor',\n  'bootstrap'\n], function(I18n, $, timing, autoBlurActiveInput, tinymce) {\n\n  var lastAnswerSelected = null;\n  var quizSubmission = (function() {\n    var timeMod = 0,\n        started_at =  $(\".started_at\"),\n        end_at = $(\".end_at\"),\n        startedAtText = started_at.text(),\n        endAtText = end_at.text(),\n        endAtParsed = endAtText && new Date(endAtText),\n        $countdown_seconds = $(\".countdown_seconds\"),\n        $time_running_time_remaining = $(\".time_running,.time_remaining\"),\n        $last_saved = $('#last_saved_indicator');\n\n    return {\n      referenceDate: null,\n      countDown: null,\n      isDeadline: true,\n      fiveMinuteDeadline: false,\n      oneMinuteDeadline: false,\n      submitting: false,\n      dialogged: false,\n      contentBoxCounter: 0,\n      lastSubmissionUpdate: new Date(),\n      currentlyBackingUp: false,\n      started_at: started_at,\n      end_at: end_at,\n      time_limit: parseInt($(\".time_limit\").text(), 10) || null,\n      updateSubmission: function(repeat, beforeLeave) {\n        if(quizSubmission.submitting && !repeat) { return; }\n        var now = new Date();\n        if((now - quizSubmission.lastSubmissionUpdate) < 1000) { return }\n        if(quizSubmission.currentlyBackingUp) { return; }\n        quizSubmission.currentlyBackingUp = true;\n        quizSubmission.lastSubmissionUpdate = new Date();\n        var data = $(\"#submit_quiz_form\").getFormData();\n        $(\".question_holder .question.marked\").each(function() {\n          data[$(this).attr('id') + \"_marked\"] = \"1\";\n        });\n\n        $last_saved.text(I18n.t('saving', 'Saving...'));\n        var url = $(\".backup_quiz_submission_url\").attr('href');\n        // If called before leaving the page (ie. onbeforeunload), we can't use any async or FF will kill the PUT request.\n        if (beforeLeave){\n          $.flashMessage(I18n.t('saving', 'Saving...'));\n          $.ajax({\n            url: url,\n            data: data,\n            type: 'PUT',\n            dataType: 'json',\n            async: false        // NOTE: Not asynchronous. Otherwise Firefox will cancel the request as navigating away from the page.\n            // NOTE: No callbacks. Don't care about response. Just making effort to save the quiz\n          });\n        }\n        else {\n          $.ajaxJSON(url, 'PUT', data,\n            // Success callback\n            function(data) {\n              $last_saved.text(I18n.t('saved_at', 'Saved at %{t}', { t: $.friendlyDatetime(new Date()) }));\n              quizSubmission.currentlyBackingUp = false;\n              if(repeat) {\n                setTimeout(function() {quizSubmission.updateSubmission(true) }, 30000);\n              }\n              if(data && data.end_at) {\n                var endAtFromServer     = Date.parse(data.end_at),\n                    submissionEndAt     = Date.parse(quizSubmission.end_at.text()),\n                    serverEndAtTime     = endAtFromServer.getTime(),\n                    submissionEndAtTime = submissionEndAt.getTime();\n\n                quizSubmission.referenceDate = null;\n\n                // if the new end_at from the server is different than our current end_at, then notify\n                // the user that their time limit's changed and let updateTime do the rest.\n                if (serverEndAtTime !== submissionEndAtTime) {\n                  serverEndAtTime > submissionEndAtTime ?\n                    $.flashMessage(I18n.t('notices.extra_time', 'You have been given extra time on this attempt')) :\n                    $.flashMessage(I18n.t('notices.less_time', 'Your time for this quiz has been reduced.'));\n\n                  quizSubmission.end_at.text(data.end_at);\n                  endAtText   = data.end_at;\n                  endAtParsed = new Date(data.end_at);\n                }\n              }\n            },\n            // Error callback\n            function() {\n            var current_user_id = $(\"#identity .user_id\").text() || \"none\";\n            quizSubmission.currentlyBackingUp = false;\n            $.ajaxJSON(location.protocol + '//' + location.host + \"/simple_response.json?user_id=\" + current_user_id + \"&rnd=\" + Math.round(Math.random() * 9999999), 'GET', {}, function() {\n            }, function() {\n              ajaxErrorFlash(I18n.t('errors.connection_lost', \"Connection to %{host} was lost.  Please make sure you're connected to the Internet before continuing.\", {'host': location.host}), request);\n            }, {skipDefaultError: true});\n\n            if(repeat) {\n              setTimeout(function() {quizSubmission.updateSubmission(true) }, 30000);\n            }\n          }, {timeout: 5000 });\n        }\n      },\n\n      updateTime: function() {\n        var now = new Date();\n        var end_at = quizSubmission.time_limit ? endAtText : null;\n        timeMod = (timeMod + 1) % 120;\n        if(timeMod == 0 && !end_at && !quizSubmission.twelveHourDeadline) {\n          quizSubmission.referenceDate = null;\n          var end = endAtParsed;\n          if(!quizSubmission.time_limit && (end - now) < 43200000) {\n            end_at = endAtText;\n          }\n        }\n        if(!quizSubmission.referenceDate) {\n          $.extend(quizSubmission, timing.setReferenceDate(startedAtText, end_at, now));\n        }\n        if(quizSubmission.countDown) {\n          var diff = quizSubmission.countDown.getTime() - now.getTime() - quizSubmission.clientServerDiff;\n          if(diff <= 0) {\n            diff = 0;\n          }\n          var d = new Date(diff);\n          $countdown_seconds.text(d.getUTCSeconds());\n          if(diff <= 0 && !quizSubmission.submitting) {\n            quizSubmission.submitting = true;\n            $(\"#submit_quiz_form\").submit();\n          }\n        }\n        var diff = quizSubmission.referenceDate.getTime() - now.getTime() - quizSubmission.clientServerDiff;\n        if(quizSubmission.isDeadline) {\n          if(diff < 1000) {\n            diff = 0;\n          }\n          if(diff < 1000 && !quizSubmission.dialogged) {\n            quizSubmission.dialogged = true;\n            quizSubmission.countDown = new Date(now.getTime() + 10000);\n            $(\"#times_up_dialog\").show().dialog({\n              title: I18n.t('titles.times_up', \"Time's Up!\"),\n              width: \"auto\",\n              height: \"auto\",\n              modal: true,\n              overlay: {\n                backgroundColor: \"#000\",\n                opacity: 0.7\n              },\n              close: function() {\n                if(!quizSubmission.submitting) {\n                  quizSubmission.submitting = true;\n                  $(\"#submit_quiz_form\").submit();\n                }\n              }\n            });\n          } else if(diff >    30000 && diff <    60000 && !quizSubmission.oneMinuteDeadline) {\n            quizSubmission.oneMinuteDeadline = true;\n            $.flashMessage(I18n.t('notices.one_minute_left', \"One Minute Left\"));\n          } else if(diff >   250000 && diff <   300000 && !quizSubmission.fiveMinuteDeadline) {\n            quizSubmission.fiveMinuteDeadline = true;\n            $.flashMessage(I18n.t('notices.five_minutes_left', \"Five Minutes Left\"));\n          } else if(diff >  1800000 && diff <  1770000 && !quizSubmission.thirtyMinuteDeadline) {\n            quizSubmission.thirtyMinuteDeadline = true;\n            $.flashMessage(I18n.t('notices.thirty_minutes_left', \"Thirty Minutes Left\"));\n          } else if(diff > 43200000 && diff < 43170000 && !quizSubmission.twelveHourDeadline) {\n            quizSubmission.twelveHourDeadline = true;\n            $.flashMessage(I18n.t('notices.twelve_hours_left', \"Twelve Hours Left\"));\n          }\n        }\n        quizSubmission.updateTimeString(diff);\n      },\n      updateTimeString: function(diff) {\n        var date = new Date(Math.abs(diff));\n        var yr = date.getUTCFullYear() - 1970;\n        var mon = date.getUTCMonth();\n        var day = date.getUTCDate() - 1;\n        var hr = date.getUTCHours();\n        var min = date.getUTCMinutes();\n        var sec = date.getUTCSeconds();\n        var times = [];\n        if(yr) { times.push(I18n.t('years_count', \"Year\", {'count': yr})); }\n        if(mon) { times.push(I18n.t('months_count', \"Month\", {'count': mon})); }\n        if(day) { times.push(I18n.t('days_count', \"Day\", {'count': day})); }\n        if(hr) { times.push(I18n.t('hours_count', \"Hour\", {'count': hr})); }\n        if(true || min) { times.push(I18n.t('minutes_count', \"Minute\", {'count': min})); }\n        if(true || sec) { times.push(I18n.t('seconds_count', \"Second\", {'count': sec})); }\n        $time_running_time_remaining.text(times.join(\", \"));\n      }\n    };\n  })();\n\n  $(document).mousedown(function(event) {\n    lastAnswerSelected = $(event.target).parents(\".answer\")[0];\n  }).keydown(function() {\n    lastAnswerSelected = null;\n  });\n\n  $(function() {\n    $.scrollSidebar();\n    autoBlurActiveInput();\n\n    if($(\"#preview_mode_link\").length == 0) {\n      window.onbeforeunload = function() {\n        quizSubmission.updateSubmission(false, true);\n        if(!quizSubmission.submitting && !quizSubmission.alreadyAcceptedNavigatingAway) {\n          return I18n.t('confirms.unfinished_quiz', \"You're about to leave the quiz unfinished.  Continue anyway?\");\n        }\n      };\n      $(document).delegate('a', 'click', function(event) {\n        if($(this).closest('.ui-dialog,.mceToolbar,.ui-selectmenu').length > 0) { return; }\n        if(!event.isDefaultPrevented()) {\n          var url = $(this).attr('href') || \"\";\n          var hashStripped = location.href;\n          if(hashStripped.indexOf('#')) {\n            hashStripped = hashStripped.substring(0, hashStripped.indexOf('#'));\n          }\n          if(url.indexOf('#') == 0 || url.indexOf(hashStripped + \"#\") == 0) {\n            return;\n          }\n          var result = confirm(I18n.t('confirms.navigate_away', \"You're about to navigate away from this page.  Continue anyway?\"));\n          if(!result) {\n            event.preventDefault();\n          } else {\n            quizSubmission.alreadyAcceptedNavigatingAway = true\n          }\n        }\n      });\n    }\n    var $questions = $(\"#questions\");\n    $(\"#question_list\")\n      .delegate(\".jump_to_question_link\", 'click', function(event) {\n        event.preventDefault();\n        var $obj = $($(this).attr('href'));\n        $(\"html,body\").scrollTo($obj.parent());\n        $obj.find(\":input:first\").focus().select();\n      })\n      .find(\".list_question\").bind({\n        mouseenter: function(event) {\n          var $this = $(this),\n              data = $this.data(),\n              title = I18n.t('titles.not_answered', \"Haven't Answered yet\");\n\n          if ($this.hasClass('marked')) {\n            title = I18n.t('titles.come_back_later', \"You marked this question to come back to later\");\n          } else if ($this.hasClass('answered')) {\n            title = I18n.t('titles.answered', \"Answered\");\n          }\n          $this.attr('title', title);\n          data.relatedQuestion || (data.relatedQuestion = $(\"#\" + $this.attr('id').substring(5)));\n          data.relatedQuestion.addClass('related');\n        },\n        mouseleave: function(event) {\n          var relatedQuestion = $(this).data('relatedQuestion')\n          relatedQuestion && relatedQuestion.removeClass('related');\n        }\n      });\n\n    $questions.find('.group_top,.answer_select').bind({\n      mouseenter: function(event) {\n        $(this).addClass('hover');\n      },\n      mouseleave: function(event) {\n        $(this).removeClass('hover');\n      }\n    });\n\n    $questions\n      .delegate(\":checkbox,:radio,label\", 'change mouseup', function(event) {\n        var $answer = $(this).parents(\".answer\");\n        if (lastAnswerSelected == $answer[0]) {\n          $answer.find(\":checkbox,:radio\").blur();\n          quizSubmission.updateSubmission();\n        }\n      })\n      .delegate(\":text,textarea,select\", 'change', function(event, update) {\n        var $this = $(this);\n        if ($this.hasClass('numerical_question_input')) {\n          var val = parseFloat($this.val());\n          $this.val(isNaN(val) ? \"\" : val.toFixed(4));\n        }\n        if (update !== false) {\n          quizSubmission.updateSubmission();\n        }\n      })\n      .delegate(\".numerical_question_input\", {\n        keyup: function(event) {\n          var val = $(this).val();\n          if (val === '' || !isNaN(parseFloat(val))) {\n            $(this).triggerHandler('focus'); // makes the errorBox go away\n          } else{\n            $(this).errorBox(I18n.t('errors.only_numerical_values', \"only numerical values are accepted\"));\n          }\n        }\n      })\n      .delegate(\".flag_question\", 'click', function() {\n        var $question = $(this).parents(\".question\");\n        $question.toggleClass('marked');\n        $(\"#list_\" + $question.attr('id')).toggleClass('marked');\n      })\n      .delegate(\".question_input\", 'change', function(event, update, changedMap) {\n        var $this = $(this),\n            tagName = this.tagName.toUpperCase(),\n            id = $this.parents(\".question\").attr('id'),\n            val = \"\";\n        if (tagName == \"A\") return;\n        if (changedMap) { // reduce redundant jquery lookups and other calls\n          if (changedMap[id]) return;\n          changedMap[id] = true;\n        }\n\n        if (tagName == \"TEXTAREA\") {\n          val = $this.editorBox('get_code');\n        } else if ($this.attr('type') == \"text\" || \"number\") {        //*** 2012-12-07 rupert add \"|| number\"\n          val = $this.val();\n        } else if (tagName == \"SELECT\") {\n          var $selects = $this.parents(\".question\").find(\"select.question_input\");\n          val = !$selects.filter(function() { return !$(this).val() }).length;\n        } else {\n          $this.parents(\".question\").find(\".question_input\").each(function() {\n            if($(this).attr('checked') || $(this).attr('selected')) {\n              val = true;\n            }\n          });\n        }\n        $(\"#list_\" + id)[val ? 'addClass' : 'removeClass']('answered');\n      })\n      .find(\".question_input\").trigger('change', [false, {}]);\n\n\n    setInterval(function() {\n      $(\"textarea.question_input\").each(function() {\n        $(this).triggerHandler('change', false);\n      });\n    }, 2500);\n\n    $(\".hide_time_link\").click(function(event) {\n      event.preventDefault();\n      if($(\".time_running\").css('visibility') != 'hidden') {\n        $(\".time_running\").css('visibility', 'hidden');\n        $(this).text(I18n.t('show_time_link', \"Show\"));\n      } else {\n        $(\".time_running\").css('visibility', 'visible');\n        $(this).text(I18n.t('hide_time_link', \"Hide\"));\n      }\n    });\n\n    setTimeout(function() {\n      $(\"#question_list .list_question\").each(function() {\n        var $this = $(this);\n        if($this.find(\".jump_to_question_link\").text() == \"Spacer\") {\n          $this.remove();\n        }\n      });\n    }, 1000);\n\n    // Suppress \"<ENTER>\" key from submitting a form when clicked inside a text input.\n    $(\"#submit_quiz_form input[type=text]\").keypress(function(e){\n      if (e.keyCode == 13)\n        return false;\n    });\n\n    $(\"#submit_quiz_form\").submit(function(event) {\n      $(\".question_holder .paint_question canvas.paintQuestion\").each(function(){\n        var data = $(this)[0].toDataURL();\n        var $img = $(\"<img>\").attr( \"src\", data).addClass(\"paint-image\");\n        var $div = $(\"<div></div>\").append($img);\n        var $editor = $(this).closest(\".paint_question\").find(\".question_input\");\n        $editor.editorBox( 'set_code', \"\" );\n        $editor.editorBox( 'insert_code', $div.html() );\n\n\n      });\n      $(\".question_holder textarea.question_input\").each(function() { $(this).change(); });\n      unanswered = $(\"#question_list .list_question:not(.answered)\").length;\n      if(unanswered && !quizSubmission.submitting) {\n        var result = confirm(I18n.t('confirms.unanswered_questions', {'one': \"You have 1 unanswered question (see the right sidebar for details).  Submit anyway?\", 'other': \"You have %{count} unanswered questions (see the right sidebar for details).  Submit anyway?\"}, {'count': unanswered}));\n        if(!result) {\n          event.preventDefault();\n          event.stopPropagation();\n          return false;\n        }\n      }\n\n\n\n      quizSubmission.submitting = true;\n    });\n\n    $(\".submit_quiz_button\").click(function(event) {\n      event.preventDefault();\n      $(\"#times_up_dialog\").dialog('close');\n    });\n\n    setTimeout(function() {\n      $(\".question_holder textarea.question_input\").each(function() {\n        $(this).attr('id', 'question_input_' + quizSubmission.contentBoxCounter++);\n        $(this).editorBox();\n      });\n    }, 2000);\n\n    setInterval(quizSubmission.updateTime, 400);\n\n    var current_user_id = $(\"#identity .user_id\").text() || \"none\";\n    setInterval(function() {\n      $.ajaxJSON(location.protocol + '//' + location.host + \"/simple_response.json?user_id=\" + current_user_id + \"&rnd=\" + Math.round(Math.random() * 9999999), 'GET', {}, function() {\n      }, function() {\n        ajaxErrorFlash(I18n.t('errors.connection_lost', \"Connection to %{host} was lost.  Please make sure you're connected to the Internet before continuing.\", {'host': location.host}), request);\n      }, {skipDefaultError: true});\n    }, 30000);\n\n    setTimeout(function() { quizSubmission.updateSubmission(true) }, 15000);\n\n    var ipadInputType = (function (){\n\n      var isiPad = navigator.userAgent.match(/iPad/i) != null;\n      if(!isiPad){return;}\n\n      function isNumber(n) {\n        return !isNaN(parseFloat(n)) && isFinite(n);\n      }\n\n      var $input = $(\"input[type=text]\") || $(\"input[type=number]\");\n\n      var textType;\n\n      $input.blur(function(){\n        var lastText = $(this).val();\n        if(!!lastText){\n          if(isNumber(lastText)){\n            textType = \"number\";\n          }else{\n            $(this).prop(\"type\",\"text\");\n            textType = \"text\";\n          }\n        }\n      });\n\n      $input.focus(function(){\n        var thisText = $(this).val();\n\n        if(!!thisText){\n\n          if(isNumber(thisText)){\n            $(this).prop(\"type\",\"number\");\n          }else{\n            $(this).prop(\"type\",\"text\");\n          }\n\n        }else{\n          if(textType == \"number\"){\n            $(this).prop(\"type\",\"number\");\n          }else{\n            $(this).prop(\"type\",\"text\");\n          }\n        }\n      });\n\n      $input.keydown(function(e){\n        var thisText = $(this).val();\n        var keyDownIsText = (e.keyCode <= 90 && e.keyCode >= 65);\n\n        if(!!thisText){\n\n          if(isNumber(thisText)){\n            if(keyDownIsText){\n              $(this).prop(\"type\",\"text\");\n            }else{\n              $(this).prop(\"type\",\"number\");\n            }\n          }else{\n            $(this).prop(\"type\",\"text\");\n          }\n\n        }else{\n          if(keyDownIsText){\n            $(this).prop(\"type\",\"text\");\n          }else{\n            $(this).prop(\"type\",\"number\");\n          }\n        }\n      });\n\n    })();\n\n    var takePaintQuestion = (function(){\n      if( $(\".question.paint_question\").size() === 0 ) return false;\n      var Painter,\n        sketchSetting = {\n          sketchType:\"paintQuestion\",\n          stageId:\"\",\n          lineW : 1,\n          canvasW : 600,\n          canvasH : 400,\n          color : {hex:\"000000\",rgb:[0,0,0]},\n          tools : {type:\"line\",src:\"\"},\n          appName : \"sketch_app\",\n          appTitle : \"画板\"\n        };\n      $(\"#submit_quiz_form .paint_question\").each(function(){\n        sketchSetting.canvasW = $(this).find(\".text\").width();\n        sketchSetting.canvasH = $(this).find(\".text\").height();\n        sketchSetting.stageId = $(this).attr(\"id\");\n        Painter = new Sketcher(sketchSetting);\n      });\n    })();\n\n    var takeConnectingLeadQuestion = (function(){\n      if( $(\".question.connecting_lead_question\").size() === 0 ) return false;\n\n      $.fn.rotate = function(num) {\n        this.css({\n          transform: \"rotate(\" + num + \"deg)\",\n          \"-webkit-transform\": \"rotate(\" + num + \"deg)\",\n          \"-o-transform\": \"rotate(\" + num + \"deg)\",\n          \"-ms-transform\": \"rotate(\" + num + \"deg)\"\n        });\n\n        return this;\n      };\n\n      $(\"#submit_quiz_form .connecting_lead_question\").each(function(){\n        var readyLine,\n            deleHandle,\n            $answers = $(this).find(\".answers\"),\n            $toolTip = $(\"<div><h5>是否删除？</h5></div>\")\n              .addClass(\"tool-tip\")\n              .hide()\n              .bind(\"click\", function(e){\n                e.stopPropagation();\n              }).appendTo( $answers ),\n            $toolTipDele = $(\"<button type=button>确认</button>\").appendTo($toolTip),\n            $toolTipCancel = $(\"<button type=button>取消</button>\").bind(\"click\", function(){\n              resetToolTip();\n\n            }).appendTo($toolTip),\n            paper = Raphael( $answers[0], $answers.width(), $answers.height()),\n            $this = $(this);\n\n        function drawLine( $end ){\n          var $active = $this.find( \".active\" );\n          var $towNOde = $end.add( $active );\n          var checkName;\n\n          checkName = $end.is(\".word_left\") || $active.is(\".word_left\") ? \"leftSelected\" : \"rightSelected\";\n          $towNOde.addClass( checkName );\n\n          var AP = $active.position();\n          var BP = $end.position();\n          var x1,y1,x2,y2;\n          if( BP.left > AP.left ){\n            x2 = BP.left - 10;\n            y2 = BP.top + $end.height()/2 + 5;\n            x1 = AP.left + $active.width() + 10;\n            y1 = AP.top + $active.height()/2 + 5;\n          }else{\n            x2 = AP.left - 10;\n            y2 = AP.top + $active.height()/2 + 5;\n            x1 = BP.left + $end.width() + 10;\n            y1 = BP.top + $end.height()/2 + 5;\n          }\n\n          var line = paper.path(\"M\" + x1 + \" \" + y1 + \"L\" + x2 + \" \" + y2);\n          line.attr({\n            \"stroke\": \"#08c\",\n            \"stroke-width\": 5\n          }).click(function(e){\n            e.stopPropagation();\n            resetToolTip();\n            this.attr({\n              \"stroke-dasharray\": \"-\"\n            });\n            $toolTip.show()\n              .css({\n                left: ( x1 + x2 )/2 - $toolTip.width()/2,\n                top: ( y1 + y2 )/2 - $toolTip.height() * 1.5\n              });\n            deleHandle =  deleLine(this, $towNOde, checkName, $toolTip);\n            $toolTipDele.bind( \"click\", deleHandle );\n\n          });\n\n        }\n\n        function deleLine(line, leads, className, toolTip){\n          return function(){\n            line.remove();\n            leads.removeClass( className );\n            toolTip.hide();\n          }\n        }\n\n        function resetToolTip(){\n          $toolTip.hide();\n          $toolTipDele.unbind( \"click\", deleHandle );\n          paper.forEach(function (el) {\n            el.attr(\"stroke-dasharray\", \"\");\n          });\n        }\n\n        $(document).click(function(){\n          resetToolTip();\n        });\n\n        $(this).find(\".connecting_lead\").each( function( i ){\n\n          $(this).css({\n            position: \"absolute\",\n            left: 280 * (i%3),\n            top: 40 * Math.floor(i/3)\n          });\n\n          $answers.css({\n             height: 40 * Math.ceil(i/3)\n          });\n\n          $(this).bind( \"click\", function(){\n\n            if( $(this).is(\".word_center\") && $(this).is(\".leftSelected\") && $(this).is(\".rightSelected\")\n             || $(this).is(\".word_left\") && $(this).is(\".leftSelected\")\n             || $(this).is(\".word_right\") && $(this).is(\".rightSelected\")\n              )\n            return;\n\n            var thisLine = i%3;\n            if( readyLine === undefined ) {\n              $(this).addClass(\"active\");\n              readyLine = thisLine;\n\n            }else if( readyLine != undefined && Math.abs( readyLine - thisLine ) !== 1 ) {\n\n              if( $(this).is( \".active\" ) ){\n                readyLine = undefined;\n              }else{\n                $(this).closest( \".answers\" ).find( \".active\").toggleClass( \"active\" );\n              }\n              $(this).toggleClass( \"active\" );\n\n            }else{\n\n              drawLine( $(this) );\n              $(this).closest( \".answers\" ).find( \".active\").toggleClass( \"active\" );\n              readyLine = undefined;\n\n            }\n          });\n        });\n\n        $(this).bind( \"mousedown\", function(){\n          return false;\n        });\n\n      });\n    })();\n\n\n  });\n});\n\n\n",
                "new_contents": "/**\n * Copyright (C) 2011 Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\ndefine([\n  'i18n!quizzes.take_quiz',\n  'jquery' /* $ */,\n  'quiz_timing',\n  'compiled/behaviors/autoBlurActiveInput',\n  'compiled/tinymce',\n  'jquery.ajaxJSON' /* ajaxJSON */,\n  'jquery.instructure_date_and_time' /* friendlyDatetime, friendlyDate */,\n  'jquery.instructure_forms' /* getFormData, errorBox */,\n  'jqueryui/dialog',\n  'jquery.instructure_misc_helpers' /* scrollSidebar */,\n  'compiled/jquery.rails_flash_notifications',\n  'tinymce.editor_box' /* editorBox */,\n  'vendor/jquery.scrollTo' /* /\\.scrollTo/ */,\n  'compiled/behaviors/quiz_selectmenu',\n  'sketcher',\n  'vendor/raphael',\n  'i18n!editor'\n], function(I18n, $, timing, autoBlurActiveInput, tinymce) {\n\n  var lastAnswerSelected = null;\n  var quizSubmission = (function() {\n    var timeMod = 0,\n        started_at =  $(\".started_at\"),\n        end_at = $(\".end_at\"),\n        startedAtText = started_at.text(),\n        endAtText = end_at.text(),\n        endAtParsed = endAtText && new Date(endAtText),\n        $countdown_seconds = $(\".countdown_seconds\"),\n        $time_running_time_remaining = $(\".time_running,.time_remaining\"),\n        $last_saved = $('#last_saved_indicator');\n\n    return {\n      referenceDate: null,\n      countDown: null,\n      isDeadline: true,\n      fiveMinuteDeadline: false,\n      oneMinuteDeadline: false,\n      submitting: false,\n      dialogged: false,\n      contentBoxCounter: 0,\n      lastSubmissionUpdate: new Date(),\n      currentlyBackingUp: false,\n      started_at: started_at,\n      end_at: end_at,\n      time_limit: parseInt($(\".time_limit\").text(), 10) || null,\n      updateSubmission: function(repeat, beforeLeave) {\n        if(quizSubmission.submitting && !repeat) { return; }\n        var now = new Date();\n        if((now - quizSubmission.lastSubmissionUpdate) < 1000) { return }\n        if(quizSubmission.currentlyBackingUp) { return; }\n        quizSubmission.currentlyBackingUp = true;\n        quizSubmission.lastSubmissionUpdate = new Date();\n        var data = $(\"#submit_quiz_form\").getFormData();\n        $(\".question_holder .question.marked\").each(function() {\n          data[$(this).attr('id') + \"_marked\"] = \"1\";\n        });\n\n        $last_saved.text(I18n.t('saving', 'Saving...'));\n        var url = $(\".backup_quiz_submission_url\").attr('href');\n        // If called before leaving the page (ie. onbeforeunload), we can't use any async or FF will kill the PUT request.\n        if (beforeLeave){\n          $.flashMessage(I18n.t('saving', 'Saving...'));\n          $.ajax({\n            url: url,\n            data: data,\n            type: 'PUT',\n            dataType: 'json',\n            async: false        // NOTE: Not asynchronous. Otherwise Firefox will cancel the request as navigating away from the page.\n            // NOTE: No callbacks. Don't care about response. Just making effort to save the quiz\n          });\n        }\n        else {\n          $.ajaxJSON(url, 'PUT', data,\n            // Success callback\n            function(data) {\n              $last_saved.text(I18n.t('saved_at', 'Saved at %{t}', { t: $.friendlyDatetime(new Date()) }));\n              quizSubmission.currentlyBackingUp = false;\n              if(repeat) {\n                setTimeout(function() {quizSubmission.updateSubmission(true) }, 30000);\n              }\n              if(data && data.end_at) {\n                var endAtFromServer     = Date.parse(data.end_at),\n                    submissionEndAt     = Date.parse(quizSubmission.end_at.text()),\n                    serverEndAtTime     = endAtFromServer.getTime(),\n                    submissionEndAtTime = submissionEndAt.getTime();\n\n                quizSubmission.referenceDate = null;\n\n                // if the new end_at from the server is different than our current end_at, then notify\n                // the user that their time limit's changed and let updateTime do the rest.\n                if (serverEndAtTime !== submissionEndAtTime) {\n                  serverEndAtTime > submissionEndAtTime ?\n                    $.flashMessage(I18n.t('notices.extra_time', 'You have been given extra time on this attempt')) :\n                    $.flashMessage(I18n.t('notices.less_time', 'Your time for this quiz has been reduced.'));\n\n                  quizSubmission.end_at.text(data.end_at);\n                  endAtText   = data.end_at;\n                  endAtParsed = new Date(data.end_at);\n                }\n              }\n            },\n            // Error callback\n            function() {\n            var current_user_id = $(\"#identity .user_id\").text() || \"none\";\n            quizSubmission.currentlyBackingUp = false;\n            $.ajaxJSON(location.protocol + '//' + location.host + \"/simple_response.json?user_id=\" + current_user_id + \"&rnd=\" + Math.round(Math.random() * 9999999), 'GET', {}, function() {\n            }, function() {\n              ajaxErrorFlash(I18n.t('errors.connection_lost', \"Connection to %{host} was lost.  Please make sure you're connected to the Internet before continuing.\", {'host': location.host}), request);\n            }, {skipDefaultError: true});\n\n            if(repeat) {\n              setTimeout(function() {quizSubmission.updateSubmission(true) }, 30000);\n            }\n          }, {timeout: 5000 });\n        }\n      },\n\n      updateTime: function() {\n        var now = new Date();\n        var end_at = quizSubmission.time_limit ? endAtText : null;\n        timeMod = (timeMod + 1) % 120;\n        if(timeMod == 0 && !end_at && !quizSubmission.twelveHourDeadline) {\n          quizSubmission.referenceDate = null;\n          var end = endAtParsed;\n          if(!quizSubmission.time_limit && (end - now) < 43200000) {\n            end_at = endAtText;\n          }\n        }\n        if(!quizSubmission.referenceDate) {\n          $.extend(quizSubmission, timing.setReferenceDate(startedAtText, end_at, now));\n        }\n        if(quizSubmission.countDown) {\n          var diff = quizSubmission.countDown.getTime() - now.getTime() - quizSubmission.clientServerDiff;\n          if(diff <= 0) {\n            diff = 0;\n          }\n          var d = new Date(diff);\n          $countdown_seconds.text(d.getUTCSeconds());\n          if(diff <= 0 && !quizSubmission.submitting) {\n            quizSubmission.submitting = true;\n            $(\"#submit_quiz_form\").submit();\n          }\n        }\n        var diff = quizSubmission.referenceDate.getTime() - now.getTime() - quizSubmission.clientServerDiff;\n        if(quizSubmission.isDeadline) {\n          if(diff < 1000) {\n            diff = 0;\n          }\n          if(diff < 1000 && !quizSubmission.dialogged) {\n            quizSubmission.dialogged = true;\n            quizSubmission.countDown = new Date(now.getTime() + 10000);\n            $(\"#times_up_dialog\").show().dialog({\n              title: I18n.t('titles.times_up', \"Time's Up!\"),\n              width: \"auto\",\n              height: \"auto\",\n              modal: true,\n              overlay: {\n                backgroundColor: \"#000\",\n                opacity: 0.7\n              },\n              close: function() {\n                if(!quizSubmission.submitting) {\n                  quizSubmission.submitting = true;\n                  $(\"#submit_quiz_form\").submit();\n                }\n              }\n            });\n          } else if(diff >    30000 && diff <    60000 && !quizSubmission.oneMinuteDeadline) {\n            quizSubmission.oneMinuteDeadline = true;\n            $.flashMessage(I18n.t('notices.one_minute_left', \"One Minute Left\"));\n          } else if(diff >   250000 && diff <   300000 && !quizSubmission.fiveMinuteDeadline) {\n            quizSubmission.fiveMinuteDeadline = true;\n            $.flashMessage(I18n.t('notices.five_minutes_left', \"Five Minutes Left\"));\n          } else if(diff >  1800000 && diff <  1770000 && !quizSubmission.thirtyMinuteDeadline) {\n            quizSubmission.thirtyMinuteDeadline = true;\n            $.flashMessage(I18n.t('notices.thirty_minutes_left', \"Thirty Minutes Left\"));\n          } else if(diff > 43200000 && diff < 43170000 && !quizSubmission.twelveHourDeadline) {\n            quizSubmission.twelveHourDeadline = true;\n            $.flashMessage(I18n.t('notices.twelve_hours_left', \"Twelve Hours Left\"));\n          }\n        }\n        quizSubmission.updateTimeString(diff);\n      },\n      updateTimeString: function(diff) {\n        var date = new Date(Math.abs(diff));\n        var yr = date.getUTCFullYear() - 1970;\n        var mon = date.getUTCMonth();\n        var day = date.getUTCDate() - 1;\n        var hr = date.getUTCHours();\n        var min = date.getUTCMinutes();\n        var sec = date.getUTCSeconds();\n        var times = [];\n        if(yr) { times.push(I18n.t('years_count', \"Year\", {'count': yr})); }\n        if(mon) { times.push(I18n.t('months_count', \"Month\", {'count': mon})); }\n        if(day) { times.push(I18n.t('days_count', \"Day\", {'count': day})); }\n        if(hr) { times.push(I18n.t('hours_count', \"Hour\", {'count': hr})); }\n        if(true || min) { times.push(I18n.t('minutes_count', \"Minute\", {'count': min})); }\n        if(true || sec) { times.push(I18n.t('seconds_count', \"Second\", {'count': sec})); }\n        $time_running_time_remaining.text(times.join(\", \"));\n      }\n    };\n  })();\n\n  $(document).mousedown(function(event) {\n    lastAnswerSelected = $(event.target).parents(\".answer\")[0];\n  }).keydown(function() {\n    lastAnswerSelected = null;\n  });\n\n  $(function() {\n    $.scrollSidebar();\n    autoBlurActiveInput();\n\n    if($(\"#preview_mode_link\").length == 0) {\n      window.onbeforeunload = function() {\n        quizSubmission.updateSubmission(false, true);\n        if(!quizSubmission.submitting && !quizSubmission.alreadyAcceptedNavigatingAway) {\n          return I18n.t('confirms.unfinished_quiz', \"You're about to leave the quiz unfinished.  Continue anyway?\");\n        }\n      };\n      $(document).delegate('a', 'click', function(event) {\n        if($(this).closest('.ui-dialog,.mceToolbar,.ui-selectmenu').length > 0) { return; }\n        if(!event.isDefaultPrevented()) {\n          var url = $(this).attr('href') || \"\";\n          var hashStripped = location.href;\n          if(hashStripped.indexOf('#')) {\n            hashStripped = hashStripped.substring(0, hashStripped.indexOf('#'));\n          }\n          if(url.indexOf('#') == 0 || url.indexOf(hashStripped + \"#\") == 0) {\n            return;\n          }\n          var result = confirm(I18n.t('confirms.navigate_away', \"You're about to navigate away from this page.  Continue anyway?\"));\n          if(!result) {\n            event.preventDefault();\n          } else {\n            quizSubmission.alreadyAcceptedNavigatingAway = true\n          }\n        }\n      });\n    }\n    var $questions = $(\"#questions\");\n    $(\"#question_list\")\n      .delegate(\".jump_to_question_link\", 'click', function(event) {\n        event.preventDefault();\n        var $obj = $($(this).attr('href'));\n        $(\"html,body\").scrollTo($obj.parent());\n        $obj.find(\":input:first\").focus().select();\n      })\n      .find(\".list_question\").bind({\n        mouseenter: function(event) {\n          var $this = $(this),\n              data = $this.data(),\n              title = I18n.t('titles.not_answered', \"Haven't Answered yet\");\n\n          if ($this.hasClass('marked')) {\n            title = I18n.t('titles.come_back_later', \"You marked this question to come back to later\");\n          } else if ($this.hasClass('answered')) {\n            title = I18n.t('titles.answered', \"Answered\");\n          }\n          $this.attr('title', title);\n          data.relatedQuestion || (data.relatedQuestion = $(\"#\" + $this.attr('id').substring(5)));\n          data.relatedQuestion.addClass('related');\n        },\n        mouseleave: function(event) {\n          var relatedQuestion = $(this).data('relatedQuestion')\n          relatedQuestion && relatedQuestion.removeClass('related');\n        }\n      });\n\n    $questions.find('.group_top,.answer_select').bind({\n      mouseenter: function(event) {\n        $(this).addClass('hover');\n      },\n      mouseleave: function(event) {\n        $(this).removeClass('hover');\n      }\n    });\n\n    $questions\n      .delegate(\":checkbox,:radio,label\", 'change mouseup', function(event) {\n        var $answer = $(this).parents(\".answer\");\n        if (lastAnswerSelected == $answer[0]) {\n          $answer.find(\":checkbox,:radio\").blur();\n          quizSubmission.updateSubmission();\n        }\n      })\n      .delegate(\":text,textarea,select\", 'change', function(event, update) {\n        var $this = $(this);\n        if ($this.hasClass('numerical_question_input')) {\n          var val = parseFloat($this.val());\n          $this.val(isNaN(val) ? \"\" : val.toFixed(4));\n        }\n        if (update !== false) {\n          quizSubmission.updateSubmission();\n        }\n      })\n      .delegate(\".numerical_question_input\", {\n        keyup: function(event) {\n          var val = $(this).val();\n          if (val === '' || !isNaN(parseFloat(val))) {\n            $(this).triggerHandler('focus'); // makes the errorBox go away\n          } else{\n            $(this).errorBox(I18n.t('errors.only_numerical_values', \"only numerical values are accepted\"));\n          }\n        }\n      })\n      .delegate(\".flag_question\", 'click', function() {\n        var $question = $(this).parents(\".question\");\n        $question.toggleClass('marked');\n        $(\"#list_\" + $question.attr('id')).toggleClass('marked');\n      })\n      .delegate(\".question_input\", 'change', function(event, update, changedMap) {\n        var $this = $(this),\n            tagName = this.tagName.toUpperCase(),\n            id = $this.parents(\".question\").attr('id'),\n            val = \"\";\n        if (tagName == \"A\") return;\n        if (changedMap) { // reduce redundant jquery lookups and other calls\n          if (changedMap[id]) return;\n          changedMap[id] = true;\n        }\n\n        if (tagName == \"TEXTAREA\") {\n          val = $this.editorBox('get_code');\n        } else if ($this.attr('type') == \"text\" || \"number\") {        //*** 2012-12-07 rupert add \"|| number\"\n          val = $this.val();\n        } else if (tagName == \"SELECT\") {\n          var $selects = $this.parents(\".question\").find(\"select.question_input\");\n          val = !$selects.filter(function() { return !$(this).val() }).length;\n        } else {\n          $this.parents(\".question\").find(\".question_input\").each(function() {\n            if($(this).attr('checked') || $(this).attr('selected')) {\n              val = true;\n            }\n          });\n        }\n        $(\"#list_\" + id)[val ? 'addClass' : 'removeClass']('answered');\n      })\n      .find(\".question_input\").trigger('change', [false, {}]);\n\n\n    setInterval(function() {\n      $(\"textarea.question_input\").each(function() {\n        $(this).triggerHandler('change', false);\n      });\n    }, 2500);\n\n    $(\".hide_time_link\").click(function(event) {\n      event.preventDefault();\n      if($(\".time_running\").css('visibility') != 'hidden') {\n        $(\".time_running\").css('visibility', 'hidden');\n        $(this).text(I18n.t('show_time_link', \"Show\"));\n      } else {\n        $(\".time_running\").css('visibility', 'visible');\n        $(this).text(I18n.t('hide_time_link', \"Hide\"));\n      }\n    });\n\n    setTimeout(function() {\n      $(\"#question_list .list_question\").each(function() {\n        var $this = $(this);\n        if($this.find(\".jump_to_question_link\").text() == \"Spacer\") {\n          $this.remove();\n        }\n      });\n    }, 1000);\n\n    // Suppress \"<ENTER>\" key from submitting a form when clicked inside a text input.\n    $(\"#submit_quiz_form input[type=text]\").keypress(function(e){\n      if (e.keyCode == 13)\n        return false;\n    });\n\n    $(\"#submit_quiz_form\").submit(function(event) {\n      $(\".question_holder .paint_question canvas.paintQuestion\").each(function(){\n        var data = $(this)[0].toDataURL();\n        var $img = $(\"<img>\").attr( \"src\", data).addClass(\"paint-image\");\n        var $div = $(\"<div></div>\").append($img);\n        var $editor = $(this).closest(\".paint_question\").find(\".question_input\");\n        $editor.editorBox( 'set_code', \"\" );\n        $editor.editorBox( 'insert_code', $div.html() );\n\n\n      });\n      $(\".question_holder textarea.question_input\").each(function() { $(this).change(); });\n      unanswered = $(\"#question_list .list_question:not(.answered)\").length;\n      if(unanswered && !quizSubmission.submitting) {\n        var result = confirm(I18n.t('confirms.unanswered_questions', {'one': \"You have 1 unanswered question (see the right sidebar for details).  Submit anyway?\", 'other': \"You have %{count} unanswered questions (see the right sidebar for details).  Submit anyway?\"}, {'count': unanswered}));\n        if(!result) {\n          event.preventDefault();\n          event.stopPropagation();\n          return false;\n        }\n      }\n\n\n\n      quizSubmission.submitting = true;\n    });\n\n    $(\".submit_quiz_button\").click(function(event) {\n      event.preventDefault();\n      $(\"#times_up_dialog\").dialog('close');\n    });\n\n    setTimeout(function() {\n      $(\".question_holder textarea.question_input\").each(function() {\n        $(this).attr('id', 'question_input_' + quizSubmission.contentBoxCounter++);\n        $(this).editorBox();\n      });\n    }, 2000);\n\n    setInterval(quizSubmission.updateTime, 400);\n\n    var current_user_id = $(\"#identity .user_id\").text() || \"none\";\n    setInterval(function() {\n      $.ajaxJSON(location.protocol + '//' + location.host + \"/simple_response.json?user_id=\" + current_user_id + \"&rnd=\" + Math.round(Math.random() * 9999999), 'GET', {}, function() {\n      }, function() {\n        ajaxErrorFlash(I18n.t('errors.connection_lost', \"Connection to %{host} was lost.  Please make sure you're connected to the Internet before continuing.\", {'host': location.host}), request);\n      }, {skipDefaultError: true});\n    }, 30000);\n\n    setTimeout(function() { quizSubmission.updateSubmission(true) }, 15000);\n\n    var ipadInputType = (function (){\n\n      var isiPad = navigator.userAgent.match(/iPad/i) != null;\n      if(!isiPad){return;}\n\n      function isNumber(n) {\n        return !isNaN(parseFloat(n)) && isFinite(n);\n      }\n\n      var $input = $(\"input[type=text]\") || $(\"input[type=number]\");\n\n      var textType;\n\n      $input.blur(function(){\n        var lastText = $(this).val();\n        if(!!lastText){\n          if(isNumber(lastText)){\n            textType = \"number\";\n          }else{\n            $(this).prop(\"type\",\"text\");\n            textType = \"text\";\n          }\n        }\n      });\n\n      $input.focus(function(){\n        var thisText = $(this).val();\n\n        if(!!thisText){\n\n          if(isNumber(thisText)){\n            $(this).prop(\"type\",\"number\");\n          }else{\n            $(this).prop(\"type\",\"text\");\n          }\n\n        }else{\n          if(textType == \"number\"){\n            $(this).prop(\"type\",\"number\");\n          }else{\n            $(this).prop(\"type\",\"text\");\n          }\n        }\n      });\n\n      $input.keydown(function(e){\n        var thisText = $(this).val();\n        var keyDownIsText = (e.keyCode <= 90 && e.keyCode >= 65);\n\n        if(!!thisText){\n\n          if(isNumber(thisText)){\n            if(keyDownIsText){\n              $(this).prop(\"type\",\"text\");\n            }else{\n              $(this).prop(\"type\",\"number\");\n            }\n          }else{\n            $(this).prop(\"type\",\"text\");\n          }\n\n        }else{\n          if(keyDownIsText){\n            $(this).prop(\"type\",\"text\");\n          }else{\n            $(this).prop(\"type\",\"number\");\n          }\n        }\n      });\n\n    })();\n\n    var takePaintQuestion = (function(){\n      if( $(\".question.paint_question\").size() === 0 ) return false;\n      var Painter,\n        sketchSetting = {\n          sketchType:\"paintQuestion\",\n          stageId:\"\",\n          lineW : 1,\n          canvasW : 600,\n          canvasH : 400,\n          color : {hex:\"000000\",rgb:[0,0,0]},\n          tools : {type:\"line\",src:\"\"},\n          appName : \"sketch_app\",\n          appTitle : \"画板\"\n        };\n      $(\"#submit_quiz_form .paint_question\").each(function(){\n        sketchSetting.canvasW = $(this).find(\".text\").width();\n        sketchSetting.canvasH = $(this).find(\".text\").height();\n        sketchSetting.stageId = $(this).attr(\"id\");\n        Painter = new Sketcher(sketchSetting);\n      });\n    })();\n\n    var takeConnectingLeadQuestion = (function(){\n      if( $(\".question.connecting_lead_question\").size() === 0 ) return false;\n\n      $.fn.rotate = function(num) {\n        this.css({\n          transform: \"rotate(\" + num + \"deg)\",\n          \"-webkit-transform\": \"rotate(\" + num + \"deg)\",\n          \"-o-transform\": \"rotate(\" + num + \"deg)\",\n          \"-ms-transform\": \"rotate(\" + num + \"deg)\"\n        });\n\n        return this;\n      };\n\n      $(\"#submit_quiz_form .connecting_lead_question\").each(function(){\n        var readyLine,\n            deleHandle,\n            $answers = $(this).find(\".answers\"),\n            $toolTip = $(\"<div><h5>是否删除？</h5></div>\")\n              .addClass(\"tool-tip\")\n              .hide()\n              .bind(\"click\", function(e){\n                e.stopPropagation();\n              }).appendTo( $answers ),\n            $toolTipDele = $(\"<button type=button>确认</button>\").appendTo($toolTip),\n            $toolTipCancel = $(\"<button type=button>取消</button>\").bind(\"click\", function(){\n              resetToolTip();\n\n            }).appendTo($toolTip),\n            paper = Raphael( $answers[0], $answers.width(), $answers.height()),\n            $this = $(this);\n\n        function drawLine( $end ){\n          var $active = $this.find( \".active\" );\n          var $towNOde = $end.add( $active );\n          var checkName;\n\n          checkName = $end.is(\".word_left\") || $active.is(\".word_left\") ? \"leftSelected\" : \"rightSelected\";\n          $towNOde.addClass( checkName );\n\n          var x1,y1,x2,y2;\n          var normalPosition = $end.position().left > $active.position().left;\n          var $nodeB = normalPosition ? $end : $active;\n          var $nodeA = !normalPosition ? $end : $active;\n          x2 = $nodeB.position().left - 10;\n          y2 = $nodeB.position().top + $nodeB.height()/2 + 5;\n\n          x1 = $nodeA.position().left + $nodeA.width() + 10;\n          y1 = $nodeA.position().top + $nodeA.height()/2 + 5;\n\n          var line = paper.path(\"M\" + x1 + \" \" + y1 + \"L\" + x2 + \" \" + y2);\n          line.attr({\n            \"stroke\": \"#08c\",\n            \"stroke-width\": 5\n          }).click(function(e){\n            e.stopPropagation();\n            resetToolTip();\n            this.attr({\n              \"stroke-dasharray\": \"-\"\n            });\n            $toolTip.show()\n              .css({\n                left: ( x1 + x2 )/2 - $toolTip.width()/2,\n                top: ( y1 + y2 )/2 - $toolTip.height() * 1.5\n              });\n            deleHandle =  deleLine(this, $towNOde, checkName, $toolTip);\n            $toolTipDele.bind( \"click\", deleHandle );\n          });\n\n        }\n\n        function deleLine(line, leads, className, toolTip){\n          return function(){\n            line.remove();\n            leads.removeClass( className );\n            toolTip.hide();\n          }\n        }\n\n        function resetToolTip(){\n          $toolTip.hide();\n          $toolTipDele.unbind( \"click\", deleHandle );\n          paper.forEach(function (el) {\n            el.attr(\"stroke-dasharray\", \"\");\n          });\n        }\n\n        $(document).click(function(){\n          resetToolTip();\n        });\n\n        $(this).find(\".connecting_lead\").each( function( i ){\n\n          $(this).css({\n            position: \"absolute\",\n            left: 280 * (i%3),\n            top: 40 * Math.floor(i/3)\n          });\n\n          $answers.css({\n             height: 40 * Math.ceil(i/3)\n          });\n\n          $(this).bind( \"click\", function(){\n\n            if( $(this).is(\".word_center\") && $(this).is(\".leftSelected\") && $(this).is(\".rightSelected\")\n             || $(this).is(\".word_left\") && $(this).is(\".leftSelected\")\n             || $(this).is(\".word_right\") && $(this).is(\".rightSelected\")\n              )\n            return;\n\n            var thisLine = i%3;\n            if( readyLine === undefined ) {\n              $(this).addClass(\"active\");\n              readyLine = thisLine;\n\n            }else if( readyLine != undefined && Math.abs( readyLine - thisLine ) !== 1 ) {\n\n              if( $(this).is( \".active\" ) ){\n                readyLine = undefined;\n              }else{\n                $(this).closest( \".answers\" ).find( \".active\").toggleClass( \"active\" );\n              }\n              $(this).toggleClass( \"active\" );\n\n            }else{\n\n              drawLine( $(this) );\n              $(this).closest( \".answers\" ).find( \".active\").toggleClass( \"active\" );\n              readyLine = undefined;\n\n            }\n          });\n        });\n\n        $(this).bind( \"mousedown\", function(){\n          return false;\n        });\n\n      });\n    })();\n\n\n  });\n});\n\n\n",
                "subject": "connecting_lead_question",
                "message": "connecting_lead_question\n",
                "lang": "JavaScript",
                "license": "agpl-3.0",
                "repos": "rup/Tarrax,rup/Tarrax,rup/Tarrax"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10217,
            "row": {
                "commit": "f40b6228d3547dc11c2369221628f4b8345e67fc",
                "old_file": "sway.js",
                "new_file": "sway.js",
                "old_contents": "/* Sway (c) 2016 Benson Pan. MIT @license: en.wikipedia.org/wiki/MIT_License */\n\n/* Note: Sway relies on Velocity.js, a copy can be found on VelocityJS.org */\nvar callCount = 0;\n\nvar sway = function(animation)\n{\n\tvar velocity_param;\n\t\n\t// var fns = ['opacity', 'width', 'height', 'paddingTop', 'paddingRight', 'paddingBottom', 'paddingLeft', 'top', 'right', 'bottom', 'left', 'marginTop', 'marginRight', 'marginBottom', 'marginLeft', 'borderTopWidth', 'borderRightWidth', 'borderBottomWidth', 'borderLeftWidth', 'borderRadius', 'outerWidth', 'fontSize', 'lineHeight', 'letterSpacing', 'wordSpacing', 'color', 'colorRed', 'colorGreen', 'colorBlue', 'colorAlpha', 'backgroundColor', 'backgroundColorRed', 'backgroundColorBlue', 'backgroundColorGreen', 'backgroundColorAlpha', 'borderColor', 'borderColorRed', 'borderColorGreen', 'borderColorBlue', 'borderColorAlpha', 'outlineColor', 'outlineColorRed', 'outlineColorGreen', 'outlineColorBlue', 'outlineColorAlpha', 'textShadowX', 'textShadowY', 'textShadowBlur', 'boxShadowX', 'boxShadowY', 'boxShadowBlur', 'boxShadowSpread', 'translateX', 'translateY', 'translateZ', 'scale', 'scaleX', 'scaleY', 'rotateX', 'rotateY', 'rotateZ', 'skewX', 'skewY'];\n\n\tfor (var key in animation)\n\t{\n\t\tvelocity_param = key;\n\t}\n\t\n\t$('.sway').each(function(i, obj)\n\t{\n\t\tif (callCount <= i)\n\t\t{\n\t\t\tvar message = $(this).text();\n\t\t\tnotCalled = 0;\n\t\t\t$(this).html(''); // clear the html\n\t\t\t\n\t\t\twhile (message != '')\n\t\t\t{\n\t\t\t\t// retrieve content using .text() instead, in case no js support\n\t\t\t\tvar indexSpace1 = message.indexOf(' ');\n\t\t\t\tif (indexSpace1 != -1)\n\t\t\t\t{\n\t\t\t\t\tif (message.indexOf('<br>') == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).append('<br>');\n\t\t\t\t\t\tmessage = message.substring(indexSpace1 + 1);\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).append('<div class=\"inner-sway' + callCount + '\">' + message.substring(0, indexSpace1) + '</div> ');\n\t\t\t\t\t\tmessage = message.substring(indexSpace1 + 1);\n\t\t\t\t\t}\n\t\t\t\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(this).append('<div class=\"inner-sway' + callCount + '\">' + message + '</div>');\n\t\t\t\t\tmessage = '';\n\t\t\t\t}\n\t\t\t}\n\t\t\t$('.inner-sway' + callCount).each(function(i, obj)\n\t\t\t{\n\t\t\t\tvar temp = {};\n\t\t\t\tvar ending = {};\n\t\t\t\ttemp[velocity_param] = parseInt(animation[velocity_param]) * -1;\n\t\t\t\tending[velocity_param] = $(this).css(velocity_param);\n\t\t\t\t\n\t\t\t\tif (velocity_param.indexOf(\"scale\") != -1)\n\t\t\t\t{\n\t\t\t\t\tending[velocity_param] = 1;\n\t\t\t\t}\n\t\t\t\tif (velocity_param.indexOf(\"fontSize\") != -1)\n\t\t\t\t{\n\t\t\t\t\tconsole.log($(this).css(\"font-size\"));\n\t\t\t\t\ttemp[velocity_param] = 10;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t$(this).hover(function()\n\t\t\t\t{\n\t\t\t\t\t$(this).velocity(animation, {duration:100, easing: 'easeOutBounce'});\n\t\t\t\t\t$(this).velocity(temp, {duration:200, easing: 'easeOutBounce'});\n\t\t\t\t\t$(this).velocity(ending, {duration:250, easing: 'easeOutBounce'});\n\t\t\t\t}, \n\t\t\t\tfunction()\n\t\t\t\t{\n\t\t\t\t});\n\t\t\t});\n\t\t\t$('.inner-sway' + callCount).css({'display':'inline-block'});\n\t\t}\n\t\t\n\t\tif (notCalled && i == $('.sway').length - 1)\n\t\t\tconsole.log(\"Sway: Function was called more than number of available .sway divs\")\n\t});\n\tcallCount++;\n}\n",
                "new_contents": "/* Sway (c) 2016 Benson Pan. MIT @license: en.wikipedia.org/wiki/MIT_License */\n\n/* Note: Sway relies on JQuery and Velocity.js; a copy can be found on VelocityJS.org */\nvar callCount = 0;\n\nvar sway = function(animation)\n{\n\tvar velocity_param;\n\t\n\t// var fns = ['opacity', 'width', 'height', 'paddingTop', 'paddingRight', 'paddingBottom', 'paddingLeft', 'top', 'right', 'bottom', 'left', 'marginTop', 'marginRight', 'marginBottom', 'marginLeft', 'borderTopWidth', 'borderRightWidth', 'borderBottomWidth', 'borderLeftWidth', 'borderRadius', 'outerWidth', 'fontSize', 'lineHeight', 'letterSpacing', 'wordSpacing', 'color', 'colorRed', 'colorGreen', 'colorBlue', 'colorAlpha', 'backgroundColor', 'backgroundColorRed', 'backgroundColorBlue', 'backgroundColorGreen', 'backgroundColorAlpha', 'borderColor', 'borderColorRed', 'borderColorGreen', 'borderColorBlue', 'borderColorAlpha', 'outlineColor', 'outlineColorRed', 'outlineColorGreen', 'outlineColorBlue', 'outlineColorAlpha', 'textShadowX', 'textShadowY', 'textShadowBlur', 'boxShadowX', 'boxShadowY', 'boxShadowBlur', 'boxShadowSpread', 'translateX', 'translateY', 'translateZ', 'scale', 'scaleX', 'scaleY', 'rotateX', 'rotateY', 'rotateZ', 'skewX', 'skewY'];\n\n\tfor (var key in animation)\n\t{\n\t\tvelocity_param = key;\n\t}\n\t\n\t$('.sway').each(function(i, obj)\n\t{\n\t\tif (callCount == i)\n\t\t{\n\t\t\tvar message = $(this).text();\n\t\t\tnotCalled = 0;\n\t\t\t$(this).html(''); // clear the html\n\t\t\t\n\t\t\twhile (message != '')\n\t\t\t{\n\t\t\t\tvar indexSpace1 = message.indexOf(' ');\n\t\t\t\tif (indexSpace1 != -1)\n\t\t\t\t{\n\t\t\t\t\tif (message.indexOf('<br>') == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).append('<br>');\n\t\t\t\t\t\tmessage = message.substring(indexSpace1 + 1);\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).append('<div class=\"inner-sway' + callCount + '\">' + message.substring(0, indexSpace1) + '</div> ');\n\t\t\t\t\t\tmessage = message.substring(indexSpace1 + 1);\n\t\t\t\t\t}\n\t\t\t\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(this).append('<div class=\"inner-sway' + callCount + '\">' + message + '</div>');\n\t\t\t\t\tmessage = '';\n\t\t\t\t}\n\t\t\t}\n\t\t\t$('.inner-sway' + callCount).each(function(i, obj)\n\t\t\t{\n\t\t\t\tvar temp = {};\n\t\t\t\tvar ending = {};\n\t\t\t\ttemp[velocity_param] = parseInt(animation[velocity_param]) * -1;\n\t\t\t\t\n\t\t\t\t\n\t\t\t\tif (\"scale\".indexOf(velocity_param) != -1)\n\t\t\t\t{\n\t\t\t\t\tending[velocity_param] = 1;\n\t\t\t\t}\n\t\t\t\telse if (\"fontSizeopacity\".indexOf(velocity_param) != -1)\n\t\t\t\t{\n\t\t\t\t\tending[velocity_param] = $(this).css(velocity_param);\n\t\t\t\t\ttemp[velocity_param] = $(this).css(velocity_param) / 2;\n\t\t\t\t}\n\t\t\t\telse if (\"color\".indexOf(velocity_param) != -1)\n\t\t\t\t{\n\t\t\t\t\ttemp = animation;\n\t\t\t\t\tending[velocity_param] = rgb2hex($(this).css(velocity_param));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tending[velocity_param] = $(this).css(velocity_param);\n\t\t\t\t}\n\t\t\t\t// FOLLOWING ARE NOT SUPPORTED:\n\t\t\t\tif (\"heightwidth\".indexOf(velocity_param) == -1)\n\t\t\t\t{\n\t\t\t\t\t$(this).hover(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($('.velocity-animating'))\n\t\t\t\t\t\t\t$(this).stop();\n\t\t\t\t\t\t$(this).velocity(animation, {duration:100, easing: 'easeOutBounce'});\n\t\t\t\t\t\t$(this).velocity(temp, {duration:200, easing: 'easeOutBounce'});\n\t\t\t\t\t\t$(this).velocity(ending, {duration:250, easing: 'easeOutBounce'});\n\t\t\t\t\t}, \n\t\t\t\t\tfunction()\n\t\t\t\t\t{\n\t\t\t\t\t});\n\t\t\t\t}\t\n\t\t\t\t\n\t\t\t});\n\t\t\t$('.inner-sway' + callCount).css({'display':'inline-block'});\n\t\t}\n\t\t\n\t\tif (notCalled && i == $('.sway').length - 1)\n\t\t\tconsole.log(\"Sway: Function was called more than number of available .sway divs\")\n\t});\n\tcallCount++;\n}\n\nfunction rgb2hex(rgb) {\n    if (/^#[0-9A-F]{6}$/i.test(rgb)) return rgb;\n\n    rgb = rgb.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/);\n    function hex(x) {\n        return (\"0\" + parseInt(x).toString(16)).slice(-2);\n    }\n    return \"#\" + hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);\n}\n",
                "subject": "Update sway.js",
                "message": "Update sway.js\n\n- Tested all velocity animations; height and width behave unexpectedly\r\n- Fixed animation 'stacking'",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "panbenson/sway"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10218,
            "row": {
                "commit": "6d193128f3f98f7a1b0e162945b93cf6716a57bc",
                "old_file": "chrome/browser/resources/options/language_options.js",
                "new_file": "chrome/browser/resources/options/language_options.js",
                "old_contents": "// Copyright (c) 2011 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n// TODO(kochi): Generalize the notification as a component and put it\n// in js/cr/ui/notification.js .\n\ncr.define('options', function() {\n\n  const OptionsPage = options.OptionsPage;\n  const AddLanguageOverlay = options.language.AddLanguageOverlay;\n  const LanguageList = options.language.LanguageList;\n\n  // Some input methods like Chinese Pinyin have config pages.\n  // This is the map of the input method names to their config page names.\n  const INPUT_METHOD_ID_TO_CONFIG_PAGE_NAME = {\n    'chewing': 'languageChewing',\n    'hangul': 'languageHangul',\n    'mozc': 'languageMozc',\n    'mozc-dv': 'languageMozc',\n    'mozc-jp': 'languageMozc',\n    'pinyin': 'languagePinyin',\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  // LanguageOptions class:\n\n  /**\n   * Encapsulated handling of ChromeOS language options page.\n   * @constructor\n   */\n  function LanguageOptions(model) {\n    OptionsPage.call(this, 'language', localStrings.getString('languagePage'),\n                     'languagePage');\n  }\n\n  cr.addSingletonGetter(LanguageOptions);\n\n  // Inherit LanguageOptions from OptionsPage.\n  LanguageOptions.prototype = {\n    __proto__: OptionsPage.prototype,\n\n    /**\n     * Initializes LanguageOptions page.\n     * Calls base class implementation to starts preference initialization.\n     */\n    initializePage: function() {\n      OptionsPage.prototype.initializePage.call(this);\n\n      var languageOptionsList = $('language-options-list');\n      LanguageList.decorate(languageOptionsList);\n\n      languageOptionsList.addEventListener('change',\n          this.handleLanguageOptionsListChange_.bind(this));\n      languageOptionsList.addEventListener('save',\n          this.handleLanguageOptionsListSave_.bind(this));\n\n      this.addEventListener('visibleChange',\n                            this.handleVisibleChange_.bind(this));\n\n      if (cr.isChromeOS) {\n        this.initializeInputMethodList_();\n        this.initializeLanguageCodeToInputMehotdIdsMap_();\n      }\n      Preferences.getInstance().addEventListener(this.spellCheckDictionaryPref,\n          this.handleSpellCheckDictionaryPrefChange_.bind(this));\n\n      // Set up add button.\n      $('language-options-add-button').onclick = function(e) {\n        // Add the language without showing the overlay if it's specified in\n        // the URL hash (ex. lang_add=ja).  Used for automated testing.\n        var match = document.location.hash.match(/\\blang_add=([\\w-]+)/);\n        if (match) {\n          var addLanguageCode = match[1];\n          $('language-options-list').addLanguage(addLanguageCode);\n        } else {\n          OptionsPage.showOverlay('addLanguageOverlay');\n        }\n      };\n      // Set up remove button.\n      $('language-options-remove-button').addEventListener('click',\n          this.handleRemoveButtonClick_.bind(this));\n\n      // Setup add language overlay page.\n      OptionsPage.registerOverlay(AddLanguageOverlay.getInstance());\n\n      if (cr.isChromeOS) {\n        // Listen to user clicks on the add language list.\n        var addLanguageList = $('add-language-overlay-language-list');\n        addLanguageList.addEventListener('click',\n            this.handleAddLanguageListClick_.bind(this));\n      } else {\n        // Listen to add language dialog ok button.\n        var addLanguageOkButton = $('add-language-overlay-ok-button');\n        addLanguageOkButton.addEventListener('click',\n            this.handleAddLanguageOkButtonClick_.bind(this));\n\n        // Show experimental features if enabled.\n        if (templateData.experimentalSpellCheckFeatures == 'true') {\n          $('auto-spell-correction-option').classList.remove('hidden');\n        }\n      }\n    },\n\n    // The preference is a CSV string that describes preload engines\n    // (i.e. active input methods).\n    preloadEnginesPref: 'settings.language.preload_engines',\n    // The list of preload engines, like ['mozc', 'pinyin'].\n    preloadEngines_: [],\n    // The preference is a string that describes the spell check\n    // dictionary language, like \"en-US\".\n    spellCheckDictionaryPref: 'spellcheck.dictionary',\n    spellCheckDictionary_: \"\",\n    // The map of language code to input method IDs, like:\n    // {'ja': ['mozc', 'mozc-jp'], 'zh-CN': ['pinyin'], ...}\n    languageCodeToInputMethodIdsMap_: {},\n\n    /**\n     * Initializes the input method list.\n     */\n    initializeInputMethodList_: function() {\n      var inputMethodList = $('language-options-input-method-list');\n      var inputMethodListData = templateData.inputMethodList;\n\n      // Add all input methods, but make all of them invisible here. We'll\n      // change the visibility in handleLanguageOptionsListChange_() based\n      // on the selected language. Note that we only have less than 100\n      // input methods, so creating DOM nodes at once here should be ok.\n      for (var i = 0; i < inputMethodListData.length; i++) {\n        var inputMethod = inputMethodListData[i];\n        var input = document.createElement('input');\n        input.type = 'checkbox';\n        input.inputMethodId = inputMethod.id;\n        // Listen to user clicks.\n        input.addEventListener('click',\n                               this.handleCheckboxClick_.bind(this));\n        var label = document.createElement('label');\n        label.appendChild(input);\n        label.appendChild(document.createTextNode(inputMethod.displayName));\n        label.style.display = 'none';\n        label.languageCodeSet = inputMethod.languageCodeSet;\n        // Add the configure button if the config page is present for this\n        // input method.\n        if (inputMethod.id in INPUT_METHOD_ID_TO_CONFIG_PAGE_NAME) {\n          var pageName = INPUT_METHOD_ID_TO_CONFIG_PAGE_NAME[inputMethod.id];\n          var button = this.createConfigureInputMethodButton_(inputMethod.id,\n                                                              pageName);\n          label.appendChild(button);\n        }\n\n        inputMethodList.appendChild(label);\n      }\n      // Listen to pref change once the input method list is initialized.\n      Preferences.getInstance().addEventListener(this.preloadEnginesPref,\n          this.handlePreloadEnginesPrefChange_.bind(this));\n    },\n\n    /**\n     * Creates a configure button for the given input method ID.\n     * @param {string} inputMethodId Input method ID (ex. \"pinyin\").\n     * @param {string} pageName Name of the config page (ex. \"languagePinyin\").\n     * @private\n     */\n    createConfigureInputMethodButton_: function(inputMethodId, pageName) {\n      var button = document.createElement('button');\n      button.textContent = localStrings.getString('configure');\n      button.onclick = function(e) {\n        // Prevent the default action (i.e. changing the checked property\n        // of the checkbox). The button click here should not be handled\n        // as checkbox click.\n        e.preventDefault();\n        chrome.send('inputMethodOptionsOpen', [inputMethodId]);\n        OptionsPage.showPageByName(pageName);\n      }\n      return button;\n    },\n\n    /**\n     * Handles OptionsPage's visible property change event.\n     * @param {Event} e Property change event.\n     * @private\n     */\n    handleVisibleChange_: function(e) {\n      if (this.visible) {\n        $('language-options-list').redraw();\n        chrome.send('languageOptionsOpen');\n      }\n    },\n\n    /**\n     * Handles languageOptionsList's change event.\n     * @param {Event} e Change event.\n     * @private\n     */\n    handleLanguageOptionsListChange_: function(e) {\n      var languageOptionsList = $('language-options-list');\n      var languageCode = languageOptionsList.getSelectedLanguageCode();\n      // Select the language if it's specified in the URL hash (ex. lang=ja).\n      // Used for automated testing.\n      var match = document.location.hash.match(/\\blang=([\\w-]+)/);\n      if (match) {\n        var specifiedLanguageCode = match[1];\n        if (languageOptionsList.selectLanguageByCode(specifiedLanguageCode)) {\n          languageCode = specifiedLanguageCode;\n        }\n      }\n      this.updateSelectedLanguageName_(languageCode);\n      if (!cr.isMac)\n        this.updateUiLanguageButton_(languageCode);\n      this.updateSpellCheckLanguageButton_(languageCode);\n      if (cr.isChromeOS)\n        this.updateInputMethodList_(languageCode);\n      this.updateLanguageListInAddLanguageOverlay_();\n    },\n\n    /**\n     * Handles languageOptionsList's save event.\n     * @param {Event} e Save event.\n     * @private\n     */\n    handleLanguageOptionsListSave_: function(e) {\n      if (cr.isChromeOS) {\n        // Sort the preload engines per the saved languages before save.\n        this.preloadEngines_ = this.sortPreloadEngines_(this.preloadEngines_);\n        this.savePreloadEnginesPref_();\n      }\n    },\n\n    /**\n     * Sorts preloadEngines_ by languageOptionsList's order.\n     * @param {Array} preloadEngines List of preload engines.\n     * @return {Array} Returns sorted preloadEngines.\n     * @private\n     */\n    sortPreloadEngines_: function(preloadEngines) {\n      // For instance, suppose we have two languages and associated input\n      // methods:\n      //\n      // - Korean: hangul\n      // - Chinese: pinyin\n      //\n      // The preloadEngines preference should look like \"hangul,pinyin\".\n      // If the user reverse the order, the preference should be reorderd\n      // to \"pinyin,hangul\".\n      var languageOptionsList = $('language-options-list');\n      var languageCodes = languageOptionsList.getLanguageCodes();\n\n      // Convert the list into a dictonary for simpler lookup.\n      var preloadEngineSet = {};\n      for (var i = 0; i < preloadEngines.length; i++) {\n        preloadEngineSet[preloadEngines[i]] = true;\n      }\n\n      // Create the new preload engine list per the language codes.\n      var newPreloadEngines = [];\n      for (var i = 0; i < languageCodes.length; i++) {\n        var languageCode = languageCodes[i];\n        var inputMethodIds = this.languageCodeToInputMethodIdsMap_[\n            languageCode];\n        // Check if we have active input methods associated with the language.\n        for (var j = 0; j < inputMethodIds.length; j++) {\n          var inputMethodId = inputMethodIds[j];\n          if (inputMethodId in preloadEngineSet) {\n            // If we have, add it to the new engine list.\n            newPreloadEngines.push(inputMethodId);\n            // And delete it from the set. This is necessary as one input\n            // method can be associated with more than one language thus\n            // we should avoid having duplicates in the new list.\n            delete preloadEngineSet[inputMethodId];\n          }\n        }\n      }\n\n      return newPreloadEngines;\n    },\n\n    /**\n     * Initializes the map of language code to input method IDs.\n     * @private\n     */\n    initializeLanguageCodeToInputMehotdIdsMap_: function() {\n      var inputMethodList = templateData.inputMethodList;\n      for (var i = 0; i < inputMethodList.length; i++) {\n        var inputMethod = inputMethodList[i];\n        for (var languageCode in inputMethod.languageCodeSet) {\n          if (languageCode in this.languageCodeToInputMethodIdsMap_) {\n            this.languageCodeToInputMethodIdsMap_[languageCode].push(\n                inputMethod.id);\n          } else {\n            this.languageCodeToInputMethodIdsMap_[languageCode] =\n                [inputMethod.id];\n          }\n        }\n      }\n    },\n\n    /**\n     * Updates the currently selected language name.\n     * @param {string} languageCode Language code (ex. \"fr\").\n     * @private\n     */\n    updateSelectedLanguageName_: function(languageCode) {\n      var languageDisplayName = LanguageList.getDisplayNameFromLanguageCode(\n          languageCode);\n      var languageNativeDisplayName =\n          LanguageList.getNativeDisplayNameFromLanguageCode(languageCode);\n      // If the native name is different, add it.\n      if (languageDisplayName != languageNativeDisplayName) {\n        languageDisplayName += ' - ' + languageNativeDisplayName;\n      }\n      // Update the currently selected language name.\n      $('language-options-language-name').textContent = languageDisplayName;\n    },\n\n    /**\n     * Updates the UI language button.\n     * @param {string} languageCode Language code (ex. \"fr\").\n     * @private\n     */\n    updateUiLanguageButton_: function(languageCode) {\n      var uiLanguageButton = $('language-options-ui-language-button');\n      // Check if the language code matches the current UI language.\n      if (languageCode == templateData.currentUiLanguageCode) {\n        // If it matches, the button just says that the UI language is\n        // currently in use.\n        uiLanguageButton.textContent =\n            localStrings.getString('is_displayed_in_this_language');\n        // Make it look like a text label.\n        uiLanguageButton.className = 'text-button';\n        // Remove the event listner.\n        uiLanguageButton.onclick = undefined;\n      } else if (languageCode in templateData.uiLanguageCodeSet) {\n        // If the language is supported as UI language, users can click on\n        // the button to change the UI language.\n        uiLanguageButton.textContent =\n            localStrings.getString('display_in_this_language');\n        uiLanguageButton.className = '';\n        // Send the change request to Chrome.\n        uiLanguageButton.onclick = function(e) {\n          chrome.send('uiLanguageChange', [languageCode]);\n        }\n        $('language-options-ui-restart-button').onclick = function(e) {\n          chrome.send('uiLanguageRestart');\n        }\n      } else {\n        // If the language is not supported as UI language, the button\n        // just says that Chromium OS cannot be displayed in this language.\n        uiLanguageButton.textContent =\n            localStrings.getString('cannot_be_displayed_in_this_language');\n        uiLanguageButton.className = 'text-button';\n        uiLanguageButton.onclick = undefined;\n      }\n      uiLanguageButton.style.display = 'block';\n      $('language-options-ui-notification-bar').style.display = 'none';\n    },\n\n    /**\n     * Updates the spell check language button.\n     * @param {string} languageCode Language code (ex. \"fr\").\n     * @private\n     */\n    updateSpellCheckLanguageButton_: function(languageCode) {\n      var spellCheckLanguageButton = $(\n          'language-options-spell-check-language-button');\n      // Check if the language code matches the current spell check language.\n      if (languageCode == this.spellCheckDictionary_) {\n        // If it matches, the button just says that the spell check language is\n        // currently in use.\n        spellCheckLanguageButton.textContent =\n            localStrings.getString('is_used_for_spell_checking');\n        // Make it look like a text label.\n        spellCheckLanguageButton.className = 'text-button';\n        // Remove the event listner.\n        spellCheckLanguageButton.onclick = undefined;\n      } else if (languageCode in templateData.spellCheckLanguageCodeSet) {\n        // If the language is supported as spell check language, users can\n        // click on the button to change the spell check language.\n        spellCheckLanguageButton.textContent =\n            localStrings.getString('use_this_for_spell_checking');\n        spellCheckLanguageButton.className = '';\n        spellCheckLanguageButton.languageCode = languageCode;\n        // Add an event listner to the click event.\n        spellCheckLanguageButton.addEventListener('click',\n            this.handleSpellCheckLanguageButtonClick_.bind(this));\n      } else {\n        // If the language is not supported as spell check language, the\n        // button just says that this language cannot be used for spell\n        // checking.\n        spellCheckLanguageButton.textContent =\n            localStrings.getString('cannot_be_used_for_spell_checking');\n        spellCheckLanguageButton.className = 'text-button';\n        spellCheckLanguageButton.onclick = undefined;\n      }\n      spellCheckLanguageButton.style.display = 'block';\n      $('language-options-ui-notification-bar').style.display = 'none';\n    },\n\n    /**\n     * Updates the input method list.\n     * @param {string} languageCode Language code (ex. \"fr\").\n     * @private\n     */\n    updateInputMethodList_: function(languageCode) {\n      // Give one of the checkboxes or buttons focus, if it's specified in the\n      // URL hash (ex. focus=mozc). Used for automated testing.\n      var focusInputMethodId = -1;\n      var match = document.location.hash.match(/\\bfocus=([\\w:-]+)\\b/);\n      if (match) {\n        focusInputMethodId = match[1];\n      }\n      // Change the visibility of the input method list. Input methods that\n      // matches |languageCode| will become visible.\n      var inputMethodList = $('language-options-input-method-list');\n      var labels = inputMethodList.querySelectorAll('label');\n      for (var i = 0; i < labels.length; i++) {\n        var label = labels[i];\n        if (languageCode in label.languageCodeSet) {\n          label.style.display = 'block';\n          var input = label.childNodes[0];\n          // Give it focus if the ID matches.\n          if (input.inputMethodId == focusInputMethodId) {\n            input.focus();\n          }\n        } else {\n          label.style.display = 'none';\n        }\n      }\n      if (focusInputMethodId == 'remove') {\n        $('language-options-remove-button').focus();\n      } else if (focusInputMethodId == 'add') {\n        $('language-options-add-button').focus();\n      }\n    },\n\n    /**\n     * Updates the language list in the add language overlay.\n     * @param {string} languageCode Language code (ex. \"fr\").\n     * @private\n     */\n    updateLanguageListInAddLanguageOverlay_: function(languageCode) {\n      // Change the visibility of the language list in the add language\n      // overlay. Languages that are already active will become invisible,\n      // so that users don't add the same language twice.\n      var languageOptionsList = $('language-options-list');\n      var languageCodes = languageOptionsList.getLanguageCodes();\n      var languageCodeSet = {};\n      for (var i = 0; i < languageCodes.length; i++) {\n        languageCodeSet[languageCodes[i]] = true;\n      }\n      var addLanguageList = $('add-language-overlay-language-list');\n      var lis = addLanguageList.querySelectorAll('li');\n      for (var i = 0; i < lis.length; i++) {\n        // The first child button knows the language code.\n        var button = lis[i].childNodes[0];\n        if (button.languageCode in languageCodeSet) {\n          lis[i].style.display = 'none';\n        } else {\n          lis[i].style.display = 'block';\n        }\n      }\n    },\n\n    /**\n     * Handles preloadEnginesPref change.\n     * @param {Event} e Change event.\n     * @private\n     */\n    handlePreloadEnginesPrefChange_: function(e) {\n      var value = e.value.value;\n      this.preloadEngines_ = this.filterBadPreloadEngines_(value.split(','));\n      this.updateCheckboxesFromPreloadEngines_();\n    },\n\n    /**\n     * Handles input method checkbox's click event.\n     * @param {Event} e Click event.\n     * @private\n     */\n    handleCheckboxClick_ : function(e) {\n      var checkbox = e.target;\n      if (this.preloadEngines_.length == 1 && !checkbox.checked) {\n        // Don't allow disabling the last input method.\n        this.showNotification_(\n            localStrings.getString('please_add_another_input_method'),\n            localStrings.getString('ok_button'));\n        checkbox.checked = true;\n        return;\n      }\n      if (checkbox.checked) {\n        chrome.send('inputMethodEnable', [checkbox.inputMethodId]);\n      } else {\n        chrome.send('inputMethodDisable', [checkbox.inputMethodId]);\n      }\n      this.updatePreloadEnginesFromCheckboxes_();\n      this.preloadEngines_ = this.sortPreloadEngines_(this.preloadEngines_);\n      this.savePreloadEnginesPref_();\n    },\n\n    /**\n     * Handles add language list's click event.\n     * @param {Event} e Click event.\n     */\n    handleAddLanguageListClick_ : function(e) {\n      var languageOptionsList = $('language-options-list');\n      var languageCode = e.target.languageCode;\n      // languageCode can be undefined, if click was made on some random\n      // place in the overlay, rather than a button. Ignore it.\n      if (!languageCode) {\n        return;\n      }\n      languageOptionsList.addLanguage(languageCode);\n      var inputMethodIds = this.languageCodeToInputMethodIdsMap_[languageCode];\n      // Enable the first input method for the language added.\n      if (inputMethodIds && inputMethodIds[0] &&\n          // Don't add the input method it's already present. This can\n          // happen if the same input method is shared among multiple\n          // languages (ex. English US keyboard is used for English US and\n          // Filipino).\n          this.preloadEngines_.indexOf(inputMethodIds[0]) == -1) {\n        this.preloadEngines_.push(inputMethodIds[0]);\n        this.updateCheckboxesFromPreloadEngines_();\n        this.savePreloadEnginesPref_();\n      }\n      OptionsPage.clearOverlays();\n    },\n\n    /**\n     * Handles add language dialog ok button.\n     */\n    handleAddLanguageOkButtonClick_ : function() {\n      var languagesSelect = $('add-language-overlay-language-list');\n      var selectedIndex = languagesSelect.selectedIndex;\n      if (selectedIndex >= 0) {\n        var selection = languagesSelect.options[selectedIndex];\n        $('language-options-list').addLanguage(String(selection.value));\n        OptionsPage.clearOverlays();\n      }\n    },\n\n    /**\n     * Handles remove button's click event.\n     * @param {Event} e Click event.\n     */\n    handleRemoveButtonClick_: function(e) {\n      var languageOptionsList = $('language-options-list');\n      var languageCode = languageOptionsList.getSelectedLanguageCode();\n      // Don't allow removing the language if it's as UI language.\n      if (languageCode == templateData.currentUiLanguageCode) {\n        this.showNotification_(\n            localStrings.getString('this_language_is_currently_in_use'),\n            localStrings.getString('ok_button'));\n        return;\n      }\n      if (cr.isChromeOS) {\n        // Disable input methods associated with |languageCode|.\n        // Don't allow removing the language if cerntain conditions are met.\n        // See removePreloadEnginesByLanguageCode_() for details.\n        if (!this.removePreloadEnginesByLanguageCode_(languageCode)) {\n          this.showNotification_(\n              localStrings.getString('please_add_another_language'),\n              localStrings.getString('ok_button'));\n          return;\n        }\n      }\n      languageOptionsList.removeSelectedLanguage();\n    },\n\n    /**\n     * Handles spellCheckDictionaryPref change.\n     * @param {Event} e Change event.\n     * @private\n     */\n    handleSpellCheckDictionaryPrefChange_: function(e) {\n      var languageCode = e.value.value\n      this.spellCheckDictionary_ = languageCode;\n      var languageOptionsList = $('language-options-list');\n      var selectedLanguageCode = languageOptionsList.getSelectedLanguageCode();\n      this.updateSpellCheckLanguageButton_(selectedLanguageCode);\n    },\n\n    /**\n     * Handles spellCheckLanguageButton click.\n     * @param {Event} e Click event.\n     * @private\n     */\n    handleSpellCheckLanguageButtonClick_: function(e) {\n      var languageCode = e.target.languageCode;\n      // Save the preference.\n      Preferences.setStringPref(this.spellCheckDictionaryPref,\n                                languageCode);\n      chrome.send('spellCheckLanguageChange', [languageCode]);\n    },\n\n    /**\n     * Removes preload engines associated with the given language code.\n     * However, this function does not remove engines (input methods) that\n     * are used for other active languages. For instance, if \"xkb:us::eng\"\n     * is used for English and Filipino, and the two languages are active,\n     * this function does not remove \"xkb:us::eng\" when either of these\n     * languages is removed. Instead, it'll remove \"xkb:us::eng\" when the\n     * both languages are gone.\n     *\n     * @param {string} languageCode Language code (ex. \"fr\").\n     * @return {boolean} Returns true on success.\n     * @private\n     */\n    removePreloadEnginesByLanguageCode_: function(languageCode) {\n      // First create the set of engines to be removed from input methods\n      // associated with the language code.\n      var enginesToBeRemovedSet = {};\n      var inputMethodIds = this.languageCodeToInputMethodIdsMap_[languageCode];\n      for (var i = 0; i < inputMethodIds.length; i++) {\n        enginesToBeRemovedSet[inputMethodIds[i]] = true;\n      }\n\n      // Then eliminate engines that are also used for other active languages.\n      var languageCodes = $('language-options-list').getLanguageCodes();\n      for (var i = 0; i < languageCodes.length; i++) {\n        // Skip the target language code.\n        if (languageCodes[i] == languageCode) {\n          continue;\n        }\n        // Check if input methods used in this language are included in\n        // enginesToBeRemovedSet. If so, eliminate these from the set, so\n        // we don't remove this time.\n        var inputMethodIdsForAnotherLanguage =\n            this.languageCodeToInputMethodIdsMap_[languageCodes[i]];\n        for (var j = 0; j < inputMethodIdsForAnotherLanguage.length; j++) {\n          var inputMethodId = inputMethodIdsForAnotherLanguage[j];\n          if (inputMethodId in enginesToBeRemovedSet) {\n            delete enginesToBeRemovedSet[inputMethodId];\n          }\n        }\n      }\n\n      // Update the preload engine list with the to-be-removed set.\n      var newPreloadEngines = [];\n      for (var i = 0; i < this.preloadEngines_.length; i++) {\n        if (!(this.preloadEngines_[i] in enginesToBeRemovedSet)) {\n          newPreloadEngines.push(this.preloadEngines_[i]);\n        }\n      }\n      // Don't allow this operation if it causes the number of preload\n      // engines to be zero.\n      if (newPreloadEngines.length == 0) {\n        return false;\n      }\n      this.preloadEngines_ = newPreloadEngines;\n      this.savePreloadEnginesPref_();\n      return true;\n    },\n\n    /**\n     * Saves the preload engines preference.\n     * @private\n     */\n    savePreloadEnginesPref_: function() {\n      Preferences.setStringPref(this.preloadEnginesPref,\n                                this.preloadEngines_.join(','));\n    },\n\n    /**\n     * Updates the checkboxes in the input method list from the preload\n     * engines preference.\n     * @private\n     */\n    updateCheckboxesFromPreloadEngines_: function() {\n      // Convert the list into a dictonary for simpler lookup.\n      var dictionary = {};\n      for (var i = 0; i < this.preloadEngines_.length; i++) {\n        dictionary[this.preloadEngines_[i]] = true;\n      }\n\n      var inputMethodList = $('language-options-input-method-list');\n      var checkboxes = inputMethodList.querySelectorAll('input');\n      for (var i = 0; i < checkboxes.length; i++) {\n        checkboxes[i].checked = (checkboxes[i].inputMethodId in dictionary);\n      }\n    },\n\n    /**\n     * Updates the preload engines preference from the checkboxes in the\n     * input method list.\n     * @private\n     */\n    updatePreloadEnginesFromCheckboxes_: function() {\n      this.preloadEngines_ = [];\n      var inputMethodList = $('language-options-input-method-list');\n      var checkboxes = inputMethodList.querySelectorAll('input');\n      for (var i = 0; i < checkboxes.length; i++) {\n        if (checkboxes[i].checked) {\n          this.preloadEngines_.push(checkboxes[i].inputMethodId);\n        }\n      }\n    },\n\n    /**\n     * Filters bad preload engines in case bad preload engines are\n     * stored in the preference. Removes duplicates as well.\n     * @param {Array} preloadEngines List of preload engines.\n     * @private\n     */\n    filterBadPreloadEngines_: function(preloadEngines) {\n      // Convert the list into a dictonary for simpler lookup.\n      var dictionary = {};\n      for (var i = 0; i < templateData.inputMethodList.length; i++) {\n        dictionary[templateData.inputMethodList[i].id] = true;\n      }\n\n      var filteredPreloadEngines = [];\n      var seen = {};\n      for (var i = 0; i < preloadEngines.length; i++) {\n        // Check if the preload engine is present in the\n        // dictionary, and not duplicate. Otherwise, skip it.\n        if (preloadEngines[i] in dictionary && !(preloadEngines[i] in seen)) {\n          filteredPreloadEngines.push(preloadEngines[i]);\n          seen[preloadEngines[i]] = true;\n        }\n      }\n      return filteredPreloadEngines;\n    },\n\n    // TODO(kochi): This is an adapted copy from new_new_tab.js.\n    // If this will go as final UI, refactor this to share the component with\n    // new new tab page.\n    /**\n     * Shows notification\n     * @private\n     */\n    notificationTimeout_: null,\n    showNotification_ : function(text, actionText, opt_delay) {\n      var notificationElement = $('notification');\n      var actionLink = notificationElement.querySelector('.link-color');\n      var delay = opt_delay || 10000;\n\n      function show() {\n        window.clearTimeout(this.notificationTimeout_);\n        notificationElement.classList.add('show');\n        document.body.classList.add('notification-shown');\n      }\n\n      function hide() {\n        window.clearTimeout(this.notificationTimeout_);\n        notificationElement.classList.remove('show');\n        document.body.classList.remove('notification-shown');\n        // Prevent tabbing to the hidden link.\n        actionLink.tabIndex = -1;\n        // Setting tabIndex to -1 only prevents future tabbing to it. If,\n        // however, the user switches window or a tab and then moves back to\n        // this tab the element may gain focus. We therefore make sure that we\n        // blur the element so that the element focus is not restored when\n        // coming back to this window.\n        actionLink.blur();\n      }\n\n      function delayedHide() {\n        this.notificationTimeout_ = window.setTimeout(hide, delay);\n      }\n\n      notificationElement.firstElementChild.textContent = text;\n      actionLink.textContent = actionText;\n\n      actionLink.onclick = hide;\n      actionLink.onkeydown = function(e) {\n        if (e.keyIdentifier == 'Enter') {\n          hide();\n        }\n      };\n      notificationElement.onmouseover = show;\n      notificationElement.onmouseout = delayedHide;\n      actionLink.onfocus = show;\n      actionLink.onblur = delayedHide;\n      // Enable tabbing to the link now that it is shown.\n      actionLink.tabIndex = 0;\n\n      show();\n      delayedHide();\n    }\n  };\n\n  /**\n   * Chrome callback for when the UI language preference is saved.\n   */\n  LanguageOptions.uiLanguageSaved = function() {\n    $('language-options-ui-language-button').style.display = 'none';\n    $('language-options-ui-notification-bar').style.display = 'block';\n  };\n\n  // Export\n  return {\n    LanguageOptions: LanguageOptions\n  };\n\n});\n",
                "new_contents": "// Copyright (c) 2011 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n// TODO(kochi): Generalize the notification as a component and put it\n// in js/cr/ui/notification.js .\n\ncr.define('options', function() {\n\n  const OptionsPage = options.OptionsPage;\n  const AddLanguageOverlay = options.language.AddLanguageOverlay;\n  const LanguageList = options.language.LanguageList;\n\n  // Some input methods like Chinese Pinyin have config pages.\n  // This is the map of the input method names to their config page names.\n  const INPUT_METHOD_ID_TO_CONFIG_PAGE_NAME = {\n    'chewing': 'languageChewing',\n    'hangul': 'languageHangul',\n    'mozc': 'languageMozc',\n    'mozc-dv': 'languageMozc',\n    'mozc-jp': 'languageMozc',\n    'pinyin': 'languagePinyin',\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  // LanguageOptions class:\n\n  /**\n   * Encapsulated handling of ChromeOS language options page.\n   * @constructor\n   */\n  function LanguageOptions(model) {\n    OptionsPage.call(this, 'language', localStrings.getString('languagePage'),\n                     'languagePage');\n  }\n\n  cr.addSingletonGetter(LanguageOptions);\n\n  // Inherit LanguageOptions from OptionsPage.\n  LanguageOptions.prototype = {\n    __proto__: OptionsPage.prototype,\n\n    /**\n     * Initializes LanguageOptions page.\n     * Calls base class implementation to starts preference initialization.\n     */\n    initializePage: function() {\n      OptionsPage.prototype.initializePage.call(this);\n\n      var languageOptionsList = $('language-options-list');\n      LanguageList.decorate(languageOptionsList);\n\n      languageOptionsList.addEventListener('change',\n          this.handleLanguageOptionsListChange_.bind(this));\n      languageOptionsList.addEventListener('save',\n          this.handleLanguageOptionsListSave_.bind(this));\n\n      this.addEventListener('visibleChange',\n                            this.handleVisibleChange_.bind(this));\n\n      if (cr.isChromeOS) {\n        this.initializeInputMethodList_();\n        this.initializeLanguageCodeToInputMehotdIdsMap_();\n      }\n      Preferences.getInstance().addEventListener(this.spellCheckDictionaryPref,\n          this.handleSpellCheckDictionaryPrefChange_.bind(this));\n\n      // Set up add button.\n      $('language-options-add-button').onclick = function(e) {\n        // Add the language without showing the overlay if it's specified in\n        // the URL hash (ex. lang_add=ja).  Used for automated testing.\n        var match = document.location.hash.match(/\\blang_add=([\\w-]+)/);\n        if (match) {\n          var addLanguageCode = match[1];\n          $('language-options-list').addLanguage(addLanguageCode);\n        } else {\n          OptionsPage.showOverlay('addLanguageOverlay');\n        }\n      };\n      // Set up remove button.\n      $('language-options-remove-button').addEventListener('click',\n          this.handleRemoveButtonClick_.bind(this));\n\n      // Setup add language overlay page.\n      OptionsPage.registerOverlay(AddLanguageOverlay.getInstance());\n\n      if (cr.isChromeOS) {\n        // Listen to user clicks on the add language list.\n        var addLanguageList = $('add-language-overlay-language-list');\n        addLanguageList.addEventListener('click',\n            this.handleAddLanguageListClick_.bind(this));\n      } else {\n        // Listen to add language dialog ok button.\n        var addLanguageOkButton = $('add-language-overlay-ok-button');\n        addLanguageOkButton.addEventListener('click',\n            this.handleAddLanguageOkButtonClick_.bind(this));\n\n        // Show experimental features if enabled.\n        if (templateData.experimentalSpellCheckFeatures == 'true') {\n          $('auto-spell-correction-option').classList.remove('hidden');\n        }\n      }\n    },\n\n    // The preference is a CSV string that describes preload engines\n    // (i.e. active input methods).\n    preloadEnginesPref: 'settings.language.preload_engines',\n    // The list of preload engines, like ['mozc', 'pinyin'].\n    preloadEngines_: [],\n    // The preference is a string that describes the spell check\n    // dictionary language, like \"en-US\".\n    spellCheckDictionaryPref: 'spellcheck.dictionary',\n    spellCheckDictionary_: \"\",\n    // The map of language code to input method IDs, like:\n    // {'ja': ['mozc', 'mozc-jp'], 'zh-CN': ['pinyin'], ...}\n    languageCodeToInputMethodIdsMap_: {},\n\n    /**\n     * Initializes the input method list.\n     */\n    initializeInputMethodList_: function() {\n      var inputMethodList = $('language-options-input-method-list');\n      var inputMethodListData = templateData.inputMethodList;\n\n      // Add all input methods, but make all of them invisible here. We'll\n      // change the visibility in handleLanguageOptionsListChange_() based\n      // on the selected language. Note that we only have less than 100\n      // input methods, so creating DOM nodes at once here should be ok.\n      for (var i = 0; i < inputMethodListData.length; i++) {\n        var inputMethod = inputMethodListData[i];\n        var input = document.createElement('input');\n        input.type = 'checkbox';\n        input.inputMethodId = inputMethod.id;\n        // Listen to user clicks.\n        input.addEventListener('click',\n                               this.handleCheckboxClick_.bind(this));\n        var label = document.createElement('label');\n        label.appendChild(input);\n        // Adding a space between the checkbox and the text. This is a bit\n        // dirty, but we rely on a space character for all other checkboxes.\n        label.appendChild(document.createTextNode(\n            ' ' + inputMethod.displayName));\n        label.style.display = 'none';\n        label.languageCodeSet = inputMethod.languageCodeSet;\n        // Add the configure button if the config page is present for this\n        // input method.\n        if (inputMethod.id in INPUT_METHOD_ID_TO_CONFIG_PAGE_NAME) {\n          var pageName = INPUT_METHOD_ID_TO_CONFIG_PAGE_NAME[inputMethod.id];\n          var button = this.createConfigureInputMethodButton_(inputMethod.id,\n                                                              pageName);\n          label.appendChild(button);\n        }\n\n        inputMethodList.appendChild(label);\n      }\n      // Listen to pref change once the input method list is initialized.\n      Preferences.getInstance().addEventListener(this.preloadEnginesPref,\n          this.handlePreloadEnginesPrefChange_.bind(this));\n    },\n\n    /**\n     * Creates a configure button for the given input method ID.\n     * @param {string} inputMethodId Input method ID (ex. \"pinyin\").\n     * @param {string} pageName Name of the config page (ex. \"languagePinyin\").\n     * @private\n     */\n    createConfigureInputMethodButton_: function(inputMethodId, pageName) {\n      var button = document.createElement('button');\n      button.textContent = localStrings.getString('configure');\n      button.onclick = function(e) {\n        // Prevent the default action (i.e. changing the checked property\n        // of the checkbox). The button click here should not be handled\n        // as checkbox click.\n        e.preventDefault();\n        chrome.send('inputMethodOptionsOpen', [inputMethodId]);\n        OptionsPage.showPageByName(pageName);\n      }\n      return button;\n    },\n\n    /**\n     * Handles OptionsPage's visible property change event.\n     * @param {Event} e Property change event.\n     * @private\n     */\n    handleVisibleChange_: function(e) {\n      if (this.visible) {\n        $('language-options-list').redraw();\n        chrome.send('languageOptionsOpen');\n      }\n    },\n\n    /**\n     * Handles languageOptionsList's change event.\n     * @param {Event} e Change event.\n     * @private\n     */\n    handleLanguageOptionsListChange_: function(e) {\n      var languageOptionsList = $('language-options-list');\n      var languageCode = languageOptionsList.getSelectedLanguageCode();\n      // Select the language if it's specified in the URL hash (ex. lang=ja).\n      // Used for automated testing.\n      var match = document.location.hash.match(/\\blang=([\\w-]+)/);\n      if (match) {\n        var specifiedLanguageCode = match[1];\n        if (languageOptionsList.selectLanguageByCode(specifiedLanguageCode)) {\n          languageCode = specifiedLanguageCode;\n        }\n      }\n      this.updateSelectedLanguageName_(languageCode);\n      if (!cr.isMac)\n        this.updateUiLanguageButton_(languageCode);\n      this.updateSpellCheckLanguageButton_(languageCode);\n      if (cr.isChromeOS)\n        this.updateInputMethodList_(languageCode);\n      this.updateLanguageListInAddLanguageOverlay_();\n    },\n\n    /**\n     * Handles languageOptionsList's save event.\n     * @param {Event} e Save event.\n     * @private\n     */\n    handleLanguageOptionsListSave_: function(e) {\n      if (cr.isChromeOS) {\n        // Sort the preload engines per the saved languages before save.\n        this.preloadEngines_ = this.sortPreloadEngines_(this.preloadEngines_);\n        this.savePreloadEnginesPref_();\n      }\n    },\n\n    /**\n     * Sorts preloadEngines_ by languageOptionsList's order.\n     * @param {Array} preloadEngines List of preload engines.\n     * @return {Array} Returns sorted preloadEngines.\n     * @private\n     */\n    sortPreloadEngines_: function(preloadEngines) {\n      // For instance, suppose we have two languages and associated input\n      // methods:\n      //\n      // - Korean: hangul\n      // - Chinese: pinyin\n      //\n      // The preloadEngines preference should look like \"hangul,pinyin\".\n      // If the user reverse the order, the preference should be reorderd\n      // to \"pinyin,hangul\".\n      var languageOptionsList = $('language-options-list');\n      var languageCodes = languageOptionsList.getLanguageCodes();\n\n      // Convert the list into a dictonary for simpler lookup.\n      var preloadEngineSet = {};\n      for (var i = 0; i < preloadEngines.length; i++) {\n        preloadEngineSet[preloadEngines[i]] = true;\n      }\n\n      // Create the new preload engine list per the language codes.\n      var newPreloadEngines = [];\n      for (var i = 0; i < languageCodes.length; i++) {\n        var languageCode = languageCodes[i];\n        var inputMethodIds = this.languageCodeToInputMethodIdsMap_[\n            languageCode];\n        // Check if we have active input methods associated with the language.\n        for (var j = 0; j < inputMethodIds.length; j++) {\n          var inputMethodId = inputMethodIds[j];\n          if (inputMethodId in preloadEngineSet) {\n            // If we have, add it to the new engine list.\n            newPreloadEngines.push(inputMethodId);\n            // And delete it from the set. This is necessary as one input\n            // method can be associated with more than one language thus\n            // we should avoid having duplicates in the new list.\n            delete preloadEngineSet[inputMethodId];\n          }\n        }\n      }\n\n      return newPreloadEngines;\n    },\n\n    /**\n     * Initializes the map of language code to input method IDs.\n     * @private\n     */\n    initializeLanguageCodeToInputMehotdIdsMap_: function() {\n      var inputMethodList = templateData.inputMethodList;\n      for (var i = 0; i < inputMethodList.length; i++) {\n        var inputMethod = inputMethodList[i];\n        for (var languageCode in inputMethod.languageCodeSet) {\n          if (languageCode in this.languageCodeToInputMethodIdsMap_) {\n            this.languageCodeToInputMethodIdsMap_[languageCode].push(\n                inputMethod.id);\n          } else {\n            this.languageCodeToInputMethodIdsMap_[languageCode] =\n                [inputMethod.id];\n          }\n        }\n      }\n    },\n\n    /**\n     * Updates the currently selected language name.\n     * @param {string} languageCode Language code (ex. \"fr\").\n     * @private\n     */\n    updateSelectedLanguageName_: function(languageCode) {\n      var languageDisplayName = LanguageList.getDisplayNameFromLanguageCode(\n          languageCode);\n      var languageNativeDisplayName =\n          LanguageList.getNativeDisplayNameFromLanguageCode(languageCode);\n      // If the native name is different, add it.\n      if (languageDisplayName != languageNativeDisplayName) {\n        languageDisplayName += ' - ' + languageNativeDisplayName;\n      }\n      // Update the currently selected language name.\n      $('language-options-language-name').textContent = languageDisplayName;\n    },\n\n    /**\n     * Updates the UI language button.\n     * @param {string} languageCode Language code (ex. \"fr\").\n     * @private\n     */\n    updateUiLanguageButton_: function(languageCode) {\n      var uiLanguageButton = $('language-options-ui-language-button');\n      // Check if the language code matches the current UI language.\n      if (languageCode == templateData.currentUiLanguageCode) {\n        // If it matches, the button just says that the UI language is\n        // currently in use.\n        uiLanguageButton.textContent =\n            localStrings.getString('is_displayed_in_this_language');\n        // Make it look like a text label.\n        uiLanguageButton.className = 'text-button';\n        // Remove the event listner.\n        uiLanguageButton.onclick = undefined;\n      } else if (languageCode in templateData.uiLanguageCodeSet) {\n        // If the language is supported as UI language, users can click on\n        // the button to change the UI language.\n        uiLanguageButton.textContent =\n            localStrings.getString('display_in_this_language');\n        uiLanguageButton.className = '';\n        // Send the change request to Chrome.\n        uiLanguageButton.onclick = function(e) {\n          chrome.send('uiLanguageChange', [languageCode]);\n        }\n        $('language-options-ui-restart-button').onclick = function(e) {\n          chrome.send('uiLanguageRestart');\n        }\n      } else {\n        // If the language is not supported as UI language, the button\n        // just says that Chromium OS cannot be displayed in this language.\n        uiLanguageButton.textContent =\n            localStrings.getString('cannot_be_displayed_in_this_language');\n        uiLanguageButton.className = 'text-button';\n        uiLanguageButton.onclick = undefined;\n      }\n      uiLanguageButton.style.display = 'block';\n      $('language-options-ui-notification-bar').style.display = 'none';\n    },\n\n    /**\n     * Updates the spell check language button.\n     * @param {string} languageCode Language code (ex. \"fr\").\n     * @private\n     */\n    updateSpellCheckLanguageButton_: function(languageCode) {\n      var spellCheckLanguageButton = $(\n          'language-options-spell-check-language-button');\n      // Check if the language code matches the current spell check language.\n      if (languageCode == this.spellCheckDictionary_) {\n        // If it matches, the button just says that the spell check language is\n        // currently in use.\n        spellCheckLanguageButton.textContent =\n            localStrings.getString('is_used_for_spell_checking');\n        // Make it look like a text label.\n        spellCheckLanguageButton.className = 'text-button';\n        // Remove the event listner.\n        spellCheckLanguageButton.onclick = undefined;\n      } else if (languageCode in templateData.spellCheckLanguageCodeSet) {\n        // If the language is supported as spell check language, users can\n        // click on the button to change the spell check language.\n        spellCheckLanguageButton.textContent =\n            localStrings.getString('use_this_for_spell_checking');\n        spellCheckLanguageButton.className = '';\n        spellCheckLanguageButton.languageCode = languageCode;\n        // Add an event listner to the click event.\n        spellCheckLanguageButton.addEventListener('click',\n            this.handleSpellCheckLanguageButtonClick_.bind(this));\n      } else {\n        // If the language is not supported as spell check language, the\n        // button just says that this language cannot be used for spell\n        // checking.\n        spellCheckLanguageButton.textContent =\n            localStrings.getString('cannot_be_used_for_spell_checking');\n        spellCheckLanguageButton.className = 'text-button';\n        spellCheckLanguageButton.onclick = undefined;\n      }\n      spellCheckLanguageButton.style.display = 'block';\n      $('language-options-ui-notification-bar').style.display = 'none';\n    },\n\n    /**\n     * Updates the input method list.\n     * @param {string} languageCode Language code (ex. \"fr\").\n     * @private\n     */\n    updateInputMethodList_: function(languageCode) {\n      // Give one of the checkboxes or buttons focus, if it's specified in the\n      // URL hash (ex. focus=mozc). Used for automated testing.\n      var focusInputMethodId = -1;\n      var match = document.location.hash.match(/\\bfocus=([\\w:-]+)\\b/);\n      if (match) {\n        focusInputMethodId = match[1];\n      }\n      // Change the visibility of the input method list. Input methods that\n      // matches |languageCode| will become visible.\n      var inputMethodList = $('language-options-input-method-list');\n      var labels = inputMethodList.querySelectorAll('label');\n      for (var i = 0; i < labels.length; i++) {\n        var label = labels[i];\n        if (languageCode in label.languageCodeSet) {\n          label.style.display = 'block';\n          var input = label.childNodes[0];\n          // Give it focus if the ID matches.\n          if (input.inputMethodId == focusInputMethodId) {\n            input.focus();\n          }\n        } else {\n          label.style.display = 'none';\n        }\n      }\n      if (focusInputMethodId == 'remove') {\n        $('language-options-remove-button').focus();\n      } else if (focusInputMethodId == 'add') {\n        $('language-options-add-button').focus();\n      }\n    },\n\n    /**\n     * Updates the language list in the add language overlay.\n     * @param {string} languageCode Language code (ex. \"fr\").\n     * @private\n     */\n    updateLanguageListInAddLanguageOverlay_: function(languageCode) {\n      // Change the visibility of the language list in the add language\n      // overlay. Languages that are already active will become invisible,\n      // so that users don't add the same language twice.\n      var languageOptionsList = $('language-options-list');\n      var languageCodes = languageOptionsList.getLanguageCodes();\n      var languageCodeSet = {};\n      for (var i = 0; i < languageCodes.length; i++) {\n        languageCodeSet[languageCodes[i]] = true;\n      }\n      var addLanguageList = $('add-language-overlay-language-list');\n      var lis = addLanguageList.querySelectorAll('li');\n      for (var i = 0; i < lis.length; i++) {\n        // The first child button knows the language code.\n        var button = lis[i].childNodes[0];\n        if (button.languageCode in languageCodeSet) {\n          lis[i].style.display = 'none';\n        } else {\n          lis[i].style.display = 'block';\n        }\n      }\n    },\n\n    /**\n     * Handles preloadEnginesPref change.\n     * @param {Event} e Change event.\n     * @private\n     */\n    handlePreloadEnginesPrefChange_: function(e) {\n      var value = e.value.value;\n      this.preloadEngines_ = this.filterBadPreloadEngines_(value.split(','));\n      this.updateCheckboxesFromPreloadEngines_();\n    },\n\n    /**\n     * Handles input method checkbox's click event.\n     * @param {Event} e Click event.\n     * @private\n     */\n    handleCheckboxClick_ : function(e) {\n      var checkbox = e.target;\n      if (this.preloadEngines_.length == 1 && !checkbox.checked) {\n        // Don't allow disabling the last input method.\n        this.showNotification_(\n            localStrings.getString('please_add_another_input_method'),\n            localStrings.getString('ok_button'));\n        checkbox.checked = true;\n        return;\n      }\n      if (checkbox.checked) {\n        chrome.send('inputMethodEnable', [checkbox.inputMethodId]);\n      } else {\n        chrome.send('inputMethodDisable', [checkbox.inputMethodId]);\n      }\n      this.updatePreloadEnginesFromCheckboxes_();\n      this.preloadEngines_ = this.sortPreloadEngines_(this.preloadEngines_);\n      this.savePreloadEnginesPref_();\n    },\n\n    /**\n     * Handles add language list's click event.\n     * @param {Event} e Click event.\n     */\n    handleAddLanguageListClick_ : function(e) {\n      var languageOptionsList = $('language-options-list');\n      var languageCode = e.target.languageCode;\n      // languageCode can be undefined, if click was made on some random\n      // place in the overlay, rather than a button. Ignore it.\n      if (!languageCode) {\n        return;\n      }\n      languageOptionsList.addLanguage(languageCode);\n      var inputMethodIds = this.languageCodeToInputMethodIdsMap_[languageCode];\n      // Enable the first input method for the language added.\n      if (inputMethodIds && inputMethodIds[0] &&\n          // Don't add the input method it's already present. This can\n          // happen if the same input method is shared among multiple\n          // languages (ex. English US keyboard is used for English US and\n          // Filipino).\n          this.preloadEngines_.indexOf(inputMethodIds[0]) == -1) {\n        this.preloadEngines_.push(inputMethodIds[0]);\n        this.updateCheckboxesFromPreloadEngines_();\n        this.savePreloadEnginesPref_();\n      }\n      OptionsPage.clearOverlays();\n    },\n\n    /**\n     * Handles add language dialog ok button.\n     */\n    handleAddLanguageOkButtonClick_ : function() {\n      var languagesSelect = $('add-language-overlay-language-list');\n      var selectedIndex = languagesSelect.selectedIndex;\n      if (selectedIndex >= 0) {\n        var selection = languagesSelect.options[selectedIndex];\n        $('language-options-list').addLanguage(String(selection.value));\n        OptionsPage.clearOverlays();\n      }\n    },\n\n    /**\n     * Handles remove button's click event.\n     * @param {Event} e Click event.\n     */\n    handleRemoveButtonClick_: function(e) {\n      var languageOptionsList = $('language-options-list');\n      var languageCode = languageOptionsList.getSelectedLanguageCode();\n      // Don't allow removing the language if it's as UI language.\n      if (languageCode == templateData.currentUiLanguageCode) {\n        this.showNotification_(\n            localStrings.getString('this_language_is_currently_in_use'),\n            localStrings.getString('ok_button'));\n        return;\n      }\n      if (cr.isChromeOS) {\n        // Disable input methods associated with |languageCode|.\n        // Don't allow removing the language if cerntain conditions are met.\n        // See removePreloadEnginesByLanguageCode_() for details.\n        if (!this.removePreloadEnginesByLanguageCode_(languageCode)) {\n          this.showNotification_(\n              localStrings.getString('please_add_another_language'),\n              localStrings.getString('ok_button'));\n          return;\n        }\n      }\n      languageOptionsList.removeSelectedLanguage();\n    },\n\n    /**\n     * Handles spellCheckDictionaryPref change.\n     * @param {Event} e Change event.\n     * @private\n     */\n    handleSpellCheckDictionaryPrefChange_: function(e) {\n      var languageCode = e.value.value\n      this.spellCheckDictionary_ = languageCode;\n      var languageOptionsList = $('language-options-list');\n      var selectedLanguageCode = languageOptionsList.getSelectedLanguageCode();\n      this.updateSpellCheckLanguageButton_(selectedLanguageCode);\n    },\n\n    /**\n     * Handles spellCheckLanguageButton click.\n     * @param {Event} e Click event.\n     * @private\n     */\n    handleSpellCheckLanguageButtonClick_: function(e) {\n      var languageCode = e.target.languageCode;\n      // Save the preference.\n      Preferences.setStringPref(this.spellCheckDictionaryPref,\n                                languageCode);\n      chrome.send('spellCheckLanguageChange', [languageCode]);\n    },\n\n    /**\n     * Removes preload engines associated with the given language code.\n     * However, this function does not remove engines (input methods) that\n     * are used for other active languages. For instance, if \"xkb:us::eng\"\n     * is used for English and Filipino, and the two languages are active,\n     * this function does not remove \"xkb:us::eng\" when either of these\n     * languages is removed. Instead, it'll remove \"xkb:us::eng\" when the\n     * both languages are gone.\n     *\n     * @param {string} languageCode Language code (ex. \"fr\").\n     * @return {boolean} Returns true on success.\n     * @private\n     */\n    removePreloadEnginesByLanguageCode_: function(languageCode) {\n      // First create the set of engines to be removed from input methods\n      // associated with the language code.\n      var enginesToBeRemovedSet = {};\n      var inputMethodIds = this.languageCodeToInputMethodIdsMap_[languageCode];\n      for (var i = 0; i < inputMethodIds.length; i++) {\n        enginesToBeRemovedSet[inputMethodIds[i]] = true;\n      }\n\n      // Then eliminate engines that are also used for other active languages.\n      var languageCodes = $('language-options-list').getLanguageCodes();\n      for (var i = 0; i < languageCodes.length; i++) {\n        // Skip the target language code.\n        if (languageCodes[i] == languageCode) {\n          continue;\n        }\n        // Check if input methods used in this language are included in\n        // enginesToBeRemovedSet. If so, eliminate these from the set, so\n        // we don't remove this time.\n        var inputMethodIdsForAnotherLanguage =\n            this.languageCodeToInputMethodIdsMap_[languageCodes[i]];\n        for (var j = 0; j < inputMethodIdsForAnotherLanguage.length; j++) {\n          var inputMethodId = inputMethodIdsForAnotherLanguage[j];\n          if (inputMethodId in enginesToBeRemovedSet) {\n            delete enginesToBeRemovedSet[inputMethodId];\n          }\n        }\n      }\n\n      // Update the preload engine list with the to-be-removed set.\n      var newPreloadEngines = [];\n      for (var i = 0; i < this.preloadEngines_.length; i++) {\n        if (!(this.preloadEngines_[i] in enginesToBeRemovedSet)) {\n          newPreloadEngines.push(this.preloadEngines_[i]);\n        }\n      }\n      // Don't allow this operation if it causes the number of preload\n      // engines to be zero.\n      if (newPreloadEngines.length == 0) {\n        return false;\n      }\n      this.preloadEngines_ = newPreloadEngines;\n      this.savePreloadEnginesPref_();\n      return true;\n    },\n\n    /**\n     * Saves the preload engines preference.\n     * @private\n     */\n    savePreloadEnginesPref_: function() {\n      Preferences.setStringPref(this.preloadEnginesPref,\n                                this.preloadEngines_.join(','));\n    },\n\n    /**\n     * Updates the checkboxes in the input method list from the preload\n     * engines preference.\n     * @private\n     */\n    updateCheckboxesFromPreloadEngines_: function() {\n      // Convert the list into a dictonary for simpler lookup.\n      var dictionary = {};\n      for (var i = 0; i < this.preloadEngines_.length; i++) {\n        dictionary[this.preloadEngines_[i]] = true;\n      }\n\n      var inputMethodList = $('language-options-input-method-list');\n      var checkboxes = inputMethodList.querySelectorAll('input');\n      for (var i = 0; i < checkboxes.length; i++) {\n        checkboxes[i].checked = (checkboxes[i].inputMethodId in dictionary);\n      }\n    },\n\n    /**\n     * Updates the preload engines preference from the checkboxes in the\n     * input method list.\n     * @private\n     */\n    updatePreloadEnginesFromCheckboxes_: function() {\n      this.preloadEngines_ = [];\n      var inputMethodList = $('language-options-input-method-list');\n      var checkboxes = inputMethodList.querySelectorAll('input');\n      for (var i = 0; i < checkboxes.length; i++) {\n        if (checkboxes[i].checked) {\n          this.preloadEngines_.push(checkboxes[i].inputMethodId);\n        }\n      }\n    },\n\n    /**\n     * Filters bad preload engines in case bad preload engines are\n     * stored in the preference. Removes duplicates as well.\n     * @param {Array} preloadEngines List of preload engines.\n     * @private\n     */\n    filterBadPreloadEngines_: function(preloadEngines) {\n      // Convert the list into a dictonary for simpler lookup.\n      var dictionary = {};\n      for (var i = 0; i < templateData.inputMethodList.length; i++) {\n        dictionary[templateData.inputMethodList[i].id] = true;\n      }\n\n      var filteredPreloadEngines = [];\n      var seen = {};\n      for (var i = 0; i < preloadEngines.length; i++) {\n        // Check if the preload engine is present in the\n        // dictionary, and not duplicate. Otherwise, skip it.\n        if (preloadEngines[i] in dictionary && !(preloadEngines[i] in seen)) {\n          filteredPreloadEngines.push(preloadEngines[i]);\n          seen[preloadEngines[i]] = true;\n        }\n      }\n      return filteredPreloadEngines;\n    },\n\n    // TODO(kochi): This is an adapted copy from new_new_tab.js.\n    // If this will go as final UI, refactor this to share the component with\n    // new new tab page.\n    /**\n     * Shows notification\n     * @private\n     */\n    notificationTimeout_: null,\n    showNotification_ : function(text, actionText, opt_delay) {\n      var notificationElement = $('notification');\n      var actionLink = notificationElement.querySelector('.link-color');\n      var delay = opt_delay || 10000;\n\n      function show() {\n        window.clearTimeout(this.notificationTimeout_);\n        notificationElement.classList.add('show');\n        document.body.classList.add('notification-shown');\n      }\n\n      function hide() {\n        window.clearTimeout(this.notificationTimeout_);\n        notificationElement.classList.remove('show');\n        document.body.classList.remove('notification-shown');\n        // Prevent tabbing to the hidden link.\n        actionLink.tabIndex = -1;\n        // Setting tabIndex to -1 only prevents future tabbing to it. If,\n        // however, the user switches window or a tab and then moves back to\n        // this tab the element may gain focus. We therefore make sure that we\n        // blur the element so that the element focus is not restored when\n        // coming back to this window.\n        actionLink.blur();\n      }\n\n      function delayedHide() {\n        this.notificationTimeout_ = window.setTimeout(hide, delay);\n      }\n\n      notificationElement.firstElementChild.textContent = text;\n      actionLink.textContent = actionText;\n\n      actionLink.onclick = hide;\n      actionLink.onkeydown = function(e) {\n        if (e.keyIdentifier == 'Enter') {\n          hide();\n        }\n      };\n      notificationElement.onmouseover = show;\n      notificationElement.onmouseout = delayedHide;\n      actionLink.onfocus = show;\n      actionLink.onblur = delayedHide;\n      // Enable tabbing to the link now that it is shown.\n      actionLink.tabIndex = 0;\n\n      show();\n      delayedHide();\n    }\n  };\n\n  /**\n   * Chrome callback for when the UI language preference is saved.\n   */\n  LanguageOptions.uiLanguageSaved = function() {\n    $('language-options-ui-language-button').style.display = 'none';\n    $('language-options-ui-notification-bar').style.display = 'block';\n  };\n\n  // Export\n  return {\n    LanguageOptions: LanguageOptions\n  };\n\n});\n",
                "subject": "Fix a layout issue in the input method list in the language options on Chrome",
                "message": "Fix a layout issue in the input method list in the language options on Chrome\n\nBefore the fix, we didn't have any space between a checkbox and the input\nmethod name, which looked bad.\n\nNote that we don't have this problem in other options pages, as our HTML\nfiles are formatted like:\n\n      <input id=\"foobar\" type=\"checkbox\">\n      <span i18n-content=\"foobar\">\n\nthe line break between two elements make a text node of a single space\ninbetween.\n\nBUG=chromium-os:11248\nTEST=on chrome os, open the language options, see the input method list.\n\nReview URL: http://codereview.chromium.org/6241016\n\ngit-svn-id: http://src.chromium.org/svn/trunk/src@72765 4ff67af0-8c30-449e-8e8b-ad334ec8d88c\n\nFormer-commit-id: aaa486d8f90bf6e7a706c5808cf1205b70304411",
                "lang": "JavaScript",
                "license": "bsd-3-clause",
                "repos": "meego-tablet-ux/meego-app-browser,meego-tablet-ux/meego-app-browser,meego-tablet-ux/meego-app-browser,meego-tablet-ux/meego-app-browser,meego-tablet-ux/meego-app-browser,meego-tablet-ux/meego-app-browser,meego-tablet-ux/meego-app-browser,meego-tablet-ux/meego-app-browser,meego-tablet-ux/meego-app-browser,meego-tablet-ux/meego-app-browser"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10219,
            "row": {
                "commit": "fdbc555c8a7378a5f7635e7f393513e12ecaeb11",
                "old_file": "jquery.nette-ajax.js",
                "new_file": "jquery.nette-ajax.js",
                "old_contents": "/**\n * AJAX Nette Framwork plugin for jQuery\n *\n * @copyright Copyright (c) 2009, 2010 Jan Marek\n * @copyright Copyright (c) 2009, 2010 David Grudl\n * @copyright Copyright (c) 2012 Vojtěch Dobeš\n * @license MIT\n */\n\n(function($, undefined) {\n\nif (typeof $ != 'function') return;\n\nvar nette = function () {\n\tvar inner = {\n\t\tself: this,\n\t\tinitialized: false,\n\t\tcontexts: {},\n\t\textensions: {},\n\t\ton: {\n\t\t\tinit: {},\n\t\t\tload: {},\n\t\t\tbefore: {},\n\t\t\tstart: {},\n\t\t\tsuccess: {},\n\t\t\tcomplete: {},\n\t\t\terror: {}\n\t\t},\n\t\tfire: function () {\n\t\t\tvar result = true;\n\t\t\tvar args = Array.prototype.slice.call(arguments);\n\t\t\tvar name = args.shift();\n\t\t\targs.push(inner.self);\n\t\t\t$.each(inner.on[name], function (index, reaction) {\n\t\t\t\tvar temp = reaction.apply(inner.contexts[index], args);\n\t\t\t\treturn result = (temp === undefined || temp);\n\t\t\t});\n\t\t\treturn result;\n\t\t},\n\t\trequestHandler: function (e) {\n\t\t\te.preventDefault();\n\t\t\tif (inner.fire('before', this)) {\n\t\t\t\tvar $el, $form, isForm, isSubmit, data = {};\n\n\t\t\t\t$el = $(this);\n\n\t\t\t\tif ((isForm = $el.is('form')) || (isSubmit = $el.is(':submit'))) {\n\t\t\t\t\tif (isSubmit) {\n\t\t\t\t\t\t$form = $el.closest('form');\n\t\t\t\t\t\tdata[$el.attr('name')] = $el.val() || '';\n\t\t\t\t\t} else if (isForm) {\n\t\t\t\t\t\t$form = $el;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($form.get(0).onsubmit && !$form.get(0).onsubmit()) return null;\n\n\t\t\t\t\tvar values = $form.serializeArray();\n\t\t\t\t\tfor (var i = 0; i < values.length; i++) {\n\t\t\t\t\t\tvar name = values[i].name;\n\t\t\t\t\t\tif (name in data) {\n\t\t\t\t\t\t\tvar val = data[name];\n\t\t\t\t\t\t\tif (!(val instanceof Array)) {\n\t\t\t\t\t\t\t\tval = [val];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tval.push(values[i].value);\n\t\t\t\t\t\t\tdata[name] = val;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdata[name] = values[i].value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar req = $.ajax({\n\t\t\t\t\turl: $form ? $form.attr('action') : this.href,\n\t\t\t\t\tdata: data,\n\t\t\t\t\ttype: $form ? $form.attr('method') : 'get',\n\t\t\t\t\tsuccess: function (payload) {\n\t\t\t\t\t\tinner.fire('success', payload);\n\t\t\t\t\t},\n\t\t\t\t\tcomplete: function () {\n\t\t\t\t\t\tinner.fire('complete');\n\t\t\t\t\t},\n\t\t\t\t\terror: function () {\n\t\t\t\t\t\tinner.fire('error');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tinner.fire('start', req);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.ext = function (name, callbacks, context) {\n\t\tif (inner.initialized) throw 'Cannot manipulate nette-ajax extensions after initialization.';\n\n\t\tif (callbacks === undefined) {\n\t\t\treturn inner.extensions[name];\n\t\t} else if (!callbacks) {\n\t\t\tinner.extensions[name] = undefined;\n\t\t\treturn this;\n\t\t} else if (inner.extensions[name]) {\n\t\t\tthrow 'Cannot override already registered nette-ajax extension.';\n\t\t} else {\n\t\t\treturn inner.extensions[name] = {\n\t\t\t\tname: name,\n\t\t\t\ton: callbacks,\n\t\t\t\tcontext: context\n\t\t\t};\n\t\t}\n\t};\n\n\tthis.init = function (load, loadContext) {\n\t\tif (typeof load == 'function') {\n\t\t\tthis.ext('init', null);\n\t\t\tthis.ext('init', {\n\t\t\t\tload: load,\n\t\t\t}, loadContext);\n\t\t} else if (typeof load == 'object') {\n\t\t\tthis.ext('init', null);\n\t\t\tthis.ext('init', load, loadContext);\n\t\t} else if (load !== undefined) {\n\t\t\tthrow 'Argument of init() can be function or function-hash only.';\n\t\t} else {\n\t\t\tif (inner.initialized) throw 'Cannot initialize nette-ajax twice.';\n\t\t}\n\n\t\tinner.initialized = true;\n\n\t\t$.each(inner.extensions, function (index, extension) {\n\t\t\t$.each(['init', 'load', 'before', 'start', 'success', 'complete', 'error'], function (index, reaction) {\n\t\t\t\tif (extension !== undefined) {\n\t\t\t\t\tif (extension.on[reaction] !== undefined) {\n\t\t\t\t\t\tinner.on[reaction][extension.name] = extension.on[reaction];\n\t\t\t\t\t}\n\t\t\t\t\tinner.contexts[extension.name] = extension.context ? extension.context : {};\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tinner.fire('init');\n\t\tthis.load();\n\t\treturn this;\n\t};\n\n\tthis.load = function () {\n\t\tinner.fire('load', inner.requestHandler);\n\t};\n};\n\n$.nette = new ($.extend(nette, $.nette ? $.nette : {}));\n\n// default snippet handler\n$.nette.ext('snippets', {\n\tsuccess: function (payload) {\n\t\tif (payload.snippets) {\n\t\t\tfor (var i in payload.snippets) {\n\t\t\t\tthis.updateSnippet(i, payload.snippets[i]);\n\t\t\t}\n\t\t}\n\t}\n}, {\n\tupdateSnippet: function (id, html) {\n\t\tvar $el = $('#' + this.escapeSelector(id));\n\t\t// Fix for setting document title in IE\n\t\tif ($el.eq(0).tagName == 'TITLE') {\n\t\t\tdocument.title = html;\n\t\t} else {\n\t\t\tthis.applySnippet($el, html);\n\t\t}\n\t},\n\tapplySnippet: function ($el, html) {\n\t\t$el.html(html);\n\t},\n\tescapeSelector: function (selector) {\n\t\t// thx to @uestla (https://github.com/uestla)\n\t\treturn selector.replace(/[\\!\"#\\$%&'\\(\\)\\*\\+,\\.\/:;<=>\\?@\\[\\\\\\]\\^`\\{\\|\\}~]/g, '\\\\$&');\n\t}\n});\n\n// support $this->redirect()\n$.nette.ext('redirect', {\n\tsuccess: function (payload) {\n\t\tif (payload.redirect) {\n\t\t\twindow.location.href = payload.redirect;\n\t\t\treturn false;\n\t\t}\n\t}\n});\n\n// change URL (requires HTML5)\n$.nette.ext('history', {\n\tbefore: function (ui) {\n\t\tvar $el = $(ui);\n\t\tif ($el.is('a')) {\n\t\t\tthis.href = ui.href;\n\t\t}\n\t},\n\tsuccess: function (payload) {\n\t\tif (payload.url) {\n\t\t\tthis.href = payload.url;\n\t\t}\n\t\tif (!payload.signal && window.history && history.pushState && this.href) {\n\t\t\thistory.pushState({href: this.href}, '', this.href);\n\t\t}\n\t}\n}, {href: null});\n\n// current page state\n$.nette.ext('state', {\n\tsuccess: function (payload) {\n\t\tif (payload.state) {\n\t\t\tthis.state = payload.state;\n\t\t}\n\t}\n}, {state: null});\n\n// abort last request if new started\n$.nette.ext('unique', {\n\tstart: function (req) {\n\t\tif (this.req) {\n\t\t\tthis.req.abort();\n\t\t}\n\t\tthis.req = req;\n\t},\n\tcomplete: function () {\n\t\tthis.req = null;\n\t}\n}, {req: null});\n\n// option to abort by ESC (thx to @vrana)\n$.nette.ext('abort', {\n\tinit: function () {\n\t\t$('body').keydown($.proxy(function (e) {\n\t\t\tif (this.req && (e.keyCode == 27 // Esc\n\t\t\t&& !(e.ctrlKey || e.shiftKey || e.altKey || e.metaKey))\n\t\t\t) {\n\t\t\t\tthis.req.abort();\n\t\t\t}\n\t\t}, this));\n\t},\n\tstart: function (req) {\n\t\tthis.req = req;\n\t},\n\tcomplete: function () {\n\t\tthis.req = null;\n\t}\n}, {req: null});\n\n// current page state\n$.nette.ext('init', {\n\tload: function (rh) {\n\t\t$(this.linkSelector).off('click', rh).on('click', rh);\n\t\tvar $forms = $(this.formSelector);\n\t\t$forms.off('submit', rh).on('submit', rh);\n\t\t$forms.off('click', ':submit', rh).on('click', ':submit', rh);\n\t},\n\tsuccess: function () {\n\t\t$.nette.load();\n\t}\n}, {\n\tlinkSelector: 'a.ajax',\n\tformSelector: 'form.ajax'\n});\n\n})(jQuery);\n",
                "new_contents": "/**\n * AJAX Nette Framwork plugin for jQuery\n *\n * @copyright Copyright (c) 2009, 2010 Jan Marek\n * @copyright Copyright (c) 2009, 2010 David Grudl\n * @copyright Copyright (c) 2012 Vojtěch Dobeš\n * @license MIT\n */\n\n(function($, undefined) {\n\nif (typeof $ != 'function') return;\n\nvar nette = function () {\n\tvar inner = {\n\t\tself: this,\n\t\tinitialized: false,\n\t\tcontexts: {},\n\t\textensions: {},\n\t\ton: {\n\t\t\tinit: {},\n\t\t\tload: {},\n\t\t\tbefore: {},\n\t\t\tstart: {},\n\t\t\tsuccess: {},\n\t\t\tcomplete: {},\n\t\t\terror: {}\n\t\t},\n\t\tfire: function () {\n\t\t\tvar result = true;\n\t\t\tvar args = Array.prototype.slice.call(arguments);\n\t\t\tvar name = args.shift();\n\t\t\targs.push(inner.self);\n\t\t\t$.each(inner.on[name], function (index, reaction) {\n\t\t\t\tvar temp = reaction.apply(inner.contexts[index], args);\n\t\t\t\treturn result = (temp === undefined || temp);\n\t\t\t});\n\t\t\treturn result;\n\t\t},\n\t\trequestHandler: function (e) {\n\t\t\te.preventDefault();\n\t\t\tif (inner.fire('before', this)) {\n\t\t\t\tvar $el, $form, isForm, isSubmit, data = {};\n\n\t\t\t\t$el = $(this);\n\n\t\t\t\tif ((isForm = $el.is('form')) || (isSubmit = $el.is(':submit'))) {\n\t\t\t\t\tif (isSubmit) {\n\t\t\t\t\t\t$form = $el.closest('form');\n\t\t\t\t\t\tdata[$el.attr('name')] = $el.val() || '';\n\t\t\t\t\t} else if (isForm) {\n\t\t\t\t\t\t$form = $el;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($form.get(0).onsubmit && !$form.get(0).onsubmit()) return null;\n\n\t\t\t\t\tvar values = $form.serializeArray();\n\t\t\t\t\tfor (var i = 0; i < values.length; i++) {\n\t\t\t\t\t\tvar name = values[i].name;\n\t\t\t\t\t\tif (name in data) {\n\t\t\t\t\t\t\tvar val = data[name];\n\t\t\t\t\t\t\tif (!(val instanceof Array)) {\n\t\t\t\t\t\t\t\tval = [val];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tval.push(values[i].value);\n\t\t\t\t\t\t\tdata[name] = val;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdata[name] = values[i].value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t// thx to @vrana\n\t\t\tvar url = $form ? $form.attr('action') : this.href;\n\t\t\tif (/:|^#/.test(url)) return;\n\n\t\t\t\tvar req = $.ajax({\n\t\t\t\t\turl: url,\n\t\t\t\t\tdata: data,\n\t\t\t\t\ttype: $form ? $form.attr('method') : 'get',\n\t\t\t\t\tsuccess: function (payload) {\n\t\t\t\t\t\tinner.fire('success', payload);\n\t\t\t\t\t},\n\t\t\t\t\tcomplete: function () {\n\t\t\t\t\t\tinner.fire('complete');\n\t\t\t\t\t},\n\t\t\t\t\terror: function () {\n\t\t\t\t\t\tinner.fire('error');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tinner.fire('start', req);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.ext = function (name, callbacks, context) {\n\t\tif (inner.initialized) throw 'Cannot manipulate nette-ajax extensions after initialization.';\n\n\t\tif (callbacks === undefined) {\n\t\t\treturn inner.extensions[name];\n\t\t} else if (!callbacks) {\n\t\t\tinner.extensions[name] = undefined;\n\t\t\treturn this;\n\t\t} else if (inner.extensions[name]) {\n\t\t\tthrow 'Cannot override already registered nette-ajax extension.';\n\t\t} else {\n\t\t\treturn inner.extensions[name] = {\n\t\t\t\tname: name,\n\t\t\t\ton: callbacks,\n\t\t\t\tcontext: context\n\t\t\t};\n\t\t}\n\t};\n\n\tthis.init = function (load, loadContext) {\n\t\tif (typeof load == 'function') {\n\t\t\tthis.ext('init', null);\n\t\t\tthis.ext('init', {\n\t\t\t\tload: load,\n\t\t\t}, loadContext);\n\t\t} else if (typeof load == 'object') {\n\t\t\tthis.ext('init', null);\n\t\t\tthis.ext('init', load, loadContext);\n\t\t} else if (load !== undefined) {\n\t\t\tthrow 'Argument of init() can be function or function-hash only.';\n\t\t} else {\n\t\t\tif (inner.initialized) throw 'Cannot initialize nette-ajax twice.';\n\t\t}\n\n\t\tinner.initialized = true;\n\n\t\t$.each(inner.extensions, function (index, extension) {\n\t\t\t$.each(['init', 'load', 'before', 'start', 'success', 'complete', 'error'], function (index, reaction) {\n\t\t\t\tif (extension !== undefined) {\n\t\t\t\t\tif (extension.on[reaction] !== undefined) {\n\t\t\t\t\t\tinner.on[reaction][extension.name] = extension.on[reaction];\n\t\t\t\t\t}\n\t\t\t\t\tinner.contexts[extension.name] = extension.context ? extension.context : {};\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tinner.fire('init');\n\t\tthis.load();\n\t\treturn this;\n\t};\n\n\tthis.load = function () {\n\t\tinner.fire('load', inner.requestHandler);\n\t};\n};\n\n$.nette = new ($.extend(nette, $.nette ? $.nette : {}));\n\n// default snippet handler\n$.nette.ext('snippets', {\n\tsuccess: function (payload) {\n\t\tif (payload.snippets) {\n\t\t\tfor (var i in payload.snippets) {\n\t\t\t\tthis.updateSnippet(i, payload.snippets[i]);\n\t\t\t}\n\t\t}\n\t}\n}, {\n\tupdateSnippet: function (id, html) {\n\t\tvar $el = $('#' + this.escapeSelector(id));\n\t\t// Fix for setting document title in IE\n\t\tif ($el.eq(0).tagName == 'TITLE') {\n\t\t\tdocument.title = html;\n\t\t} else {\n\t\t\tthis.applySnippet($el, html);\n\t\t}\n\t},\n\tapplySnippet: function ($el, html) {\n\t\t$el.html(html);\n\t},\n\tescapeSelector: function (selector) {\n\t\t// thx to @uestla (https://github.com/uestla)\n\t\treturn selector.replace(/[\\!\"#\\$%&'\\(\\)\\*\\+,\\.\/:;<=>\\?@\\[\\\\\\]\\^`\\{\\|\\}~]/g, '\\\\$&');\n\t}\n});\n\n// support $this->redirect()\n$.nette.ext('redirect', {\n\tsuccess: function (payload) {\n\t\tif (payload.redirect) {\n\t\t\twindow.location.href = payload.redirect;\n\t\t\treturn false;\n\t\t}\n\t}\n});\n\n// change URL (requires HTML5)\n$.nette.ext('history', {\n\tbefore: function (ui) {\n\t\tvar $el = $(ui);\n\t\tif ($el.is('a')) {\n\t\t\tthis.href = ui.href;\n\t\t}\n\t},\n\tsuccess: function (payload) {\n\t\tif (payload.url) {\n\t\t\tthis.href = payload.url;\n\t\t}\n\t\tif (!payload.signal && window.history && history.pushState && this.href) {\n\t\t\thistory.pushState({href: this.href}, '', this.href);\n\t\t}\n\t}\n}, {href: null});\n\n// current page state\n$.nette.ext('state', {\n\tsuccess: function (payload) {\n\t\tif (payload.state) {\n\t\t\tthis.state = payload.state;\n\t\t}\n\t}\n}, {state: null});\n\n// abort last request if new started\n$.nette.ext('unique', {\n\tstart: function (req) {\n\t\tif (this.req) {\n\t\t\tthis.req.abort();\n\t\t}\n\t\tthis.req = req;\n\t},\n\tcomplete: function () {\n\t\tthis.req = null;\n\t}\n}, {req: null});\n\n// option to abort by ESC (thx to @vrana)\n$.nette.ext('abort', {\n\tinit: function () {\n\t\t$('body').keydown($.proxy(function (e) {\n\t\t\tif (this.req && (e.keyCode == 27 // Esc\n\t\t\t&& !(e.ctrlKey || e.shiftKey || e.altKey || e.metaKey))\n\t\t\t) {\n\t\t\t\tthis.req.abort();\n\t\t\t}\n\t\t}, this));\n\t},\n\tstart: function (req) {\n\t\tthis.req = req;\n\t},\n\tcomplete: function () {\n\t\tthis.req = null;\n\t}\n}, {req: null});\n\n// current page state\n$.nette.ext('init', {\n\tload: function (rh) {\n\t\t$(this.linkSelector).off('click', rh).on('click', rh);\n\t\tvar $forms = $(this.formSelector);\n\t\t$forms.off('submit', rh).on('submit', rh);\n\t\t$forms.off('click', ':submit', rh).on('click', ':submit', rh);\n\t},\n\tsuccess: function () {\n\t\t$.nette.load();\n\t}\n}, {\n\tlinkSelector: 'a.ajax',\n\tformSelector: 'form.ajax'\n});\n\n})(jQuery);\n",
                "subject": "Local links (with hash) are never ajaxified",
                "message": "Local links (with hash) are never ajaxified\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "vojtech-dobes/nette.ajax.js"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10220,
            "row": {
                "commit": "d09bcd9c705f15545ba043d623b7084495b6045a",
                "old_file": "sync.js",
                "new_file": "sync.js",
                "old_contents": "// TODO:\n// Test without registering the class to see if sync calls throws errors\n// Retest again in all browsers due to a bug fix\n\nmoney.sync = (function(){\n\n\treturn {\n\n\t\t// Called every page load to make sure we are storing the most\n\t\t// up to date data value, or things get messed up\n\n\t\tinit: function(){\n\t\t\tif(!Modernizr.localstorage){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tyootil.storage.set(\"monetary_data_sync\", money.data, true, true);\n\n\t\t\tvar self = this;\n\n\t\t\t// Delay the binding, IE fires it too quickly, grrr.\n\n\t\t\tsetTimeout(function(){\n\t\t\t\t$(window).bind(\"storage\", $.proxy(self.handle_syncing, self));\n\t\t\t}, 100);\n\t\t},\n\n\t\tregister: function(){\n\t\t\tmoney.modules.push(this);\n\t\t\treturn this;\n\t\t},\n\n\t\t// Checks for the original storage event and makes sure we are\n\t\t// using the correct key.\n\n\t\t// Should not need domain checking\n\n\t\thandle_syncing: function(evt){\n\t\t\tif(evt && evt.originalEvent && evt.originalEvent.key == \"monetary_data_sync\"){\n\t\t\t\tvar self = this;\n\n\t\t\t\t// Again, IE causing us to add in extra steps.\n\t\t\t\t// We are trying to prevent the trigger caller from\n\t\t\t\t// getting synced, there is no need, as it acts as the\n\t\t\t\t// master of the data.\n\n\t\t\t\tvar name = window.name || \"\";\n\n\t\t\t\tif(name == \"trigger_caller\"){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tself.sync_data(evt.originalEvent);\n\t\t\t}\n\t\t},\n\n\t\t// Here we sync the data object with the new data.\n\t\t// We do a straight swap for now, I see no reason not too.\n\t\t// Remember, this only is called when an update to the data has happened.\n\n\t\t// We also handle visual stuff, we don't have too but it's nice.\n\n\t\t// Support has been added for multiple instances of the stock market,\n\t\t// bank, and gift money.\n\n\t\tsync_data: function(evt){\n\t\t\tvar old_data = evt.oldValue;\n\t\t\tvar new_data = evt.newValue;\n\n\t\t\t// Stop here if there is no changes, the data is stringified (2 strings)\n\t\t\t// This prevents changing the DOM for no reason\n\n\t\t\tif(old_data == new_data){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif(new_data && yootil.is_json(new_data)){\n\t\t\t\tnew_data = JSON.parse(new_data);\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Straight up swap of new data, we trust it.\n\n\t\t\tmoney.data = new_data;\n\n\t\t\t// Handle gifts\n\n\t\t\tif(location.href.match(/\\?monetarygift=.+?$/i)){\n\t\t\t\t$(\".monetary-gift-notice-content-top\").css(\"opacity\", .3);\n\t\t\t\t$(\".monetary-gift-notice-content-accept\").html(\"You have accepted this gift in another tab / window.\");\n\t\t\t}\n\n\t\t\t// Format new money changes\n\n\t\t\tvar user_money = money.format(money.data.m, true);\n\t\t\tvar user_bank_money = money.format(money.data.b, true);\n\n\t\t\t// Now lets see where we are, and attempt to update visuals\n\n\t\t\tvar location_check = (yootil.location.check.search_results() || yootil.location.check.message_thread() || yootil.location.check.thread() || yootil.location.check.recent_posts() || yootil.location.check.profile_home() || yootil.location.check.members());\n\n\t\t\tif(location_check){\n\t\t\t\tvar user_id = yootil.user.id();\n\n\t\t\t\t$(\".pd_money_amount_\" + user_id).text(yootil.number_format(user_money));\n\n\t\t\t\tif(yootil.location.check.profile_home() || yootil.location.check.members()){\n\t\t\t\t\t$(\".pd_bank_amount_\" + user_id).text(yootil.number_format(user_bank_money));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// See if there is a wallet about\n\n\t\t\tvar wallet = $(\"#pd_money_wallet_amount\");\n\n\t\t\tif(wallet.length){\n\t\t\t\twallet.text(yootil.number_format(user_money));\n\t\t\t}\n\n\t\t\t// Lets see if it's the bank, if so update the balance.\n\t\t\t// Don't bother with transactions, it's in the data, but\n\t\t\t// no need to visually update it, for now.\n\n\t\t\t// TODO: Maybe add in transactions updating.\n\n\t\t\tif(yootil.location.check.forum() && location.href.match(/\/?bank\/?/i)){\n\t\t\t\t$(\"#pd_money_bank_balance\").text(yootil.number_format(user_bank_money));\n\t\t\t}\n\n\t\t\t// Update stock list\n\n\t\t\tif(yootil.location.check.forum() && location.href.match(/\/?stockmarket\/?/i)){\n\t\t\t\tif(money.stock_market.settings.enabled){\n\t\t\t\t\tmoney.stock_market.check_for_data();\n\t\t\t\t\tmoney.stock_market.current_investment_list();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// Sometimes we need to trigger the sync (i.e edit money dialog)\n\t\t// Due to IE not following standards, we do some window.name setting\n\t\t// to prevent the trigger caller tab / window from triggering on its self.\n\t\t// Got to love IE, nothing but headaches and workarounds.\n\n\t\ttrigger: function(){\n\t\t\tif(!Modernizr.localstorage){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar old_name = (window.name && window.name != \"trigger_caller\")? window.name : \"\";\n\n\t\t\twindow.name = \"trigger_caller\";\n\t\t\tyootil.storage.set(\"monetary_data_sync\", money.data, true, true);\n\t\t\twindow.name = old_name;\n\t\t}\n\n\t};\n\n})().register();",
                "new_contents": "money.sync = (function(){\n\n\treturn {\n\n\t\t// Called every page load to make sure we are storing the most\n\t\t// up to date data value, or things get messed up\n\n\t\tinit: function(){\n\t\t\tif(!Modernizr.localstorage){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tyootil.storage.set(\"monetary_data_sync\", money.data, true, true);\n\n\t\t\tvar self = this;\n\n\t\t\t// Delay the binding, IE fires it too quickly, grrr.\n\n\t\t\tsetTimeout(function(){\n\t\t\t\t$(window).bind(\"storage\", $.proxy(self.handle_syncing, self));\n\t\t\t}, 100);\n\t\t},\n\n\t\tregister: function(){\n\t\t\tmoney.modules.push(this);\n\t\t\treturn this;\n\t\t},\n\n\t\t// Checks for the original storage event and makes sure we are\n\t\t// using the correct key.\n\n\t\t// Should not need domain checking\n\n\t\thandle_syncing: function(evt){\n\t\t\tif(evt && evt.originalEvent && evt.originalEvent.key == \"monetary_data_sync\"){\n\t\t\t\tvar self = this;\n\n\t\t\t\t// Again, IE causing us to add in extra steps.\n\t\t\t\t// We are trying to prevent the trigger caller from\n\t\t\t\t// getting synced, there is no need, as it acts as the\n\t\t\t\t// master of the data.\n\n\t\t\t\tvar name = window.name || \"\";\n\n\t\t\t\tif(name == \"trigger_caller\"){\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tself.sync_data(evt.originalEvent);\n\t\t\t}\n\t\t},\n\n\t\t// Here we sync the data object with the new data.\n\t\t// We do a straight swap for now, I see no reason not too.\n\t\t// Remember, this only is called when an update to the data has happened.\n\n\t\t// We also handle visual stuff, we don't have too but it's nice.\n\n\t\t// Support has been added for multiple instances of the stock market,\n\t\t// bank, and gift money.\n\n\t\tsync_data: function(evt){\n\t\t\tvar old_data = evt.oldValue;\n\t\t\tvar new_data = evt.newValue;\n\n\t\t\t// Stop here if there is no changes, the data is stringified (2 strings)\n\t\t\t// This prevents changing the DOM for no reason\n\n\t\t\tif(old_data == new_data){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif(new_data && yootil.is_json(new_data)){\n\t\t\t\tnew_data = JSON.parse(new_data);\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Straight up swap of new data, we trust it.\n\n\t\t\tmoney.data = new_data;\n\n\t\t\t// Handle gifts\n\n\t\t\tif(location.href.match(/\\?monetarygift=.+?$/i)){\n\t\t\t\t$(\".monetary-gift-notice-content-top\").css(\"opacity\", .3);\n\t\t\t\t$(\".monetary-gift-notice-content-accept\").html(\"You have accepted this gift in another tab / window.\");\n\t\t\t}\n\n\t\t\t// Format new money changes\n\n\t\t\tvar user_money = money.format(money.data.m, true);\n\t\t\tvar user_bank_money = money.format(money.data.b, true);\n\n\t\t\t// Now lets see where we are, and attempt to update visuals\n\n\t\t\tvar location_check = (yootil.location.check.search_results() || yootil.location.check.message_thread() || yootil.location.check.thread() || yootil.location.check.recent_posts() || yootil.location.check.profile_home() || yootil.location.check.members());\n\n\t\t\tif(location_check){\n\t\t\t\tvar user_id = yootil.user.id();\n\n\t\t\t\t$(\".pd_money_amount_\" + user_id).text(yootil.number_format(user_money));\n\n\t\t\t\tif(yootil.location.check.profile_home() || yootil.location.check.members()){\n\t\t\t\t\t$(\".pd_bank_amount_\" + user_id).text(yootil.number_format(user_bank_money));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// See if there is a wallet about\n\n\t\t\tvar wallet = $(\"#pd_money_wallet_amount\");\n\n\t\t\tif(wallet.length){\n\t\t\t\twallet.text(yootil.number_format(user_money));\n\t\t\t}\n\n\t\t\t// Lets see if it's the bank, if so update the balance.\n\t\t\t// Don't bother with transactions, it's in the data, but\n\t\t\t// no need to visually update it, for now.\n\n\t\t\t// TODO: Maybe add in transactions updating.\n\n\t\t\tif(yootil.location.check.forum() && location.href.match(/\/?bank\/?/i)){\n\t\t\t\t$(\"#pd_money_bank_balance\").text(yootil.number_format(user_bank_money));\n\t\t\t}\n\n\t\t\t// Update stock list\n\n\t\t\tif(yootil.location.check.forum() && location.href.match(/\/?stockmarket\/?/i)){\n\t\t\t\tif(money.stock_market.settings.enabled){\n\t\t\t\t\tmoney.stock_market.check_for_data();\n\t\t\t\t\tmoney.stock_market.current_investment_list();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// Sometimes we need to trigger the sync (i.e edit money dialog)\n\t\t// Due to IE not following standards, we do some window.name setting\n\t\t// to prevent the trigger caller tab / window from triggering on its self.\n\t\t// Got to love IE, nothing but headaches and workarounds.\n\n\t\ttrigger: function(){\n\t\t\tif(!Modernizr.localstorage){\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar old_name = (window.name && window.name != \"trigger_caller\")? window.name : \"\";\n\n\t\t\twindow.name = \"trigger_caller\";\n\t\t\tyootil.storage.set(\"monetary_data_sync\", money.data, true, true);\n\t\t\twindow.name = old_name;\n\t\t}\n\n\t};\n\n})().register();",
                "subject": "Sync testing",
                "message": "Sync testing\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "PopThosePringles/ProBoards-Monetary-System,PopThosePringles/ProBoards-Monetary"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10221,
            "row": {
                "commit": "cc1e6664ab135190df6a3c0ff8849ffd454febce",
                "old_file": "aws-iot-ble-sensor.js",
                "new_file": "aws-iot-ble-sensor.js",
                "old_contents": "// AWS IoT Device app that continuously scans for and reports detected iBeacons\n\nvar version = \"0.2.2\";\n\n\n\n//\n// Parse command line arguments\n//\n\nvar commandLineArgs = require('command-line-args');\n\nvar args = commandLineArgs([\n  { name: 'verbose', alias: 'v', type: Boolean, defaultValue: false },\n  { name: 'throttle', alias: 't', type: Boolean, defaultValue: true },\n  { name: 'led', alias: 'l', type: Boolean, defaultValue: false },\n])\nfunction GetFormattedDate() {\n    var todayTime = new Date();\n    var month = todayTime .getMonth() + 1;\n    var day = todayTime .getDate();\n    var year = todayTime .getFullYear();\n    var hours = todayTime .getHours();\n    var minutes = todayTime .getMinutes();\n    return month + \"-\" + day + \"-\" + year+\"-\"+hours+\"_00\";\n\n}\n\nfunction addLog(message) {\n\tvar today = GetFormattedDate();\n\tvar logFile = '/opt/aws-iot-ble-sensor-log/logs/'+sensor+'-log-'+today+'.log';\n\tvar stream = fs.createWriteStream(logFile, {'flags': 'a'});\n\tstream.write(message+\"\\n\");\n\tstream.end();\n}\nvar options = args.parse()\n\nconst fs = require('fs');\n\n//\n// Status LED blinking\n//\n\n// which gpio pins correspond to the r, g & b leds\n// rgb led recommended, eg: http://www.monkmakes.com/squid/\nconst led_r = 12;\nconst led_g = 16;\nconst led_b = 18;\n\n// start with red\nvar led=led_r;\n\n// to switch color, set this to the new one\nvar led_switch=0;\n\n// set the blink frequency\nvar blink_on = 10;\nvar blink_off = 4990;\n\nif (options.led) {\n  try {\n     var gpio = require('rpi-gpio');\n  } catch(err) {\n     console.error(\"LED: Not found\");\n     options.led=false;\n  }\n}\n\nif (options.led) {\n  // setup gpio for the led\n  gpio.setup(led_r, gpio.DIR_OUT);\n  gpio.setup(led_g, gpio.DIR_OUT);\n  gpio.setup(led_b, gpio.DIR_OUT);\n\n  // start blinking LED\n  led_on();\n\n  function led_on() {\n      setTimeout(function() {\n          gpio.write(led, 1, led_off);\n      }, blink_off);\n  }\n\n  function led_off() {\n      setTimeout(function() {\n        gpio.write(led, 0, led_on);\n        if (led_switch !=0) {\n            led=led_switch;\n            led_switch=0;\n        }\n    }, blink_on);\n  }\n}\n\n\n\n//\n// AWS IoT connection\n//\n\n// use the hostname to identify this instance of the sensor\nvar os = require('os');\nconst sensor = os.hostname().split('.').shift();\n\n// use this topic for heartbeats\nconst topicHeartbeat = 'heartbeat';\n\n// use this topic for detections\nconst topicDetection = 'detection';\n\n// connect to AWS IoT\nvar awsIot = require('aws-iot-device-sdk');\n//manager = levelStore('E:\\nodejs\\ascential\\aws-iot-ble-sensor');\nconst aws = awsIot.device({\n    keyPath: './certs/private.pem.key',\n    certPath: './certs/certificate.pem.crt',\n    caPath: './certs/root-CA.crt',\n    region: 'eu-west-1',\n    clientId: sensor,\n    offlineQueueing: true,\n    offlineQueueMaxSize: 0,\n\t\t//incomingStore: manager.incoming,\n\t\t//outgoingStore: manager.outgoing,\n    drainTimeMs: 10\n});\n\nvar HashMap = require('hashmap');\nvar log = new HashMap();\n//update the log in file every 5 seconds\ntimeout = setInterval(function() {\n\ttry {\n\t\tvar today = GetFormattedDate();\n\t\tvar logFile = '/opt/aws-iot-ble-sensor-log/logs/'+sensor+'-log-'+today+'.log';\n\t\tvar stream = fs.createWriteStream(logFile, {'flags': 'a'});\n    stream.on('error', function(err) {\n      console.log(err);\n    });\n\t\tlog.forEach(function(message, discoverUuidmm) {\n\t\t\tstream.write(message+\"\\n\");\n\t\t\tlog.remove(discoverUuidmm);\n\t\t});\n\t\tstream.end();\n\t}catch (ex) {\n\t\tconsole.log(ex);\n\t\tconsole.log(\"Failed to write\");\n\t}\n}, 5000);\n\n// publish a heartbeat every 60 seconds\ntimeout = setInterval(function() {\n\n    // prepare JSON message\n    var message = JSON.stringify({\n        timestamp: new Date().toJSON(),\n        type: 'heartbeat',\n        version: version,\n        uptime: os.uptime(),\n        loadavg: os.loadavg(),\n        sensor: sensor,\n    })\n\n    // publish to the heartbeat topic\n    aws.publish(topicHeartbeat, message, { qos: 1 });\n\t\t//console.log(aws.getOfflineOperations().length);\n    if (options.verbose) {\n      // also log to console\n\t\t\t//console.log(awsIot.offlineOperations);\n\t\t\t//console.log(aws.offlineOperations);\n      console.log(message);\n\t\t\t//addLog(message)\n    }\n}, 60000);\n\n// event handlers\naws\n    .on('connect', function() {\n        console.log('AWS IoT Device Gateway: Connected');\n        if (options.led) {\n          // switch led to blue\n          led_switch=led_b;\n        }\n    });\naws\n    .on('close', function() {\n        console.log('AWS IoT Device Gateway: Closed');\n        if (options.led) {\n          // switch led to red\n          led_switch=led_r;\n        }\n    });\naws\n    .on('reconnect', function() {\n        console.log('AWS IoT Device Gateway: Reconnected');\n        if (options.led) {\n          // switch led to blue\n          led_switch=led_b;\n        }\n    });\naws\n    .on('offline', function() {\n        console.log('AWS IoT Device Gateway: Offline');\n        if (options.led) {\n          // switch led to red\n          led_switch=led_r;\n        }\n    });\naws\n    .on('error', function(error) {\n        console.log('AWS IoT Device Gateway: Error -', error);\n        if (options.led) {\n          // switch led to red\n          led_switch=led_r;\n        }\n    });\naws\n    .on('message', function(topic, payload) {\n       console.log(payload.toString());\n    });\n\n\n\n//\n// iBeacon scanning\n//\n\nvar ble = require('bleacon');\nble.startScanning();\n\nif (options.throttle) {\n\t var map = new HashMap();\n}\n\n// event handler\nble\n    .on('discover', function(beacon) {\n\n        discoverTimestamp = new Date();\n        var discoverUuidmm = beacon.uuid + ':' + beacon.major + '/' + beacon.minor\n\n        if ((options.throttle) && ((discoverTimestamp - map.get(discoverUuidmm)) < 10000)) {\n          // ignore detections reported less than 10 seconds ago\n\n          if (options.verbose) {\n            // also log to console\n            console.log('Ignoring ' + discoverUuidmm + ' last detected ' + (discoverTimestamp - map.get(discoverUuidmm)) + 'ms ago');\n          }\n        } else {\n          // prepare JSON message\n          var message = JSON.stringify({\n              timestamp: discoverTimestamp.toJSON().replace(\"T\", \" \"),\n              type: 'detection',\n              uuidmm: discoverUuidmm,\n              measuredpower: beacon.measuredPower,\n              rssi: beacon.rssi,\n              accuracy: beacon.accuracy,\n              proximity: beacon.proximity,\n              sensor: sensor\n          })\n\n          // publish to the detection topic\n          aws.publish(topicDetection, message, { qos: 1 });\n\t\t\t\t\t//addLog(message);\n          if (options.throttle) {\n            // update the timestamp of last publish for that uuidmm\n            map.set(discoverUuidmm, discoverTimestamp);\n            log.set(discoverUuidmm, message);\n          };\n          if (options.verbose) {\n            // also log to console\n            console.log(message);\n          }\n        }\n    });\n",
                "new_contents": "// AWS IoT Device app that continuously scans for and reports detected iBeacons\n\nvar version = \"0.2.2\";\n\n\n\n//\n// Parse command line arguments\n//\n\nvar commandLineArgs = require('command-line-args');\n\nvar args = commandLineArgs([\n  { name: 'verbose', alias: 'v', type: Boolean, defaultValue: false },\n  { name: 'throttle', alias: 't', type: Boolean, defaultValue: true },\n  { name: 'led', alias: 'l', type: Boolean, defaultValue: false },\n])\nfunction GetFormattedDate() {\n    var todayTime = new Date();\n    var month = todayTime .getMonth() + 1;\n    var day = todayTime .getDate();\n    var year = todayTime .getFullYear();\n    var hours = todayTime .getHours();\n    var minutes = todayTime .getMinutes();\n    return month + \"-\" + day + \"-\" + year+\"-\"+hours+\"_00\";\n\n}\n\nfunction addLog(message) {\n\tvar today = GetFormattedDate();\n\tvar logFile = '/opt/aws-iot-ble-sensor-log/logs/'+sensor+'-log-'+today+'.log';\n\tvar stream = fs.createWriteStream(logFile, {'flags': 'a'});\n\tstream.write(message+\"\\n\");\n\tstream.end();\n}\nvar options = args.parse()\n\nconst fs = require('fs');\n\n//\n// Status LED blinking\n//\n\n// which gpio pins correspond to the r, g & b leds\n// rgb led recommended, eg: http://www.monkmakes.com/squid/\nconst led_r = 12;\nconst led_g = 16;\nconst led_b = 18;\n\n// start with red\nvar led=led_r;\n\n// to switch color, set this to the new one\nvar led_switch=0;\n\n// set the blink frequency\nvar blink_on = 10;\nvar blink_off = 4990;\n\nif (options.led) {\n  try {\n     var gpio = require('rpi-gpio');\n  } catch(err) {\n     console.error(\"LED: Not found\");\n     options.led=false;\n  }\n}\n\nif (options.led) {\n  // setup gpio for the led\n  gpio.setup(led_r, gpio.DIR_OUT);\n  gpio.setup(led_g, gpio.DIR_OUT);\n  gpio.setup(led_b, gpio.DIR_OUT);\n\n  // start blinking LED\n  led_on();\n\n  function led_on() {\n      setTimeout(function() {\n          gpio.write(led, 1, led_off);\n      }, blink_off);\n  }\n\n  function led_off() {\n      setTimeout(function() {\n        gpio.write(led, 0, led_on);\n        if (led_switch !=0) {\n            led=led_switch;\n            led_switch=0;\n        }\n    }, blink_on);\n  }\n}\n\n\n\n//\n// AWS IoT connection\n//\n\n// use the hostname to identify this instance of the sensor\nvar os = require('os');\nconst sensor = os.hostname().split('.').shift();\n\n// use this topic for heartbeats\nconst topicHeartbeat = 'heartbeat';\n\n// use this topic for detections\nconst topicDetection = 'detection';\n\n// connect to AWS IoT\nvar awsIot = require('aws-iot-device-sdk');\n//manager = levelStore('E:\\nodejs\\ascential\\aws-iot-ble-sensor');\nconst aws = awsIot.device({\n    keyPath: './certs/private.pem.key',\n    certPath: './certs/certificate.pem.crt',\n    caPath: './certs/root-CA.crt',\n    region: 'eu-west-1',\n    clientId: sensor,\n    offlineQueueing: true,\n    offlineQueueMaxSize: 0,\n\t\t//incomingStore: manager.incoming,\n\t\t//outgoingStore: manager.outgoing,\n    drainTimeMs: 10\n});\n\nvar HashMap = require('hashmap');\nvar log = new HashMap();\n//update the log in file every 5 seconds\ntimeout = setInterval(function() {\n\ttry {\n\t\tvar today = GetFormattedDate();\n\t\tvar logFile = '/opt/aws-iot-ble-sensor-log/logs/'+sensor+'-log-'+today+'.log';\n\t\tvar stream = fs.createWriteStream(logFile, {'flags': 'a'});\n    stream.on('error', function(err) {\n      console.log(err);\n    });\n\t\tlog.forEach(function(message, discoverUuidmm) {\n\t\t\tstream.write(message+\"\\n\");\n\t\t\tlog.remove(discoverUuidmm);\n\t\t});\n\t\tstream.end();\n\t}catch (ex) {\n\t\tconsole.log(ex);\n\t\tconsole.log(\"Failed to write\");\n\t}\n}, 5000);\n\n// publish a heartbeat every 60 seconds\ntimeout = setInterval(function() {\n\n    // prepare JSON message\n    var message = JSON.stringify({\n        timestamp: new Date().toJSON(),\n        type: 'heartbeat',\n        version: version,\n        uptime: os.uptime(),\n        loadavg: os.loadavg(),\n        sensor: sensor,\n    })\n\n    // publish to the heartbeat topic\n    aws.publish(topicHeartbeat, message, { qos: 1 });\n    //write heartbeat message to log file\n    var logFile = '/opt/aws-iot-ble-sensor-log/logs/heartbeat.log';\n\t\tvar stream = fs.createWriteStream(logFile, {'flags': 'a'});\n    stream.on('error', function(err) {\n      console.log(err);\n    });\n\t\tstream.write(message+\"\\n\");\n\t\tstream.end();\n\t\t//console.log(aws.getOfflineOperations().length);\n    if (options.verbose) {\n      // also log to console\n\t\t\t//console.log(awsIot.offlineOperations);\n\t\t\t//console.log(aws.offlineOperations);\n      console.log(message);\n\t\t\t//addLog(message)\n    }\n}, 60000);\n\n// event handlers\naws\n    .on('connect', function() {\n        console.log('AWS IoT Device Gateway: Connected');\n        if (options.led) {\n          // switch led to blue\n          led_switch=led_b;\n        }\n    });\naws\n    .on('close', function() {\n        console.log('AWS IoT Device Gateway: Closed');\n        if (options.led) {\n          // switch led to red\n          led_switch=led_r;\n        }\n    });\naws\n    .on('reconnect', function() {\n        console.log('AWS IoT Device Gateway: Reconnected');\n        if (options.led) {\n          // switch led to blue\n          led_switch=led_b;\n        }\n    });\naws\n    .on('offline', function() {\n        console.log('AWS IoT Device Gateway: Offline');\n        if (options.led) {\n          // switch led to red\n          led_switch=led_r;\n        }\n    });\naws\n    .on('error', function(error) {\n        console.log('AWS IoT Device Gateway: Error -', error);\n        if (options.led) {\n          // switch led to red\n          led_switch=led_r;\n        }\n    });\naws\n    .on('message', function(topic, payload) {\n       console.log(payload.toString());\n    });\n\n\n\n//\n// iBeacon scanning\n//\n\nvar ble = require('bleacon');\nble.startScanning();\n\nif (options.throttle) {\n\t var map = new HashMap();\n}\n\n// event handler\nble\n    .on('discover', function(beacon) {\n\n        discoverTimestamp = new Date();\n        var discoverUuidmm = beacon.uuid + ':' + beacon.major + '/' + beacon.minor\n\n        if ((options.throttle) && ((discoverTimestamp - map.get(discoverUuidmm)) < 10000)) {\n          // ignore detections reported less than 10 seconds ago\n\n          if (options.verbose) {\n            // also log to console\n            console.log('Ignoring ' + discoverUuidmm + ' last detected ' + (discoverTimestamp - map.get(discoverUuidmm)) + 'ms ago');\n          }\n        } else {\n          // prepare JSON message\n          var message = JSON.stringify({\n              timestamp: discoverTimestamp.toJSON().replace(\"T\", \" \"),\n              type: 'detection',\n              uuidmm: discoverUuidmm,\n              measuredpower: beacon.measuredPower,\n              rssi: beacon.rssi,\n              accuracy: beacon.accuracy,\n              proximity: beacon.proximity,\n              sensor: sensor\n          })\n\n          // publish to the detection topic\n          aws.publish(topicDetection, message, { qos: 1 });\n\t\t\t\t\t//addLog(message);\n          if (options.throttle) {\n            // update the timestamp of last publish for that uuidmm\n            map.set(discoverUuidmm, discoverTimestamp);\n            log.set(discoverUuidmm, message);\n          };\n          if (options.verbose) {\n            // also log to console\n            console.log(message);\n          }\n        }\n    });\n",
                "subject": "save heartbeat in file",
                "message": "save heartbeat in file\n",
                "lang": "JavaScript",
                "license": "bsd-2-clause",
                "repos": "hardyskapoor/aws-iot-ble-sensor-log,hardyskapoor/aws-iot-ble-sensor-log"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10222,
            "row": {
                "commit": "4e608c693b23d0562202c2ddea8187d9041d3ac6",
                "old_file": "test/init/init.test.js",
                "new_file": "test/init/init.test.js",
                "old_contents": "const { mkdirSync, existsSync, readFileSync } = require('fs');\nconst { join, resolve } = require('path');\n// eslint-disable-next-line node/no-unpublished-require\nconst rimraf = require('rimraf');\nconst { run, runPromptWithAnswers } = require('../utils/test-utils');\n\nconst assetsPath = resolve(__dirname, './test-assets');\nconst ENTER = '\\x0D';\nconst DOWN = '\\x1B\\x5B\\x42';\n\n// Helper to read from package.json in a given path\nconst readFromPkgJSON = (path) => {\n    const pkgJSONPath = join(path, 'package.json');\n    if (!existsSync(pkgJSONPath)) {\n        return {};\n    }\n    const pkgJSON = JSON.parse(readFileSync(pkgJSONPath, 'utf8'));\n    const { devDependencies: devDeps } = pkgJSON;\n    // Update devDeps versions to be x.x.x to prevent frequent snapshot updates\n    Object.keys(devDeps).forEach((dep) => (devDeps[dep] = 'x.x.x'));\n    return { ...pkgJSON, devDependencies: devDeps };\n};\n\n// Helper to read from webpack.config.js in a given path\nconst readFromWebpackConfig = (path) => readFileSync(join(path, 'webpack.config.js'), 'utf8');\n\ndescribe('init command', () => {\n    beforeEach(async () => {\n        await new Promise((resolve) => {\n            const interval = setInterval(() => {\n                if (!existsSync(assetsPath)) {\n                    clearInterval(interval);\n                    resolve();\n                }\n            }, 1000);\n        });\n        mkdirSync(assetsPath);\n    });\n\n    afterEach(() => {\n        rimraf.sync(assetsPath);\n    });\n\n    it('should generate default project when nothing is passed', () => {\n        const { stdout, stderr } = run(assetsPath, ['init', '--force']);\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n    });\n    it('should generate project when generationPath is supplied', () => {\n        const { stdout, stderr } = run(__dirname, ['init', assetsPath, '--force']);\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should generate folders if non existing generation path is given', () => {\n        rimraf.sync(assetsPath);\n        const { stdout, stderr } = run(__dirname, ['init', assetsPath, '--force']);\n        expect(stdout).toContain(\"generation path doesn't exist, required folders will be created.\");\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should configure assets modules by default', () => {\n        rimraf.sync(assetsPath);\n        const { stdout, stderr } = run(__dirname, ['init', assetsPath, '--force']);\n        expect(stdout).toContain(\"generation path doesn't exist, required folders will be created.\");\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should ask question when wrong template is supplied', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(assetsPath, ['init', '--force', '--template=apple'], [`${ENTER}`]);\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stdout).toContain('apple is not a valid template, please select one from below');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should generate typescript project correctly', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${DOWN}${DOWN}${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${ENTER}`],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n        expect(stderr).toContain('tsconfig.json');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.ts', 'webpack.config.js', 'tsconfig.json'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should generate ES6 project correctly', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${DOWN}${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${ENTER}`],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n        expect(stderr).toContain('.babelrc');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js', '.babelrc'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should use sass in project when selected', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${DOWN}${DOWN}${ENTER}`, `n${ENTER}`, `n${ENTER}`],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should use sass with postcss in project when selected', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${DOWN}${DOWN}${ENTER}`, `n${ENTER}`, `y${ENTER}`],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js', 'postcss.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should use sass and css with postcss in project when selected', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${DOWN}${DOWN}${ENTER}`, `y${ENTER}`, `y${ENTER}`],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js', 'postcss.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should use less in project when selected', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${DOWN}${DOWN}${DOWN}${ENTER}`, `n${ENTER}`, `n${ENTER}`],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should use stylus in project when selected', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${DOWN}${DOWN}${DOWN}${DOWN}${ENTER}`, `n${ENTER}`, `n${ENTER}`],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should configure WDS as opted', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(assetsPath, ['init'], [ENTER, ENTER, `n${ENTER}`, ENTER]);\n        expect(stdout).toContain('Do you want to use webpack-dev-server?');\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should use postcss in project when selected', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${DOWN}${ENTER}`, ENTER],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js', 'postcss.config.js'];\n\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should configure html-webpack-plugin as opted', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(assetsPath, ['init'], [ENTER, `n${ENTER}`, ENTER, ENTER]);\n        expect(stdout).toContain('Do you want to simplify the creation of HTML files for your bundle?');\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n});\n",
                "new_contents": "const { mkdirSync, existsSync, readFileSync } = require('fs');\nconst { join, resolve } = require('path');\n// eslint-disable-next-line node/no-unpublished-require\nconst rimraf = require('rimraf');\nconst { isWindows, run, runPromptWithAnswers } = require('../utils/test-utils');\n\nconst assetsPath = resolve(__dirname, './test-assets');\nconst ENTER = '\\x0D';\nconst DOWN = '\\x1B\\x5B\\x42';\n\n// Helper to read from package.json in a given path\nconst readFromPkgJSON = (path) => {\n    const pkgJSONPath = join(path, 'package.json');\n    if (!existsSync(pkgJSONPath)) {\n        return {};\n    }\n    const pkgJSON = JSON.parse(readFileSync(pkgJSONPath, 'utf8'));\n    const { devDependencies: devDeps } = pkgJSON;\n    // Update devDeps versions to be x.x.x to prevent frequent snapshot updates\n    Object.keys(devDeps).forEach((dep) => (devDeps[dep] = 'x.x.x'));\n    return { ...pkgJSON, devDependencies: devDeps };\n};\n\n// Helper to read from webpack.config.js in a given path\nconst readFromWebpackConfig = (path) => readFileSync(join(path, 'webpack.config.js'), 'utf8');\n\ndescribe('init command', () => {\n    beforeEach(async () => {\n        await new Promise((resolve) => {\n            const interval = setInterval(() => {\n                if (!existsSync(assetsPath)) {\n                    clearInterval(interval);\n                    resolve();\n                }\n            }, 1000);\n        });\n        mkdirSync(assetsPath);\n    });\n\n    afterEach(() => {\n        rimraf.sync(assetsPath);\n    });\n\n    it('should generate default project when nothing is passed', () => {\n        const { stdout, stderr } = run(assetsPath, ['init', '--force']);\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n    });\n    it('should generate project when generationPath is supplied', () => {\n        const { stdout, stderr } = run(__dirname, ['init', assetsPath, '--force']);\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should generate folders if non existing generation path is given', () => {\n        rimraf.sync(assetsPath);\n        const { stdout, stderr } = run(__dirname, ['init', assetsPath, '--force']);\n        expect(stdout).toContain(\"generation path doesn't exist, required folders will be created.\");\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should configure assets modules by default', () => {\n        rimraf.sync(assetsPath);\n        const { stdout, stderr } = run(__dirname, ['init', assetsPath, '--force']);\n        expect(stdout).toContain(\"generation path doesn't exist, required folders will be created.\");\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should ask question when wrong template is supplied', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(assetsPath, ['init', '--force', '--template=apple'], [`${ENTER}`]);\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stdout).toContain('apple is not a valid template, please select one from below');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should generate typescript project correctly', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${DOWN}${DOWN}${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${ENTER}`],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n        expect(stderr).toContain('tsconfig.json');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.ts', 'webpack.config.js', 'tsconfig.json'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should generate ES6 project correctly', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${DOWN}${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${ENTER}`],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n        expect(stderr).toContain('.babelrc');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js', '.babelrc'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should use sass in project when selected', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${DOWN}${DOWN}${ENTER}`, `n${ENTER}`, `n${ENTER}`],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should use sass with postcss in project when selected', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${DOWN}${DOWN}${ENTER}`, `n${ENTER}`, `y${ENTER}`],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js', 'postcss.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should use sass and css with postcss in project when selected', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${DOWN}${DOWN}${ENTER}`, `y${ENTER}`, `y${ENTER}`],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js', 'postcss.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should use less in project when selected', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${DOWN}${DOWN}${DOWN}${ENTER}`, `n${ENTER}`, `n${ENTER}`],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should use stylus in project when selected', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${DOWN}${DOWN}${DOWN}${DOWN}${ENTER}`, `n${ENTER}`, `n${ENTER}`],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should configure WDS as opted', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(assetsPath, ['init'], [ENTER, ENTER, `n${ENTER}`, ENTER]);\n        expect(stdout).toContain('Do you want to use webpack-dev-server?');\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should use postcss in project when selected', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(\n            assetsPath,\n            ['init'],\n            [`${ENTER}`, `n${ENTER}`, `n${ENTER}`, `${DOWN}${ENTER}`, ENTER],\n        );\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js', 'postcss.config.js'];\n\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should configure html-webpack-plugin as opted', async () => {\n        const { stdout, stderr } = await runPromptWithAnswers(assetsPath, ['init'], [ENTER, `n${ENTER}`, ENTER, ENTER]);\n        expect(stdout).toContain('Do you want to simplify the creation of HTML files for your bundle?');\n        expect(stdout).toContain('Project has been initialised with webpack!');\n        expect(stderr).toContain('webpack.config.js');\n\n        // Test files\n        const files = ['package.json', 'src', 'src/index.js', 'webpack.config.js'];\n        files.forEach((file) => {\n            expect(existsSync(resolve(assetsPath, file))).toBeTruthy();\n        });\n\n        // Check if the generated package.json file content matches the snapshot\n        expect(readFromPkgJSON(assetsPath)).toMatchSnapshot();\n\n        // Check if the generated webpack configuration matches the snapshot\n        expect(readFromWebpackConfig(assetsPath)).toMatchSnapshot();\n    });\n\n    it('should throw if the current path is not writable', async () => {\n        const projectPath = join(assetsPath, 'non-writable-path');\n        mkdirSync(projectPath, 0o500);\n        const { exitCode, stderr } = await run(projectPath, ['init', 'my-app'], { reject: false });\n\n        if (isWindows) {\n            return;\n        }\n        expect(exitCode).toBe(2);\n        expect(stderr).toContain('Failed to create directory');\n    });\n});\n",
                "subject": "test: init generator throws if the path is not writable (#2574)",
                "message": "test: init generator throws if the path is not writable (#2574)\n\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "webpack/webpack-cli,webpack/webpack-cli,webpack/webpack-cli"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10223,
            "row": {
                "commit": "8afef0325ad9780dba19e50ee87bfa744e55ba8d",
                "old_file": "public/js/PODAST/PODASTImage.js",
                "new_file": "public/js/PODAST/PODASTImage.js",
                "old_contents": "function PODASTImage(x, y, w, h, type, img) {\n\tthis.topLeft = {\n\t\tx: x,\n\t\ty: y\n\t};\n\tthis.dimensions = {\n\t\twidth: w,\n\t\theight: h\n\t};\n\tthis.type = type === \"output\" ? \"output\" : \"input\";\n\tthis.img = img;\n\tthis.pixels;\n\tthis.bytePixels; // Uint8Array holding pixel values after build\n\tthis.imageData;\n}\n\nPODASTImage.prototype.updateCustomImage = function(bytePixels) {\n\t// create array of pixel.value arrays\n\tconst valuesArray = typeof bytePixels === \"undefined\" ? this.pixels.map(a => a.value) : bytePixels;\n\t// join the pixels into a Uint8Array for a speed-up\n\tthis.bytePixels = Uint8Array.from([].concat.apply([], valuesArray));\n\tthis.imageData = ctx.getImageData(this.topLeft.x, this.topLeft.y, this.dimensions.width, this.dimensions.height);\n\tthis.imageData.data.set(this.bytePixels);\n};\n\nPODASTImage.prototype.encrypt = function(plaintext, i, p, d) {\n\tif(arguments.length < 4) {\n\t\tif(DEBUGGING >= 2) {\n\t\t\tconsole.warn(\"Not enough parameters specified.\");\n\t\t}\n\t\treturn false;\n\t}\n\tif(typeof this.pixels === \"undefined\") {\n\t\tif(this.build() === false) {\n\t\t\tif(DEBUGGING >= 1) {\n\t\t\t\tconsole.info(\"Please select an image before encrypting data.\");\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\t// copy img data\n\toutputImage.img = this.img;\n\t// prepare pixels\n\toutputImage.build();\n\t// Object.assign(outputImage, this);\n\t// divide the plaintext binary into small portions, ready to be divided over the to be altered pixels\n\tlet dataPortions = plaintext.match(new RegExp(\"[01]{1,\" + d + \"}\", \"g\")); // \"0111001\" --> [\"01\", \"11\", \"00\", \"1\"] (example I)\n\t// add bits indicator\n\ttry {\n\t\tdataPortions.push(addLeadingZeroes(decimalToBinary(dataPortions[dataPortions.length - 1].length), d));\n\t} catch(e) {\n\t\t// invalid binary data\n\t\tif(DEBUGGING >= 2) {\n\t\t\tconsole.warn(\"Invalid or empty binary data specified.\");\n\t\t}\n\t\tdataPortions = [];\n\t}\n\tif(DEBUGGING >= 3) {\n\t\tconsole.log(\"data portions: \", dataPortions);\n\t}\n\t// hide each portion in a different pixel\n\tlet pixelIndex = i;\n\tlet previousPixel;\n\tconst pixelsRange = Math.pow(2, p); // look for pixels 0 to pixelsRange pixels from current\n\t// NOTE we are altering outputImage, not this\n\tfor(var m = 0; m < dataPortions.length - 1; m++) {\n\t\tconst currentPixel = outputImage.pixels[pixelIndex];\n\t\tconst currentData = dataPortions[m];\n\t\tconst nextData = dataPortions[m + 1];\n\t\tconst currentPointer = 0;\n\t\t// update data for current pixel\n\t\tcurrentPixel.insertData(currentData.split(\"\"), p);\n\t\tconst relativeNextPixelIndex = outputImage.getNextPixelIndex(nextData, pixelIndex, pixelsRange, p, d);\n\t\tconsole.log(relativeNextPixelIndex);\n\t\tif(relativeNextPixelIndex === false) {\n\t\t\tif(DEBUGGING >= 1) {\n\t\t\t\tconsole.warn(\"PODAST was unable to complete the encryption process with the following \\n\" +\n\t\t\t\t\t\"parameters: i=\" + i + \", p=\" + p + \", d=\" + d + \", because it couldn't find any unaltered \\n\" +\n\t\t\t\t\t\"pixels within \" + pixelsRange + \" pixels from the current pixel.\\n\" +\n\t\t\t\t\t\"Please retry with different parameters, different text or a different image.\");\n\t\t\t}\n\t\t\treturn false;\n\t\t} else {\n\t\t\t// update pointer for current pixel\n\t\t\tcurrentPixel.insertPointer(addLeadingZeroes(decimalToBinary(relativeNextPixelIndex), p).split(\"\"));\n\t\t\tif(m === dataPortions.length - 2) {\n\t\t\t\t// possible bug: should be modularized or not?\n\t\t\t\tconst nextPixelIndex = pixelIndex + relativeNextPixelIndex;\n\t\t\t\tlet nextPixel = outputImage.pixels[nextPixelIndex];\n\t\t\t\t// update data in advance\n\t\t\t\tnextPixel.insertData(nextData.split(\"\"), p);\n\t\t\t\t// because that pixel will be the last, we can safely set the pointer to 0-terminator\n\t\t\t\tnextPixel.insertPointer(addLeadingZeroes(0, p).split(\"\"));\n\t\t\t\t// done!\n\t\t\t\tif(DEBUGGING >= 1) {\n\t\t\t\t\tconsole.info(\"Success! PODAST successfully encrypted your data with the following parameters: \\n\" +\n\t\t\t\t\t\t\"i=\" + i + \", p=\" + p + \", d=\" + d + \". Want to share your encrypted image? First, download your \\n\" +\n\t\t\t\t\t\t\"encrypted image, and send it to the receiver. Make sure you also share your decryption key: \\n\" +\n\t\t\t\t\t\t\"%c\" + generatePrivateKey(i, p, d) + \"%c , or else the receiver won't be able to read your message.\", \"font-weight: 900\", \"font-weight: initial\");\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tpixelIndex += relativeNextPixelIndex;\n\t}\n\toutputImage.updateCustomImage();\n\treturn generatePrivateKey(i, p, d);\n};\n\nPODASTImage.prototype.decrypt = function() {\n\tlet i;\n\tlet d;\n\tlet p;\n\tif(arguments.length === 0) {\n\t\t// invalid\n\t\tif(DEBUGGING >= 1) {\n\t\t\tconsole.warn(\"Not enough arguments specified.\");\n\t\t}\n\t\treturn false;\n\t} else if(arguments.length === 1) {\n\t\t// private key?\n\t\tlet matches;\n\t\ttry {\n\t\t\tmatches = arguments[0].match(validatePrivateKeyRegEx);\n\t\t} catch(exception) {\n\t\t\tmatches = null;\n\t\t}\n\t\tif(matches === null) {\n\t\t\tif(DEBUGGING >= 1) {\n\t\t\t\tconsole.warn(\"Invalid private key format specified.\");\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\ti = parseInt(matches[1], 10);\n\t\td = parseInt(matches[2], 10);\n\t\tp = parseInt(matches[3], 10);\n\t} else if(arguments.length === 3) {\n\t\ti = arguments[0];\n\t\td = arguments[1];\n\t\tp = arguments[2];\n\t}\n\t// using the pixels array would be cheating,\n\t// we have to assume that all we have is the Uint8Array,\n\t// because that is practically the picture a receiver would decrypt.\n\n\t// create new pixels array (local scope)\n\tconst temporaryPixels = quickBuild(this.bytePixels);\n\t// currentPixel is temporaryPixels[i]\n\tlet currentIndex = i;\n\tlet currentPixel = temporaryPixels[currentIndex];\n\tlet currentSignificanceArray = currentPixel.getSignificanceArray();\n\tlet currentDecimalPointer = parseInt(currentSignificanceArray.slice(-p).join(\"\"), 2);\n\tlet binaryDataString = currentDecimalPointer === 0 ? \"\" /* may be stupid, but data wasn't intended to be read */ : currentSignificanceArray.slice(-d-p, -p).join(\"\");\n\t// while not terminated (0-terminator in pointer)\n\twhile(currentDecimalPointer !== 0) {\n\t\tcurrentIndex = (currentIndex + currentDecimalPointer) % temporaryPixels.length;\n\t\tcurrentPixel = temporaryPixels[currentIndex];\n\t\tcurrentSignificanceArray = currentPixel.getSignificanceArray();\n\t\tcurrentDecimalPointer = parseInt(currentSignificanceArray.slice(-p).join(\"\"), 2);\n\t\t// remember, 0-terminator means that this piece of data tells us how many digits are meaningful.\n\t\t// it's not actual data.\n\t\tlet currentDataPiece = currentSignificanceArray.slice(-d-p, -p).join(\"\");\n\t\tif(currentDecimalPointer === 0) {\n\t\t\tconst currentDataDecimalValue = parseInt(currentDataPiece, 2);\n\t\t\t// get previous data\n\t\t\tconst previousDataPiece = binaryDataString.slice(-d);\n\t\t\t// get necessary part\n\t\t\tconst previousActualData = previousDataPiece.slice(-currentDataDecimalValue);\n\t\t\t// cut out unnecessary digits and add necessary\n\t\t\tbinaryDataString = binaryDataString.slice(0, -d) + previousActualData;\n\t\t} else {\n\t\t\tbinaryDataString += currentDataPiece;\n\t\t}\n\t}\n\treturn binaryDataString;\n};\n\n// for debugging purposes\nPODASTImage.prototype.inspectPixels = function() {\n\tfor(var i = 0; i < this.pixels.length; i++) {\n\t\tif(this.pixels[i].isAltered()) console.log(\"Altered pixel at (\" + i + \"): \", this.pixels[i]);\n\t}\n};\n\nPODASTImage.prototype.getNextPixelIndex = function(data, index, lookahead, p, d) {\n\tlet response = false;\n\tfor(var i = index + 1 /* current is bound to be altered */; i < index + lookahead; i++) {\n\t\t// TODO optimize?\n\t\tconst actualIndex = i % this.pixels.length;\n\t\tif(this.pixels[actualIndex].isAltered()) {\n\t\t\t// can't alter it twice, would corrupt existing data\n\t\t\tif(DEBUGGING >= 3) {\n\t\t\t\tconsole.log(\"pixel at (\" + actualIndex + \") is altered.\");\n\t\t\t}\n\t\t\tcontinue;\n\t\t} else {\n\t\t\tconst authenticPixelData = this.pixels[actualIndex].getSignificanceArray().slice(-p-d, -p).join(\"\");\n\t\t\tif(authenticPixelData === data) {\n\t\t\t\tresponse = actualIndex - index;\n\t\t\t\tbreak;\n\t\t\t} else if(actualIndex === index + lookahead - 1) {\n\t\t\t\tif(DEBUGGING >= 2) {\n\t\t\t\t\tconsole.info(\"Unable to find pixel that already contained the data we're trying to hide, using last pixel in range instead.\");\n\t\t\t\t}\n\t\t\t\tresponse = actualIndex - index;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\treturn response;\n};\n\nPODASTImage.prototype.build = function() {\n\tif(typeof this.img === \"undefined\" || this.img.pixels.length === 0) {\n\t\tif(DEBUGGING >= 2) {\n\t\t\tconsole.warn(\"Not ready to build image yet.\");\n\t\t}\n\t\treturn false;\n\t}\n\tthis.pixels = [];\n\tlet originalRgbaPixels = Array.from(this.img.pixels); // Uint8ClampedArray to Array\n\tfor(var i = 0; i < originalRgbaPixels.length - 3; i += 4) {\n\t\tthis.pixels.push(new PODASTPixel(originalRgbaPixels.slice(i, i + 4)));\n\t}\n\tthis.updateCustomImage();\n};\n\nPODASTImage.prototype.show = function() {\n\tif(typeof this.bytePixels === 'undefined') {\n\t\t// show box indicating where image can be shown\n\t\tnoFill();\n\t\tstroke(127, 127, 0);\n\t\tstrokeWeight(1);\n\t\trect(this.topLeft.x, this.topLeft.y, this.dimensions.width, this.dimensions.height);\n\t\t// explanatory text\n\t\ttextSize(headerHeight * 0.3);\n\t\tfill(217);\n\t\tnoStroke();\n\t\ttextAlign(CENTER);\n\t\tlet str;\n\t\tif(this.type === \"input\") {\n\t\t\tstr = \"Upload an image to see it displayed here.\";\n\t\t} else if(this.type === \"output\") {\n\t\t\tstr = \"Upload an image to see the image\\n after encryption displayed here.\";\n\t\t}\n\t\ttext(str, this.topLeft.x + 0.5 * this.dimensions.width, this.topLeft.y + 0.5 * this.dimensions.height);\n\t} else {\n\t\t// show PODASTImage\n\t\tputImageData(ctx, this.imageData, this.topLeft.x, this.topLeft.y);\n\t}\n};\n\n\n// TODO: optimize with base64 data instead of changing fillstyle every pixel\n// currently takes ~60ms to run for a 172x256 png!\nfunction putImageData(ctx, imageData, dx, dy) {\n  const data = imageData.data;\n  const height = imageData.height;\n  const width = imageData.width;\n  for (var y = 0; y < height; y++) {\n    for (var x = 0; x < width; x++) {\n      const pos = (y * width + x) * 4;\n      ctx.fillStyle = 'rgb(' + data[pos] + ',' + data[pos + 1] + ',' + data[pos + 2] + ')';\n      ctx.fillRect(x + dx, y + dy, 1, 1);\n    }\n  }\n}\n\nfunction quickBuild(imageData) {\n\tlet pixels = [];\n\tlet originalRgbaPixels = Array.from(imageData);\n\tfor(var i = 0; i < originalRgbaPixels.length - 3; i += 4) {\n\t\tpixels.push(new PODASTPixel(originalRgbaPixels.slice(i, i + 4)));\n\t}\n\treturn pixels;\n}",
                "new_contents": "function PODASTImage(x, y, w, h, type, img) {\n\tthis.topLeft = {\n\t\tx: x,\n\t\ty: y\n\t};\n\tthis.dimensions = {\n\t\twidth: w,\n\t\theight: h\n\t};\n\tthis.type = type === \"output\" ? \"output\" : \"input\";\n\tthis.img = img;\n\tthis.pixels;\n\tthis.bytePixels; // Uint8Array holding pixel values after build\n\tthis.imageData;\n}\n\nPODASTImage.prototype.updateCustomImage = function(bytePixels) {\n\t// create array of pixel.value arrays\n\tconst valuesArray = typeof bytePixels === \"undefined\" ? this.pixels.map(a => a.value) : bytePixels;\n\t// join the pixels into a Uint8Array for a speed-up\n\tthis.bytePixels = Uint8Array.from([].concat.apply([], valuesArray));\n\tthis.imageData = ctx.getImageData(this.topLeft.x, this.topLeft.y, this.dimensions.width, this.dimensions.height);\n\tthis.imageData.data.set(this.bytePixels);\n};\n\nPODASTImage.prototype.encrypt = function(plaintext, i, p, d) {\n\tif(arguments.length < 4) {\n\t\tif(DEBUGGING >= 2) {\n\t\t\tconsole.warn(\"Not enough parameters specified.\");\n\t\t}\n\t\treturn false;\n\t}\n\tif(typeof this.pixels === \"undefined\") {\n\t\tif(this.build() === false) {\n\t\t\tif(DEBUGGING >= 1) {\n\t\t\t\tconsole.info(\"Please select an image before encrypting data.\");\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\t// copy img data\n\toutputImage.img = this.img;\n\t// prepare pixels\n\toutputImage.build();\n\t// Object.assign(outputImage, this);\n\t// divide the plaintext binary into small portions, ready to be divided over the to be altered pixels\n\tlet dataPortions = plaintext.match(new RegExp(\"[01]{1,\" + d + \"}\", \"g\")); // \"0111001\" --> [\"01\", \"11\", \"00\", \"1\"] (example I)\n\t// add bits indicator\n\ttry {\n\t\tdataPortions.push(addLeadingZeroes(decimalToBinary(dataPortions[dataPortions.length - 1].length), d));\n\t} catch(e) {\n\t\t// invalid binary data\n\t\tif(DEBUGGING >= 2) {\n\t\t\tconsole.warn(\"Invalid or empty binary data specified.\");\n\t\t}\n\t\tdataPortions = [];\n\t}\n\tif(DEBUGGING >= 3) {\n\t\tconsole.log(\"data portions: \", dataPortions);\n\t}\n\t// hide each portion in a different pixel\n\tlet pixelIndex = i;\n\tlet previousPixel;\n\tconst pixelsRange = Math.pow(2, p); // look for pixels 0 to pixelsRange pixels from current\n\t// NOTE we are altering outputImage, not this\n\tfor(var m = 0; m < dataPortions.length - 1; m++) {\n\t\tconst currentPixel = outputImage.pixels[pixelIndex];\n\t\tconst currentData = dataPortions[m];\n\t\tconst nextData = dataPortions[m + 1];\n\t\tconst currentPointer = 0;\n\t\t// update data for current pixel\n\t\tcurrentPixel.insertData(currentData.split(\"\"), p);\n\t\tconst relativeNextPixelIndex = outputImage.getNextPixelIndex(nextData, pixelIndex, pixelsRange, p, d);\n\t\tif(relativeNextPixelIndex === false) {\n\t\t\tif(DEBUGGING >= 1) {\n\t\t\t\tconsole.warn(\"PODAST was unable to complete the encryption process with the following \\n\" +\n\t\t\t\t\t\"parameters: i=\" + i + \", p=\" + p + \", d=\" + d + \", because it couldn't find any unaltered \\n\" +\n\t\t\t\t\t\"pixels within \" + pixelsRange + \" pixels from the current pixel.\\n\" +\n\t\t\t\t\t\"Please retry with different parameters, different text or a different image.\");\n\t\t\t}\n\t\t\treturn false;\n\t\t} else {\n\t\t\t// update pointer for current pixel\n\t\t\tcurrentPixel.insertPointer(addLeadingZeroes(decimalToBinary(relativeNextPixelIndex), p).split(\"\"));\n\t\t\tif(m === dataPortions.length - 2) {\n\t\t\t\t// possible bug: should be modularized or not?\n\t\t\t\tconst nextPixelIndex = pixelIndex + relativeNextPixelIndex;\n\t\t\t\tlet nextPixel = outputImage.pixels[nextPixelIndex];\n\t\t\t\t// update data in advance\n\t\t\t\tnextPixel.insertData(nextData.split(\"\"), p);\n\t\t\t\t// because that pixel will be the last, we can safely set the pointer to 0-terminator\n\t\t\t\tnextPixel.insertPointer(addLeadingZeroes(0, p).split(\"\"));\n\t\t\t\t// done!\n\t\t\t\tif(DEBUGGING >= 1) {\n\t\t\t\t\tconsole.info(\"Success! PODAST successfully encrypted your data with the following parameters: \\n\" +\n\t\t\t\t\t\t\"i=\" + i + \", p=\" + p + \", d=\" + d + \". Want to share your encrypted image? First, download your \\n\" +\n\t\t\t\t\t\t\"encrypted image, and send it to the receiver. Make sure you also share your decryption key: \\n\" +\n\t\t\t\t\t\t\"%c\" + generatePrivateKey(i, p, d) + \"%c , or else the receiver won't be able to read your message.\", \"font-weight: 900\", \"font-weight: initial\");\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tpixelIndex += relativeNextPixelIndex;\n\t}\n\toutputImage.updateCustomImage();\n\treturn generatePrivateKey(i, p, d);\n};\n\nPODASTImage.prototype.decrypt = function() {\n\tlet i;\n\tlet d;\n\tlet p;\n\tif(arguments.length === 0) {\n\t\t// invalid\n\t\tif(DEBUGGING >= 1) {\n\t\t\tconsole.warn(\"Not enough arguments specified.\");\n\t\t}\n\t\treturn false;\n\t} else if(arguments.length === 1) {\n\t\t// private key?\n\t\tlet matches;\n\t\ttry {\n\t\t\tmatches = arguments[0].match(validatePrivateKeyRegEx);\n\t\t} catch(exception) {\n\t\t\tmatches = null;\n\t\t}\n\t\tif(matches === null) {\n\t\t\tif(DEBUGGING >= 1) {\n\t\t\t\tconsole.warn(\"Invalid private key format specified.\");\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\ti = parseInt(matches[1], 10);\n\t\td = parseInt(matches[2], 10);\n\t\tp = parseInt(matches[3], 10);\n\t} else if(arguments.length === 3) {\n\t\ti = arguments[0];\n\t\td = arguments[1];\n\t\tp = arguments[2];\n\t}\n\t// using the pixels array would be cheating,\n\t// we have to assume that all we have is the Uint8Array,\n\t// because that is practically the picture a receiver would decrypt.\n\n\t// create new pixels array (local scope)\n\tconst temporaryPixels = quickBuild(this.bytePixels);\n\t// currentPixel is temporaryPixels[i]\n\tlet currentIndex = i;\n\tlet currentPixel = temporaryPixels[currentIndex];\n\tlet currentSignificanceArray = currentPixel.getSignificanceArray();\n\tlet currentDecimalPointer = parseInt(currentSignificanceArray.slice(-p).join(\"\"), 2);\n\tlet binaryDataString = currentDecimalPointer === 0 ? \"\" /* may be stupid, but data wasn't intended to be read */ : currentSignificanceArray.slice(-d-p, -p).join(\"\");\n\t// while not terminated (0-terminator in pointer)\n\twhile(currentDecimalPointer !== 0) {\n\t\tcurrentIndex = (currentIndex + currentDecimalPointer) % temporaryPixels.length;\n\t\tcurrentPixel = temporaryPixels[currentIndex];\n\t\tcurrentSignificanceArray = currentPixel.getSignificanceArray();\n\t\tcurrentDecimalPointer = parseInt(currentSignificanceArray.slice(-p).join(\"\"), 2);\n\t\t// remember, 0-terminator means that this piece of data tells us how many digits are meaningful.\n\t\t// it's not actual data.\n\t\tlet currentDataPiece = currentSignificanceArray.slice(-d-p, -p).join(\"\");\n\t\tif(currentDecimalPointer === 0) {\n\t\t\tconst currentDataDecimalValue = parseInt(currentDataPiece, 2);\n\t\t\t// get previous data\n\t\t\tconst previousDataPiece = binaryDataString.slice(-d);\n\t\t\t// get necessary part\n\t\t\tconst previousActualData = previousDataPiece.slice(-currentDataDecimalValue);\n\t\t\t// cut out unnecessary digits and add necessary\n\t\t\tbinaryDataString = binaryDataString.slice(0, -d) + previousActualData;\n\t\t} else {\n\t\t\tbinaryDataString += currentDataPiece;\n\t\t}\n\t}\n\treturn binaryDataString;\n};\n\n// for debugging purposes\nPODASTImage.prototype.inspectPixels = function() {\n\tfor(var i = 0; i < this.pixels.length; i++) {\n\t\tif(this.pixels[i].isAltered()) console.log(\"Altered pixel at (\" + i + \"): \", this.pixels[i]);\n\t}\n};\n\nPODASTImage.prototype.getNextPixelIndex = function(data, index, lookahead, p, d) {\n\tlet response = false;\n\tfor(var i = index + 1 /* current is bound to be altered */; i < index + lookahead; i++) {\n\t\t// TODO optimize?\n\t\tconst actualIndex = i % this.pixels.length;\n\t\tif(this.pixels[actualIndex].isAltered()) {\n\t\t\t// can't alter it twice, would corrupt existing data\n\t\t\tif(DEBUGGING >= 3) {\n\t\t\t\tconsole.log(\"pixel at (\" + actualIndex + \") is altered.\");\n\t\t\t}\n\t\t\tcontinue;\n\t\t} else {\n\t\t\tconst authenticPixelData = this.pixels[actualIndex].getSignificanceArray().slice(-p-d, -p).join(\"\");\n\t\t\tif(authenticPixelData === data) {\n\t\t\t\tresponse = actualIndex - index;\n\t\t\t\tbreak;\n\t\t\t} else if(actualIndex === index + lookahead - 1) {\n\t\t\t\tif(DEBUGGING >= 2) {\n\t\t\t\t\tconsole.info(\"Unable to find pixel that already contained the data we're trying to hide, using last pixel in range instead.\");\n\t\t\t\t}\n\t\t\t\tresponse = actualIndex - index;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\treturn response;\n};\n\nPODASTImage.prototype.build = function() {\n\tif(typeof this.img === \"undefined\" || this.img.pixels.length === 0) {\n\t\tif(DEBUGGING >= 2) {\n\t\t\tconsole.warn(\"Not ready to build image yet.\");\n\t\t}\n\t\treturn false;\n\t}\n\tthis.pixels = [];\n\tlet originalRgbaPixels = Array.from(this.img.pixels); // Uint8ClampedArray to Array\n\tfor(var i = 0; i < originalRgbaPixels.length - 3; i += 4) {\n\t\tthis.pixels.push(new PODASTPixel(originalRgbaPixels.slice(i, i + 4)));\n\t}\n\tthis.updateCustomImage();\n};\n\nPODASTImage.prototype.show = function() {\n\tif(typeof this.bytePixels === 'undefined') {\n\t\t// show box indicating where image can be shown\n\t\tnoFill();\n\t\tstroke(127, 127, 0);\n\t\tstrokeWeight(1);\n\t\trect(this.topLeft.x, this.topLeft.y, this.dimensions.width, this.dimensions.height);\n\t\t// explanatory text\n\t\ttextSize(headerHeight * 0.3);\n\t\tfill(217);\n\t\tnoStroke();\n\t\ttextAlign(CENTER);\n\t\tlet str;\n\t\tif(this.type === \"input\") {\n\t\t\tstr = \"Upload an image to see it displayed here.\";\n\t\t} else if(this.type === \"output\") {\n\t\t\tstr = \"Upload an image to see the image\\n after encryption displayed here.\";\n\t\t}\n\t\ttext(str, this.topLeft.x + 0.5 * this.dimensions.width, this.topLeft.y + 0.5 * this.dimensions.height);\n\t} else {\n\t\t// show PODASTImage\n\t\tputImageData(ctx, this.imageData, this.topLeft.x, this.topLeft.y);\n\t}\n};\n\n\n// TODO: optimize with base64 data instead of changing fillstyle every pixel\n// currently takes ~60ms to run for a 172x256 png!\nfunction putImageData(ctx, imageData, dx, dy) {\n  const data = imageData.data;\n  const height = imageData.height;\n  const width = imageData.width;\n  for (var y = 0; y < height; y++) {\n    for (var x = 0; x < width; x++) {\n      const pos = (y * width + x) * 4;\n      ctx.fillStyle = 'rgb(' + data[pos] + ',' + data[pos + 1] + ',' + data[pos + 2] + ')';\n      ctx.fillRect(x + dx, y + dy, 1, 1);\n    }\n  }\n}\n\nfunction quickBuild(imageData) {\n\tlet pixels = [];\n\tlet originalRgbaPixels = Array.from(imageData);\n\tfor(var i = 0; i < originalRgbaPixels.length - 3; i += 4) {\n\t\tpixels.push(new PODASTPixel(originalRgbaPixels.slice(i, i + 4)));\n\t}\n\treturn pixels;\n}",
                "subject": "Removed unecessary logging.",
                "message": "Removed unecessary logging.\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "nout-kleef/PODAST,nout-kleef/PODAST"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10224,
            "row": {
                "commit": "9339b29933f049485c7180e3dcc701d5a840f272",
                "old_file": "src/syncher/DataObject.js",
                "new_file": "src/syncher/DataObject.js",
                "old_contents": "/**\n* Copyright 2016 PT Inovação e Sistemas SA\n* Copyright 2016 INESC-ID\n* Copyright 2016 QUOBIS NETWORKS SL\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\n* Copyright 2016 ORANGE SA\n* Copyright 2016 Deutsche Telekom AG\n* Copyright 2016 Apizee\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n**/\n\n// Log System\nimport * as logger from 'loglevel';\nlet log = logger.getLogger('DataObject');\n\nimport SyncObject, {ChangeType, ObjectType} from './ProxyObject';\nimport DataObjectChild from './DataObjectChild';\nimport { deepClone, divideURL } from '../utils/utils.js';\nimport HypertyResourceFactory from '../hyperty-resource/HypertyResourceFactory.js';\n\n/**\n * Main extension class for observers and reporters, with common properties and methods.\n * Children management is common for observers and reporters.\n */\nclass DataObject {\n  /* private\n  _version: number\n\n  _owner: HypertyURL\n  _url: ObjectURL\n  _schema: Schema\n  _bus: MiniBus\n  _status: on | paused\n  _syncObj: SyncData\n\n  _children: { id: DataObjectChild }\n  _childrenListeners: [MsgListener]\n\n  ----event handlers----\n  _onAddChildHandler: (event) => void\n  */\n\n  /**\n   * @ignore\n   * Should not be used directly by Hyperties. It's called by the Syncher create or subscribe method's\n   */\n\n  constructor(input) {\n    let _this = this;\n\n    function throwMandatoryParmMissingError(par) {\n      throw '[DataObject] ' + par + ' mandatory parameter is missing';\n    }\n\n    input.syncher ? _this._syncher = input.syncher : throwMandatoryParmMissingError('syncher');\n    input.url ?  _this._url = input.url : throwMandatoryParmMissingError('url');\n    input.created ? _this._created = input.created : throwMandatoryParmMissingError('created');\n    input.reporter ? _this._reporter = input.reporter : throwMandatoryParmMissingError('reporter');\n    input.runtime ? _this._runtime = input.runtime : throwMandatoryParmMissingError('runtime');\n    input.schema ? _this._schema = input.schema : throwMandatoryParmMissingError('schema');\n    input.name ? _this._name = input.name : throwMandatoryParmMissingError('name');\n\n\n    _this._status = input.status;\n\n    if (input.data) {\n      _this._syncObj = new SyncObject(input.data);\n    } else {\n      _this._syncObj = new SyncObject({});\n    }\n    _this._childrens = input.childrens;\n\n    //TODO: For Further Study\n    _this._mutual = input.mutual;\n\n    _this._version = 0;\n    _this._childId = 0;\n    _this._childrenListeners = []; //bus listeners per children\n    _this._onAddChildrenHandler; //Hyperty side handlers to process child objects created by remote Hyperties\n\n    _this._resumed = input.resume;\n\n    if (input.resume) { _this._version = input.version; }\n\n    _this._owner = input.syncher._owner;\n    _this._bus = input.syncher._bus;\n\n    if (input.description) _this._description = input.description;\n    if (input.tags) _this._tags = input.tags;\n    if (input.resources) _this._resources = input.resources;\n    if (input.observerStorage) _this._observerStorage = input.observerStorage;\n    if (input.publicObservation) _this._publicObservation = input.publicObservation;\n\n    _this._metadata = Object.assign(input);\n    _this._metadata.lastModified = _this._metadata.created;\n\n    delete _this._metadata.data;\n    delete _this._metadata.syncher;\n    delete _this._metadata.authorise;\n\n    _this._hypertyResourceFactory = new HypertyResourceFactory();\n    _this._childrenObjects = {};\n    _this._sharedChilds = []; //childObjects that were not sent yet to Reporters\n  }\n\n  _getLastChildId() {\n    let _this = this;\n\n    let childIdInt = 0;\n    let childIdString = _this._owner + '#' + childIdInt;\n\n\n    Object.keys(_this._childrens).filter((key) => {\n      if (_this._childrens[key].childId > childIdString) {\n        childIdString = _this._childrens[key].childId;\n      }\n    });\n\n    return childIdInt = Number(childIdString.split('#')[1]);\n  }\n\n  _allocateListeners() {\n    let _this = this;\n\n    let childBaseURL = _this._url + '/children/';\n    log.log('[Data Object - AllocateListeners] - ', _this._childrens);\n    if (_this._childrens) {\n      _this._childrens.forEach((child) => {\n        let childURL = childBaseURL + child;\n        let listener = _this._bus.addListener(childURL, (msg) => {\n          //ignore msg sent by himself\n          if (msg.from !== this._owner) {\n            log.log('DataObject-Children-RCV: ', msg);\n            switch (msg.type) {\n              case 'create': _this._onChildCreate(msg); break;\n              case 'delete': log.log(msg); break;\n              default: _this._changeChildren(msg); break;\n            }\n          }\n        });\n\n        _this._childrenListeners.push(listener);\n      });\n    }\n  }\n\n  _releaseListeners() {\n    let _this = this;\n\n    _this._childrenListeners.forEach((listener) => {\n      listener.remove();\n    });\n\n    Object.keys(_this._childrenObjects).forEach((children) => {\n      Object.keys(_this._childrenObjects[children]).forEach((child) => {\n        _this._childrenObjects[children][child]._releaseListeners();\n      });\n    });\n  }\n\n  /**\n   *\n   */\n  resumeChildrens(childrens) {\n    let _this = this;\n\n    let childIdString = this._owner + '#' + this._childId;\n\n\n    //setup childrens data from subscription\n    Object.keys(childrens).forEach((childrenResource) => {\n      let children = childrens[childrenResource];\n\n      //_this._childrenObjects[childrenResource] = {};\n      Object.keys(children).forEach((childId) => {\n        let newChild = false;\n\n        if (!_this._childrenObjects.hasOwnProperty(childrenResource))\n          _this._childrenObjects[childrenResource] = {};\n\n        if (children[childId].value.resourceType && !_this._childrenObjects[childrenResource].hasOwnProperty(childId)) {\n          _this._childrenObjects[childrenResource][childId] = _this._resumeHypertyResource(children[childId]);\n          newChild = true;\n        } else if (!_this._childrenObjects[childrenResource].hasOwnProperty(childId)) {\n\n          _this._childrenObjects[childrenResource][childId] = _this._resumeChild(children[childId]);\n          log.log('[DataObject.resumeChildrens] new DataObjectChild: ', _this._childrenObjects[childrenResource][childId]);\n          newChild = true;\n        }\n\n        if (newChild && childId > childIdString) {\n          childIdString = childId;\n          log.log('[DataObjectReporter.resumeChildrens] - resuming: ', this._childrenObjects[childrenResource][childId]);\n        }\n\n      });\n    });\n\n    this._childId = Number(childIdString.split('#')[1]);\n\n  }\n\n  _resumeChild(input) {\n    let _this = this;\n    let childInput = input.value;\n    childInput.parentObject = _this;\n    childInput.parent = _this._url;\n\n    let child = new DataObjectChild(childInput);\n\n    child.identity = input.identity;\n\n    let event = {\n      type: 'create',\n      from: child.reporter,\n      url: child.parent,\n      value: child.data,\n      childId: child.url,\n      identity: child.identity,\n      child: child\n    };\n\n    if (child.resourceType) {\n      event.resource = child;\n\n    }\n\n    if (_this._onAddChildrenHandler) _this._onAddChildrenHandler(event);\n\n    return child;\n\n  }\n\n  _resumeHypertyResource(input) {\n    let _this = this;\n    let childInput = input.value;\n    childInput.parentObject = _this;\n    childInput.parent = _this._url;\n\n    let hypertyResource = _this._hypertyResourceFactory.createHypertyResource(false, childInput.resourceType, childInput)\n\n    hypertyResource.identity = input.identity;\n\n    let event = {\n      type: 'create',\n      from: hypertyResource.reporter,\n      url: hypertyResource.parent,\n      value: hypertyResource.data,\n      childId: hypertyResource.url,\n      identity: hypertyResource.identity,\n      child: hypertyResource\n    };\n\n    if (hypertyResource.resourceType) {\n      event.resource = hypertyResource;\n\n    }\n\n    if (_this._onAddChildrenHandler) _this._onAddChildrenHandler(event);\n\n    return hypertyResource;\n  }\n\n  /**\n   * All Metadata about the Data Object\n   * @type {Object} -\n   */\n\n  get metadata() { return this._metadata; }\n\n  /**\n   * Object URL of reporter or observer\n   * @type {ObjectURL}\n   */\n  get url() { return this._url; }\n\n  /**\n   * Object schema URL (this field is not yet stable, and is subsject to change)\n   * @type {SchemaURL}\n   */\n  get schema() { return this._schema; }\n\n  /**\n   * Status of the reporter or observer connection (this field is not yet stable, and is subsject to change)\n   * @type {Status} - Enum of: on | paused\n   */\n  get status() { return this._status; }\n\n  /**\n   * Data structure to be synchronized.\n   * @type {JSON} - JSON structure that should follow the defined schema, if any.\n   */\n  get data() { return this._syncObj.data; }\n\n  /**\n   * All created children's since the subscription, doesn't contain all children's since reporter creation.\n   * @type {Object<ChildId, DataObjectChild>}\n   */\n  get childrens() { return this._childrenObjects; }\n\n  /**\n   * @ignore\n   */\n  pause() {\n    //TODO: this feature needs more analise\n    throw 'Not implemented';\n  }\n\n  /**\n   * @ignore\n   */\n  resume() {\n    //TODO: this feature needs more analise\n    throw 'Not implemented';\n  }\n\n  /**\n   * @ignore\n   */\n  stop() {\n    //TODO: should remove the subscription and send message unsubscribe?\n    throw 'Not implemented';\n  }\n\n  /**\n   * Create and add a DataObjectChild to a children collection.\n   * @param {String} children - Children name where the child is added.\n   * @param {JSON} initialData - Initial data of the child\n   * @param  {MessageBodyIdentity} identity - (optional) identity data to be added to identity the user reporter. To be used for legacy identities.\n   * @param  {SyncChildMetadata} input - (optional) All additional metadata about the DataObjectChild.\n   * @return {Promise<DataObjectChild>} - Return Promise to a new DataObjectChild.\n   */\n\n  addChild(children, initialData, identity, input) {\n    let _this = this;\n    let newChild;\n\n    //returns promise, in the future, the API may change to asynchronous call\n    return new Promise((resolve) => {\n\n      let msgChildPath = _this._url + '/children/' + children;\n\n\n      let childInput = _this._getChildInput(input);\n      childInput.data = initialData;\n      childInput.children = children;\n      newChild = new DataObjectChild(childInput);\n\n      if (identity) newChild.identity = identity;\n\n      newChild.share();\n\n      log.log('[DataObject.addChild] added ', newChild);\n\n      newChild.onChange((event) => {\n        _this._onChange(event, { path: msgChildPath, childId: childInput.url });\n      });\n\n      if (!_this._childrenObjects.hasOwnProperty(children)) _this._childrenObjects[children] = {};\n\n      _this._childrenObjects[children][childInput.url] = newChild;\n\n      resolve(newChild);\n    });\n  }\n\n  _deleteChildrens() {\n\n    let _this = this;\n    let deletePromises = [];\n\n\n    return new Promise((resolve) => {\n      if (_this.childrens) {\n        log.log('[DataObject.deleteChildrens]', _this.childrens);\n        let children;\n\n        for (children in _this.childrens) {\n          let child;\n          for (child in _this.childrens[children]) {\n            let childObj = _this.childrens[children][child];\n            log.log('[DataObject._deleteChildrens] child',childObj);\n            if (childObj.metadata.hasOwnProperty('resourceType'))\n              deletePromises.push(_this.childrens[children][child].delete());\n          }\n        }\n      }\n\n      log.log('[DataObject._deleteChildrens] promises ', deletePromises);\n\n      if (deletePromises.length > 0) {\n        Promise.all(deletePromises).then(()=>{\n          resolve('[DataObject._deleteChildrens] done');\n        });\n      } else resolve('[DataObject._deleteChildrens] nothing to delete');\n\n    });\n\n  }\n\n  _getChildInput(input) {\n    let _this = this;\n    let childInput  = Object.assign({}, input);\n\n    _this._childId++;\n    childInput.url = _this._owner + '#' + _this._childId;\n\n    childInput.parentObject = _this;\n    childInput.reporter = _this._owner;\n    childInput.created = (new Date).toISOString();\n    childInput.runtime = _this._syncher._runtimeUrl;\n    childInput.p2pHandler = _this._syncher._p2pHandler;\n    childInput.p2pRequester = _this._syncher._p2pRequester;\n    childInput.schema = _this._schema;\n    childInput.parent = _this.url;\n\n    return childInput;\n  }\n\n  addHypertyResource(children, type, resource, identity, input) {\n    let _this = this;\n\n    //returns promise, in the future, the API may change to asynchronous call\n    return new Promise((resolve) => {\n\n      let hypertyResource;\n      let msgChildPath = _this._url + '/children/' + children;\n\n      let childInput = _this._getChildInput(input);\n      childInput.children = children;\n\n      _this._hypertyResourceFactory.createHypertyResourceWithContent(true, type, resource, childInput).then((resource)=>{\n        hypertyResource = resource;\n\n        if (identity) hypertyResource.identity = identity;\n\n        hypertyResource.share();\n\n        log.log('[DataObject.addHypertyResource] added ', hypertyResource);\n\n        hypertyResource.onChange((event) => {\n          _this._onChange(event, { path: msgChildPath, childId: hypertyResource.childId });\n        });\n\n        if (!_this._childrenObjects.hasOwnProperty(children)) _this._childrenObjects[children] = {};\n\n        _this._childrenObjects[children][hypertyResource.childId] = hypertyResource;\n\n        resolve(hypertyResource);\n      });\n\n\n    });\n  }\n\n  /**\n   * Setup the callback to process create and delete of childrens.\n   * @param {function(event: MsgEvent)} callback\n   * TODO: add childrenId to support different handlers per children\n   */\n  onAddChild(callback) {\n\n    this._onAddChildrenHandler = callback;\n  }\n\n  //FLOW-IN: message received from a remote DataObject -> addChild\n  _onChildCreate(msg) {\n    let _this = this;\n\n    log.log('[DataObject._onChildCreate] receivedBy ' + _this._owner + ' : ', msg);\n\n    let response = {\n      from: msg.to,\n      to: msg.from,\n      type: 'response',\n      id: msg.id,\n      body: {\n        code: 100\n      }\n    }\n\n    _this._bus.postMessage(response);\n\n    if (msg.body.value.resourceType) {\n      _this._onHypertyResourceAdded(msg);\n    } else _this._onChildAdded(msg);\n  }\n\n  _onChildAdded(msg) {\n    let _this = this;\n    let childInput = deepClone(msg.body.value);\n    childInput.parentObject = _this;\n\n    let children = childInput.children;\n\n    let newChild = new DataObjectChild(childInput);\n    newChild.identity = msg.body.identity;\n\n\n    if (!_this._childrenObjects.hasOwnProperty(children)) _this._childrenObjects[children] = {};\n\n    _this._childrenObjects[children][childInput.url] = newChild;\n\n    if (msg.to === _this.metadata.url) newChild.store();\n\n    _this._hypertyEvt(msg, newChild);\n  }\n\n  _onHypertyResourceAdded(msg) {\n    let _this = this;\n    let input = msg.body.value;\n    let hypertyResource;\n\n    let children = input.children;\n\n    input.parentObject = _this;\n\n    hypertyResource = _this._hypertyResourceFactory.createHypertyResource(false, input.resourceType, input);\n    hypertyResource.identity = msg.body.identity;\n\n    if (!_this._childrenObjects.hasOwnProperty(children)) _this._childrenObjects[children] = {};\n\n    _this._childrenObjects[children][hypertyResource.childId] = hypertyResource;\n\n    _this._hypertyEvt(msg, hypertyResource);\n\n    // locally store messages that are directly sent to the hyperty\n    // ie to sync with messages sent when offline\n\n    if (msg.to === _this.metadata.url) hypertyResource.store();\n  }\n\n  _hypertyEvt(msg, child) {\n    let _this = this;\n\n    let event = {\n      type: msg.type,\n      from: msg.from,\n      url: msg.to,\n      value: child.data,\n      childId: child.url,\n      identity: msg.body.identity,\n      child: child\n    };\n\n    if (child.resourceType) {\n      event.resource = child;\n\n    }\n\n    if (_this._onAddChildrenHandler) _this._onAddChildrenHandler(event);\n  }\n\n  //send delta messages to subscriptions\n  _onChange(event, childInfo) {\n    let _this = this;\n\n    _this._metadata.lastModified = (new Date).toISOString();\n\n    _this._version++;\n\n    if (_this._status === 'live') {\n      //FLOW-OUT: this message will be sent directly to a resource changes address: MessageBus\n      let changeMsg = {\n        type: 'update', from: _this._url, to: _this._url + '/changes',\n        body: { version: _this._version, source: _this._owner, attribute: event.field, lastModified: _this._metadata.lastModified }\n      };\n\n      log.log('[DataObject - _onChange] - ', event, childInfo, changeMsg);\n\n      if (event.oType === ObjectType.OBJECT) {\n        if (event.cType !== ChangeType.REMOVE) {\n          changeMsg.body.value = deepClone(event.data);\n        }\n      } else {\n        changeMsg.body.attributeType = event.oType;\n        changeMsg.body.value = event.data;\n        if (event.cType !== ChangeType.UPDATE) {\n          changeMsg.body.operation = event.cType;\n        }\n      }\n\n      //childInfo must have (path, childId)\n      if (childInfo) {\n        changeMsg.to = childInfo.path;\n        changeMsg.body.resource = childInfo.childId;\n      }\n\n      //TODO: For Further Study\n      if (!_this.data._mutual) changeMsg.body.mutual = _this._mutual;\n\n      _this._bus.postMessage(changeMsg);\n    }\n  }\n\n  //FLOW-IN: delta message received from a remote DataObjectReporter or DataObjectChild when changing data\n  _changeObject(syncObj, msg) {\n    let _this = this;\n\n    //TODO: update version ?\n    //how to handle an incorrect version ? Example: receive a version 3 when the observer is in version 1, where is the version 2 ?\n    //will we need to confirm the reception ?\n    if (_this._version + 1 <= msg.body.version) {\n      _this._version = msg.body.version;\n      let path = msg.body.attribute;\n      let value;\n      if (typeof msg.body.value === 'object') value = deepClone(msg.body.value);\n      else value = msg.body.value;\n\n      let findResult = syncObj.findBefore(path);\n\n      if (msg.body.lastModified) {\n        _this._metadata.lastModified = msg.body.lastModified;\n      } else {\n        _this._metadata.lastModified = (new Date).toISOString();\n      }\n\n      if (msg.body.attributeType === ObjectType.ARRAY) {\n        if (msg.body.operation === ChangeType.ADD) {\n          let arr = findResult.obj;\n          let index = findResult.last;\n          Array.prototype.splice.apply(arr, [index, 0].concat(value));\n        } else if (msg.body.operation === ChangeType.REMOVE) {\n          let arr = findResult.obj;\n          let index = findResult.last;\n          arr.splice(index, value);\n        } else {\n          findResult.obj[findResult.last] = value; // UPDATE\n        }\n      } else {\n        if (msg.body.hasOwnProperty('value')) {\n          findResult.obj[findResult.last] = value; // UPDATE or ADD\n        } else {\n          delete findResult.obj[findResult.last]; // REMOVE\n        }\n      }\n    } else {\n      //TODO: how to handle unsynchronized versions?\n      log.log('UNSYNCHRONIZED VERSION: (data => ' + _this._version + ', msg => ' + msg.body.version + ')');\n    }\n  }\n\n  //FLOW-IN: message received from a remote DataObjectChild when changing data\n  _changeChildren(msg) {\n    let _this = this;\n    const dividedURL = divideURL(msg.to);\n    const identity = dividedURL.identity;\n    const resource = identity ? identity.substring(identity.lastIndexOf('/') + 1) : undefined;\n\n    let childId = msg.body.resource;\n    let children = _this._childrenObjects[resource][childId];\n\n    log.log('Change children: ', _this._owner, msg, resource);\n\n    if (children) {\n      _this._changeObject(children._syncObj, msg);\n    } else {\n      log.warn('No children found for: ', childId);\n    }\n  }\n\n}\n\nexport default DataObject;\n",
                "new_contents": "/**\n* Copyright 2016 PT Inovação e Sistemas SA\n* Copyright 2016 INESC-ID\n* Copyright 2016 QUOBIS NETWORKS SL\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\n* Copyright 2016 ORANGE SA\n* Copyright 2016 Deutsche Telekom AG\n* Copyright 2016 Apizee\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n**/\n\n// Log System\nimport * as logger from 'loglevel';\nlet log = logger.getLogger('DataObject');\n\nimport SyncObject, {ChangeType, ObjectType} from './ProxyObject';\nimport DataObjectChild from './DataObjectChild';\nimport { deepClone, divideURL } from '../utils/utils.js';\nimport HypertyResourceFactory from '../hyperty-resource/HypertyResourceFactory.js';\n\n/**\n * Main extension class for observers and reporters, with common properties and methods.\n * Children management is common for observers and reporters.\n */\nclass DataObject {\n  /* private\n  _version: number\n\n  _owner: HypertyURL\n  _url: ObjectURL\n  _schema: Schema\n  _bus: MiniBus\n  _status: on | paused\n  _syncObj: SyncData\n\n  _children: { id: DataObjectChild }\n  _childrenListeners: [MsgListener]\n\n  ----event handlers----\n  _onAddChildHandler: (event) => void\n  */\n\n  /**\n   * @ignore\n   * Should not be used directly by Hyperties. It's called by the Syncher create or subscribe method's\n   */\n\n  constructor(input) {\n    let _this = this;\n\n    function throwMandatoryParmMissingError(par) {\n      throw '[DataObject] ' + par + ' mandatory parameter is missing';\n    }\n\n    input.syncher ? _this._syncher = input.syncher : throwMandatoryParmMissingError('syncher');\n    input.url ?  _this._url = input.url : throwMandatoryParmMissingError('url');\n    input.created ? _this._created = input.created : throwMandatoryParmMissingError('created');\n    input.reporter ? _this._reporter = input.reporter : throwMandatoryParmMissingError('reporter');\n    input.runtime ? _this._runtime = input.runtime : throwMandatoryParmMissingError('runtime');\n    input.schema ? _this._schema = input.schema : throwMandatoryParmMissingError('schema');\n    input.name ? _this._name = input.name : throwMandatoryParmMissingError('name');\n\n\n    _this._status = input.status;\n\n    if (input.data) {\n      _this._syncObj = new SyncObject(input.data);\n    } else {\n      _this._syncObj = new SyncObject({});\n    }\n    _this._childrens = input.childrens;\n\n    //TODO: For Further Study\n    _this._mutual = input.mutual;\n\n    _this._version = 0;\n    _this._childId = 0;\n    _this._childrenListeners = []; //bus listeners per children\n    _this._onAddChildrenHandler; //Hyperty side handlers to process child objects created by remote Hyperties\n\n    _this._resumed = input.resume;\n\n    if (input.resume) { _this._version = input.version; }\n\n    _this._owner = input.syncher._owner;\n    _this._bus = input.syncher._bus;\n\n    if (input.description) _this._description = input.description;\n    if (input.tags) _this._tags = input.tags;\n    if (input.resources) _this._resources = input.resources;\n    if (input.observerStorage) _this._observerStorage = input.observerStorage;\n    if (input.publicObservation) _this._publicObservation = input.publicObservation;\n\n    _this._metadata = Object.assign(input);\n    if (!_this._resumed) _this._metadata.lastModified = _this._metadata.created;\n\n    delete _this._metadata.data;\n    delete _this._metadata.syncher;\n    delete _this._metadata.authorise;\n\n    _this._hypertyResourceFactory = new HypertyResourceFactory();\n    _this._childrenObjects = {};\n    _this._sharedChilds = []; //childObjects that were not sent yet to Reporters\n  }\n\n  _getLastChildId() {\n    let _this = this;\n\n    let childIdInt = 0;\n    let childIdString = _this._owner + '#' + childIdInt;\n\n\n    Object.keys(_this._childrens).filter((key) => {\n      if (_this._childrens[key].childId > childIdString) {\n        childIdString = _this._childrens[key].childId;\n      }\n    });\n\n    return childIdInt = Number(childIdString.split('#')[1]);\n  }\n\n  _allocateListeners() {\n    let _this = this;\n\n    let childBaseURL = _this._url + '/children/';\n    log.log('[Data Object - AllocateListeners] - ', _this._childrens);\n    if (_this._childrens) {\n      _this._childrens.forEach((child) => {\n        let childURL = childBaseURL + child;\n        let listener = _this._bus.addListener(childURL, (msg) => {\n          //ignore msg sent by himself\n          if (msg.from !== this._owner) {\n            log.log('DataObject-Children-RCV: ', msg);\n            switch (msg.type) {\n              case 'create': _this._onChildCreate(msg); break;\n              case 'delete': log.log(msg); break;\n              default: _this._changeChildren(msg); break;\n            }\n          }\n        });\n\n        _this._childrenListeners.push(listener);\n      });\n    }\n  }\n\n  _releaseListeners() {\n    let _this = this;\n\n    _this._childrenListeners.forEach((listener) => {\n      listener.remove();\n    });\n\n    Object.keys(_this._childrenObjects).forEach((children) => {\n      Object.keys(_this._childrenObjects[children]).forEach((child) => {\n        _this._childrenObjects[children][child]._releaseListeners();\n      });\n    });\n  }\n\n  /**\n   *\n   */\n  resumeChildrens(childrens) {\n    let _this = this;\n\n    let childIdString = this._owner + '#' + this._childId;\n\n\n    //setup childrens data from subscription\n    Object.keys(childrens).forEach((childrenResource) => {\n      let children = childrens[childrenResource];\n\n      //_this._childrenObjects[childrenResource] = {};\n      Object.keys(children).forEach((childId) => {\n        let newChild = false;\n\n        if (!_this._childrenObjects.hasOwnProperty(childrenResource))\n          _this._childrenObjects[childrenResource] = {};\n\n        if (children[childId].value.resourceType && !_this._childrenObjects[childrenResource].hasOwnProperty(childId)) {\n          _this._childrenObjects[childrenResource][childId] = _this._resumeHypertyResource(children[childId]);\n          newChild = true;\n        } else if (!_this._childrenObjects[childrenResource].hasOwnProperty(childId)) {\n\n          _this._childrenObjects[childrenResource][childId] = _this._resumeChild(children[childId]);\n          log.log('[DataObject.resumeChildrens] new DataObjectChild: ', _this._childrenObjects[childrenResource][childId]);\n          newChild = true;\n        }\n\n        if (newChild && childId > childIdString) {\n          childIdString = childId;\n          log.log('[DataObjectReporter.resumeChildrens] - resuming: ', this._childrenObjects[childrenResource][childId]);\n        }\n\n      });\n    });\n\n    this._childId = Number(childIdString.split('#')[1]);\n\n  }\n\n  _resumeChild(input) {\n    let _this = this;\n    let childInput = input.value;\n    childInput.parentObject = _this;\n    childInput.parent = _this._url;\n\n    let child = new DataObjectChild(childInput);\n\n    child.identity = input.identity;\n\n    let event = {\n      type: 'create',\n      from: child.reporter,\n      url: child.parent,\n      value: child.data,\n      childId: child.url,\n      identity: child.identity,\n      child: child\n    };\n\n    if (child.resourceType) {\n      event.resource = child;\n\n    }\n\n    if (_this._onAddChildrenHandler) _this._onAddChildrenHandler(event);\n\n    return child;\n\n  }\n\n  _resumeHypertyResource(input) {\n    let _this = this;\n    let childInput = input.value;\n    childInput.parentObject = _this;\n    childInput.parent = _this._url;\n\n    let hypertyResource = _this._hypertyResourceFactory.createHypertyResource(false, childInput.resourceType, childInput)\n\n    hypertyResource.identity = input.identity;\n\n    let event = {\n      type: 'create',\n      from: hypertyResource.reporter,\n      url: hypertyResource.parent,\n      value: hypertyResource.data,\n      childId: hypertyResource.url,\n      identity: hypertyResource.identity,\n      child: hypertyResource\n    };\n\n    if (hypertyResource.resourceType) {\n      event.resource = hypertyResource;\n\n    }\n\n    if (_this._onAddChildrenHandler) _this._onAddChildrenHandler(event);\n\n    return hypertyResource;\n  }\n\n  /**\n   * All Metadata about the Data Object\n   * @type {Object} -\n   */\n\n  get metadata() { return this._metadata; }\n\n  /**\n   * Object URL of reporter or observer\n   * @type {ObjectURL}\n   */\n  get url() { return this._url; }\n\n  /**\n   * Object schema URL (this field is not yet stable, and is subsject to change)\n   * @type {SchemaURL}\n   */\n  get schema() { return this._schema; }\n\n  /**\n   * Status of the reporter or observer connection (this field is not yet stable, and is subsject to change)\n   * @type {Status} - Enum of: on | paused\n   */\n  get status() { return this._status; }\n\n  /**\n   * Data structure to be synchronized.\n   * @type {JSON} - JSON structure that should follow the defined schema, if any.\n   */\n  get data() { return this._syncObj.data; }\n\n  /**\n   * All created children's since the subscription, doesn't contain all children's since reporter creation.\n   * @type {Object<ChildId, DataObjectChild>}\n   */\n  get childrens() { return this._childrenObjects; }\n\n  /**\n   * @ignore\n   */\n  pause() {\n    //TODO: this feature needs more analise\n    throw 'Not implemented';\n  }\n\n  /**\n   * @ignore\n   */\n  resume() {\n    //TODO: this feature needs more analise\n    throw 'Not implemented';\n  }\n\n  /**\n   * @ignore\n   */\n  stop() {\n    //TODO: should remove the subscription and send message unsubscribe?\n    throw 'Not implemented';\n  }\n\n  /**\n   * Create and add a DataObjectChild to a children collection.\n   * @param {String} children - Children name where the child is added.\n   * @param {JSON} initialData - Initial data of the child\n   * @param  {MessageBodyIdentity} identity - (optional) identity data to be added to identity the user reporter. To be used for legacy identities.\n   * @param  {SyncChildMetadata} input - (optional) All additional metadata about the DataObjectChild.\n   * @return {Promise<DataObjectChild>} - Return Promise to a new DataObjectChild.\n   */\n\n  addChild(children, initialData, identity, input) {\n    let _this = this;\n    let newChild;\n\n    //returns promise, in the future, the API may change to asynchronous call\n    return new Promise((resolve) => {\n\n      let msgChildPath = _this._url + '/children/' + children;\n\n\n      let childInput = _this._getChildInput(input);\n      childInput.data = initialData;\n      childInput.children = children;\n      newChild = new DataObjectChild(childInput);\n\n      if (identity) newChild.identity = identity;\n\n      newChild.share();\n\n      log.log('[DataObject.addChild] added ', newChild);\n\n      newChild.onChange((event) => {\n        _this._onChange(event, { path: msgChildPath, childId: childInput.url });\n      });\n\n      if (!_this._childrenObjects.hasOwnProperty(children)) _this._childrenObjects[children] = {};\n\n      _this._childrenObjects[children][childInput.url] = newChild;\n\n      resolve(newChild);\n    });\n  }\n\n  _deleteChildrens() {\n\n    let _this = this;\n    let deletePromises = [];\n\n\n    return new Promise((resolve) => {\n      if (_this.childrens) {\n        log.log('[DataObject.deleteChildrens]', _this.childrens);\n        let children;\n\n        for (children in _this.childrens) {\n          let child;\n          for (child in _this.childrens[children]) {\n            let childObj = _this.childrens[children][child];\n            log.log('[DataObject._deleteChildrens] child',childObj);\n            if (childObj.metadata.hasOwnProperty('resourceType'))\n              deletePromises.push(_this.childrens[children][child].delete());\n          }\n        }\n      }\n\n      log.log('[DataObject._deleteChildrens] promises ', deletePromises);\n\n      if (deletePromises.length > 0) {\n        Promise.all(deletePromises).then(()=>{\n          resolve('[DataObject._deleteChildrens] done');\n        });\n      } else resolve('[DataObject._deleteChildrens] nothing to delete');\n\n    });\n\n  }\n\n  _getChildInput(input) {\n    let _this = this;\n    let childInput  = Object.assign({}, input);\n\n    _this._childId++;\n    childInput.url = _this._owner + '#' + _this._childId;\n\n    childInput.parentObject = _this;\n    childInput.reporter = _this._owner;\n    childInput.created = (new Date).toISOString();\n    childInput.runtime = _this._syncher._runtimeUrl;\n    childInput.p2pHandler = _this._syncher._p2pHandler;\n    childInput.p2pRequester = _this._syncher._p2pRequester;\n    childInput.schema = _this._schema;\n    childInput.parent = _this.url;\n\n    return childInput;\n  }\n\n  addHypertyResource(children, type, resource, identity, input) {\n    let _this = this;\n\n    //returns promise, in the future, the API may change to asynchronous call\n    return new Promise((resolve) => {\n\n      let hypertyResource;\n      let msgChildPath = _this._url + '/children/' + children;\n\n      let childInput = _this._getChildInput(input);\n      childInput.children = children;\n\n      _this._hypertyResourceFactory.createHypertyResourceWithContent(true, type, resource, childInput).then((resource)=>{\n        hypertyResource = resource;\n\n        if (identity) hypertyResource.identity = identity;\n\n        hypertyResource.share();\n\n        log.log('[DataObject.addHypertyResource] added ', hypertyResource);\n\n        hypertyResource.onChange((event) => {\n          _this._onChange(event, { path: msgChildPath, childId: hypertyResource.childId });\n        });\n\n        if (!_this._childrenObjects.hasOwnProperty(children)) _this._childrenObjects[children] = {};\n\n        _this._childrenObjects[children][hypertyResource.childId] = hypertyResource;\n\n        resolve(hypertyResource);\n      });\n\n\n    });\n  }\n\n  /**\n   * Setup the callback to process create and delete of childrens.\n   * @param {function(event: MsgEvent)} callback\n   * TODO: add childrenId to support different handlers per children\n   */\n  onAddChild(callback) {\n\n    this._onAddChildrenHandler = callback;\n  }\n\n  //FLOW-IN: message received from a remote DataObject -> addChild\n  _onChildCreate(msg) {\n    let _this = this;\n\n    log.log('[DataObject._onChildCreate] receivedBy ' + _this._owner + ' : ', msg);\n\n    let response = {\n      from: msg.to,\n      to: msg.from,\n      type: 'response',\n      id: msg.id,\n      body: {\n        code: 100\n      }\n    }\n\n    _this._bus.postMessage(response);\n\n    if (msg.body.value.resourceType) {\n      _this._onHypertyResourceAdded(msg);\n    } else _this._onChildAdded(msg);\n  }\n\n  _onChildAdded(msg) {\n    let _this = this;\n    let childInput = deepClone(msg.body.value);\n    childInput.parentObject = _this;\n\n    let children = childInput.children;\n\n    let newChild = new DataObjectChild(childInput);\n    newChild.identity = msg.body.identity;\n\n\n    if (!_this._childrenObjects.hasOwnProperty(children)) _this._childrenObjects[children] = {};\n\n    _this._childrenObjects[children][childInput.url] = newChild;\n\n    if (msg.to === _this.metadata.url) newChild.store();\n\n    _this._hypertyEvt(msg, newChild);\n  }\n\n  _onHypertyResourceAdded(msg) {\n    let _this = this;\n    let input = msg.body.value;\n    let hypertyResource;\n\n    let children = input.children;\n\n    input.parentObject = _this;\n\n    hypertyResource = _this._hypertyResourceFactory.createHypertyResource(false, input.resourceType, input);\n    hypertyResource.identity = msg.body.identity;\n\n    if (!_this._childrenObjects.hasOwnProperty(children)) _this._childrenObjects[children] = {};\n\n    _this._childrenObjects[children][hypertyResource.childId] = hypertyResource;\n\n    _this._hypertyEvt(msg, hypertyResource);\n\n    // locally store messages that are directly sent to the hyperty\n    // ie to sync with messages sent when offline\n\n    if (msg.to === _this.metadata.url) hypertyResource.store();\n  }\n\n  _hypertyEvt(msg, child) {\n    let _this = this;\n\n    let event = {\n      type: msg.type,\n      from: msg.from,\n      url: msg.to,\n      value: child.data,\n      childId: child.url,\n      identity: msg.body.identity,\n      child: child\n    };\n\n    if (child.resourceType) {\n      event.resource = child;\n\n    }\n\n    if (_this._onAddChildrenHandler) _this._onAddChildrenHandler(event);\n  }\n\n  //send delta messages to subscriptions\n  _onChange(event, childInfo) {\n    let _this = this;\n\n    _this._metadata.lastModified = (new Date).toISOString();\n\n    _this._version++;\n\n    if (_this._status === 'live') {\n      //FLOW-OUT: this message will be sent directly to a resource changes address: MessageBus\n      let changeMsg = {\n        type: 'update', from: _this._url, to: _this._url + '/changes',\n        body: { version: _this._version, source: _this._owner, attribute: event.field, lastModified: _this._metadata.lastModified }\n      };\n\n      log.log('[DataObject - _onChange] - ', event, childInfo, changeMsg);\n\n      if (event.oType === ObjectType.OBJECT) {\n        if (event.cType !== ChangeType.REMOVE) {\n          changeMsg.body.value = deepClone(event.data);\n        }\n      } else {\n        changeMsg.body.attributeType = event.oType;\n        changeMsg.body.value = event.data;\n        if (event.cType !== ChangeType.UPDATE) {\n          changeMsg.body.operation = event.cType;\n        }\n      }\n\n      //childInfo must have (path, childId)\n      if (childInfo) {\n        changeMsg.to = childInfo.path;\n        changeMsg.body.resource = childInfo.childId;\n      }\n\n      //TODO: For Further Study\n      if (!_this.data._mutual) changeMsg.body.mutual = _this._mutual;\n\n      _this._bus.postMessage(changeMsg);\n    }\n  }\n\n  //FLOW-IN: delta message received from a remote DataObjectReporter or DataObjectChild when changing data\n  _changeObject(syncObj, msg) {\n    let _this = this;\n\n    //TODO: update version ?\n    //how to handle an incorrect version ? Example: receive a version 3 when the observer is in version 1, where is the version 2 ?\n    //will we need to confirm the reception ?\n    if (_this._version + 1 <= msg.body.version) {\n      _this._version = msg.body.version;\n      let path = msg.body.attribute;\n      let value;\n      if (typeof msg.body.value === 'object') value = deepClone(msg.body.value);\n      else value = msg.body.value;\n\n      let findResult = syncObj.findBefore(path);\n\n      if (msg.body.lastModified) {\n        _this._metadata.lastModified = msg.body.lastModified;\n      } else {\n        _this._metadata.lastModified = (new Date).toISOString();\n      }\n\n      if (msg.body.attributeType === ObjectType.ARRAY) {\n        if (msg.body.operation === ChangeType.ADD) {\n          let arr = findResult.obj;\n          let index = findResult.last;\n          Array.prototype.splice.apply(arr, [index, 0].concat(value));\n        } else if (msg.body.operation === ChangeType.REMOVE) {\n          let arr = findResult.obj;\n          let index = findResult.last;\n          arr.splice(index, value);\n        } else {\n          findResult.obj[findResult.last] = value; // UPDATE\n        }\n      } else {\n        if (msg.body.hasOwnProperty('value')) {\n          findResult.obj[findResult.last] = value; // UPDATE or ADD\n        } else {\n          delete findResult.obj[findResult.last]; // REMOVE\n        }\n      }\n    } else {\n      //TODO: how to handle unsynchronized versions?\n      log.log('UNSYNCHRONIZED VERSION: (data => ' + _this._version + ', msg => ' + msg.body.version + ')');\n    }\n  }\n\n  //FLOW-IN: message received from a remote DataObjectChild when changing data\n  _changeChildren(msg) {\n    let _this = this;\n    const dividedURL = divideURL(msg.to);\n    const identity = dividedURL.identity;\n    const resource = identity ? identity.substring(identity.lastIndexOf('/') + 1) : undefined;\n\n    let childId = msg.body.resource;\n    let children = _this._childrenObjects[resource][childId];\n\n    log.log('Change children: ', _this._owner, msg, resource);\n\n    if (children) {\n      _this._changeObject(children._syncObj, msg);\n    } else {\n      log.warn('No children found for: ', childId);\n    }\n  }\n\n}\n\nexport default DataObject;\n",
                "subject": "DataObject: lastModified mantains its value when resuming",
                "message": "DataObject: lastModified mantains its value when resuming",
                "lang": "JavaScript",
                "license": "apache-2.0",
                "repos": "reTHINK-project/dev-service-framework,reTHINK-project/dev-service-framework,reTHINK-project/dev-service-framework"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10225,
            "row": {
                "commit": "45872a08e5c32317b11f0f52f4ced863535246b5",
                "old_file": "jquery.popconfirm.js",
                "new_file": "jquery.popconfirm.js",
                "old_contents": "(function($){\n\t$.fn.extend({\n\t\tpopConfirm: function(options) {\n\t\t\tvar defaults = {\n\t\t\t\ttitle: 'Confirmation',\n\t\t\t\tcontent: 'Are you really sure ?',\n\t\t\t\tplacement: 'right'\n\t\t\t};\n\t\t\tvar options =  $.extend(defaults, options);\n\t\t\t\n\t\t\treturn this.each(function() {\n\t\t\t\tvar self = $(this);\n\t\t\t\tvar arrayActions = [];\n\t\t\t\t\n\t\t\t\t// If there are jquery click events\n\t\t\t\tif (typeof(jQuery._data(this, \"events\")) != \"undefined\" && typeof(jQuery._data(this, \"events\")['click']) != \"undefined\") {\n\t\t\t\t\t\n\t\t\t\t\t// Save all click handlers\n\t\t\t\t\tfor (var i = 0; i < jQuery._data(this, \"events\")['click'].length; i++) {\n\t\t\t\t\t\tarrayActions.push(jQuery._data(this, \"events\")['click'][i].handler);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// unbind it to prevent it firing\n\t\t\t\t\t$(self).unbind(\"click\");\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// If there are hard onclick attribute\n\t\t\t\tif(typeof self.attr('onclick') != 'undefined') {\n\t\t\t\t\t// Extracting the onclick code to evaluate and bring it into a closure\n\t\t\t\t\tvar code = self.attr('onclick');\n\t\t\t\t\tarrayActions.push(function() {\n\t\t\t\t\t\teval(code);\n\t\t\t\t\t});\n\t\t\t\t\t$(self).removeAttr('onclick');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// If there are href link defined\n\t\t\t\tif(typeof self.attr('href') != 'undefined') {\n\t\t\t\t\t// Assume there is a href attribute to redirect to\n\t\t\t\t\tarrayActions.push(function() {\n\t\t\t\t\t\twindow.location.href = self.attr('href');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// If the button is a submit one\n\t\t\t\tif(typeof self.attr('type') != 'undefined' && self.attr('type') == 'submit') {\n\t\t\t\t\t// Get the form related to this button then store submiting in closure\n\t\t\t\t\tvar form = $(this).parents('form:first');\n\t\t\t\t\tarrayActions.push(function() {\n\t\t\t\t\t\tform.submit();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tself.popover({\n\t\t\t\t\ttrigger: 'manual',\n\t\t\t\t\ttitle: options.title,\n\t\t\t\t\thtml: true,\n\t\t\t\t\tplacement: options.placement,\n\t\t\t\t\tcontent: options.content + '\\\n\t\t\t\t\t\t<p class=\"button-group\" style=\"margin-top: 10px; text-align: center;\">\\\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-small btn-danger confirm-dialog-btn-confirm\">Oui</button>\\\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-small confirm-dialog-btn-abord\">Non</button>\\\n\t\t\t\t\t\t</p>\\\n\t\t\t\t\t'\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tself.bind('click', function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\n\t\t\t\t\tself.popover('show');\n\t\t\t\t\t\n\t\t\t\t\tself.next('.popover').find('.confirm-dialog-btn-confirm').bind('click', function(e) {\n\t\t\t\t\t\tfor(var i = 0; i < arrayActions.length; i++) {\n\t\t\t\t\t\t\tarrayActions[i]();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tself.popover('hide');\n\t\t\t\t\t});\n\t\t\t\t\tself.next('.popover').find('.confirm-dialog-btn-abord').bind('click', function(e) {\n\t\t\t\t\t\tself.popover('hide');\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});   \n})(jQuery);",
                "new_contents": "(function($){\n\t$.fn.extend({\n\t\tpopConfirm: function(options) {\n\t\t\tvar defaults = {\n\t\t\t\ttitle: 'Confirmation',\n\t\t\t\tcontent: 'Are you really sure ?',\n\t\t\t\tplacement: 'right'\n\t\t\t};\n\t\t\tvar options =  $.extend(defaults, options);\n\t\t\t\n\t\t\treturn this.each(function() {\n\t\t\t\tvar self = $(this);\n\t\t\t\tvar arrayActions = [];\n\t\t\t\t\n\t\t\t\t// If there are jquery click events\n\t\t\t\tif (typeof(jQuery._data(this, \"events\")) != \"undefined\" && typeof(jQuery._data(this, \"events\")['click']) != \"undefined\") {\n\t\t\t\t\t\n\t\t\t\t\t// Save all click handlers\n\t\t\t\t\tfor (var i = 0; i < jQuery._data(this, \"events\")['click'].length; i++) {\n\t\t\t\t\t\tarrayActions.push(jQuery._data(this, \"events\")['click'][i].handler);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// unbind it to prevent it firing\n\t\t\t\t\t$(self).unbind(\"click\");\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// If there are hard onclick attribute\n\t\t\t\tif(typeof self.attr('onclick') != 'undefined') {\n\t\t\t\t\t// Extracting the onclick code to evaluate and bring it into a closure\n\t\t\t\t\tvar code = self.attr('onclick');\n\t\t\t\t\tarrayActions.push(function() {\n\t\t\t\t\t\teval(code);\n\t\t\t\t\t});\n\t\t\t\t\t$(self).removeAttr('onclick');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// If there are href link defined\n\t\t\t\tif(typeof self.attr('href') != 'undefined') {\n\t\t\t\t\t// Assume there is a href attribute to redirect to\n\t\t\t\t\tarrayActions.push(function() {\n\t\t\t\t\t\twindow.location.href = self.attr('href');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// If the button is a submit one\n\t\t\t\tif(typeof self.attr('type') != 'undefined' && self.attr('type') == 'submit') {\n\t\t\t\t\t// Get the form related to this button then store submiting in closure\n\t\t\t\t\tvar form = $(this).parents('form:first');\n\t\t\t\t\tarrayActions.push(function() {\n\t\t\t\t\t\tform.submit();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tself.popover({\n\t\t\t\t\ttrigger: 'manual',\n\t\t\t\t\ttitle: options.title,\n\t\t\t\t\thtml: true,\n\t\t\t\t\tplacement: options.placement,\n\t\t\t\t\tcontent: options.content + '\\\n\t\t\t\t\t\t<p class=\"button-group\" style=\"margin-top: 10px; text-align: center;\">\\\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-small btn-danger confirm-dialog-btn-confirm\">Oui</button>\\\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn btn-small confirm-dialog-btn-abord\">Non</button>\\\n\t\t\t\t\t\t</p>\\\n\t\t\t\t\t'\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tself.bind('click', function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\n\t\t\t\t\tself.popover('show');\n\t\t\t\t\t\n\t\t\t\t\tself.next('.popover').find('.confirm-dialog-btn-confirm').bind('click', function(e) {\n\t\t\t\t\t\tfor(var i = 0; i < arrayActions.length; i++) {\n\t\t\t\t\t\t\tarrayActions[i].apply(self);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tself.popover('hide');\n\t\t\t\t\t});\n\t\t\t\t\tself.next('.popover').find('.confirm-dialog-btn-abord').bind('click', function(e) {\n\t\t\t\t\t\tself.popover('hide');\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});   \n})(jQuery);",
                "subject": "[fix] Sending This into closure execution",
                "message": "[fix] Sending This into closure execution\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "renat2985/PopConfirm,sdaitzman/PopConfirm,Ifnot/PopConfirm,sdaitzman/PopConfirm,renat2985/PopConfirm,Ifnot/PopConfirm"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10226,
            "row": {
                "commit": "ab8609bd23fc34f946be7d4f5d48122a12fc8130",
                "old_file": "sync.js",
                "new_file": "sync.js",
                "old_contents": "/* Nitro Sync\n *\n * Copyright (C) 2012 Caffeinated Code <http://caffeinatedco.de>\n * Copyright (C) 2012 Jono Cooper\n * Copyright (C) 2012 George Czabania\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n *\n * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n * Neither the name of Caffeinated Code nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nconsole.info('Nitro Sync 1.3\\nCopyright (C) 2012 Caffeinated Code\\nBy George Czabania & Jono Cooper');\n\nvar settings = {\n\tfilename: 'nitro_data.json',\n\turl: 'http://localhost:3000'\n}\n\n// Node Packages\nvar email = require('mailer'),\n\texpress = require('express'),\n\tapp = express.createServer(),\n\tdbox = require(\"dbox\").app({ \"app_key\": \"da4u54t1irdahco\", \"app_secret\": \"3ydqe041ogqe1zq\" }),\n\tOAuth = require(\"oauth\").OAuth;\n \n// Ubuntu one settings\nvar ubuntu = new OAuth(\"https://one.ubuntu.com/oauth/request/\", \"https://one.ubuntu.com/oauth/access/\", \"ubuntuone\", \"hammertime\", \"1.0\", settings.url + \"/ubuntu-one/\", \"PLAINTEXT\"),\n\tusers = {dropbox: {}, ubuntu: {}};\n\n//Funky Headers =)\napp.use(function (req, res, next) {\n\tres.header(\"X-powered-by\", \"NitrOS 2000\");\n\tnext();\n});\n\n// Main logs for server\n// var serverLog = [],\n// console.log = function (text) {\n// \tif(arguments.length > 1) {\n// \t\tvar temp = [];\n// \t\tfor(var i = 0; i < arguments.length; i++) {\n// \t\t\ttemp.push(arguments[i]);\n// \t\t}\n// \t\tserverLog.push(temp);\n// \t} else {\n// \t\tserverLog.push(text);\n// \t}\n// }\n\n// Enable cross browser ajax\n// app.enable(\"jsonp callback\");\napp.use(express.bodyParser());\n\n\n// Handles Static HTTP Requests\napp.use(express.static(__dirname + '/app'));\n\n// Initial Auth\napp.post('/auth/', function (req, res) {\n\n\tconsole.log(\"** Starting Auth **\");\n\n\t// If the client has never been connected before\n\tif (req.param('reqURL')) {\n\n\t\tswitch (req.param('service')) {\n\t\tcase \"dropbox\":\n\t\t\t// Request a token from dropbox\n\t\t\tdbox.request_token(function (status, request_token) {\n\t\t\t\tconsole.log(\"Sending authorize_url\");\n\t\t\t\t\n\t\t\t\trequest_token.authorize_url += \"&oauth_callback=\" + settings.url + \"/dropbox\";\n\n\t\t\t\t// Send it to the client\n\t\t\t\tres.json(request_token);\n\t\t\t});\n\t\t\tbreak;\n\t\tcase \"ubuntu\":\n\t\t\t// Request a token from ubuntu one\n\t\t\tubuntu.getOAuthRequestToken(function(e, t, s, r){\n\t\t\t\tvar reply = {};\n\t\t\t\treply.oauth_token = t;\n\t\t\t\treply.oauth_secret = s;\n\t\t\t\treply.authorize_url = 'https://one.ubuntu.com/oauth/authorize/?description=Nitro&oauth_token=' + t;\n\t\t\t\tres.json(reply);\n\t\t\t});\n\t\t\tbreak;\n\t\t}\n\n\t// Client has a token but not oauth\n\t} else if (req.param('token')) {\n\t\t\n\t\t// Get token and make sure it is an object\n\t\tvar user_token = req.param('token');\n\t\tif(typeof user_token === 'string') user_token = JSON.parse(user_token);\n\n\t\tswitch (req.param('service')) {\n\t\tcase \"dropbox\":\n\t\t\t\n\t\t\t// Add user\n\t\t\tusers.dropbox[user_token.oauth_token] = {};\n\t\t\t\t\t\t\n\t\t\tvar count = 0, max = 60;\n\n\t\t\tvar check = function () {\n\t\t\t\t\n\t\t\t\tif(users.dropbox[user_token.oauth_token].hasOwnProperty('uid')) {\n\t\t\t\t\t\n\t\t\t\t\tconsole.log('Connecting to dropbox');\n\t\n\t\t\t\t\t// Check token\n\t\t\t\t\tdbox.access_token(user_token, function (status, access_token) {\n\t\n\t\t\t\t\t\t// Token is good :D\n\t\t\t\t\t\tif (status === 200) {\n\t\t\t\t\t\t\tconsole.log('Attempt ' + count + ' - Connected!'); \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdbox.createClient(access_token).account(function (status, reply) {\n\t\n\t\t\t\t\t\t\t\tconsole.log(\"ACCOUNT\", status, reply);\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// Send access token to client so they can use it again\n\t\t\t\t\t\t\t\tres.json({\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\taccess: access_token,\n\t\t\t\t\t\t\t\t\temail: reply.email\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdelete users.dropbox[user_token.oauth_token];\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tconsole.log(status, access_token);\n\t\t\t\t\t\t\n\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\n\t\t\t\t// Nitro hasn't been allowed yet :(\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('Attempt ' + count + ' - Failed!');\n\t\t\t\t\tcount++;\n\n\t\t\t\t\t// Try again in a second\n\t\t\t\t\tif(count <= max) setTimeout(check, 1000);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcheck();\n\t\t\tbreak;\n\n\n\t\t case \"ubuntu\":\n\n\t\t\t// Add user\n\t\t\tusers.ubuntu[user_token.oauth_token] = {request_secret: user_token.oauth_secret};\n\n\t\t\tconsole.log(users);\n\t\t\t\n\t\t\tvar count = 0, max = 60;\n\n\t\t\t// Keep checking database\n\t\t\tvar check = function() {\n\t\t\t\tif(users.ubuntu[user_token.oauth_token].hasOwnProperty('oauth_token')) {\n\t\t\t\t\t\n\t\t\t\t\tubuntu.get(\"https://one.ubuntu.com/api/account/\", users.ubuntu[user_token.oauth_token].oauth_token, users.ubuntu[user_token.oauth_token].oauth_secret, function (e, d, r) {\n\t\t\t\t\t\t\n\t\t\t\t\t\td = JSON.parse(d);\n\t\t\t\t\t\t\n\t\t\t\t\t\tres.json({\n\t\t\t\t\t\t\taccess: {\n\t\t\t\t\t\t\t\toauth_token: users.ubuntu[user_token.oauth_token].oauth_token, \n\t\t\t\t\t\t\t\toauth_secret: users.ubuntu[user_token.oauth_token].oauth_secret\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\temail: d.email\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tdelete users.ubuntu[user_token.oauth_token];\n\t\t\t\t\t\t\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(\"failed, trying again\")\n\t\t\t\t\tcount++;\n\t\t\t\t\t\n\t\t\t\t\t// Try again in a second\n\t\t\t\t\tif(count <= max) setTimeout(check, 1000);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tcheck();\n\t\t\t\n\t\t\tbreak;\n\t\t }\n\n\t// Server has been authorised before\n\t} else if (req.param('access')) {\n\t\t\n\t\tvar access_token = req.param('access');\n\t\tif(typeof access_token === 'string') access_token = JSON.parse(access_token);\n\n\t\tconsole.log(\"Using client stored key\");\n\n\t\tswitch (req.param('service')) {\n\n\t\tcase \"dropbox\":\n\n\t\t\t// Create client\n\t\t\tuser = dbox.createClient(access_token);\n\n\t\t\t// Check to see if it worked\n\t\t\tuser.account(function (status, reply) {\n\t\t\t\tif (status === 200) {\n\t\t\t\t\tconsole.log(\"Connected!\");\n\t\t\t\t\tres.json(\"success\");\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(\"Could not connect :( - \" + status);\n\t\t\t\t\tres.json(\"failed\");\n\t\t\t\t}\n\t\t\t});\n\t\t\tbreak;\n\n\t\tcase \"ubuntu\":\n\n\t\t\t// Check to see if it worked\n\t\t\tubuntu.get(\"https://one.ubuntu.com/api/account/\", access_token.oauth_token, access_token.oauth_secret, function (e, d, r) {\n\t\t\t\tif(e) {\n\t\t\t\t\tres.json(\"failed\");\n\t\t\t\t} else {\n\t\t\t\t\tres.json(\"success\");\n\t\t\t\t}\n\t\t\t});\t\t\n\t\t\tbreak;\n\t\t}\n\t}\n});\n\n// Dropbox callback\napp.get('/dropbox', function (req, res) {\n\tres.send(\"Authentication Complete! You can close this window now.\");\n\n\tvar uid = req.query.uid,\n\t\ttoken = req.query.oauth_token;\n\t\t\n\t\tif(users.dropbox.hasOwnProperty(token)) {\n\t\t\tusers.dropbox[token].uid = uid;\n\t\t} else {\n\t\t\tconsole.log(\"ERROR: UID not found.\");\n\t\t}\n\t\n});\n\n// Ubuntu callback for oauth verifier\napp.get('/ubuntu-one/', function (req, res) {\n\tres.send(\"Authentication Complete!\");\n\n\tconsole.log(\"Requesting access token\");\n\n\tvar token = req.query.oauth_token;\n\n\tif(users.ubuntu.hasOwnProperty(token)) {\n\t\tconsole.log(\"Token found :D Going to try and get access token\");\n\t\tubuntu.getOAuthAccessToken(token, users.ubuntu[token].request_secret, req.query.oauth_verifier, function(e, t, s, r) {\n\t\t\tusers.ubuntu[token].oauth_token = t;\n\t\t\tusers.ubuntu[token].oauth_secret = s;\n\t\t\tconsole.log(users);\n\t\t});\n\t} else {\n\t\tconsole.log(\"ERROR: Token not found!?\")\n\t}\n});\n\n// Actual Sync\napp.post('/sync/', function (req, res){\n\n\tvar service = req.param('service');\n\t\n\tvar access_token = req.param('access');\n\tif(typeof access_token === 'string') access_token = JSON.parse(access_token);\n\n\t// Get client\n\tswitch (service) {\n\tcase \"dropbox\":\n\t\tuser = dbox.createClient(access_token);\n\t\tbreak;\n\tcase \"ubuntu\":\n\t\tuser = access_token;\n\t}\n\t\n\tgetServer(service, user, function(server) {\n\n\t\tif(server != 'error') {\n\n\t\t\tvar recievedData = decompress(JSON.parse(req.param('data')));\n\n\t\t\t// Merge data\n\t\t\tmerge(server, recievedData, function (server) {\n\t\t\t\t// Send data back to client\n\t\t\t\tconsole.log(JSON.stringify(server, null, 4));\n\t\t\t\tconsole.log(\"Merge complete. Updating client.\");\n\t\t\t\tres.json(compress(server));\n\t\t\t\tsaveServer(service, user, server);\n\n\t\t\t\t//Analytics\n\t\t\t\tvar options = {\n\t\t\t\t\thost: 'nitrotasks.com',\n\t\t\t\t\tport: 80,\n\t\t\t\t\tpath: '/analytics/server.php?fingerprint=' + recievedData.stats.uid + '&backend=' + service + '&version=' + recievedData.stats.version + '&os=' + recievedData.stats.os + '&language=' + recievedData.stats.language\n\t\t\t\t};\n\n\t\t\t\trequire('http').get(options, function(res) {\n\t\t\t\t\tconsole.log(\"Sent to Analytics Server.\");\n\t\t\t\t});\n\t\t\t});\n\n\t\t} else {\n\t\t\t\n\t\t\tconsole.log(\"We got an error!\");\n\n\t\t\tres.json(\"error\");\n\n\t\t}\n\t});\n\n\t\n});\n\nport = process.env.PORT || 3000;\napp.listen(port);\n\nfunction getServer(service, user, callback) {\n\t\n\tconsole.log(\"Getting File from server\");\n\n\tswitch (service) {\n\tcase \"dropbox\":\n\t\tconsole.log(\"Dropbox\")\n\t\tuser.get(settings.filename, function (status, reply) {\n\t\t\treply = decompress(JSON.parse(reply.toString()));\n\n\t\t\t// Check if file exists\n\t\t\tif (!reply.hasOwnProperty('tasks')) {\n\t\t\t\tconsole.log(\"File doesn't exist on the clients dropbox :(\");\n\t\t\t\tconsole.log(\"So let's make one :D\");\n\t\t\t\tserver = clone(emptyServer);\n\t\t\t\tsaveServer(service, user, server);\n\t\t\t\tcallback(server);\n\t\t\t} else if (status != 200) {\n\t\t\t\tcallback('error');\n\t\t\t} else {\n\t\t\t\tconsole.log(\"Got the server!\");\n\t\t\t\tcallback(reply);\n\t\t\t}\n\t\t});\n\t\tbreak;\n\tcase \"ubuntu\":\n\t\tconsole.log(\"Ubuntu\")\n\t\tubuntu.get(\"https://files.one.ubuntu.com/content/~/Ubuntu%20One/Nitro/\" + settings.filename, user.oauth_token, user.oauth_secret, function (e, d, r) {\n\t\t\tif(e) {\n\t\t\t\tconsole.log(e);\n\t\t\t\tconsole.log(\"File doesn't exist on the client's ubuntu one account :(\");\n\t\t\t\tconsole.log(\"So let's make one :D\");\n\t\t\t\tserver = clone(emptyServer);\n\t\t\t\tsaveServer(service, user, server);\n\t\t\t\tcallback(server);\n\t\t\t} else {\n\t\t\t\treply = decompress(JSON.parse(d.toString()));\n\t\t\t\tconsole.log(\"Got the server!\");\n\t\t\t\tcallback(reply);\n\t\t\t}\n\t\t});\n\t\tbreak;\n\t}\n\t\n}\n\nfunction saveServer(service, user, server) {\n\tconsole.log(\"Saving to server (starting)\");\n\tvar output = JSON.stringify(compress(server));\n\n\tswitch (service) {\n\tcase \"dropbox\":\n\t\tconsole.log(\"Dropbox\");\n\t\tuser.put(settings.filename, output, function () {\n\t\t\tconsole.log(\"Saving to server (complete!)\");\n\t\t});\n\t\tbreak;\n\tcase \"ubuntu\":\n\t\tubuntu.put(\"https://files.one.ubuntu.com/content/~/Ubuntu%20One/Nitro/\" + settings.filename, user.oauth_token, user.oauth_secret, output, \"application/json\", function (e, d, r) {\n\t\t\tif(e) {\n\t\t\t\tcallback(\"Error saving file!\");\n\t\t\t} else {\n\t\t\t\tconsole.log(\"Saving to server (complete!)\");\n\t\t\t}\n\t\t});\n\t}\n}\n\n// Create server\nvar emptyServer = {\n\ttasks: {\n\t\tlength: 0\n\t},\n\tlists: {\n\t\torder: [],\n\t\titems: {\n\t\t\t0: {\n\t\t\t\torder: []\n\t\t\t},\n\t\t\ttoday: {\n\t\t\t\tname: \"Today\",\n\t\t\t\torder: [],\n\t\t\t\ttime: {\n\t\t\t\t\tname: 0,\n\t\t\t\t\torder: 0\n\t\t\t\t}\n\t\t\t},\n\t\t\tnext: {\n\t\t\t\tname: \"Next\",\n\t\t\t\torder: [],\n\t\t\t\ttime: {\n\t\t\t\t\tname: 0,\n\t\t\t\t\torder: 0\n\t\t\t\t}\n\t\t\t},\n\t\t\tlength: 1\n\t\t},\n\t\ttime: 0,\n\t\tscheduled: {\n\t\t\tlength: 0\n\t\t},\n\t\tdeleted: {}\n\t},\n\tqueue: {}\n};\n\nfunction merge(server, client, callback) {\n\n\t// console.log(JSON.stringify(client, null, 2));\n\t// console.log(JSON.stringify(server, null, 2));\n\n\tvar core = {\n\t\ttask: function(id) {\n\t\t\treturn {\n\t\t\t\tadd: function(name, list) {\n\t\t\t\t\t//ID of task\n\t\t\t\t\tvar taskId = server.tasks.length;\n\t\t\t\t\tserver.tasks.length++;\n\n\t\t\t\t\t//Saves\n\t\t\t\t\tserver.tasks[taskId] = {\n\t\t\t\t\t\tcontent: name,\n\t\t\t\t\t\tpriority: 'none',\n\t\t\t\t\t\tdate: '',\n\t\t\t\t\t\tnotes: '',\n\t\t\t\t\t\tlist: list,\n\t\t\t\t\t\tlogged: false,\n\t\t\t\t\t\ttime: {\n\t\t\t\t\t\t\tcontent: 0,\n\t\t\t\t\t\t\tpriority: 0,\n\t\t\t\t\t\t\tdate: 0,\n\t\t\t\t\t\t\tnotes: 0,\n\t\t\t\t\t\t\tlist: 0,\n\t\t\t\t\t\t\tlogged: 0\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsynced: false\n\t\t\t\t\t};\n\n\t\t\t\t\t//Pushes to array\n\t\t\t\t\tserver.lists.items[list].order.unshift(taskId);\n\t\t\t\t\t// server.save();\n\t\t\t\t\tconsole.log('Adding Task: ' + name + ' into list: ' + list);\n\n\t\t\t\t\treturn taskId;\n\t\t\t\t},\n\n\t\t\t\t/* Move a task somewhere.\n\t\t\t\te.g: core.task(0).move('next');\n\n\t\t\t\tTo delete something, move to 'trash' */\n\n\t\t\t\tmove: function(list) {\n\t\t\t\t\t//Remove from list\n\t\t\t\t\tvar old = server.tasks[id].list;\n\t\t\t\t\tserver.lists.items[old].order.remove(id);\n\n\t\t\t\t\tif(server.tasks[id].logged && list != 'logbook') {\n\t\t\t\t\t\tserver.tasks[id].logged = false;\n\t\t\t\t\t\t// server.save('tasks', id, 'logged');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (list === 'trash') {\n\t\t\t\t\t\t// delete server.tasks[id];\n\t\t\t\t\t\tserver.tasks[id] = {deleted: core.timestamp()};\n\t\t\t\t\t\tconsole.log('Deleted: ' + id);\n\t\t\t\t\t\t// Saves - but doesn't mess with timestamps\n\t\t\t\t\t\t// server.save();\n\t\t\t\t\t} else if (list === 'logbook') {\n\t\t\t\t\t\t// Don't actually move the task\n\t\t\t\t\t\tserver.tasks[id].logged = core.timestamp();\n\t\t\t\t\t\tconsole.log('Logged ' + id);\n\t\t\t\t\t\t// server.save('tasks', id, 'logged');\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//Move to other list\n\t\t\t\t\t\tserver.lists.items[list].order.unshift(id);\n\t\t\t\t\t\tserver.tasks[id].list = list;\n\t\t\t\t\t\tconsole.log('Moved: ' + id + ' to ' + list);\n\t\t\t\t\t\t//Saves\n\t\t\t\t\t\t// server.save([['tasks', id, 'list'],['lists', list, 'order'],['lists', old, 'order']]);\n\t\t\t\t\t}\n\t\t\t\t}\t\t\t\n\t\t\t}\n\t\t}\n\t}\n\n\t// MASSIVE TRY/CATCH FOR ERRORS (TEMPORARY UNTIL WE GET SOMETING ELSE SORTED OUT)\n\t// try {\t\n\t\n\t\t// Loop through each list\n\t\tfor (var list in client.lists.items) {\n\t\n\t\t\tif (list != '0' && list !== 'length') {\n\t\n\t\t\t\t// Check if it is a new list\n\t\t\t\tif (client.lists.items[list].synced === false || client.lists.items[list].synced === 'false') {\n\t\n\t\t\t\t\tconsole.log(\"List '\" + list + \"' has never been synced before\");\n\t\n\t\t\t\t\t// List is now synced so set it to true\n\t\t\t\t\tclient.lists.items[list].synced = true;\n\t\n\t\t\t\t\t// If a list with that ID already exists on the server\n\t\t\t\t\tif (server.lists.items.hasOwnProperty(list)) {\n\t\n\t\t\t\t\t\tconsole.log(\"List '\" + list + \"' already exists on the server\");\n\t\n\t\t\t\t\t\t// Change the list ID\n\t\t\t\t\t\tvar newID = server.lists.items.length;\n\t\t\t\t\t\tclient.lists.items[newID] = clone(client.lists.items[list]);\n\t\t\t\t\t\t\n\t\t\t\t\t\tfor(var task in client.lists.items[list].order) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\ttask = client.lists.items[list].order[task];\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tclient.tasks[task].list = newID;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// Temporary fix - not the best way to do it.\n\t\t\t\t\t\t\tclient.tasks[task].time.list = Date.now();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tdelete client.lists.items[list];\n\t\t\t\t\t\t\n\t\t\t\t\t\tconsole.log(\"List '\" + list + \"' has been moved to '\" + server.lists.items.length + \"'\");\n\t\n\t\t\t\t\t\tlist = server.lists.items.length;\n\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log(\"List '\" + list + \"' does not exist on server. Adding to server as: \" + server.lists.items.length);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(list != server.lists.items.length) {\n\t\t\t\t\t\t\tfor(var task in client.lists.items[list].order) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\ttask = client.lists.items[list].order[task];\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tclient.tasks[task].list = server.lists.items.length;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// Temporary fix - not the best way to do it.\n\t\t\t\t\t\t\t\tclient.tasks[task].time.list = Date.now();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// If the list doesn't exist on the server, create it\n\t\t\t\t\tserver.lists.items[server.lists.items.length] = {\n\t\t\t\t\t\tname: client.lists.items[list].name,\n\t\t\t\t\t\torder: [],\n\t\t\t\t\t\ttime: client.lists.items[list].time,\n\t\t\t\t\t\tsynced: true\n\t\t\t\t\t};\n\t\n\t\t\t\t\t// Update order\n\t\t\t\t\tserver.lists.order.push(Number(list));\n\t\t\t\t\tserver.lists.items.length++;\n\t\t\t\t\t\n\t\t\t\t/***** LIST IS DELETED ON THE CLIENT BUT DOESN'T EXIST ON THE SERVER *****/\n\t\t\t\t} else if (client.lists.items[list].hasOwnProperty('deleted') && !server.lists.items.hasOwnProperty(list)) {\n\t\t\t\t\t\n\t\t\t\t\tconsole.log(\"LIST \" + list + \" IS DELETED ON THE CLIENT BUT DOESN'T EXIST ON THE SERVER\")\n\t\t\t\t\t\n\t\t\t\t\t// Copy the deleted timestamp over\n\t\t\t\t\tserver.lists.items[list] = {deleted: client.lists.items[list].deleted}; \n\t\t\t\t\t\t\n\t\t\t\t/***** LIST IS DELETED ON THE CLIENT AND BUT NOT ON THE SERVER *****/\n\t\t\t\t\n\t\t\t\t } else if (client.lists.items[list].hasOwnProperty('deleted') && !server.lists.items[list].hasOwnProperty('deleted')) {\n\t\t\t\t\t \n\t\t\t\t\t console.log(\"LIST \" + list + \" IS DELETED ON THE CLIENT AND BUT NOT ON THE SERVER\")\n\t\t\t\t\t\n\t\t\t\t\tvar deleteList = true;\n\t\t\t\t\n\t\t\t\t\t// Check timestamps on client and server\n\t\t\t\t\tfor(var key in server.lists.items[list].time) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// If server has been modified after client was deleted, don't delete the list.\n\t\t\t\t\t\tif(server.lists.items[list].time[key] > client.lists.deleted[list]) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdeleteList = false;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// Delete the list\n\t\t\t\t\tif(deleteList) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tcli.list(list).remove();\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t/***** LIST IS DELETED ON THE SERVER AND ON THE COMPUTER *****/\n\t\t\t\t\n\t\t\t\t} else if (server.lists.items[list].hasOwnProperty('deleted') && client.lists.items[list].hasOwnProperty('deleted')) {\n\t\t\t\t\t\n\t\t\t\t\tconsole.log(\"List '\" + list + \"' is deleted on the server and the computer\");\n\t\t\t\t\t\n\t\t\t\t\t// Use the latest time stamp\n\t\t\t\t\tif (client.lists.items[list].deleted > server.lists.items[list].deleted) {\n\t\t\t\t\t\n\t\t\t\t\t\tconsole.log(\"List '\" + list + \"' is deleted, but has a newer timestamp\");\n\t\t\t\t\t\n\t\t\t\t\t\t// If the task was deleted on a computer after it was deleted on the server, then update the time stamp\n\t\t\t\t\t\tserver.lists.items[list].deleted = client.lists.items[list].deleted;\n\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\n\t\n\t\t\t\t\n\t\t\t\t/***** LIST IS DELETED ON THE SERVER AND BUT NOT ON THE COMPUTER *****/\n\t\t\t\t\n\t\t\t\t} else if (server.lists.items[list].hasOwnProperty('deleted') && client.lists.items.hasOwnProperty(list)) {\n\t\t\t\t\t\n\t\t\t\t\tconsole.log(\"LIST \" + list + \" IS DELETED ON THE SERVER AND BUT NOT ON THE COMPUTER\")\n\t\t\t\t\t\n\t\t\t\t\tvar keepList = true;\n\t\t\t\t\t\n\t\t\t\t\t// Check timestamps on client and server\n\t\t\t\t\tfor(var key in client.lists.items[list].time) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// If the task on the client has been modified after task on the server was deleted, keep the list.\n\t\t\t\t\t\tif(client.lists.items[list].time[key] > server.lists.deleted[list]) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tkeepList = false;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// Keep the list\n\t\t\t\t\tif(keepList) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tserver.lists.items[list] = clone(client.lists.items[list]);\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t} else if (server.lists.items.hasOwnProperty(list)) {\n\t\t\t\t\n\t\t\t\t\tconsole.log(\"List '\" + list + \"' exists on server.\");\n\t\t\t\t\n\t\t\t\t\tfor(var key in client.lists.items[list].time) {\n\t\t\t\t\n\t\t\t\t\t\tif (client.lists.items[list].time[key] > server.lists.items[list].time[key]) {\n\t\t\t\t\n\t\t\t\t\t\t\tconsole.log(\"The key '\" + key + \"' in list '\" + list + \"' has been modified.\");\n\t\t\t\t\n\t\t\t\t\t\t\tconsole.log(JSON.stringify(client.lists.items[list][key]))\n\t\t\t\t\n\t\t\t\t\t\t\t// If so, update list key and time\n\t\t\t\t\t\t\tserver.lists.items[list][key] = client.lists.items[list][key];\n\t\t\t\t\t\t\tserver.lists.items[list].time[key] = client.lists.items[list].time[key];\n\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Loop through each task\n\t\tfor(var task in client.tasks) {\n\t\n\t\t\t// Do not sync the tasks.length propery\n\t\t\t// This should only be modified by the server side cli.js\n\t\t\tif (task !== 'length') {\n\t\n\t\t\t\t/***** ADDING NEW TASKS TO THE SERVER *****/\n\t\n\t\t\t\t// If task has never been synced before\n\t\t\t\tif (client.tasks[task].synced === false || client.tasks[task].synced === 'false') {\n\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' has never been synced before\");\n\t\n\t\t\t\t\t// Task is going to be added to the server so we delete the synced property\n\t\t\t\t\tclient.tasks[task].synced = true;\n\t\n\t\t\t\t\t// If task already exists on the server (Don't be fooled, it's a different task...)\n\t\t\t\t\tif (server.tasks.hasOwnProperty(task)) {\n\t\n\t\t\t\t\t\tconsole.log(\"A task with the ID '\" + task + \"' already exists on the server\");\n\t\n\t\t\t\t\t\t// Does not mess with ID's if it isn't going to change\n\t\t\t\t\t\tif (server.tasks.length !== Number(task)) {\n\t\n\t\t\t\t\t\t\t// Add task to task (ID + server.tasks.length)\n\t\t\t\t\t\t\tclient.tasks[server.tasks.length] = clone(client.tasks[task]);\n\t\t\t\t\t\t\tdelete client.tasks[task];\n\t\n\t\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' has been moved to task '\" + server.tasks.length  + \"'\");\n\t\n\t\t\t\t\t\t\ttask = server.tasks.length;\n\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// If task hasn't been deleted\n\t\t\t\t\tif (!client.tasks[task].hasOwnProperty('deleted')) {\n\t\n\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is being added to the server.\");\n\t\n\t\t\t\t\t\t// Add the task to the server\n\t\t\t\t\t\tcli.addTask(\"New Task\", client.tasks[task].list);\n\t\t\t\t\t\tserver.tasks[task] = clone(client.tasks[task]);\n\t\n\t\t\t\t\t\t// Calculate date\n\t\t\t\t\t\tcli.calc.date(task);\n\t\n\t\t\t\t\t\t// Calculate Today etc? - Do later\n\t\t\t\t\t\tcli.today(task).calculate();\n\t\n\t\t\t\t\t\t// Fix task length\n\t\t\t\t\t\tfixLength(server.tasks);\n\t\n\t\t\t\t\t// The task is new, but the client deleted it\n\t\t\t\t\t} else {\n\t\n\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is new, but the client deleted it\");\n\t\n\t\t\t\t\t\t// Add the task to the server, but don't touch lists and stuff\n\t\t\t\t\t\tserver.tasks[task] = clone(client.tasks[task]);\n\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t/***** TASK DOESN'T EXIST ON SERVER FOR SOME REASON -- BUG *****/\n\t\t\t\t} else if (!server.tasks.hasOwnProperty(task)) {\n\t\t\t\t\t\n\t\t\t\t\tconsole.log(\"Task \" + task + \" doesn't exist on server. It should, but it doesn't.\");\n\t\t\t\t\t\n\t\t\t\t\tif(client.tasks[task].hasOwnProperty('deleted')) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tconsole.log(\"Task \" + task + \" was deleted before it was sunk\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tserver.tasks[task] = {deleted: client.tasks[task].deleted};\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\t// Better just copy the task onto the server...\n\t\t\t\t\t// server.tasks[task] = clone(client.tasks[task]);\n\t\n\t\t\t\t/***** CLIENT DELETED TASK *****/\n\t\n\t\t\t\t// Task was deleted on computer but not on the server\n\t\t\t\t} else if (client.tasks[task].hasOwnProperty('deleted') && !server.tasks[task].hasOwnProperty('deleted')) {\n\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' was deleted on computer but not on the server\");\n\t\n\t\t\t\t\t// We use this to check whether the task was modified AFTER it was deleted\n\t\t\t\t\tvar deleteTask = true;\n\t\n\t\t\t\t\t// Loop through each attribute on server\n\t\t\t\t\tfor(var key in server.tasks[task]) {\n\t\n\t\t\t\t\t\t// Check if server task was modified after task was deleted\n\t\t\t\t\t\tif (server.tasks[task].time[key] > client.tasks[task].deleted) {\n\t\n\t\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' was modified after task was deleted\");\n\t\n\t\t\t\t\t\t\t// Since it has been modified after it was deleted, we don't delete the task\n\t\t\t\t\t\t\tdeleteTask = false;\n\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// If there have been no modifications to the task after it has been deleted\n\t\t\t\t\tif (deleteTask) {\n\t\n\t\t\t\t\t\t// Delete the task\n\t\t\t\t\t\tcli.deleteTask(task);\n\t\n\t\t\t\t\t\t// Get the timestamp\n\t\t\t\t\t\tserver.tasks[task] = clone(client.tasks[task]);\n\t\n\t\t\t\t\t\t// Update stuff\n\t\t\t\t\t\t// cli.calc.date(task);\n\t\t\t\t\t\t// cli.today(task).calculate();\n\t\n\t\t\t\t\t}\n\t\n\t\t\t\t/***** SERVER DELETED TASK *****/\n\t\n\t\t\t\t// Task is deleted on the server and the computer\n\t\t\t\t} else if (client.tasks[task].hasOwnProperty('deleted') && server.tasks[task].hasOwnProperty('deleted')){\n\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is deleted on the server and the computer\");\n\t\n\t\t\t\t\t// Use the latest time stamp\n\t\t\t\t\tif (client.tasks[task].deleted > server.tasks[task].deleted) {\n\t\n\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is deleted, but has a newer timestamp\");\n\t\n\t\t\t\t\t\t// If the task was deleted on a computer after it was deleted on the server, then update the time stamp\n\t\t\t\t\t\tserver.tasks[task].deleted = client.tasks[task].deleted;\n\t\n\t\t\t\t\t}\n\t\n\t\t\t\t/***** OLD TASK THAT HASN'T BEEN DELETED BUT POSSIBLY MODIFIED *****/\n\t\n\t\t\t\t} else {\n\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' exists on the server and hasn't been deleted\");\n\t\n\t\t\t\t\t//Stores the Attrs we'll be needing later\n\t\t\t\t\tvar changedAttrs = [];\n\t\n\t\t\t\t\t// Loop through each attribute on computer\n\t\t\t\t\tfor(var key in client.tasks[task]) {\n\t\n\t\t\t\t\t\t//Don't loop through timestamps\n\t\t\t\t\t\tif (key !== 'time') {\n\t\n\t\t\t\t\t\t\t// Check if task was deleted on server or\n\t\t\t\t\t\t\tif (server.tasks[task].hasOwnProperty('deleted')) {\n\t\n\t\t\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' was deleted on the server\");\n\t\n\t\t\t\t\t\t\t\t// Check if task was modified after it was deleted\n\t\t\t\t\t\t\t\tif (client.tasks[task].time[key] > server.tasks[task].deleted) {\n\t\n\t\t\t\t\t\t\t\t\tconsole.log(\"Task \" + task + \" was modified on the client after it was deleted on the server\");\n\t\n\t\t\t\t\t\t\t\t\t// Update the server with the entire task (including attributes and timestamps)\n\t\t\t\t\t\t\t\t\tserver.tasks[task] = client.tasks[task];\n\t\n\t\t\t\t\t\t\t\t\t//Breaks, we only need to do the thing once.\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\n\t\t\t\t\t\t\t// Task has not been deleted\n\t\t\t\t\t\t\t} else {\n\t\n\t\t\t\t\t\t\t\t// If the attribute was updated after the server\n\t\t\t\t\t\t\t\tif (client.tasks[task].time[key] > server.tasks[task].time[key]) {\n\t\n\t\t\t\t\t\t\t\t\tconsole.log(\"Key '\" + key + \"'  in task \" + task + \" has been updated by the client\");\n\t\n\t\t\t\t\t\t\t\t\tif (key !== 'list') {\n\t\t\t\t\t\t\t\t\t\t// Update the servers version\n\t\t\t\t\t\t\t\t\t\tserver.tasks[task][key] = client.tasks[task][key];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// Update the timestamp\n\t\t\t\t\t\t\t\t\tserver.tasks[task].time[key] = client.tasks[task].time[key];\n\t\n\t\t\t\t\t\t\t\t\t//Adds the changed Attr to the array\n\t\t\t\t\t\t\t\t\tchangedAttrs.push(key);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (changedAttrs.length > 0) {\n\t\t\t\t\t\tif (changedAttrs.indexOf('list') != -1) {\n\t\t\t\t\t\t\t// List\n\t\t\t\t\t\t\tconsole.log(\"Task \" + task + \" has been updated --> LIST\");\n\t\t\t\t\t\t\tcli.moveTask(task, client.tasks[task].list);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (changedAttrs.indexOf('logged') != -1) {\n\t\t\t\t\t\t\t// List\n\t\t\t\t\t\t\tconsole.log(\"Task \" + task + \" has been updated --> LOGGED\");\n\t\t\t\t\t\t\t// core.task(task).move(client.tasks[task].list);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Loop through each task\n\t\tfor(var task in client.lists.scheduled) {\n\t\t\n\t\t\t// Do not sync the tasks.length propery\n\t\t\t// This should only be modified by the server side cli.js\n\t\t\tif (task !== 'length') {\n\t\t\n\t\t\t\t/***** ADDING NEW TASKS TO THE SERVER *****/\n\t\t\n\t\t\t\t// If task has never been synced before\n\t\t\t\tif (client.lists.scheduled[task].synced === false || client.lists.scheduled[task].synced === 'false') {\n\t\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' has never been synced before\");\n\t\t\n\t\t\t\t\t// Task is going to be added to the server so we delete the synced property\n\t\t\t\t\tclient.lists.scheduled[task].synced = true;\n\t\t\n\t\t\t\t\t// If task already exists on the server (Don't be fooled, it's a different task...)\n\t\t\t\t\tif (server.lists.scheduled.hasOwnProperty(task)) {\n\t\t\n\t\t\t\t\t\tconsole.log(\"A task with the ID '\" + task + \"' already exists on the server\");\n\t\t\n\t\t\t\t\t\t// Does not mess with ID's if it isn't going to change\n\t\t\t\t\t\tif (server.lists.scheduled.length !== Number(task)) {\n\t\t\n\t\t\t\t\t\t\t// Add task to task (ID + server.lists.scheduled.length)\n\t\t\t\t\t\t\tclient.lists.scheduled[server.lists.scheduled.length] = clone(client.lists.scheduled[task]);\n\t\t\t\t\t\t\tdelete client.lists.scheduled[task];\n\t\t\n\t\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' has been moved to task '\" + server.lists.scheduled.length  + \"'\");\n\t\t\n\t\t\t\t\t\t\ttask = server.lists.scheduled.length;\n\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\n\t\t\t\t\t// If task hasn't been deleted\n\t\t\t\t\tif (!client.lists.scheduled[task].hasOwnProperty('deleted')) {\n\t\t\n\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is being added to the server.\");\n\t\t\n\t\t\t\t\t\t// Add the task to the server\n\t\t\t\t\t\tcli.scheduled.add(\"New Task\", client.lists.scheduled[task].type);\n\t\t\t\t\t\tserver.lists.scheduled[task] = clone(client.lists.scheduled[task]);\n\t\t\n\t\t\t\t\t\t// Fix task length\n\t\t\t\t\t\tfixLength(server.lists.scheduled);\n\t\t\n\t\t\t\t\t// The task is new, but the client deleted it\n\t\t\t\t\t} else {\n\t\t\n\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is new, but the client deleted it\");\n\t\t\n\t\t\t\t\t\t// Add the task to the server, but don't touch lists and stuff\n\t\t\t\t\t\tserver.lists.scheduled[task] = clone(client.lists.scheduled[task]);\n\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/***** TASK DOESN'T EXIST ON SERVER FOR SOME REASON -- BUG *****/\n\t\t\t\t} else if (!server.tasks.hasOwnProperty(task)) {\n\t\t\t\t\t\n\t\t\t\t\tconsole.log(\"Task doesn't exist on server. It should, but it doesn't.\");\n\t\t\t\t\n\t\t\t\t\t// Better just copy the task onto the server...\n\t\t\t\t\tserver.lists.scheduled[task] = clone(client.lists.scheduled[task]);\n\t\t\n\t\t\t\t/***** CLIENT DELETED TASK *****/\n\t\t\n\t\t\t\t// Task was deleted on computer but not on the server\n\t\t\t\t} else if (client.lists.scheduled[task].hasOwnProperty('deleted') && !server.lists.scheduled[task].hasOwnProperty('deleted')) {\n\t\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' was deleted on computer but not on the server\");\n\t\t\n\t\t\t\t\t// We use this to check whether the task was modified AFTER it was deleted\n\t\t\t\t\tvar deleteTask = true;\n\t\t\n\t\t\t\t\t// Loop through each attribute on server\n\t\t\t\t\tfor(var key in server.lists.scheduled[task]) {\n\t\t\n\t\t\t\t\t\t// Check if server task was modified after task was deleted\n\t\t\t\t\t\tif (server.lists.scheduled[task].time[key] > client.lists.scheduled[task].deleted) {\n\t\t\n\t\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' was modified after task was deleted\");\n\t\t\n\t\t\t\t\t\t\t// Since it has been modified after it was deleted, we don't delete the task\n\t\t\t\t\t\t\tdeleteTask = false;\n\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\n\t\t\t\t\t// If there have been no modifications to the task after it has been deleted\n\t\t\t\t\tif (deleteTask) {\n\t\t\n\t\t\t\t\t\t// Delete the task\n\t\t\t\t\t\tcli.deleteTask('s' + task);\n\t\t\n\t\t\t\t\t\t// Get the timestamp\n\t\t\t\t\t\tserver.lists.scheduled[task] = clone(client.lists.scheduled[task]);\n\t\t\n\t\t\t\t\t}\n\t\t\n\t\t\t\t/***** SERVER DELETED TASK *****/\n\t\t\n\t\t\t\t// Task is deleted on the server and the computer\n\t\t\t\t} else if (client.lists.scheduled[task].hasOwnProperty('deleted') && server.lists.scheduled[task].hasOwnProperty('deleted')){\n\t\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is deleted on the server and the computer\");\n\t\t\n\t\t\t\t\t// Use the latest time stamp\n\t\t\t\t\tif (client.lists.scheduled[task].deleted > server.lists.scheduled[task].deleted) {\n\t\t\n\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is deleted, but has a newer timestamp\");\n\t\t\n\t\t\t\t\t\t// If the task was deleted on a computer after it was deleted on the server, then update the time stamp\n\t\t\t\t\t\tserver.lists.scheduled[task].deleted = client.lists.scheduled[task].deleted;\n\t\t\n\t\t\t\t\t}\n\t\t\n\t\t\t\t/***** OLD TASK THAT HASN'T BEEN DELETED BUT POSSIBLY MODIFIED *****/\n\t\t\n\t\t\t\t} else {\n\t\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' exists on the server and hasn't been deleted\");\n\t\t\n\t\t\t\t\t// Loop through each attribute on computer\n\t\t\t\t\tfor(var key in client.lists.scheduled[task]) {\n\t\t\n\t\t\t\t\t\t//Don't loop through timestamps\n\t\t\t\t\t\tif (key !== 'time') {\n\t\t\n\t\t\t\t\t\t\t// Check if task was deleted on server or\n\t\t\t\t\t\t\tif (server.lists.scheduled[task].hasOwnProperty('deleted')) {\n\t\t\n\t\t\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' was deleted on the server\");\n\t\t\n\t\t\t\t\t\t\t\t// Check if task was modified after it was deleted\n\t\t\t\t\t\t\t\tif (client.lists.scheduled[task].time[key] > server.lists.scheduled[task].deleted) {\n\t\t\n\t\t\t\t\t\t\t\t\tconsole.log(\"Task \" + task + \" was modified on the client after it was deleted on the server\");\n\t\t\n\t\t\t\t\t\t\t\t\t// Update the server with the entire task (including attributes and timestamps)\n\t\t\t\t\t\t\t\t\tserver.lists.scheduled[task] = client.lists.scheduled[task];\n\t\t\n\t\t\t\t\t\t\t\t\t//Breaks, we only need to do the thing once.\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\n\t\t\t\t\t\t\t// Task has not been deleted\n\t\t\t\t\t\t\t} else {\n\t\t\n\t\t\t\t\t\t\t\t// If the attribute was updated after the server\n\t\t\t\t\t\t\t\tif (client.lists.scheduled[task].time[key] > server.lists.scheduled[task].time[key]) {\n\t\t\n\t\t\t\t\t\t\t\t\tconsole.log(\"Key '\" + key + \"'  in task \" + task + \" has been updated by the client\");\n\t\t\n\t\t\t\t\t\t\t\t\tif (key !== 'list') {\n\t\t\t\t\t\t\t\t\t\t// Update the servers version\n\t\t\t\t\t\t\t\t\t\tserver.lists.scheduled[task][key] = client.lists.scheduled[task][key];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// Update the timestamp\n\t\t\t\t\t\t\t\t\tserver.lists.scheduled[task].time[key] = client.lists.scheduled[task].time[key];\n\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\n\t\t// Fix task length\n\t\tfixLength(server.tasks)\n\t\t\n\t\t// Fix server.lists.order\n\t\tserver.lists.order = [];\n\t\t\n\t\t// Fix logged tasks :(\n\t\t// for(var task in server.tasks) {\n\t\t// \tif(task != 'length') {\n\t\n\t\t// \t\tvar list = server.tasks[task].list;\n\t\n\t\t// \t\tif(server.lists.items[list].order.indexOf(task) != -1) {\n\t\n\t\t// \t\t\tif(server.tasks[task].logged) {\n\t\t// \t\t\t\tserver.lists.items[list].order.splice(server.lists.items[list].order.indexOf(task), 1);\n\t\t// \t\t\t}\n\t\n\t\t// \t\t} else {\n\t\t// \t\t\tif(!server.tasks[task].logged) {\n\t\t// \t\t\t\tserver.lists.items[list].order.push(task);\n\t\t// \t\t\t}\n\t\t// \t\t}\n\t\t// \t}\n\t\t// }\n\n\t\t// Get rid of duplicates\n\t\tfor(var list in server.lists.items) {\n\t\t\tif(list != 'length') {\n\t\t\t\tif (server.lists.items[list].hasOwnProperty('order')) {\n\t\t\t\t\tserver.lists.items[list].order = deDupe(server.lists.items[list].order);\n\t\t\t\t}\n\t\t\t\tif(server.lists.items[list].hasOwnProperty('name')) {\n\t\t\t\t\tif(server.lists.items[list].name !== 'Today' && server.lists.items[list].name !== 'Next') {\n\t\t\t\t\t\tserver.lists.order.push(Number(list));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t}\n\t\n\t\tcallback(server);\n\t\t\n\t// } catch (e) {\n\t// \t\n\t// \tconsole.log(e);\n\t// \t\n\t// }\n}\n\n// Clone an object or array\nfunction clone(input) {\n\treturn JSON.parse(JSON.stringify(input));\n}\n\n// Fix the length of an object\nfunction fixLength(obj) {\n\t// Update length\n\t[obj].length = 0;\n\tfor (i in [obj]) {\n\t\tif ([obj].hasOwnProperty(i) && i !== 'length') {\n\t\t\t[obj].length++;\n\t\t}\n\t}\n}\n\n// Remove duplicates from an array\nfunction deDupe(arr) {\n\tvar r = [];\n\to:for(var i = 0, n = arr.length; i < n; i++) {\n\t\tfor(var x = 0, y = r.length; x < y; x++) {\n\t\t\tif (r[x] == arr[i]) {\n\t\t\t\tcontinue o;\n\t\t\t}\n\t\t}\n\t\tr[r.length] = Number(arr[i]);\n\t}\n\treturn r;\n}\n\n// My super awesome function that converts a string to a number\n// \"421\".toNum()  -> 421\n// \"word\".toNum() -> \"word\"\nString.prototype.toNum = function () {\n\tvar x = parseInt(this, 10);\n\tif (x > -100) {\n\t\treturn x;\n\t} else {\n\t\treturn this.toString();\n\t}\n};\n\nfunction compress(obj) {\n\tvar chart = {\n\t\tname :       'a',\n\t\ttasks:       'b',\n\t\tcontent:     'c',\n\t\tpriority:    'd',\n\t\tdate:        'e',\n\t\ttoday:       'f',\n\t\tshowInToday: 'g',\n\t\tlist:        'h',\n\t\tlists:       'i',\n\t\tlogged:      'j',\n\t\ttime:        'k',\n\t\tsync:        'l',\n\t\tsynced:      'm',\n\t\torder:       'n',\n\t\tqueue:       'o',\n\t\tlength:      'p',\n\t\tnotes:       'q',\n\t\titems:       'r',\n\t\tnext:        's',\n\t\tsomeday:     't',\n\t\tdeleted:     'u'\n\t},\n\tout = {};\n\n\tfor (var key in obj) {\n\t\tif (chart.hasOwnProperty(key)) {\n\t\t\tout[chart[key]] = obj[key];\n\t\t\tif (typeof obj[key] === 'object' && isArray(obj[key]) == false) {\n\t\t\t\tout[chart[key]] = compress(out[chart[key]]);\n\t\t\t}\n\t\t} else {\n\t\t\tout[key] = obj[key];\n\t\t\tif (typeof obj[key] === 'object' && isArray(obj[key]) == false) {\n\t\t\t\tout[key] = compress(out[key]);\n\t\t\t}\n\t\t}\n\t}\n\treturn out;\n}\n\nfunction decompress(obj) {\n\tvar chart = {\n\t\ta: 'name',\n\t\tb: 'tasks',\n\t\tc: 'content',\n\t\td: 'priority',\n\t\te: 'date',\n\t\tf: 'today',\n\t\tg: 'showInToday',\n\t\th: 'list',\n\t\ti: 'lists',\n\t\tj: 'logged',\n\t\tk: 'time',\n\t\tl: 'sync',\n\t\tm: 'synced',\n\t\tn: 'order',\n\t\to: 'queue',\n\t\tp: 'length',\n\t\tq: 'notes',\n\t\tr: 'items',\n\t\ts: 'next',\n\t\tt: 'someday',\n\t\tu: 'deleted'\n\t},\n\tout = {};\n\n\tfor (var key in obj) {\n\t\tif (chart.hasOwnProperty(key)) {\n\t\t\tout[chart[key]] = obj[key];\n\t\t\tif (typeof obj[key] === 'object' && isArray(obj[key]) == false) {\n\t\t\t\tout[chart[key]] = decompress(out[chart[key]]);\n\t\t\t}\n\t\t} else {\n\t\t\tout[key] = obj[key];\n\t\t\tif (typeof obj[key] === 'object' && isArray(obj[key]) == false) {\n\t\t\t\tout[key] = decompress(out[key]);\n\t\t\t}\n\t\t}\n\t}\n\treturn out;\n}\n\n// Because typeof is useless here\nfunction isArray(obj) {\n    return obj.constructor == Array;\n}",
                "new_contents": "/* Nitro Sync\n *\n * Copyright (C) 2012 Caffeinated Code <http://caffeinatedco.de>\n * Copyright (C) 2012 Jono Cooper\n * Copyright (C) 2012 George Czabania\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n *\n * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n * Neither the name of Caffeinated Code nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nconsole.info('Nitro Sync 1.3\\nCopyright (C) 2012 Caffeinated Code\\nBy George Czabania & Jono Cooper');\n\nvar settings = {\n\tfilename: 'nitro_data.json',\n\turl: 'http://localhost:3000'\n}\n\n// Node Packages\nvar email = require('mailer'),\n\texpress = require('express'),\n\tapp = express.createServer(),\n\tdbox = require(\"dbox\").app({ \"app_key\": \"da4u54t1irdahco\", \"app_secret\": \"3ydqe041ogqe1zq\" }),\n\tOAuth = require(\"oauth\").OAuth;\n \n// Ubuntu one settings\nvar ubuntu = new OAuth(\"https://one.ubuntu.com/oauth/request/\", \"https://one.ubuntu.com/oauth/access/\", \"ubuntuone\", \"hammertime\", \"1.0\", settings.url + \"/ubuntu-one/\", \"PLAINTEXT\"),\n\tusers = {dropbox: {}, ubuntu: {}};\n\n//Funky Headers =)\napp.use(function (req, res, next) {\n\tres.header(\"X-powered-by\", \"NitrOS 2000\");\n\tnext();\n});\n\n// Main logs for server\n// var serverLog = [],\n// console.log = function (text) {\n// \tif(arguments.length > 1) {\n// \t\tvar temp = [];\n// \t\tfor(var i = 0; i < arguments.length; i++) {\n// \t\t\ttemp.push(arguments[i]);\n// \t\t}\n// \t\tserverLog.push(temp);\n// \t} else {\n// \t\tserverLog.push(text);\n// \t}\n// }\n\n// Enable cross browser ajax\n// app.enable(\"jsonp callback\");\napp.use(express.bodyParser());\n\n\n// Handles Static HTTP Requests\napp.use(express.static(__dirname + '/app'));\n\n// Initial Auth\napp.post('/auth/', function (req, res) {\n\n\tconsole.log(\"** Starting Auth **\");\n\n\t// If the client has never been connected before\n\tif (req.param('reqURL')) {\n\n\t\tswitch (req.param('service')) {\n\t\tcase \"dropbox\":\n\t\t\t// Request a token from dropbox\n\t\t\tdbox.request_token(function (status, request_token) {\n\t\t\t\tconsole.log(\"Sending authorize_url\");\n\t\t\t\t\n\t\t\t\trequest_token.authorize_url += \"&oauth_callback=\" + settings.url + \"/dropbox\";\n\n\t\t\t\t// Send it to the client\n\t\t\t\tres.json(request_token);\n\t\t\t});\n\t\t\tbreak;\n\t\tcase \"ubuntu\":\n\t\t\t// Request a token from ubuntu one\n\t\t\tubuntu.getOAuthRequestToken(function(e, t, s, r){\n\t\t\t\tvar reply = {};\n\t\t\t\treply.oauth_token = t;\n\t\t\t\treply.oauth_secret = s;\n\t\t\t\treply.authorize_url = 'https://one.ubuntu.com/oauth/authorize/?description=Nitro&oauth_token=' + t;\n\t\t\t\tres.json(reply);\n\t\t\t});\n\t\t\tbreak;\n\t\t}\n\n\t// Client has a token but not oauth\n\t} else if (req.param('token')) {\n\t\t\n\t\t// Get token and make sure it is an object\n\t\tvar user_token = req.param('token');\n\t\tif(typeof user_token === 'string') user_token = JSON.parse(user_token);\n\n\t\tswitch (req.param('service')) {\n\t\tcase \"dropbox\":\n\t\t\t\n\t\t\t// Add user\n\t\t\tusers.dropbox[user_token.oauth_token] = {};\n\t\t\t\t\t\t\n\t\t\tvar count = 0, max = 60;\n\n\t\t\tvar check = function () {\n\t\t\t\t\n\t\t\t\tif(users.dropbox[user_token.oauth_token].hasOwnProperty('uid')) {\n\t\t\t\t\t\n\t\t\t\t\tconsole.log('Connecting to dropbox');\n\t\n\t\t\t\t\t// Check token\n\t\t\t\t\tdbox.access_token(user_token, function (status, access_token) {\n\t\n\t\t\t\t\t\t// Token is good :D\n\t\t\t\t\t\tif (status === 200) {\n\t\t\t\t\t\t\tconsole.log('Attempt ' + count + ' - Connected!'); \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdbox.createClient(access_token).account(function (status, reply) {\n\t\n\t\t\t\t\t\t\t\tconsole.log(\"ACCOUNT\", status, reply);\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// Send access token to client so they can use it again\n\t\t\t\t\t\t\t\tres.json({\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\taccess: access_token,\n\t\t\t\t\t\t\t\t\temail: reply.email\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdelete users.dropbox[user_token.oauth_token];\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tconsole.log(status, access_token);\n\t\t\t\t\t\t\n\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\n\n\t\t\t\t// Nitro hasn't been allowed yet :(\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('Attempt ' + count + ' - Failed!');\n\t\t\t\t\tcount++;\n\n\t\t\t\t\t// Try again in a second\n\t\t\t\t\tif(count <= max) setTimeout(check, 1000);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcheck();\n\t\t\tbreak;\n\n\n\t\t case \"ubuntu\":\n\n\t\t\t// Add user\n\t\t\tusers.ubuntu[user_token.oauth_token] = {request_secret: user_token.oauth_secret};\n\n\t\t\tconsole.log(users);\n\t\t\t\n\t\t\tvar count = 0, max = 60;\n\n\t\t\t// Keep checking database\n\t\t\tvar check = function() {\n\t\t\t\tif(users.ubuntu[user_token.oauth_token].hasOwnProperty('oauth_token')) {\n\t\t\t\t\t\n\t\t\t\t\tubuntu.get(\"https://one.ubuntu.com/api/account/\", users.ubuntu[user_token.oauth_token].oauth_token, users.ubuntu[user_token.oauth_token].oauth_secret, function (e, d, r) {\n\t\t\t\t\t\t\n\t\t\t\t\t\td = JSON.parse(d);\n\t\t\t\t\t\t\n\t\t\t\t\t\tres.json({\n\t\t\t\t\t\t\taccess: {\n\t\t\t\t\t\t\t\toauth_token: users.ubuntu[user_token.oauth_token].oauth_token, \n\t\t\t\t\t\t\t\toauth_secret: users.ubuntu[user_token.oauth_token].oauth_secret\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\temail: d.email\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tdelete users.ubuntu[user_token.oauth_token];\n\t\t\t\t\t\t\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(\"failed, trying again\")\n\t\t\t\t\tcount++;\n\t\t\t\t\t\n\t\t\t\t\t// Try again in a second\n\t\t\t\t\tif(count <= max) setTimeout(check, 1000);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tcheck();\n\t\t\t\n\t\t\tbreak;\n\t\t }\n\n\t// Server has been authorised before\n\t} else if (req.param('access')) {\n\t\t\n\t\tvar access_token = req.param('access');\n\t\tif(typeof access_token === 'string') access_token = JSON.parse(access_token);\n\n\t\tconsole.log(\"Using client stored key\");\n\n\t\tswitch (req.param('service')) {\n\n\t\tcase \"dropbox\":\n\n\t\t\t// Create client\n\t\t\tuser = dbox.createClient(access_token);\n\n\t\t\t// Check to see if it worked\n\t\t\tuser.account(function (status, reply) {\n\t\t\t\tif (status === 200) {\n\t\t\t\t\tconsole.log(\"Connected!\");\n\t\t\t\t\tres.json(\"success\");\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log(\"Could not connect :( - \" + status);\n\t\t\t\t\tres.json(\"failed\");\n\t\t\t\t}\n\t\t\t});\n\t\t\tbreak;\n\n\t\tcase \"ubuntu\":\n\n\t\t\t// Check to see if it worked\n\t\t\tubuntu.get(\"https://one.ubuntu.com/api/account/\", access_token.oauth_token, access_token.oauth_secret, function (e, d, r) {\n\t\t\t\tif(e) {\n\t\t\t\t\tres.json(\"failed\");\n\t\t\t\t} else {\n\t\t\t\t\tres.json(\"success\");\n\t\t\t\t}\n\t\t\t});\t\t\n\t\t\tbreak;\n\t\t}\n\t}\n});\n\n// Dropbox callback\napp.get('/dropbox', function (req, res) {\n\tres.send(\"Authentication Complete! You can close this window now.\");\n\n\tvar uid = req.query.uid,\n\t\ttoken = req.query.oauth_token;\n\t\t\n\t\tif(users.dropbox.hasOwnProperty(token)) {\n\t\t\tusers.dropbox[token].uid = uid;\n\t\t} else {\n\t\t\tconsole.log(\"ERROR: UID not found.\");\n\t\t}\n\t\n});\n\n// Ubuntu callback for oauth verifier\napp.get('/ubuntu-one/', function (req, res) {\n\tres.send(\"Authentication Complete!\");\n\n\tconsole.log(\"Requesting access token\");\n\n\tvar token = req.query.oauth_token;\n\n\tif(users.ubuntu.hasOwnProperty(token)) {\n\t\tconsole.log(\"Token found :D Going to try and get access token\");\n\t\tubuntu.getOAuthAccessToken(token, users.ubuntu[token].request_secret, req.query.oauth_verifier, function(e, t, s, r) {\n\t\t\tusers.ubuntu[token].oauth_token = t;\n\t\t\tusers.ubuntu[token].oauth_secret = s;\n\t\t\tconsole.log(users);\n\t\t});\n\t} else {\n\t\tconsole.log(\"ERROR: Token not found!?\")\n\t}\n});\n\n// Actual Sync\napp.post('/sync/', function (req, res){\n\n\tvar service = req.param('service');\n\t\n\tvar access_token = req.param('access');\n\tif(typeof access_token === 'string') access_token = JSON.parse(access_token);\n\n\t// Get client\n\tswitch (service) {\n\tcase \"dropbox\":\n\t\tuser = dbox.createClient(access_token);\n\t\tbreak;\n\tcase \"ubuntu\":\n\t\tuser = access_token;\n\t}\n\t\n\tgetServer(service, user, function(server) {\n\n\t\tif(server != 'error') {\n\n\t\t\tvar recievedData = decompress(JSON.parse(req.param('data')));\n\n\t\t\t// Merge data\n\t\t\tmerge(server, recievedData, function (server) {\n\t\t\t\t// Send data back to client\n\t\t\t\tconsole.log(JSON.stringify(server, null, 4));\n\t\t\t\tconsole.log(\"Merge complete. Updating client.\");\n\t\t\t\tres.json(compress(server));\n\t\t\t\tsaveServer(service, user, server);\n\n\t\t\t\t//Analytics\n\t\t\t\tvar options = {\n\t\t\t\t\thost: 'nitrotasks.com',\n\t\t\t\t\tport: 80,\n\t\t\t\t\tpath: '/analytics/server.php?fingerprint=' + recievedData.stats.uid + '&backend=' + service + '&version=' + recievedData.stats.version + '&os=' + recievedData.stats.os + '&language=' + recievedData.stats.language\n\t\t\t\t};\n\n\t\t\t\trequire('http').get(options, function(res) {\n\t\t\t\t\tconsole.log(\"Sent to Analytics Server.\");\n\t\t\t\t});\n\t\t\t});\n\n\t\t} else {\n\t\t\t\n\t\t\tconsole.log(\"We got an error!\");\n\n\t\t\tres.json(\"error\");\n\n\t\t}\n\t});\n\n\t\n});\n\nport = process.env.PORT || 3000;\napp.listen(port);\n\nfunction getServer(service, user, callback) {\n\t\n\tconsole.log(\"Getting File from server\");\n\n\tswitch (service) {\n\tcase \"dropbox\":\n\t\tconsole.log(\"Dropbox\")\n\t\tuser.get(settings.filename, function (status, reply) {\n\t\t\treply = decompress(JSON.parse(reply.toString()));\n\n\t\t\t// Check if file exists\n\t\t\tif (!reply.hasOwnProperty('tasks')) {\n\t\t\t\tconsole.log(\"File doesn't exist on the clients dropbox :(\");\n\t\t\t\tconsole.log(\"So let's make one :D\");\n\t\t\t\tserver = clone(emptyServer);\n\t\t\t\tsaveServer(service, user, server);\n\t\t\t\tcallback(server);\n\t\t\t} else if (status != 200) {\n\t\t\t\tcallback('error');\n\t\t\t} else {\n\t\t\t\tconsole.log(\"Got the server!\");\n\t\t\t\tcallback(reply);\n\t\t\t}\n\t\t});\n\t\tbreak;\n\tcase \"ubuntu\":\n\t\tconsole.log(\"Ubuntu\")\n\t\tubuntu.get(\"https://files.one.ubuntu.com/content/~/Ubuntu%20One/Nitro/\" + settings.filename, user.oauth_token, user.oauth_secret, function (e, d, r) {\n\t\t\tif(e) {\n\t\t\t\tconsole.log(e);\n\t\t\t\tconsole.log(\"File doesn't exist on the client's ubuntu one account :(\");\n\t\t\t\tconsole.log(\"So let's make one :D\");\n\t\t\t\tserver = clone(emptyServer);\n\t\t\t\tsaveServer(service, user, server);\n\t\t\t\tcallback(server);\n\t\t\t} else {\n\t\t\t\treply = decompress(JSON.parse(d.toString()));\n\t\t\t\tconsole.log(\"Got the server!\");\n\t\t\t\tcallback(reply);\n\t\t\t}\n\t\t});\n\t\tbreak;\n\t}\n\t\n}\n\nfunction saveServer(service, user, server) {\n\tconsole.log(\"Saving to server (starting)\");\n\tvar output = JSON.stringify(compress(server));\n\n\tswitch (service) {\n\tcase \"dropbox\":\n\t\tconsole.log(\"Dropbox\");\n\t\tuser.put(settings.filename, output, function () {\n\t\t\tconsole.log(\"Saving to server (complete!)\");\n\t\t});\n\t\tbreak;\n\tcase \"ubuntu\":\n\t\tubuntu.put(\"https://files.one.ubuntu.com/content/~/Ubuntu%20One/Nitro/\" + settings.filename, user.oauth_token, user.oauth_secret, output, \"application/json\", function (e, d, r) {\n\t\t\tif(e) {\n\t\t\t\tcallback(\"Error saving file!\");\n\t\t\t} else {\n\t\t\t\tconsole.log(\"Saving to server (complete!)\");\n\t\t\t}\n\t\t});\n\t}\n}\n\n// Create server\nvar emptyServer = {\n\ttasks: {\n\t\tlength: 0\n\t},\n\tlists: {\n\t\torder: [],\n\t\titems: {\n\t\t\t0: {\n\t\t\t\torder: []\n\t\t\t},\n\t\t\ttoday: {\n\t\t\t\tname: \"Today\",\n\t\t\t\torder: [],\n\t\t\t\ttime: {\n\t\t\t\t\tname: 0,\n\t\t\t\t\torder: 0\n\t\t\t\t}\n\t\t\t},\n\t\t\tnext: {\n\t\t\t\tname: \"Next\",\n\t\t\t\torder: [],\n\t\t\t\ttime: {\n\t\t\t\t\tname: 0,\n\t\t\t\t\torder: 0\n\t\t\t\t}\n\t\t\t},\n\t\t\tlength: 1\n\t\t},\n\t\ttime: 0,\n\t\tscheduled: {\n\t\t\tlength: 0\n\t\t},\n\t\tdeleted: {}\n\t},\n\tqueue: {}\n};\n\nfunction merge(server, client, callback) {\n\n\t// console.log(JSON.stringify(client, null, 2));\n\t// console.log(JSON.stringify(server, null, 2));\n\n\tvar core = {\n\t\ttask: function(id) {\n\t\t\treturn {\n\t\t\t\tadd: function(name, list) {\n\t\t\t\t\t//ID of task\n\t\t\t\t\tvar taskId = server.tasks.length;\n\t\t\t\t\tserver.tasks.length++;\n\n\t\t\t\t\t//Saves\n\t\t\t\t\tserver.tasks[taskId] = {\n\t\t\t\t\t\tcontent: name,\n\t\t\t\t\t\tpriority: 'none',\n\t\t\t\t\t\tdate: '',\n\t\t\t\t\t\tnotes: '',\n\t\t\t\t\t\tlist: list,\n\t\t\t\t\t\tlogged: false,\n\t\t\t\t\t\ttime: {\n\t\t\t\t\t\t\tcontent: 0,\n\t\t\t\t\t\t\tpriority: 0,\n\t\t\t\t\t\t\tdate: 0,\n\t\t\t\t\t\t\tnotes: 0,\n\t\t\t\t\t\t\tlist: 0,\n\t\t\t\t\t\t\tlogged: 0\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsynced: false\n\t\t\t\t\t};\n\n\t\t\t\t\t//Pushes to array\n\t\t\t\t\tserver.lists.items[list].order.unshift(taskId);\n\t\t\t\t\t// server.save();\n\t\t\t\t\tconsole.log('Adding Task: ' + name + ' into list: ' + list);\n\n\t\t\t\t\treturn taskId;\n\t\t\t\t},\n\n\t\t\t\t/* Move a task somewhere.\n\t\t\t\te.g: core.task(0).move('next');\n\n\t\t\t\tTo delete something, move to 'trash' */\n\n\t\t\t\tmove: function(list) {\n\t\t\t\t\t//Remove from list\n\t\t\t\t\tvar old = server.tasks[id].list;\n\t\t\t\t\tserver.lists.items[old].order.remove(id);\n\n\t\t\t\t\tif(server.tasks[id].logged && list != 'logbook') {\n\t\t\t\t\t\tserver.tasks[id].logged = false;\n\t\t\t\t\t\t// server.save('tasks', id, 'logged');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (list === 'trash') {\n\t\t\t\t\t\t// delete server.tasks[id];\n\t\t\t\t\t\tserver.tasks[id] = {deleted: core.timestamp()};\n\t\t\t\t\t\tconsole.log('Deleted: ' + id);\n\t\t\t\t\t\t// Saves - but doesn't mess with timestamps\n\t\t\t\t\t\t// server.save();\n\t\t\t\t\t} else if (list === 'logbook') {\n\t\t\t\t\t\t// Don't actually move the task\n\t\t\t\t\t\tserver.tasks[id].logged = core.timestamp();\n\t\t\t\t\t\tconsole.log('Logged ' + id);\n\t\t\t\t\t\t// server.save('tasks', id, 'logged');\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//Move to other list\n\t\t\t\t\t\tserver.lists.items[list].order.unshift(id);\n\t\t\t\t\t\tserver.tasks[id].list = list;\n\t\t\t\t\t\tconsole.log('Moved: ' + id + ' to ' + list);\n\t\t\t\t\t\t//Saves\n\t\t\t\t\t\t// server.save([['tasks', id, 'list'],['lists', list, 'order'],['lists', old, 'order']]);\n\t\t\t\t\t}\n\t\t\t\t}\t\t\t\n\t\t\t}\n\t\t}\n\t}\n\n\t// MASSIVE TRY/CATCH FOR ERRORS (TEMPORARY UNTIL WE GET SOMETING ELSE SORTED OUT)\n\t// try {\t\n\t\n\t\t// Loop through each list\n\t\tfor (var list in client.lists.items) {\n\t\n\t\t\tif (list != '0' && list !== 'length') {\n\t\n\t\t\t\t// Check if it is a new list\n\t\t\t\tif (client.lists.items[list].synced === false || client.lists.items[list].synced === 'false') {\n\t\n\t\t\t\t\tconsole.log(\"List '\" + list + \"' has never been synced before\");\n\t\n\t\t\t\t\t// List is now synced so set it to true\n\t\t\t\t\tclient.lists.items[list].synced = true;\n\t\n\t\t\t\t\t// If a list with that ID already exists on the server\n\t\t\t\t\tif (server.lists.items.hasOwnProperty(list)) {\n\t\n\t\t\t\t\t\tconsole.log(\"List '\" + list + \"' already exists on the server\");\n\t\n\t\t\t\t\t\t// Change the list ID\n\t\t\t\t\t\tvar newID = server.lists.items.length;\n\t\t\t\t\t\tclient.lists.items[newID] = clone(client.lists.items[list]);\n\t\t\t\t\t\t\n\t\t\t\t\t\tfor(var task in client.lists.items[list].order) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\ttask = client.lists.items[list].order[task];\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tclient.tasks[task].list = newID;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// Temporary fix - not the best way to do it.\n\t\t\t\t\t\t\tclient.tasks[task].time.list = Date.now();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tdelete client.lists.items[list];\n\t\t\t\t\t\t\n\t\t\t\t\t\tconsole.log(\"List '\" + list + \"' has been moved to '\" + server.lists.items.length + \"'\");\n\t\n\t\t\t\t\t\tlist = server.lists.items.length;\n\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log(\"List '\" + list + \"' does not exist on server. Adding to server as: \" + server.lists.items.length);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(list != server.lists.items.length) {\n\t\t\t\t\t\t\tfor(var task in client.lists.items[list].order) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\ttask = client.lists.items[list].order[task];\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tclient.tasks[task].list = server.lists.items.length;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// Temporary fix - not the best way to do it.\n\t\t\t\t\t\t\t\tclient.tasks[task].time.list = Date.now();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// If the list doesn't exist on the server, create it\n\t\t\t\t\tserver.lists.items[server.lists.items.length] = {\n\t\t\t\t\t\tname: client.lists.items[list].name,\n\t\t\t\t\t\torder: [],\n\t\t\t\t\t\ttime: client.lists.items[list].time,\n\t\t\t\t\t\tsynced: true\n\t\t\t\t\t};\n\t\n\t\t\t\t\t// Update order\n\t\t\t\t\tserver.lists.order.push(Number(list));\n\t\t\t\t\tserver.lists.items.length++;\n\t\t\t\t\t\n\t\t\t\t/***** LIST IS DELETED ON THE CLIENT BUT DOESN'T EXIST ON THE SERVER *****/\n\t\t\t\t} else if (client.lists.items[list].hasOwnProperty('deleted') && !server.lists.items.hasOwnProperty(list)) {\n\t\t\t\t\t\n\t\t\t\t\tconsole.log(\"LIST \" + list + \" IS DELETED ON THE CLIENT BUT DOESN'T EXIST ON THE SERVER\")\n\t\t\t\t\t\n\t\t\t\t\t// Copy the deleted timestamp over\n\t\t\t\t\tserver.lists.items[list] = {deleted: client.lists.items[list].deleted}; \n\t\t\t\t\t\t\n\t\t\t\t/***** LIST IS DELETED ON THE CLIENT AND BUT NOT ON THE SERVER *****/\n\t\t\t\t\n\t\t\t\t } else if (client.lists.items[list].hasOwnProperty('deleted') && !server.lists.items[list].hasOwnProperty('deleted')) {\n\t\t\t\t\t \n\t\t\t\t\t console.log(\"LIST \" + list + \" IS DELETED ON THE CLIENT AND BUT NOT ON THE SERVER\")\n\t\t\t\t\t\n\t\t\t\t\tvar deleteList = true;\n\t\t\t\t\n\t\t\t\t\t// Check timestamps on client and server\n\t\t\t\t\tfor(var key in server.lists.items[list].time) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// If server has been modified after client was deleted, don't delete the list.\n\t\t\t\t\t\tif(server.lists.items[list].time[key] > client.lists.deleted[list]) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdeleteList = false;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// Delete the list\n\t\t\t\t\tif(deleteList) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tcli.list(list).remove();\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t/***** LIST IS DELETED ON THE SERVER AND ON THE COMPUTER *****/\n\t\t\t\t\n\t\t\t\t} else if (server.lists.items[list].hasOwnProperty('deleted') && client.lists.items[list].hasOwnProperty('deleted')) {\n\t\t\t\t\t\n\t\t\t\t\tconsole.log(\"List '\" + list + \"' is deleted on the server and the computer\");\n\t\t\t\t\t\n\t\t\t\t\t// Use the latest time stamp\n\t\t\t\t\tif (client.lists.items[list].deleted > server.lists.items[list].deleted) {\n\t\t\t\t\t\n\t\t\t\t\t\tconsole.log(\"List '\" + list + \"' is deleted, but has a newer timestamp\");\n\t\t\t\t\t\n\t\t\t\t\t\t// If the task was deleted on a computer after it was deleted on the server, then update the time stamp\n\t\t\t\t\t\tserver.lists.items[list].deleted = client.lists.items[list].deleted;\n\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\n\t\n\t\t\t\t\n\t\t\t\t/***** LIST IS DELETED ON THE SERVER AND BUT NOT ON THE COMPUTER *****/\n\t\t\t\t\n\t\t\t\t} else if (server.lists.items[list].hasOwnProperty('deleted') && client.lists.items.hasOwnProperty(list)) {\n\t\t\t\t\t\n\t\t\t\t\tconsole.log(\"LIST \" + list + \" IS DELETED ON THE SERVER AND BUT NOT ON THE COMPUTER\")\n\t\t\t\t\t\n\t\t\t\t\tvar keepList = true;\n\t\t\t\t\t\n\t\t\t\t\t// Check timestamps on client and server\n\t\t\t\t\tfor(var key in client.lists.items[list].time) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// If the task on the client has been modified after task on the server was deleted, keep the list.\n\t\t\t\t\t\tif(client.lists.items[list].time[key] > server.lists.deleted[list]) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tkeepList = false;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// Keep the list\n\t\t\t\t\tif(keepList) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tserver.lists.items[list] = clone(client.lists.items[list]);\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t} else if (server.lists.items.hasOwnProperty(list)) {\n\t\t\t\t\n\t\t\t\t\tconsole.log(\"List '\" + list + \"' exists on server.\");\n\t\t\t\t\n\t\t\t\t\tfor(var key in client.lists.items[list].time) {\n\t\t\t\t\n\t\t\t\t\t\tif (client.lists.items[list].time[key] > server.lists.items[list].time[key]) {\n\t\t\t\t\n\t\t\t\t\t\t\tconsole.log(\"The key '\" + key + \"' in list '\" + list + \"' has been modified.\");\n\t\t\t\t\n\t\t\t\t\t\t\tconsole.log(JSON.stringify(client.lists.items[list][key]))\n\t\t\t\t\n\t\t\t\t\t\t\t// If so, update list key and time\n\t\t\t\t\t\t\tserver.lists.items[list][key] = client.lists.items[list][key];\n\t\t\t\t\t\t\tserver.lists.items[list].time[key] = client.lists.items[list].time[key];\n\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Loop through each task\n\t\tfor(var task in client.tasks) {\n\t\n\t\t\t// Do not sync the tasks.length propery\n\t\t\t// This should only be modified by the server side cli.js\n\t\t\tif (task !== 'length') {\n\t\n\t\t\t\t/***** ADDING NEW TASKS TO THE SERVER *****/\n\t\n\t\t\t\t// If task has never been synced before\n\t\t\t\tif (client.tasks[task].synced === false || client.tasks[task].synced === 'false') {\n\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' has never been synced before\");\n\t\n\t\t\t\t\t// Task is going to be added to the server so we delete the synced property\n\t\t\t\t\tclient.tasks[task].synced = true;\n\t\n\t\t\t\t\t// If task already exists on the server (Don't be fooled, it's a different task...)\n\t\t\t\t\tif (server.tasks.hasOwnProperty(task)) {\n\t\n\t\t\t\t\t\tconsole.log(\"A task with the ID '\" + task + \"' already exists on the server\");\n\t\n\t\t\t\t\t\t// Does not mess with ID's if it isn't going to change\n\t\t\t\t\t\tif (server.tasks.length !== Number(task)) {\n\t\n\t\t\t\t\t\t\t// Add task to task (ID + server.tasks.length)\n\t\t\t\t\t\t\tclient.tasks[server.tasks.length] = clone(client.tasks[task]);\n\t\t\t\t\t\t\tdelete client.tasks[task];\n\t\n\t\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' has been moved to task '\" + server.tasks.length  + \"'\");\n\t\n\t\t\t\t\t\t\ttask = server.tasks.length;\n\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// If task hasn't been deleted\n\t\t\t\t\tif (!client.tasks[task].hasOwnProperty('deleted')) {\n\t\n\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is being added to the server.\");\n\t\n\t\t\t\t\t\t// Add the task to the server\n\t\t\t\t\t\tcli.addTask(\"New Task\", client.tasks[task].list);\n\t\t\t\t\t\tserver.tasks[task] = clone(client.tasks[task]);\n\t\n\t\t\t\t\t\t// Calculate date\n\t\t\t\t\t\tcli.calc.date(task);\n\t\n\t\t\t\t\t\t// Calculate Today etc? - Do later\n\t\t\t\t\t\tcli.today(task).calculate();\n\t\n\t\t\t\t\t\t// Fix task length\n\t\t\t\t\t\tfixLength(server.tasks);\n\t\n\t\t\t\t\t// The task is new, but the client deleted it\n\t\t\t\t\t} else {\n\t\n\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is new, but the client deleted it\");\n\t\n\t\t\t\t\t\t// Add the task to the server, but don't touch lists and stuff\n\t\t\t\t\t\tserver.tasks[task] = clone(client.tasks[task]);\n\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t/***** TASK DOESN'T EXIST ON SERVER FOR SOME REASON -- BUG *****/\n\t\t\t\t} else if (!server.tasks.hasOwnProperty(task)) {\n\t\t\t\t\t\n\t\t\t\t\tconsole.log(\"Task \" + task + \" doesn't exist on server. It should, but it doesn't.\");\n\t\t\t\t\t\n\t\t\t\t\tif(client.tasks[task].hasOwnProperty('deleted')) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tconsole.log(\"Task \" + task + \" was deleted before it was sunk\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tserver.tasks[task] = {deleted: client.tasks[task].deleted};\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\t// Better just copy the task onto the server...\n\t\t\t\t\t// server.tasks[task] = clone(client.tasks[task]);\n\t\n\t\t\t\t/***** CLIENT DELETED TASK *****/\n\t\n\t\t\t\t// Task was deleted on computer but not on the server\n\t\t\t\t} else if (client.tasks[task].hasOwnProperty('deleted') && !server.tasks[task].hasOwnProperty('deleted')) {\n\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' was deleted on computer but not on the server\");\n\t\n\t\t\t\t\t// We use this to check whether the task was modified AFTER it was deleted\n\t\t\t\t\tvar deleteTask = true;\n\t\n\t\t\t\t\t// Loop through each attribute on server\n\t\t\t\t\tfor(var key in server.tasks[task]) {\n\t\n\t\t\t\t\t\t// Check if server task was modified after task was deleted\n\t\t\t\t\t\tif (server.tasks[task].time[key] > client.tasks[task].deleted) {\n\t\n\t\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' was modified after task was deleted\");\n\t\n\t\t\t\t\t\t\t// Since it has been modified after it was deleted, we don't delete the task\n\t\t\t\t\t\t\tdeleteTask = false;\n\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// If there have been no modifications to the task after it has been deleted\n\t\t\t\t\tif (deleteTask) {\n\t\n\t\t\t\t\t\t// Delete the task\n\t\t\t\t\t\tcli.deleteTask(task);\n\t\n\t\t\t\t\t\t// Get the timestamp\n\t\t\t\t\t\tserver.tasks[task] = clone(client.tasks[task]);\n\t\n\t\t\t\t\t\t// Update stuff\n\t\t\t\t\t\t// cli.calc.date(task);\n\t\t\t\t\t\t// cli.today(task).calculate();\n\t\n\t\t\t\t\t}\n\t\n\t\t\t\t/***** SERVER DELETED TASK *****/\n\t\n\t\t\t\t// Task is deleted on the server and the computer\n\t\t\t\t} else if (client.tasks[task].hasOwnProperty('deleted') && server.tasks[task].hasOwnProperty('deleted')){\n\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is deleted on the server and the computer\");\n\t\n\t\t\t\t\t// Use the latest time stamp\n\t\t\t\t\tif (client.tasks[task].deleted > server.tasks[task].deleted) {\n\t\n\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is deleted, but has a newer timestamp\");\n\t\n\t\t\t\t\t\t// If the task was deleted on a computer after it was deleted on the server, then update the time stamp\n\t\t\t\t\t\tserver.tasks[task].deleted = client.tasks[task].deleted;\n\t\n\t\t\t\t\t}\n\t\n\t\t\t\t/***** OLD TASK THAT HASN'T BEEN DELETED BUT POSSIBLY MODIFIED *****/\n\t\n\t\t\t\t} else {\n\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' exists on the server and hasn't been deleted\");\n\t\n\t\t\t\t\t//Stores the Attrs we'll be needing later\n\t\t\t\t\tvar changedAttrs = [];\n\t\n\t\t\t\t\t// Loop through each attribute on computer\n\t\t\t\t\tfor(var key in client.tasks[task]) {\n\t\n\t\t\t\t\t\t//Don't loop through timestamps\n\t\t\t\t\t\tif (key !== 'time') {\n\t\n\t\t\t\t\t\t\t// Check if task was deleted on server or\n\t\t\t\t\t\t\tif (server.tasks[task].hasOwnProperty('deleted')) {\n\t\n\t\t\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' was deleted on the server\");\n\t\n\t\t\t\t\t\t\t\t// Check if task was modified after it was deleted\n\t\t\t\t\t\t\t\tif (client.tasks[task].time[key] > server.tasks[task].deleted) {\n\t\n\t\t\t\t\t\t\t\t\tconsole.log(\"Task \" + task + \" was modified on the client after it was deleted on the server\");\n\t\n\t\t\t\t\t\t\t\t\t// Update the server with the entire task (including attributes and timestamps)\n\t\t\t\t\t\t\t\t\tserver.tasks[task] = client.tasks[task];\n\t\n\t\t\t\t\t\t\t\t\t//Breaks, we only need to do the thing once.\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\n\t\t\t\t\t\t\t// Task has not been deleted\n\t\t\t\t\t\t\t} else {\n\t\n\t\t\t\t\t\t\t\t// If the attribute was updated after the server\n\t\t\t\t\t\t\t\tif (client.tasks[task].time[key] > server.tasks[task].time[key]) {\n\t\n\t\t\t\t\t\t\t\t\tconsole.log(\"Key '\" + key + \"'  in task \" + task + \" has been updated by the client\");\n\t\n\t\t\t\t\t\t\t\t\tif (key !== 'list') {\n\t\t\t\t\t\t\t\t\t\t// Update the servers version\n\t\t\t\t\t\t\t\t\t\tserver.tasks[task][key] = client.tasks[task][key];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// Update the timestamp\n\t\t\t\t\t\t\t\t\tserver.tasks[task].time[key] = client.tasks[task].time[key];\n\t\n\t\t\t\t\t\t\t\t\t//Adds the changed Attr to the array\n\t\t\t\t\t\t\t\t\tchangedAttrs.push(key);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (changedAttrs.length > 0) {\n\t\t\t\t\t\tif (changedAttrs.indexOf('list') != -1) {\n\t\t\t\t\t\t\t// List\n\t\t\t\t\t\t\tconsole.log(\"Task \" + task + \" has been updated --> LIST\");\n\t\t\t\t\t\t\tcli.moveTask(task, client.tasks[task].list);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (changedAttrs.indexOf('logged') != -1) {\n\t\t\t\t\t\t\t// List\n\t\t\t\t\t\t\tconsole.log(\"Task \" + task + \" has been updated --> LOGGED\");\n\t\t\t\t\t\t\t// core.task(task).move(client.tasks[task].list);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Loop through each task\n\t\tfor(var task in client.lists.scheduled) {\n\t\t\n\t\t\t// Do not sync the tasks.length propery\n\t\t\t// This should only be modified by the server side cli.js\n\t\t\tif (task !== 'length') {\n\t\t\n\t\t\t\t/***** ADDING NEW TASKS TO THE SERVER *****/\n\t\t\n\t\t\t\t// If task has never been synced before\n\t\t\t\tif (client.lists.scheduled[task].synced === false || client.lists.scheduled[task].synced === 'false') {\n\t\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' has never been synced before\");\n\t\t\n\t\t\t\t\t// Task is going to be added to the server so we delete the synced property\n\t\t\t\t\tclient.lists.scheduled[task].synced = true;\n\t\t\n\t\t\t\t\t// If task already exists on the server (Don't be fooled, it's a different task...)\n\t\t\t\t\tif (server.lists.scheduled.hasOwnProperty(task)) {\n\t\t\n\t\t\t\t\t\tconsole.log(\"A task with the ID '\" + task + \"' already exists on the server\");\n\t\t\n\t\t\t\t\t\t// Does not mess with ID's if it isn't going to change\n\t\t\t\t\t\tif (server.lists.scheduled.length !== Number(task)) {\n\t\t\n\t\t\t\t\t\t\t// Add task to task (ID + server.lists.scheduled.length)\n\t\t\t\t\t\t\tclient.lists.scheduled[server.lists.scheduled.length] = clone(client.lists.scheduled[task]);\n\t\t\t\t\t\t\tdelete client.lists.scheduled[task];\n\t\t\n\t\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' has been moved to task '\" + server.lists.scheduled.length  + \"'\");\n\t\t\n\t\t\t\t\t\t\ttask = server.lists.scheduled.length;\n\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\n\t\t\t\t\t// If task hasn't been deleted\n\t\t\t\t\tif (!client.lists.scheduled[task].hasOwnProperty('deleted')) {\n\t\t\n\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is being added to the server.\");\n\t\t\n\t\t\t\t\t\t// Add the task to the server\n\t\t\t\t\t\tcli.scheduled.add(\"New Task\", client.lists.scheduled[task].type);\n\t\t\t\t\t\tserver.lists.scheduled[task] = clone(client.lists.scheduled[task]);\n\t\t\n\t\t\t\t\t\t// Fix task length\n\t\t\t\t\t\tfixLength(server.lists.scheduled);\n\t\t\n\t\t\t\t\t// The task is new, but the client deleted it\n\t\t\t\t\t} else {\n\t\t\n\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is new, but the client deleted it\");\n\t\t\n\t\t\t\t\t\t// Add the task to the server, but don't touch lists and stuff\n\t\t\t\t\t\tserver.lists.scheduled[task] = clone(client.lists.scheduled[task]);\n\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t/***** TASK DOESN'T EXIST ON SERVER FOR SOME REASON -- BUG *****/\n\t\t\t\t} else if (!server.tasks.hasOwnProperty(task)) {\n\t\t\t\t\t\n\t\t\t\t\tconsole.log(\"Task doesn't exist on server. It should, but it doesn't.\");\n\t\t\t\t\n\t\t\t\t\t// Better just copy the task onto the server...\n\t\t\t\t\tserver.lists.scheduled[task] = clone(client.lists.scheduled[task]);\n\t\t\n\t\t\t\t/***** CLIENT DELETED TASK *****/\n\t\t\n\t\t\t\t// Task was deleted on computer but not on the server\n\t\t\t\t} else if (client.lists.scheduled[task].hasOwnProperty('deleted') && !server.lists.scheduled[task].hasOwnProperty('deleted')) {\n\t\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' was deleted on computer but not on the server\");\n\t\t\n\t\t\t\t\t// We use this to check whether the task was modified AFTER it was deleted\n\t\t\t\t\tvar deleteTask = true;\n\t\t\n\t\t\t\t\t// Loop through each attribute on server\n\t\t\t\t\tfor(var key in server.lists.scheduled[task]) {\n\t\t\n\t\t\t\t\t\t// Check if server task was modified after task was deleted\n\t\t\t\t\t\tif (server.lists.scheduled[task].time[key] > client.lists.scheduled[task].deleted) {\n\t\t\n\t\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' was modified after task was deleted\");\n\t\t\n\t\t\t\t\t\t\t// Since it has been modified after it was deleted, we don't delete the task\n\t\t\t\t\t\t\tdeleteTask = false;\n\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\n\t\t\t\t\t// If there have been no modifications to the task after it has been deleted\n\t\t\t\t\tif (deleteTask) {\n\t\t\n\t\t\t\t\t\t// Delete the task\n\t\t\t\t\t\tcli.deleteTask('s' + task);\n\t\t\n\t\t\t\t\t\t// Get the timestamp\n\t\t\t\t\t\tserver.lists.scheduled[task] = clone(client.lists.scheduled[task]);\n\t\t\n\t\t\t\t\t}\n\t\t\n\t\t\t\t/***** SERVER DELETED TASK *****/\n\t\t\n\t\t\t\t// Task is deleted on the server and the computer\n\t\t\t\t} else if (client.lists.scheduled[task].hasOwnProperty('deleted') && server.lists.scheduled[task].hasOwnProperty('deleted')){\n\t\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is deleted on the server and the computer\");\n\t\t\n\t\t\t\t\t// Use the latest time stamp\n\t\t\t\t\tif (client.lists.scheduled[task].deleted > server.lists.scheduled[task].deleted) {\n\t\t\n\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' is deleted, but has a newer timestamp\");\n\t\t\n\t\t\t\t\t\t// If the task was deleted on a computer after it was deleted on the server, then update the time stamp\n\t\t\t\t\t\tserver.lists.scheduled[task].deleted = client.lists.scheduled[task].deleted;\n\t\t\n\t\t\t\t\t}\n\t\t\n\t\t\t\t/***** OLD TASK THAT HASN'T BEEN DELETED BUT POSSIBLY MODIFIED *****/\n\t\t\n\t\t\t\t} else {\n\t\t\n\t\t\t\t\tconsole.log(\"Task '\" + task + \"' exists on the server and hasn't been deleted\");\n\t\t\n\t\t\t\t\t// Loop through each attribute on computer\n\t\t\t\t\tfor(var key in client.lists.scheduled[task]) {\n\t\t\n\t\t\t\t\t\t//Don't loop through timestamps\n\t\t\t\t\t\tif (key !== 'time') {\n\t\t\n\t\t\t\t\t\t\t// Check if task was deleted on server or\n\t\t\t\t\t\t\tif (server.lists.scheduled[task].hasOwnProperty('deleted')) {\n\t\t\n\t\t\t\t\t\t\t\tconsole.log(\"Task '\" + task + \"' was deleted on the server\");\n\t\t\n\t\t\t\t\t\t\t\t// Check if task was modified after it was deleted\n\t\t\t\t\t\t\t\tif (client.lists.scheduled[task].time[key] > server.lists.scheduled[task].deleted) {\n\t\t\n\t\t\t\t\t\t\t\t\tconsole.log(\"Task \" + task + \" was modified on the client after it was deleted on the server\");\n\t\t\n\t\t\t\t\t\t\t\t\t// Update the server with the entire task (including attributes and timestamps)\n\t\t\t\t\t\t\t\t\tserver.lists.scheduled[task] = client.lists.scheduled[task];\n\t\t\n\t\t\t\t\t\t\t\t\t//Breaks, we only need to do the thing once.\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\n\t\t\t\t\t\t\t// Task has not been deleted\n\t\t\t\t\t\t\t} else {\n\t\t\n\t\t\t\t\t\t\t\t// If the attribute was updated after the server\n\t\t\t\t\t\t\t\tif (client.lists.scheduled[task].time[key] > server.lists.scheduled[task].time[key]) {\n\t\t\n\t\t\t\t\t\t\t\t\tconsole.log(\"Key '\" + key + \"'  in task \" + task + \" has been updated by the client\");\n\t\t\n\t\t\t\t\t\t\t\t\tif (key !== 'list') {\n\t\t\t\t\t\t\t\t\t\t// Update the servers version\n\t\t\t\t\t\t\t\t\t\tserver.lists.scheduled[task][key] = client.lists.scheduled[task][key];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// Update the timestamp\n\t\t\t\t\t\t\t\t\tserver.lists.scheduled[task].time[key] = client.lists.scheduled[task].time[key];\n\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\n\t\t// Fix task length\n\t\tfixLength(server.tasks)\n\t\t\n\t\t// Fix server.lists.order\n\t\tserver.lists.order = [];\n\n\t\t// Get rid of duplicates\n\t\tfor(var list in server.lists.items) {\n\t\t\tif(list != 'length') {\n\t\t\t\tif (server.lists.items[list].hasOwnProperty('order')) {\n\t\t\t\t\tserver.lists.items[list].order = deDupe(server.lists.items[list].order);\n\t\t\t\t}\n\t\t\t\tif(server.lists.items[list].hasOwnProperty('name')) {\n\t\t\t\t\tif(server.lists.items[list].name !== 'Today' && server.lists.items[list].name !== 'Next') {\n\t\t\t\t\t\tserver.lists.order.push(Number(list));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t}\n\t\n\t\tcallback(server);\n\t\t\n\t// } catch (e) {\n\t// \t\n\t// \tconsole.log(e);\n\t// \t\n\t// }\n}\n\n// Clone an object or array\nfunction clone(input) {\n\treturn JSON.parse(JSON.stringify(input));\n}\n\n// Fix the length of an object\nfunction fixLength(obj) {\n\t// Update length\n\t[obj].length = 0;\n\tfor (i in [obj]) {\n\t\tif ([obj].hasOwnProperty(i) && i !== 'length') {\n\t\t\t[obj].length++;\n\t\t}\n\t}\n}\n\n// Remove duplicates from an array\nfunction deDupe(arr) {\n\tvar r = [];\n\to:for(var i = 0, n = arr.length; i < n; i++) {\n\t\tfor(var x = 0, y = r.length; x < y; x++) {\n\t\t\tif (r[x] == arr[i]) {\n\t\t\t\tcontinue o;\n\t\t\t}\n\t\t}\n\t\tr[r.length] = Number(arr[i]);\n\t}\n\treturn r;\n}\n\n// My super awesome function that converts a string to a number\n// \"421\".toNum()  -> 421\n// \"word\".toNum() -> \"word\"\nString.prototype.toNum = function () {\n\tvar x = parseInt(this, 10);\n\tif (x > -100) {\n\t\treturn x;\n\t} else {\n\t\treturn this.toString();\n\t}\n};\n\nfunction compress(obj) {\n\tvar chart = {\n\t\tname :       'a',\n\t\ttasks:       'b',\n\t\tcontent:     'c',\n\t\tpriority:    'd',\n\t\tdate:        'e',\n\t\ttoday:       'f',\n\t\tshowInToday: 'g',\n\t\tlist:        'h',\n\t\tlists:       'i',\n\t\tlogged:      'j',\n\t\ttime:        'k',\n\t\tsync:        'l',\n\t\tsynced:      'm',\n\t\torder:       'n',\n\t\tqueue:       'o',\n\t\tlength:      'p',\n\t\tnotes:       'q',\n\t\titems:       'r',\n\t\tnext:        's',\n\t\tsomeday:     't',\n\t\tdeleted:     'u'\n\t},\n\tout = {};\n\n\tfor (var key in obj) {\n\t\tif (chart.hasOwnProperty(key)) {\n\t\t\tout[chart[key]] = obj[key];\n\t\t\tif (typeof obj[key] === 'object' && isArray(obj[key]) == false) {\n\t\t\t\tout[chart[key]] = compress(out[chart[key]]);\n\t\t\t}\n\t\t} else {\n\t\t\tout[key] = obj[key];\n\t\t\tif (typeof obj[key] === 'object' && isArray(obj[key]) == false) {\n\t\t\t\tout[key] = compress(out[key]);\n\t\t\t}\n\t\t}\n\t}\n\treturn out;\n}\n\nfunction decompress(obj) {\n\tvar chart = {\n\t\ta: 'name',\n\t\tb: 'tasks',\n\t\tc: 'content',\n\t\td: 'priority',\n\t\te: 'date',\n\t\tf: 'today',\n\t\tg: 'showInToday',\n\t\th: 'list',\n\t\ti: 'lists',\n\t\tj: 'logged',\n\t\tk: 'time',\n\t\tl: 'sync',\n\t\tm: 'synced',\n\t\tn: 'order',\n\t\to: 'queue',\n\t\tp: 'length',\n\t\tq: 'notes',\n\t\tr: 'items',\n\t\ts: 'next',\n\t\tt: 'someday',\n\t\tu: 'deleted'\n\t},\n\tout = {};\n\n\tfor (var key in obj) {\n\t\tif (chart.hasOwnProperty(key)) {\n\t\t\tout[chart[key]] = obj[key];\n\t\t\tif (typeof obj[key] === 'object' && isArray(obj[key]) == false) {\n\t\t\t\tout[chart[key]] = decompress(out[chart[key]]);\n\t\t\t}\n\t\t} else {\n\t\t\tout[key] = obj[key];\n\t\t\tif (typeof obj[key] === 'object' && isArray(obj[key]) == false) {\n\t\t\t\tout[key] = decompress(out[key]);\n\t\t\t}\n\t\t}\n\t}\n\treturn out;\n}\n\n// Because typeof is useless here\nfunction isArray(obj) {\n    return obj.constructor == Array;\n}",
                "subject": "Removed old code",
                "message": "Removed old code\n",
                "lang": "JavaScript",
                "license": "unknown",
                "repos": "nitrotasks/nitro-server,nitrotasks/nitro-server,CaffeinatedCode/nitro-server"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10227,
            "row": {
                "commit": "5b4f933b3a04da6db968de585b29a3aa59c5ee4a",
                "old_file": "test/instantly.test.js",
                "new_file": "test/instantly.test.js",
                "old_contents": "'use strict';\n\nvar assert = require('assert');\nvar http = require('http');\nvar EventSource = require('eventsource');\nvar SseChannel = require('sse-channel');\nvar Instantly = require('../src/instantly');\n\nvar endpoint = 'http://127.0.0.1:7788/channel/test';\nvar port = 7788;\nvar ip = '127.0.0.1';\n\ndescribe('instantly', function() {\n    this.timeout(10000);\n\n    var es, server;\n\n    function startServer(event) {\n        var channel = new SseChannel();\n        // Prevent done from running twice\n        var timeout = Math.floor(Math.random() * 2000) + 1000;\n        var params = {\n            id: timeout,\n            data: 'testing instantly'\n        };\n\n        if (event === 'CLOSE') {\n            params.id = event;\n        } else {\n            params.event = event ? event : 'message';\n        }\n\n        setInterval(function broadcast() {\n            channel.send(params);\n        }, timeout);\n\n        server = http.createServer(function(req, res) {\n            if (req.url.indexOf('/channel/test') === 0) {\n                channel.addClient(req, res);\n            } else {\n                res.writeHead(404);\n                res.end();\n            }\n        }).listen(port, ip);\n    }\n\n    afterEach(function(done) {\n        if (server) {\n            server.close();\n        }\n\n        if (es) {\n            es.close();\n        }\n\n        done();\n    });\n\n    it('should connect to the channel and recieve data', function(done) {\n        startServer();\n\n        es = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource\n        });\n\n        es.on('message', function getMessage(msg) {\n            assert.equal(msg.data, 'testing instantly');\n\n            done();\n        });\n\n        es.listen();\n    });\n\n    it('should connect to the channel and recieve data from custom event', function(done) {\n        startServer('custom-event');\n\n        es = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource\n        });\n\n        es.on('custom-event', function getMessage(msg) {\n            assert.equal(msg.data, 'testing instantly');\n\n            done();\n        });\n\n        es.listen();\n    });\n\n    it('should run open callback when a connection is open', function(done) {\n        startServer();\n\n        es = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource,\n            open: function() {\n                assert.equal('should run', 'should run');\n\n                done();\n            }\n        });\n\n        es.listen();\n    });\n\n    it('should run error callback when an error occur', function(done) {\n        startServer();\n\n        es = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource,\n            error: function() {\n                assert.equal('should run', 'should run');\n\n                done();\n            }\n        });\n\n        es.listen();\n\n        es.error();\n    });\n\n    it('should close the connection when an error occur', function(done) {\n        startServer();\n\n        var isClosed = true;\n\n        es = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource,\n            close: function() {\n                assert.equal('should run', 'should run');\n\n                if (isClosed) {\n                    isClosed = false;\n\n                    done();\n                }\n            }\n        });\n\n        es.listen();\n\n        es.close();\n    });\n\n    it('should throw TypeError exception if channel is not set', function(done) {\n        assert.throws(function() {\n            es = new Instantly();\n        }, /You need to provide a channel we can listen to!/);\n\n        done();\n    });\n\n    it('should throw TypeError exception if event is not a string', function() {\n        startServer();\n\n        var instantly = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource\n        });\n\n        assert.throws(function() {\n            instantly.on(null, function() {});\n        }, /Event is not a string/);\n\n        assert.throws(function() {\n            instantly.on({}, function() {});\n        }, /Event is not a string/);\n\n        assert.throws(function() {\n            instantly.on(undefined, function() {});\n        }, /Event is not a string/);\n\n        assert.throws(function() {\n            instantly.on(12312, function() {});\n        }, /Event is not a string/);\n    });\n\n    it('should throw TypeError exception if callback is not a function', function() {\n        startServer();\n\n        var instantly = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource\n        });\n\n        assert.throws(function() {\n            instantly.on('event');\n        }, /Callback is not a function/);\n\n        assert.throws(function() {\n            instantly.on('event', 'string');\n        }, /Callback is not a function/);\n\n        assert.throws(function() {\n            instantly.on('event', {});\n        }, /Callback is not a function/);\n    });\n\n    it('should close the connection if an id \"CLOSE\" is sent by server', function(done) {\n        startServer('CLOSE');\n\n        var isClosed = true;\n\n        es = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource,\n            close: function() {\n                assert.equal('closing', 'closing');\n\n                if (isClosed) {\n                    isClosed = false;\n\n                    done();\n                }\n            }\n        });\n\n        es.on('message', function() {});\n\n        es.listen();\n    });\n});\n",
                "new_contents": "'use strict';\n\nvar assert = require('assert');\nvar http = require('http');\nvar EventSource = require('eventsource');\nvar SseChannel = require('sse-channel');\nvar Instantly = require('../src/instantly');\n\nvar endpoint = 'http://127.0.0.1:7788/channel/test';\nvar port = 7788;\nvar ip = '127.0.0.1';\n\ndescribe('instantly', function() {\n    this.timeout(10000);\n\n    var es, server;\n\n    function startServer(event) {\n        var channel = new SseChannel();\n        // Prevent done from running twice\n        var timeout = Math.floor(Math.random() * 2000) + 1000;\n        var params = {\n            id: timeout,\n            data: 'testing instantly'\n        };\n\n        if (event === 'CLOSE') {\n            params.id = event;\n        } else {\n            params.event = event ? event : 'message';\n        }\n\n        setInterval(function broadcast() {\n            channel.send(params);\n        }, timeout);\n\n        server = http.createServer(function(req, res) {\n            if (req.url.indexOf('/channel/test') === 0) {\n                channel.addClient(req, res);\n            } else {\n                res.writeHead(404);\n                res.end();\n            }\n        }).listen(port, ip);\n    }\n\n    afterEach(function(done) {\n        if (server) {\n            server.close();\n        }\n\n        if (es) {\n            es.close();\n        }\n\n        done();\n    });\n\n    it('should connect to the channel and recieve data', function(done) {\n        startServer();\n\n        es = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource\n        });\n\n        es.on('message', function getMessage(msg) {\n            assert.equal(msg.data, 'testing instantly');\n\n            done();\n        });\n\n        es.listen();\n    });\n\n    it('should connect to the channel and recieve data from custom event', function(done) {\n        startServer('custom-event');\n\n        es = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource\n        });\n\n        es.on('custom-event', function getMessage(msg) {\n            assert.equal(msg.data, 'testing instantly');\n\n            done();\n        });\n\n        es.listen();\n    });\n\n    it('should run open callback when a connection is open', function(done) {\n        startServer();\n\n        es = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource,\n            open: function() {\n                assert.equal('should run', 'should run');\n\n                done();\n            }\n        });\n\n        es.listen();\n    });\n\n    it('should run error callback when an error occur', function(done) {\n        startServer();\n\n        es = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource,\n            error: function() {\n                assert.equal('should run', 'should run');\n\n                done();\n            }\n        });\n\n        es.listen();\n\n        es.error();\n    });\n\n    it('should close the connection when an error occur', function(done) {\n        startServer();\n\n        var isClosed = true;\n\n        es = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource,\n            close: function() {\n                assert.equal('should run', 'should run');\n\n                if (isClosed) {\n                    isClosed = false;\n\n                    done();\n                }\n            }\n        });\n\n        es.listen();\n\n        es.close();\n    });\n\n    it('should throw TypeError exception if channel is not set', function(done) {\n        assert.throws(function() {\n            es = new Instantly();\n        }, /You need to provide a channel we can listen to!/);\n\n        done();\n    });\n\n    it('should throw TypeError exception if event is not a string', function() {\n        startServer();\n\n        var instantly = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource\n        });\n\n        assert.throws(function() {\n            instantly.on(null, function() {});\n        }, /Event is not a string/);\n\n        assert.throws(function() {\n            instantly.on({}, function() {});\n        }, /Event is not a string/);\n\n        assert.throws(function() {\n            instantly.on(undefined, function() {});\n        }, /Event is not a string/);\n\n        assert.throws(function() {\n            instantly.on(12312, function() {});\n        }, /Event is not a string/);\n    });\n\n    it('should throw TypeError exception if callback is not a function', function() {\n        startServer();\n\n        var instantly = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource\n        });\n\n        assert.throws(function() {\n            instantly.on('event');\n        }, /Callback is not a function/);\n\n        assert.throws(function() {\n            instantly.on('event', 'string');\n        }, /Callback is not a function/);\n\n        assert.throws(function() {\n            instantly.on('event', {});\n        }, /Callback is not a function/);\n    });\n\n    it('should close the connection if an id \"CLOSE\" is sent by server', function(done) {\n        startServer('CLOSE');\n\n        var isClosed = true;\n\n        es = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource,\n            close: function() {\n                assert.equal('closing', 'closing');\n\n                if (isClosed) {\n                    isClosed = false;\n\n                    done();\n                }\n            }\n        });\n\n        es.on('message', function() {});\n\n        es.listen();\n    });\n\n    it('should generate event callback', function(done) {\n        startServer('test');\n\n        es = new Instantly(endpoint, {\n            injectEventSourceNode: EventSource\n        });\n\n        es.listen();\n\n        es.on('test', function() {\n            assert.equal('generate callback', 'generate callback');\n\n            done();\n        });\n\n        es.generateCallback('test');\n    });\n});\n",
                "subject": "test genereate callbacks",
                "message": "test genereate callbacks\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "bjarneo/instantly,bjarneo/instantly"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10228,
            "row": {
                "commit": "8a412b8826dc4b8fd2fb84c60a7a22a5316f07c8",
                "old_file": "chrome/browser/resources/options/personal_options.js",
                "new_file": "chrome/browser/resources/options/personal_options.js",
                "old_contents": "// Copyright (c) 2011 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\ncr.define('options', function() {\n\n  var OptionsPage = options.OptionsPage;\n  var ArrayDataModel = cr.ui.ArrayDataModel;\n\n  // State variables.\n  var syncEnabled = false;\n  var syncSetupCompleted = false;\n\n  /**\n   * Encapsulated handling of personal options page.\n   * @constructor\n   */\n  function PersonalOptions() {\n    OptionsPage.call(this, 'personal',\n                     templateData.personalPageTabTitle,\n                     'personal-page');\n    if (cr.isChromeOS) {\n      // Email of the currently logged in user (or |kGuestUser|).\n      this.userEmail_ = localStrings.getString('userEmail');\n    }\n  }\n\n  cr.addSingletonGetter(PersonalOptions);\n\n  PersonalOptions.prototype = {\n    // Inherit PersonalOptions from OptionsPage.\n    __proto__: options.OptionsPage.prototype,\n\n    // Initialize PersonalOptions page.\n    initializePage: function() {\n      // Call base class implementation to start preference initialization.\n      OptionsPage.prototype.initializePage.call(this);\n\n      var self = this;\n\n      // Sync.\n      $('sync-action-link').onclick = function(event) {\n        SyncSetupOverlay.showErrorUI();\n      };\n      $('start-stop-sync').onclick = function(event) {\n        if (self.syncSetupCompleted)\n          SyncSetupOverlay.showStopSyncingUI();\n        else\n          SyncSetupOverlay.showSetupUI();\n      };\n      $('customize-sync').onclick = function(event) {\n        SyncSetupOverlay.showSetupUI();\n      };\n\n      // Profiles.\n      var profilesList = $('profiles-list');\n      options.personal_options.ProfileList.decorate(profilesList);\n      profilesList.autoExpands = true;\n\n      profilesList.onchange = self.setProfileViewButtonsStatus_;\n      $('profiles-create').onclick = function(event) {\n        chrome.send('createProfile');\n      };\n      $('profiles-manage').onclick = function(event) {\n        var selectedProfile = self.getSelectedProfileItem_();\n        if (selectedProfile)\n          ManageProfileOverlay.showManageDialog(selectedProfile);\n      };\n      $('profiles-delete').onclick = function(event) {\n        var selectedProfile = self.getSelectedProfileItem_();\n        if (selectedProfile)\n          ManageProfileOverlay.showDeleteDialog(selectedProfile);\n      };\n\n      // Passwords.\n      $('manage-passwords').onclick = function(event) {\n        OptionsPage.navigateToPage('passwords');\n        OptionsPage.showTab($('passwords-nav-tab'));\n        chrome.send('coreOptionsUserMetricsAction',\n            ['Options_ShowPasswordManager']);\n      };\n\n      // Autofill.\n      $('autofill-settings').onclick = function(event) {\n        OptionsPage.navigateToPage('autofill');\n        chrome.send('coreOptionsUserMetricsAction',\n            ['Options_ShowAutofillSettings']);\n      };\n      if (cr.isChromeOS && cr.commandLine.options['--bwsi']) {\n        // Hide Autofill options for the guest user.\n        $('autofill-section').hidden = true;\n      }\n\n      // Appearance.\n      $('themes-reset').onclick = function(event) {\n        chrome.send('themesReset');\n      };\n\n      if (!cr.isChromeOS) {\n        $('import-data').onclick = function(event) {\n          // Make sure that any previous import success message is hidden, and\n          // we're showing the UI to import further data.\n          $('import-data-configure').hidden = false;\n          $('import-data-success').hidden = true;\n          OptionsPage.navigateToPage('importData');\n          chrome.send('coreOptionsUserMetricsAction', ['Import_ShowDlg']);\n        };\n\n        if ($('themes-GTK-button')) {\n          $('themes-GTK-button').onclick = function(event) {\n            chrome.send('themesSetGTK');\n          };\n        }\n      } else {\n        $('change-picture-button').onclick = function(event) {\n          OptionsPage.navigateToPage('changePicture');\n        };\n        this.updateAccountPicture_();\n\n        if (cr.commandLine.options['--bwsi']) {\n          // Disable the screen lock checkbox and change-picture-button in\n          // guest mode.\n          $('enable-screen-lock').disabled = true;\n          $('change-picture-button').disabled = true;\n        }\n      }\n\n      if (PersonalOptions.disablePasswordManagement()) {\n        // Disable the Password Manager in guest mode.\n        $('passwords-offersave').disabled = true;\n        $('passwords-neversave').disabled = true;\n        $('passwords-offersave').value = false;\n        $('passwords-neversave').value = true;\n        $('manage-passwords').disabled = true;\n      }\n\n      if (PersonalOptions.disableAutofillManagement()) {\n        $('autofill-settings').disabled = true;\n\n        // Disable and turn off autofill.\n        var autofillEnabled = $('autofill-enabled');\n        autofillEnabled.disabled = true;\n        autofillEnabled.checked = false;\n        cr.dispatchSimpleEvent(autofillEnabled, 'change');\n      }\n    },\n\n    setSyncEnabled_: function(enabled) {\n      this.syncEnabled = enabled;\n    },\n\n    setAutoLoginVisible_ : function(visible) {\n      $('enable-auto-login-checkbox').hidden = !visible;\n    },\n\n    setSyncSetupCompleted_: function(completed) {\n      this.syncSetupCompleted = completed;\n      $('customize-sync').hidden = !completed;\n    },\n\n    setSyncStatus_: function(status) {\n      var statusSet = status != '';\n      $('sync-overview').hidden = statusSet;\n      $('sync-status').hidden = !statusSet;\n      $('sync-status-text').innerHTML = status;\n    },\n\n    setSyncStatusErrorVisible_: function(visible) {\n      visible ? $('sync-status').classList.add('sync-error') :\n                $('sync-status').classList.remove('sync-error');\n    },\n\n    setCustomizeSyncButtonEnabled_: function(enabled) {\n      $('customize-sync').disabled = !enabled;\n    },\n\n    setSyncActionLinkEnabled_: function(enabled) {\n      $('sync-action-link').disabled = !enabled;\n    },\n\n    setSyncActionLinkLabel_: function(status) {\n      $('sync-action-link').textContent = status;\n\n      // link-button does is not zero-area when the contents of the button are\n      // empty, so explicitly hide the element.\n      $('sync-action-link').hidden = !status.length;\n    },\n\n    /**\n     * Display or hide the profiles section of the page. This is used for\n     * multi-profile settings.\n     * @param {boolean} visible True to show the section.\n     * @private\n     */\n    setProfilesSectionVisible_: function(visible) {\n      $('profiles-section').hidden = !visible;\n    },\n\n    /**\n     * Get the selected profile item from the profile list. This also works\n     * correctly if the list is not displayed.\n     * @return {Object} the profile item object, or null if nothing is selected.\n     * @private\n     */\n    getSelectedProfileItem_: function() {\n      var profilesList = $('profiles-list');\n      if (profilesList.hidden) {\n        if (profilesList.dataModel.length > 0)\n          return profilesList.dataModel.item(0);\n      } else {\n        return profilesList.selectedItem;\n      }\n      return null;\n    },\n\n    /**\n     * Helper function to set the status of profile view buttons to disabled or\n     * enabled, depending on the number of profiles and selection status of the\n     * profiles list.\n     */\n    setProfileViewButtonsStatus_: function() {\n      var profilesList = $('profiles-list');\n      var selectedProfile = profilesList.selectedItem;\n      var hasSelection = selectedProfile != null;\n      var hasSingleProfile = profilesList.dataModel.length == 1;\n      $('profiles-manage').disabled = !hasSelection;\n      $('profiles-delete').disabled = !hasSelection || hasSingleProfile;\n    },\n\n    /**\n     * Display the correct dialog layout, depending on how many profiles are\n     * available.\n     * @param {number} numProfiles The number of profiles to display.\n     */\n    setProfileViewSingle_: function(numProfiles) {\n      var hasSingleProfile = numProfiles == 1;\n      $('profiles-list').hidden = hasSingleProfile;\n      $('profiles-single-message').hidden = !hasSingleProfile;\n      $('profiles-manage').hidden = hasSingleProfile;\n      $('profiles-delete').textContent = hasSingleProfile ?\n          templateData.profilesDeleteSingle :\n          templateData.profilesDelete;\n    },\n\n    /**\n     * Adds all |profiles| to the list.\n     * @param {Array.<Object>} An array of profile info objects.\n     *     each object is of the form:\n     *       profileInfo = {\n     *         name: \"Profile Name\",\n     *         iconURL: \"chrome://path/to/icon/image\",\n     *         filePath: \"/path/to/profile/data/on/disk\",\n     *         isCurrentProfile: false\n     *       };\n     */\n    setProfilesInfo_: function(profiles) {\n      this.setProfileViewSingle_(profiles.length);\n      // add it to the list, even if the list is hidden so we can access it\n      // later.\n      $('profiles-list').dataModel = new ArrayDataModel(profiles);\n      this.setProfileViewButtonsStatus_();\n    },\n\n    setStartStopButtonVisible_: function(visible) {\n      $('start-stop-sync').hidden = !visible;\n    },\n\n    setStartStopButtonEnabled_: function(enabled) {\n      $('start-stop-sync').disabled = !enabled;\n    },\n\n    setStartStopButtonLabel_: function(label) {\n      $('start-stop-sync').textContent = label;\n    },\n\n    setGtkThemeButtonEnabled_: function(enabled) {\n      if (!cr.isChromeOS && navigator.platform.match(/linux|BSD/i)) {\n        $('themes-GTK-button').disabled = !enabled;\n      }\n    },\n\n    setThemesResetButtonEnabled_: function(enabled) {\n      $('themes-reset').disabled = !enabled;\n    },\n\n    hideSyncSection_: function() {\n      $('sync-section').hidden = true;\n    },\n\n    /**\n     * (Re)loads IMG element with current user account picture.\n     */\n    updateAccountPicture_: function() {\n      $('account-picture').src =\n          'chrome://userimage/' + this.userEmail_ +\n          '?id=' + (new Date()).getTime();\n    },\n  };\n\n  /**\n   * Returns whether the user should be able to manage (view and edit) their\n   * stored passwords. Password management is disabled in guest mode.\n   * @return {boolean} True if password management should be disabled.\n   */\n  PersonalOptions.disablePasswordManagement = function() {\n    return cr.commandLine.options['--bwsi'];\n  };\n\n  /**\n   * Returns whether the user should be able to manage autofill settings.\n   * @return {boolean} True if password management should be disabled.\n   */\n  PersonalOptions.disableAutofillManagement = function() {\n    return cr.commandLine.options['--bwsi'];\n  };\n\n  if (cr.isChromeOS) {\n    /**\n     * Returns email of the user logged in (ChromeOS only).\n     * @return {string} user email.\n     */\n    PersonalOptions.getLoggedInUserEmail = function() {\n      return PersonalOptions.getInstance().userEmail_;\n    };\n  }\n\n  // Forward public APIs to private implementations.\n  [\n    'hideSyncSection',\n    'setAutoLoginVisible',\n    'setCustomizeSyncButtonEnabled',\n    'setGtkThemeButtonEnabled',\n    'setProfilesInfo',\n    'setProfilesSectionVisible',\n    'setStartStopButtonEnabled',\n    'setStartStopButtonLabel',\n    'setStartStopButtonVisible',\n    'setSyncActionLinkEnabled',\n    'setSyncActionLinkLabel',\n    'setSyncEnabled',\n    'setSyncSetupCompleted',\n    'setSyncStatus',\n    'setSyncStatusErrorVisible',\n    'setThemesResetButtonEnabled',\n    'updateAccountPicture',\n  ].forEach(function(name) {\n    PersonalOptions[name] = function(value) {\n      PersonalOptions.getInstance()[name + '_'](value);\n    };\n  });\n\n  // Export\n  return {\n    PersonalOptions: PersonalOptions\n  };\n\n});\n",
                "new_contents": "// Copyright (c) 2011 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\ncr.define('options', function() {\n\n  var OptionsPage = options.OptionsPage;\n  var ArrayDataModel = cr.ui.ArrayDataModel;\n\n  // State variables.\n  var syncEnabled = false;\n  var syncSetupCompleted = false;\n\n  /**\n   * Encapsulated handling of personal options page.\n   * @constructor\n   */\n  function PersonalOptions() {\n    OptionsPage.call(this, 'personal',\n                     templateData.personalPageTabTitle,\n                     'personal-page');\n    if (cr.isChromeOS) {\n      // Email of the currently logged in user (or |kGuestUser|).\n      this.userEmail_ = localStrings.getString('userEmail');\n    }\n  }\n\n  cr.addSingletonGetter(PersonalOptions);\n\n  PersonalOptions.prototype = {\n    // Inherit PersonalOptions from OptionsPage.\n    __proto__: options.OptionsPage.prototype,\n\n    // Initialize PersonalOptions page.\n    initializePage: function() {\n      // Call base class implementation to start preference initialization.\n      OptionsPage.prototype.initializePage.call(this);\n\n      var self = this;\n\n      // Sync.\n      $('sync-action-link').onclick = function(event) {\n        SyncSetupOverlay.showErrorUI();\n      };\n      $('start-stop-sync').onclick = function(event) {\n        if (self.syncSetupCompleted)\n          SyncSetupOverlay.showStopSyncingUI();\n        else\n          SyncSetupOverlay.showSetupUI();\n      };\n      $('customize-sync').onclick = function(event) {\n        SyncSetupOverlay.showSetupUI();\n      };\n\n      // Profiles.\n      var profilesList = $('profiles-list');\n      options.personal_options.ProfileList.decorate(profilesList);\n      profilesList.autoExpands = true;\n\n      profilesList.onchange = self.setProfileViewButtonsStatus_;\n      $('profiles-create').onclick = function(event) {\n        chrome.send('createProfile');\n      };\n      $('profiles-manage').onclick = function(event) {\n        var selectedProfile = self.getSelectedProfileItem_();\n        if (selectedProfile)\n          ManageProfileOverlay.showManageDialog(selectedProfile);\n      };\n      $('profiles-delete').onclick = function(event) {\n        var selectedProfile = self.getSelectedProfileItem_();\n        if (selectedProfile)\n          ManageProfileOverlay.showDeleteDialog(selectedProfile);\n      };\n\n      // Passwords.\n      $('manage-passwords').onclick = function(event) {\n        OptionsPage.navigateToPage('passwords');\n        OptionsPage.showTab($('passwords-nav-tab'));\n        chrome.send('coreOptionsUserMetricsAction',\n            ['Options_ShowPasswordManager']);\n      };\n\n      // Autofill.\n      $('autofill-settings').onclick = function(event) {\n        OptionsPage.navigateToPage('autofill');\n        chrome.send('coreOptionsUserMetricsAction',\n            ['Options_ShowAutofillSettings']);\n      };\n      if (cr.isChromeOS && cr.commandLine.options['--bwsi']) {\n        // Hide Autofill options for the guest user.\n        $('autofill-section').hidden = true;\n      }\n\n      // Appearance.\n      $('themes-reset').onclick = function(event) {\n        chrome.send('themesReset');\n      };\n\n      if (!cr.isChromeOS) {\n        $('import-data').onclick = function(event) {\n          // Make sure that any previous import success message is hidden, and\n          // we're showing the UI to import further data.\n          $('import-data-configure').hidden = false;\n          $('import-data-success').hidden = true;\n          OptionsPage.navigateToPage('importData');\n          chrome.send('coreOptionsUserMetricsAction', ['Import_ShowDlg']);\n        };\n\n        if ($('themes-GTK-button')) {\n          $('themes-GTK-button').onclick = function(event) {\n            chrome.send('themesSetGTK');\n          };\n        }\n      } else {\n        $('change-picture-button').onclick = function(event) {\n          OptionsPage.navigateToPage('changePicture');\n        };\n        this.updateAccountPicture_();\n\n        if (cr.commandLine.options['--bwsi']) {\n          // Disable the screen lock checkbox and change-picture-button in\n          // guest mode.\n          $('enable-screen-lock').disabled = true;\n          $('change-picture-button').disabled = true;\n        }\n      }\n\n      if (PersonalOptions.disablePasswordManagement()) {\n        // Disable the Password Manager in guest mode.\n        $('passwords-offersave').disabled = true;\n        $('passwords-neversave').disabled = true;\n        $('passwords-offersave').value = false;\n        $('passwords-neversave').value = true;\n        $('manage-passwords').disabled = true;\n      }\n\n      if (PersonalOptions.disableAutofillManagement()) {\n        $('autofill-settings').disabled = true;\n\n        // Disable and turn off autofill.\n        var autofillEnabled = $('autofill-enabled');\n        autofillEnabled.disabled = true;\n        autofillEnabled.checked = false;\n        cr.dispatchSimpleEvent(autofillEnabled, 'change');\n      }\n    },\n\n    setSyncEnabled_: function(enabled) {\n      this.syncEnabled = enabled;\n    },\n\n    setAutoLoginVisible_ : function(visible) {\n      $('enable-auto-login-checkbox').hidden = !visible;\n    },\n\n    setSyncSetupCompleted_: function(completed) {\n      this.syncSetupCompleted = completed;\n      $('customize-sync').hidden = !completed;\n    },\n\n    setSyncStatus_: function(status) {\n      var statusSet = status != '';\n      $('sync-overview').hidden = statusSet;\n      $('sync-status').hidden = !statusSet;\n      $('sync-status-text').innerHTML = status;\n    },\n\n    setSyncStatusErrorVisible_: function(visible) {\n      visible ? $('sync-status').classList.add('sync-error') :\n                $('sync-status').classList.remove('sync-error');\n    },\n\n    setCustomizeSyncButtonEnabled_: function(enabled) {\n      $('customize-sync').disabled = !enabled;\n    },\n\n    setSyncActionLinkEnabled_: function(enabled) {\n      $('sync-action-link').disabled = !enabled;\n    },\n\n    setSyncActionLinkLabel_: function(status) {\n      $('sync-action-link').textContent = status;\n\n      // link-button does is not zero-area when the contents of the button are\n      // empty, so explicitly hide the element.\n      $('sync-action-link').hidden = !status.length;\n    },\n\n    /**\n     * Display or hide the profiles section of the page. This is used for\n     * multi-profile settings.\n     * @param {boolean} visible True to show the section.\n     * @private\n     */\n    setProfilesSectionVisible_: function(visible) {\n      $('profiles-section').hidden = !visible;\n    },\n\n    /**\n     * Get the selected profile item from the profile list. This also works\n     * correctly if the list is not displayed.\n     * @return {Object} the profile item object, or null if nothing is selected.\n     * @private\n     */\n    getSelectedProfileItem_: function() {\n      var profilesList = $('profiles-list');\n      if (profilesList.hidden) {\n        if (profilesList.dataModel.length > 0)\n          return profilesList.dataModel.item(0);\n      } else {\n        return profilesList.selectedItem;\n      }\n      return null;\n    },\n\n    /**\n     * Helper function to set the status of profile view buttons to disabled or\n     * enabled, depending on the number of profiles and selection status of the\n     * profiles list.\n     */\n    setProfileViewButtonsStatus_: function() {\n      var profilesList = $('profiles-list');\n      var selectedProfile = profilesList.selectedItem;\n      var hasSelection = selectedProfile != null;\n      var hasSingleProfile = profilesList.dataModel.length == 1;\n      $('profiles-manage').disabled = !hasSelection ||\n          !selectedProfile.isCurrentProfile;\n      $('profiles-delete').disabled = !hasSelection || hasSingleProfile;\n    },\n\n    /**\n     * Display the correct dialog layout, depending on how many profiles are\n     * available.\n     * @param {number} numProfiles The number of profiles to display.\n     */\n    setProfileViewSingle_: function(numProfiles) {\n      var hasSingleProfile = numProfiles == 1;\n      $('profiles-list').hidden = hasSingleProfile;\n      $('profiles-single-message').hidden = !hasSingleProfile;\n      $('profiles-manage').hidden = hasSingleProfile;\n      $('profiles-delete').textContent = hasSingleProfile ?\n          templateData.profilesDeleteSingle :\n          templateData.profilesDelete;\n    },\n\n    /**\n     * Adds all |profiles| to the list.\n     * @param {Array.<Object>} An array of profile info objects.\n     *     each object is of the form:\n     *       profileInfo = {\n     *         name: \"Profile Name\",\n     *         iconURL: \"chrome://path/to/icon/image\",\n     *         filePath: \"/path/to/profile/data/on/disk\",\n     *         isCurrentProfile: false\n     *       };\n     */\n    setProfilesInfo_: function(profiles) {\n      this.setProfileViewSingle_(profiles.length);\n      // add it to the list, even if the list is hidden so we can access it\n      // later.\n      $('profiles-list').dataModel = new ArrayDataModel(profiles);\n      this.setProfileViewButtonsStatus_();\n    },\n\n    setStartStopButtonVisible_: function(visible) {\n      $('start-stop-sync').hidden = !visible;\n    },\n\n    setStartStopButtonEnabled_: function(enabled) {\n      $('start-stop-sync').disabled = !enabled;\n    },\n\n    setStartStopButtonLabel_: function(label) {\n      $('start-stop-sync').textContent = label;\n    },\n\n    setGtkThemeButtonEnabled_: function(enabled) {\n      if (!cr.isChromeOS && navigator.platform.match(/linux|BSD/i)) {\n        $('themes-GTK-button').disabled = !enabled;\n      }\n    },\n\n    setThemesResetButtonEnabled_: function(enabled) {\n      $('themes-reset').disabled = !enabled;\n    },\n\n    hideSyncSection_: function() {\n      $('sync-section').hidden = true;\n    },\n\n    /**\n     * (Re)loads IMG element with current user account picture.\n     */\n    updateAccountPicture_: function() {\n      $('account-picture').src =\n          'chrome://userimage/' + this.userEmail_ +\n          '?id=' + (new Date()).getTime();\n    },\n  };\n\n  /**\n   * Returns whether the user should be able to manage (view and edit) their\n   * stored passwords. Password management is disabled in guest mode.\n   * @return {boolean} True if password management should be disabled.\n   */\n  PersonalOptions.disablePasswordManagement = function() {\n    return cr.commandLine.options['--bwsi'];\n  };\n\n  /**\n   * Returns whether the user should be able to manage autofill settings.\n   * @return {boolean} True if password management should be disabled.\n   */\n  PersonalOptions.disableAutofillManagement = function() {\n    return cr.commandLine.options['--bwsi'];\n  };\n\n  if (cr.isChromeOS) {\n    /**\n     * Returns email of the user logged in (ChromeOS only).\n     * @return {string} user email.\n     */\n    PersonalOptions.getLoggedInUserEmail = function() {\n      return PersonalOptions.getInstance().userEmail_;\n    };\n  }\n\n  // Forward public APIs to private implementations.\n  [\n    'hideSyncSection',\n    'setAutoLoginVisible',\n    'setCustomizeSyncButtonEnabled',\n    'setGtkThemeButtonEnabled',\n    'setProfilesInfo',\n    'setProfilesSectionVisible',\n    'setStartStopButtonEnabled',\n    'setStartStopButtonLabel',\n    'setStartStopButtonVisible',\n    'setSyncActionLinkEnabled',\n    'setSyncActionLinkLabel',\n    'setSyncEnabled',\n    'setSyncSetupCompleted',\n    'setSyncStatus',\n    'setSyncStatusErrorVisible',\n    'setThemesResetButtonEnabled',\n    'updateAccountPicture',\n  ].forEach(function(name) {\n    PersonalOptions[name] = function(value) {\n      PersonalOptions.getInstance()[name + '_'](value);\n    };\n  });\n\n  // Export\n  return {\n    PersonalOptions: PersonalOptions\n  };\n\n});\n",
                "subject": "Options: Fix to enable Edit button only when the current profile is selected. Prevents a profile from editing the avatar and profile name of another profile in the Personal Options page. These changes got overwritten due to revision 107894. Bringing them back.",
                "message": "Options: Fix to enable Edit button only when the current profile is selected. Prevents a profile from editing the avatar and profile name of another profile in the Personal Options page. These changes got overwritten due to revision 107894. Bringing them back.\n\n\nBUG=87658\nTEST=NONE\n\n\nReview URL: http://codereview.chromium.org/8341139\n\ngit-svn-id: de016e52bd170d2d4f2344f9bf92d50478b649e0@107901 0039d316-1c4b-4281-b951-d872f2087c98\n",
                "lang": "JavaScript",
                "license": "bsd-3-clause",
                "repos": "gavinp/chromium,adobe/chromium,yitian134/chromium,ropik/chromium,ropik/chromium,yitian134/chromium,ropik/chromium,ropik/chromium,yitian134/chromium,ropik/chromium,gavinp/chromium,ropik/chromium,yitian134/chromium,gavinp/chromium,adobe/chromium,gavinp/chromium,adobe/chromium,adobe/chromium,adobe/chromium,adobe/chromium,yitian134/chromium,yitian134/chromium,gavinp/chromium,adobe/chromium,adobe/chromium,yitian134/chromium,adobe/chromium,gavinp/chromium,ropik/chromium,ropik/chromium,yitian134/chromium,gavinp/chromium,gavinp/chromium,adobe/chromium,adobe/chromium,ropik/chromium,yitian134/chromium,gavinp/chromium,gavinp/chromium,yitian134/chromium"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10229,
            "row": {
                "commit": "4032acffd74785aed41af4a73c9aa4fc82572343",
                "old_file": "jquery.shapeshift.js",
                "new_file": "jquery.shapeshift.js",
                "old_contents": ";(function($,window,undefined) {\n  var pluginName = 'shapeshift',\n      document = window.document,\n      defaults = {\n        // Features\n        centerGrid: true,\n        enableAnimation: true,\n        enableAutoHeight: true,\n        enableDrag: true,\n        enableDragAnimation: true,\n        enableDrop: true,\n        enableResize: true,\n\n        // Options\n        childWidth: null,\n        columns: null,\n        dragBlacklist: null,\n        dropWhitelist: \"*\",\n        gutterX: 10,\n        gutterY: 10,\n        paddingY: 0,\n        paddingX: 0,\n        selector: \"\",\n      };\n\n  function Plugin(element, options) {\n    var ss = this;\n    ss.element = element;\n    ss.container = $(element);\n    ss.options = $.extend({}, defaults, options);\n    ss.hoverObjPositions = [];\n    ss.init();\n  }\n\n  Plugin.prototype.init = function() {\n    var ss = this,\n        options = ss.options;\n\n    // The initial shapeshift\n    ss.shiftit(ss.container, options.enableAnimation);\n\n    // Enable features\n    if(options.enableDrag || options.enableDrop) { ss.draggable(); }\n    if(options.enableResize) { ss.resizable(); }\n  };\n\n  Plugin.prototype.shiftit = function($container, animated) {\n    var ss = this,\n        options = ss.options,\n        $objects = $container.children(options.selector).filter(':visible');\n\n    // Calculate the positions for each element\n    positions = ss.getObjectPositions($container, ':visible');\n\n    // Animate / Move each object into place\n    for(var obj_i=0; obj_i < $objects.length; obj_i++) {\n      var $obj = $($objects[obj_i]),\n          attributes = positions[obj_i];\n\n      // Never animate the currently dragged item\n      if(!$obj.hasClass(\"ss-moving\")) {\n        if(animated) {\n          $obj.stop(true, false).animate(attributes, 250);\n        } else {\n          $obj.css(attributes);\n        }\n      }\n    }\n\n    // Set the container height to match the tallest column\n    $container.css(\"height\", options.containerHeight);\n  }\n\n  Plugin.prototype.draggable = function () {\n    var ss = this,\n        options = ss.options,\n        $container = $currentContainer = $previousContainer = ss.container,\n        $objects = $container.children(options.selector),\n        $selected = null,\n        dragging = false;\n\n    // Initialize the jQuery UI Draggable or destroy current instances\n    if(options.enableDrag) {\n      $objects.filter(options.dropWhitelist).filter(\":not(\"+options.dragBlacklist+\")\").draggable({\n        addClasses: false,\n        containment: 'document',\n        revert: true,\n        zIndex: 9999,\n        start: function() { dragStart($(this)); },\n        drag: function(e, ui) { dragObject(e, ui); }\n      });\n    } else { $objects.draggable('destroy'); }\n\n    // Initialize the jQuery UI Droppable or destroy current instances\n    if(options.enableDrop) {\n      $container.droppable({\n        accept: options.dropWhitelist,\n        over: function(e) { dragOver(e); },\n        drop: function() { dropObject(); }\n      });\n    } else { $container.droppable('destroy'); }\n\n    // When an object is picked up\n    function dragStart($object) {\n      $selected = $object.addClass(\"ss-moving\");\n      ss.shiftit($container, options.enableDragAnimation);\n    }\n\n    // When an object is dragged around\n    function dragObject(e, ui) {\n      if(!dragging) {\n        dragging = true;\n        $objects = $currentContainer.children(options.selector).filter(':visible');\n\n        // Determine where the intended index position of the object is\n        var intendedIndex = ss.getIntendedIndex($selected, e),\n            $intendedObj = $($objects.not(\".ss-moving\").get(intendedIndex));\n        $previousContainer = $selected.parent();\n\n        // Insert the object into that index position\n        $selected.insertBefore($intendedObj);\n\n        // Reshift the new container / old container\n        ss.shiftit($currentContainer, options.enableDragAnimation);\n        if($currentContainer[0] != $previousContainer[0]) {\n          ss.shiftit($previousContainer, options.enableDragAnimation);\n        }\n\n        // Prevent it from firing too much\n        window.setTimeout(function() {\n          dragging = false;\n        }, 200);\n      }\n\n      // Manually override the elements position\n      ui.position.left = e.pageX - $(e.target).parent().offset().left - (options.childWidth / 2);\n      ui.position.top = e.pageY - $(e.target).parent().offset().top - ($selected.outerHeight() / 2);\n    }\n\n    // When an object is dropped\n    function dropObject() {\n      $selected = $(\".ss-moving\").removeClass(\"ss-moving\");\n      ss.shiftit($currentContainer, options.animateOnDrag);\n      $currentContainer.trigger(\"shapeshifted\", $selected);\n    }\n\n    // When an object moves to a new container\n    function dragOver(e) {\n      $currentContainer = $(e.target);\n      ss.setHoverObjPositions($currentContainer);\n    }\n  }\n\n  Plugin.prototype.getIntendedIndex = function($selected, e) {\n    var ss = this,\n        options = ss.options,\n        $container = $selected.parent(),\n        selectedX = $selected.position().left + (options.childWidth / 2),\n        selectedY = $selected.position().top + ($selected.outerHeight() / 2),\n        shortestDistance = 9999,\n        chosenIndex = 0;\n\n    // Get the grid based on all the elements except\n    // the currently dragged element\n    ss.setHoverObjPositions($container);\n\n    // Go over all of those positions and figure out\n    // which is the closest to the cursor.\n    for(hov_i=0;hov_i<ss.hoverObjPositions.length;hov_i++) {\n      attributes = ss.hoverObjPositions[hov_i];\n      if(selectedX > attributes.left && selectedY > attributes.top) {\n        xDist = selectedX - attributes.left;\n        yDist = selectedY - attributes.top;\n        distance = Math.sqrt((xDist * xDist) + (yDist * yDist));\n        if(distance < shortestDistance) {\n          shortestDistance = distance;\n          chosenIndex = hov_i;\n        }\n      }\n    }\n    return chosenIndex;\n  }\n\n  Plugin.prototype.setHoverObjPositions = function($container) {\n    this.hoverObjPositions = this.getObjectPositions($container, ':not(.ss-moving):visible');\n  }\n\n  Plugin.prototype.getObjectPositions = function ($container, filter) {\n    var options = this.options,\n        $objects = $container.children(options.selector).filter(filter),\n        columns = options.columns,\n        colHeights = [],\n        colWidth = null,\n        gridOffset = options.paddingX,\n        positions = [];\n\n    // Determine the width of each element.\n    if(!options.childWidth) { options.childWidth = $objects.first().outerWidth(true); }\n\n    // Determine the column width.\n    colWidth = options.childWidth + options.gutterX;\n\n    // Determine how many columns are currently active\n    if(!columns) { columns = Math.floor($container.innerWidth() / colWidth); }\n\n    // Offset the grid to center it.\n    if(options.centerGrid) {\n      gridOffset = Math.floor((($container.innerWidth() / colWidth) % 1 * colWidth) / 2);\n    }\n\n    // Create an array element for each column, which is then\n    // used to store that columns current height.\n    for(var i=0;i<columns;i++) {colHeights.push(options.paddingY);}\n\n    // Loop over each element and determine what column it fits into\n    for(var obj_i=0;obj_i<$objects.length;obj_i++) {\n      var $obj = $($objects[obj_i]),\n          col = $.inArray(Math.min.apply(window,colHeights), colHeights),\n          height = $obj.outerHeight(true) + options.gutterY,\n          offsetX = (colWidth * col) + gridOffset,\n          offsetY = colHeights[col];\n\n      // Store the position to animate into place later\n      attributes = { left: offsetX, top: offsetY };\n      positions[obj_i] = attributes;\n\n      // Increase the calculated total height of the current column\n      colHeights[col] += height;\n    }\n    // Store the height of the tallest column\n    if(options.enableAutoHeight){\n      options.containerHeight = Math.max.apply(Math,colHeights);\n    }\n    return positions;\n  }\n\n  Plugin.prototype.resizable = function () {\n    var ss = this,\n        options = ss.options,\n        $container = ss.container,\n        resizing = false;\n\n    $(window).on(\"resize\", function() {\n      if(!resizing) {\n        resizing = true;\n        ss.shiftit($container, options.enableAnimation);\n        setTimeout(function() {\n          resizing = false;\n          ss.shiftit($container, options.enableAnimation);\n        }, 333);\n      }\n    });\n  }\n\n  // Prevent against multiple instantiations\n  $.fn[pluginName] = function (options) {\n    return this.each(function () {\n      $.data(this, 'plugin_' + pluginName, new Plugin(this, options));\n    });\n  }\n\n}(jQuery, window));",
                "new_contents": ";(function($,window,undefined) {\n  var pluginName = 'shapeshift',\n      document = window.document,\n      defaults = {\n        // Features\n        centerGrid: true,\n        enableAnimation: true,\n        enableAutoHeight: true,\n        enableDrag: true,\n        enableDragAnimation: true,\n        enableDrop: true,\n        enableResize: true,\n\n        // Options\n        childWidth: null,\n        columns: null,\n        dragBlacklist: null,\n        dropWhitelist: \"*\",\n        gutterX: 10,\n        gutterY: 10,\n        paddingY: 0,\n        paddingX: 0,\n        selector: \"\",\n      };\n\n  function Plugin(element, options) {\n    var ss = this;\n    ss.element = element;\n    ss.container = $(element);\n    ss.options = $.extend({}, defaults, options);\n    ss.hoverObjPositions = [];\n    ss.init();\n  }\n\n  Plugin.prototype.init = function() {\n    var ss = this,\n        options = ss.options;\n\n    // The initial shapeshift\n    ss.shiftit(ss.container, options.enableAnimation);\n\n    // Enable features\n    if(options.enableDrag || options.enableDrop) { ss.draggable(); }\n    if(options.enableResize) { ss.resizable(); }\n  };\n\n  Plugin.prototype.shiftit = function($container, animated) {\n    var ss = this,\n        options = ss.options,\n        $objects = $container.children(options.selector).filter(':visible');\n\n    // Calculate the positions for each element\n    positions = ss.getObjectPositions($container, ':visible');\n\n    // Animate / Move each object into place\n    for(var obj_i=0; obj_i < $objects.length; obj_i++) {\n      var $obj = $($objects[obj_i]),\n          attributes = positions[obj_i];\n\n      // Never animate the currently dragged item\n      if(!$obj.hasClass(\"ss-moving\")) {\n        if(animated) {\n          $obj.stop(true, false).animate(attributes, 250);\n        } else {\n          $obj.css(attributes);\n        }\n      }\n    }\n\n    // Set the container height to match the tallest column\n    $container.css(\"height\", options.containerHeight);\n  }\n\n  Plugin.prototype.draggable = function () {\n    var ss = this,\n        options = ss.options,\n        $container = $currentContainer = $previousContainer = ss.container,\n        $objects = $container.children(options.selector),\n        $selected = null,\n        dragging = false;\n\n    // Initialize the jQuery UI Draggable or destroy current instances\n    if(options.enableDrag) {\n      $objects.filter(options.dropWhitelist).filter(\":not(\"+options.dragBlacklist+\")\").draggable({\n        addClasses: false,\n        containment: 'document',\n        revert: true,\n        zIndex: 9999,\n        start: function() { dragStart($(this)); },\n        drag: function(e, ui) { dragObject(e, ui); }\n      });\n    } else { $objects.draggable('destroy'); }\n\n    // Initialize the jQuery UI Droppable or destroy current instances\n    if(options.enableDrop) {\n      $container.droppable({\n        accept: options.dropWhitelist,\n        over: function(e) { dragOver(e); },\n        drop: function() { dropObject(); }\n      });\n    } else { $container.droppable('destroy'); }\n\n    // When an object is picked up\n    function dragStart($object) {\n      $selected = $object.addClass(\"ss-moving\");\n      ss.shiftit($container, options.enableDragAnimation);\n    }\n\n    // When an object is dragged around\n    function dragObject(e, ui) {\n      notDroppable = ($container[0] == $currentContainer[0]) && !options.enableDrop;\n      if(!dragging && !notDroppable) {\n        dragging = true;\n        $objects = $currentContainer.children(options.selector).filter(':visible');\n\n        // Determine where the intended index position of the object is\n        var intendedIndex = ss.getIntendedIndex($selected, e),\n            $intendedObj = $($objects.not(\".ss-moving\").get(intendedIndex));\n        $previousContainer = $selected.parent();\n\n        // Insert the object into that index position\n        $selected.insertBefore($intendedObj);\n\n        // Reshift the new container / old container\n        ss.shiftit($currentContainer, options.enableDragAnimation);\n        if($currentContainer[0] != $previousContainer[0]) {\n          ss.shiftit($previousContainer, options.enableDragAnimation);\n        }\n\n        // Prevent it from firing too much\n        window.setTimeout(function() {\n          dragging = false;\n        }, 200);\n      }\n\n      // Manually override the elements position\n      ui.position.left = e.pageX - $(e.target).parent().offset().left - (options.childWidth / 2);\n      ui.position.top = e.pageY - $(e.target).parent().offset().top - ($selected.outerHeight() / 2);\n    }\n\n    // When an object is dropped\n    function dropObject() {\n      $selected = $(\".ss-moving\").removeClass(\"ss-moving\");\n      ss.shiftit($currentContainer, options.animateOnDrag);\n      $currentContainer.trigger(\"shapeshifted\", $selected);\n    }\n\n    // When an object moves to a new container\n    function dragOver(e) {\n      $currentContainer = $(e.target);\n      ss.setHoverObjPositions($currentContainer);\n    }\n  }\n\n  Plugin.prototype.getIntendedIndex = function($selected, e) {\n    var ss = this,\n        options = ss.options,\n        $container = $selected.parent(),\n        selectedX = $selected.position().left + (options.childWidth / 2),\n        selectedY = $selected.position().top + ($selected.outerHeight() / 2),\n        shortestDistance = 9999,\n        chosenIndex = 0;\n\n    // Get the grid based on all the elements except\n    // the currently dragged element\n    ss.setHoverObjPositions($container);\n\n    // Go over all of those positions and figure out\n    // which is the closest to the cursor.\n    for(hov_i=0;hov_i<ss.hoverObjPositions.length;hov_i++) {\n      attributes = ss.hoverObjPositions[hov_i];\n      if(selectedX > attributes.left && selectedY > attributes.top) {\n        xDist = selectedX - attributes.left;\n        yDist = selectedY - attributes.top;\n        distance = Math.sqrt((xDist * xDist) + (yDist * yDist));\n        if(distance < shortestDistance) {\n          shortestDistance = distance;\n          chosenIndex = hov_i;\n        }\n      }\n    }\n    return chosenIndex;\n  }\n\n  Plugin.prototype.setHoverObjPositions = function($container) {\n    this.hoverObjPositions = this.getObjectPositions($container, ':not(.ss-moving):visible');\n  }\n\n  Plugin.prototype.getObjectPositions = function ($container, filter) {\n    var options = this.options,\n        $objects = $container.children(options.selector).filter(filter),\n        columns = options.columns,\n        colHeights = [],\n        colWidth = null,\n        gridOffset = options.paddingX,\n        positions = [];\n\n    // Determine the width of each element.\n    if(!options.childWidth) { options.childWidth = $objects.first().outerWidth(true); }\n\n    // Determine the column width.\n    colWidth = options.childWidth + options.gutterX;\n\n    // Determine how many columns are currently active\n    if(!columns) { columns = Math.floor($container.innerWidth() / colWidth); }\n\n    // Offset the grid to center it.\n    if(options.centerGrid) {\n      gridOffset = Math.floor((($container.innerWidth() / colWidth) % 1 * colWidth) / 2);\n    }\n\n    // Create an array element for each column, which is then\n    // used to store that columns current height.\n    for(var i=0;i<columns;i++) {colHeights.push(options.paddingY);}\n\n    // Loop over each element and determine what column it fits into\n    for(var obj_i=0;obj_i<$objects.length;obj_i++) {\n      var $obj = $($objects[obj_i]),\n          col = $.inArray(Math.min.apply(window,colHeights), colHeights),\n          height = $obj.outerHeight(true) + options.gutterY,\n          offsetX = (colWidth * col) + gridOffset,\n          offsetY = colHeights[col];\n\n      // Store the position to animate into place later\n      attributes = { left: offsetX, top: offsetY };\n      positions[obj_i] = attributes;\n\n      // Increase the calculated total height of the current column\n      colHeights[col] += height;\n    }\n    // Store the height of the tallest column\n    if(options.enableAutoHeight){\n      options.containerHeight = Math.max.apply(Math,colHeights);\n    }\n    return positions;\n  }\n\n  Plugin.prototype.resizable = function () {\n    var ss = this,\n        options = ss.options,\n        $container = ss.container,\n        resizing = false;\n\n    $(window).on(\"resize\", function() {\n      if(!resizing) {\n        resizing = true;\n        ss.shiftit($container, options.enableAnimation);\n        setTimeout(function() {\n          resizing = false;\n          ss.shiftit($container, options.enableAnimation);\n        }, 333);\n      }\n    });\n  }\n\n  // Prevent against multiple instantiations\n  $.fn[pluginName] = function (options) {\n    return this.each(function () {\n      $.data(this, 'plugin_' + pluginName, new Plugin(this, options));\n    });\n  }\n\n}(jQuery, window));",
                "subject": "Prevent the current container from shifting its contents if drop is disabled",
                "message": "Prevent the current container from shifting its contents if drop is disabled\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "delboy1978uk/jquery.shapeshift,DanielGasperoni/jquery.shapeshift,JacobShirley95/jquery.shapeshift,RaghavRamesh/jquery.shapeshift,GerHobbelt/jquery.shapeshift"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10230,
            "row": {
                "commit": "1fbe145668f844c4c36403e6af8aafdc104f1097",
                "old_file": "sync.js",
                "new_file": "sync.js",
                "old_contents": "/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n/**\n * This file contains a simple synchronization method for JSON objects\n * based on the file synchronization algorithm presented by Norman\n * Ramsey and Elod Csirmaz in\n *\n *   An Algebraic Approach to File Synchronization\n *   <http://www.eecs.harvard.edu/~nr/pubs/sync-abstract.html>\n *\n *   Abstract: \"We present a sound and complete proof system for\n *   reasoning about operations on filesystems. The proof system\n *   enables us to specify a file-synchronization algorithm that can\n *   be combined with several different conflict-resolution\n *   policies. By contrast, previous work builds the\n *   conflict-resolution policy into the specification, or worse, does\n *   not specify the behavior formally. We present several\n *   alternatives for conflict resolution, and we address the knotty\n *   question of timestamps.\"\n *\n * We map this algorithm to JSON records by giving object and array\n * values the same treatment that Ramsey and Csirmaz give file system\n * directories. For the definition of JSON, see RFC 4627.\n *\n *   <http://www.ietf.org/rfc/rfc4627.txt>\n **/\n\n/**\n * This algorithm requires that we keep a snapshot around, such as the\n * last response from a server.\n **/\nvar snapshotJSON =\n{\n  \"x\": 42,\n  \"a\": 1,\n  \"b\":\n  {\n    \"c\": 2,\n    \"d\":\n    {\n      \"e\": 3,\n      \"f\": 4\n    },\n    \"g\": 5\n  },\n  \"h\": 6.6,\n  \"i\": [7, 8, 9],\n  \"j\": 10,\n  \"k\": { \"m\": 11 },\n  \"n\": 66,\n}\n\n/**\n * After local updates have occured, the JSON object will have\n * changed. Our algorithm determines a sequence of updates to the\n * snapshot that result in an object approximating the current\n * state. We can perform this detection without logging each change by\n * ignoring sequences deemed to be insignificant. For example, the\n * field \"x\" with value 42 could be deleted and subsequently added\n * with a value of 43. Our algorithm will not track these changes.\n * The key is present in both JSON objects, so the change will be\n * represented as an edit.\n **/\nvar currentJSON =\n{\n  \"x\": 43,             /* edited */ \n  \"a\": 1,\n  \"new\": 11,           /* created */\n  \"b\":\n  {\n    \"c\": 2,\n    \"new2\": 22,        /* created */\n    \"d\":\n    {\n      \"e\": 3,\n      /*\"f\": 4*/       /* removed */\n    },\n    \"g\": 55,           /* edited  */\n  },\n  /* \"h\": 6.6, */      /* removed */   \n  \"i\": [7, 8, 9, 99],  /* added array element */\n  \"j\": 10,\n  \"k\": 42,             /* replaced object with primitive */\n  \"n\": { \"new3\": 77 }, /* replaced primitive with object */\n}\n\n\n/* some MochiKit shims */\nfunction partial(f) {\n  var args = [this];\n  args.push.apply(args, Array.prototype.slice.call(arguments, 1, arguments.length));\n  return f.bind.apply(f, args);\n}\n\nfunction isEmpty(a) {\n  return a.length === 0;\n}\n\nfunction keys(o) {\n  return Object.keys(o);\n}\n\nfunction extend(a, b) {\n  a.push.apply(a, b);\n  return a;\n}\n\nfunction every(a, f) {\n  return a.every(f);\n}\n\nfunction forEach(a, f) {\n  return a.forEach(f);\n}\n\nfunction filter(f, a) {\n  return a.filter(f);\n}\n\nfunction map(f, a) {\n  return a.map(f);\n}\n\nfunction reduce(f, a, initial) {\n  return a.reduce(f, initial);\n}\n\nfunction chain(a) {\n  var res = [];\n  res.push.apply(res, a);\n  for (var i = 1; i < arguments.length; i++) {\n    res.push.apply(res, arguments[i]);\n  }\n  return res;\n}\n\nfunction arrayEqual(a, b) {\n  if (a.length != b.length) {\n    return false;\n  }\n  return a.every(function(element, index, array){ \n    return element === b[index];\n  });\n}\n\n/* taken directly from MochiKit */\nfunction _flattenArray(res, lst) {\n  for (var i = 0; i < lst.length; i++) {\n    var o = lst[i];\n    if (o instanceof Array) {\n      arguments.callee(res, o);\n    } else {\n      res.push(o);\n    }\n  }\n  return res;\n}\n\nfunction flattenArray(lst) {\n  return _flattenArray([], lst);\n}\n\n/**\n * function detectUpdates(snapshot, current)\n *\n * @param  snapshot\n *         An old version of the object.\n *\n * @param  current\n *         The current version of the object.\n *\n * @return An array of change operations.\n *\n * Ramsey and Csirmaz characterize all changes to the tree in terms of\n * three operations:\n *\n *   1.) create\n *   2.) remove\n *   3.) edit\n *  \n * We need to determine which changes have occured, and sequence them\n * such that the object is never in an incoherent state.\n *\n *   { \"foo\": 1, \"bar\": { \"baz\": 42 }}\n *\n * For example, we must avoid a sequence that calls for a deletion of\n * \"bar\" followed by an edit to \"baz\".\n *\n * A path syntax is useful to express the locations of changes, and\n * maps relatively cleanly to URIs. We express keys as path segments,\n * with arrays implying numeric path segments for their members. Keys\n * with objects or arrays as values have a \"/\" path separator\n * appended. Given an object\n *\n *   {\n *     \"foo\": 1,\n *     \"bar\":\n *      {\n *        \"baz\": 42,\n *        \"qux\": [43, 44, 45, 46]\n *      }\n *   }\n *\n * the following paths map to these values\n * \n *   /foo       => 1\n *   /bar/baz   => 42\n *   /bar/qux/2 => 45\n *\n * In the JSON sync algorithm, Ramsey and Csirmaz's directories\n * correspond to objects and arrays, while their files correspond to\n * primitive JSON values such as strings and integers.\n *\n * The function isObjectOrArray() is used to distinguish between the\n * two cases.\n */\nfunction isObjectOrArray(x) {\n  return ((x !== null) && (typeof(x) == \"object\"));\n}\n\n/**\n * As an object pair is scanned, we can safely ignore keys that are\n * present in both objects that also share identical primitive\n * values. The function identifySuspects() returns a list of keys that\n * warrant further inspection.\n **/\nfunction identifySuspects(snapshot, current) {\n  /**\n   * First, the union of both objects' keys must be calculated. This\n   * code is suboptimal if both arguments are arrays, since we could\n   * simply run keys() on the longer of the two in that case.\n   **/\n  var keySet = {}\n  forEach(extend(keys(snapshot), keys(current)),\n\t  function(key) { keySet[key] = true }); \n  /**\n   * Using the keys present in one or both objects, filter out those\n   * that are present with identical primitive values.\n   **/\n  return filter(function(key) { \n                  return (isObjectOrArray(snapshot[key]) ||\n\t                  isObjectOrArray(current[key]) ||\n\t                  snapshot[key] !== current[key]);\n                }, keys(keySet));\n}\n\n/**\n * We use Command objects to represent operations performed\n * on each replica.\n **/\nfunction Command(action, path, value) {\n  this.action = action;\n  this.path = path;\n  this.value = value;\n}\nCommand.prototype = {\n  equals: function(other) {\n    return (other && other.action == this.action && \n            arrayEqual(this.path, other.path) &&\n            (isObjectOrArray(other.value) && isObjectOrArray(this.value) ?\n             other.value.constructor == this.value.constructor :\n             other.value === this.value));\n  },\n  /**\n   * Check whether the other command's path starts with our path.\n   **/\n  isParentOf: function(other) {\n    return other.path.length > this.path.length &&\n           arrayEqual(other.path.slice(0, this.path.length), this.path);\n  }\n}\n\n/**\n * Objects need to be created in preorder (before their child nodes),\n * to avoid a disconnected tree.\n **/\nfunction created(path, value) {\n  if (isObjectOrArray(value)) {\n    /* object created. Prepend the creation record to its children */\n    return extend([new Command(\"create\", path, value.constructor())],\n                  _detectUpdates(path, {}, value));\n  }\n\n  /* primitive created */\n  return [new Command(\"create\", path, value)];\n}\n\n/**\n * Objects need to be removed in postorder (after their child nodes),\n * to avoid a disconnected graph. This is the same way \"rm -rf\" works.\n **/\nfunction removed(path, value) {\n  if (isObjectOrArray(value)) {\n    /* Object removed. Append the removal record to its children. */\n    return extend(_detectUpdates(path, value, {}),\n                  [new Command(\"remove\", path)]);\n  }\n  \n  /* primitive removed */\n  return [new Command(\"remove\", path)];\n}\n\n/**\n * Some edit operations are more complicated than they first\n * appear. In particular, we want to recurse into object values where\n * the key was previously a primitive. This approach provides us with\n * a detailed creation log, and allows us to reconcile more JSON\n * graphs, because it provides a detailed log of the created children\n * of the new object.\n **/\nfunction edited(path, old, update) {\n  if (isObjectOrArray(old) && !isObjectOrArray(update)) {\n    /* object replaced by primitive */\n    return extend([new Command(\"edit\", path, update)],\n                  _detectUpdates(path, old, {}));\n  } else if (!isObjectOrArray(old) && isObjectOrArray(update)) {\n    /* primitive replaced by object */\n    return extend([new Command(\"edit\", path, update.constructor())],\n                  _detectUpdates(path, {}, update));\n  }\n  \n  /* primitive edit */\n  return [new Command(\"edit\", path, update)];   \n}\n\n\nfunction _detectUpdates(stack, snapshot, current) {\n  /* check for edits and recurse into objects and arrays */\n  return flattenArray(map(\n    function (key) {\n      var old = snapshot[key];\n      var update = current[key];\n      var path = stack.concat([key]);\n\n      /* create */\n      if (typeof(old) == \"undefined\")\n        return created(path, update);\n\n      /* remove */\n      if (typeof(update) == \"undefined\")\n        return removed(path, old);\n\n      /* edit */\n      if (!isObjectOrArray(old) || !isObjectOrArray(update))\n        return edited(path, old, update);\n\n      /* recurse into object/array values at the same path */\n      /** \n       * We need to detect container type changes. This type of edit\n       * changes the algebra described by Ramsey and Csirmaz a bit,\n       * because it imposes additional ordering constraints on the\n       * update sequence, which complicates the algorithm, but it\n       * seems worth it to avoid profiling JSON.\n       *\n       * When an object's type changes at a path π, we want to reverse\n       * the normal order of operations that Ramsey and Csirmaz give,\n       * because we assume that a deletion of all of the array's\n       * elements preceded the change from array to object. This\n       * assumption does prevent key preservation across non-idiomatic\n       * transformations between Object and Array types.\n       *\n       *  remove(π/π')\n       *  removeObj(π, Array(m))\n       *  createObj(π, Object(m))\n       *  create(π/π')\n       *\n       * In otherwords, when an Array at path π is changed to an\n       * Object, that implies a recursive deletion of all its\n       * children, a removal of an Array at path π, a creation of an\n       * Object at path π, and recursive creation of the Object's\n       * members. This means we have to interleave creates and\n       * removes, unlike Ramsey and Csirmaz.\n       * \n       **/\n\n      ///XXX change this to recurse and return\n      var changeSequence = [];\n      if (old.constructor != update.constructor) {\n        changeSequence.push(new Command(\"edit\", path, update.constructor()));\n      }\n\n      /**\n       * Now we recurse into objects and arrays, and append\n       * the current key to our path stack.\n       **/\n      return extend(changeSequence,\n                    _detectUpdates(path, old, update));\n                    \n    }, identifySuspects(snapshot, current)));\n}\nvar detectUpdates = partial(_detectUpdates, []);\n\n/**\n * function orderUpdates(updates)\n *\n * @param  updates\n *         An array of produced by detectUpdates.\n *\n * @return An array of change operations in the canonical order.\n *\n * Once we have our updates, we'll need to order the records in the\n * canonical sequence described by Ramsey and Csirmaz for path π:\n *\n * (a) Commands of the form edit (π, Dir(m)), in any order determined\n *     by π.\n * (b) Commands of the form create (π, X), in preorder. \n * (c) Commands of the form remove (π), in postorder. \n * (d) Commands of the form edit (π, File(m, x)), in any order\n *     determined by π.\n *\n **/\nfunction orderUpdates(updates) {\n  var dirEdits = [];\n  var creates = [];\n  var removes = [];\n  var edits = [];\n  \n  /** \n   *  _detectUpdates orders creates and removes canonically, so we\n   *  just need to weed out the edits.\n   **/\n  forEach(updates, function(update) {\n    if (update.action == \"edit\")\n      isObjectOrArray(value) ? dirEdits.push(update) : edits.push(update);\n    else if (update.action == \"create\")\n      creates.push(update);\n    else if (update.action == \"remove\")\n      removes.push(update);\n  });\n  \n  return chain(dirEdits, creates, removes, edits);\n}\n\n\n/**\n * \n *\n * Excerpt from Ramsey and Csirmaz:\n *\n *    The reconciler takes the sequences S1 , ... , Sn that are\n *    computed to have been performed at each replica. It com- putes\n *    sequences S ∗ 1 , ... , S ∗ n that make the filesystems as close\n *    as possible. The idea of the algorithm is that a command C ∈\n *    Si should be propagated to replica j (included ∗ in Sj ) iff\n *    three criteria are met:\n *\n *      * C ∈ Sj , i.e., C has not already been performed at\n *        replica j\n *\n *      * no commands at replicas other than i conflict with C\n *\n *      * no commands at replicas other than i conflict with commands\n *        that must precede C\n *\n *    A command C must precede command C iff they appear in the same\n *    sequence Si , C precedes C in Si , and they do not commute (C ;\n *    C C; C ).\n *\n **/\n\n/**\n * function commandInList(command, commands)\n *\n * Check whether a command appears in a list of commands, so we can\n * tell if a command has already been performed at a replica.\n *\n **/\nfunction commandInList(command, commands) {\n  return commands.some(function(element, index, array) {\n      return (element instanceof Command && element.equals(command));\n  });\n}\n\n/**\n * Now we find commands with paths that are of interest, make sure\n * it's not the same command, and then check to see if it's a break.\n * \n * function conflictsFromReplicas(command, commandListsFromOtherReplicas)\n *\n * @param  command \n *         A Command object.\n *\n * @param  commandListsFromOtherReplicas\n *         A list of command lists from other replicas ([[],[],[]])\n *\n * @return A list of objects conforming to the interface:\n *         {\n *           command: Command\n *           conflicts: [Command, Command, Command...]\n *           commandList: [Command, Command, Command...]\n *         }\n *  \n **/\n \n/**\n * Check whether an edit or create operation has been attempted under\n * a remove.\n **/ \nfunction isBreak(a, b) {\n  return a.isParentOf(b) && \n         ((!isObjectOrArray(a.value) || a.action == \"remove\") &&\n          b.action != \"remove\");\n}\n \n/**\n * Check whether the commands would result in a broken graph,\n * or whether they are attempting to insert the different values\n * at the same path.\n **/\nfunction doesConflict(command, other) {\n  var broken = isBreak(command, other) || isBreak(other, command); \n  return broken || (arrayEqual(command.path, other.path)\n                    && !command.equals(other));\n}\n\nfunction conflictsFromReplica(command, commandList) {\n    return {\n      \"command\": command,\n      \"conflicts\": filter(partial(doesConflict, command), commandList),\n      \"commandList\": commandList\n    };\n}\n\nfunction conflictsFromReplicas(command, commandListsFromOtherReplicas) {\n  return map(partial(conflictsFromReplica, command),\n             commandListsFromOtherReplicas);\n}\n\n/**\n * If a command doesn't conflict, we still might have to put it in the \n * conflict list if an earlier command did conflict, and that command\n * is a precondition for the current command.\n **/\nfunction mustPrecede(command, earlierCommand) {  \n  if (earlierCommand.action == \"edit\")\n    return false;\n\n  return earlierCommand.isParentOf(command);\n}\n\nfunction precedingCommandsConflict(command, conflictList) {\n  if (isEmpty(conflictList))\n    return false;\n  if (conflictList.some(partial(mustPrecede, command))) {\n    return true;\n  }\n  return false;\n}\n\nfunction reconcile(commandLists) {\n  var propagations = [];\n  var conflicts = [];\n\n  forEach(commandLists, function() {\n    propagations.push([]);\n    conflicts.push([]);\n  });\n\n  for (var i = 0; i < commandLists.length; ++i) {\n    for (var j = 0; j < commandLists.length; ++j) {\n      if (i != j) {\n        forEach(commandLists[i],\n          function (command) {\n            if (!commandInList(command, commandLists[j])) {\n              var others = chain(commandLists.slice(0, i), \n                                 commandLists.slice(i + 1));\n              var conflict = conflictsFromReplicas(command, others);\n              if (every(conflict, function(c) { return c.conflicts.length == 0 })) {\n                if (precedingCommandsConflict(command, conflicts[j])) {\n                  conflicts[j].push(command);\n                } else {\n                  propagations[j].push(command);\n                }\n              } else {\n                conflicts[j].push(command);\n              }\n            }\n          }\n        );\n      }\n    }\n  }\n    \n  return {\"propagations\":propagations, \"conflicts\":conflicts};\n}\n\n/**\n * Map a path array to an object reference, such that [foo, bar, baz]\n * becomes a reference to the value at obj[foo][bar][baz].\n **/\nfunction pathToReference(obj, path) {\n  return reduce(function (reference, segment) {\n                  return reference ? reference[segment] : reference;\n                }, \n                path, obj);\n}\n\n/**\n * Apply a single command to an object.\n **/\nfunction applyCommand(target, command) {  \n  var container =\n    pathToReference(target, command.path.slice(0, command.path.length - 1));\n\n  if (command.action == \"remove\")\n    delete container[command.path[command.path.length - 1]];\n  \n  container[command.path[command.path.length - 1]] = command.value;\n}\n\n/**\n * Apply a list of commands to an object.\n **/\nfunction applyCommands(target, commands) {\n  forEach(commands, partial(applyCommand, target));\n}\n\n/**\n * Now we define a more traditional OO api to wrap this functionality.\n * \n * @param identifiers \n *        A string or array of strings for the synchronizer to identify \n *        fields to be used as a identifiers.\n * \n * @param onConflict\n *        A function that will be called when a conflict arises.\n *\n * @param onPropagate\n *        A function that will be called when a propagation arises. \n **/\nfunction Synchronizer(ids, onConflict, onPropagate) {\n  this.identifiers = isObjectorArray(ids) ? ids : [ids];\n  this.onConflict = onConflict;\n  this.onPropagate = onPropagate;\n}\n\nSynchronizer.prototype = {\n  /**\n   * Synchronize JSON objects.\n   *\n   * @param snapshot\n   *        A common baseline JSON object to work from.\n   *\n   * @param jsonObjects\n   *        An array of JSON objects to sync, all of which are derived\n   *        from the common baseline.\n   **/\n  sync: function(snapshot, jsonObjects) {\n    \n  }\n}\n",
                "new_contents": "/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */\n/**\n * This file contains a simple synchronization method for JSON objects\n * based on the file synchronization algorithm presented by Norman\n * Ramsey and Elod Csirmaz in\n *\n *   An Algebraic Approach to File Synchronization\n *   <http://www.eecs.harvard.edu/~nr/pubs/sync-abstract.html>\n *\n *   Abstract: \"We present a sound and complete proof system for\n *   reasoning about operations on filesystems. The proof system\n *   enables us to specify a file-synchronization algorithm that can\n *   be combined with several different conflict-resolution\n *   policies. By contrast, previous work builds the\n *   conflict-resolution policy into the specification, or worse, does\n *   not specify the behavior formally. We present several\n *   alternatives for conflict resolution, and we address the knotty\n *   question of timestamps.\"\n *\n * We map this algorithm to JSON records by giving object and array\n * values the same treatment that Ramsey and Csirmaz give file system\n * directories. For the definition of JSON, see RFC 4627.\n *\n *   <http://www.ietf.org/rfc/rfc4627.txt>\n **/\n\n/**\n * This algorithm requires that we keep a snapshot around, such as the\n * last response from a server.\n **/\nvar snapshotJSON =\n{\n  \"x\": 42,\n  \"a\": 1,\n  \"b\":\n  {\n    \"c\": 2,\n    \"d\":\n    {\n      \"e\": 3,\n      \"f\": 4\n    },\n    \"g\": 5\n  },\n  \"h\": 6.6,\n  \"i\": [7, 8, 9],\n  \"j\": 10,\n  \"k\": { \"m\": 11 },\n  \"n\": 66,\n}\n\n/**\n * After local updates have occured, the JSON object will have\n * changed. Our algorithm determines a sequence of updates to the\n * snapshot that result in an object approximating the current\n * state. We can perform this detection without logging each change by\n * ignoring sequences deemed to be insignificant. For example, the\n * field \"x\" with value 42 could be deleted and subsequently added\n * with a value of 43. Our algorithm will not track these changes.\n * The key is present in both JSON objects, so the change will be\n * represented as an edit.\n **/\nvar currentJSON =\n{\n  \"x\": 43,             /* edited */ \n  \"a\": 1,\n  \"new\": 11,           /* created */\n  \"b\":\n  {\n    \"c\": 2,\n    \"new2\": 22,        /* created */\n    \"d\":\n    {\n      \"e\": 3,\n      /*\"f\": 4*/       /* removed */\n    },\n    \"g\": 55,           /* edited  */\n  },\n  /* \"h\": 6.6, */      /* removed */   \n  \"i\": [7, 8, 9, 99],  /* added array element */\n  \"j\": 10,\n  \"k\": 42,             /* replaced object with primitive */\n  \"n\": { \"new3\": 77 }, /* replaced primitive with object */\n}\n\n\n/* some MochiKit shims */\nfunction partial(f) {\n  var args = [this];\n  args.push.apply(args, Array.prototype.slice.call(arguments, 1, arguments.length));\n  return f.bind.apply(f, args);\n}\n\nfunction extend(a, b) {\n  a.push.apply(a, b);\n  return a;\n}\n\nfunction every(a, f) {\n  return a.every(f);\n}\n\nfunction forEach(a, f) {\n  return a.forEach(f);\n}\n\nfunction filter(f, a) {\n  return a.filter(f);\n}\n\nfunction map(f, a) {\n  return a.map(f);\n}\n\nfunction reduce(f, a, initial) {\n  return a.reduce(f, initial);\n}\n\nfunction chain(a) {\n  var res = [];\n  res.push.apply(res, a);\n  for (var i = 1; i < arguments.length; i++) {\n    res.push.apply(res, arguments[i]);\n  }\n  return res;\n}\n\nfunction arrayEqual(a, b) {\n  if (a.length != b.length) {\n    return false;\n  }\n  return a.every(function(element, index, array){ \n    return element === b[index];\n  });\n}\n\n/* taken directly from MochiKit */\nfunction _flattenArray(res, lst) {\n  for (var i = 0; i < lst.length; i++) {\n    var o = lst[i];\n    if (o instanceof Array) {\n      arguments.callee(res, o);\n    } else {\n      res.push(o);\n    }\n  }\n  return res;\n}\n\nfunction flattenArray(lst) {\n  return _flattenArray([], lst);\n}\n\n/**\n * function detectUpdates(snapshot, current)\n *\n * @param  snapshot\n *         An old version of the object.\n *\n * @param  current\n *         The current version of the object.\n *\n * @return An array of change operations.\n *\n * Ramsey and Csirmaz characterize all changes to the tree in terms of\n * three operations:\n *\n *   1.) create\n *   2.) remove\n *   3.) edit\n *  \n * We need to determine which changes have occured, and sequence them\n * such that the object is never in an incoherent state.\n *\n *   { \"foo\": 1, \"bar\": { \"baz\": 42 }}\n *\n * For example, we must avoid a sequence that calls for a deletion of\n * \"bar\" followed by an edit to \"baz\".\n *\n * A path syntax is useful to express the locations of changes, and\n * maps relatively cleanly to URIs. We express keys as path segments,\n * with arrays implying numeric path segments for their members. Keys\n * with objects or arrays as values have a \"/\" path separator\n * appended. Given an object\n *\n *   {\n *     \"foo\": 1,\n *     \"bar\":\n *      {\n *        \"baz\": 42,\n *        \"qux\": [43, 44, 45, 46]\n *      }\n *   }\n *\n * the following paths map to these values\n * \n *   /foo       => 1\n *   /bar/baz   => 42\n *   /bar/qux/2 => 45\n *\n * In the JSON sync algorithm, Ramsey and Csirmaz's directories\n * correspond to objects and arrays, while their files correspond to\n * primitive JSON values such as strings and integers.\n *\n * The function isObjectOrArray() is used to distinguish between the\n * two cases.\n */\nfunction isObjectOrArray(x) {\n  return ((x !== null) && (typeof(x) == \"object\"));\n}\n\n/**\n * As an object pair is scanned, we can safely ignore keys that are\n * present in both objects that also share identical primitive\n * values. The function identifySuspects() returns a list of keys that\n * warrant further inspection.\n **/\nfunction identifySuspects(snapshot, current) {\n  /**\n   * First, the union of both objects' keys must be calculated. This\n   * code is suboptimal if both arguments are arrays, since we could\n   * simply run Object.keys() on the longer of the two in that case.\n   **/\n  var keySet = {}\n  forEach(extend(Object.keys(snapshot), Object.keys(current)),\n\t  function(key) { keySet[key] = true }); \n  /**\n   * Using the keys present in one or both objects, filter out those\n   * that are present with identical primitive values.\n   **/\n  return filter(function(key) { \n                  return (isObjectOrArray(snapshot[key]) ||\n\t                  isObjectOrArray(current[key]) ||\n\t                  snapshot[key] !== current[key]);\n                }, Object.keys(keySet));\n}\n\n/**\n * We use Command objects to represent operations performed\n * on each replica.\n **/\nfunction Command(action, path, value) {\n  this.action = action;\n  this.path = path;\n  this.value = value;\n}\nCommand.prototype = {\n  equals: function(other) {\n    return (other && other.action == this.action && \n            arrayEqual(this.path, other.path) &&\n            (isObjectOrArray(other.value) && isObjectOrArray(this.value) ?\n             other.value.constructor == this.value.constructor :\n             other.value === this.value));\n  },\n  /**\n   * Check whether the other command's path starts with our path.\n   **/\n  isParentOf: function(other) {\n    return other.path.length > this.path.length &&\n           arrayEqual(other.path.slice(0, this.path.length), this.path);\n  }\n}\n\n/**\n * Objects need to be created in preorder (before their child nodes),\n * to avoid a disconnected tree.\n **/\nfunction created(path, value) {\n  if (isObjectOrArray(value)) {\n    /* object created. Prepend the creation record to its children */\n    return extend([new Command(\"create\", path, value.constructor())],\n                  _detectUpdates(path, {}, value));\n  }\n\n  /* primitive created */\n  return [new Command(\"create\", path, value)];\n}\n\n/**\n * Objects need to be removed in postorder (after their child nodes),\n * to avoid a disconnected graph. This is the same way \"rm -rf\" works.\n **/\nfunction removed(path, value) {\n  if (isObjectOrArray(value)) {\n    /* Object removed. Append the removal record to its children. */\n    return extend(_detectUpdates(path, value, {}),\n                  [new Command(\"remove\", path)]);\n  }\n  \n  /* primitive removed */\n  return [new Command(\"remove\", path)];\n}\n\n/**\n * Some edit operations are more complicated than they first\n * appear. In particular, we want to recurse into object values where\n * the key was previously a primitive. This approach provides us with\n * a detailed creation log, and allows us to reconcile more JSON\n * graphs, because it provides a detailed log of the created children\n * of the new object.\n **/\nfunction edited(path, old, update) {\n  if (isObjectOrArray(old) && !isObjectOrArray(update)) {\n    /* object replaced by primitive */\n    return extend([new Command(\"edit\", path, update)],\n                  _detectUpdates(path, old, {}));\n  } else if (!isObjectOrArray(old) && isObjectOrArray(update)) {\n    /* primitive replaced by object */\n    return extend([new Command(\"edit\", path, update.constructor())],\n                  _detectUpdates(path, {}, update));\n  }\n  \n  /* primitive edit */\n  return [new Command(\"edit\", path, update)];   \n}\n\n\nfunction _detectUpdates(stack, snapshot, current) {\n  /* check for edits and recurse into objects and arrays */\n  return flattenArray(map(\n    function (key) {\n      var old = snapshot[key];\n      var update = current[key];\n      var path = stack.concat([key]);\n\n      /* create */\n      if (typeof(old) == \"undefined\")\n        return created(path, update);\n\n      /* remove */\n      if (typeof(update) == \"undefined\")\n        return removed(path, old);\n\n      /* edit */\n      if (!isObjectOrArray(old) || !isObjectOrArray(update))\n        return edited(path, old, update);\n\n      /* recurse into object/array values at the same path */\n      /** \n       * We need to detect container type changes. This type of edit\n       * changes the algebra described by Ramsey and Csirmaz a bit,\n       * because it imposes additional ordering constraints on the\n       * update sequence, which complicates the algorithm, but it\n       * seems worth it to avoid profiling JSON.\n       *\n       * When an object's type changes at a path π, we want to reverse\n       * the normal order of operations that Ramsey and Csirmaz give,\n       * because we assume that a deletion of all of the array's\n       * elements preceded the change from array to object. This\n       * assumption does prevent key preservation across non-idiomatic\n       * transformations between Object and Array types.\n       *\n       *  remove(π/π')\n       *  removeObj(π, Array(m))\n       *  createObj(π, Object(m))\n       *  create(π/π')\n       *\n       * In otherwords, when an Array at path π is changed to an\n       * Object, that implies a recursive deletion of all its\n       * children, a removal of an Array at path π, a creation of an\n       * Object at path π, and recursive creation of the Object's\n       * members. This means we have to interleave creates and\n       * removes, unlike Ramsey and Csirmaz.\n       * \n       **/\n\n      ///XXX change this to recurse and return\n      var changeSequence = [];\n      if (old.constructor != update.constructor) {\n        changeSequence.push(new Command(\"edit\", path, update.constructor()));\n      }\n\n      /**\n       * Now we recurse into objects and arrays, and append\n       * the current key to our path stack.\n       **/\n      return extend(changeSequence,\n                    _detectUpdates(path, old, update));\n                    \n    }, identifySuspects(snapshot, current)));\n}\nvar detectUpdates = partial(_detectUpdates, []);\n\n/**\n * function orderUpdates(updates)\n *\n * @param  updates\n *         An array of produced by detectUpdates.\n *\n * @return An array of change operations in the canonical order.\n *\n * Once we have our updates, we'll need to order the records in the\n * canonical sequence described by Ramsey and Csirmaz for path π:\n *\n * (a) Commands of the form edit (π, Dir(m)), in any order determined\n *     by π.\n * (b) Commands of the form create (π, X), in preorder. \n * (c) Commands of the form remove (π), in postorder. \n * (d) Commands of the form edit (π, File(m, x)), in any order\n *     determined by π.\n *\n **/\nfunction orderUpdates(updates) {\n  var dirEdits = [];\n  var creates = [];\n  var removes = [];\n  var edits = [];\n  \n  /** \n   *  _detectUpdates orders creates and removes canonically, so we\n   *  just need to weed out the edits.\n   **/\n  forEach(updates, function(update) {\n    if (update.action == \"edit\")\n      isObjectOrArray(value) ? dirEdits.push(update) : edits.push(update);\n    else if (update.action == \"create\")\n      creates.push(update);\n    else if (update.action == \"remove\")\n      removes.push(update);\n  });\n  \n  return chain(dirEdits, creates, removes, edits);\n}\n\n\n/**\n * \n *\n * Excerpt from Ramsey and Csirmaz:\n *\n *    The reconciler takes the sequences S1 , ... , Sn that are\n *    computed to have been performed at each replica. It com- putes\n *    sequences S ∗ 1 , ... , S ∗ n that make the filesystems as close\n *    as possible. The idea of the algorithm is that a command C ∈\n *    Si should be propagated to replica j (included ∗ in Sj ) iff\n *    three criteria are met:\n *\n *      * C ∈ Sj , i.e., C has not already been performed at\n *        replica j\n *\n *      * no commands at replicas other than i conflict with C\n *\n *      * no commands at replicas other than i conflict with commands\n *        that must precede C\n *\n *    A command C must precede command C iff they appear in the same\n *    sequence Si , C precedes C in Si , and they do not commute (C ;\n *    C C; C ).\n *\n **/\n\n/**\n * function commandInList(command, commands)\n *\n * Check whether a command appears in a list of commands, so we can\n * tell if a command has already been performed at a replica.\n *\n **/\nfunction commandInList(command, commands) {\n  return commands.some(function(element, index, array) {\n      return (element instanceof Command && element.equals(command));\n  });\n}\n\n/**\n * Now we find commands with paths that are of interest, make sure\n * it's not the same command, and then check to see if it's a break.\n * \n * function conflictsFromReplicas(command, commandListsFromOtherReplicas)\n *\n * @param  command \n *         A Command object.\n *\n * @param  commandListsFromOtherReplicas\n *         A list of command lists from other replicas ([[],[],[]])\n *\n * @return A list of objects conforming to the interface:\n *         {\n *           command: Command\n *           conflicts: [Command, Command, Command...]\n *           commandList: [Command, Command, Command...]\n *         }\n *  \n **/\n \n/**\n * Check whether an edit or create operation has been attempted under\n * a remove.\n **/ \nfunction isBreak(a, b) {\n  return a.isParentOf(b) && \n         ((!isObjectOrArray(a.value) || a.action == \"remove\") &&\n          b.action != \"remove\");\n}\n \n/**\n * Check whether the commands would result in a broken graph,\n * or whether they are attempting to insert the different values\n * at the same path.\n **/\nfunction doesConflict(command, other) {\n  var broken = isBreak(command, other) || isBreak(other, command); \n  return broken || (arrayEqual(command.path, other.path)\n                    && !command.equals(other));\n}\n\nfunction conflictsFromReplica(command, commandList) {\n    return {\n      \"command\": command,\n      \"conflicts\": filter(partial(doesConflict, command), commandList),\n      \"commandList\": commandList\n    };\n}\n\nfunction conflictsFromReplicas(command, commandListsFromOtherReplicas) {\n  return map(partial(conflictsFromReplica, command),\n             commandListsFromOtherReplicas);\n}\n\n/**\n * If a command doesn't conflict, we still might have to put it in the \n * conflict list if an earlier command did conflict, and that command\n * is a precondition for the current command.\n **/\nfunction mustPrecede(command, earlierCommand) {  \n  if (earlierCommand.action == \"edit\")\n    return false;\n\n  return earlierCommand.isParentOf(command);\n}\n\nfunction precedingCommandsConflict(command, conflictList) {\n  if (conflictList.length === 0)\n    return false;\n  if (conflictList.some(partial(mustPrecede, command))) {\n    return true;\n  }\n  return false;\n}\n\nfunction reconcile(commandLists) {\n  var propagations = [];\n  var conflicts = [];\n\n  forEach(commandLists, function() {\n    propagations.push([]);\n    conflicts.push([]);\n  });\n\n  for (var i = 0; i < commandLists.length; ++i) {\n    for (var j = 0; j < commandLists.length; ++j) {\n      if (i != j) {\n        forEach(commandLists[i],\n          function (command) {\n            if (!commandInList(command, commandLists[j])) {\n              var others = chain(commandLists.slice(0, i), \n                                 commandLists.slice(i + 1));\n              var conflict = conflictsFromReplicas(command, others);\n              if (every(conflict, function(c) { return c.conflicts.length == 0 })) {\n                if (precedingCommandsConflict(command, conflicts[j])) {\n                  conflicts[j].push(command);\n                } else {\n                  propagations[j].push(command);\n                }\n              } else {\n                conflicts[j].push(command);\n              }\n            }\n          }\n        );\n      }\n    }\n  }\n    \n  return {\"propagations\":propagations, \"conflicts\":conflicts};\n}\n\n/**\n * Map a path array to an object reference, such that [foo, bar, baz]\n * becomes a reference to the value at obj[foo][bar][baz].\n **/\nfunction pathToReference(obj, path) {\n  return reduce(function (reference, segment) {\n                  return reference ? reference[segment] : reference;\n                }, \n                path, obj);\n}\n\n/**\n * Apply a single command to an object.\n **/\nfunction applyCommand(target, command) {  \n  var container =\n    pathToReference(target, command.path.slice(0, command.path.length - 1));\n\n  if (command.action == \"remove\")\n    delete container[command.path[command.path.length - 1]];\n  \n  container[command.path[command.path.length - 1]] = command.value;\n}\n\n/**\n * Apply a list of commands to an object.\n **/\nfunction applyCommands(target, commands) {\n  forEach(commands, partial(applyCommand, target));\n}\n\n/**\n * Now we define a more traditional OO api to wrap this functionality.\n * \n * @param identifiers \n *        A string or array of strings for the synchronizer to identify \n *        fields to be used as a identifiers.\n * \n * @param onConflict\n *        A function that will be called when a conflict arises.\n *\n * @param onPropagate\n *        A function that will be called when a propagation arises. \n **/\nfunction Synchronizer(ids, onConflict, onPropagate) {\n  this.identifiers = isObjectorArray(ids) ? ids : [ids];\n  this.onConflict = onConflict;\n  this.onPropagate = onPropagate;\n}\n\nSynchronizer.prototype = {\n  /**\n   * Synchronize JSON objects.\n   *\n   * @param snapshot\n   *        A common baseline JSON object to work from.\n   *\n   * @param jsonObjects\n   *        An array of JSON objects to sync, all of which are derived\n   *        from the common baseline.\n   **/\n  sync: function(snapshot, jsonObjects) {\n    \n  }\n}\n",
                "subject": "Remove a few MochiKit shims: keys() and isEmpty()",
                "message": "Remove a few MochiKit shims: keys() and isEmpty()\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "sayrer/json-sync"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10231,
            "row": {
                "commit": "b1ad1681e1abf6e4bdbcee6c64b272f40d981482",
                "old_file": "public/js/common/ui-alt-text.js",
                "new_file": "public/js/common/ui-alt-text.js",
                "old_contents": "jQuery(function($) {\n\t\n\t// SORTABLE CLASS\n\t// ==============\n\t\n\tvar AltText = function(el) {\n\t\tthis.$el = $(el);\n\t\tthis.originalText = this.$el.text();\n\t\tthis.altText = this.$el.data('alt-text');\n\t}\n\t\n\tAltText.prototype.state = function(alt) {\n\t\t\n\t\tthis.$el.text(alt ? this.altText : this.originalText);\n\t\t\n\t}\n\t\n\t// SORTABLE PLUGIN\n\t// ===============\n\t\n\t$.fn.altText = function(state) {\n\t\treturn this.each(function() {\n\t\t\tvar $this = $(this);\n\t\t\tvar altText = $this.data('ui.altText');\n\t\t\t\n\t\t\tif (!altText) $this.data('ui.altText', (altText = new AltText(this)));\n\t\t\t\n\t\t\taltText.state(state);\n\t\t});\n\t}\n\t\n\t$.fn.altText.Constructor = AltText;\n\t\n\t// EVENT BINDINGS\n\t// ==============\n\t\n\t$(document).on('keydown.ui.altText', function(e) {\n\t\tif (e.which != 18) return;\n\t\t$('[data-alt-text]').altText(true);\n\t});\n\t\n\t$(document).on('keyup.ui.altText', function(e) {\n\t\tif (e.which != 18) return;\n\t\t$('[data-alt-text]').altText();\n\t});\n\t\n});",
                "new_contents": "jQuery(function($) {\n\t\n\t// ALT-TEXT CLASS\n\t// ==============\n\t\n\tvar AltText = function(el) {\n\t\tthis.$el = $(el);\n\t\tthis.originalText = this.$el.text();\n\t\tthis.altText = this.$el.data('alt-text');\n\t}\n\t\n\tAltText.prototype.state = function(alt) {\n\t\t\n\t\tthis.$el.text(alt ? this.altText : this.originalText);\n\t\t\n\t}\n\t\n\t// ALT-TEXT PLUGIN\n\t// ===============\n\t\n\t$.fn.altText = function(state) {\n\t\treturn this.each(function() {\n\t\t\tvar $this = $(this);\n\t\t\tvar altText = $this.data('ui.altText');\n\t\t\t\n\t\t\tif (!altText) $this.data('ui.altText', (altText = new AltText(this)));\n\t\t\t\n\t\t\taltText.state(state);\n\t\t});\n\t}\n\t\n\t$.fn.altText.Constructor = AltText;\n\t\n\t// EVENT BINDINGS\n\t// ==============\n\t\n\t$(document).on('keydown.ui.altText', function(e) {\n\t\tif (e.which != 18) return;\n\t\t$('[data-alt-text]').altText(true);\n\t});\n\t\n\t$(document).on('keyup.ui.altText', function(e) {\n\t\tif (e.which != 18) return;\n\t\t$('[data-alt-text]').altText();\n\t});\n\t\n});\n",
                "subject": "Fixing Comments",
                "message": "Fixing Comments\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "ligson/keystone,qwales1/keystone,Pop-Code/keystone,sarriaroman/keystone,creynders/keystone,ONode/keystone,sendyhalim/keystone,stosorio/keystone,Freakland/keystone,davidbanham/keystone,tomasztunik/keystone,wmertens/keystone,udp/keystone,frontyard/keystone,WingedToaster/keystone,naustudio/keystone,antonj/keystone,qwales1/keystone,frontyard/keystone,joerter/keystone,Tangcuyu/keystone,trentmillar/keystone,jacargentina/keystone,rmarji/keystone,alobodig/keystone,sebmck/keystone,kumo/keystone,matthewstyers/keystone,kwangkim/keystone,matthieugayon/keystone,kristianmandrup/keystone,rafmsou/keystone,ratecity/keystone,andrewlinfoot/keystone,davidbanham/keystone,riyadhalnur/keystone,kwangkim/keystone,michaelerobertsjr/keystone,chrisgornall/d29blog,kumo/keystone,Redmart/keystone,mekanics/keystone,wmertens/keystone,jrit/keystone,tony2cssc/keystone,danielmahon/keystone,jeffreypriebe/keystone,concoursbyappointment/keystoneRedux,rafmsou/keystone,chrisgornall/d29blog,naustudio/keystone,sendyhalim/keystone,MORE-HEALTH/keystone,Adam14Four/keystone,asifiqbal84/keystone,WofloW/keystone,matthewstyers/keystone,vokal/keystone,brianjd/keystone,stosorio/keystone,onenorth/keystone,omnibrain/keystone,beni55/keystone,SJApps/keystone,joerter/keystone,dvdcastro/keystone,douglasf/keystone,youprofit/keystone,benkroeger/keystone,jstockwin/keystone,SJApps/keystone,dryna/keystone-twoje-urodziny,snowkeeper/keystone,andrewlinfoot/keystone,Ftonso/keystone,lojack/keystone,michaelerobertsjr/keystone,Tangcuyu/keystone,w01fgang/keystone,andreufirefly/keystone,vokal/keystone,danielmahon/keystone,benkroeger/keystone,sarriaroman/keystone,cermati/keystone,trentmillar/keystone,webteckie/keystone,belafontestudio/keystone,belafontestudio/keystone,the1sky/keystone,developer-prosenjit/keystone,magalhas/keystone,vmkcom/keystone,riyadhalnur/keystone,w01fgang/keystone,woody0907/keystone,everisARQ/keystone,the1sky/keystone,francesconero/keystone,pr1ntr/keystone,kloudsio/keystone,Freakland/keystone,gemscng/keystone,pswoodworth/keystone,geminiyellow/keystone,andrewlinfoot/keystone,wilsonfletcher/keystone,jeffreypriebe/keystone,kristianmandrup/keystone,mbayfield/keystone,lojack/keystone,Adam14Four/keystone,lastjune/keystone,cermati/keystone,davibe/keystone,kidaa/keystone,unsworn/keystone,MORE-HEALTH/keystone,kidaa/keystone,beni55/keystone,efernandesng/keystone,tanbo800/keystone,creynders/keystone,douglasf/keystone,TomKremer/keystonejs,Redmart/keystone,concoursbyappointment/keystoneRedux,woody0907/keystone,nickhsine/keystone,danielmahon/keystone,Ftonso/keystone,trentmillar/keystone,jstockwin/keystone,wustxing/keystone,gcortese/keystone,developer-prosenjit/keystone,killerbobjr/keystone,SlashmanX/keystone,pswoodworth/keystone,snowkeeper/keystone,andreufirefly/keystone,DenisNeustroev/keystone,davibe/keystone,suryagh/keystone,quenktechnologies/keystone,brianjd/keystone,xyzteam2016/keystone,Pylipala/keystone,WofloW/keystone,magalhas/keystone,vokal/keystone,dvdcastro/keystone,youprofit/keystone,Yaska/keystone,francesconero/keystone,benkroeger/keystone,stunjiturner/keystone,webteckie/keystone,xyzteam2016/keystone,nickhsine/keystone,vmkcom/keystone,antonj/keystone,asifiqbal84/keystone,tanbo800/keystone,jrit/keystone,matthewstyers/keystone,trystant/keystone,linhanyang/keystone,BlakeRxxk/keystone,Pop-Code/keystone,tomasztunik/keystone,stunjiturner/keystone,omnibrain/keystone,BlakeRxxk/keystone,ligson/keystone,ratecity/keystone,naustudio/keystone,pr1ntr/keystone,frontyard/keystone,efernandesng/keystone,tony2cssc/keystone,WingedToaster/keystone,kittens/keystone,unsworn/keystone,suryagh/keystone,mbayfield/keystone,kloudsio/keystone,Yaska/keystone,mikaoelitiana/keystone,akoesnan/keystone,DenisNeustroev/keystone,geminiyellow/keystone,udp/keystone,akoesnan/keystone,jacargentina/keystone,Pylipala/keystone,codevlabs/keystone,ONode/keystone,matthieugayon/keystone,wustxing/keystone,SlashmanX/keystone,everisARQ/keystone,gemscng/keystone,KZackery/keystone,mekanics/keystone,gcortese/keystone,wilsonfletcher/keystone,lastjune/keystone,mikaoelitiana/keystone,dryna/keystone-twoje-urodziny,trystant/keystone,Yaska/keystone,47pages/keystone,KZackery/keystone,codevlabs/keystone,onenorth/keystone,alobodig/keystone"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10232,
            "row": {
                "commit": "d8e974af5d9ed4bfdf5c13140fe94895b15dd485",
                "old_file": "test/jsonpatch_spec.js",
                "new_file": "test/jsonpatch_spec.js",
                "old_contents": "if ('function' === typeof require) {\n  var jsonpatch = require('../lib/jsonpatch');\n}\n\ndescribe('JSONPointer', function () {\n  var example;\n  beforeEach(function () {\n    example = {\n      \"foo\": {\n        \"anArray\": [\n          { \"prop\": 44 },\n          \"second\",\n          \"third\"\n        ],\n        \"another prop\": {\n          \"baz\": \"A string\"\n        }\n      }\n    };\n  });\n\n  describe('.add()', function () {\n    var add;\n    beforeEach(function () {\n      add = function (path, doc, value) {\n        return (new jsonpatch.JSONPointer(path)).add(doc, value);\n      }\n    });\n\n    it('should add a element to an object', function () {\n      example = add('/foo/newprop',example,'test');\n      expect(example.foo.newprop).toEqual('test');\n    });\n    it('should add an element to list, pushing up the remaing values', function () {\n      example = add('/foo/anArray/1',example,'test');\n      expect(example.foo.anArray.length).toEqual(4);\n      expect(example.foo.anArray[1]).toEqual('test');\n      expect(example.foo.anArray[2]).toEqual('second');\n    });\n\n    it('should allow adding to the end of an array', function () {\n      example = add('/foo/anArray/3',example,'test');\n      expect(example.foo.anArray.length).toEqual(4);\n      expect(example.foo.anArray[3]).toEqual('test');\n    });\n    \n    it('should allow adding to the end of an array', function () {\n      example = add('/foo/anArray/-',example,'test');\n      expect(example.foo.anArray.length).toEqual(4);\n      expect(example.foo.anArray[3]).toEqual('test');\n    });\n\n    it('should fail if the object value already exists', function () {\n      expect(function () {\n        add('/foo/another prop',example,'test');\n      }).toThrow(new jsonpatch.PatchApplyError('Add operation must not point to an existing value!'));\n    });\n\n    it('should fail if adding to an array would create a sparse array', function () {\n      expect(function () {\n        add('/foo/anArray/4',example,'test');\n      }).toThrow(new jsonpatch.PatchApplyError('Add operation must not attempt to create a sparse array!'));\n    });\n\n    it('should should fail if the place to add specified does not exist', function () {\n      expect(function () {\n        add('/foo/newprop/alsonew',example,'test');\n      }).toThrow(new jsonpatch.PatchApplyError('Path not found in document'));\n    });\n\n    it('should should fail when trying to add the root to a non-undefined value', function () {\n      expect(function () {\n        add('',example,'test');\n      }).toThrow(new jsonpatch.PatchApplyError('Add operation must not point to an existing value!'));\n    });\n\n    it('should should succeed if replacing the root in undefined ', function () {\n      expect(add('',undefined,'test')).toEqual('test');\n    });\n  });\n\n  describe('.remove()', function () {\n    function do_remove(pointerStr, doc) {\n      return (new jsonpatch.JSONPointer(pointerStr)).remove(doc);\n    }\n\n    it('should remove an object key', function () {\n      example = do_remove(\"/foo\", example);\n      expect(example.foo).toBeUndefined();\n    });\n\n    it('should remove an item from an array', function () {\n      example = do_remove(\"/foo/anArray/1\", example);\n      expect(example.foo.anArray.length).toEqual(2);\n      expect(example.foo.anArray[1]).toEqual('third');\n    });\n\n    it('should fail if the object key specified doesnt exist', function () {\n      expect(function () {do_remove('/foo/notthere', example);}).toThrow(new jsonpatch.PatchApplyError('Remove operation must point to an existing value!'));\n    });\n\n    it('should should fail if the path specified doesnt exist', function () {\n      expect(function () {do_remove('/foo/notthere/orhere', example);}).toThrow(new jsonpatch.PatchApplyError('Path not found in document'));\n    });\n\n    it('should fail if the array element specified doesnt exist', function () {\n      expect(function () {do_remove('/foo/anArray/4', example);}).toThrow(new jsonpatch.PatchApplyError('Remove operation must point to an existing value!'));\n    });\n\n    it('should return undefined when removing the root', function () {\n      expect(do_remove('', example)).toBeUndefined();\n    });\n  });\n\n  describe('.get()', function () {\n    function do_get(pointerStr, doc) {\n      return (new jsonpatch.JSONPointer(pointerStr)).get(doc);\n    }\n\n    describe('JSONPointer examples', function () {\n      var doc = {\n        \"foo\": [\"bar\", \"baz\"],\n        \"numbers\": [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],\n        \"\": 0,\n        \"a/b\": 1,\n        \"c%d\": 2,\n        \"e^f\": 3,\n        \"g|h\": 4,\n        \"i\\\\j\": 5,\n        \"k\\\"l\": 6,\n        \" \": 7,\n        \"m~n\": 8\n      };\n\n      var examples = {\n        // Examples from the spec document\n        \"\"     :doc,\n        \"/foo\"  :[\"bar\", \"baz\"],\n        \"/foo/0\":\"bar\",\n        \"/\"     :0,\n        \"/a~1b\" :1,\n        \"/c%d\"  :2,\n        \"/e^f\"  :3,\n        \"/g|h\"  :4,\n        \"/i\\\\j\" :5,\n        \"/k\\\"l\" :6,\n        \"/ \"    :7,\n        \"/m~0n\" :8,\n        // Extra examples\n        \"/numbers/010\": 10,\n        \"/numbers/00010\": 10,\n        \"/numbers/-\": undefined\n      };\n\n      for (var example in examples) {\n        (function (example) {\n          it('should get the correct pointed object for example \"' + example + '\"', function () {\n            expect(do_get(example, doc)).toEqual(examples[example]);\n          });\n        })(example);\n      }\n    });\n\n    it('should get the object pointed to', function () {\n      expect(do_get('/foo/another prop/baz', example)).toEqual('A string');\n    });\n\n    it('should get the array element pointed to', function () {\n      expect(do_get('/foo/anArray/1', example)).toEqual('second');\n    });\n  });\n});\n\ndescribe('JSONPatch', function () {\n  var patch;\n  describe('constructor', function () {\n    it('should accept a JSON string as a patch', function () {\n      patch = new jsonpatch.JSONPatch('[{\"op\":\"remove\", \"path\":\"/\"}]');\n      expect(patch = patch.compiledOps.length).toEqual(1);\n    });\n    it('should accept a JS object as a patch', function () {\n      patch = new jsonpatch.JSONPatch([{\"op\":\"remove\", \"path\":\"/\"}, {\"op\":\"remove\", \"path\":\"/\"}]);\n      expect(patch.compiledOps.length).toEqual(2);\n    });\n    it('should raise an error for  patches that arent arrays', function () {\n      expect(function () {patch = new jsonpatch.JSONPatch({});}).toThrow(new jsonpatch.InvalidPatch('Patch must be an array of operations'));\n    });\n    it('should raise an error if value is not supplied for add or replace operation', function () {\n      expect(function () {patch = new jsonpatch.JSONPatch([{op:\"add\", path:'/'}]);}).toThrow(new jsonpatch.InvalidPatch('add must have key value'));\n      expect(function () {patch = new jsonpatch.JSONPatch([{op:\"replace\", path:'/'}]);}).toThrow(new jsonpatch.InvalidPatch('replace must have key value'));\n    });\n    it('should raise an error if an operation is not specified', function () {\n      expect(function () {patch = new jsonpatch.JSONPatch([{}]);}).toThrow(new jsonpatch.InvalidPatch('Operation missing!'));\n    });\n    it('should raise an error if un-recognised operation is specified', function () {\n      expect(function () {patch = new jsonpatch.JSONPatch([{op:\"blam\"}]);}).toThrow(new jsonpatch.InvalidPatch('Invalid operation!'));\n    });\n\n  });\n\n\n  \n  it('should not mutate the source document', function () {\n    var doc = {\n      \"foo\": {\n        \"anArray\": [\n          { \"prop\": 44 },\n          \"second\",\n          \"third\"\n        ],\n        \"another prop\": {\n          \"baz\": \"A string\"\n        }\n      }\n    };\n    var json = JSON.stringify(doc);\n    var patch = [\n      {\"op\": \"remove\", \"path\": \"/foo/another prop/baz\"},\n      {\"op\": \"add\", \"path\": \"/foo/new\", \"value\": \"hello\"},\n      {\"op\": \"move\", \"path\": \"/foo/new\", \"to\": \"/newnew\"},\n      {\"op\": \"copy\", \"path\": \"/foo/anArray/1\", \"to\": \"/foo/anArray/-\"},\n      {\"op\": \"test\", \"path\": \"/foo/anArray/3\", \"value\": \"second\"}\n    ];\n    var patched = jsonpatch.apply_patch(doc, patch);\n    // Check that the doc has not been mutated\n    expect(JSON.stringify(doc)).toEqual(json)\n  });\n\n  // describe('._operations', function () {\n  // });\n\n  describe('.apply()', function () {\n    var patch;\n    it('should call each operation in turn', function () {\n      patch = new jsonpatch.JSONPatch([]);\n      var callOrder = [];\n      function mockOp(name) {\n        return function(doc) {\n          expect(doc).toEqual('TEST_DOC');\n          callOrder.push(name);\n          return doc;\n        };\n      }\n      patch.compiledOps = [mockOp('one'),mockOp('two'),mockOp('three')];\n      patch.apply('TEST_DOC');\n      expect(callOrder[0]).toEqual('one');\n      expect(callOrder[2]).toEqual('three');\n    });\n  });\n\n  describe('Examples from the JSON Patch draft', function () {\n    function deepEqual(a,b) {\n      var key;\n      if (typeof a !== typeof b) {\n        return false;\n      }\n      if ('object' === typeof(a)) {\n        for(key in a) {\n          if (!(key in b && deepEqual(a[key], b[key]))) {\n            return false;\n          }\n        }\n        for(key in b) {\n          if (!(key in a)) {\n            return false;\n          }\n        }\n        return true;\n      } else {\n        return a === b;\n      }\n    }\n\n    var check = function (example) {\n      var documentUnderTest = jsonpatch.apply_patch(example.doc, example.patch);\n      var eq = deepEqual(\n          documentUnderTest,\n          example.result\n        );\n      if (!eq) {\n        console.log('\\n',documentUnderTest, '\\n', example.result);\n      }\n      expect(eq).toEqual(true);\n    };\n\n\n    var examples = {\n      \n      'A.1.  Adding an Object Member': {\n        doc: {\n          \"foo\": \"bar\"\n        },\n        patch: [\n          { \"op\": \"add\", \"path\": \"/baz\", \"value\": \"qux\" }\n        ],\n        result: {\n          \"baz\": \"qux\",\n          \"foo\": \"bar\"\n       }\n      },\n      \n      'A.2.  Adding an Array Element': {\n        doc:{\n          \"foo\": [ \"bar\", \"baz\" ]\n        },\n        patch: [\n          { \"op\": \"add\", \"path\": \"/foo/1\", \"value\": \"qux\" }\n        ],\n        result: {\n          \"foo\": [ \"bar\", \"qux\", \"baz\" ]\n        }\n      },\n      \n      'A.3.  Removing an Object Member': {\n        doc: {\n          \"baz\": \"qux\",\n          \"foo\": \"bar\"\n        },\n        patch: [\n          { \"op\": \"remove\", \"path\": \"/baz\" }\n        ],\n        result: {\n          \"foo\": \"bar\"\n        }\n      },\n      \n      'A.4.  Removing an Array Element': {\n        doc: {\n          \"foo\": [ \"bar\", \"qux\", \"baz\" ]\n        },\n        patch: [\n          { \"op\": \"remove\", \"path\": \"/foo/1\" }\n        ],\n        result: {\n          \"foo\": [ \"bar\", \"baz\" ]\n        }\n      },\n      \n      'A.5.  Replacing a Value': {\n        doc: {\n          \"baz\": \"qux\",\n          \"foo\": \"bar\"\n        },\n        patch: [\n          { \"op\": \"replace\", \"path\": \"/baz\", \"value\": \"boo\" }\n        ],\n        result: {\n          \"baz\": \"boo\",\n          \"foo\": \"bar\"\n        }\n      },\n      \n      'A.6.  Moving a Value': {\n        doc: {\n          \"foo\": {\n            \"bar\": \"baz\",\n            \"waldo\": \"fred\"\n          },\n          \"qux\": {\n            \"corge\": \"grault\"\n          }\n       },\n       patch: [\n          { \"op\": \"move\", \"path\": \"/foo/waldo\", \"to\": \"/qux/thud\" }\n       ],\n       result: {\n          \"foo\": {\n            \"bar\": \"baz\"\n          },\n          \"qux\": {\n            \"corge\": \"grault\",\n            \"thud\": \"fred\"\n          }\n        }\n      },\n      \n      'A.7.  Moving an Array Element': {\n        doc: {\n          \"foo\": [ \"all\", \"grass\", \"cows\", \"eat\" ]\n        },\n        patch: [\n          { \"op\": \"move\", \"path\": \"/foo/1\", \"to\": \"/foo/3\" }\n        ],\n        result: {\n          \"foo\": [ \"all\", \"cows\", \"eat\", \"grass\" ]\n        }\n      },\n      \n      'A.8.  Testing a Value: Success': {\n        doc: {\n          \"baz\": \"qux\",\n          \"foo\": [ \"a\", 2, \"c\" ]\n        },\n        patch: [\n          { \"op\": \"test\", \"path\": \"/baz\", \"value\": \"qux\" },\n          { \"op\": \"test\", \"path\": \"/foo/1\", \"value\": 2 }\n        ],\n        result: {\n          \"baz\": \"qux\",\n          \"foo\": [ \"a\", 2, \"c\" ]\n        }\n      },\n\n      // See below for A.9 (it returns an error so has to handled\n      // differently)\n      \n      'A.10.  Adding a nested Member Object': {\n        doc: {\n          \"foo\": \"bar\"\n        },\n        patch: [\n          { \"op\": \"add\", \"path\": \"/child\", \"value\": { \"grandchild\": {} } }\n        ],\n        result: {\n          \"foo\": \"bar\",\n          \"child\": {\n            \"grandchild\": {}\n          }\n        }\n      },\n      \n      'A.10.   Ignoring Unrecognized Elements': {\n        doc: {\n          \"foo\": \"bar\"\n        },\n        patch: [\n          { \"op\":\"add\", \"path\":\"/baz\", \"value\":\"qux\", \"xyz\":123 }\n        ],\n        result: {\n          \"foo\":\"bar\",\n          \"baz\":\"qux\"\n        }\n      },\n      // See below for A.11 (it returns an error so has to be done in\n      // a different way)\n      \n      // The spec is a little unclear about what the result of A.12\n      // should be, but it is clear that it SHOULD NOT be interpreted\n      // as an add operation.\n      'A.12.   Invalid JSON Patch Document': {\n        doc: {\n          \"baz\": \"hello\"\n        },\n        patch: \"[{ \\\"op\\\":\\\"add\\\", \\\"path\\\":\\\"/baz\\\", \\\"value\\\":\\\"qux\\\", \\\"op\\\":\\\"remove\\\" }]\",\n        result: {\n        }\n      },\n\n      // Some extra examples not from the spec\n\n      'Test value with lots of types': {\n        doc: {\n          \"baz\": \"qux\",\n          \"foo\": [ \"a\", 2, \"c\" , true, [-1], {a:'b'}]\n        },\n        patch: [\n          { \"op\": \"test\", \"path\": \"\", \"value\": {\"baz\": \"qux\", \"foo\": [ \"a\", 2, \"c\" , true, [-1], {a:'b'}]} }\n        ],\n        result: {\n          \"baz\": \"qux\",\n          \"foo\": [ \"a\", 2, \"c\" , true, [-1], {a:'b'}]\n        }\n      }\n    };\n\n    for (var name in examples) {\n      (function (name) {\n        it(name, function () { check(examples[name]); });\n      })(name);\n    }\n\n    it('A.9.  Testing a Value: Error', function () {\n      var doc = {\n       \"baz\": \"qux\"\n      };\n      expect(function () {\n        jsonpatch.apply_patch(doc, [{ \"op\": \"test\", \"path\": \"/baz\", \"value\": \"bar\" }]);\n      }).toThrow(new jsonpatch.PatchApplyError(\"Test operation failed. Value did not match.\"));\n    });\n\n    it('A.12.  Adding to a Non-existant Target', function () {\n      var doc = {\n        \"foo\": \"bar\"\n      };\n      expect(function () {\n        jsonpatch.apply_patch(doc, [{ \"op\": \"add\", \"path\": \"/baz/bat\", \"value\": \"qux\" }]);\n      }).toThrow(new jsonpatch.InvalidPatch('Path not found in document'));\n    });\n\n\n  });\n\n  describe('to attribute', function () {\n    it('MUST NOT be part of the location specified by \"path\" in a move operation', function () {\n      var doc = {a:{b:true, c:false}};\n      expect(function () {\n        jsonpatch.apply_patch(doc, [{op: 'move', path: '/a', to: '/a/b'}]);\n      }).toThrow(new jsonpatch.InvalidPatch('destination must not be a child of source'));\n    });\n    it('MUST NOT be part of the location specified by \"path\" in a copy operation', function () {\n      var doc = {a:{b:true, c:false}};\n      expect(function () {\n        jsonpatch.apply_patch(doc, [{op: 'copy', path: '/a', to: '/a/b'}]);\n      }).toThrow(new jsonpatch.InvalidPatch('destination must not be a child of source'));\n    });\n    it('MUST ALLOW source to start with the destinations string as long as one is not actually a subset of the other', function () {\n      var doc = {a:{b:true, c:false}};\n      jsonpatch.apply_patch(doc, [{op: 'copy', path: '/a', to: '/ab'}]);\n    });\n  });\n\n  describe('Regressions', function () {\n    it('should reject unknown patch operations (even if they are properties of the base Object)', function () {\n      expect(function () {\n        new jsonpatch.JSONPatch([{op:'hasOwnProperty', path:'/'}]);\n      }).toThrow(new jsonpatch.InvalidPatch('Invalid operation!'));\n    });\n  });\n\n  describe('Atomicity', function () {\n    it ('should not apply the patch if any of the operations fails, and the original object should be unaffected', function () {\n      var doc = {\n        \"alpha\": 1,\n        \"omega\": \"lots\"\n      };\n\n      expect(function () {\n        jsonpatch.apply_patch(doc, [\n          {\"op\": \"add\", \"path\": \"/delta\", \"value\": 2},\n          {\"op\": \"replace\", \"path\": \"/beta///\", \"value\": 2}\n        ]);\n      }).toThrow(new Error('Path not found in document'));\n\n\n      expect(doc.beta).toEqual(undefined);\n      //expect(doc.delta).toEqual(undefined);\n    });\n  });\n\n});\n",
                "new_contents": "if ('function' === typeof require && jsonpatch == null) {\n  var jsonpatch = require('../lib/jsonpatch');\n}\n\ndescribe('JSONPointer', function () {\n  var example;\n  beforeEach(function () {\n    example = {\n      \"foo\": {\n        \"anArray\": [\n          { \"prop\": 44 },\n          \"second\",\n          \"third\"\n        ],\n        \"another prop\": {\n          \"baz\": \"A string\"\n        }\n      }\n    };\n  });\n\n  describe('.add()', function () {\n    var add;\n    beforeEach(function () {\n      add = function (path, doc, value) {\n        return (new jsonpatch.JSONPointer(path)).add(doc, value);\n      }\n    });\n\n    it('should add a element to an object', function () {\n      example = add('/foo/newprop',example,'test');\n      expect(example.foo.newprop).toEqual('test');\n    });\n    it('should add an element to list, pushing up the remaing values', function () {\n      example = add('/foo/anArray/1',example,'test');\n      expect(example.foo.anArray.length).toEqual(4);\n      expect(example.foo.anArray[1]).toEqual('test');\n      expect(example.foo.anArray[2]).toEqual('second');\n    });\n\n    it('should allow adding to the end of an array', function () {\n      example = add('/foo/anArray/3',example,'test');\n      expect(example.foo.anArray.length).toEqual(4);\n      expect(example.foo.anArray[3]).toEqual('test');\n    });\n    \n    it('should allow adding to the end of an array', function () {\n      example = add('/foo/anArray/-',example,'test');\n      expect(example.foo.anArray.length).toEqual(4);\n      expect(example.foo.anArray[3]).toEqual('test');\n    });\n\n    it('should fail if the object value already exists', function () {\n      expect(function () {\n        add('/foo/another prop',example,'test');\n      }).toThrow(new jsonpatch.PatchApplyError('Add operation must not point to an existing value!'));\n    });\n\n    it('should fail if adding to an array would create a sparse array', function () {\n      expect(function () {\n        add('/foo/anArray/4',example,'test');\n      }).toThrow(new jsonpatch.PatchApplyError('Add operation must not attempt to create a sparse array!'));\n    });\n\n    it('should should fail if the place to add specified does not exist', function () {\n      expect(function () {\n        add('/foo/newprop/alsonew',example,'test');\n      }).toThrow(new jsonpatch.PatchApplyError('Path not found in document'));\n    });\n\n    it('should should fail when trying to add the root to a non-undefined value', function () {\n      expect(function () {\n        add('',example,'test');\n      }).toThrow(new jsonpatch.PatchApplyError('Add operation must not point to an existing value!'));\n    });\n\n    it('should should succeed if replacing the root in undefined ', function () {\n      expect(add('',undefined,'test')).toEqual('test');\n    });\n  });\n\n  describe('.remove()', function () {\n    function do_remove(pointerStr, doc) {\n      return (new jsonpatch.JSONPointer(pointerStr)).remove(doc);\n    }\n\n    it('should remove an object key', function () {\n      example = do_remove(\"/foo\", example);\n      expect(example.foo).toBeUndefined();\n    });\n\n    it('should remove an item from an array', function () {\n      example = do_remove(\"/foo/anArray/1\", example);\n      expect(example.foo.anArray.length).toEqual(2);\n      expect(example.foo.anArray[1]).toEqual('third');\n    });\n\n    it('should fail if the object key specified doesnt exist', function () {\n      expect(function () {do_remove('/foo/notthere', example);}).toThrow(new jsonpatch.PatchApplyError('Remove operation must point to an existing value!'));\n    });\n\n    it('should should fail if the path specified doesnt exist', function () {\n      expect(function () {do_remove('/foo/notthere/orhere', example);}).toThrow(new jsonpatch.PatchApplyError('Path not found in document'));\n    });\n\n    it('should fail if the array element specified doesnt exist', function () {\n      expect(function () {do_remove('/foo/anArray/4', example);}).toThrow(new jsonpatch.PatchApplyError('Remove operation must point to an existing value!'));\n    });\n\n    it('should return undefined when removing the root', function () {\n      expect(do_remove('', example)).toBeUndefined();\n    });\n  });\n\n  describe('.get()', function () {\n    function do_get(pointerStr, doc) {\n      return (new jsonpatch.JSONPointer(pointerStr)).get(doc);\n    }\n\n    describe('JSONPointer examples', function () {\n      var doc = {\n        \"foo\": [\"bar\", \"baz\"],\n        \"numbers\": [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],\n        \"\": 0,\n        \"a/b\": 1,\n        \"c%d\": 2,\n        \"e^f\": 3,\n        \"g|h\": 4,\n        \"i\\\\j\": 5,\n        \"k\\\"l\": 6,\n        \" \": 7,\n        \"m~n\": 8\n      };\n\n      var examples = {\n        // Examples from the spec document\n        \"\"     :doc,\n        \"/foo\"  :[\"bar\", \"baz\"],\n        \"/foo/0\":\"bar\",\n        \"/\"     :0,\n        \"/a~1b\" :1,\n        \"/c%d\"  :2,\n        \"/e^f\"  :3,\n        \"/g|h\"  :4,\n        \"/i\\\\j\" :5,\n        \"/k\\\"l\" :6,\n        \"/ \"    :7,\n        \"/m~0n\" :8,\n        // Extra examples\n        \"/numbers/010\": 10,\n        \"/numbers/00010\": 10,\n        \"/numbers/-\": undefined\n      };\n\n      for (var example in examples) {\n        (function (example) {\n          it('should get the correct pointed object for example \"' + example + '\"', function () {\n            expect(do_get(example, doc)).toEqual(examples[example]);\n          });\n        })(example);\n      }\n    });\n\n    it('should get the object pointed to', function () {\n      expect(do_get('/foo/another prop/baz', example)).toEqual('A string');\n    });\n\n    it('should get the array element pointed to', function () {\n      expect(do_get('/foo/anArray/1', example)).toEqual('second');\n    });\n  });\n});\n\ndescribe('JSONPatch', function () {\n  var patch;\n  describe('constructor', function () {\n    it('should accept a JSON string as a patch', function () {\n      patch = new jsonpatch.JSONPatch('[{\"op\":\"remove\", \"path\":\"/\"}]');\n      expect(patch = patch.compiledOps.length).toEqual(1);\n    });\n    it('should accept a JS object as a patch', function () {\n      patch = new jsonpatch.JSONPatch([{\"op\":\"remove\", \"path\":\"/\"}, {\"op\":\"remove\", \"path\":\"/\"}]);\n      expect(patch.compiledOps.length).toEqual(2);\n    });\n    it('should raise an error for  patches that arent arrays', function () {\n      expect(function () {patch = new jsonpatch.JSONPatch({});}).toThrow(new jsonpatch.InvalidPatch('Patch must be an array of operations'));\n    });\n    it('should raise an error if value is not supplied for add or replace operation', function () {\n      expect(function () {patch = new jsonpatch.JSONPatch([{op:\"add\", path:'/'}]);}).toThrow(new jsonpatch.InvalidPatch('add must have key value'));\n      expect(function () {patch = new jsonpatch.JSONPatch([{op:\"replace\", path:'/'}]);}).toThrow(new jsonpatch.InvalidPatch('replace must have key value'));\n    });\n    it('should raise an error if an operation is not specified', function () {\n      expect(function () {patch = new jsonpatch.JSONPatch([{}]);}).toThrow(new jsonpatch.InvalidPatch('Operation missing!'));\n    });\n    it('should raise an error if un-recognised operation is specified', function () {\n      expect(function () {patch = new jsonpatch.JSONPatch([{op:\"blam\"}]);}).toThrow(new jsonpatch.InvalidPatch('Invalid operation!'));\n    });\n\n  });\n\n\n  \n  it('should not mutate the source document', function () {\n    var doc = {\n      \"foo\": {\n        \"anArray\": [\n          { \"prop\": 44 },\n          \"second\",\n          \"third\"\n        ],\n        \"another prop\": {\n          \"baz\": \"A string\"\n        }\n      }\n    };\n    var json = JSON.stringify(doc);\n    var patch = [\n      {\"op\": \"remove\", \"path\": \"/foo/another prop/baz\"},\n      {\"op\": \"add\", \"path\": \"/foo/new\", \"value\": \"hello\"},\n      {\"op\": \"move\", \"path\": \"/foo/new\", \"to\": \"/newnew\"},\n      {\"op\": \"copy\", \"path\": \"/foo/anArray/1\", \"to\": \"/foo/anArray/-\"},\n      {\"op\": \"test\", \"path\": \"/foo/anArray/3\", \"value\": \"second\"}\n    ];\n    var patched = jsonpatch.apply_patch(doc, patch);\n    // Check that the doc has not been mutated\n    expect(JSON.stringify(doc)).toEqual(json)\n  });\n\n  // describe('._operations', function () {\n  // });\n\n  describe('.apply()', function () {\n    var patch;\n    it('should call each operation in turn', function () {\n      patch = new jsonpatch.JSONPatch([]);\n      var callOrder = [];\n      function mockOp(name) {\n        return function(doc) {\n          expect(doc).toEqual('TEST_DOC');\n          callOrder.push(name);\n          return doc;\n        };\n      }\n      patch.compiledOps = [mockOp('one'),mockOp('two'),mockOp('three')];\n      patch.apply('TEST_DOC');\n      expect(callOrder[0]).toEqual('one');\n      expect(callOrder[2]).toEqual('three');\n    });\n  });\n\n  describe('Examples from the JSON Patch draft', function () {\n    function deepEqual(a,b) {\n      var key;\n      if (typeof a !== typeof b) {\n        return false;\n      }\n      if ('object' === typeof(a)) {\n        for(key in a) {\n          if (!(key in b && deepEqual(a[key], b[key]))) {\n            return false;\n          }\n        }\n        for(key in b) {\n          if (!(key in a)) {\n            return false;\n          }\n        }\n        return true;\n      } else {\n        return a === b;\n      }\n    }\n\n    var check = function (example) {\n      var documentUnderTest = jsonpatch.apply_patch(example.doc, example.patch);\n      var eq = deepEqual(\n          documentUnderTest,\n          example.result\n        );\n      if (!eq) {\n        console.log('\\n',documentUnderTest, '\\n', example.result);\n      }\n      expect(eq).toEqual(true);\n    };\n\n\n    var examples = {\n      \n      'A.1.  Adding an Object Member': {\n        doc: {\n          \"foo\": \"bar\"\n        },\n        patch: [\n          { \"op\": \"add\", \"path\": \"/baz\", \"value\": \"qux\" }\n        ],\n        result: {\n          \"baz\": \"qux\",\n          \"foo\": \"bar\"\n       }\n      },\n      \n      'A.2.  Adding an Array Element': {\n        doc:{\n          \"foo\": [ \"bar\", \"baz\" ]\n        },\n        patch: [\n          { \"op\": \"add\", \"path\": \"/foo/1\", \"value\": \"qux\" }\n        ],\n        result: {\n          \"foo\": [ \"bar\", \"qux\", \"baz\" ]\n        }\n      },\n      \n      'A.3.  Removing an Object Member': {\n        doc: {\n          \"baz\": \"qux\",\n          \"foo\": \"bar\"\n        },\n        patch: [\n          { \"op\": \"remove\", \"path\": \"/baz\" }\n        ],\n        result: {\n          \"foo\": \"bar\"\n        }\n      },\n      \n      'A.4.  Removing an Array Element': {\n        doc: {\n          \"foo\": [ \"bar\", \"qux\", \"baz\" ]\n        },\n        patch: [\n          { \"op\": \"remove\", \"path\": \"/foo/1\" }\n        ],\n        result: {\n          \"foo\": [ \"bar\", \"baz\" ]\n        }\n      },\n      \n      'A.5.  Replacing a Value': {\n        doc: {\n          \"baz\": \"qux\",\n          \"foo\": \"bar\"\n        },\n        patch: [\n          { \"op\": \"replace\", \"path\": \"/baz\", \"value\": \"boo\" }\n        ],\n        result: {\n          \"baz\": \"boo\",\n          \"foo\": \"bar\"\n        }\n      },\n      \n      'A.6.  Moving a Value': {\n        doc: {\n          \"foo\": {\n            \"bar\": \"baz\",\n            \"waldo\": \"fred\"\n          },\n          \"qux\": {\n            \"corge\": \"grault\"\n          }\n       },\n       patch: [\n          { \"op\": \"move\", \"path\": \"/foo/waldo\", \"to\": \"/qux/thud\" }\n       ],\n       result: {\n          \"foo\": {\n            \"bar\": \"baz\"\n          },\n          \"qux\": {\n            \"corge\": \"grault\",\n            \"thud\": \"fred\"\n          }\n        }\n      },\n      \n      'A.7.  Moving an Array Element': {\n        doc: {\n          \"foo\": [ \"all\", \"grass\", \"cows\", \"eat\" ]\n        },\n        patch: [\n          { \"op\": \"move\", \"path\": \"/foo/1\", \"to\": \"/foo/3\" }\n        ],\n        result: {\n          \"foo\": [ \"all\", \"cows\", \"eat\", \"grass\" ]\n        }\n      },\n      \n      'A.8.  Testing a Value: Success': {\n        doc: {\n          \"baz\": \"qux\",\n          \"foo\": [ \"a\", 2, \"c\" ]\n        },\n        patch: [\n          { \"op\": \"test\", \"path\": \"/baz\", \"value\": \"qux\" },\n          { \"op\": \"test\", \"path\": \"/foo/1\", \"value\": 2 }\n        ],\n        result: {\n          \"baz\": \"qux\",\n          \"foo\": [ \"a\", 2, \"c\" ]\n        }\n      },\n\n      // See below for A.9 (it returns an error so has to handled\n      // differently)\n      \n      'A.10.  Adding a nested Member Object': {\n        doc: {\n          \"foo\": \"bar\"\n        },\n        patch: [\n          { \"op\": \"add\", \"path\": \"/child\", \"value\": { \"grandchild\": {} } }\n        ],\n        result: {\n          \"foo\": \"bar\",\n          \"child\": {\n            \"grandchild\": {}\n          }\n        }\n      },\n      \n      'A.10.   Ignoring Unrecognized Elements': {\n        doc: {\n          \"foo\": \"bar\"\n        },\n        patch: [\n          { \"op\":\"add\", \"path\":\"/baz\", \"value\":\"qux\", \"xyz\":123 }\n        ],\n        result: {\n          \"foo\":\"bar\",\n          \"baz\":\"qux\"\n        }\n      },\n      // See below for A.11 (it returns an error so has to be done in\n      // a different way)\n      \n      // The spec is a little unclear about what the result of A.12\n      // should be, but it is clear that it SHOULD NOT be interpreted\n      // as an add operation.\n      'A.12.   Invalid JSON Patch Document': {\n        doc: {\n          \"baz\": \"hello\"\n        },\n        patch: \"[{ \\\"op\\\":\\\"add\\\", \\\"path\\\":\\\"/baz\\\", \\\"value\\\":\\\"qux\\\", \\\"op\\\":\\\"remove\\\" }]\",\n        result: {\n        }\n      },\n\n      // Some extra examples not from the spec\n\n      'Test value with lots of types': {\n        doc: {\n          \"baz\": \"qux\",\n          \"foo\": [ \"a\", 2, \"c\" , true, [-1], {a:'b'}]\n        },\n        patch: [\n          { \"op\": \"test\", \"path\": \"\", \"value\": {\"baz\": \"qux\", \"foo\": [ \"a\", 2, \"c\" , true, [-1], {a:'b'}]} }\n        ],\n        result: {\n          \"baz\": \"qux\",\n          \"foo\": [ \"a\", 2, \"c\" , true, [-1], {a:'b'}]\n        }\n      }\n    };\n\n    for (var name in examples) {\n      (function (name) {\n        it(name, function () { check(examples[name]); });\n      })(name);\n    }\n\n    it('A.9.  Testing a Value: Error', function () {\n      var doc = {\n       \"baz\": \"qux\"\n      };\n      expect(function () {\n        jsonpatch.apply_patch(doc, [{ \"op\": \"test\", \"path\": \"/baz\", \"value\": \"bar\" }]);\n      }).toThrow(new jsonpatch.PatchApplyError(\"Test operation failed. Value did not match.\"));\n    });\n\n    it('A.12.  Adding to a Non-existant Target', function () {\n      var doc = {\n        \"foo\": \"bar\"\n      };\n      expect(function () {\n        jsonpatch.apply_patch(doc, [{ \"op\": \"add\", \"path\": \"/baz/bat\", \"value\": \"qux\" }]);\n      }).toThrow(new jsonpatch.InvalidPatch('Path not found in document'));\n    });\n\n\n  });\n\n  describe('to attribute', function () {\n    it('MUST NOT be part of the location specified by \"path\" in a move operation', function () {\n      var doc = {a:{b:true, c:false}};\n      expect(function () {\n        jsonpatch.apply_patch(doc, [{op: 'move', path: '/a', to: '/a/b'}]);\n      }).toThrow(new jsonpatch.InvalidPatch('destination must not be a child of source'));\n    });\n    it('MUST NOT be part of the location specified by \"path\" in a copy operation', function () {\n      var doc = {a:{b:true, c:false}};\n      expect(function () {\n        jsonpatch.apply_patch(doc, [{op: 'copy', path: '/a', to: '/a/b'}]);\n      }).toThrow(new jsonpatch.InvalidPatch('destination must not be a child of source'));\n    });\n    it('MUST ALLOW source to start with the destinations string as long as one is not actually a subset of the other', function () {\n      var doc = {a:{b:true, c:false}};\n      jsonpatch.apply_patch(doc, [{op: 'copy', path: '/a', to: '/ab'}]);\n    });\n  });\n\n  describe('Regressions', function () {\n    it('should reject unknown patch operations (even if they are properties of the base Object)', function () {\n      expect(function () {\n        new jsonpatch.JSONPatch([{op:'hasOwnProperty', path:'/'}]);\n      }).toThrow(new jsonpatch.InvalidPatch('Invalid operation!'));\n    });\n  });\n\n  describe('Atomicity', function () {\n    it ('should not apply the patch if any of the operations fails, and the original object should be unaffected', function () {\n      var doc = {\n        \"alpha\": 1,\n        \"omega\": \"lots\"\n      };\n\n      expect(function () {\n        jsonpatch.apply_patch(doc, [\n          {\"op\": \"add\", \"path\": \"/delta\", \"value\": 2},\n          {\"op\": \"replace\", \"path\": \"/beta///\", \"value\": 2}\n        ]);\n      }).toThrow(new Error('Path not found in document'));\n\n\n      expect(doc.beta).toEqual(undefined);\n      //expect(doc.delta).toEqual(undefined);\n    });\n  });\n\n});\n",
                "subject": "Check if jsonpatch.js is already loaded before loading from tests",
                "message": "Check if jsonpatch.js is already loaded before loading from tests\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "dharmafly/jsonpatch.js,dharmafly/jsonpatch.js"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10233,
            "row": {
                "commit": "6f61824572088d25e047aada0aee6520eaea0330",
                "old_file": "jquery.shapeshift.js",
                "new_file": "jquery.shapeshift.js",
                "old_contents": ";(function($,window,undefined) {\n  // Defaults\n  var pluginName = 'shapeshift',\n      document = window.document,\n      defaults = {\n        adjustContainerHeight: true,\n        animated: true,\n        animatedOnDrag: true,\n        draggable: true,\n        objWidth: null,\n        gutterX: 10,\n        gutterY: 10,\n        resizable: true,\n        selector: \"\"\n      };\n\n  function Plugin(element, options) {\n    this.element = element;\n    this.options = $.extend( {}, defaults, options);\n    this._defaults = defaults;\n    this._name = pluginName;\n    this.objPositions = [];\n    this.hoverObjPositions = [];\n    this.init();\n  }\n\n  Plugin.prototype.init = function() {\n    var ss = this,\n        options = ss.options;\n    ss.shiftit(options.animated);\n    if(options.draggable) { ss.draggable(); }\n    if(options.resizable) { ss.resizable(); }\n  };\n\n  Plugin.prototype.shiftit = function(animated) {\n    var options = this.options,\n        ss = this,\n        $container = $(ss.element),\n        $objects = $container.children(options.selector).filter(':visible'),\n        columns = 0,\n        colHeights = [],\n        colWidth = null;\n\n    if(!options.draggable) {\n      $container.droppable( \"destroy\" );\n      $objects.draggable( \"destroy\" );\n      $objects.droppable( \"destroy\" );\n    }\n\n    if(!options.objWidth) {\n      options.objWidth = $objects.first().outerWidth(true);\n    }\n    colWidth = options.objWidth + options.gutterX;\n\n    // Determine how many columns are currently active\n    columns = Math.floor($container.innerWidth() / colWidth);\n\n    // Create an array element for each column, which is then\n    // used to store that columns current height.\n    for(var i=0;i<columns;i++) {colHeights.push(0);}\n\n    // Loop over each element and determine what column it fits into\n    for(var obj_i=0;obj_i<$objects.length;obj_i++) {\n      var $obj = $($objects[obj_i]),\n          col = ss.shortestCol(colHeights),\n          height = $obj.outerHeight(true) + options.gutterY,\n          offsetX = colWidth * col,\n          offsetY = colHeights[col];\n\n      // Store the position to animate into place later\n      attributes = { left: offsetX, top: offsetY };\n      ss.objPositions[obj_i] = attributes;\n\n      // Increase the calculated total height of the current column\n      colHeights[col] += height;\n    }\n\n    // Animate / Move each object into place\n    for(var obj_i=0; obj_i < $objects.length; obj_i++) {\n      var $obj = $($objects[obj_i]),\n          attributes = ss.objPositions[obj_i];\n\n      if(!$obj.hasClass(\"moving\")) {\n        if(animated) {\n          $obj.stop(true, false).animate(attributes, 250);\n        } else {\n          $obj.css(attributes);\n        }\n      }\n    }\n\n    // Set the container height to match the tallest column\n    if (options.adjustContainerHeight) {\n      var col = ss.tallestCol(colHeights),\n          height = colHeights[col];\n      $container.css(\"height\", height);\n    }\n  }\n\n  Plugin.prototype.draggable = function () {\n    var options = this.options,\n        ss = this;\n\n    // Get our jQuery objects\n    var $container = $(this.element),\n        $objects = $container.children(options.selector).filter(':visible'),\n        $selected = null,\n        $hovered = null,\n        dragging = false;\n\n    $objects.draggable({\n      start: function(e) { dragStart($(this), e) },\n      drag: function(e) { dragObject($(this), e); }\n    });\n    $objects.droppable({ over: function() { enterObject($(this)); } });\n    $container.droppable({ drop: function() { dropObject(); } });\n\n    function dragStart($object, e) {\n      // Set the selected object\n      $selected = $object;\n      $selected.addClass(\"moving\");\n      ss.setHoverObjPositions();\n      ss.shiftit(options.animatedOnDrag);\n    }\n\n    function dragObject($object, e) {\n      if(!dragging) {\n        $objects = $container.children(options.selector).filter(':visible');\n        dragging = true;\n        intendedIndex = ss.getIntendedIndex($object, e);\n        $intendedObj = $($objects.not(\".moving\").get(intendedIndex));\n        $selected.insertBefore($intendedObj);\n        ss.shiftit(options.animatedOnDrag);\n        window.setTimeout(function() {\n          dragging = false;\n        }, 200);\n      }\n    }\n\n    function enterObject($hoveredObj) { $hovered = $hoveredObj; }\n\n    function dropObject() {\n      $selected.removeClass(\"moving\");\n      ss.shiftit(options.animateOnDrag);\n    }\n  }\n\n  Plugin.prototype.getIntendedIndex = function($object, e) {\n    var options = this.options,\n        ss = this,\n        $container = $(ss.element),\n        containerX = $container.offset().left,\n        containerY = $container.offset().top,\n        objectX = $object.offset().left,\n        objectY = $object.offset().top - containerY + options.gutterY + 10,\n        mouseX = e.pageX,\n        mouseY = e.pageY,\n        intentionX = objectX + ((mouseX - objectX) / 2),\n        intentionY = objectY + ((mouseY - objectY) / 2),\n        shortestDistance = 9999,\n        chosenIndex = 0;\n\n    for(hov_i=0;hov_i<ss.hoverObjPositions.length;hov_i++) {\n      attributes = ss.hoverObjPositions[hov_i];\n      if(intentionX > attributes.left && intentionY > attributes.top) {\n        xDist = intentionX - attributes.left;\n        yDist = intentionY - attributes.top;\n        distance = Math.sqrt((xDist * xDist) + (yDist * yDist));\n        if(distance < shortestDistance) {\n          shortestDistance = distance;\n          chosenIndex = hov_i;\n        }\n      }\n    }\n    return chosenIndex;\n  }\n\n  Plugin.prototype.setHoverObjPositions = function() {\n    var options = this.options,\n        ss = this,\n        $container = $(ss.element),\n        $objects = $container.children(options.selector).filter(':not(.moving):visible'),\n        columns = 0,\n        colHeights = [],\n        colWidth = options.objWidth + options.gutterX;\n\n    // Determine how many columns are currently active\n    columns = Math.floor($container.innerWidth() / colWidth);\n\n    // Create an array element for each column, which is then\n    // used to store that columns current height.\n    for(var i=0;i<columns;i++) {colHeights.push(0);}\n\n    // Loop over each element and determine what column it fits into\n    for(var obj_i=0;obj_i<$objects.length;obj_i++) {\n      var $obj = $($objects[obj_i]),\n          col = ss.shortestCol(colHeights),\n          height = $obj.outerHeight(true) + options.gutterY,\n          offsetX = colWidth * col,\n          offsetY = colHeights[col];\n\n      // Store the position to animate into place later\n      attributes = { left: offsetX, top: offsetY };\n      ss.hoverObjPositions[obj_i] = attributes;\n\n      // Increase the calculated total height of the current column\n      colHeights[col] += height;\n    }\n  }\n\n\n  Plugin.prototype.shortestCol = function (array) {\n    return $.inArray(Math.min.apply(window,array), array);\n  }\n\n  Plugin.prototype.tallestCol = function (array) {\n    return $.inArray(Math.max.apply(window,array), array);\n  }\n\n  Plugin.prototype.resizable = function () {\n    var ss = this,\n        options = ss.options,\n        resizing = false;\n\n    $(window).on(\"resize\", function() {\n      if(!resizing) {\n        resizing = true;\n        ss.shiftit(options.animated);\n        setTimeout(function() {\n          resizing = false;\n          ss.shiftit(options.animated);\n        }, 100);\n      }\n    });\n  }\n\n  // Prevent against multiple instantiations\n  $.fn[pluginName] = function ( options ) {\n    return this.each(function () {\n      $.data(this, 'plugin_' + pluginName, new Plugin( this, options ));\n    });\n  }\n\n}(jQuery, window));",
                "new_contents": ";(function($,window,undefined) {\n  // Defaults\n  var pluginName = 'shapeshift',\n      document = window.document,\n      defaults = {\n        adjustContainerHeight: true,\n        animated: true,\n        animatedOnDrag: true,\n        draggable: true,\n        objWidth: null,\n        gutterX: 10,\n        gutterY: 10,\n        resizable: true,\n        selector: \"\"\n      };\n\n  function Plugin(element, options) {\n    this.element = element;\n    this.options = $.extend( {}, defaults, options);\n    this._defaults = defaults;\n    this._name = pluginName;\n    this.objPositions = [];\n    this.hoverObjPositions = [];\n    this.init();\n  }\n\n  Plugin.prototype.init = function() {\n    var ss = this,\n        options = ss.options;\n    ss.shiftit(options.animated);\n    if(options.draggable) { ss.draggable(); }\n    if(options.resizable) { ss.resizable(); }\n  };\n\n  Plugin.prototype.shiftit = function(animated) {\n    var options = this.options,\n        ss = this,\n        $container = $(ss.element),\n        $objects = $container.children(options.selector).filter(':visible'),\n        columns = 0,\n        colHeights = [],\n        colWidth = null;\n\n    if(!options.draggable) {\n      $container.droppable( \"destroy\" );\n      $objects.draggable( \"destroy\" );\n      $objects.droppable( \"destroy\" );\n    }\n\n    if(!options.objWidth) {\n      options.objWidth = $objects.first().outerWidth(true);\n    }\n    colWidth = options.objWidth + options.gutterX;\n\n    // Determine how many columns are currently active\n    columns = Math.floor($container.innerWidth() / colWidth);\n\n    // Create an array element for each column, which is then\n    // used to store that columns current height.\n    for(var i=0;i<columns;i++) {colHeights.push(0);}\n\n    // Loop over each element and determine what column it fits into\n    for(var obj_i=0;obj_i<$objects.length;obj_i++) {\n      var $obj = $($objects[obj_i]),\n          col = ss.shortestCol(colHeights),\n          height = $obj.outerHeight(true) + options.gutterY,\n          offsetX = colWidth * col,\n          offsetY = colHeights[col];\n\n      // Store the position to animate into place later\n      attributes = { left: offsetX, top: offsetY };\n      ss.objPositions[obj_i] = attributes;\n\n      // Increase the calculated total height of the current column\n      colHeights[col] += height;\n    }\n\n    // Animate / Move each object into place\n    for(var obj_i=0; obj_i < $objects.length; obj_i++) {\n      var $obj = $($objects[obj_i]),\n          attributes = ss.objPositions[obj_i];\n\n      if(!$obj.hasClass(\"moving\")) {\n        if(animated) {\n          $obj.stop(true, false).animate(attributes, 250);\n        } else {\n          $obj.css(attributes);\n        }\n      }\n    }\n\n    // Set the container height to match the tallest column\n    if (options.adjustContainerHeight) {\n      var col = ss.tallestCol(colHeights),\n          height = colHeights[col];\n      $container.css(\"height\", height);\n    }\n  }\n\n  Plugin.prototype.draggable = function () {\n    var options = this.options,\n        ss = this;\n\n    // Get our jQuery objects\n    var $container = $(this.element),\n        $objects = $container.children(options.selector).filter(':visible'),\n        $selected = null,\n        $hovered = null,\n        dragging = false;\n\n    $objects.draggable({\n      containment: 'window',\n      cursor: 'move',\n      start: function(e) { dragStart($(this), e) },\n      drag: function(e) { dragObject($(this), e); }\n    });\n    $objects.droppable({ over: function() { enterObject($(this)); } });\n    $container.droppable({ drop: function() { dropObject(); } });\n\n    function dragStart($object, e) {\n      // Set the selected object\n      $selected = $object;\n      $selected.addClass(\"moving\");\n      ss.setHoverObjPositions();\n      ss.shiftit(options.animatedOnDrag);\n    }\n\n    function dragObject($object, e) {\n      if(!dragging) {\n        $objects = $container.children(options.selector).filter(':visible');\n        dragging = true;\n        intendedIndex = ss.getIntendedIndex($object, e);\n        $intendedObj = $($objects.not(\".moving\").get(intendedIndex));\n        $selected.insertBefore($intendedObj);\n        ss.shiftit(options.animatedOnDrag);\n        window.setTimeout(function() {\n          dragging = false;\n        }, 200);\n      }\n    }\n\n    function enterObject($hoveredObj) { $hovered = $hoveredObj; }\n\n    function dropObject() {\n      $selected.removeClass(\"moving\");\n      ss.shiftit(options.animateOnDrag);\n    }\n  }\n\n  Plugin.prototype.getIntendedIndex = function($object, e) {\n    var options = this.options,\n        ss = this,\n        $container = $(ss.element),\n        containerX = $container.offset().left,\n        containerY = $container.offset().top,\n        objectX = $object.offset().left,\n        objectY = $object.offset().top - containerY + options.gutterY + 10,\n        mouseX = e.pageX,\n        mouseY = e.pageY,\n        intentionX = objectX + ((mouseX - objectX) / 2),\n        intentionY = objectY + ((mouseY - objectY) / 2),\n        shortestDistance = 9999,\n        chosenIndex = 0;\n\n    for(hov_i=0;hov_i<ss.hoverObjPositions.length;hov_i++) {\n      attributes = ss.hoverObjPositions[hov_i];\n      if(intentionX > attributes.left && intentionY > attributes.top) {\n        xDist = intentionX - attributes.left;\n        yDist = intentionY - attributes.top;\n        distance = Math.sqrt((xDist * xDist) + (yDist * yDist));\n        if(distance < shortestDistance) {\n          shortestDistance = distance;\n          chosenIndex = hov_i;\n        }\n      }\n    }\n    return chosenIndex;\n  }\n\n  Plugin.prototype.setHoverObjPositions = function() {\n    var options = this.options,\n        ss = this,\n        $container = $(ss.element),\n        $objects = $container.children(options.selector).filter(':not(.moving):visible'),\n        columns = 0,\n        colHeights = [],\n        colWidth = options.objWidth + options.gutterX;\n\n    // Determine how many columns are currently active\n    columns = Math.floor($container.innerWidth() / colWidth);\n\n    // Create an array element for each column, which is then\n    // used to store that columns current height.\n    for(var i=0;i<columns;i++) {colHeights.push(0);}\n\n    // Loop over each element and determine what column it fits into\n    for(var obj_i=0;obj_i<$objects.length;obj_i++) {\n      var $obj = $($objects[obj_i]),\n          col = ss.shortestCol(colHeights),\n          height = $obj.outerHeight(true) + options.gutterY,\n          offsetX = colWidth * col,\n          offsetY = colHeights[col];\n\n      // Store the position to animate into place later\n      attributes = { left: offsetX, top: offsetY };\n      ss.hoverObjPositions[obj_i] = attributes;\n\n      // Increase the calculated total height of the current column\n      colHeights[col] += height;\n    }\n  }\n\n\n  Plugin.prototype.shortestCol = function (array) {\n    return $.inArray(Math.min.apply(window,array), array);\n  }\n\n  Plugin.prototype.tallestCol = function (array) {\n    return $.inArray(Math.max.apply(window,array), array);\n  }\n\n  Plugin.prototype.resizable = function () {\n    var ss = this,\n        options = ss.options,\n        resizing = false;\n\n    $(window).on(\"resize\", function() {\n      if(!resizing) {\n        resizing = true;\n        ss.shiftit(options.animated);\n        setTimeout(function() {\n          resizing = false;\n          ss.shiftit(options.animated);\n        }, 100);\n      }\n    });\n  }\n\n  // Prevent against multiple instantiations\n  $.fn[pluginName] = function ( options ) {\n    return this.each(function () {\n      $.data(this, 'plugin_' + pluginName, new Plugin( this, options ));\n    });\n  }\n\n}(jQuery, window));",
                "subject": "Constrain the draggable to the window",
                "message": "Constrain the draggable to the window\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "delboy1978uk/jquery.shapeshift,JacobShirley95/jquery.shapeshift,DanielGasperoni/jquery.shapeshift,GerHobbelt/jquery.shapeshift,RaghavRamesh/jquery.shapeshift"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10234,
            "row": {
                "commit": "deb1c7d0556ae2c02145415dcd3256556be11922",
                "old_file": "app/app/Board.js",
                "new_file": "app/app/Board.js",
                "old_contents": "/*\n\n Copyright (c) 2017 Jirtdan Team and other collaborators\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n\n */\n\n\"use strict\";\n/*jshint esversion: 6*/\nimport {ConnectionLine} from './controls/ConnectionLine.js'\n\n/**\n * Minimal height/width value for selection box to be appear.\n * The selection box will not appear unless its height and width\n * are greater that this number.\n * @type {number}\n */\nconst SELECTION_BOX_START_THRESHOLD = 10;\n\n/**\n * The workspace board object where all components are placed and\n * interact with each other.\n */\nexport class Board {\n\n    /**\n     * Constructor of the {@link Board} class.\n     * @param paper paper object of {@link Raphael} library.\n     */\n    constructor(paper) {\n        this.paper = paper;\n        this.connections = [];\n        this.controls = [];\n        this.isConnecting = false;\n        this.selectionBox = null;\n    }\n\n    /**\n     * Add the control to be controlled by current Board.\n     * @param {BaseControl} control any control\n     */\n    addControl(control) {\n        this.controls.push(control);\n    }\n\n    /**\n     * Start connection activity from {@link ConnectionPin} object.\n     * @param {ConnectionPin} pin pin where connection starts from\n     */\n    startConnection(pin) {\n        this.isConnecting = true;\n        this.inputPin = pin;\n    }\n\n    /**\n     * Decide automatically to start or finalize the connection\n     * activity depending on situation.\n     * In case of startConnection was called previously the connection\n     * will be finalized.\n     * @param {ConnectionPin} pin pin where connection goes to\n     */\n    startFinishConnection(pin) {\n        if (!this.isConnecting) {\n            this.startConnection(pin);\n            return;\n        }\n        this.finishConnection(pin);\n    }\n\n    /**\n     * Finalize the connection activity. The connection will be\n     * established with previously started connection pin and\n     * two pins will communicate.\n     * @param {ConnectionPin} pin object to be connected to\n     */\n    finishConnection(pin) {\n        if (!this.isConnecting) return;\n        if (this.inputPin == pin) return;\n\n        if (this.inputPin.canConnect(pin)) {\n            this.createConnection(this.inputPin, pin);\n        }\n        this.isConnecting = false;\n    }\n\n    /**\n     * Create new connection and add it to the list.\n     * @param {ConnectionPin} pin1 start of the connection line\n     * @param {ConnectionPin} pin2 end of the connection line.\n     */\n    createConnection(pin1, pin2) {\n        this.connections.push(new ConnectionLine(this, pin1, pin2));\n    }\n\n    /**\n     * Translate the start and end points of all connections visually,\n     * depending on pins they connect to.\n     * This method is fired on drag-drop of the control.\n     * @param {ConnectionPin} pin the pin that are being moved\n     * @param {number} x the coordinate on X axis\n     * @param {number} y the coordinate on Y axis.\n     */\n    translateConnections(pin, x, y) {\n        for (var i = 0; i < this.connections.length; i++) {\n            this.connections[i].onPinTranslate(pin, x, y);\n        }\n    }\n\n    /**\n     * Un-select all selected elements on {@link Board}.\n     */\n    unselect() {\n        for (let i = 0; i < this.connections.length; i++) {\n            let item = this.connections[i];\n            if (item.isSelected()) {\n                item.unselect();\n            }\n        }\n\n        for (let i = 0; i < this.controls.length; i++) {\n            let item = this.controls[i];\n            if (item.isSelected()) {\n                item.unselect();\n            }\n        }\n    }\n\n    /**\n     * Delete the connection lines given in elements array.\n     * @param {ConnectionLine[]} elements connection lines to be deleted.\n     */\n    deleteConnectionLines(elements) {\n        for (let i = 0; i < elements.length; i++) {\n            let item = elements[i];\n            item.disconnect();\n            this.connections[this.connections.indexOf(item)] = null;\n        }\n\n        let newConnections = [];\n        for (let i = 0; i < this.connections.length; i++) {\n            let item = this.connections[i];\n            if (item != null) {\n                newConnections.push(item);\n            }\n        }\n        this.connections = newConnections;\n    }\n\n    /**\n     * Delete elements from the Board contained in elements.\n     * @param {BaseControl[]} elements the list of components to be deleted.\n     */\n    deleteControls(elements) {\n        // First we do need to delete all connection lines\n        // which are connected to the component.\n        let pins = [];\n        for (let i = 0; i < elements.length; i++) {\n            let item = elements[i];\n            pins = pins.concat(item.getPins());\n        }\n\n        let linesToDelete = [];\n        for (let i = 0; i < this.connections.length; i++) {\n            let item = this.connections[i];\n            for (let j = 0; j < pins.length; j++) {\n                if (item.isConnectedToPin(pins[j])) {\n                    linesToDelete.push(item);\n                }\n            }\n        }\n\n        this.deleteConnectionLines(linesToDelete);\n\n        // Now we can delete the component itself\n        for (let i = 0; i < elements.length; i++) {\n            let item = elements[i];\n            item.deleteControl();\n            this.controls[this.controls.indexOf(item)] = null;\n        }\n\n        let newControls = [];\n        for (let i = 0; i < this.controls.length; i++) {\n            let item = this.controls[i];\n            if (item != null) {\n                newControls.push(item);\n            }\n        }\n        this.controls = newControls;\n    }\n\n    /**\n     * Delete selected elements on the {@link Board}\n     */\n    deleteSelected() {\n        // Delete connection lines\n        let linesToDelete = [];\n        for (let i = 0; i < this.connections.length; i++) {\n            let item = this.connections[i];\n            if (item.isSelected()) {\n                linesToDelete.push(item);\n            }\n        }\n\n        this.deleteConnectionLines(linesToDelete);\n\n        // Delete components\n        let controlsToDelete = [];\n        for (let i = 0; i < this.controls.length; i++) {\n            let item = this.controls[i];\n            if (item.isSelected()) {\n                controlsToDelete.push(item);\n            }\n        }\n\n        this.deleteControls(controlsToDelete);\n    }\n\n    /**\n     * Select all controls within boundaries of given area.\n     *\n     * x,y--------------x2,y\n     * |///////////////////|\n     * |///////////////////|\n     * |///////////////////|\n     * x,y2-------------x2,y2\n     */\n    selectControlsWithinArea(x, y, x2, y2) {\n        this.unselect();\n\n        for (let i = 0; i < this.controls.length; i++) {\n            let item = this.controls[i];\n\n            if (item.isWithinArea(x, y, x2, y2)) {\n                item.select(false);\n            }\n        }\n    }\n    \n    /**\n     * Is called when onMouseDown event occur on {@link Board}.\n     * @param {Event} event event object\n     */\n    onMouseDown(event) {\n        if (this.paper.getElementByPoint(event.clientX, event.clientY) != null) {\n            return;\n        }\n        if (this.selectionBox == null) {\n            this.unselect();\n            let x = event.offsetX;\n            let y = event.offsetY;\n            this.selectionBox = new SelectionBox(this.paper, x, y);\n        }\n    }\n\n    /**\n     * Is called when onMouseUp event occur on {@link Board}.\n     * @param {Event} event event object\n     */\n    onMouseUp(event) {\n        if (this.selectionBox != null) {\n            this.selectionBox.remove();\n            this.selectionBox = null;\n        }\n    }\n\n    /**\n     * Is called when onMouseMove event occur on {@link Board}.\n     * @param {Event} event event object\n     */\n    onMouseMove(event) {\n        if (this.selectionBox != null) {\n            let x = event.offsetX;\n            let y = event.offsetY;\n            this.selectionBox.change(x, y);\n\n            let position = this.selectionBox.getControlPoints();\n\n            this.selectControlsWithinArea(\n                position.x1,\n                position.y1,\n                position.x3,\n                position.y3\n            );\n        }\n    }\n}\n\n/**\n * Selection rectangle used to select the objects\n * within specified area.\n */\nclass SelectionBox {\n    constructor(paper, x, y) {\n        this.paper = paper;\n        this.startX = x;\n        this.startY = y;\n        this.isDrawing = false;\n        this.controlPoints = {\n            x1: 0, y1: 0,\n            x2: 0, y2: 0,\n            x3: 0, y3: 0,\n            x4: 0, y4: 0\n        };\n    }\n\n    draw(x1, y1, x2, y2) {\n        let x = x1 > x2 ? x2 : x1;\n        let y = y1 > y2 ? y2 : y1;\n        let w = Math.abs(x2 - x1);\n        let h = Math.abs(y2 - y1);\n        if (this.isDrawing) {\n            let attr = this.element.attr();\n            attr.x = x;\n            attr.y = y;\n            attr.width = w;\n            attr.height = h;\n            this.element.attr(attr);\n        } else {\n            this.element = this.paper.rect(x, y, w, h);\n            this.isDrawing = true;\n        }\n    }\n\n    remove() {\n        if (this.element != null) {\n            this.element.remove();\n        }\n    }\n\n    setControlPoints(x2, y2) {\n        let x1 = this.startX;\n        let y1 = this.startY;\n        let newX1 = x1 > x2 ? x2 : x1;\n        let newY1 = y1 > y2 ? y2 : y1;\n        let newX2 = x1 < x2 ? x2 : x1;\n        let newY2 = y1 < y2 ? y2 : y1;\n\n        this.controlPoints.x1 = newX1;\n        this.controlPoints.y1 = newY1;\n\n        this.controlPoints.x2 = newX2;\n        this.controlPoints.y2 = newY1;\n\n        this.controlPoints.x3 = newX2;\n        this.controlPoints.y3 = newY2;\n\n        this.controlPoints.x4 = newX1;\n        this.controlPoints.y4 = newY2;\n    }\n\n    /**\n     * Get the control points of rectangle.\n     *\n     * x1,y1-----------x2,y2\n     * |///////////////////|\n     * |///////////////////|\n     * |///////////////////|\n     * x4,y4-----------x3,y3\n     *\n     * @returns {{x1: number, y1: number,\n     *            x2: number, y2: number,\n     *            x3: number, y3: number,\n     *            x4: number, y4: number}|*}\n     */\n    getControlPoints() {\n        return this.controlPoints;\n    }\n\n    change(x2, y2) {\n        let dx = Math.abs(x2 - this.startX);\n        let dy = Math.abs(y2 - this.startY);\n        if (dx >= SELECTION_BOX_START_THRESHOLD && dy >= SELECTION_BOX_START_THRESHOLD || this.isDrawing) {\n            this.draw(this.startX, this.startY, x2, y2);\n            this.setControlPoints(x2, y2);\n        }\n    }\n}\n",
                "new_contents": "/*\n\n Copyright (c) 2017 Jirtdan Team and other collaborators\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n\n */\n\n\"use strict\";\n/*jshint esversion: 6*/\nimport {ConnectionLine} from './controls/ConnectionLine.js'\n\n/**\n * Minimal height/width value for selection box to be appear.\n * The selection box will not appear unless its height and width\n * are greater that this number.\n * @type {number}\n */\nconst SELECTION_BOX_START_THRESHOLD = 10;\nconst SELECTION_BOX_FILL_COLOR = \"#355faf\";\n\n/**\n * The workspace board object where all components are placed and\n * interact with each other.\n */\nexport class Board {\n\n    /**\n     * Constructor of the {@link Board} class.\n     * @param paper paper object of {@link Raphael} library.\n     */\n    constructor(paper) {\n        this.paper = paper;\n        this.connections = [];\n        this.controls = [];\n        this.isConnecting = false;\n        this.selectionBox = null;\n    }\n\n    /**\n     * Add the control to be controlled by current Board.\n     * @param {BaseControl} control any control\n     */\n    addControl(control) {\n        this.controls.push(control);\n    }\n\n    /**\n     * Start connection activity from {@link ConnectionPin} object.\n     * @param {ConnectionPin} pin pin where connection starts from\n     */\n    startConnection(pin) {\n        this.isConnecting = true;\n        this.inputPin = pin;\n    }\n\n    /**\n     * Decide automatically to start or finalize the connection\n     * activity depending on situation.\n     * In case of startConnection was called previously the connection\n     * will be finalized.\n     * @param {ConnectionPin} pin pin where connection goes to\n     */\n    startFinishConnection(pin) {\n        if (!this.isConnecting) {\n            this.startConnection(pin);\n            return;\n        }\n        this.finishConnection(pin);\n    }\n\n    /**\n     * Finalize the connection activity. The connection will be\n     * established with previously started connection pin and\n     * two pins will communicate.\n     * @param {ConnectionPin} pin object to be connected to\n     */\n    finishConnection(pin) {\n        if (!this.isConnecting) return;\n        if (this.inputPin == pin) return;\n\n        if (this.inputPin.canConnect(pin)) {\n            this.createConnection(this.inputPin, pin);\n        }\n        this.isConnecting = false;\n    }\n\n    /**\n     * Create new connection and add it to the list.\n     * @param {ConnectionPin} pin1 start of the connection line\n     * @param {ConnectionPin} pin2 end of the connection line.\n     */\n    createConnection(pin1, pin2) {\n        this.connections.push(new ConnectionLine(this, pin1, pin2));\n    }\n\n    /**\n     * Translate the start and end points of all connections visually,\n     * depending on pins they connect to.\n     * This method is fired on drag-drop of the control.\n     * @param {ConnectionPin} pin the pin that are being moved\n     * @param {number} x the coordinate on X axis\n     * @param {number} y the coordinate on Y axis.\n     */\n    translateConnections(pin, x, y) {\n        for (var i = 0; i < this.connections.length; i++) {\n            this.connections[i].onPinTranslate(pin, x, y);\n        }\n    }\n\n    /**\n     * Un-select all selected elements on {@link Board}.\n     */\n    unselect() {\n        for (let i = 0; i < this.connections.length; i++) {\n            let item = this.connections[i];\n            if (item.isSelected()) {\n                item.unselect();\n            }\n        }\n\n        for (let i = 0; i < this.controls.length; i++) {\n            let item = this.controls[i];\n            if (item.isSelected()) {\n                item.unselect();\n            }\n        }\n    }\n\n    /**\n     * Delete the connection lines given in elements array.\n     * @param {ConnectionLine[]} elements connection lines to be deleted.\n     */\n    deleteConnectionLines(elements) {\n        for (let i = 0; i < elements.length; i++) {\n            let item = elements[i];\n            item.disconnect();\n            this.connections[this.connections.indexOf(item)] = null;\n        }\n\n        let newConnections = [];\n        for (let i = 0; i < this.connections.length; i++) {\n            let item = this.connections[i];\n            if (item != null) {\n                newConnections.push(item);\n            }\n        }\n        this.connections = newConnections;\n    }\n\n    /**\n     * Delete elements from the Board contained in elements.\n     * @param {BaseControl[]} elements the list of components to be deleted.\n     */\n    deleteControls(elements) {\n        // First we do need to delete all connection lines\n        // which are connected to the component.\n        let pins = [];\n        for (let i = 0; i < elements.length; i++) {\n            let item = elements[i];\n            pins = pins.concat(item.getPins());\n        }\n\n        let linesToDelete = [];\n        for (let i = 0; i < this.connections.length; i++) {\n            let item = this.connections[i];\n            for (let j = 0; j < pins.length; j++) {\n                if (item.isConnectedToPin(pins[j])) {\n                    linesToDelete.push(item);\n                }\n            }\n        }\n\n        this.deleteConnectionLines(linesToDelete);\n\n        // Now we can delete the component itself\n        for (let i = 0; i < elements.length; i++) {\n            let item = elements[i];\n            item.deleteControl();\n            this.controls[this.controls.indexOf(item)] = null;\n        }\n\n        let newControls = [];\n        for (let i = 0; i < this.controls.length; i++) {\n            let item = this.controls[i];\n            if (item != null) {\n                newControls.push(item);\n            }\n        }\n        this.controls = newControls;\n    }\n\n    /**\n     * Delete selected elements on the {@link Board}\n     */\n    deleteSelected() {\n        // Delete connection lines\n        let linesToDelete = [];\n        for (let i = 0; i < this.connections.length; i++) {\n            let item = this.connections[i];\n            if (item.isSelected()) {\n                linesToDelete.push(item);\n            }\n        }\n\n        this.deleteConnectionLines(linesToDelete);\n\n        // Delete components\n        let controlsToDelete = [];\n        for (let i = 0; i < this.controls.length; i++) {\n            let item = this.controls[i];\n            if (item.isSelected()) {\n                controlsToDelete.push(item);\n            }\n        }\n\n        this.deleteControls(controlsToDelete);\n    }\n\n    /**\n     * Select all controls within boundaries of given area.\n     *\n     * x,y--------------x2,y\n     * |///////////////////|\n     * |///////////////////|\n     * |///////////////////|\n     * x,y2-------------x2,y2\n     */\n    selectControlsWithinArea(x, y, x2, y2) {\n        this.unselect();\n\n        for (let i = 0; i < this.controls.length; i++) {\n            let item = this.controls[i];\n\n            if (item.isWithinArea(x, y, x2, y2)) {\n                item.select(false);\n            }\n        }\n    }\n\n    /**\n     * Is called when onMouseDown event occur on {@link Board}.\n     * @param {Event} event event object\n     */\n    onMouseDown(event) {\n        if (this.paper.getElementByPoint(event.clientX, event.clientY) != null) {\n            return;\n        }\n        if (this.selectionBox == null) {\n            this.unselect();\n            let x = event.offsetX;\n            let y = event.offsetY;\n            this.selectionBox = new SelectionBox(this.paper, x, y);\n        }\n    }\n\n    /**\n     * Is called when onMouseUp event occur on {@link Board}.\n     * @param {Event} event event object\n     */\n    onMouseUp(event) {\n        if (this.selectionBox != null) {\n            this.selectionBox.remove();\n            this.selectionBox = null;\n        }\n    }\n\n    /**\n     * Is called when onMouseMove event occur on {@link Board}.\n     * @param {Event} event event object\n     */\n    onMouseMove(event) {\n        if (this.selectionBox != null) {\n            let x = event.offsetX;\n            let y = event.offsetY;\n            this.selectionBox.change(x, y);\n\n            let position = this.selectionBox.getControlPoints();\n\n            this.selectControlsWithinArea(\n                position.x1,\n                position.y1,\n                position.x3,\n                position.y3\n            );\n        }\n    }\n}\n\n/**\n * Selection rectangle used to select the objects\n * within specified area.\n */\nclass SelectionBox {\n    constructor(paper, x, y) {\n        this.paper = paper;\n        this.startX = x;\n        this.startY = y;\n        this.isDrawing = false;\n        this.controlPoints = {\n            x1: 0, y1: 0,\n            x2: 0, y2: 0,\n            x3: 0, y3: 0,\n            x4: 0, y4: 0\n        };\n    }\n\n    draw(x1, y1, x2, y2) {\n        let x = x1 > x2 ? x2 : x1;\n        let y = y1 > y2 ? y2 : y1;\n        let w = Math.abs(x2 - x1);\n        let h = Math.abs(y2 - y1);\n        if (this.isDrawing) {\n            let attr = this.element.attr();\n            attr.x = x;\n            attr.y = y;\n            attr.width = w;\n            attr.height = h;\n            this.element.attr(attr);\n        } else {\n            this.element = this.paper.rect(x, y, w, h);\n            this.element.attr(\"fill\", SELECTION_BOX_FILL_COLOR);\n            this.element.attr(\"fill-opacity\", 0.3);\n            this.isDrawing = true;\n        }\n    }\n\n    remove() {\n        if (this.element != null) {\n            this.element.remove();\n        }\n    }\n\n    setControlPoints(x2, y2) {\n        let x1 = this.startX;\n        let y1 = this.startY;\n        let newX1 = x1 > x2 ? x2 : x1;\n        let newY1 = y1 > y2 ? y2 : y1;\n        let newX2 = x1 < x2 ? x2 : x1;\n        let newY2 = y1 < y2 ? y2 : y1;\n\n        this.controlPoints.x1 = newX1;\n        this.controlPoints.y1 = newY1;\n\n        this.controlPoints.x2 = newX2;\n        this.controlPoints.y2 = newY1;\n\n        this.controlPoints.x3 = newX2;\n        this.controlPoints.y3 = newY2;\n\n        this.controlPoints.x4 = newX1;\n        this.controlPoints.y4 = newY2;\n    }\n\n    /**\n     * Get the control points of rectangle.\n     *\n     * x1,y1-----------x2,y2\n     * |///////////////////|\n     * |///////////////////|\n     * |///////////////////|\n     * x4,y4-----------x3,y3\n     *\n     * @returns {{x1: number, y1: number,\n     *            x2: number, y2: number,\n     *            x3: number, y3: number,\n     *            x4: number, y4: number}|*}\n     */\n    getControlPoints() {\n        return this.controlPoints;\n    }\n\n    change(x2, y2) {\n        let dx = Math.abs(x2 - this.startX);\n        let dy = Math.abs(y2 - this.startY);\n        if (dx >= SELECTION_BOX_START_THRESHOLD && dy >= SELECTION_BOX_START_THRESHOLD || this.isDrawing) {\n            this.draw(this.startX, this.startY, x2, y2);\n            this.setControlPoints(x2, y2);\n        }\n    }\n}\n",
                "subject": "Add transparent background color for selection box",
                "message": "Add transparent background color for selection box\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "adilek/jirtdan,adilek/jirtdan"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10235,
            "row": {
                "commit": "00a56d28a9813c1fb953a3297de91326bc7894e1",
                "old_file": "test/karma-e2e.conf.js",
                "new_file": "test/karma-e2e.conf.js",
                "old_contents": "exports.config = {\n\n  specs: ['e2e/responsiveSpec.js','e2e/scenariosSpec.js'],\n\n  capabilities: {\n    browserName: 'chrome',\n    shardTestFiles: true,\n    maxInstances: 2\n  },\n\n  chromeDriver: '../node_modules/protractor/selenium/chromedriver',\n\n  baseUrl: 'http://localhost:8080/',\n\n  framework: 'jasmine',\n\n};",
                "new_contents": "exports.config = {\n\n  specs: ['e2e/responsiveSpec.js','e2e/scenariosSpec.js'],\n\n  capabilities: {\n    browserName: 'chrome',\n    shardTestFiles: true,\n    maxInstances: 2\n  },\n\n  chromeDriver: 'chromedriver',\n\n  baseUrl: 'http://localhost:8080/',\n\n  framework: 'jasmine',\n\n};",
                "subject": "Grunt && CircleCi && Heroku: tryng if Chromedriver is executed in CircleCi",
                "message": "Grunt && CircleCi && Heroku: tryng if Chromedriver is executed in CircleCi\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "daniboomerang/daniboomerang,daniboomerang/daniboomerang,daniboomerang/daniboomerang"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10236,
            "row": {
                "commit": "2d76ef0ceedf837f740440f2af97151103690708",
                "old_file": "jquery.sortScroll.js",
                "new_file": "jquery.sortScroll.js",
                "old_contents": "/*\n * jQuery sortScroll V1.1.4\n * Sorting without moving !\n * The element being sorted will stay still while the rest of the page will scroll behind it.\n * https://github.com/jadus/jquery-sortScroll\n * lucas.menant@gmail.com\n * Licensed under the MIT license\n */\n;\n(function ($, window, document, undefined) {\n\n    \"use strict\";\n    var defaults = {\n        animationDuration: 1000,// duration of the animation in ms\n        easing: \"swing\",// easing type for the animation\n        keepStill: true// if false the page doesn't scroll to follow the element\n    };\n\n    function SortScroll(container, options) {\n\n        this.container = $(container);\n        this.settings = $.extend({}, defaults, options, this.container.data());\n        this._sorting = false;\n        this.elementClass = \"sort-scroll-element\";\n        this.sortingClass = \"sort-scroll-sorting\";\n        this.buttonUpClass = \"sort-scroll-button-up\";\n        this.buttonDownClass = \"sort-scroll-button-down\";\n        this.init();\n    }\n\n    $.extend(SortScroll.prototype, {\n        init: function () {\n            var self = this;\n            //auto initialization\n            self.container.on(\"click\", \".\" + self.buttonUpClass + \", .\" + self.buttonDownClass, function (event) {\n                var button = $(this),\n                    elementCollection = self.container.find(\".\" + self.elementClass),\n                    initialOrder = elementCollection.index(button.closest(\".\" + self.elementClass)),\n                    sortDirection;\n\n                sortDirection = button.hasClass(self.buttonUpClass) ? -1 : 1;\n                event.preventDefault();\n                self.sortElement(initialOrder, sortDirection, self.settings.keepStill);\n            })\n        },\n        sortElement: function (initialOrder, sortDirection, keepStill) {\n            sortDirection = sortDirection === -1 ? sortDirection : 1;\n            keepStill = !keepStill ? false : this.settings.keepStill;\n\n            var self = this,\n                elementCollection = self.container.find(\".\" + self.elementClass),\n                maxOrder = elementCollection.length - 1,\n                destinationOrder = initialOrder + sortDirection;\n\n\n            if (destinationOrder < 0 || destinationOrder > maxOrder) {\n                return false;\n            }\n\n            var element = elementCollection.eq(initialOrder);\n\n            //if method is called again before animation end, we wait and we call it again on animation end\n            if (self._sorting) {\n                self.container.one(\"sortScroll.sortEnd\", function (event, element, initialOrder, destinationOrder) {\n                    self.sortElement(destinationOrder, sortDirection, keepStill);\n                });\n                return false;\n            }\n\n            self.container.trigger(\"sortScroll.sortStart\", [element, initialOrder, destinationOrder]);\n            self._sorting = true;\n\n            var elementHeight = element.outerHeight(true),\n                initialElementY = element.offset().top,\n                otherElement = elementCollection.eq(destinationOrder),\n                otherElementHeight = otherElement.outerHeight(true),\n                initialOtherElementY = otherElement.offset().top,\n                finalElementY = otherElement.offset().top,\n                finalOtherElementY = initialOtherElementY + elementHeight,\n                maxScroll = Math.max(0, document.documentElement.scrollHeight - document.documentElement.clientHeight),\n                initialScroll = $(window).scrollTop(),\n                modifyElementRelative = 0,\n                modifyOtherElementRelative = parseInt(otherElement.css(\"margin-top\"),10);\n\n            if (sortDirection > 0) {\n                finalElementY = initialElementY + otherElementHeight;\n                finalOtherElementY = initialElementY;\n                modifyElementRelative = parseInt(element.css(\"margin-top\"),10);\n                modifyOtherElementRelative = 0;\n            }\n\n            var relativeElementY = finalElementY - initialElementY - modifyElementRelative,\n                relativeOtherElementY = finalOtherElementY - initialOtherElementY - modifyOtherElementRelative,\n                finalScroll = initialScroll + relativeElementY;\n\n            finalScroll = Math.min(finalScroll, maxScroll);\n            finalScroll = Math.max(finalScroll, 0);\n\n            var duration = self.settings.animationDuration,\n                easing = self.settings.easing,\n                initialCssPosition = element.css(\"position\"),\n                initialCssZIndex = element.css(\"z-index\"),\n                sortingZIndex;\n\n            sortingZIndex = (initialCssZIndex === \"auto\") ? 2 : initialCssZIndex + 1;\n\n            //modifying elements to animate them\n            element.addClass(self.sortingClass);\n            element.css({\n                \"position\": \"relative\",\n                \"z-index\": sortingZIndex\n            });\n            otherElement.css({\n                \"position\": \"relative\",\n            });\n\n            //animating\n            element.animate({\n                top: relativeElementY+\"px\"\n            }, duration, easing);\n            otherElement.animate({\n                top: relativeOtherElementY+\"px\"\n            }, duration, easing);\n            if(keepStill){\n                $(\"html, body\").animate({scrollTop: finalScroll + \"px\"}, duration, easing);\n            }\n\n            //after animation\n            elementCollection.add($(\"html, body\")).promise().done(function () {\n                //elements back to normal\n                element.removeClass(self.sortingClass);\n                element.css({\n                    \"position\": initialCssPosition,\n                    \"z-index\": initialCssZIndex\n                });\n                otherElement.css({\n                    \"position\": initialCssPosition,\n                });\n\n                //modifiyng dom\n                if(sortDirection > 0){\n                    otherElement.after(element);\n                }else{\n                    otherElement.before(element);\n                }\n\n                element.css(\"top\", 0);\n                otherElement.css(\"top\", 0);\n\n                self._sorting = false;\n                self.container.trigger(\"sortScroll.sortEnd\", [element, initialOrder, destinationOrder]);\n            });\n\n        }\n    });\n\n    $.fn.sortScroll = function (opt) {\n        var args = Array.prototype.slice.call(arguments, 1);\n        return this.each(function () {\n            var item = $(this), instance = item.data(\"sortScroll\");\n            if (!instance) {\n                item.data(\"sortScroll\", new SortScroll(this, opt));\n            } else {\n                if (typeof opt === \"string\") {\n                    instance[opt].apply(instance, args);\n                }\n            }\n        });\n    };\n\n    $(\".sort-scroll-container\").each(function () {\n        $(this).sortScroll();\n    });\n})(jQuery, window, document);",
                "new_contents": "/*\n * jQuery sortScroll V1.2.0\n * Sorting without moving !\n * The element being sorted will stay still while the rest of the page will scroll behind it.\n * https://github.com/jadus/jquery-sortScroll\n * lucas.menant@gmail.com\n * Licensed under the MIT license\n */\n;\n(function ($, window, document, undefined) {\n\n    \"use strict\";\n    var defaults = {\n        animationDuration: 1000,// duration of the animation in ms\n        cssEasing: \"ease-in-out\",// easing type for the animation\n        keepStill: true// if false the page doesn't scroll to follow the element\n    };\n\n    function SortScroll(container, options) {\n\n        this.container = $(container);\n        this.settings = $.extend({}, defaults, options, this.container.data());\n        this._sorting = false;\n        this.elementClass = \"sort-scroll-element\";\n        this.sortingClass = \"sort-scroll-sorting\";\n        this.buttonUpClass = \"sort-scroll-button-up\";\n        this.buttonDownClass = \"sort-scroll-button-down\";\n        this.init();\n    }\n\n    $.extend(SortScroll.prototype, {\n        init: function () {\n            var self = this;\n\n\n            //auto initialization\n            self.container.on(\"click\", \".\" + self.buttonUpClass + \", .\" + self.buttonDownClass, function (event) {\n                event.preventDefault();\n                var button = $(this),\n                    elementCollection = self.container.find(\".\" + self.elementClass),\n                    initialOrder = elementCollection.index(button.closest(\".\" + self.elementClass)),\n                    sortDirection;\n\n                sortDirection = button.hasClass(self.buttonUpClass) ? -1 : 1;\n                self.sortElement(initialOrder, sortDirection, self.settings.keepStill);\n            })\n        },\n        sortElement: function (initialOrder, sortDirection, keepStill) {\n            sortDirection = sortDirection === -1 ? sortDirection : 1;\n            keepStill = !keepStill ? false : this.settings.keepStill;\n\n            var self = this,\n                elementCollection = self.container.find(\".\" + self.elementClass),\n                maxOrder = elementCollection.length - 1,\n                destinationOrder = initialOrder + sortDirection;\n\n\n            //don't move if element is at one end of the list\n            if (destinationOrder < 0 || destinationOrder > maxOrder) {\n                return false;\n            }\n\n            //if method is called again before animation end, we wait and we call it again on animation end\n            if (self._sorting) {\n                self.container.one(\"sortScroll.sortEnd\", function (event, element, initialOrder, destinationOrder) {\n                    self.sortElement(destinationOrder, sortDirection, keepStill);\n                });\n                return false;\n            }\n\n            elementCollection.each(function(){\n                $(this).css(\"top\", 0);\n            });\n\n            var element = elementCollection.eq(initialOrder),\n                elementHeight = element.outerHeight(true),\n                initialElementY = element.offset().top,\n                otherElement = elementCollection.eq(destinationOrder),\n                otherElementHeight = otherElement.outerHeight(true),\n                initialOtherElementY = otherElement.offset().top,\n                finalElementY = otherElement.offset().top,\n                finalOtherElementY = initialOtherElementY + elementHeight,\n                modifyElementRelative = 0,\n                modifyOtherElementRelative = parseInt(otherElement.css(\"margin-top\"),10);\n\n            if (sortDirection > 0) {\n                finalElementY = initialElementY + otherElementHeight;\n                finalOtherElementY = initialElementY;\n                modifyElementRelative = parseInt(element.css(\"margin-top\"),10);\n                modifyOtherElementRelative = 0;\n            }\n\n            var relativeElementY = finalElementY - initialElementY - modifyElementRelative,\n                relativeOtherElementY = finalOtherElementY - initialOtherElementY - modifyOtherElementRelative,\n                duration = self.settings.animationDuration,\n                cssEasing = self.settings.cssEasing,\n                body = $(\"body\"),\n                initialElementStyleAttr = element.attr(\"style\") || '',\n                initialOtherElementStyleAttr = otherElement.attr(\"style\") || '',\n                initialBodyStyleAttr = body.attr(\"style\") || '',\n                initialCssZIndex = element.css(\"z-index\"),\n                elementDfd = $.Deferred(),\n                otherElementDfd = $.Deferred(),\n                bodyDfd = $.Deferred(),\n                transitionEndEvent = \"transitionend webkitTransitionEnd msTransitionEnd oTransitionEnd\",\n                sortingZIndex;\n\n\n            sortingZIndex = (initialCssZIndex === \"auto\") ? 2 : initialCssZIndex + 1;\n\n            //animating\n            self.container.trigger(\"sortScroll.sortStart\", [element, initialOrder, destinationOrder]);\n            self._sorting = true;\n            element.add(otherElement).css({\n                \"position\" : \"relative\",\n                \"transition\" : duration+\"ms \"+cssEasing\n            })\n            element.addClass(self.sortingClass).css({\n                \"z-index\": sortingZIndex,\n                \"top\": relativeElementY+\"px\",\n            });\n            otherElement.css({\n                \"top\": relativeOtherElementY+\"px\",\n            });\n            if(keepStill) {\n                var initialScroll = $(window).scrollTop(),\n                    finalScroll = initialScroll + relativeElementY,\n                    maxScroll = Math.max(0, document.documentElement.scrollHeight - document.documentElement.clientHeight);\n\n                finalScroll = Math.min(finalScroll, maxScroll);\n                finalScroll = Math.max(finalScroll, 0);\n\n                body.css({\n                    \"transition\" : duration+\"ms \"+cssEasing,\n                    \"margin-top\": ( initialScroll - finalScroll ) + \"px\"\n                });\n            }\n\n            //after animation\n            element.on(transitionEndEvent, function () {\n                elementDfd.resolve();\n            })\n            otherElement.on(transitionEndEvent, function () {\n                otherElementDfd.resolve();\n            })\n            body.on(transitionEndEvent, function () {\n                bodyDfd.resolve();\n            })\n            $.when(elementDfd, otherElementDfd, bodyDfd).done(function () {\n                //back to initial style\n                element.attr(\"style\",initialElementStyleAttr);\n                otherElement.attr(\"style\",initialOtherElementStyleAttr);\n                body.attr(\"style\",initialBodyStyleAttr);\n                if(keepStill) {\n                    $(\"html, body\").scrollTop(finalScroll + ($(window).scrollTop() - initialScroll));\n                }\n                element.removeClass(self.sortingClass);\n\n                //modifiyng dom\n                if(sortDirection > 0){\n                    otherElement.after(element);\n                }else{\n                    otherElement.before(element);\n                }\n\n                self._sorting = false;\n                self.container.trigger(\"sortScroll.sortEnd\", [element, initialOrder, destinationOrder]);\n                return;\n            });\n        }\n    });\n\n    $.fn.sortScroll = function (opt) {\n        var args = Array.prototype.slice.call(arguments, 1);\n        return this.each(function () {\n            var item = $(this), instance = item.data(\"sortScroll\");\n            if (!instance) {\n                item.data(\"sortScroll\", new SortScroll(this, opt));\n            } else {\n                if (typeof opt === \"string\") {\n                    instance[opt].apply(instance, args);\n                }\n            }\n        });\n    };\n\n    $(\".sort-scroll-container\").each(function () {\n        $(this).sortScroll();\n    });\n})(jQuery, window, document);\n",
                "subject": "v1.2.0",
                "message": "v1.2.0\n\ncss animation instead of jquery frame based animations",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "jadus/jquery-sortScroll"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10237,
            "row": {
                "commit": "c8d475f03b4f4aec69eaf61ebdb579232335785c",
                "old_file": "app/auth/auth.js",
                "new_file": "app/auth/auth.js",
                "old_contents": "const session = require('express-session');\nconst passport = require('passport');\nconst { Strategy } = require('passport-local');\nconst MongoStore = require('connect-mongo')(session);\nconst bcrypt = require('bcrypt');\n\nconst config = require('../../config');\n\nconst applyTo = (app, data) => {\n    passport.use(new Strategy((username, password, done) => {\n        data.users.findByUsername(username)\n            .then((user) => {\n                if (!user) {\n                    throw new Error(`No user ${username} found!`);\n                } else {\n                    return user;\n                }\n            })\n            .then((user) => {\n                // async hash compare not working well here\n                // return new Promise((res, rej) => {\n                //     bcrypt.compare(password, user.passHash, (err, ready) => {\n                //         if (ready) {\n                //             res(user);\n                //         } else {\n                //             throw new Error('Password is wrong!');\n                //         }\n                //     });\n                // });\n\n                if (bcrypt.compareSync(password, user.passHash)) {\n                    return user;\n                }\n                throw new Error('Password is wrong!');\n            })\n            .then((user) => {\n                done(null, user);\n            })\n            .catch((err) => {\n                done(err);\n            });\n    }));\n\n    app.use(session({\n        store: new MongoStore({ url: config.connectionString }),\n        secret: config.sessionSecret,\n        resave: true,\n        saveUninitialized: true,\n    }));\n\n    app.use(passport.initialize());\n    app.use(passport.session());\n\n    passport.serializeUser((user, done) => {\n        done(null, user._id);\n    });\n\n    passport.deserializeUser((id, done) => {\n        data.users.findById(id)\n            .then((user) => {\n                done(null, user);\n            })\n            .catch(done);\n    });\n\n    app.use((req, res, next) => {\n        res.locals = {\n            user: req.user,\n        };\n\n        next();\n    });\n};\n\nmodule.exports = { applyTo };\n",
                "new_contents": "const session = require('express-session');\nconst passport = require('passport');\nconst { Strategy } = require('passport-local');\nconst MongoStore = require('connect-mongo')(session);\nconst bcrypt = require('bcrypt');\n\nconst config = require('../../config');\n\nconst applyTo = (app, data) => {\n    passport.use(new Strategy((username, password, done) => {\n        data.users.findByUsername(username)\n            .then((user) => {\n                if (!user) {\n                    return Promise.reject(`No user ${username} found!`);\n                }\n\n                return user;\n\n            })\n            .then((user) => {\n                // async hash compare not working well here\n                // return new Promise((res, rej) => {\n                //     bcrypt.compare(password, user.passHash, (err, ready) => {\n                //         if (ready) {\n                //             res(user);\n                //         } else {\n                //             throw new Error('Password is wrong!');\n                //         }\n                //     });\n                // });\n\n                if (bcrypt.compareSync(password, user.passHash)) {\n                    return user;\n                }\n                return Promise.reject('Password is wrong!');\n            })\n            .then((user) => {\n                done(null, user);\n            })\n            .catch((err) => {\n                done(null, false, { message: err });\n            });\n    }));\n\n    app.use(session({\n        store: new MongoStore({ url: config.connectionString }),\n        secret: config.sessionSecret,\n        resave: true,\n        saveUninitialized: true,\n    }));\n\n    app.use(passport.initialize());\n    app.use(passport.session());\n\n    passport.serializeUser((user, done) => {\n        done(null, user._id);\n    });\n\n    passport.deserializeUser((id, done) => {\n        data.users.findById(id)\n            .then((user) => {\n                done(null, user);\n            })\n            .catch(done);\n    });\n\n    app.use((req, res, next) => {\n        res.locals = {\n            user: req.user,\n        };\n\n        next();\n    });\n};\n\nmodule.exports = { applyTo };\n",
                "subject": "fixed authentication flash",
                "message": "fixed authentication flash\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "team-asterisk/CarRentals,team-asterisk/CarRentals"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10238,
            "row": {
                "commit": "1925ddc0d04819699916ac2bd1dbbb13696f04af",
                "old_file": "test/linters/litmus.js",
                "new_file": "test/linters/litmus.js",
                "old_contents": "var expect = require('unexpected');\n\nvar tests = [{\n    linter: 'json',\n    config: { canonical: false },\n    data: '{\"b\": 1, \"a\": 1}',\n    shouldPass: true\n}, {\n    linter: 'json',\n    config: { canonical: true },\n    data: '{\"b\": 1, \"a\": 1}',\n    shouldPass: false\n}, {\n    linter: 'json',\n    config: { canonical: true },\n    data: '{\"a\": 1, \"b\": [{\"a\": 1, \"b\": 1}]}',\n    shouldPass: true\n}, {\n    linter: 'json',\n    config: { canonical: true },\n    data: '{\"a\": 1, \"b\": [{\"b\": 1, \"a\": 1}]}',\n    shouldPass: false\n}, {\n    linter: 'json',\n    config: { indent: 2 },\n    data: '{\\n  \"b\": 1,\\n  \"a\": 1\\n}',\n    shouldPass: true\n}, {\n    linter: 'json',\n    config: { indent: 2 },\n    data: '{\\n    \"b\": 1,\\n    \"a\": 1\\n}',\n    shouldPass: false\n}, {\n    linter: 'json',\n    config: { indent: 2 },\n    data: '{\\n  \"b\": 1,\\n  \"a\": 1\\n}\\n\\n', // Trailing newlines at EOF shouldn't matter\n    shouldPass: true\n}];\n\ndescribe('linters/litmus', function () {\n    tests.forEach(function (test, index) {\n        it(test.linter + ' / #' + index, function (done) {\n            var l = require('../../lib/linters/' + test.linter);\n            l('test', test.data, test.config, function (err, errList) {\n                if (test.shouldPass) {\n                    expect(errList, 'to be empty');\n                } else {\n                    expect(errList, 'not to be empty');\n                }\n                done(err);\n            });\n        });\n    });\n});\n",
                "new_contents": "/*global describe, it*/\nvar expect = require('unexpected');\n\nvar tests = [{\n    linter: 'json',\n    config: { canonical: false },\n    data: '{\"b\": 1, \"a\": 1}',\n    shouldPass: true\n}, {\n    linter: 'json',\n    config: { canonical: true },\n    data: '{\"b\": 1, \"a\": 1}',\n    shouldPass: false\n}, {\n    linter: 'json',\n    config: { canonical: true },\n    data: '{\"a\": 1, \"b\": [{\"a\": 1, \"b\": 1}]}',\n    shouldPass: true\n}, {\n    linter: 'json',\n    config: { canonical: true },\n    data: '{\"a\": 1, \"b\": [{\"b\": 1, \"a\": 1}]}',\n    shouldPass: false\n}, {\n    linter: 'json',\n    config: { indent: 2 },\n    data: '{\\n  \"b\": 1,\\n  \"a\": 1\\n}',\n    shouldPass: true\n}, {\n    linter: 'json',\n    config: { indent: 2 },\n    data: '{\\n    \"b\": 1,\\n    \"a\": 1\\n}',\n    shouldPass: false\n}, {\n    linter: 'json',\n    config: { indent: 2 },\n    data: '{\\n  \"b\": 1,\\n  \"a\": 1\\n}\\n\\n', // Trailing newlines at EOF shouldn't matter\n    shouldPass: true\n}];\n\ndescribe('linters/litmus', function () {\n    tests.forEach(function (test, index) {\n        it(test.linter + ' / #' + index, function (done) {\n            var l = require('../../lib/linters/' + test.linter);\n            l('test', test.data, test.config, function (err, errList) {\n                if (test.shouldPass) {\n                    expect(errList, 'to be empty');\n                } else {\n                    expect(errList, 'not to be empty');\n                }\n                done(err);\n            });\n        });\n    });\n});\n",
                "subject": "Lint test/linters/litmus.js",
                "message": "Lint test/linters/litmus.js\n",
                "lang": "JavaScript",
                "license": "bsd-3-clause",
                "repos": "msiebuhr/slint,msiebuhr/slint"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10239,
            "row": {
                "commit": "62a8bfd1fc7902037f27a2ff5fe2dcd9dc7b0f3f",
                "old_file": "jquery.touchclick.js",
                "new_file": "jquery.touchclick.js",
                "old_contents": "/*!\nCopyright (c) 2013 Derek Petersen https://github.com/tuxracer/jquery-touchclick\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n\n(function (factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define(['jquery'], factory);\n    } else {\n        // Browser globals\n        factory(jQuery);\n    }\n}(function ($) {\n    var activeClass = \"touchactive\",\n        touchstart,\n        touchmove,\n        touchend,\n        timestamp;\n\n    getTouchclickEl = function (target) {\n        var $targetEl = $(target),\n            $touchclickEl = $targetEl.closest(\"*[data-touchclick='true']\");\n\n        if ($touchclickEl.length) {\n            return $touchclickEl;\n        }\n\n        return $targetEl;\n    };\n\n    timestamp = function () {\n        return Math.round((new Date()).getTime() / 1000);\n    };\n\n    touchstart = function (e) {\n        var $touchclickEl = getTouchclickEl(e.target),\n            currentTimestamp = timestamp(),\n            lastTimestamp = $touchclickEl.data(\"touchclick-last-touch\"),\n            difference = currentTimestamp - lastTimestamp;\n\n        if (lastTimestamp && difference < 3 && e.type === \"mousedown\") {\n            $touchclickEl.data(\"touchclick-disabled\", true);\n        } else {\n            $touchclickEl.data(\"touchclick-disabled\", false);\n            $touchclickEl.addClass(activeClass);\n        }\n\n        if (e.type === \"touchstart\" || e.type === \"MSPointerDown\") {\n            $touchclickEl.data(\"touchclick-last-touch\", currentTimestamp);\n        }\n    };\n\n    touchmove = function (e) {\n        var $touchclickEl = getTouchclickEl(e.target);\n\n        $touchclickEl.data(\"touchclick-disabled\", true);\n        $touchclickEl.removeClass(activeClass);\n    };\n\n    touchend = function (e) {\n        var $touchclickEl = getTouchclickEl(e.target);\n\n        if (!$touchclickEl.data(\"touchclick-disabled\")) {\n            e.type = \"touchclick\";\n            $.event.dispatch.call(this, e);\n        }\n\n        $touchclickEl.data(\"touchclick-disabled\", false);\n        $touchclickEl.removeClass(activeClass);\n    };\n\n    $.event.special.touchclick = {\n        setup: function () {\n            var $el = $(this);\n\n            if (window.navigator.msPointerEnabled) {\n                $el.on(\"MSPointerDown\", touchstart);\n                $el.on(\"MSPointerUp\", touchend);\n            } else {\n                $el.on(\"touchstart mousedown\", touchstart);\n                $el.on(\"touchmove mouseout\", touchmove);\n                $el.on(\"touchend mouseup\", touchend);\n            }\n        },\n\n        teardown: function () {\n            var $el = $(this);\n\n            if (window.navigator.msPointerEnabled) {\n                $el.off(\"MSPointerDown\", touchstart);\n                $el.off(\"MSPointerUp\", touchend);\n            } else {\n                $el.off(\"touchstart mousedown\", touchstart);\n                $el.off(\"touchmove mouseout\", touchmove);\n                $el.off(\"touchend mouseup\", touchend);\n            }\n        }\n    };\n}));\n",
                "new_contents": "/*!\nCopyright (c) 2013 Derek Petersen https://github.com/tuxracer/jquery-touchclick\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n\n(function (factory) {\n    if (typeof define === \"function\" && define.amd) {\n        // AMD. Register as an anonymous module.\n        define([\"jquery\"], factory);\n    } else {\n        // Browser globals\n        factory(jQuery);\n    }\n}(function ($) {\n    var activeClass = \"touchactive\",\n        touchstart,\n        touchmove,\n        touchend,\n        timestamp;\n\n    getTouchclickEl = function (target) {\n        var $targetEl = $(target),\n            $touchclickEl = $targetEl.closest(\"*[data-touchclick='true']\");\n\n        if ($touchclickEl.length) {\n            return $touchclickEl;\n        }\n\n        return $targetEl;\n    };\n\n    timestamp = function () {\n        return Math.round((new Date()).getTime() / 1000);\n    };\n\n    touchstart = function (e) {\n        var $touchclickEl = getTouchclickEl(e.target),\n            currentTimestamp = timestamp(),\n            lastTimestamp = $touchclickEl.data(\"touchclick-last-touch\"),\n            difference = currentTimestamp - lastTimestamp;\n\n        // Support devices with both touch and mouse (e.g. Windows 8, Chromebook Pixel)\n        if (lastTimestamp && difference < 3 && e.type === \"mousedown\") {\n            $touchclickEl.data(\"touchclick-disabled\", true);\n        } else {\n            $touchclickEl.data(\"touchclick-disabled\", false);\n            $touchclickEl.addClass(activeClass);\n        }\n\n        if (e.type === \"touchstart\" || e.type === \"MSPointerDown\") {\n            $touchclickEl.data(\"touchclick-last-touch\", currentTimestamp);\n        }\n    };\n\n    touchmove = function (e) {\n        var $touchclickEl = getTouchclickEl(e.target);\n\n        $touchclickEl.data(\"touchclick-disabled\", true);\n        $touchclickEl.removeClass(activeClass);\n    };\n\n    touchend = function (e) {\n        var $touchclickEl = getTouchclickEl(e.target);\n\n        if (!$touchclickEl.data(\"touchclick-disabled\")) {\n            e.type = \"touchclick\";\n            $.event.dispatch.call(this, e);\n        }\n\n        $touchclickEl.data(\"touchclick-disabled\", false);\n        $touchclickEl.removeClass(activeClass);\n    };\n\n    $.event.special.touchclick = {\n        setup: function () {\n            var $el = $(this);\n\n            if (window.navigator.msPointerEnabled) {\n                $el.on(\"MSPointerDown\", touchstart);\n                $el.on(\"MSPointerUp\", touchend);\n            } else {\n                $el.on(\"touchstart mousedown\", touchstart);\n                $el.on(\"touchmove mouseout\", touchmove);\n                $el.on(\"touchend mouseup\", touchend);\n            }\n        },\n\n        teardown: function () {\n            var $el = $(this);\n\n            if (window.navigator.msPointerEnabled) {\n                $el.off(\"MSPointerDown\", touchstart);\n                $el.off(\"MSPointerUp\", touchend);\n            } else {\n                $el.off(\"touchstart mousedown\", touchstart);\n                $el.off(\"touchmove mouseout\", touchmove);\n                $el.off(\"touchend mouseup\", touchend);\n            }\n        }\n    };\n}));\n",
                "subject": "cleanup",
                "message": "cleanup\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "tuxracer/touchclick,tuxracer/touchclick"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10240,
            "row": {
                "commit": "0ba40915f6d1fba5c47c42f96fa5315a9f280594",
                "old_file": "test/main/deepEqual.js",
                "new_file": "test/main/deepEqual.js",
                "old_contents":"/* eslint array-bracket-spacing:off, comma-spacing:off, max-len:off */\n/* globals Set:false, Map:false, Symbol:false */\n\nQUnit.module( \"equiv\" );\n\nQUnit.test( \"Primitive types and constants\", function( assert ) {\n\tassert.equal( QUnit.equiv( null, null ), true, \"null\" );\n\tassert.equal( QUnit.equiv( null, {} ), false, \"null\" );\n\tassert.equal( QUnit.equiv( null, undefined ), false, \"null\" );\n\tassert.equal( QUnit.equiv( null, 0 ), false, \"null\" );\n\tassert.equal( QUnit.equiv( null, false ), false, \"null\" );\n\tassert.equal( QUnit.equiv( null, \"\" ), false, \"null\" );\n\tassert.equal( QUnit.equiv( null, [] ), false, \"null\" );\n\n\tassert.equal( QUnit.equiv( undefined, undefined ), true, \"undefined\" );\n\tassert.equal( QUnit.equiv( undefined, null ), false, \"undefined\" );\n\tassert.equal( QUnit.equiv( undefined, 0 ), false, \"undefined\" );\n\tassert.equal( QUnit.equiv( undefined, false ), false, \"undefined\" );\n\tassert.equal( QUnit.equiv( undefined, {} ), false, \"undefined\" );\n\tassert.equal( QUnit.equiv( undefined, [] ), false, \"undefined\" );\n\tassert.equal( QUnit.equiv( undefined, \"\" ), false, \"undefined\" );\n\n\t// Nan usually doest not equal to Nan using the '==' operator.\n\t// Only isNaN() is able to do it.\n\tassert.equal( QUnit.equiv( 0 / 0, 0 / 0 ), true, \"NaN\" ); // NaN VS NaN\n\tassert.equal( QUnit.equiv( 1 / 0, 2 / 0 ), true, \"Infinity\" ); // Infinity VS Infinity\n\tassert.equal( QUnit.equiv( -1 / 0, 2 / 0 ), false, \"-Infinity, Infinity\" ); // -Infinity VS Infinity\n\tassert.equal( QUnit.equiv( -1 / 0, -2 / 0 ), true, \"-Infinity, -Infinity\" ); // -Infinity VS -Infinity\n\tassert.equal( QUnit.equiv( 0 / 0, 1 / 0 ), false, \"NaN, Infinity\" ); // Nan VS Infinity\n\tassert.equal( QUnit.equiv( 1 / 0, 0 / 0 ), false, \"NaN, Infinity\" ); // Nan VS Infinity\n\tassert.equal( QUnit.equiv( 0 / 0, null ), false, \"NaN\" );\n\tassert.equal( QUnit.equiv( 0 / 0, undefined ), false, \"NaN\" );\n\tassert.equal( QUnit.equiv( 0 / 0, 0 ), false, \"NaN\" );\n\tassert.equal( QUnit.equiv( 0 / 0, false ), false, \"NaN\" );\n\tassert.equal( QUnit.equiv( 0 / 0, function() {} ), false, \"NaN\" );\n\tassert.equal( QUnit.equiv( 1 / 0, null ), false, \"NaN, Infinity\" );\n\tassert.equal( QUnit.equiv( 1 / 0, undefined ), false, \"NaN, Infinity\" );\n\tassert.equal( QUnit.equiv( 1 / 0, 0 ), false, \"NaN, Infinity\" );\n\tassert.equal( QUnit.equiv( 1 / 0, 1 ), false, \"NaN, Infinity\" );\n\tassert.equal( QUnit.equiv( 1 / 0, false ), false, \"NaN, Infinity\" );\n\tassert.equal( QUnit.equiv( 1 / 0, true ), false, \"NaN, Infinity\" );\n\tassert.equal( QUnit.equiv( 1 / 0, function() {} ), false, \"NaN, Infinity\" );\n\n\tassert.equal( QUnit.equiv( 0, 0 ), true, \"number\" );\n\tassert.equal( QUnit.equiv( 0, 1 ), false, \"number\" );\n\tassert.equal( QUnit.equiv( 1, 0 ), false, \"number\" );\n\tassert.equal( QUnit.equiv( 1, 1 ), true, \"number\" );\n\tassert.equal( QUnit.equiv( 1.1, 1.1 ), true, \"number\" );\n\tassert.equal( QUnit.equiv( 0.0000005, 0.0000005 ), true, \"number\" );\n\tassert.equal( QUnit.equiv( 0, \"\" ), false, \"number\" );\n\tassert.equal( QUnit.equiv( 0, \"0\" ), false, \"number\" );\n\tassert.equal( QUnit.equiv( 1, \"1\" ), false, \"number\" );\n\tassert.equal( QUnit.equiv( 0, false ), false, \"number\" );\n\tassert.equal( QUnit.equiv( 1, true ), false, \"number\" );\n\n\tassert.equal( QUnit.equiv( true, true ), true, \"boolean\" );\n\tassert.equal( QUnit.equiv( true, false ), false, \"boolean\" );\n\tassert.equal( QUnit.equiv( false, true ), false, \"boolean\" );\n\tassert.equal( QUnit.equiv( false, 0 ), false, \"boolean\" );\n\tassert.equal( QUnit.equiv( false, null ), false, \"boolean\" );\n\tassert.equal( QUnit.equiv( false, undefined ), false, \"boolean\" );\n\tassert.equal( QUnit.equiv( true, 1 ), false, \"boolean\" );\n\tassert.equal( QUnit.equiv( true, null ), false, \"boolean\" );\n\tassert.equal( QUnit.equiv( true, undefined ), false, \"boolean\" );\n\n\tassert.equal( QUnit.equiv( \"\", \"\" ), true, \"string\" );\n\tassert.equal( QUnit.equiv( \"a\", \"a\" ), true, \"string\" );\n\tassert.equal( QUnit.equiv( \"foobar\", \"foobar\" ), true, \"string\" );\n\tassert.equal( QUnit.equiv( \"foobar\", \"foo\" ), false, \"string\" );\n\tassert.equal( QUnit.equiv( \"\", 0 ), false, \"string\" );\n\tassert.equal( QUnit.equiv( \"\", false ), false, \"string\" );\n\tassert.equal( QUnit.equiv( \"\", null ), false, \"string\" );\n\tassert.equal( QUnit.equiv( \"\", undefined ), false, \"string\" );\n\n\t// Rename for lint validation.\n\t// We know this is bad, we are asserting whether we can coop with bad code like this.\n\tvar SafeNumber = Number,\n\t\tSafeString = String,\n\t\tSafeBoolean = Boolean,\n\t\tSafeObject = Object;\n\n\t// primitives vs. objects\n\n\tassert.equal( QUnit.equiv( 0, new SafeNumber() ), true, \"number 0 primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeNumber(), 0 ), true, \"number 0 object vs. primitive\" );\n\tassert.equal( QUnit.equiv( new SafeNumber(), new SafeNumber() ), true, \"empty number objects\" );\n\tassert.equal( QUnit.equiv( 1, new SafeNumber( 1 ) ), true, \"number 1 primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeNumber( 1 ), 1 ), true, \"number 1 object vs. primitive\" );\n\tassert.equal( QUnit.equiv( new SafeNumber( 1 ), new SafeNumber( 1 ) ), true, \"number 1 objects\" );\n\tassert.equal( QUnit.equiv( 0, new SafeNumber( 1 ) ), false, \"differing number primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeNumber( 0 ), 1 ), false, \"differing number object vs. primitive\" );\n\n\tassert.equal( QUnit.equiv( \"\", new SafeString() ), true, \"empty string primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeString(), \"\" ), true, \"empty string object vs. primitive\" );\n\tassert.equal( QUnit.equiv( new SafeString(), new SafeString() ), true, \"empty string objects\" );\n\tassert.equal( QUnit.equiv( \"My String\", new SafeString( \"My String\" ) ), true, \"nonempty string primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeString( \"My String\" ), \"My String\" ), true, \"nonempty string object vs. primitive\" );\n\tassert.equal( QUnit.equiv( new SafeString( \"My String\" ), new SafeString( \"My String\" ) ), true, \"nonempty string objects\" );\n\tassert.equal( QUnit.equiv( \"Bad String\", new SafeString( \"My String\" ) ), false, \"differing string primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeString( \"Bad String\" ), \"My String\" ), false, \"differing string object vs. primitive\" );\n\n\tassert.equal( QUnit.equiv( false, new SafeBoolean() ), true, \"boolean false primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeBoolean(), false ), true, \"boolean empty object vs. primitive\" );\n\tassert.equal( QUnit.equiv( new SafeBoolean(), new SafeBoolean() ), true, \"empty boolean objects\" );\n\tassert.equal( QUnit.equiv( true, new SafeBoolean( true ) ), true, \"boolean true primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeBoolean( true ), true ), true, \"boolean true object vs. primitive\" );\n\tassert.equal( QUnit.equiv( new SafeBoolean( true ), new SafeBoolean( true ) ), true, \"boolean true objects\" );\n\tassert.equal( QUnit.equiv( true, new SafeBoolean( 1 ) ), true, \"boolean true primitive vs. truthy object\" );\n\tassert.equal( QUnit.equiv( false, new SafeBoolean( false ) ), true, \"boolean false primitive vs. false object\" );\n\tassert.equal( QUnit.equiv( new SafeBoolean( false ), false ), true, \"boolean false object vs. primitive\" );\n\tassert.equal( QUnit.equiv( new SafeBoolean( false ), new SafeBoolean( false ) ), true, \"boolean false objects\" );\n\tassert.equal( QUnit.equiv( false, new SafeBoolean( 0 ) ), true, \"boolean false primitive vs. 0 object\" );\n\tassert.equal( QUnit.equiv( true, new SafeBoolean( false ) ), false, \"differing boolean primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeBoolean( false ), true ), false, \"differing boolean object vs. primitive\" );\n\n\tassert.equal( QUnit.equiv( new SafeObject(), {} ), true, \"empty object instantiation vs. literal\" );\n\tassert.equal( QUnit.equiv( {}, new SafeObject() ), true, \"empty object literal vs. instantiation\" );\n\tassert.equal( QUnit.equiv( new SafeObject(), { a: 1 } ), false, \"empty object instantiation vs. nonempty literal\" );\n\tassert.equal( QUnit.equiv( { a: 1 }, new SafeObject() ), false, \"nonempty object literal vs. empty instantiation\" );\n\tassert.equal( QUnit.equiv( { a: undefined }, new SafeObject() ), false, \"other nonempty object literal vs. empty instantiation\" );\n\tassert.equal( QUnit.equiv( new SafeObject(), { a: undefined } ), false, \"empty object instantiation vs. other nonempty literal\" );\n} );\n\nQUnit.test( \"Objects basics\", function( assert ) {\n\tassert.equal( QUnit.equiv( {}, {} ), true );\n\tassert.equal( QUnit.equiv( {}, null ), false );\n\tassert.equal( QUnit.equiv( {}, undefined ), false );\n\tassert.equal( QUnit.equiv( {}, 0 ), false );\n\tassert.equal( QUnit.equiv( {}, false ), false );\n\n\t// This test is a hard one, it is very important\n\t// REASONS:\n\t//\t\t1) They are of the same type \"object\"\n\t//\t\t2) [] instanceof Object is true\n\t//\t\t3) Their properties are the same (doesn't exists)\n\tassert.equal( QUnit.equiv( {}, [] ), false );\n\n\tassert.equal( QUnit.equiv( { a: 1 }, { a: 1 } ), true );\n\tassert.equal( QUnit.equiv( { a: 1 }, { a: \"1\" } ), false );\n\tassert.equal( QUnit.equiv( { a: [] }, { a: [] } ), true );\n\tassert.equal( QUnit.equiv( { a: {} }, { a: null } ), false );\n\tassert.equal( QUnit.equiv( { a: 1 }, {} ), false );\n\tassert.equal( QUnit.equiv( {}, { a: 1 } ), false );\n\n\t// Hard ones\n\tassert.equal( QUnit.equiv( { a: undefined }, {} ), false );\n\tassert.equal( QUnit.equiv( {}, { a: undefined } ), false );\n\tassert.equal( QUnit.equiv(\n\t\t{\n\t\t\ta: [ { bar: undefined } ]\n\t\t},\n\t\t{\n\t\t\ta: [ { bat: undefined } ]\n\t\t}\n\t), false );\n\n} );\n\nQUnit[ typeof Object.create === \"function\" ? \"test\" : \"skip\" ](\n\t\"Objects with null prototypes\", function( assert ) {\n\n\t\tvar nonEmptyWithNoProto;\n\n\t\t// Objects with no prototype, created via Object.create(null), are used\n\t\t// e.g. as dictionaries.\n\t\t// Being able to test equivalence against object literals is quite useful.\n\t\tassert.equal(\n\t\t\tQUnit.equiv( Object.create( null ), {} ),\n\t\t\ttrue,\n\t\t\t\"empty object without prototype VS empty object\"\n\t\t);\n\n\t\tassert.equal(\n\t\t\tQUnit.equiv( {}, Object.create( null ) ),\n\t\t\ttrue,\n\t\t\t\"empty object VS empty object without prototype\"\n\t\t);\n\n\t\tnonEmptyWithNoProto = Object.create( null );\n\t\tnonEmptyWithNoProto.foo = \"bar\";\n\n\t\tassert.equal(\n\t\t\tQUnit.equiv( nonEmptyWithNoProto, { foo: \"bar\" } ),\n\t\t\ttrue,\n\t\t\t\"object without prototype VS object\"\n\t\t);\n\n\t\tassert.equal(\n\t\t\tQUnit.equiv( { foo: \"bar\" }, nonEmptyWithNoProto ),\n\t\t\ttrue,\n\t\t\t\"object VS object without prototype\"\n\t\t);\n\t} );\n\n// Ref #851\nQUnit[ typeof Object.create === \"function\" ? \"test\" : \"skip\" ](\n\t\"Object prototype constructor is null\", function( assert ) {\n\n\t\t// Ref #851\n\t\t// Unfortunately, in practice `Object.create(null)` is fairly costly.\n\t\t// To mitigate this cost a specialized NullObject can be used. This\n\t\t// Object has similar safe characteristics, but with dramatically\n\t\t// reduced allocation costs.\n\t\tfunction NullObject() {}\n\t\tNullObject.prototype = Object.create( null, {\n\t\t\tconstructor: {\n\t\t\t\tvalue: null\n\t\t\t}\n\t\t} );\n\n\t\tvar a = new NullObject();\n\t\ta.foo = 1;\n\t\tvar b = { foo: 1 };\n\n\t\tassert.ok( QUnit.equiv( a, b ) );\n\t\tassert.ok( QUnit.equiv( b, a ) );\n\t} );\n\nQUnit.test( \"Arrays basics\", function( assert ) {\n\n\tassert.equal( QUnit.equiv( [], [] ), true );\n\n\t// May be a hard one, can invoke a crash at execution.\n\t// because their types are both \"object\" but null isn't\n\t// like a true object, it doesn't have any property at all.\n\tassert.equal( QUnit.equiv( [], null ), false );\n\n\tassert.equal( QUnit.equiv( [], undefined ), false );\n\tassert.equal( QUnit.equiv( [], false ), false );\n\tassert.equal( QUnit.equiv( [], 0 ), false );\n\tassert.equal( QUnit.equiv( [], \"\" ), false );\n\n\t// May be a hard one, but less hard\n\t// than {} with [] (note the order)\n\tassert.equal( QUnit.equiv( [], {} ), false );\n\n\tassert.equal( QUnit.equiv( [ null ], [] ), false );\n\tassert.equal( QUnit.equiv( [ undefined ], [] ), false );\n\tassert.equal( QUnit.equiv( [], [ null ] ), false );\n\tassert.equal( QUnit.equiv( [], [ undefined ] ), false );\n\tassert.equal( QUnit.equiv( [ null ], [ undefined ] ), false );\n\tassert.equal( QUnit.equiv( [ [] ], [ [] ] ), true );\n\tassert.equal( QUnit.equiv( [ [], [], [] ], [ [], [], [] ] ), true );\n\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[[],[],[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]],\n\t\t\t[[],[],[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]] ),\n\t\ttrue\n\t);\n\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[[],[],[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]],\n\t\t\t[[],[],[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]] ), // shorter\n\t\tfalse\n\t);\n\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[[],[],[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[ {} ]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]],\n\t\t\t[[],[],[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]] ), // deepest element not an array\n\t\tfalse\n\t);\n\n\t// same multidimensional\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[ 1,2,3,4,5,6,7,8,9, [\n\t\t\t\t1,2,3,4,5,6,7,8,9, [\n\t\t\t\t\t1,2,3,4,5,[\n\t\t\t\t\t\t[ 6,7,8,9, [\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t2,3,4,[\n\t\t\t\t\t\t\t\t\t\t1,2,[\n\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,5,6,7,8,9,[\n\t\t\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t\t\t],1,2,3,4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t],4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t],5,6,7\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t]\n\t\t\t\t]]],\n\t\t\t[ 1,2,3,4,5,6,7,8,9, [\n\t\t\t\t1,2,3,4,5,6,7,8,9, [\n\t\t\t\t\t1,2,3,4,5,[\n\t\t\t\t\t\t[ 6,7,8,9, [\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t2,3,4,[\n\t\t\t\t\t\t\t\t\t\t1,2,[\n\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,5,6,7,8,9,[\n\t\t\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t\t\t],1,2,3,4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t],4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t],5,6,7\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t]\n\t\t\t\t]]]\n\t\t),\n\t\ttrue,\n\t\t\"Multidimensional\"\n\t);\n\n\t// different multidimensional\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[ 1,2,3,4,5,6,7,8,9, [\n\t\t\t\t1,2,3,4,5,6,7,8,9, [\n\t\t\t\t\t1,2,3,4,5,[\n\t\t\t\t\t\t[ 6,7,8,9, [\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t2,3,4,[\n\t\t\t\t\t\t\t\t\t\t1,2,[\n\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,5,6,7,8,9,[\n\t\t\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t\t\t],1,2,3,4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t],4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t],5,6,7\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t]\n\t\t\t\t]]],\n\t\t\t[ 1,2,3,4,5,6,7,8,9, [\n\t\t\t\t1,2,3,4,5,6,7,8,9, [\n\t\t\t\t\t1,2,3,4,5,[\n\t\t\t\t\t\t[ 6,7,8,9, [\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t2,3,4,[\n\t\t\t\t\t\t\t\t\t\t1,2,[\n\t\t\t\t\t\t\t\t\t\t\t\"1\",2,3,4,[\t\t\t\t\t// string instead of number\n\t\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,5,6,7,8,9,[\n\t\t\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t\t\t],1,2,3,4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t],4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t],5,6,7\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t]\n\t\t\t\t]]]\n\t\t),\n\t\tfalse,\n\t\t\"Multidimensional\"\n\t);\n\n\t// different multidimensional\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[ 1,2,3,4,5,6,7,8,9, [\n\t\t\t\t1,2,3,4,5,6,7,8,9, [\n\t\t\t\t\t1,2,3,4,5,[\n\t\t\t\t\t\t[ 6,7,8,9, [\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t2,3,4,[\n\t\t\t\t\t\t\t\t\t\t1,2,[\n\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,5,6,7,8,9,[\n\t\t\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t\t\t],1,2,3,4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t],4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t],5,6,7\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t]\n\t\t\t\t]]],\n\t\t\t[ 1,2,3,4,5,6,7,8,9, [\n\t\t\t\t1,2,3,4,5,6,7,8,9, [\n\t\t\t\t\t1,2,3,4,5,[\n\t\t\t\t\t\t[ 6,7,8,9, [\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t2,3,[\t\t\t\t\t// missing an element (4)\n\t\t\t\t\t\t\t\t\t\t1,2,[\n\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,5,6,7,8,9,[\n\t\t\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t\t\t],1,2,3,4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t],4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t],5,6,7\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t]\n\t\t\t\t]]]\n\t\t),\n\t\tfalse,\n\t\t\"Multidimensional\"\n\t);\n} );\n\nQUnit.test( \"Functions\", function( assert ) {\n\tvar f0 = function() {},\n\t\tf1 = function() {},\n\n\t\t// f2 and f3 have the same code, formatted differently\n\t\tf2 = function() { return 0; },\n\t\tf3 = function() {\n\n\t\t\t// eslint-disable-next-line semi\n\t\t\treturn 0 // this comment and no semicoma as difference\n\t\t};\n\n\tassert.equal( QUnit.equiv( function() {}, function() {} ), false, \"Anonymous functions\" ); // exact source code\n\tassert.equal( QUnit.equiv( function() {}, function() {\n\t\treturn true;\n\t} ), false, \"Anonymous functions\" );\n\n\tassert.equal( QUnit.equiv( f0, f0 ), true, \"Function references\" ); // same references\n\tassert.equal( QUnit.equiv( f0, f1 ), false, \"Function references\" ); // exact source code, different references\n\tassert.equal( QUnit.equiv( f2, f3 ), false, \"Function references\" ); // equivalent source code, different references\n\tassert.equal( QUnit.equiv( f1, f2 ), false, \"Function references\" ); // different source code, different references\n\tassert.equal( QUnit.equiv( function() {}, true ), false );\n\tassert.equal( QUnit.equiv( function() {}, undefined ), false );\n\tassert.equal( QUnit.equiv( function() {}, null ), false );\n\tassert.equal( QUnit.equiv( function() {}, {} ), false );\n} );\n\nQUnit.test( \"Date instances\", function( assert ) {\n\n\t// Date, we don't need to test Date.parse() because it returns a number.\n\t// Only test the Date instances by setting them a fix date.\n\t// The date use is midnight January 1, 1970\n\tvar d1, d2, d3;\n\n\td1 = new Date();\n\td1.setTime( 0 ); // fix the date\n\n\td2 = new Date();\n\td2.setTime( 0 ); // fix the date\n\n\td3 = new Date(); // The very now\n\n\t// Anyway their types differs, just in case the code fails in the order in which it deals with date\n\tassert.equal( QUnit.equiv( d1, 0 ), false ); // d1.valueOf() returns 0, but d1 and 0 are different\n\n\t// test same values date and different instances equality\n\tassert.equal( QUnit.equiv( d1, d2 ), true );\n\n\t// test different date and different instances difference\n\tassert.equal( QUnit.equiv( d1, d3 ), false );\n} );\n\nQUnit.test( \"RegExp\", function( assert ) {\n\n\t// Must test cases that imply those traps:\n\t// var a = /./;\n\t// a instanceof Object;\t\t   // Oops\n\t// a instanceof RegExp;\t\t   // Oops\n\t// typeof a === \"function\";    // Oops, false in IE and Opera, true in FF and Safari (\"object\")\n\n\t// Tests same regex with same modifiers in different order\n\tvar regex1, regex2, regex3, r3a, r3b, ru1, ru2,\n\t\tr1 = /foo/,\n\t\tr2 = /foo/gim,\n\t\tr3 = /foo/gmi,\n\t\tr4 = /foo/igm,\n\t\tr5 = /foo/img,\n\t\tr6 = /foo/mig,\n\t\tr7 = /foo/mgi,\n\t\tri1 = /foo/i,\n\t\tri2 = /foo/i,\n\t\trm1 = /foo/m,\n\t\trm2 = /foo/m,\n\t\trg1 = /foo/g,\n\t\trg2 = /foo/g;\n\n\tassert.equal( QUnit.equiv( r2, r3 ), true, \"Modifier order\" );\n\tassert.equal( QUnit.equiv( r2, r4 ), true, \"Modifier order\" );\n\tassert.equal( QUnit.equiv( r2, r5 ), true, \"Modifier order\" );\n\tassert.equal( QUnit.equiv( r2, r6 ), true, \"Modifier order\" );\n\tassert.equal( QUnit.equiv( r2, r7 ), true, \"Modifier order\" );\n\tassert.equal( QUnit.equiv( r1, r2 ), false, \"Modifier\" );\n\n\tassert.equal( QUnit.equiv( ri1, ri2 ), true, \"Modifier\" );\n\tassert.equal( QUnit.equiv( r1, ri1 ), false, \"Modifier\" );\n\tassert.equal( QUnit.equiv( ri1, rm1 ), false, \"Modifier\" );\n\tassert.equal( QUnit.equiv( r1, rm1 ), false, \"Modifier\" );\n\tassert.equal( QUnit.equiv( rm1, ri1 ), false, \"Modifier\" );\n\tassert.equal( QUnit.equiv( rm1, rm2 ), true, \"Modifier\" );\n\tassert.equal( QUnit.equiv( rg1, rm1 ), false, \"Modifier\" );\n\tassert.equal( QUnit.equiv( rm1, rg1 ), false, \"Modifier\" );\n\tassert.equal( QUnit.equiv( rg1, rg2 ), true, \"Modifier\" );\n\n\t// Compare unicode modifier\n\ttry {\n\t\tr2 = new RegExp( \"foo\", \"umig\" );\n\t\tr3 = new RegExp( \"foo\", \"mgiu\" );\n\t\tassert.equal( QUnit.equiv( r2, r3 ), true, \"Modifier order\" );\n\t\tassert.equal( QUnit.equiv( r1, r2 ), false, \"Modifier\" );\n\n\t\tru1 = new RegExp( \"/u{1D306}\", \"u\" );\n\t\tru2 = new RegExp( \"/u{1D306}\", \"u\" );\n\t\tassert.equal( QUnit.equiv( ru1, rg1 ), false, \"Modifier\" );\n\t\tassert.equal( QUnit.equiv( rg1, ru1 ), false, \"Modifier\" );\n\t\tassert.equal( QUnit.equiv( ru1, ru2 ), true, \"Modifier\" );\n\t} catch ( e ) {}\n\n\t// Different regex, same modifiers\n\tr1 = /[a-z]/gi;\n\tr2 = /[0-9]/gi; // oops! different\n\tassert.equal( QUnit.equiv( r1, r2 ), false, \"Regex pattern\" );\n\n\tr1 = /0/ig;\n\tr2 = /\"0\"/ig; // oops! different\n\tassert.equal( QUnit.equiv( r1, r2 ), false, \"Regex pattern\" );\n\n\tr1 = /[\\n\\r\\]/g;\n\tr2 = /[\\n\\r\\]/g;\n\tr3 = /[\\n\\r\\]/g; // differs from r1\n\tr4 = /[\\n\\r\\]/; // differs from r1\n\n\tassert.equal( QUnit.equiv( r1, r2 ), true, \"Regex pattern\" );\n\tassert.equal( QUnit.equiv( r1, r3 ), false, \"Regex pattern\" );\n\tassert.equal( QUnit.equiv( r1, r4 ), false, \"Regex pattern\" );\n\n\t// More complex regex\n\tregex1 = \"^[-_.a-z0-9]+@([-_a-z0-9]+\\\\.)+([A-Za-z][A-Za-z]|[A-Za-z][A-Za-z][A-Za-z])|(([0-9][0-9]?|[0-1][0-9][0-9]|[2][0-4][0-9]|[2][5][0-5]))$\";\n\tregex2 = \"^[-_.a-z0-9]+@([-_a-z0-9]+\\\\.)+([A-Za-z][A-Za-z]|[A-Za-z][A-Za-z][A-Za-z])|(([0-9][0-9]?|[0-1][0-9][0-9]|[2][0-4][0-9]|[2][5][0-5]))$\";\n\n\t// regex 3 is different: '.' not escaped\n\tregex3 = \"^[-_.a-z0-9]+@([-_a-z0-9]+.)+([A-Za-z][A-Za-z]|[A-Za-z][A-Za-z][A-Za-z])|(([0-9][0-9]?|[0-1][0-9][0-9]|[2][0-4][0-9]|[2][5][0-5]))$\";\n\n\tr1 = new RegExp( regex1 );\n\tr2 = new RegExp( regex2 );\n\tr3 = new RegExp( regex3 ); // diff from r21, not same pattern\n\tr3a = new RegExp( regex3, \"gi\" ); // diff from r23, not same modifier\n\tr3b = new RegExp( regex3, \"ig\" ); // same as r23a\n\n\tassert.equal( QUnit.equiv( r1, r2 ), true, \"Complex Regex\" );\n\tassert.equal( QUnit.equiv( r1, r3 ), false, \"Complex Regex\" );\n\tassert.equal( QUnit.equiv( r3, r3a ), false, \"Complex Regex\" );\n\tassert.equal( QUnit.equiv( r3a, r3b ), true, \"Complex Regex\" );\n\n\t// typeof r1 is \"function\" in some browsers and \"object\" in others so we must cover this test\n\tr1 = / /;\n\tassert.equal( QUnit.equiv( r1, function() {} ), false, \"Regex internal\" );\n\tassert.equal( QUnit.equiv( r1, {} ), false, \"Regex internal\" );\n} );\n\nQUnit.test( \"Complex objects\", function( assert ) {\n\n\tfunction fn1() {\n\t\treturn \"fn1\";\n\t}\n\tfunction fn2() {\n\t\treturn \"fn2\";\n\t}\n\n\t// Try to invert the order of some properties to make sure it is covered.\n\t// It can failed when properties are compared between unsorted arrays.\n\tassert.equal( QUnit.equiv(\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\ta: 3.14159,\n\t\t\t\tb: false,\n\t\t\t\tc: {\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\tr: \"r\",\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\t\t\t\t\t\t\t\t\tt: undefined,\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\",\n\t\t\t\t\t\t\t\t\t\t\t\tz: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tq: [],\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\to: 99\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\td: 0,\n\t\t\t\t\ti: true,\n\t\t\t\t\th: \"false\"\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tg: \"\",\n\t\t\th: \"h\",\n\t\t\tf: {},\n\t\t\ti: []\n\t\t},\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\tb: false,\n\t\t\t\ta: 3.14159,\n\t\t\t\tc: {\n\t\t\t\t\td: 0,\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\tr: \"r\",\n\t\t\t\t\t\t\t\t\tt: undefined,\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\tz: null,\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\"\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\to: 99,\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\tq: []\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\ti: true,\n\t\t\t\t\th: \"false\"\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tg: \"\",\n\t\t\tf: {},\n\t\t\th: \"h\",\n\t\t\ti: []\n\t\t}\n\t), true );\n\n\tassert.equal( QUnit.equiv(\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\ta: 3.14159,\n\t\t\t\tb: false,\n\t\t\t\tc: {\n\t\t\t\t\td: 0,\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\n\t\t\t\t\t\t\t\t\t//r: \"r\",\t// different: missing a property\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\t\t\t\t\t\t\t\t\tt: undefined,\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\",\n\t\t\t\t\t\t\t\t\t\t\t\tz: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\to: 99,\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\tq: []\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\th: \"false\",\n\t\t\t\t\ti: true\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tf: {},\n\t\t\tg: \"\",\n\t\t\th: \"h\",\n\t\t\ti: []\n\t\t},\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\ta: 3.14159,\n\t\t\t\tb: false,\n\t\t\t\tc: {\n\t\t\t\t\td: 0,\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\tr: \"r\",\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\t\t\t\t\t\t\t\t\tt: undefined,\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\",\n\t\t\t\t\t\t\t\t\t\t\t\tz: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\to: 99,\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\tq: []\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\th: \"false\",\n\t\t\t\t\ti: true\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tf: {},\n\t\t\tg: \"\",\n\t\t\th: \"h\",\n\t\t\ti: []\n\t\t}\n\t), false );\n\n\tassert.equal( QUnit.equiv(\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\ta: 3.14159,\n\t\t\t\tb: false,\n\t\t\t\tc: {\n\t\t\t\t\td: 0,\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\tr: \"r\",\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\t\t\t\t\t\t\t\t\tt: undefined,\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\",\n\t\t\t\t\t\t\t\t\t\t\t\tz: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\to: 99,\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\tq: []\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\th: \"false\",\n\t\t\t\t\ti: true\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tf: {},\n\t\t\tg: \"\",\n\t\t\th: \"h\",\n\t\t\ti: []\n\t\t},\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\ta: 3.14159,\n\t\t\t\tb: false,\n\t\t\t\tc: {\n\t\t\t\t\td: 0,\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\tr: \"r\",\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\n\t\t\t\t\t\t\t\t\t//t: undefined,\t\t\t\t\t// different: missing a property with an undefined value\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\",\n\t\t\t\t\t\t\t\t\t\t\t\tz: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\to: 99,\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\tq: []\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\th: \"false\",\n\t\t\t\t\ti: true\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tf: {},\n\t\t\tg: \"\",\n\t\t\th: \"h\",\n\t\t\ti: []\n\t\t}\n\t), false );\n\n\tassert.equal( QUnit.equiv(\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\ta: 3.14159,\n\t\t\t\tb: false,\n\t\t\t\tc: {\n\t\t\t\t\td: 0,\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\tr: \"r\",\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\t\t\t\t\t\t\t\t\tt: undefined,\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\",\n\t\t\t\t\t\t\t\t\t\t\t\tz: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\to: 99,\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\tq: []\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\th: \"false\",\n\t\t\t\t\ti: true\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tf: {},\n\t\t\tg: \"\",\n\t\t\th: \"h\",\n\t\t\ti: []\n\t\t},\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\ta: 3.14159,\n\t\t\t\tb: false,\n\t\t\t\tc: {\n\t\t\t\t\td: 0,\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\tr: \"r\",\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\t\t\t\t\t\t\t\t\tt: undefined,\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\",\n\t\t\t\t\t\t\t\t\t\t\t\tz: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\to: 99,\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\tq: {}\t\t\t// different was []\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\th: \"false\",\n\t\t\t\t\ti: true\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tf: {},\n\t\t\tg: \"\",\n\t\t\th: \"h\",\n\t\t\ti: []\n\t\t}\n\t), false );\n\n\tvar same1 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1, 2, null, {}, [], [ 1, 2, 3 ] ],\n\t\t\t\t\tbar: undefined\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±Ï‚\"\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn1\n\t\t},\n\n\t\tsame2 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1, 2, null, {}, [], [ 1, 2, 3 ] ],\n\t\t\t\t\tbar: undefined\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±Ï‚\"\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn1\n\t\t},\n\n\t\tdiff1 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1, 2, null, {}, [], [ 1, 2, 3, 4 ] ], // different: 4 was add to the array\n\t\t\t\t\tbar: undefined\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±Ï‚\"\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn1\n\t\t},\n\n\t\tdiff2 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1, 2, null, {}, [], [ 1, 2, 3 ] ],\n\t\t\t\t\tnewprop: undefined, // different: newprop was added\n\t\t\t\t\tbar: undefined\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±Ï‚\"\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn1\n\t\t},\n\n\t\tdiff3 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1, 2, null, {}, [], [ 1, 2, 3 ] ],\n\t\t\t\t\tbar: undefined\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±\" // different: missing last char\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn1\n\t\t},\n\n\t\tdiff4 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1,2,undefined,{}, [], [ 1, 2, 3 ] ], // different: undefined instead of null\n\t\t\t\t\tbar: undefined\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±Ï‚\"\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn1\n\t\t},\n\n\t\tdiff5 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1, 2, null, {}, [], [ 1, 2, 3 ] ],\n\t\t\t\t\tbat: undefined // different: property name not \"bar\"\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±Ï‚\"\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn1\n\t\t},\n\n\t\tdiff6 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1, 2, null, {}, [], [ 1, 2, 3 ] ],\n\t\t\t\t\tbar: undefined\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±Ï‚\"\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn2 // different: fn2 instead of fn1\n\t\t};\n\n\tassert.equal( QUnit.equiv( same1, same2 ), true );\n\tassert.equal( QUnit.equiv( same2, same1 ), true );\n\tassert.equal( QUnit.equiv( same2, diff1 ), false );\n\tassert.equal( QUnit.equiv( diff1, same2 ), false );\n\n\tassert.equal( QUnit.equiv( same1, diff1 ), false );\n\tassert.equal( QUnit.equiv( same1, diff2 ), false );\n\tassert.equal( QUnit.equiv( same1, diff3 ), false );\n\tassert.equal( QUnit.equiv( same1, diff3 ), false );\n\tassert.equal( QUnit.equiv( same1, diff4 ), false );\n\tassert.equal( QUnit.equiv( same1, diff5 ), false );\n\tassert.equal( QUnit.equiv( same1, diff6 ), false );\n\tassert.equal( QUnit.equiv( diff5, diff1 ), false );\n} );\n\nQUnit.test( \"Complex Arrays\", function( assert ) {\n\n\tfunction fn() {}\n\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[ 1, 2, 3, true, {}, null, [\n\t\t\t\t{\n\t\t\t\t\ta: [ \"\", \"1\", 0 ]\n\t\t\t\t},\n\t\t\t\t5, 6, 7\n\t\t\t], \"foo\" ],\n\t\t\t[ 1, 2, 3, true, {}, null, [\n\t\t\t\t{\n\t\t\t\t\ta: [ \"\", \"1\", 0 ]\n\t\t\t\t},\n\t\t\t\t5, 6, 7\n\t\t\t], \"foo\" ]\n\t\t),\n\t\ttrue\n\t);\n\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[ 1, 2, 3, true, {}, null, [\n\t\t\t\t{\n\t\t\t\t\ta: [ \"\", \"1\", 0 ]\n\t\t\t\t},\n\t\t\t\t5, 6, 7\n\t\t\t], \"foo\" ],\n\t\t\t[ 1, 2, 3, true, {}, null, [\n\t\t\t\t{\n\t\t\t\t\tb: [ \"\", \"1\", 0 ]\t\t  // not same property name\n\t\t\t\t},\n\t\t\t\t5, 6, 7\n\t\t\t], \"foo\" ]\n\t\t),\n\t\tfalse\n\t);\n\n\tvar a = [ {\n\t\tb: fn,\n\t\tc: false,\n\t\t\"do\": \"reserved word\",\n\t\t\"for\": {\n\t\t\tar: [ 3, 5, 9, \"hey!\", [], {\n\t\t\t\tar: [ 1,[\n\t\t\t\t\t3,4,6,9, null, [], []\n\t\t\t\t] ],\n\t\t\t\te: fn,\n\t\t\t\tf: undefined\n\t\t\t} ]\n\t\t},\n\t\te: 0.43445\n\t}, 5, \"string\", 0, fn, false, null, undefined, 0, [\n\t\t4,5,6,7,8,9,11,22,33,44,55,\"66\", null, [], [[[[[ 3 ]]]], \"3\" ], {}, 1 / 0\n\t], [], [ [ [], \"foo\", null, {\n\t\tn: 1 / 0,\n\t\tz: {\n\t\t\ta: [ 3, 4, 5, 6, \"yep!\", undefined, undefined ],\n\t\t\tb: {}\n\t\t}\n\t}, {} ] ] ];\n\n\tassert.equal( QUnit.equiv( a,\n\t\t[ {\n\t\t\tb: fn,\n\t\t\tc: false,\n\t\t\t\"do\": \"reserved word\",\n\t\t\t\"for\": {\n\t\t\t\tar: [ 3, 5, 9, \"hey!\", [], {\n\t\t\t\t\tar: [ 1, [\n\t\t\t\t\t\t3,4,6,9, null, [], []\n\t\t\t\t\t]],\n\t\t\t\t\te: fn,\n\t\t\t\t\tf: undefined\n\t\t\t\t} ]\n\t\t\t},\n\t\t\te: 0.43445\n\t\t}, 5, \"string\", 0, fn, false, null, undefined, 0, [\n\t\t\t4,5,6,7,8,9,11,22,33,44,55,\"66\", null, [], [[[[[ 3 ]]]], \"3\" ], {}, 1 / 0\n\t\t], [], [[[], \"foo\", null, {\n\t\t\tn: 1 / 0,\n\t\t\tz: {\n\t\t\t\ta: [ 3, 4, 5, 6, \"yep!\", undefined, undefined ],\n\t\t\t\tb: {}\n\t\t\t}\n\t\t}, {}]]] ), true );\n\n\tassert.equal( QUnit.equiv( a,\n\t\t[ {\n\t\t\tb: fn,\n\t\t\tc: false,\n\t\t\t\"do\": \"reserved word\",\n\t\t\t\"for\": {\n\t\t\t\tar: [ 3, 5, 9, \"hey!\", [], {\n\t\t\t\t\tar: [ 1, [\n\t\t\t\t\t\t3,4,6,9, null, [], []\n\t\t\t\t\t]],\n\t\t\t\t\te: fn,\n\t\t\t\t\tf: undefined\n\t\t\t\t} ]\n\t\t\t},\n\t\t\te: 0.43445\n\t\t}, 5, \"string\", 0, fn, false, null, undefined, 0, [\n\t\t\t4,5,6,7,8,9,11,22,33,44,55,\"66\", null, [], [[[[[ 2 ]]]], \"3\"], {}, 1 / 0\t// different: [[[[[2]]]]] instead of [[[[[3]]]]]\n\t\t], [], [[[], \"foo\", null, {\n\t\t\tn: 1 / 0,\n\t\t\tz: {\n\t\t\t\ta: [ 3, 4, 5, 6, \"yep!\", undefined, undefined ],\n\t\t\t\tb: {}\n\t\t\t}\n\t\t}, {}]]] ), false );\n\n\tassert.equal( QUnit.equiv( a,\n\t\t[ {\n\t\t\tb: fn,\n\t\t\tc: false,\n\t\t\t\"do\": \"reserved word\",\n\t\t\t\"for\": {\n\t\t\t\tar: [ 3, 5, 9, \"hey!\", [], {\n\t\t\t\t\tar: [ 1, [\n\t\t\t\t\t\t3,4,6,9, null, [], []\n\t\t\t\t\t]],\n\t\t\t\t\te: fn,\n\t\t\t\t\tf: undefined\n\t\t\t\t} ]\n\t\t\t},\n\t\t\te: 0.43445\n\t\t}, 5, \"string\", 0, fn, false, null, undefined, 0, [\n\t\t\t4,5,6,7,8,9,11,22,33,44,55,\"66\", null, [], [[[[[ 3 ]]]], \"3\" ], {}, 1 / 0\n\t\t], [], [[[], \"foo\", null, {\n\t\t\tn: -1 / 0,\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  // different, -Infinity instead of Infinity\n\t\t\tz: {\n\t\t\t\ta: [ 3, 4, 5, 6, \"yep!\", undefined, undefined ],\n\t\t\t\tb: {}\n\t\t\t}\n\t\t}, {}]]] ), false );\n\n\tassert.equal( QUnit.equiv( a,\n\t\t[ {\n\t\t\tb: fn,\n\t\t\tc: false,\n\t\t\t\"do\": \"reserved word\",\n\t\t\t\"for\": {\n\t\t\t\tar: [ 3, 5, 9, \"hey!\", [], {\n\t\t\t\t\tar: [ 1, [\n\t\t\t\t\t\t3,4,6,9, null, [], []\n\t\t\t\t\t]],\n\t\t\t\t\te: fn,\n\t\t\t\t\tf: undefined\n\t\t\t\t} ]\n\t\t\t},\n\t\t\te: 0.43445\n\t\t}, 5, \"string\", 0, fn, false, null, undefined, 0, [\n\t\t\t4,5,6,7,8,9,11,22,33,44,55,\"66\", null, [], [[[[[ 3 ]]]], \"3\" ], {}, 1 / 0\n\t\t], [], [[[], \"foo\", {\t\t\t\t\t\t\t\t\t\t\t\t\t\t// different: null is missing\n\t\t\tn: 1 / 0,\n\t\t\tz: {\n\t\t\t\ta: [ 3, 4, 5, 6, \"yep!\", undefined, undefined ],\n\t\t\t\tb: {}\n\t\t\t}\n\t\t}, {}]]] ), false );\n\n\tassert.equal( QUnit.equiv( a,\n\t\t[ {\n\t\t\tb: fn,\n\t\t\tc: false,\n\t\t\t\"do\": \"reserved word\",\n\t\t\t\"for\": {\n\t\t\t\tar: [ 3, 5, 9, \"hey!\", [], {\n\t\t\t\t\tar: [ 1, [\n\t\t\t\t\t\t3,4,6,9, null, [], []\n\t\t\t\t\t]],\n\t\t\t\t\te: fn\n\n\t\t\t\t\t// different: missing property f: undefined\n\t\t\t\t} ]\n\t\t\t},\n\t\t\te: 0.43445\n\t\t}, 5, \"string\", 0, fn, false, null, undefined, 0, [\n\t\t\t4,5,6,7,8,9,11,22,33,44,55,\"66\", null, [], [[[[[ 3 ]]]], \"3\" ], {}, 1 / 0\n\t\t], [], [[[], \"foo\", null, {\n\t\t\tn: 1 / 0,\n\t\t\tz: {\n\t\t\t\ta: [ 3, 4, 5, 6, \"yep!\", undefined, undefined ],\n\t\t\t\tb: {}\n\t\t\t}\n\t\t}, {}]]] ), false );\n} );\n\nQUnit.test( \"Prototypal inheritance\", function( assert ) {\n\tfunction Gizmo( id ) {\n\t\tthis.id = id;\n\t}\n\n\tfunction Hoozit( id ) {\n\t\tthis.id = id;\n\t}\n\tHoozit.prototype = new Gizmo();\n\n\tvar gizmo = new Gizmo( \"ok\" ),\n\t\thoozit = new Hoozit( \"ok\" );\n\n\t// Try this test many times after test on instances that hold function\n\t// to make sure that our code does not mess with last object constructor memoization.\n\tassert.equal( QUnit.equiv( function() {}, function() {} ), false );\n\n\t// Hoozit inherit from Gizmo\n\t// hoozit instanceof Hoozit; // true\n\t// hoozit instanceof Gizmo; // true\n\tassert.equal( QUnit.equiv( hoozit, gizmo ), true );\n\n\tGizmo.prototype.bar = true; // not a function just in case we skip them\n\n\t// Hoozit inherit from Gizmo\n\t// They are equivalent\n\tassert.equal( QUnit.equiv( hoozit, gizmo ), true );\n\n\t// Make sure this is still true !important\n\t// The reason for this is that I forgot to reset the last\n\t// caller to where it were called from.\n\tassert.equal( QUnit.equiv( function() {}, function() {} ), false );\n\n\t// Make sure this is still true !important\n\tassert.equal( QUnit.equiv( hoozit, gizmo ), true );\n\n\tHoozit.prototype.foo = true; // not a function just in case we skip them\n\n\t// Gizmo does not inherit from Hoozit\n\t// gizmo instanceof Gizmo; // true\n\t// gizmo instanceof Hoozit; // false\n\t// They are not equivalent\n\tassert.equal( QUnit.equiv( hoozit, gizmo ), false );\n\n\t// Make sure this is still true !important\n\tassert.equal( QUnit.equiv( function() {}, function() {} ), false );\n} );\n\nQUnit.test( \"Instances\", function( assert ) {\n\tvar a1, a2, b1, b2, c1, c2, c3, car, carSame, carDiff, human;\n\n\tfunction A() {}\n\ta1 = new A();\n\ta2 = new A();\n\n\tfunction B() {\n\t\tthis.fn = function() {};\n\t}\n\tb1 = new B();\n\tb2 = new B();\n\n\tfunction C( fn ) {\n\t\tthis.fn = fn;\n\t}\n\n\tc1 = new C( function() { return true; } );\n\tc2 = new C( function() { return false; } );\n\tc3 = new C( function() { return true; } );\n\n\tassert.equal( QUnit.equiv( a1, a2 ), true, \"Same property, same constructor\" );\n\n\t// b1.fn and b2.fn are functions but they are different references\n\t// But we decided to skip function for instances.\n\tassert.equal( QUnit.equiv( b1, b2 ), true, \"Same property, same constructor\" );\n\n\tassert.equal( QUnit.equiv( c1, c2 ), false, \"Same property with different reference and different function\" );\n\tassert.equal( QUnit.equiv( c1, c3 ), true, \"Same property with different reference but same function\" );\n\n\t// failed\n\tassert.equal( QUnit.equiv( a1, b1 ), false, \"Same properties but different constructor\" );\n\n\tfunction Car( year ) {\n\t\tvar privateVar = 0;\n\t\tthis.year = year;\n\t\tthis.isOld = function() {\n\t\t\treturn privateVar > 10;\n\t\t};\n\t}\n\n\tfunction Human( year ) {\n\t\tvar privateVar = 1;\n\t\tthis.year = year;\n\t\tthis.isOld = function() {\n\t\t\treturn privateVar > 80;\n\t\t};\n\t}\n\n\tcar = new Car( 30 );\n\tcarSame = new Car( 30 );\n\tcarDiff = new Car( 10 );\n\thuman = new Human( 30 );\n\n\t/**\n\t * difference:\n\t *\t - year: 30\n\t * same:\n\t *\t - year: 30,\n\t *\t - isOld: function () {}\n\t */\n\n\tassert.equal( QUnit.equiv( car, car ), true );\n\tassert.equal( QUnit.equiv( car, carDiff ), false );\n\tassert.equal( QUnit.equiv( car, carSame ), true );\n\tassert.equal( QUnit.equiv( car, human ), false );\n} );\n\nQUnit.test(\n\t\"Complex instance nesting (with function values in literals and/or in nested instances)\",\n\tfunction( assert ) {\n\t\tvar a1, a2, b1, b2, c1, c2, d1, d2, e1, e2;\n\n\t\tfunction A( fn ) {\n\t\t\tthis.a = {};\n\t\t\tthis.fn = fn;\n\t\t\tthis.b = { a: [] };\n\t\t\tthis.o = {};\n\t\t\tthis.fn1 = fn;\n\t\t}\n\t\tfunction B( fn ) {\n\t\t\tthis.fn = fn;\n\t\t\tthis.fn1 = function() {};\n\t\t\tthis.a = new A( function() {} );\n\t\t}\n\n\t\tfunction fnOutside() {\n\t\t}\n\n\t\tfunction C( fn ) {\n\t\t\tfunction fnInside() {\n\t\t\t}\n\t\t\tthis.x = 10;\n\t\t\tthis.fn = fn;\n\t\t\tthis.fn1 = function() {};\n\t\t\tthis.fn2 = fnInside;\n\t\t\tthis.fn3 = {\n\t\t\t\ta: true,\n\t\t\t\tb: fnOutside // ok make reference to a function in all instances scope\n\t\t\t};\n\t\t\tthis.o1 = {};\n\n\t\t\t// This function will be ignored.\n\t\t\t// Even if it is not visible for all instances (e.g. locked in a closures),\n\t\t\t// it is from a  property that makes part of an instance (e.g. from the C constructor)\n\t\t\tthis.b1 = new B( function() {} );\n\t\t\tthis.b2 = new B( {\n\t\t\t\tx: {\n\t\t\t\t\tb2: new B( function() {} )\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tfunction D( fn ) {\n\t\t\tfunction fnInside() {\n\t\t\t}\n\t\t\tthis.x = 10;\n\t\t\tthis.fn = fn;\n\t\t\tthis.fn1 = function() {};\n\t\t\tthis.fn2 = fnInside;\n\t\t\tthis.fn3 = {\n\t\t\t\ta: true,\n\t\t\t\tb: fnOutside, // ok make reference to a function in all instances scope\n\n\t\t\t\t// This function won't be ignored.\n\t\t\t\t// It isn't visible for all C instances\n\t\t\t\t// and it is not in a property of an instance.\n\t\t\t\t// (in an Object instances e.g. the object literal)\n\t\t\t\tc: fnInside\n\t\t\t};\n\t\t\tthis.o1 = {};\n\n\t\t\t// This function will be ignored.\n\t\t\t// Even if it is not visible for all instances (e.g. locked in a closures),\n\t\t\t// it is from a  property that makes part of an instance (e.g. from the C constructor)\n\t\t\tthis.b1 = new B( function() {} );\n\t\t\tthis.b2 = new B( {\n\t\t\t\tx: {\n\t\t\t\t\tb2: new B( function() {} )\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tfunction E( fn ) {\n\t\t\tfunction fnInside() {\n\t\t\t}\n\t\t\tthis.x = 10;\n\t\t\tthis.fn = fn;\n\t\t\tthis.fn1 = function() {};\n\t\t\tthis.fn2 = fnInside;\n\t\t\tthis.fn3 = {\n\t\t\t\ta: true,\n\t\t\t\tb: fnOutside // ok make reference to a function in all instances scope\n\t\t\t};\n\t\t\tthis.o1 = {};\n\n\t\t\t// This function will be ignored.\n\t\t\t// Even if it is not visible for all instances (e.g. locked in a closures),\n\t\t\t// it is from a  property that makes part of an instance (e.g. from the C constructor)\n\t\t\tthis.b1 = new B( function() {} );\n\t\t\tthis.b2 = new B( {\n\t\t\t\tx: {\n\t\t\t\t\tb1: new B( { a: function() {} } ),\n\t\t\t\t\tb2: new B( function() {} )\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\ta1 = new A( function() {} );\n\t\ta2 = new A( function() {} );\n\t\tassert.equal( QUnit.equiv( a1, a2 ), true );\n\n\t\tassert.equal( QUnit.equiv( a1, a2 ), true ); // different instances\n\n\t\tb1 = new B( function() {} );\n\t\tb2 = new B( function() {} );\n\t\tassert.equal( QUnit.equiv( b1, b2 ), true );\n\n\t\tc1 = new C( function() {} );\n\t\tc2 = new C( function() {} );\n\t\tassert.equal( QUnit.equiv( c1, c2 ), true );\n\n\t\td1 = new D( function() {} );\n\t\td2 = new D( function() {} );\n\t\tassert.equal( QUnit.equiv( d1, d2 ), false );\n\n\t\te1 = new E( function() {} );\n\t\te2 = new E( function() {} );\n\t\tassert.equal( QUnit.equiv( e1, e2 ), false );\n\t}\n);\n\nQUnit.test( \"Object with circular references\", function( assert ) {\n\tvar circularA = {\n\t\t\tabc: null\n\t\t},\n\t\tcircularB = {\n\t\t\tabc: null\n\t\t};\n\tcircularA.abc = circularA;\n\tcircularB.abc = circularB;\n\tassert.equal( QUnit.equiv( circularA, circularB ), true,\n\t\t\"Should not repeat test on object (ambiguous test)\"\n\t);\n\n\tcircularA.def = 1;\n\tcircularB.def = 1;\n\tassert.equal( QUnit.equiv( circularA, circularB ), true,\n\t\t\"Should not repeat test on object (ambiguous test)\"\n\t);\n\n\tcircularA.def = 1;\n\tcircularB.def = 0;\n\tassert.equal( QUnit.equiv( circularA, circularB ), false,\n\t\t\"Should not repeat test on object (unambiguous test)\"\n\t);\n} );\n\nQUnit.test( \"Array with circular references\", function( assert ) {\n\tvar circularA = [],\n\t\tcircularB = [];\n\tcircularA.push( circularA );\n\tcircularB.push( circularB );\n\tassert.equal( QUnit.equiv( circularA, circularB ), true,\n\t\t\"Should not repeat test on array (ambiguous test)\"\n\t);\n\n\tcircularA.push( \"abc\" );\n\tcircularB.push( \"abc\" );\n\tassert.equal( QUnit.equiv( circularA, circularB ), true,\n\t\t\"Should not repeat test on array (ambiguous test)\"\n\t);\n\n\tcircularA.push( \"hello\" );\n\tcircularB.push( \"goodbye\" );\n\tassert.equal( QUnit.equiv( circularA, circularB ), false,\n\t\t\"Should not repeat test on array (unambiguous test)\"\n\t);\n} );\n\nQUnit.test( \"Mixed object/array with references to self wont loop\", function( assert ) {\n\tvar circularA = [ {\n\t\t\tabc: null\n\t\t} ],\n\t\tcircularB = [ {\n\t\t\tabc: null\n\t\t} ];\n\tcircularA[ 0 ].abc = circularA;\n\tcircularB[ 0 ].abc = circularB;\n\n\tcircularA.push( circularA );\n\tcircularB.push( circularB );\n\tassert.equal( QUnit.equiv( circularA, circularB ), true,\n\t\t\"Should not repeat test on object/array (ambiguous test)\"\n\t);\n\n\tcircularA[ 0 ].def = 1;\n\tcircularB[ 0 ].def = 1;\n\tassert.equal( QUnit.equiv( circularA, circularB ), true,\n\t\t\"Should not repeat test on object/array (ambiguous test)\"\n\t);\n\n\tcircularA[ 0 ].def = 1;\n\tcircularB[ 0 ].def = 0;\n\tassert.equal( QUnit.equiv( circularA, circularB ), false,\n\t\t\"Should not repeat test on object/array (unambiguous test)\"\n\t);\n} );\n\nQUnit.test( \"Compare self-referent to tree\", function( assert ) {\n\tvar temp,\n\t\tcircularA = [ 0 ],\n\t\ttreeA = [ 0, null ],\n\t\tcircularO = {},\n\t\ttreeO = {\n\t\t\to: null\n\t\t};\n\n\tcircularA[ 1 ] = circularA;\n\tcircularO.o = circularO;\n\n\tassert.equal( QUnit.equiv( circularA, treeA ), false,\n\t\t\"Array: Should not consider circular equal to tree\"\n\t);\n\tassert.equal( QUnit.equiv( circularO, treeO ), false,\n\t\t\"Object: Should not consider circular equal to tree\"\n\t);\n\n\ttemp = [ 0, circularA ];\n\tassert.equal( QUnit.equiv( circularA, temp ), true,\n\t\t\"Array: Reference is circular for one, but equal on other\"\n\t);\n\tassert.equal( QUnit.equiv( temp, circularA ), true,\n\t\t\"Array: Reference is circular for one, but equal on other\"\n\t);\n\n\ttemp = {\n\t\to: circularO\n\t};\n\tassert.equal( QUnit.equiv( circularO, temp ), true,\n\t\t\"Object: Reference is circular for one, but equal on other\"\n\t);\n\tassert.equal( QUnit.equiv( temp, circularO ), true,\n\t\t\"Object: Reference is circular for one, but equal on other\"\n\t);\n} );\n\nQUnit.test( \"Compare differently self-referential structures\", function( assert ) {\n\tvar x = [],\n\t\ty = [];\n\n\tx[ 0 ] = x;\n\ty[ 0 ] = [ y ];\n\n\t// x is [ x ], y is [ [ y ] ]\n\t// So both x and y look like [ [ [ [ ... ] ] ] ]\n\tassert.equal( QUnit.equiv( x, y ), true, \"Equivalent arrays\" );\n\ty = [];\n\ty[ 0 ] = [ y, 1 ];\n\n\t// x looks like [ [ [ [ ...  ] ] ] ]\n\t// y looks like [ [ [ [ ... , 1 ] ], 1 ] ]\n\tassert.equal( QUnit.equiv( x, y ), false, \"Nonequivalent arrays\" );\n\tx = {};\n\ty = {};\n\tx.val = x;\n\ty.val = { val: y };\n\n\t// Both x and y look like { val: { val: { ... } } }\n\tassert.equal( QUnit.equiv( x, y ), true, \"Equivalent objects\" );\n\n\t// x looks like { val: { val: { val: { val: { ... } } } } }\n\t// y looks like { val: { val: { val: { val: { ... }, foo: 1 } }, foo: 1 } }\n\ty.val = { val: y, foo: 1 };\n\tassert.equal( QUnit.equiv( x, y ), false, \"Nonequivalent objects\" );\n} );\n\nQUnit.test( \"Compare structures with multiple references to the same containers\", function( assert ) {\n\tvar i,\n\t\tx = {},\n\t\ty = {};\n\tfor ( i = 0; i < 20; i++ ) {\n\t\tx = { foo: x, bar: x, baz: x };\n\t\ty = { foo: y, bar: y, baz: y };\n\t}\n\tassert.equal( QUnit.equiv( { big: x, z: [ true ] }, { big: y, z: [ true ] } ), true, \"Equivalent structures\" );\n\tassert.equal( QUnit.equiv( { big: x, z: [ true ] }, { big: y, z: [ false ] } ), false, \"Nonequivalent structures\" );\n} );\n\nQUnit.test( \"Test that must be done at the end because they extend some primitive's prototype\",\n\tfunction( assert ) {\n\n\t\t// Try that a function looks like our regular expression.\n\t\t// This tests if we check that a and b are really both instance of RegExp\n\t\tFunction.prototype.global = true;\n\t\tFunction.prototype.multiline = true;\n\t\tFunction.prototype.ignoreCase = false;\n\t\tFunction.prototype.source = \"my regex\";\n\t\tvar re = /my regex/gm;\n\t\tassert.equal( QUnit.equiv( re, function() {} ), false,\n\t\t\t\"A function that looks that a regex isn't a regex\"\n\t\t);\n\n\t\t// This test will ensures it works in both ways,\n\t\t// and ALSO especially that we can make differences\n\t\t// between RegExp and Function constructor because\n\t\t// typeof on a RegExpt instance is \"function\"\n\t\tassert.equal( QUnit.equiv( function() {}, re ), false,\n\t\t\t\"Same conversely, but ensures that function and regexp are distinct because their constructor are different\"\n\t\t);\n\t}\n);\n\nQUnit.module( \"equiv Object-wrapped primitives\" );\n\nQUnit.test( \"Number\", function( assert ) {\n\tvar SafeNumber = Number;\n\n\tassert.ok( QUnit.equiv( new SafeNumber( 1 ), new SafeNumber( 1 ) ),\n\t\t\"Number objects with same values are equivalent.\"\n\t);\n\tassert.ok( QUnit.equiv( new SafeNumber( 0 / 0 ), new SafeNumber( 0 / 0 ) ),\n\t\t\"NaN Number objects are equivalent.\"\n\t);\n\tassert.ok( QUnit.equiv( new SafeNumber( 1 / 0 ), new SafeNumber( 2 / 0 ) ),\n\t\t\"Infinite Number objects are equivalent.\"\n\t);\n\n\tassert.notOk( QUnit.equiv( new SafeNumber( 1 ), new SafeNumber( 2 ) ),\n\t\t\"Number objects with different values are not equivalent.\"\n\t);\n\tassert.notOk( QUnit.equiv( new SafeNumber( 0 / 0 ), new SafeNumber( 1 / 0 ) ),\n\t\t\"NaN Number objects and infinite Number objects are not equivalent.\"\n\t);\n\tassert.notOk( QUnit.equiv( new SafeNumber( 1 / 0 ), new SafeNumber( -1 / 0 ) ),\n\t\t\"Positive and negative infinite Number objects are not equivalent.\"\n\t);\n} );\n\nQUnit.test( \"String\", function( assert ) {\n\tvar SafeString = String;\n\n\tassert.ok( QUnit.equiv( new SafeString( \"foo\" ), new SafeString( \"foo\" ) ),\n\t\t\"String objects with same values are equivalent.\"\n\t);\n\tassert.ok( QUnit.equiv( new SafeString( \"\" ), new SafeString( \"\" ) ),\n\t\t\"Empty String objects are equivalent.\"\n\t);\n\n\tassert.notOk( QUnit.equiv( new SafeString( \"foo\" ), new SafeString( \"bar\" ) ),\n\t\t\"String objects with different values are not equivalent.\"\n\t);\n\tassert.notOk( QUnit.equiv( new SafeString( \"\" ), new SafeString( \"foo\" ) ),\n\t\t\"Empty and nonempty String objects are not equivalent.\"\n\t);\n} );\n\nQUnit.test( \"Boolean\", function( assert ) {\n\tvar SafeBoolean = Boolean;\n\n\tassert.ok( QUnit.equiv( new SafeBoolean( true ), new SafeBoolean( true ) ),\n\t\t\"True Boolean objects are equivalent.\"\n\t);\n\tassert.ok( QUnit.equiv( new SafeBoolean( false ), new SafeBoolean( false ) ),\n\t\t\"False Boolean objects are equivalent.\"\n\t);\n\n\tassert.notOk( QUnit.equiv( new SafeBoolean( true ), new SafeBoolean( false ) ),\n\t\t\"Boolean objects with different values are not equivalent.\"\n\t);\n} );\n\nQUnit.module( \"equiv Maps and Sets\" );\n\nvar hasES6Set = ( function() {\n\tif ( typeof Set !== \"function\" ) {\n\t\treturn false;\n\t}\n\n\ttry {\n\n\t\t// some platforms don't support iterables in Set constructors\n\t\tvar s = new Set( [ 1, 2, 3 ] );\n\t\tif ( s.size !== 3 || !s.has( 2 ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// in IE 11, QUnit.objectType( new Set() ) === \"object\"\n\t\treturn ( QUnit.objectType( s ) === \"set\" );\n\t} catch ( e ) {\n\t\treturn false;\n\t}\n}() );\n\nvar hasES6Map = ( function() {\n\tif ( typeof Map !== \"function\" ) {\n\t\treturn false;\n\t}\n\n\ttry {\n\n\t\t// some platforms don't support array-like iterables in Map constructors\n\t\tvar m = new Map( [ [ 1, 2 ] ] );\n\t\tif ( m.size !== 1 || !m.has( 1 ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// in IE 11, QUnit.objectType( new Map() ) === \"object\"\n\t\treturn ( QUnit.objectType( m ) === \"map\" );\n\t} catch ( e ) {\n\t\treturn false;\n\t}\n}() );\n\nQUnit[ hasES6Set ? \"test\" : \"skip\" ]( \"Sets\", function( assert ) {\n\tvar s1, s2, s3, s4, o1, o2, o3, o4, m1, m2, m3;\n\n\t// Empty sets\n\ts1 = new Set();\n\ts2 = new Set( [] );\n\tassert.equal( QUnit.equiv( s1, s2 ), true, \"Empty sets\" );\n\n\t// Simple cases\n\ts1 = new Set( [ 1 ] );\n\ts2 = new Set( [ 1 ] );\n\ts3 = new Set( [ 3 ] );\n\tassert.equal( QUnit.equiv( s1, s2 ), true, \"Single element sets [1] vs [1]\" );\n\tassert.equal( QUnit.equiv( s1, s3 ), false, \"Single element sets [1] vs [3]\" );\n\n\t// Tricky values\n\ts1 = new Set( [ false, undefined, null,  0, Infinity, NaN, -Infinity ] );\n\ts2 = new Set( [ undefined, null, false, 0, NaN, Infinity, -Infinity ] );\n\tassert.equal( QUnit.equiv( s1, s2 ), true, \"Multiple-element sets of tricky values\" );\n\n\t// Sets Containing objects\n\to1 = { foo: 0, bar: true };\n\to2 = { foo: 0, bar: true };\n\to3 = { foo: 1, bar: true };\n\to4 = { foo: 1, bar: true };\n\ts1 = new Set( [ o1, o3 ] );\n\ts2 = new Set( [ o1, o3 ] );\n\tassert.equal( QUnit.equiv( s1, s2 ), true, \"Sets containing same objects\" );\n\ts1 = new Set( [ o1 ] );\n\ts2 = new Set( [ o2 ] );\n\tassert.equal( QUnit.equiv( s1, s2 ), true, \"Sets containing deeply-equal objects\" );\n\ts1 = new Set( [ o1, o3 ] );\n\ts2 = new Set( [ o4, o2 ] );\n\tassert.equal( QUnit.equiv( s1, s2 ), true, \"Sets containing deeply-equal objects in different insertion order\" );\n\ts1 = new Set( [ o1 ] );\n\ts2 = new Set( [ o3 ] );\n\tassert.equal( QUnit.equiv( s1, s2 ), false, \"Sets containing different objects\" );\n\n\t// Sets containing sets\n\ts1 = new Set( [ 1, 2, 3 ] );\n\ts2 = new Set( [ 1, 2, 3 ] );\n\ts3 = new Set( [ s1 ] );\n\ts4 = new Set( [ s2 ] );\n\tassert.equal( QUnit.equiv( s3, s4 ), true, \"Sets containing deeply-equal sets\" );\n\n\t// Sets containing different sets\n\ts1 = new Set( [ 1, 2, 3 ] );\n\ts2 = new Set( [ 1, 2, 3, 4 ] );\n\ts3 = new Set( [ s1 ] );\n\ts4 = new Set( [ s2 ] );\n\tassert.equal( QUnit.equiv( s3, s4 ), false, \"Sets containing different sets\" );\n\n\t// Sets containing maps\n\tm1 = new Map( [ [ 1, 1 ] ] );\n\tm2 = new Map( [ [ 1, 1 ] ] );\n\tm3 = new Map( [ [ 1, 3 ] ] );\n\ts3 = new Set( [ m1 ] );\n\ts4 = new Set( [ m2 ] );\n\tassert.equal( QUnit.equiv( s3, s4 ), true, \"Sets containing different but deeply-equal maps\" );\n\ts3 = new Set( [ m1 ] );\n\ts4 = new Set( [ m3 ] );\n\tassert.equal( QUnit.equiv( s3, s4 ), false, \"Sets containing different maps\" );\n\n\t// Sets with different insertion order\n\ts1 = new Set( [ 1, 2, 3 ] );\n\ts2 = new Set( [ 3, 2, 1 ] );\n\tassert.equal( QUnit.equiv( s1, s2 ), true, \"Sets with different insertion orders\" );\n} );\n\nQUnit[ hasES6Map ? \"test\" : \"skip\" ]( \"Maps\", function( assert ) {\n\tvar m1, m2, m3, m4, o1, o2, o3, o4, s1, s2, s3;\n\n\t// Empty maps\n\tm1 = new Map();\n\tm2 = new Map( [] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Empty maps\" );\n\n\t// Simple cases\n\tm1 = new Map( [ [ 1, 1 ] ] );\n\tm2 = new Map( [ [ 1, 1 ] ] );\n\tm3 = new Map( [ [ 1, 3 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Single element maps [1,1] vs [1,1]\" );\n\tassert.equal( QUnit.equiv( m1, m3 ), false, \"Single element maps [1,1] vs [1,3]\" );\n\n\t// Tricky values\n\tm1 =  new Map( [\n\t\t[ false, false ],\n\t\t[ null, null ],\n\t\t[ 0, 0 ],\n\t\t[ undefined, undefined ],\n\t\t[ Infinity, Infinity ],\n\t\t[ NaN, NaN ],\n\t\t[ -Infinity, -Infinity ]\n\t] );\n\tm2 = new Map( [\n\t\t[ undefined, undefined ],\n\t\t[ null, null ],\n\t\t[ false, false ],\n\t\t[ 0, 0 ],\n\t\t[ NaN, NaN ],\n\t\t[ Infinity, Infinity ],\n\t\t[ -Infinity, -Infinity ]\n\t] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Multiple-element maps of tricky values\" );\n\n\t// Same keys, different values\n\tm1 = new Map( [\n\t\t[ 1, \"one\" ],\n\t\t[ 2, \"two\" ]\n\t] );\n\tm2 = new Map( [\n\t\t[ 1, 1 ],\n\t\t[ 2, 2 ]\n\t] );\n\tassert.equal( QUnit.equiv( m1, m2 ), false, \"Maps with same keys, different values\" );\n\n\t// Maps Containing objects\n\to1 = { foo: 0, bar: true };\n\to2 = { foo: 0, bar: true };\n\to3 = { foo: 1, bar: true };\n\to4 = { foo: 1, bar: true };\n\tm1 = new Map( [\n\t\t[ 1, o1 ],\n\t\t[ 2, o3 ]\n\t] );\n\tm2 = new Map( [\n\t\t[ 1, o1 ],\n\t\t[ 2, o3 ]\n\t] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Maps containing same objects\" );\n\tm1 = new Map( [ [ 1, o1 ] ] );\n\tm2 = new Map( [ [ 1, o2 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Maps containing different but deeply-equal objects\" );\n\tm1 = new Map( [ [ 1, o1 ], [ 2, o3 ] ] );\n\tm2 = new Map( [ [ 2, o4 ], [ 1, o2 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Maps containing different but deeply-equal objects in different insertion order\" );\n\tm1 = new Map( [ [ o1, 1 ] ] );\n\tm2 = new Map( [ [ o2, 1 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Maps containing different but deeply-equal objects as keys\" );\n\tm1 = new Map( [ [ o1, 1 ], [ o3, 2 ] ] );\n\tm2 = new Map( [ [ o4, 2 ], [ o2, 1 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Maps containing different but deeply-equal objects as keys in different insertion order\" );\n\n\t// Maps containing different objects\n\tm1 = new Map( [ [ 1, o1 ] ] );\n\tm2 = new Map( [ [ 1, o3 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), false, \"Maps containing different objects\" );\n\n\t// Maps containing maps\n\tm1 = new Map( [ [ 1, 1 ] ] );\n\tm2 = new Map( [ [ 1, 1 ] ] );\n\tm3 = new Map( [ [ \"myMap\", m1 ] ] );\n\tm4 = new Map( [ [ \"myMap\", m2 ] ] );\n\tassert.equal( QUnit.equiv( m3, m4 ), true, \"Maps containing deeply-equal maps\" );\n\n\t// Maps containing different maps\n\tm1 = new Map( [ [ 1, 1 ] ] );\n\tm2 = new Map( [ [ 1, 2 ] ] );\n\tm3 = new Map( [ [ \"myMap\", m1 ] ] );\n\tm4 = new Map( [ [ \"myMap\", m2 ] ] );\n\tassert.equal( QUnit.equiv( m3, m4 ), false, \"Maps containing different maps\" );\n\n\t// Maps containing sets\n\ts1 = new Set( [ 1, 2, 3 ] );\n\ts2 = new Set( [ 1, 2, 3 ] );\n\ts3 = new Set( [ 1, 2, 3, 4 ] );\n\tm1 = new Map( [ [ 1, s1 ] ] );\n\tm2 = new Map( [ [ 1, s2 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Maps containing different but deeply-equal sets\" );\n\n\t// Maps containing different sets\n\tm1 = new Map( [ [ 1, s1 ] ] );\n\tm2 = new Map( [ [ 1, s3 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), false, \"Maps containing different sets\" );\n} );\n\nQUnit.module( \"equiv Symbols\" );\n\nvar hasES6Symbol = ( function() {\n\treturn typeof Symbol === \"function\";\n}() );\n\nQUnit[ hasES6Symbol ? \"test\" : \"skip\" ]( \"regular checks\", function( assert ) {\n\tvar a = Symbol( 1 );\n\tvar b = Symbol( 1 );\n\n\tassert.equal( QUnit.equiv( a, a ), true, \"Same symbol is equivalent\" );\n\tassert.equal(\n\t\tQUnit.equiv( a, b ), false,\n\t\t\"Not equivalent to another similar symbol built on the same token\"\n\t);\n} );\n",
                "new_contents":"/* eslint array-bracket-spacing:off, comma-spacing:off, max-len:off */\n/* globals Set:false, Map:false, Symbol:false */\n\nQUnit.module( \"equiv\" );\n\nQUnit.test( \"Primitive types and constants\", function( assert ) {\n\tassert.equal( QUnit.equiv( null, null ), true, \"null\" );\n\tassert.equal( QUnit.equiv( null, {} ), false, \"null\" );\n\tassert.equal( QUnit.equiv( null, undefined ), false, \"null\" );\n\tassert.equal( QUnit.equiv( null, 0 ), false, \"null\" );\n\tassert.equal( QUnit.equiv( null, false ), false, \"null\" );\n\tassert.equal( QUnit.equiv( null, \"\" ), false, \"null\" );\n\tassert.equal( QUnit.equiv( null, [] ), false, \"null\" );\n\n\tassert.equal( QUnit.equiv( undefined, undefined ), true, \"undefined\" );\n\tassert.equal( QUnit.equiv( undefined, null ), false, \"undefined\" );\n\tassert.equal( QUnit.equiv( undefined, 0 ), false, \"undefined\" );\n\tassert.equal( QUnit.equiv( undefined, false ), false, \"undefined\" );\n\tassert.equal( QUnit.equiv( undefined, {} ), false, \"undefined\" );\n\tassert.equal( QUnit.equiv( undefined, [] ), false, \"undefined\" );\n\tassert.equal( QUnit.equiv( undefined, \"\" ), false, \"undefined\" );\n\n\t// Nan usually doest not equal to Nan using the '==' operator.\n\t// Only isNaN() is able to do it.\n\tassert.equal( QUnit.equiv( 0 / 0, 0 / 0 ), true, \"NaN\" ); // NaN VS NaN\n\tassert.equal( QUnit.equiv( 1 / 0, 2 / 0 ), true, \"Infinity\" ); // Infinity VS Infinity\n\tassert.equal( QUnit.equiv( -1 / 0, 2 / 0 ), false, \"-Infinity, Infinity\" ); // -Infinity VS Infinity\n\tassert.equal( QUnit.equiv( -1 / 0, -2 / 0 ), true, \"-Infinity, -Infinity\" ); // -Infinity VS -Infinity\n\tassert.equal( QUnit.equiv( 0 / 0, 1 / 0 ), false, \"NaN, Infinity\" ); // Nan VS Infinity\n\tassert.equal( QUnit.equiv( 1 / 0, 0 / 0 ), false, \"NaN, Infinity\" ); // Nan VS Infinity\n\tassert.equal( QUnit.equiv( 0 / 0, null ), false, \"NaN\" );\n\tassert.equal( QUnit.equiv( 0 / 0, undefined ), false, \"NaN\" );\n\tassert.equal( QUnit.equiv( 0 / 0, 0 ), false, \"NaN\" );\n\tassert.equal( QUnit.equiv( 0 / 0, false ), false, \"NaN\" );\n\tassert.equal( QUnit.equiv( 0 / 0, function() {} ), false, \"NaN\" );\n\tassert.equal( QUnit.equiv( 1 / 0, null ), false, \"NaN, Infinity\" );\n\tassert.equal( QUnit.equiv( 1 / 0, undefined ), false, \"NaN, Infinity\" );\n\tassert.equal( QUnit.equiv( 1 / 0, 0 ), false, \"NaN, Infinity\" );\n\tassert.equal( QUnit.equiv( 1 / 0, 1 ), false, \"NaN, Infinity\" );\n\tassert.equal( QUnit.equiv( 1 / 0, false ), false, \"NaN, Infinity\" );\n\tassert.equal( QUnit.equiv( 1 / 0, true ), false, \"NaN, Infinity\" );\n\tassert.equal( QUnit.equiv( 1 / 0, function() {} ), false, \"NaN, Infinity\" );\n\n\tassert.equal( QUnit.equiv( 0, 0 ), true, \"number\" );\n\tassert.equal( QUnit.equiv( 0, 1 ), false, \"number\" );\n\tassert.equal( QUnit.equiv( 1, 0 ), false, \"number\" );\n\tassert.equal( QUnit.equiv( 1, 1 ), true, \"number\" );\n\tassert.equal( QUnit.equiv( 1.1, 1.1 ), true, \"number\" );\n\tassert.equal( QUnit.equiv( 0.0000005, 0.0000005 ), true, \"number\" );\n\tassert.equal( QUnit.equiv( 0, \"\" ), false, \"number\" );\n\tassert.equal( QUnit.equiv( 0, \"0\" ), false, \"number\" );\n\tassert.equal( QUnit.equiv( 1, \"1\" ), false, \"number\" );\n\tassert.equal( QUnit.equiv( 0, false ), false, \"number\" );\n\tassert.equal( QUnit.equiv( 1, true ), false, \"number\" );\n\n\tassert.equal( QUnit.equiv( true, true ), true, \"boolean\" );\n\tassert.equal( QUnit.equiv( true, false ), false, \"boolean\" );\n\tassert.equal( QUnit.equiv( false, true ), false, \"boolean\" );\n\tassert.equal( QUnit.equiv( false, 0 ), false, \"boolean\" );\n\tassert.equal( QUnit.equiv( false, null ), false, \"boolean\" );\n\tassert.equal( QUnit.equiv( false, undefined ), false, \"boolean\" );\n\tassert.equal( QUnit.equiv( true, 1 ), false, \"boolean\" );\n\tassert.equal( QUnit.equiv( true, null ), false, \"boolean\" );\n\tassert.equal( QUnit.equiv( true, undefined ), false, \"boolean\" );\n\n\tassert.equal( QUnit.equiv( \"\", \"\" ), true, \"string\" );\n\tassert.equal( QUnit.equiv( \"a\", \"a\" ), true, \"string\" );\n\tassert.equal( QUnit.equiv( \"foobar\", \"foobar\" ), true, \"string\" );\n\tassert.equal( QUnit.equiv( \"foobar\", \"foo\" ), false, \"string\" );\n\tassert.equal( QUnit.equiv( \"\", 0 ), false, \"string\" );\n\tassert.equal( QUnit.equiv( \"\", false ), false, \"string\" );\n\tassert.equal( QUnit.equiv( \"\", null ), false, \"string\" );\n\tassert.equal( QUnit.equiv( \"\", undefined ), false, \"string\" );\n\n\t// Rename for lint validation.\n\t// We know this is bad, we are asserting whether we can coop with bad code like this.\n\tvar SafeNumber = Number,\n\t\tSafeString = String,\n\t\tSafeBoolean = Boolean,\n\t\tSafeObject = Object;\n\n\t// primitives vs. objects\n\n\tassert.equal( QUnit.equiv( 0, new SafeNumber() ), true, \"number 0 primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeNumber(), 0 ), true, \"number 0 object vs. primitive\" );\n\tassert.equal( QUnit.equiv( new SafeNumber(), new SafeNumber() ), true, \"empty number objects\" );\n\tassert.equal( QUnit.equiv( 1, new SafeNumber( 1 ) ), true, \"number 1 primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeNumber( 1 ), 1 ), true, \"number 1 object vs. primitive\" );\n\tassert.equal( QUnit.equiv( new SafeNumber( 1 ), new SafeNumber( 1 ) ), true, \"number 1 objects\" );\n\tassert.equal( QUnit.equiv( 0, new SafeNumber( 1 ) ), false, \"differing number primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeNumber( 0 ), 1 ), false, \"differing number object vs. primitive\" );\n\n\tassert.equal( QUnit.equiv( \"\", new SafeString() ), true, \"empty string primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeString(), \"\" ), true, \"empty string object vs. primitive\" );\n\tassert.equal( QUnit.equiv( new SafeString(), new SafeString() ), true, \"empty string objects\" );\n\tassert.equal( QUnit.equiv( \"My String\", new SafeString( \"My String\" ) ), true, \"nonempty string primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeString( \"My String\" ), \"My String\" ), true, \"nonempty string object vs. primitive\" );\n\tassert.equal( QUnit.equiv( new SafeString( \"My String\" ), new SafeString( \"My String\" ) ), true, \"nonempty string objects\" );\n\tassert.equal( QUnit.equiv( \"Bad String\", new SafeString( \"My String\" ) ), false, \"differing string primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeString( \"Bad String\" ), \"My String\" ), false, \"differing string object vs. primitive\" );\n\n\tassert.equal( QUnit.equiv( false, new SafeBoolean() ), true, \"boolean false primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeBoolean(), false ), true, \"boolean empty object vs. primitive\" );\n\tassert.equal( QUnit.equiv( new SafeBoolean(), new SafeBoolean() ), true, \"empty boolean objects\" );\n\tassert.equal( QUnit.equiv( true, new SafeBoolean( true ) ), true, \"boolean true primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeBoolean( true ), true ), true, \"boolean true object vs. primitive\" );\n\tassert.equal( QUnit.equiv( new SafeBoolean( true ), new SafeBoolean( true ) ), true, \"boolean true objects\" );\n\tassert.equal( QUnit.equiv( true, new SafeBoolean( 1 ) ), true, \"boolean true primitive vs. truthy object\" );\n\tassert.equal( QUnit.equiv( false, new SafeBoolean( false ) ), true, \"boolean false primitive vs. false object\" );\n\tassert.equal( QUnit.equiv( new SafeBoolean( false ), false ), true, \"boolean false object vs. primitive\" );\n\tassert.equal( QUnit.equiv( new SafeBoolean( false ), new SafeBoolean( false ) ), true, \"boolean false objects\" );\n\tassert.equal( QUnit.equiv( false, new SafeBoolean( 0 ) ), true, \"boolean false primitive vs. 0 object\" );\n\tassert.equal( QUnit.equiv( true, new SafeBoolean( false ) ), false, \"differing boolean primitive vs. object\" );\n\tassert.equal( QUnit.equiv( new SafeBoolean( false ), true ), false, \"differing boolean object vs. primitive\" );\n\n\tassert.equal( QUnit.equiv( new SafeObject(), {} ), true, \"empty object instantiation vs. literal\" );\n\tassert.equal( QUnit.equiv( {}, new SafeObject() ), true, \"empty object literal vs. instantiation\" );\n\tassert.equal( QUnit.equiv( new SafeObject(), { a: 1 } ), false, \"empty object instantiation vs. nonempty literal\" );\n\tassert.equal( QUnit.equiv( { a: 1 }, new SafeObject() ), false, \"nonempty object literal vs. empty instantiation\" );\n\tassert.equal( QUnit.equiv( { a: undefined }, new SafeObject() ), false, \"other nonempty object literal vs. empty instantiation\" );\n\tassert.equal( QUnit.equiv( new SafeObject(), { a: undefined } ), false, \"empty object instantiation vs. other nonempty literal\" );\n} );\n\nQUnit.test( \"Objects basics\", function( assert ) {\n\tassert.equal( QUnit.equiv( {}, {} ), true );\n\tassert.equal( QUnit.equiv( {}, null ), false );\n\tassert.equal( QUnit.equiv( {}, undefined ), false );\n\tassert.equal( QUnit.equiv( {}, 0 ), false );\n\tassert.equal( QUnit.equiv( {}, false ), false );\n\n\t// This test is a hard one, it is very important\n\t// REASONS:\n\t//\t\t1) They are of the same type \"object\"\n\t//\t\t2) [] instanceof Object is true\n\t//\t\t3) Their properties are the same (doesn't exists)\n\tassert.equal( QUnit.equiv( {}, [] ), false );\n\n\tassert.equal( QUnit.equiv( { a: 1 }, { a: 1 } ), true );\n\tassert.equal( QUnit.equiv( { a: 1 }, { a: \"1\" } ), false );\n\tassert.equal( QUnit.equiv( { a: [] }, { a: [] } ), true );\n\tassert.equal( QUnit.equiv( { a: {} }, { a: null } ), false );\n\tassert.equal( QUnit.equiv( { a: 1 }, {} ), false );\n\tassert.equal( QUnit.equiv( {}, { a: 1 } ), false );\n\n\t// Hard ones\n\tassert.equal( QUnit.equiv( { a: undefined }, {} ), false );\n\tassert.equal( QUnit.equiv( {}, { a: undefined } ), false );\n\tassert.equal( QUnit.equiv(\n\t\t{\n\t\t\ta: [ { bar: undefined } ]\n\t\t},\n\t\t{\n\t\t\ta: [ { bat: undefined } ]\n\t\t}\n\t), false );\n\n} );\n\nQUnit[ typeof Object.create === \"function\" ? \"test\" : \"skip\" ](\n\t\"Objects with null prototypes\", function( assert ) {\n\n\t\tvar nonEmptyWithNoProto;\n\n\t\t// Objects with no prototype, created via Object.create(null), are used\n\t\t// e.g. as dictionaries.\n\t\t// Being able to test equivalence against object literals is quite useful.\n\t\tassert.equal(\n\t\t\tQUnit.equiv( Object.create( null ), {} ),\n\t\t\ttrue,\n\t\t\t\"empty object without prototype VS empty object\"\n\t\t);\n\n\t\tassert.equal(\n\t\t\tQUnit.equiv( {}, Object.create( null ) ),\n\t\t\ttrue,\n\t\t\t\"empty object VS empty object without prototype\"\n\t\t);\n\n\t\tnonEmptyWithNoProto = Object.create( null );\n\t\tnonEmptyWithNoProto.foo = \"bar\";\n\n\t\tassert.equal(\n\t\t\tQUnit.equiv( nonEmptyWithNoProto, { foo: \"bar\" } ),\n\t\t\ttrue,\n\t\t\t\"object without prototype VS object\"\n\t\t);\n\n\t\tassert.equal(\n\t\t\tQUnit.equiv( { foo: \"bar\" }, nonEmptyWithNoProto ),\n\t\t\ttrue,\n\t\t\t\"object VS object without prototype\"\n\t\t);\n\t} );\n\n// Ref #851\nQUnit[ typeof Object.create === \"function\" ? \"test\" : \"skip\" ](\n\t\"Object prototype constructor is null\", function( assert ) {\n\n\t\t// Ref #851\n\t\t// Unfortunately, in practice `Object.create(null)` is fairly costly.\n\t\t// To mitigate this cost a specialized NullObject can be used. This\n\t\t// Object has similar safe characteristics, but with dramatically\n\t\t// reduced allocation costs.\n\t\tfunction NullObject() {}\n\t\tNullObject.prototype = Object.create( null, {\n\t\t\tconstructor: {\n\t\t\t\tvalue: null\n\t\t\t}\n\t\t} );\n\n\t\tvar a = new NullObject();\n\t\ta.foo = 1;\n\t\tvar b = { foo: 1 };\n\n\t\tassert.ok( QUnit.equiv( a, b ) );\n\t\tassert.ok( QUnit.equiv( b, a ) );\n\t} );\n\nQUnit.test( \"Arrays basics\", function( assert ) {\n\n\tassert.equal( QUnit.equiv( [], [] ), true );\n\n\t// May be a hard one, can invoke a crash at execution.\n\t// because their types are both \"object\" but null isn't\n\t// like a true object, it doesn't have any property at all.\n\tassert.equal( QUnit.equiv( [], null ), false );\n\n\tassert.equal( QUnit.equiv( [], undefined ), false );\n\tassert.equal( QUnit.equiv( [], false ), false );\n\tassert.equal( QUnit.equiv( [], 0 ), false );\n\tassert.equal( QUnit.equiv( [], \"\" ), false );\n\n\t// May be a hard one, but less hard\n\t// than {} with [] (note the order)\n\tassert.equal( QUnit.equiv( [], {} ), false );\n\n\tassert.equal( QUnit.equiv( [ null ], [] ), false );\n\tassert.equal( QUnit.equiv( [ undefined ], [] ), false );\n\tassert.equal( QUnit.equiv( [], [ null ] ), false );\n\tassert.equal( QUnit.equiv( [], [ undefined ] ), false );\n\tassert.equal( QUnit.equiv( [ null ], [ undefined ] ), false );\n\tassert.equal( QUnit.equiv( [ [] ], [ [] ] ), true );\n\tassert.equal( QUnit.equiv( [ [], [], [] ], [ [], [], [] ] ), true );\n\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[[],[],[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]],\n\t\t\t[[],[],[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]] ),\n\t\ttrue\n\t);\n\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[[],[],[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]],\n\t\t\t[[],[],[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]] ), // shorter\n\t\tfalse\n\t);\n\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[[],[],[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[ {} ]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]],\n\t\t\t[[],[],[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]] ), // deepest element not an array\n\t\tfalse\n\t);\n\n\t// same multidimensional\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[ 1,2,3,4,5,6,7,8,9, [\n\t\t\t\t1,2,3,4,5,6,7,8,9, [\n\t\t\t\t\t1,2,3,4,5,[\n\t\t\t\t\t\t[ 6,7,8,9, [\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t2,3,4,[\n\t\t\t\t\t\t\t\t\t\t1,2,[\n\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,5,6,7,8,9,[\n\t\t\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t\t\t],1,2,3,4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t],4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t],5,6,7\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t]\n\t\t\t\t]]],\n\t\t\t[ 1,2,3,4,5,6,7,8,9, [\n\t\t\t\t1,2,3,4,5,6,7,8,9, [\n\t\t\t\t\t1,2,3,4,5,[\n\t\t\t\t\t\t[ 6,7,8,9, [\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t2,3,4,[\n\t\t\t\t\t\t\t\t\t\t1,2,[\n\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,5,6,7,8,9,[\n\t\t\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t\t\t],1,2,3,4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t],4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t],5,6,7\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t]\n\t\t\t\t]]]\n\t\t),\n\t\ttrue,\n\t\t\"Multidimensional\"\n\t);\n\n\t// different multidimensional\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[ 1,2,3,4,5,6,7,8,9, [\n\t\t\t\t1,2,3,4,5,6,7,8,9, [\n\t\t\t\t\t1,2,3,4,5,[\n\t\t\t\t\t\t[ 6,7,8,9, [\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t2,3,4,[\n\t\t\t\t\t\t\t\t\t\t1,2,[\n\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,5,6,7,8,9,[\n\t\t\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t\t\t],1,2,3,4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t],4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t],5,6,7\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t]\n\t\t\t\t]]],\n\t\t\t[ 1,2,3,4,5,6,7,8,9, [\n\t\t\t\t1,2,3,4,5,6,7,8,9, [\n\t\t\t\t\t1,2,3,4,5,[\n\t\t\t\t\t\t[ 6,7,8,9, [\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t2,3,4,[\n\t\t\t\t\t\t\t\t\t\t1,2,[\n\t\t\t\t\t\t\t\t\t\t\t\"1\",2,3,4,[\t\t\t\t\t// string instead of number\n\t\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,5,6,7,8,9,[\n\t\t\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t\t\t],1,2,3,4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t],4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t],5,6,7\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t]\n\t\t\t\t]]]\n\t\t),\n\t\tfalse,\n\t\t\"Multidimensional\"\n\t);\n\n\t// different multidimensional\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[ 1,2,3,4,5,6,7,8,9, [\n\t\t\t\t1,2,3,4,5,6,7,8,9, [\n\t\t\t\t\t1,2,3,4,5,[\n\t\t\t\t\t\t[ 6,7,8,9, [\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t2,3,4,[\n\t\t\t\t\t\t\t\t\t\t1,2,[\n\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,5,6,7,8,9,[\n\t\t\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t\t\t],1,2,3,4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t],4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t],5,6,7\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t]\n\t\t\t\t]]],\n\t\t\t[ 1,2,3,4,5,6,7,8,9, [\n\t\t\t\t1,2,3,4,5,6,7,8,9, [\n\t\t\t\t\t1,2,3,4,5,[\n\t\t\t\t\t\t[ 6,7,8,9, [\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t2,3,[\t\t\t\t\t// missing an element (4)\n\t\t\t\t\t\t\t\t\t\t1,2,[\n\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,[\n\t\t\t\t\t\t\t\t\t\t\t\t1,2,3,4,5,6,7,8,9,[\n\t\t\t\t\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t\t\t],1,2,3,4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t\t\t],4,5,6,7,8,9\n\t\t\t\t\t\t\t\t\t],5,6,7,8,9\n\t\t\t\t\t\t\t\t],5,6,7\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t\t]\n\t\t\t\t\t]\n\t\t\t\t]]]\n\t\t),\n\t\tfalse,\n\t\t\"Multidimensional\"\n\t);\n} );\n\nQUnit.test( \"Functions\", function( assert ) {\n\tvar f0 = function() {},\n\t\tf1 = function() {},\n\n\t\t// f2 and f3 have the same code, formatted differently\n\t\tf2 = function() { return 0; },\n\t\tf3 = function() {\n\n\t\t\t// eslint-disable-next-line semi\n\t\t\treturn 0 // this comment and no semicoma as difference\n\t\t};\n\n\tassert.equal( QUnit.equiv( function() {}, function() {} ), false, \"Anonymous functions\" ); // exact source code\n\tassert.equal( QUnit.equiv( function() {}, function() {\n\t\treturn true;\n\t} ), false, \"Anonymous functions\" );\n\n\tassert.equal( QUnit.equiv( f0, f0 ), true, \"Function references\" ); // same references\n\tassert.equal( QUnit.equiv( f0, f1 ), false, \"Function references\" ); // exact source code, different references\n\tassert.equal( QUnit.equiv( f2, f3 ), false, \"Function references\" ); // equivalent source code, different references\n\tassert.equal( QUnit.equiv( f1, f2 ), false, \"Function references\" ); // different source code, different references\n\tassert.equal( QUnit.equiv( function() {}, true ), false );\n\tassert.equal( QUnit.equiv( function() {}, undefined ), false );\n\tassert.equal( QUnit.equiv( function() {}, null ), false );\n\tassert.equal( QUnit.equiv( function() {}, {} ), false );\n} );\n\nQUnit.test( \"Date instances\", function( assert ) {\n\n\t// Date, we don't need to test Date.parse() because it returns a number.\n\t// Only test the Date instances by setting them a fix date.\n\t// The date use is midnight January 1, 1970\n\tvar d1, d2, d3;\n\n\td1 = new Date();\n\td1.setTime( 0 ); // fix the date\n\n\td2 = new Date();\n\td2.setTime( 0 ); // fix the date\n\n\td3 = new Date(); // The very now\n\n\t// Anyway their types differs, just in case the code fails in the order in which it deals with date\n\tassert.equal( QUnit.equiv( d1, 0 ), false ); // d1.valueOf() returns 0, but d1 and 0 are different\n\n\t// test same values date and different instances equality\n\tassert.equal( QUnit.equiv( d1, d2 ), true );\n\n\t// test different date and different instances difference\n\tassert.equal( QUnit.equiv( d1, d3 ), false );\n} );\n\nQUnit.test( \"RegExp\", function( assert ) {\n\n\t// Must test cases that imply those traps:\n\t// var a = /./;\n\t// a instanceof Object;\t\t   // Oops\n\t// a instanceof RegExp;\t\t   // Oops\n\t// typeof a === \"function\";    // Oops, false in IE and Opera, true in FF and Safari (\"object\")\n\n\t// Tests same regex with same modifiers in different order\n\tvar regex1, regex2, regex3, r3a, r3b, ru1, ru2,\n\t\tr1 = /foo/,\n\t\tr2 = /foo/gim,\n\t\tr3 = /foo/gmi,\n\t\tr4 = /foo/igm,\n\t\tr5 = /foo/img,\n\t\tr6 = /foo/mig,\n\t\tr7 = /foo/mgi,\n\t\tri1 = /foo/i,\n\t\tri2 = /foo/i,\n\t\trm1 = /foo/m,\n\t\trm2 = /foo/m,\n\t\trg1 = /foo/g,\n\t\trg2 = /foo/g;\n\n\tassert.equal( QUnit.equiv( r2, r3 ), true, \"Modifier order\" );\n\tassert.equal( QUnit.equiv( r2, r4 ), true, \"Modifier order\" );\n\tassert.equal( QUnit.equiv( r2, r5 ), true, \"Modifier order\" );\n\tassert.equal( QUnit.equiv( r2, r6 ), true, \"Modifier order\" );\n\tassert.equal( QUnit.equiv( r2, r7 ), true, \"Modifier order\" );\n\tassert.equal( QUnit.equiv( r1, r2 ), false, \"Modifier\" );\n\n\tassert.equal( QUnit.equiv( ri1, ri2 ), true, \"Modifier\" );\n\tassert.equal( QUnit.equiv( r1, ri1 ), false, \"Modifier\" );\n\tassert.equal( QUnit.equiv( ri1, rm1 ), false, \"Modifier\" );\n\tassert.equal( QUnit.equiv( r1, rm1 ), false, \"Modifier\" );\n\tassert.equal( QUnit.equiv( rm1, ri1 ), false, \"Modifier\" );\n\tassert.equal( QUnit.equiv( rm1, rm2 ), true, \"Modifier\" );\n\tassert.equal( QUnit.equiv( rg1, rm1 ), false, \"Modifier\" );\n\tassert.equal( QUnit.equiv( rm1, rg1 ), false, \"Modifier\" );\n\tassert.equal( QUnit.equiv( rg1, rg2 ), true, \"Modifier\" );\n\n\t// Compare unicode modifier\n\ttry {\n\t\tr2 = new RegExp( \"foo\", \"umig\" );\n\t\tr3 = new RegExp( \"foo\", \"mgiu\" );\n\t\tassert.equal( QUnit.equiv( r2, r3 ), true, \"Modifier order\" );\n\t\tassert.equal( QUnit.equiv( r1, r2 ), false, \"Modifier\" );\n\n\t\tru1 = new RegExp( \"/u{1D306}\", \"u\" );\n\t\tru2 = new RegExp( \"/u{1D306}\", \"u\" );\n\t\tassert.equal( QUnit.equiv( ru1, rg1 ), false, \"Modifier\" );\n\t\tassert.equal( QUnit.equiv( rg1, ru1 ), false, \"Modifier\" );\n\t\tassert.equal( QUnit.equiv( ru1, ru2 ), true, \"Modifier\" );\n\t} catch ( e ) {}\n\n\t// Different regex, same modifiers\n\tr1 = /[a-z]/gi;\n\tr2 = /[0-9]/gi; // oops! different\n\tassert.equal( QUnit.equiv( r1, r2 ), false, \"Regex pattern\" );\n\n\tr1 = /0/ig;\n\tr2 = /\"0\"/ig; // oops! different\n\tassert.equal( QUnit.equiv( r1, r2 ), false, \"Regex pattern\" );\n\n\tr1 = /[\\n\\r\\]/g;\n\tr2 = /[\\n\\r\\]/g;\n\tr3 = /[\\n\\r\\]/g; // differs from r1\n\tr4 = /[\\n\\r\\]/; // differs from r1\n\n\tassert.equal( QUnit.equiv( r1, r2 ), true, \"Regex pattern\" );\n\tassert.equal( QUnit.equiv( r1, r3 ), false, \"Regex pattern\" );\n\tassert.equal( QUnit.equiv( r1, r4 ), false, \"Regex pattern\" );\n\n\t// More complex regex\n\tregex1 = \"^[-_.a-z0-9]+@([-_a-z0-9]+\\\\.)+([A-Za-z][A-Za-z]|[A-Za-z][A-Za-z][A-Za-z])|(([0-9][0-9]?|[0-1][0-9][0-9]|[2][0-4][0-9]|[2][5][0-5]))$\";\n\tregex2 = \"^[-_.a-z0-9]+@([-_a-z0-9]+\\\\.)+([A-Za-z][A-Za-z]|[A-Za-z][A-Za-z][A-Za-z])|(([0-9][0-9]?|[0-1][0-9][0-9]|[2][0-4][0-9]|[2][5][0-5]))$\";\n\n\t// regex 3 is different: '.' not escaped\n\tregex3 = \"^[-_.a-z0-9]+@([-_a-z0-9]+.)+([A-Za-z][A-Za-z]|[A-Za-z][A-Za-z][A-Za-z])|(([0-9][0-9]?|[0-1][0-9][0-9]|[2][0-4][0-9]|[2][5][0-5]))$\";\n\n\tr1 = new RegExp( regex1 );\n\tr2 = new RegExp( regex2 );\n\tr3 = new RegExp( regex3 ); // diff from r21, not same pattern\n\tr3a = new RegExp( regex3, \"gi\" ); // diff from r23, not same modifier\n\tr3b = new RegExp( regex3, \"ig\" ); // same as r23a\n\n\tassert.equal( QUnit.equiv( r1, r2 ), true, \"Complex Regex\" );\n\tassert.equal( QUnit.equiv( r1, r3 ), false, \"Complex Regex\" );\n\tassert.equal( QUnit.equiv( r3, r3a ), false, \"Complex Regex\" );\n\tassert.equal( QUnit.equiv( r3a, r3b ), true, \"Complex Regex\" );\n\n\t// typeof r1 is \"function\" in some browsers and \"object\" in others so we must cover this test\n\tr1 = / /;\n\tassert.equal( QUnit.equiv( r1, function() {} ), false, \"Regex internal\" );\n\tassert.equal( QUnit.equiv( r1, {} ), false, \"Regex internal\" );\n} );\n\nQUnit.test( \"Complex objects\", function( assert ) {\n\n\tfunction fn1() {\n\t\treturn \"fn1\";\n\t}\n\tfunction fn2() {\n\t\treturn \"fn2\";\n\t}\n\n\t// Try to invert the order of some properties to make sure it is covered.\n\t// It can failed when properties are compared between unsorted arrays.\n\tassert.equal( QUnit.equiv(\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\ta: 3.14159,\n\t\t\t\tb: false,\n\t\t\t\tc: {\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\tr: \"r\",\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\t\t\t\t\t\t\t\t\tt: undefined,\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\",\n\t\t\t\t\t\t\t\t\t\t\t\tz: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tq: [],\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\to: 99\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\td: 0,\n\t\t\t\t\ti: true,\n\t\t\t\t\th: \"false\"\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tg: \"\",\n\t\t\th: \"h\",\n\t\t\tf: {},\n\t\t\ti: []\n\t\t},\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\tb: false,\n\t\t\t\ta: 3.14159,\n\t\t\t\tc: {\n\t\t\t\t\td: 0,\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\tr: \"r\",\n\t\t\t\t\t\t\t\t\tt: undefined,\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\tz: null,\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\"\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\to: 99,\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\tq: []\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\ti: true,\n\t\t\t\t\th: \"false\"\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tg: \"\",\n\t\t\tf: {},\n\t\t\th: \"h\",\n\t\t\ti: []\n\t\t}\n\t), true );\n\n\tassert.equal( QUnit.equiv(\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\ta: 3.14159,\n\t\t\t\tb: false,\n\t\t\t\tc: {\n\t\t\t\t\td: 0,\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\n\t\t\t\t\t\t\t\t\t//r: \"r\",\t// different: missing a property\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\t\t\t\t\t\t\t\t\tt: undefined,\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\",\n\t\t\t\t\t\t\t\t\t\t\t\tz: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\to: 99,\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\tq: []\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\th: \"false\",\n\t\t\t\t\ti: true\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tf: {},\n\t\t\tg: \"\",\n\t\t\th: \"h\",\n\t\t\ti: []\n\t\t},\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\ta: 3.14159,\n\t\t\t\tb: false,\n\t\t\t\tc: {\n\t\t\t\t\td: 0,\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\tr: \"r\",\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\t\t\t\t\t\t\t\t\tt: undefined,\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\",\n\t\t\t\t\t\t\t\t\t\t\t\tz: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\to: 99,\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\tq: []\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\th: \"false\",\n\t\t\t\t\ti: true\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tf: {},\n\t\t\tg: \"\",\n\t\t\th: \"h\",\n\t\t\ti: []\n\t\t}\n\t), false );\n\n\tassert.equal( QUnit.equiv(\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\ta: 3.14159,\n\t\t\t\tb: false,\n\t\t\t\tc: {\n\t\t\t\t\td: 0,\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\tr: \"r\",\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\t\t\t\t\t\t\t\t\tt: undefined,\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\",\n\t\t\t\t\t\t\t\t\t\t\t\tz: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\to: 99,\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\tq: []\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\th: \"false\",\n\t\t\t\t\ti: true\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tf: {},\n\t\t\tg: \"\",\n\t\t\th: \"h\",\n\t\t\ti: []\n\t\t},\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\ta: 3.14159,\n\t\t\t\tb: false,\n\t\t\t\tc: {\n\t\t\t\t\td: 0,\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\tr: \"r\",\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\n\t\t\t\t\t\t\t\t\t//t: undefined,\t\t\t\t\t// different: missing a property with an undefined value\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\",\n\t\t\t\t\t\t\t\t\t\t\t\tz: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\to: 99,\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\tq: []\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\th: \"false\",\n\t\t\t\t\ti: true\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tf: {},\n\t\t\tg: \"\",\n\t\t\th: \"h\",\n\t\t\ti: []\n\t\t}\n\t), false );\n\n\tassert.equal( QUnit.equiv(\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\ta: 3.14159,\n\t\t\t\tb: false,\n\t\t\t\tc: {\n\t\t\t\t\td: 0,\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\tr: \"r\",\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\t\t\t\t\t\t\t\t\tt: undefined,\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\",\n\t\t\t\t\t\t\t\t\t\t\t\tz: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\to: 99,\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\tq: []\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\th: \"false\",\n\t\t\t\t\ti: true\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tf: {},\n\t\t\tg: \"\",\n\t\t\th: \"h\",\n\t\t\ti: []\n\t\t},\n\t\t{\n\t\t\ta: 1,\n\t\t\tb: null,\n\t\t\tc: [ {} ],\n\t\t\td: {\n\t\t\t\ta: 3.14159,\n\t\t\t\tb: false,\n\t\t\t\tc: {\n\t\t\t\t\td: 0,\n\t\t\t\t\te: fn1,\n\t\t\t\t\tf: [[[]]],\n\t\t\t\t\tg: {\n\t\t\t\t\t\tj: {\n\t\t\t\t\t\t\tk: {\n\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\tr: \"r\",\n\t\t\t\t\t\t\t\t\ts: [ 1, 2, 3 ],\n\t\t\t\t\t\t\t\t\tt: undefined,\n\t\t\t\t\t\t\t\t\tu: 0,\n\t\t\t\t\t\t\t\t\tv: {\n\t\t\t\t\t\t\t\t\t\tw: {\n\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\ty: \"Yahoo!\",\n\t\t\t\t\t\t\t\t\t\t\t\tz: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\to: 99,\n\t\t\t\t\t\t\t\tp: 1 / 0,\n\t\t\t\t\t\t\t\tq: {}\t\t\t// different was []\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tl: undefined,\n\t\t\t\t\t\t\tm: null\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\th: \"false\",\n\t\t\t\t\ti: true\n\t\t\t\t}\n\t\t\t},\n\t\t\te: undefined,\n\t\t\tf: {},\n\t\t\tg: \"\",\n\t\t\th: \"h\",\n\t\t\ti: []\n\t\t}\n\t), false );\n\n\tvar same1 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1, 2, null, {}, [], [ 1, 2, 3 ] ],\n\t\t\t\t\tbar: undefined\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±Ï‚\"\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn1\n\t\t},\n\n\t\tsame2 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1, 2, null, {}, [], [ 1, 2, 3 ] ],\n\t\t\t\t\tbar: undefined\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±Ï‚\"\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn1\n\t\t},\n\n\t\tdiff1 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1, 2, null, {}, [], [ 1, 2, 3, 4 ] ], // different: 4 was add to the array\n\t\t\t\t\tbar: undefined\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±Ï‚\"\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn1\n\t\t},\n\n\t\tdiff2 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1, 2, null, {}, [], [ 1, 2, 3 ] ],\n\t\t\t\t\tnewprop: undefined, // different: newprop was added\n\t\t\t\t\tbar: undefined\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±Ï‚\"\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn1\n\t\t},\n\n\t\tdiff3 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1, 2, null, {}, [], [ 1, 2, 3 ] ],\n\t\t\t\t\tbar: undefined\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±\" // different: missing last char\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn1\n\t\t},\n\n\t\tdiff4 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1,2,undefined,{}, [], [ 1, 2, 3 ] ], // different: undefined instead of null\n\t\t\t\t\tbar: undefined\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±Ï‚\"\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn1\n\t\t},\n\n\t\tdiff5 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1, 2, null, {}, [], [ 1, 2, 3 ] ],\n\t\t\t\t\tbat: undefined // different: property name not \"bar\"\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±Ï‚\"\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn1\n\t\t},\n\n\t\tdiff6 = {\n\t\t\ta: [\n\t\t\t\t\"string\", null, 0, \"1\", 1, {\n\t\t\t\t\tprop: null,\n\t\t\t\t\tfoo: [ 1, 2, null, {}, [], [ 1, 2, 3 ] ],\n\t\t\t\t\tbar: undefined\n\t\t\t\t}, 3, \"Hey!\", \"ÎšÎ¬Î½Îµ Ï€Î¬Î½Ï„Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î±Ï‚ Ï„Ï‰Î½, Î¼Î·Ï‡Î±Î½Î®Ï‚ ÎµÏ€Î¹Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ ÎµÏ€Î¹Î´Î¹Î¿ÏÎ¸ÏŽÏƒÎµÎ¹Ï‚ ÏŽÏ‚ Î¼Î¹Î±. ÎšÎ»Ï€ Î±Ï‚\"\n\t\t\t],\n\t\t\tunicode: \"è€ æ±‰è¯ä¸å˜åœ¨ æ¸¯æ¾³å’Œæµ·å¤–çš„åŽäººåœˆä¸ è´µå·ž æˆ‘åŽ»äº†ä¹¦åº— çŽ°åœ¨å°šæœ‰äº‰\",\n\t\t\tb: \"b\",\n\t\t\tc: fn2 // different: fn2 instead of fn1\n\t\t};\n\n\tassert.equal( QUnit.equiv( same1, same2 ), true );\n\tassert.equal( QUnit.equiv( same2, same1 ), true );\n\tassert.equal( QUnit.equiv( same2, diff1 ), false );\n\tassert.equal( QUnit.equiv( diff1, same2 ), false );\n\n\tassert.equal( QUnit.equiv( same1, diff1 ), false );\n\tassert.equal( QUnit.equiv( same1, diff2 ), false );\n\tassert.equal( QUnit.equiv( same1, diff3 ), false );\n\tassert.equal( QUnit.equiv( same1, diff3 ), false );\n\tassert.equal( QUnit.equiv( same1, diff4 ), false );\n\tassert.equal( QUnit.equiv( same1, diff5 ), false );\n\tassert.equal( QUnit.equiv( same1, diff6 ), false );\n\tassert.equal( QUnit.equiv( diff5, diff1 ), false );\n} );\n\nQUnit.test( \"Complex Arrays\", function( assert ) {\n\n\tfunction fn() {}\n\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[ 1, 2, 3, true, {}, null, [\n\t\t\t\t{\n\t\t\t\t\ta: [ \"\", \"1\", 0 ]\n\t\t\t\t},\n\t\t\t\t5, 6, 7\n\t\t\t], \"foo\" ],\n\t\t\t[ 1, 2, 3, true, {}, null, [\n\t\t\t\t{\n\t\t\t\t\ta: [ \"\", \"1\", 0 ]\n\t\t\t\t},\n\t\t\t\t5, 6, 7\n\t\t\t], \"foo\" ]\n\t\t),\n\t\ttrue\n\t);\n\n\tassert.equal(\n\t\tQUnit.equiv(\n\t\t\t[ 1, 2, 3, true, {}, null, [\n\t\t\t\t{\n\t\t\t\t\ta: [ \"\", \"1\", 0 ]\n\t\t\t\t},\n\t\t\t\t5, 6, 7\n\t\t\t], \"foo\" ],\n\t\t\t[ 1, 2, 3, true, {}, null, [\n\t\t\t\t{\n\t\t\t\t\tb: [ \"\", \"1\", 0 ]\t\t  // not same property name\n\t\t\t\t},\n\t\t\t\t5, 6, 7\n\t\t\t], \"foo\" ]\n\t\t),\n\t\tfalse\n\t);\n\n\tvar a = [ {\n\t\tb: fn,\n\t\tc: false,\n\t\t\"do\": \"reserved word\",\n\t\t\"for\": {\n\t\t\tar: [ 3, 5, 9, \"hey!\", [], {\n\t\t\t\tar: [ 1,[\n\t\t\t\t\t3,4,6,9, null, [], []\n\t\t\t\t] ],\n\t\t\t\te: fn,\n\t\t\t\tf: undefined\n\t\t\t} ]\n\t\t},\n\t\te: 0.43445\n\t}, 5, \"string\", 0, fn, false, null, undefined, 0, [\n\t\t4,5,6,7,8,9,11,22,33,44,55,\"66\", null, [], [[[[[ 3 ]]]], \"3\" ], {}, 1 / 0\n\t], [], [ [ [], \"foo\", null, {\n\t\tn: 1 / 0,\n\t\tz: {\n\t\t\ta: [ 3, 4, 5, 6, \"yep!\", undefined, undefined ],\n\t\t\tb: {}\n\t\t}\n\t}, {} ] ] ];\n\n\tassert.equal( QUnit.equiv( a,\n\t\t[ {\n\t\t\tb: fn,\n\t\t\tc: false,\n\t\t\t\"do\": \"reserved word\",\n\t\t\t\"for\": {\n\t\t\t\tar: [ 3, 5, 9, \"hey!\", [], {\n\t\t\t\t\tar: [ 1, [\n\t\t\t\t\t\t3,4,6,9, null, [], []\n\t\t\t\t\t]],\n\t\t\t\t\te: fn,\n\t\t\t\t\tf: undefined\n\t\t\t\t} ]\n\t\t\t},\n\t\t\te: 0.43445\n\t\t}, 5, \"string\", 0, fn, false, null, undefined, 0, [\n\t\t\t4,5,6,7,8,9,11,22,33,44,55,\"66\", null, [], [[[[[ 3 ]]]], \"3\" ], {}, 1 / 0\n\t\t], [], [[[], \"foo\", null, {\n\t\t\tn: 1 / 0,\n\t\t\tz: {\n\t\t\t\ta: [ 3, 4, 5, 6, \"yep!\", undefined, undefined ],\n\t\t\t\tb: {}\n\t\t\t}\n\t\t}, {}]]] ), true );\n\n\tassert.equal( QUnit.equiv( a,\n\t\t[ {\n\t\t\tb: fn,\n\t\t\tc: false,\n\t\t\t\"do\": \"reserved word\",\n\t\t\t\"for\": {\n\t\t\t\tar: [ 3, 5, 9, \"hey!\", [], {\n\t\t\t\t\tar: [ 1, [\n\t\t\t\t\t\t3,4,6,9, null, [], []\n\t\t\t\t\t]],\n\t\t\t\t\te: fn,\n\t\t\t\t\tf: undefined\n\t\t\t\t} ]\n\t\t\t},\n\t\t\te: 0.43445\n\t\t}, 5, \"string\", 0, fn, false, null, undefined, 0, [\n\t\t\t4,5,6,7,8,9,11,22,33,44,55,\"66\", null, [], [[[[[ 2 ]]]], \"3\"], {}, 1 / 0\t// different: [[[[[2]]]]] instead of [[[[[3]]]]]\n\t\t], [], [[[], \"foo\", null, {\n\t\t\tn: 1 / 0,\n\t\t\tz: {\n\t\t\t\ta: [ 3, 4, 5, 6, \"yep!\", undefined, undefined ],\n\t\t\t\tb: {}\n\t\t\t}\n\t\t}, {}]]] ), false );\n\n\tassert.equal( QUnit.equiv( a,\n\t\t[ {\n\t\t\tb: fn,\n\t\t\tc: false,\n\t\t\t\"do\": \"reserved word\",\n\t\t\t\"for\": {\n\t\t\t\tar: [ 3, 5, 9, \"hey!\", [], {\n\t\t\t\t\tar: [ 1, [\n\t\t\t\t\t\t3,4,6,9, null, [], []\n\t\t\t\t\t]],\n\t\t\t\t\te: fn,\n\t\t\t\t\tf: undefined\n\t\t\t\t} ]\n\t\t\t},\n\t\t\te: 0.43445\n\t\t}, 5, \"string\", 0, fn, false, null, undefined, 0, [\n\t\t\t4,5,6,7,8,9,11,22,33,44,55,\"66\", null, [], [[[[[ 3 ]]]], \"3\" ], {}, 1 / 0\n\t\t], [], [[[], \"foo\", null, {\n\t\t\tn: -1 / 0,\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  // different, -Infinity instead of Infinity\n\t\t\tz: {\n\t\t\t\ta: [ 3, 4, 5, 6, \"yep!\", undefined, undefined ],\n\t\t\t\tb: {}\n\t\t\t}\n\t\t}, {}]]] ), false );\n\n\tassert.equal( QUnit.equiv( a,\n\t\t[ {\n\t\t\tb: fn,\n\t\t\tc: false,\n\t\t\t\"do\": \"reserved word\",\n\t\t\t\"for\": {\n\t\t\t\tar: [ 3, 5, 9, \"hey!\", [], {\n\t\t\t\t\tar: [ 1, [\n\t\t\t\t\t\t3,4,6,9, null, [], []\n\t\t\t\t\t]],\n\t\t\t\t\te: fn,\n\t\t\t\t\tf: undefined\n\t\t\t\t} ]\n\t\t\t},\n\t\t\te: 0.43445\n\t\t}, 5, \"string\", 0, fn, false, null, undefined, 0, [\n\t\t\t4,5,6,7,8,9,11,22,33,44,55,\"66\", null, [], [[[[[ 3 ]]]], \"3\" ], {}, 1 / 0\n\t\t], [], [[[], \"foo\", {\t\t\t\t\t\t\t\t\t\t\t\t\t\t// different: null is missing\n\t\t\tn: 1 / 0,\n\t\t\tz: {\n\t\t\t\ta: [ 3, 4, 5, 6, \"yep!\", undefined, undefined ],\n\t\t\t\tb: {}\n\t\t\t}\n\t\t}, {}]]] ), false );\n\n\tassert.equal( QUnit.equiv( a,\n\t\t[ {\n\t\t\tb: fn,\n\t\t\tc: false,\n\t\t\t\"do\": \"reserved word\",\n\t\t\t\"for\": {\n\t\t\t\tar: [ 3, 5, 9, \"hey!\", [], {\n\t\t\t\t\tar: [ 1, [\n\t\t\t\t\t\t3,4,6,9, null, [], []\n\t\t\t\t\t]],\n\t\t\t\t\te: fn\n\n\t\t\t\t\t// different: missing property f: undefined\n\t\t\t\t} ]\n\t\t\t},\n\t\t\te: 0.43445\n\t\t}, 5, \"string\", 0, fn, false, null, undefined, 0, [\n\t\t\t4,5,6,7,8,9,11,22,33,44,55,\"66\", null, [], [[[[[ 3 ]]]], \"3\" ], {}, 1 / 0\n\t\t], [], [[[], \"foo\", null, {\n\t\t\tn: 1 / 0,\n\t\t\tz: {\n\t\t\t\ta: [ 3, 4, 5, 6, \"yep!\", undefined, undefined ],\n\t\t\t\tb: {}\n\t\t\t}\n\t\t}, {}]]] ), false );\n} );\n\nQUnit.test( \"Prototypal inheritance\", function( assert ) {\n\tfunction Gizmo( id ) {\n\t\tthis.id = id;\n\t}\n\n\tfunction Hoozit( id ) {\n\t\tthis.id = id;\n\t}\n\tHoozit.prototype = new Gizmo();\n\n\tvar gizmo = new Gizmo( \"ok\" ),\n\t\thoozit = new Hoozit( \"ok\" );\n\n\t// Try this test many times after test on instances that hold function\n\t// to make sure that our code does not mess with last object constructor memoization.\n\tassert.equal( QUnit.equiv( function() {}, function() {} ), false );\n\n\t// Hoozit inherit from Gizmo\n\t// hoozit instanceof Hoozit; // true\n\t// hoozit instanceof Gizmo; // true\n\tassert.equal( QUnit.equiv( hoozit, gizmo ), true );\n\n\tGizmo.prototype.bar = true; // not a function just in case we skip them\n\n\t// Hoozit inherit from Gizmo\n\t// They are equivalent\n\tassert.equal( QUnit.equiv( hoozit, gizmo ), true );\n\n\t// Make sure this is still true !important\n\t// The reason for this is that I forgot to reset the last\n\t// caller to where it were called from.\n\tassert.equal( QUnit.equiv( function() {}, function() {} ), false );\n\n\t// Make sure this is still true !important\n\tassert.equal( QUnit.equiv( hoozit, gizmo ), true );\n\n\tHoozit.prototype.foo = true; // not a function just in case we skip them\n\n\t// Gizmo does not inherit from Hoozit\n\t// gizmo instanceof Gizmo; // true\n\t// gizmo instanceof Hoozit; // false\n\t// They are not equivalent\n\tassert.equal( QUnit.equiv( hoozit, gizmo ), false );\n\n\t// Make sure this is still true !important\n\tassert.equal( QUnit.equiv( function() {}, function() {} ), false );\n} );\n\nQUnit.test( \"Instances\", function( assert ) {\n\tvar a1, a2, b1, b2, c1, c2, c3, car, carSame, carDiff, human;\n\n\tfunction A() {}\n\ta1 = new A();\n\ta2 = new A();\n\n\tfunction B() {\n\t\tthis.fn = function() {};\n\t}\n\tb1 = new B();\n\tb2 = new B();\n\n\tfunction C( fn ) {\n\t\tthis.fn = fn;\n\t}\n\n\tc1 = new C( function() { return true; } );\n\tc2 = new C( function() { return false; } );\n\tc3 = new C( function() { return true; } );\n\n\tassert.equal( QUnit.equiv( a1, a2 ), true, \"Same property, same constructor\" );\n\n\t// b1.fn and b2.fn are functions but they are different references\n\t// But we decided to skip function for instances.\n\tassert.equal( QUnit.equiv( b1, b2 ), true, \"Same property, same constructor\" );\n\n\tassert.equal( QUnit.equiv( c1, c2 ), false, \"Same property with different reference and different function\" );\n\tassert.equal( QUnit.equiv( c1, c3 ), true, \"Same property with different reference but same function\" );\n\n\t// failed\n\tassert.equal( QUnit.equiv( a1, b1 ), false, \"Same properties but different constructor\" );\n\n\tfunction Car( year ) {\n\t\tvar privateVar = 0;\n\t\tthis.year = year;\n\t\tthis.isOld = function() {\n\t\t\treturn privateVar > 10;\n\t\t};\n\t}\n\n\tfunction Human( year ) {\n\t\tvar privateVar = 1;\n\t\tthis.year = year;\n\t\tthis.isOld = function() {\n\t\t\treturn privateVar > 80;\n\t\t};\n\t}\n\n\tcar = new Car( 30 );\n\tcarSame = new Car( 30 );\n\tcarDiff = new Car( 10 );\n\thuman = new Human( 30 );\n\n\t/**\n\t * difference:\n\t *\t - year: 30\n\t * same:\n\t *\t - year: 30,\n\t *\t - isOld: function () {}\n\t */\n\n\tassert.equal( QUnit.equiv( car, car ), true );\n\tassert.equal( QUnit.equiv( car, carDiff ), false );\n\tassert.equal( QUnit.equiv( car, carSame ), true );\n\tassert.equal( QUnit.equiv( car, human ), false );\n} );\n\nQUnit.test(\n\t\"Complex instance nesting (with function values in literals and/or in nested instances)\",\n\tfunction( assert ) {\n\t\tvar a1, a2, b1, b2, c1, c2, d1, d2, e1, e2;\n\n\t\tfunction A( fn ) {\n\t\t\tthis.a = {};\n\t\t\tthis.fn = fn;\n\t\t\tthis.b = { a: [] };\n\t\t\tthis.o = {};\n\t\t\tthis.fn1 = fn;\n\t\t}\n\t\tfunction B( fn ) {\n\t\t\tthis.fn = fn;\n\t\t\tthis.fn1 = function() {};\n\t\t\tthis.a = new A( function() {} );\n\t\t}\n\n\t\tfunction fnOutside() {\n\t\t}\n\n\t\tfunction C( fn ) {\n\t\t\tfunction fnInside() {\n\t\t\t}\n\t\t\tthis.x = 10;\n\t\t\tthis.fn = fn;\n\t\t\tthis.fn1 = function() {};\n\t\t\tthis.fn2 = fnInside;\n\t\t\tthis.fn3 = {\n\t\t\t\ta: true,\n\t\t\t\tb: fnOutside // ok make reference to a function in all instances scope\n\t\t\t};\n\t\t\tthis.o1 = {};\n\n\t\t\t// This function will be ignored.\n\t\t\t// Even if it is not visible for all instances (e.g. locked in a closures),\n\t\t\t// it is from a  property that makes part of an instance (e.g. from the C constructor)\n\t\t\tthis.b1 = new B( function() {} );\n\t\t\tthis.b2 = new B( {\n\t\t\t\tx: {\n\t\t\t\t\tb2: new B( function() {} )\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tfunction D( fn ) {\n\t\t\tfunction fnInside() {\n\t\t\t}\n\t\t\tthis.x = 10;\n\t\t\tthis.fn = fn;\n\t\t\tthis.fn1 = function() {};\n\t\t\tthis.fn2 = fnInside;\n\t\t\tthis.fn3 = {\n\t\t\t\ta: true,\n\t\t\t\tb: fnOutside, // ok make reference to a function in all instances scope\n\n\t\t\t\t// This function won't be ignored.\n\t\t\t\t// It isn't visible for all C instances\n\t\t\t\t// and it is not in a property of an instance.\n\t\t\t\t// (in an Object instances e.g. the object literal)\n\t\t\t\tc: fnInside\n\t\t\t};\n\t\t\tthis.o1 = {};\n\n\t\t\t// This function will be ignored.\n\t\t\t// Even if it is not visible for all instances (e.g. locked in a closures),\n\t\t\t// it is from a  property that makes part of an instance (e.g. from the C constructor)\n\t\t\tthis.b1 = new B( function() {} );\n\t\t\tthis.b2 = new B( {\n\t\t\t\tx: {\n\t\t\t\t\tb2: new B( function() {} )\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tfunction E( fn ) {\n\t\t\tfunction fnInside() {\n\t\t\t}\n\t\t\tthis.x = 10;\n\t\t\tthis.fn = fn;\n\t\t\tthis.fn1 = function() {};\n\t\t\tthis.fn2 = fnInside;\n\t\t\tthis.fn3 = {\n\t\t\t\ta: true,\n\t\t\t\tb: fnOutside // ok make reference to a function in all instances scope\n\t\t\t};\n\t\t\tthis.o1 = {};\n\n\t\t\t// This function will be ignored.\n\t\t\t// Even if it is not visible for all instances (e.g. locked in a closures),\n\t\t\t// it is from a  property that makes part of an instance (e.g. from the C constructor)\n\t\t\tthis.b1 = new B( function() {} );\n\t\t\tthis.b2 = new B( {\n\t\t\t\tx: {\n\t\t\t\t\tb1: new B( { a: function() {} } ),\n\t\t\t\t\tb2: new B( function() {} )\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\ta1 = new A( function() {} );\n\t\ta2 = new A( function() {} );\n\t\tassert.equal( QUnit.equiv( a1, a2 ), true );\n\n\t\tassert.equal( QUnit.equiv( a1, a2 ), true ); // different instances\n\n\t\tb1 = new B( function() {} );\n\t\tb2 = new B( function() {} );\n\t\tassert.equal( QUnit.equiv( b1, b2 ), true );\n\n\t\tc1 = new C( function() {} );\n\t\tc2 = new C( function() {} );\n\t\tassert.equal( QUnit.equiv( c1, c2 ), true );\n\n\t\td1 = new D( function() {} );\n\t\td2 = new D( function() {} );\n\t\tassert.equal( QUnit.equiv( d1, d2 ), false );\n\n\t\te1 = new E( function() {} );\n\t\te2 = new E( function() {} );\n\t\tassert.equal( QUnit.equiv( e1, e2 ), false );\n\t}\n);\n\nQUnit.test( \"Object with circular references\", function( assert ) {\n\tvar circularA = {\n\t\t\tabc: null\n\t\t},\n\t\tcircularB = {\n\t\t\tabc: null\n\t\t};\n\tcircularA.abc = circularA;\n\tcircularB.abc = circularB;\n\tassert.equal( QUnit.equiv( circularA, circularB ), true,\n\t\t\"Should not repeat test on object (ambiguous test)\"\n\t);\n\n\tcircularA.def = 1;\n\tcircularB.def = 1;\n\tassert.equal( QUnit.equiv( circularA, circularB ), true,\n\t\t\"Should not repeat test on object (ambiguous test)\"\n\t);\n\n\tcircularA.def = 1;\n\tcircularB.def = 0;\n\tassert.equal( QUnit.equiv( circularA, circularB ), false,\n\t\t\"Should not repeat test on object (unambiguous test)\"\n\t);\n} );\n\nQUnit.test( \"Array with circular references\", function( assert ) {\n\tvar circularA = [],\n\t\tcircularB = [];\n\tcircularA.push( circularA );\n\tcircularB.push( circularB );\n\tassert.equal( QUnit.equiv( circularA, circularB ), true,\n\t\t\"Should not repeat test on array (ambiguous test)\"\n\t);\n\n\tcircularA.push( \"abc\" );\n\tcircularB.push( \"abc\" );\n\tassert.equal( QUnit.equiv( circularA, circularB ), true,\n\t\t\"Should not repeat test on array (ambiguous test)\"\n\t);\n\n\tcircularA.push( \"hello\" );\n\tcircularB.push( \"goodbye\" );\n\tassert.equal( QUnit.equiv( circularA, circularB ), false,\n\t\t\"Should not repeat test on array (unambiguous test)\"\n\t);\n} );\n\nQUnit.test( \"Mixed object/array with references to self wont loop\", function( assert ) {\n\tvar circularA = [ {\n\t\t\tabc: null\n\t\t} ],\n\t\tcircularB = [ {\n\t\t\tabc: null\n\t\t} ];\n\tcircularA[ 0 ].abc = circularA;\n\tcircularB[ 0 ].abc = circularB;\n\n\tcircularA.push( circularA );\n\tcircularB.push( circularB );\n\tassert.equal( QUnit.equiv( circularA, circularB ), true,\n\t\t\"Should not repeat test on object/array (ambiguous test)\"\n\t);\n\n\tcircularA[ 0 ].def = 1;\n\tcircularB[ 0 ].def = 1;\n\tassert.equal( QUnit.equiv( circularA, circularB ), true,\n\t\t\"Should not repeat test on object/array (ambiguous test)\"\n\t);\n\n\tcircularA[ 0 ].def = 1;\n\tcircularB[ 0 ].def = 0;\n\tassert.equal( QUnit.equiv( circularA, circularB ), false,\n\t\t\"Should not repeat test on object/array (unambiguous test)\"\n\t);\n} );\n\nQUnit.test( \"Compare self-referent to tree\", function( assert ) {\n\tvar temp,\n\t\tcircularA = [ 0 ],\n\t\ttreeA = [ 0, null ],\n\t\tcircularO = {},\n\t\ttreeO = {\n\t\t\to: null\n\t\t};\n\n\tcircularA[ 1 ] = circularA;\n\tcircularO.o = circularO;\n\n\tassert.equal( QUnit.equiv( circularA, treeA ), false,\n\t\t\"Array: Should not consider circular equal to tree\"\n\t);\n\tassert.equal( QUnit.equiv( circularO, treeO ), false,\n\t\t\"Object: Should not consider circular equal to tree\"\n\t);\n\n\ttemp = [ 0, circularA ];\n\tassert.equal( QUnit.equiv( circularA, temp ), true,\n\t\t\"Array: Reference is circular for one, but equal on other\"\n\t);\n\tassert.equal( QUnit.equiv( temp, circularA ), true,\n\t\t\"Array: Reference is circular for one, but equal on other\"\n\t);\n\n\ttemp = {\n\t\to: circularO\n\t};\n\tassert.equal( QUnit.equiv( circularO, temp ), true,\n\t\t\"Object: Reference is circular for one, but equal on other\"\n\t);\n\tassert.equal( QUnit.equiv( temp, circularO ), true,\n\t\t\"Object: Reference is circular for one, but equal on other\"\n\t);\n} );\n\nQUnit.test( \"Compare differently self-referential structures\", function( assert ) {\n\tvar x = [],\n\t\ty = [];\n\n\tx[ 0 ] = x;\n\ty[ 0 ] = [ y ];\n\n\t// x is [ x ], y is [ [ y ] ]\n\t// So both x and y look like [ [ [ [ ... ] ] ] ]\n\tassert.equal( QUnit.equiv( x, y ), true, \"Equivalent arrays\" );\n\ty = [];\n\ty[ 0 ] = [ y, 1 ];\n\n\t// x looks like [ [ [ [ ...  ] ] ] ]\n\t// y looks like [ [ [ [ ... , 1 ] ], 1 ] ]\n\tassert.equal( QUnit.equiv( x, y ), false, \"Nonequivalent arrays\" );\n\tx = {};\n\ty = {};\n\tx.val = x;\n\ty.val = { val: y };\n\n\t// Both x and y look like { val: { val: { ... } } }\n\tassert.equal( QUnit.equiv( x, y ), true, \"Equivalent objects\" );\n\n\t// x looks like { val: { val: { val: { val: { ... } } } } }\n\t// y looks like { val: { val: { val: { val: { ... }, foo: 1 } }, foo: 1 } }\n\ty.val = { val: y, foo: 1 };\n\tassert.equal( QUnit.equiv( x, y ), false, \"Nonequivalent objects\" );\n} );\n\nQUnit.test( \"Compare structures with multiple references to the same containers\", function( assert ) {\n\tvar i,\n\t\tx = {},\n\t\ty = {};\n\tfor ( i = 0; i < 20; i++ ) {\n\t\tx = { foo: x, bar: x, baz: x };\n\t\ty = { foo: y, bar: y, baz: y };\n\t}\n\tassert.equal( QUnit.equiv( { big: x, z: [ true ] }, { big: y, z: [ true ] } ), true, \"Equivalent structures\" );\n\tassert.equal( QUnit.equiv( { big: x, z: [ true ] }, { big: y, z: [ false ] } ), false, \"Nonequivalent structures\" );\n} );\n\nQUnit.test( \"Test that must be done at the end because they extend some primitive's prototype\",\n\tfunction( assert ) {\n\n\t\t// Try that a function looks like our regular expression.\n\t\t// This tests if we check that a and b are really both instance of RegExp\n\t\tFunction.prototype.global = true;\n\t\tFunction.prototype.multiline = true;\n\t\tFunction.prototype.ignoreCase = false;\n\t\tFunction.prototype.source = \"my regex\";\n\t\tvar re = /my regex/gm;\n\t\tassert.equal( QUnit.equiv( re, function() {} ), false,\n\t\t\t\"A function that looks that a regex isn't a regex\"\n\t\t);\n\n\t\t// This test will ensures it works in both ways,\n\t\t// and ALSO especially that we can make differences\n\t\t// between RegExp and Function constructor because\n\t\t// typeof on a RegExpt instance is \"function\"\n\t\tassert.equal( QUnit.equiv( function() {}, re ), false,\n\t\t\t\"Same conversely, but ensures that function and regexp are distinct because their constructor are different\"\n\t\t);\n\t}\n);\n\nQUnit.module( \"equiv Object-wrapped primitives\" );\n\nQUnit.test( \"Number\", function( assert ) {\n\tvar SafeNumber = Number;\n\n\tassert.ok( QUnit.equiv( new SafeNumber( 1 ), new SafeNumber( 1 ) ),\n\t\t\"Number objects with same values are equivalent.\"\n\t);\n\tassert.ok( QUnit.equiv( new SafeNumber( 0 / 0 ), new SafeNumber( 0 / 0 ) ),\n\t\t\"NaN Number objects are equivalent.\"\n\t);\n\tassert.ok( QUnit.equiv( new SafeNumber( 1 / 0 ), new SafeNumber( 2 / 0 ) ),\n\t\t\"Infinite Number objects are equivalent.\"\n\t);\n\n\tassert.notOk( QUnit.equiv( new SafeNumber( 1 ), new SafeNumber( 2 ) ),\n\t\t\"Number objects with different values are not equivalent.\"\n\t);\n\tassert.notOk( QUnit.equiv( new SafeNumber( 0 / 0 ), new SafeNumber( 1 / 0 ) ),\n\t\t\"NaN Number objects and infinite Number objects are not equivalent.\"\n\t);\n\tassert.notOk( QUnit.equiv( new SafeNumber( 1 / 0 ), new SafeNumber( -1 / 0 ) ),\n\t\t\"Positive and negative infinite Number objects are not equivalent.\"\n\t);\n} );\n\nQUnit.test( \"String\", function( assert ) {\n\tvar SafeString = String;\n\n\tassert.ok( QUnit.equiv( new SafeString( \"foo\" ), new SafeString( \"foo\" ) ),\n\t\t\"String objects with same values are equivalent.\"\n\t);\n\tassert.ok( QUnit.equiv( new SafeString( \"\" ), new SafeString( \"\" ) ),\n\t\t\"Empty String objects are equivalent.\"\n\t);\n\n\tassert.notOk( QUnit.equiv( new SafeString( \"foo\" ), new SafeString( \"bar\" ) ),\n\t\t\"String objects with different values are not equivalent.\"\n\t);\n\tassert.notOk( QUnit.equiv( new SafeString( \"\" ), new SafeString( \"foo\" ) ),\n\t\t\"Empty and nonempty String objects are not equivalent.\"\n\t);\n} );\n\nQUnit.test( \"Boolean\", function( assert ) {\n\tvar SafeBoolean = Boolean;\n\n\tassert.ok( QUnit.equiv( new SafeBoolean( true ), new SafeBoolean( true ) ),\n\t\t\"True Boolean objects are equivalent.\"\n\t);\n\tassert.ok( QUnit.equiv( new SafeBoolean( false ), new SafeBoolean( false ) ),\n\t\t\"False Boolean objects are equivalent.\"\n\t);\n\n\tassert.notOk( QUnit.equiv( new SafeBoolean( true ), new SafeBoolean( false ) ),\n\t\t\"Boolean objects with different values are not equivalent.\"\n\t);\n} );\n\nQUnit.module( \"equiv Maps and Sets\" );\n\nvar hasES6Set = ( function() {\n\tif ( typeof Set !== \"function\" ) {\n\t\treturn false;\n\t}\n\n\ttry {\n\n\t\t// some platforms don't support iterables in Set constructors\n\t\tvar s = new Set( [ 1, 2, 3 ] );\n\t\tif ( s.size !== 3 || !s.has( 2 ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// in IE 11, QUnit.objectType( new Set() ) === \"object\"\n\t\treturn ( QUnit.objectType( s ) === \"set\" );\n\t} catch ( e ) {\n\t\treturn false;\n\t}\n}() );\n\nvar hasES6Map = ( function() {\n\tif ( typeof Map !== \"function\" ) {\n\t\treturn false;\n\t}\n\n\ttry {\n\n\t\t// some platforms don't support array-like iterables in Map constructors\n\t\tvar m = new Map( [ [ 1, 2 ] ] );\n\t\tif ( m.size !== 1 || !m.has( 1 ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// in IE 11, QUnit.objectType( new Map() ) === \"object\"\n\t\treturn ( QUnit.objectType( m ) === \"map\" );\n\t} catch ( e ) {\n\t\treturn false;\n\t}\n}() );\n\nQUnit[ hasES6Set ? \"test\" : \"skip\" ]( \"Sets\", function( assert ) {\n\tvar s1, s2, s3, s4, o1, o2, o3, o4, m1, m2, m3;\n\n\t// Empty sets\n\ts1 = new Set();\n\ts2 = new Set( [] );\n\tassert.equal( QUnit.equiv( s1, s2 ), true, \"Empty sets\" );\n\n\t// Simple cases\n\ts1 = new Set( [ 1 ] );\n\ts2 = new Set( [ 1 ] );\n\ts3 = new Set( [ 3 ] );\n\tassert.equal( QUnit.equiv( s1, s2 ), true, \"Single element sets [1] vs [1]\" );\n\tassert.equal( QUnit.equiv( s1, s3 ), false, \"Single element sets [1] vs [3]\" );\n\n\t// Tricky values\n\ts1 = new Set( [ false, undefined, null, 0, Infinity, NaN, -Infinity ] );\n\ts2 = new Set( [ undefined, null, false, 0, NaN, Infinity, -Infinity ] );\n\tassert.equal( QUnit.equiv( s1, s2 ), true, \"Multiple-element sets of tricky values\" );\n\n\t// Sets Containing objects\n\to1 = { foo: 0, bar: true };\n\to2 = { foo: 0, bar: true };\n\to3 = { foo: 1, bar: true };\n\to4 = { foo: 1, bar: true };\n\ts1 = new Set( [ o1, o3 ] );\n\ts2 = new Set( [ o1, o3 ] );\n\tassert.equal( QUnit.equiv( s1, s2 ), true, \"Sets containing same objects\" );\n\ts1 = new Set( [ o1 ] );\n\ts2 = new Set( [ o2 ] );\n\tassert.equal( QUnit.equiv( s1, s2 ), true, \"Sets containing deeply-equal objects\" );\n\ts1 = new Set( [ o1, o3 ] );\n\ts2 = new Set( [ o4, o2 ] );\n\tassert.equal( QUnit.equiv( s1, s2 ), true, \"Sets containing deeply-equal objects in different insertion order\" );\n\ts1 = new Set( [ o1 ] );\n\ts2 = new Set( [ o3 ] );\n\tassert.equal( QUnit.equiv( s1, s2 ), false, \"Sets containing different objects\" );\n\n\t// Sets containing sets\n\ts1 = new Set( [ 1, 2, 3 ] );\n\ts2 = new Set( [ 1, 2, 3 ] );\n\ts3 = new Set( [ s1 ] );\n\ts4 = new Set( [ s2 ] );\n\tassert.equal( QUnit.equiv( s3, s4 ), true, \"Sets containing deeply-equal sets\" );\n\n\t// Sets containing different sets\n\ts1 = new Set( [ 1, 2, 3 ] );\n\ts2 = new Set( [ 1, 2, 3, 4 ] );\n\ts3 = new Set( [ s1 ] );\n\ts4 = new Set( [ s2 ] );\n\tassert.equal( QUnit.equiv( s3, s4 ), false, \"Sets containing different sets\" );\n\n\t// Sets containing maps\n\tm1 = new Map( [ [ 1, 1 ] ] );\n\tm2 = new Map( [ [ 1, 1 ] ] );\n\tm3 = new Map( [ [ 1, 3 ] ] );\n\ts3 = new Set( [ m1 ] );\n\ts4 = new Set( [ m2 ] );\n\tassert.equal( QUnit.equiv( s3, s4 ), true, \"Sets containing different but deeply-equal maps\" );\n\ts3 = new Set( [ m1 ] );\n\ts4 = new Set( [ m3 ] );\n\tassert.equal( QUnit.equiv( s3, s4 ), false, \"Sets containing different maps\" );\n\n\t// Sets with different insertion order\n\ts1 = new Set( [ 1, 2, 3 ] );\n\ts2 = new Set( [ 3, 2, 1 ] );\n\tassert.equal( QUnit.equiv( s1, s2 ), true, \"Sets with different insertion orders\" );\n} );\n\nQUnit[ hasES6Map ? \"test\" : \"skip\" ]( \"Maps\", function( assert ) {\n\tvar m1, m2, m3, m4, o1, o2, o3, o4, s1, s2, s3;\n\n\t// Empty maps\n\tm1 = new Map();\n\tm2 = new Map( [] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Empty maps\" );\n\n\t// Simple cases\n\tm1 = new Map( [ [ 1, 1 ] ] );\n\tm2 = new Map( [ [ 1, 1 ] ] );\n\tm3 = new Map( [ [ 1, 3 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Single element maps [1,1] vs [1,1]\" );\n\tassert.equal( QUnit.equiv( m1, m3 ), false, \"Single element maps [1,1] vs [1,3]\" );\n\n\t// Tricky values\n\tm1 = new Map( [\n\t\t[ false, false ],\n\t\t[ null, null ],\n\t\t[ 0, 0 ],\n\t\t[ undefined, undefined ],\n\t\t[ Infinity, Infinity ],\n\t\t[ NaN, NaN ],\n\t\t[ -Infinity, -Infinity ]\n\t] );\n\tm2 = new Map( [\n\t\t[ undefined, undefined ],\n\t\t[ null, null ],\n\t\t[ false, false ],\n\t\t[ 0, 0 ],\n\t\t[ NaN, NaN ],\n\t\t[ Infinity, Infinity ],\n\t\t[ -Infinity, -Infinity ]\n\t] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Multiple-element maps of tricky values\" );\n\n\t// Same keys, different values\n\tm1 = new Map( [\n\t\t[ 1, \"one\" ],\n\t\t[ 2, \"two\" ]\n\t] );\n\tm2 = new Map( [\n\t\t[ 1, 1 ],\n\t\t[ 2, 2 ]\n\t] );\n\tassert.equal( QUnit.equiv( m1, m2 ), false, \"Maps with same keys, different values\" );\n\n\t// Maps Containing objects\n\to1 = { foo: 0, bar: true };\n\to2 = { foo: 0, bar: true };\n\to3 = { foo: 1, bar: true };\n\to4 = { foo: 1, bar: true };\n\tm1 = new Map( [\n\t\t[ 1, o1 ],\n\t\t[ 2, o3 ]\n\t] );\n\tm2 = new Map( [\n\t\t[ 1, o1 ],\n\t\t[ 2, o3 ]\n\t] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Maps containing same objects\" );\n\tm1 = new Map( [ [ 1, o1 ] ] );\n\tm2 = new Map( [ [ 1, o2 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Maps containing different but deeply-equal objects\" );\n\tm1 = new Map( [ [ 1, o1 ], [ 2, o3 ] ] );\n\tm2 = new Map( [ [ 2, o4 ], [ 1, o2 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Maps containing different but deeply-equal objects in different insertion order\" );\n\tm1 = new Map( [ [ o1, 1 ] ] );\n\tm2 = new Map( [ [ o2, 1 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Maps containing different but deeply-equal objects as keys\" );\n\tm1 = new Map( [ [ o1, 1 ], [ o3, 2 ] ] );\n\tm2 = new Map( [ [ o4, 2 ], [ o2, 1 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Maps containing different but deeply-equal objects as keys in different insertion order\" );\n\n\t// Maps containing different objects\n\tm1 = new Map( [ [ 1, o1 ] ] );\n\tm2 = new Map( [ [ 1, o3 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), false, \"Maps containing different objects\" );\n\n\t// Maps containing maps\n\tm1 = new Map( [ [ 1, 1 ] ] );\n\tm2 = new Map( [ [ 1, 1 ] ] );\n\tm3 = new Map( [ [ \"myMap\", m1 ] ] );\n\tm4 = new Map( [ [ \"myMap\", m2 ] ] );\n\tassert.equal( QUnit.equiv( m3, m4 ), true, \"Maps containing deeply-equal maps\" );\n\n\t// Maps containing different maps\n\tm1 = new Map( [ [ 1, 1 ] ] );\n\tm2 = new Map( [ [ 1, 2 ] ] );\n\tm3 = new Map( [ [ \"myMap\", m1 ] ] );\n\tm4 = new Map( [ [ \"myMap\", m2 ] ] );\n\tassert.equal( QUnit.equiv( m3, m4 ), false, \"Maps containing different maps\" );\n\n\t// Maps containing sets\n\ts1 = new Set( [ 1, 2, 3 ] );\n\ts2 = new Set( [ 1, 2, 3 ] );\n\ts3 = new Set( [ 1, 2, 3, 4 ] );\n\tm1 = new Map( [ [ 1, s1 ] ] );\n\tm2 = new Map( [ [ 1, s2 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), true, \"Maps containing different but deeply-equal sets\" );\n\n\t// Maps containing different sets\n\tm1 = new Map( [ [ 1, s1 ] ] );\n\tm2 = new Map( [ [ 1, s3 ] ] );\n\tassert.equal( QUnit.equiv( m1, m2 ), false, \"Maps containing different sets\" );\n} );\n\nQUnit.module( \"equiv Symbols\" );\n\nvar hasES6Symbol = ( function() {\n\treturn typeof Symbol === \"function\";\n}() );\n\nQUnit[ hasES6Symbol ? \"test\" : \"skip\" ]( \"regular checks\", function( assert ) {\n\tvar a = Symbol( 1 );\n\tvar b = Symbol( 1 );\n\n\tassert.equal( QUnit.equiv( a, a ), true, \"Same symbol is equivalent\" );\n\tassert.equal(\n\t\tQUnit.equiv( a, b ), false,\n\t\t\"Not equivalent to another similar symbol built on the same token\"\n\t);\n} );\n",
                "subject": "Tests: Fix no-multi-spaces violation found by latest ESLint",
                "message": "Tests: Fix no-multi-spaces violation found by latest ESLint\n\n> /test/main/deepEqual.js\n> 1808:43  error  Multiple spaces found before '0'    no-multi-spaces\n> 1877:8   error  Multiple spaces found before 'new'  no-multi-spaces\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "qunitjs/qunit,qunitjs/qunit"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10241,
            "row": {
                "commit": "91b59fbb21db55d1a7222ef79c2f43191329efc3",
                "old_file": "jquery.validation.js",
                "new_file": "jquery.validation.js",
                "old_contents":"/*\n* Form Validation 1.1, jQuery plugin\n* Repository: http://github.com/seinoxygen/jquery-validation\n*\n* Copyright(c) 2014, Pablo Cornehl\n* http://www.seinoxygen.com\n*\n* Licensed under the MIT License\n*/\n(function($, window, undefined){      \n\t$.fn.validate = function(options) {\n\t\t\n\t\t// Default config\n\t\tvar defaults = {\n\t\t\tforce: false,\n\t\t\twrapper: 'jqv-',\n\t\t\tformHandler: '',\n\t\t\tonValid: function(element){}, // Called when the field is valid\n\t\t\tonInvalid: function(element, error){}, // Called when the field is invalid\n\t\t\tonSuccess: function(){}, // Called when all the fields were validated correctly\n\t\t\tonError: function(){} // Called when at least one field has an error\n\t\t};\n\t\t\n\t\t// Update all configs\n\t\toptions = $.extend(true, {}, defaults, options);\n\t\t\n\t\tvar is_valid = true;\n\t\tvar checked = false;\n\t\t\n\t\t// Check all fields\n\t\tthis.each(function() {\n\t\t\tif(options.force === true){\n\t\t\t\tvar error = $.fn.validate.check($(this), options);\n\t\t\t\tif(error === true){\n\t\t\t\t\tis_valid = false;\n\t\t\t\t}\n\t\t\t\tchecked = true;\n\t\t\t}\n\t\t\t\n\t\t\t// For textboxes\n\t\t\t$(this).keyup(function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\t// Ignore enter\n\t\t\t\tif (e.which === 13) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar error = $.fn.validate.check($(this), options);\n\t\t\t\tif(error === true){\n\t\t\t\t\tis_valid = false;\n\t\t\t\t}\n\t\t\t\tchecked = true;\n\t\t\t});\n\t\t\t\n\t\t\t// For radio, checkbox and selects\n\t\t\tvar type = $(this).attr(\"type\");\t\t\t\n\t\t\tif ($(this).is('select') || type === \"radio\" || type === \"checkbox\"){\n\t\t\t\t$(this).change(function() {\n\t\t\t\t\tvar error = $.fn.validate.check($(this), options);\n\t\t\t\t\tif(error === true){\n\t\t\t\t\t\tis_valid = false;\n\t\t\t\t\t}\n\t\t\t\t\tchecked = true;\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\t\n\t\t// If it has been checked in one way, and fields are valid then call the success callback.\n\t\tif (is_valid === true && checked === true){\n\t\t\toptions.onSuccess.call(this);\n\t\t}\n\t\t\n\t\t// If it has been checked and some field throws error then call the error callback.\n\t\tif (is_valid === false && checked === true){\n\t\t\toptions.onError.call(this);\n\t\t}\n\t\t\n\t\t// If everything is valid and form handles has been declared, then submit.\n\t\tif(is_valid === true && options.formHandler.length > 0){\n\t\t\t$(options.formHandler).submit();\n\t\t}\n\t\t\n\t\treturn this;\n\t};\n\t\t\n\t/**\n\t * Run the rules in the field.\n\t * \n \t * @param object value\n \t * @param object value\n\t */\n\t$.fn.validate.check = function(element, options) {\n\t\t\n\t\t// If attribute is not defined return false because there is no rules to apply\n\t\tif (typeof element.data('rules') == \"undefined\") {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t// Explode rules\t\t\t\n\t\tvar rules = element.data('rules').split('|');\n\t\t\t\t\n\t\tvar error = false;\n\t\tfor (var i = 0; i < rules.length; i++) {\n\t\t\tvar rule = rules[i];\n\t\t\tvar regex = /(.*?)\\[(.*?)\\]/;\n\t\t\t\t\t\t\t\t\t\t\n\t\t\tvar func = rule;\n\t\t\tvar filter = '';\n\t\t\t\t\n\t\t\t// Check if arguments are enclosed in brackets\t\t\t\n\t\t\tvar groups = regex.exec(rule);\t\n\t\t\tif(groups !== null){\n\t\t\t\tfunc = groups[1];\n\t\t\t\tfilter = groups[2];\n\t\t\t}\n\t\t\t\t\t\n\t\t\t// If the function exists call it.\t\t\t\n\t\t\tif (typeof $.fn.validate[func] != \"undefined\") {\n\t\t\t\t\n\t\t\t\tvar value = element.val();\n\t\t\t\t\n\t\t\t\t// Verify the tipe of element. If they're radios or checkboxes look for checkeds\n\t\t\t\tvar type = element.attr(\"type\");\n\t\t\t\tif (type == \"radio\" || type == \"checkbox\"){\n\t\t\t\t\t// lenght is obtained ahead in the rules\n\t\t\t\t\tvalue = $('input[name=' + element.attr(\"name\") + ']:checked');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\terror = $.fn.validate[func](value, filter);\n\t\t\t\tif(error === true){\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Apply the correct css to the field.\n\t\tif(error === true){\n\t\t\t\n\t\t\tvar field_label = $.fn.validate.fieldlabel(element);\n\t\t\t\n\t\t\t// Call the invalid function\n\t\t\tvar parts = filter.split('-');\n\t\t\t\n\t\t\tif(func == \"matches\"){\n\t\t\t\tparts[0] = $.fn.validate.fieldlabel($(parts[0]));\n\t\t\t}\n\t\t\t\n\t\t\tvar msg = validation_lang[func];\n\t\t\t\n\t\t\t// If exists a custom message use it.\n\t\t\tif (typeof element.data('message') != \"undefined\") {\n\t\t\t\tmsg = element.data('message');\n\t\t\t}\n\t\t\t\n\t\t\tmsg = msg.replace(\"%s\", field_label).replace(\"%k\", parts[0]).replace(\"%n\", parts[1]);\n\t\t\t\n\t\t\toptions.onInvalid.call(this, element, msg);\n\t\t\t$(element).removeClass(options.wrapper + 'valid').addClass(options.wrapper + 'invalid');\n\t\t}\n\t\telse{\n\t\t\toptions.onValid.call(this, element);\n\t\t\t$(element).removeClass(options.wrapper + 'invalid').addClass(options.wrapper + 'valid');\n\t\t}\n\t\treturn error;\n\t};\n\t\n\t$.fn.validate.fieldlabel = function(element){\n\t\tvar field_label = '';\n\t\t// If is set the field title use it\n\t\tif (typeof element.attr('title') != \"undefined\") {\n\t\t\tfield_label = element.attr('title');\n\t\t}\n\t\t// If is set the data attribute name use it\n\t\tif (typeof element.data('name') != \"undefined\") {\n\t\t\tfield_label = element.data('name');\n\t\t}\n\t\t\n\t\treturn field_label;\n\t};\n\t\t\n\t/**\n\t * Checks if the field is filled.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.required = function(value) {\n\t\tif(value.length === 0){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\t\n\t};\n\t\n\t/**\n\t * Checks if the field is not zero.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.nozero = function(value) {\n\t\tif(Number(value) === 0){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\t\n\t};\n\t\t\n\t/**\n\t * Checks if the field is x characters long.\n\t * \n \t * @param string value\n \t * @param integer value\n\t */\n\t$.fn.validate.exactlength = function(value, options) {\n\t\tif(value.length !== Number(options)){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n\t/**\n\t * Checks if the field is at least x characters long.\n\t * \n \t * @param string value\n \t * @param integer value\n\t */\n\t$.fn.validate.minlength = function(value, options) {\n\t\tif(value.length < Number(options)){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n\t/**\n\t * Checks if the field is less than x characters long.\n \t * @param string value\n \t * @param integer value\n\t */\n\t$.fn.validate.maxlength = function(value, options) {\n\t\tif(value.length > Number(options)){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n\t/**\n\t * Checks if the field only contains letters.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.alpha = function(value) {\n\t\tvar regex = /^([a-z])+$/i;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the field only contains alpha-numeric characters.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.alphanumeric = function(value) {\n\t\tvar regex = /^([a-z0-9])+$/i;\n\t\treturn !regex.test(value);\n\t};\n\t\t\n\t/**\n\t * Checks if the field is numeric.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.numeric = function(value) {\n\t\tvar regex = /^[\\-+]?[0-9]*\\.?[0-9]+$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the field is integer.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.integer = function(value) {\n\t\tvar regex = /^[\\-+]?[0-9]+$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the field is natrual.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.natrual = function(value) {\n\t\tvar regex = /^[0-9]+$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the field is decimal.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.decimal = function(value) {\n\t\tvar regex = /^[\\-+]?[0-9]+\\.[0-9]+$/;\n\t\treturn !regex.test(value);\n\t};\n\t\t\n\t/**\n\t * Checks if the numeric value is between two values.\n\t * \n \t * @param string value\n \t * @param integer value\n\t */\n\t$.fn.validate.between = function(value, options) {\n\t\tvar minmax = options.split('-');\n\t\tif(value < Number(minmax[0])){\n\t\t\treturn true;\n\t\t}\n\t\tif(value > Number(minmax[1])){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n\t/**\n\t * Checks if the value matches with the field.\n\t * \n \t * @param string value\n \t * @param string options\n\t */\n\t$.fn.validate.matches = function(value, options) {\n\t\tvar other = $(options).val();\n\t\tif(value !== other){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n\t/**\n\t * Checks if the value is a valid email.\n\t * http://stackoverflow.com/questions/46155/validate-email-address-in-javascript\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.email = function(value) {\n\t\tvar regex = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the value is a valid url.\n\t * http://stackoverflow.com/questions/1303872/trying-to-validate-url-using-javascript\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.url = function(value) {\n\t\tvar regex = /^(http|https):\/\/(([a-zA-Z0-9$\\-_.+!*'(),;:&=]|%[0-9a-fA-F]{2})+@)?(((25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])(\\.(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])){3})|localhost|([a-zA-Z0-9\\-\À-\ſ]+\\.)+([a-zA-Z]{2,}))(:[0-9]+)?(\/(([a-zA-Z0-9$\\-_.+!*'(),;:@&=]|%[0-9a-fA-F]{2})*(\/([a-zA-Z0-9$\\-_.+!*'(),;:@&=]|%[0-9a-fA-F]{2})*)*)?(\\?([a-zA-Z0-9$\\-_.+!*'(),;:@&=\/?]|%[0-9a-fA-F]{2})*)?(\\#([a-zA-Z0-9$\\-_.+!*'(),;:@&=\/?]|%[0-9a-fA-F]{2})*)?)?$/;;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the value is a valid ip.\n\t * http://stackoverflow.com/questions/106179/regular-expression-to-match-hostname-or-ip-address \n\t *\n \t * @param string value\n\t */\n\t$.fn.validate.ip = function(value) {\n\t\tvar regex = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the value is a valid time.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.time = function(value) {\n\t\tvar regex = /^([0]\\d|[1][0-2]):([0-5]\\d)\\s?(?:AM|PM)$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the value is a valid date.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.date = function(value) {\n\t\tvar regex = /^\\d{2}[./-]\\d{2}[./-]\\d{4}$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the value is a valid credit card number.\n\t * \n \t * @param string value\n \t * @param string options\n\t */\n\t$.fn.validate.cc = function(value, options) {\n\t\tvar cc = [\n\t\t\t/^4\\d{3}-?\\d{4}-?\\d{4}-?\\d{4}$/, // Visa\n\t\t\t/^5[1-5]\\d{2}-?\\d{4}-?\\d{4}-?\\d{4}$/, // Mastercard\n\t\t\t/^6011-?\\d{4}-?\\d{4}-?\\d{4}$/, // Discover\n\t\t\t/^3[4,7]\\d{13}$/, // American Express\n\t\t\t/^3[0,6,8]\\d{12}$/ // Diners\n\t\t];\n\t\t\n\t\t// If options is not set check with all regex\t\t\n\t\tif(options.length === 0){\n\t\t\tvar valid = false;\n\t\t\tfor(var i = 0; i < cc.length; i++){\n\t\t\t\tif(cc[i].test(value)){\n\t\t\t\t\tvalid = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(valid === false){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tvar regex;\n\t\t\tif(options === \"visa\"){\n\t\t\t\tregex = cc[0];\n\t\t\t}\n\t\t\telse if(options === \"mastercard\"){\n\t\t\t\tregex = cc[1];\n\t\t\t}\n\t\t\telse if(options === \"discover\"){\n\t\t\t\tregex = cc[2];\n\t\t\t}\n\t\t\telse if(options === \"amex\"){\n\t\t\t\tregex = cc[3];\n\t\t\t}\n\t\t\telse if(options === \"diners\"){\n\t\t\t\tregex = cc[4];\n\t\t\t} \n\t\t\t\n\t\t\treturn !regex.test(value);\n\t\t}\n\t\t\n\t\t// Remove all dashes for the checksum\n\t\tvalue = value.split(\"-\").join(\"\");\n\t\t\n\t\t// Add even digits in even length strings or odd digits in odd length strings.\n\t\tvar checksum = 0;\n\t\tfor (var i=(2-(value.length % 2)); i<=value.length; i+=2) {\n\t\t\tchecksum += parseInt(value.charAt(i-1),10);\n\t\t}\n\t\t// Analyze odd digits in even length strings or even digits in odd length strings.\n\t\tfor (var i=(value.length % 2) + 1; i<value.length; i+=2) {\n\t\t\tvar digit = parseInt(value.charAt(i-1),10) * 2;\n\t\t\tif (digit < 10) { \n\t\t\t\tchecksum += digit; \n\t\t\t} \n\t\t\telse { \n\t\t\t\tchecksum += (digit-9); \n\t\t\t}\n\t\t}\n\t\treturn ((checksum % 10) !== 0);\n\t};\n\t\t\n})(jQuery, window);",
                "new_contents":"/*\n* Form Validation 1.1, jQuery plugin\n* Repository: http://github.com/seinoxygen/jquery-validation\n*\n* Copyright(c) 2014, Pablo Cornehl\n* http://www.seinoxygen.com\n*\n* Licensed under the MIT License\n*/\n(function($, window, undefined){      \n\t$.fn.validate = function(options) {\n\t\t\n\t\t// Default config\n\t\tvar defaults = {\n\t\t\tforce: false,\n\t\t\tlive: true,\n\t\t\twrapper: 'jqv-',\n\t\t\tformHandler: '',\n\t\t\tonValid: function(element){}, // Called when the field is valid\n\t\t\tonInvalid: function(element, error){}, // Called when the field is invalid\n\t\t\tonSuccess: function(){}, // Called when all the fields were validated correctly\n\t\t\tonError: function(){} // Called when at least one field has an error\n\t\t};\n\t\t\n\t\t// Update all configs\n\t\toptions = $.extend(true, {}, defaults, options);\n\t\t\n\t\tvar is_valid = true;\n\t\tvar checked = false;\n\t\t\n\t\t// Check all fields\n\t\tthis.each(function() {\n\t\t\tif(options.force === true){\n\t\t\t\tvar error = $.fn.validate.check($(this), options);\n\t\t\t\tif(error === true){\n\t\t\t\t\tis_valid = false;\n\t\t\t\t}\n\t\t\t\tchecked = true;\n\t\t\t}\n\t\t\t\n\t\t\tif(options.live === true){\n\t\t\t\t// For textboxes and textareas.\n\t\t\t\t$(this).keyup(function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t// Ignore enter\n\t\t\t\t\tif (e.which === 13) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar error = $.fn.validate.check($(this), options);\n\t\t\t\t\tif(error === true){\n\t\t\t\t\t\tis_valid = false;\n\t\t\t\t\t}\n\t\t\t\t\tchecked = true;\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// For radio, checkbox and selects.\n\t\t\t\tvar type = $(this).attr(\"type\");\t\t\t\n\t\t\t\tif ($(this).is('select') || type === \"radio\" || type === \"checkbox\"){\n\t\t\t\t\t$(this).change(function() {\n\t\t\t\t\t\tvar error = $.fn.validate.check($(this), options);\n\t\t\t\t\t\tif(error === true){\n\t\t\t\t\t\t\tis_valid = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tchecked = true;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t\n\t\t// If it has been checked in one way, and fields are valid then call the success callback.\n\t\tif (is_valid === true && checked === true){\n\t\t\toptions.onSuccess.call(this);\n\t\t}\n\t\t\n\t\t// If it has been checked and some field throws error then call the error callback.\n\t\tif (is_valid === false && checked === true){\n\t\t\toptions.onError.call(this);\n\t\t}\n\t\t\n\t\t// If everything is valid and form handles has been declared, then submit.\n\t\tif(is_valid === true && options.formHandler.length > 0){\n\t\t\t$(options.formHandler).submit();\n\t\t}\n\t\t\n\t\treturn this;\n\t};\n\t\t\n\t/**\n\t * Run the rules in the field.\n\t * \n \t * @param object value\n \t * @param object value\n\t */\n\t$.fn.validate.check = function(element, options) {\n\t\t\n\t\t// If attribute is not defined return false because there is no rules to apply\n\t\tif (typeof element.data('rules') == \"undefined\") {\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t// Explode rules\t\t\t\n\t\tvar rules = element.data('rules').split('|');\n\t\t\t\t\n\t\tvar error = false;\n\t\tfor (var i = 0; i < rules.length; i++) {\n\t\t\tvar rule = rules[i];\n\t\t\tvar regex = /(.*?)\\[(.*?)\\]/;\n\t\t\t\t\t\t\t\t\t\t\n\t\t\tvar func = rule;\n\t\t\tvar filter = '';\n\t\t\t\t\n\t\t\t// Check if arguments are enclosed in brackets\t\t\t\n\t\t\tvar groups = regex.exec(rule);\t\n\t\t\tif(groups !== null){\n\t\t\t\tfunc = groups[1];\n\t\t\t\tfilter = groups[2];\n\t\t\t}\n\t\t\t\t\t\n\t\t\t// If the function exists call it.\t\t\t\n\t\t\tif (typeof $.fn.validate[func] != \"undefined\") {\n\t\t\t\t\n\t\t\t\tvar value = element.val();\n\t\t\t\t\n\t\t\t\t// Verify the tipe of element. If they're radios or checkboxes look for checkeds\n\t\t\t\tvar type = element.attr(\"type\");\n\t\t\t\tif (type == \"radio\" || type == \"checkbox\"){\n\t\t\t\t\t// lenght is obtained ahead in the rules\n\t\t\t\t\tvalue = $('input[name=' + element.attr(\"name\") + ']:checked');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\terror = $.fn.validate[func](value, filter);\n\t\t\t\tif(error === true){\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Apply the correct css to the field.\n\t\tif(error === true){\n\t\t\t\n\t\t\tvar field_label = $.fn.validate.fieldlabel(element);\n\t\t\t\n\t\t\t// Call the invalid function\n\t\t\tvar parts = filter.split('-');\n\t\t\t\n\t\t\tif(func == \"matches\"){\n\t\t\t\tparts[0] = $.fn.validate.fieldlabel($(parts[0]));\n\t\t\t}\n\t\t\t\n\t\t\tvar msg = validation_lang[func];\n\t\t\t\n\t\t\t// If exists a custom message use it.\n\t\t\tif (typeof element.data('message') != \"undefined\") {\n\t\t\t\tmsg = element.data('message');\n\t\t\t}\n\t\t\t\n\t\t\tmsg = msg.replace(\"%s\", field_label).replace(\"%k\", parts[0]).replace(\"%n\", parts[1]);\n\t\t\t\n\t\t\toptions.onInvalid.call(this, element, msg);\n\t\t\t$(element).removeClass(options.wrapper + 'valid').addClass(options.wrapper + 'invalid');\n\t\t}\n\t\telse{\n\t\t\toptions.onValid.call(this, element);\n\t\t\t$(element).removeClass(options.wrapper + 'invalid').addClass(options.wrapper + 'valid');\n\t\t}\n\t\treturn error;\n\t};\n\t\n\t$.fn.validate.fieldlabel = function(element){\n\t\tvar field_label = '';\n\t\t// If is set the field title use it\n\t\tif (typeof element.attr('title') != \"undefined\") {\n\t\t\tfield_label = element.attr('title');\n\t\t}\n\t\t// If is set the data attribute name use it\n\t\tif (typeof element.data('name') != \"undefined\") {\n\t\t\tfield_label = element.data('name');\n\t\t}\n\t\t\n\t\treturn field_label;\n\t};\n\t\t\n\t/**\n\t * Checks if the field is filled.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.required = function(value) {\n\t\tif(value.length === 0){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\t\n\t};\n\t\n\t/**\n\t * Checks if the field is not zero.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.nozero = function(value) {\n\t\tif(Number(value) === 0){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\t\n\t};\n\t\t\n\t/**\n\t * Checks if the field is x characters long.\n\t * \n \t * @param string value\n \t * @param integer value\n\t */\n\t$.fn.validate.exactlength = function(value, options) {\n\t\tif(value.length !== Number(options)){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n\t/**\n\t * Checks if the field is at least x characters long.\n\t * \n \t * @param string value\n \t * @param integer value\n\t */\n\t$.fn.validate.minlength = function(value, options) {\n\t\tif(value.length < Number(options)){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n\t/**\n\t * Checks if the field is less than x characters long.\n \t * @param string value\n \t * @param integer value\n\t */\n\t$.fn.validate.maxlength = function(value, options) {\n\t\tif(value.length > Number(options)){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n\t/**\n\t * Checks if the field only contains letters.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.alpha = function(value) {\n\t\tvar regex = /^([a-z])+$/i;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the field only contains alpha-numeric characters.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.alphanumeric = function(value) {\n\t\tvar regex = /^([a-z0-9])+$/i;\n\t\treturn !regex.test(value);\n\t};\n\t\t\n\t/**\n\t * Checks if the field is numeric.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.numeric = function(value) {\n\t\tvar regex = /^[\\-+]?[0-9]*\\.?[0-9]+$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the field is integer.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.integer = function(value) {\n\t\tvar regex = /^[\\-+]?[0-9]+$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the field is natrual.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.natrual = function(value) {\n\t\tvar regex = /^[0-9]+$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the field is decimal.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.decimal = function(value) {\n\t\tvar regex = /^[\\-+]?[0-9]+\\.[0-9]+$/;\n\t\treturn !regex.test(value);\n\t};\n\t\t\n\t/**\n\t * Checks if the numeric value is between two values.\n\t * \n \t * @param string value\n \t * @param integer value\n\t */\n\t$.fn.validate.between = function(value, options) {\n\t\tvar minmax = options.split('-');\n\t\tif(value < Number(minmax[0])){\n\t\t\treturn true;\n\t\t}\n\t\tif(value > Number(minmax[1])){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n\t/**\n\t * Checks if the value matches with the field.\n\t * \n \t * @param string value\n \t * @param string options\n\t */\n\t$.fn.validate.matches = function(value, options) {\n\t\tvar other = $(options).val();\n\t\tif(value !== other){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n\t/**\n\t * Checks if the value is a valid email.\n\t * http://stackoverflow.com/questions/46155/validate-email-address-in-javascript\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.email = function(value) {\n\t\tvar regex = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the value is a valid url.\n\t * http://stackoverflow.com/questions/1303872/trying-to-validate-url-using-javascript\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.url = function(value) {\n\t\tvar regex = /^(http|https):\/\/(([a-zA-Z0-9$\\-_.+!*'(),;:&=]|%[0-9a-fA-F]{2})+@)?(((25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])(\\.(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])){3})|localhost|([a-zA-Z0-9\\-\À-\ſ]+\\.)+([a-zA-Z]{2,}))(:[0-9]+)?(\/(([a-zA-Z0-9$\\-_.+!*'(),;:@&=]|%[0-9a-fA-F]{2})*(\/([a-zA-Z0-9$\\-_.+!*'(),;:@&=]|%[0-9a-fA-F]{2})*)*)?(\\?([a-zA-Z0-9$\\-_.+!*'(),;:@&=\/?]|%[0-9a-fA-F]{2})*)?(\\#([a-zA-Z0-9$\\-_.+!*'(),;:@&=\/?]|%[0-9a-fA-F]{2})*)?)?$/;;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the value is a valid ip.\n\t * http://stackoverflow.com/questions/106179/regular-expression-to-match-hostname-or-ip-address \n\t *\n \t * @param string value\n\t */\n\t$.fn.validate.ip = function(value) {\n\t\tvar regex = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the value is a valid time.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.time = function(value) {\n\t\tvar regex = /^([0]\\d|[1][0-2]):([0-5]\\d)\\s?(?:AM|PM)$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the value is a valid date.\n\t * \n \t * @param string value\n\t */\n\t$.fn.validate.date = function(value) {\n\t\tvar regex = /^\\d{2}[./-]\\d{2}[./-]\\d{4}$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the value is a valid credit card number.\n\t * \n \t * @param string value\n \t * @param string options\n\t */\n\t$.fn.validate.cc = function(value, options) {\n\t\tvar cc = [\n\t\t\t/^4\\d{3}-?\\d{4}-?\\d{4}-?\\d{4}$/, // Visa\n\t\t\t/^5[1-5]\\d{2}-?\\d{4}-?\\d{4}-?\\d{4}$/, // Mastercard\n\t\t\t/^6011-?\\d{4}-?\\d{4}-?\\d{4}$/, // Discover\n\t\t\t/^3[4,7]\\d{13}$/, // American Express\n\t\t\t/^3[0,6,8]\\d{12}$/ // Diners\n\t\t];\n\t\t\n\t\t// If options is not set check with all regex\t\t\n\t\tif(options.length === 0){\n\t\t\tvar valid = false;\n\t\t\tfor(var i = 0; i < cc.length; i++){\n\t\t\t\tif(cc[i].test(value)){\n\t\t\t\t\tvalid = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(valid === false){\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tvar regex;\n\t\t\tif(options === \"visa\"){\n\t\t\t\tregex = cc[0];\n\t\t\t}\n\t\t\telse if(options === \"mastercard\"){\n\t\t\t\tregex = cc[1];\n\t\t\t}\n\t\t\telse if(options === \"discover\"){\n\t\t\t\tregex = cc[2];\n\t\t\t}\n\t\t\telse if(options === \"amex\"){\n\t\t\t\tregex = cc[3];\n\t\t\t}\n\t\t\telse if(options === \"diners\"){\n\t\t\t\tregex = cc[4];\n\t\t\t} \n\t\t\t\n\t\t\treturn !regex.test(value);\n\t\t}\n\t\t\n\t\t// Remove all dashes for the checksum\n\t\tvalue = value.split(\"-\").join(\"\");\n\t\t\n\t\t// Add even digits in even length strings or odd digits in odd length strings.\n\t\tvar checksum = 0;\n\t\tfor (var i=(2-(value.length % 2)); i<=value.length; i+=2) {\n\t\t\tchecksum += parseInt(value.charAt(i-1),10);\n\t\t}\n\t\t// Analyze odd digits in even length strings or even digits in odd length strings.\n\t\tfor (var i=(value.length % 2) + 1; i<value.length; i+=2) {\n\t\t\tvar digit = parseInt(value.charAt(i-1),10) * 2;\n\t\t\tif (digit < 10) { \n\t\t\t\tchecksum += digit; \n\t\t\t} \n\t\t\telse { \n\t\t\t\tchecksum += (digit-9); \n\t\t\t}\n\t\t}\n\t\treturn ((checksum % 10) !== 0);\n\t};\n\t\t\n})(jQuery, window);",
                "subject": "Added option for checking \"on live\"",
                "message": "Added option for checking \"on live\"\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "seinoxygen/jquery-validation"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10242,
            "row": {
                "commit": "9230c08b50d7686d2c63b1c0ae5631229489c6f2",
                "old_file": "test/manifest/index.js",
                "new_file": "test/manifest/index.js",
                "old_contents": "\nvar manifest = require('../../manifest');\n\nrequire('colors');\n\nvar diff = require('diff');\nvar should = require('should');\n\nvar path = require('path');\nvar fs = require('fs');\nvar readFile = fs.readFileSync;\nvar readdir = fs.readdirSync;\n\nvar fixturesDir = path.resolve(__dirname, 'fixtures');\n\nvar cfgs = readdir(fixturesDir).sort().map(function (filename) {\n\tfilename = path.resolve(fixturesDir, filename);\n\treturn {\n\t\tfilename: path.relative(__dirname, filename),\n\t\tfullFilename: filename,\n\t\tpackage: require(filename)\n\t};\n});\n\ndescribe(\"Cases:\", function () {\n\tcfgs.forEach(function (cfg) {\n\t\tit(cfg.filename, function () {\n\t\t\tvar invalidPackage = cfg.filename.indexOf('INVALID') >= 0;\n\n\t\t\tif (invalidPackage) {\n\t\t\t\t(function () {\n\t\t\t\t\tbuild(cfg.filename, cfg.fullFilename, cfg.package, invalidPackage);\n\t\t\t\t}).should.throw();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tbuild(cfg.filename, cfg.fullFilename, cfg.package, invalidPackage);\n\t\t\t}\n\t\t});\n\t});\n});\n\nfunction build(filename, fullFilename, pkg, invalidPackage) {\n\n\tmanifest.validatePackage(pkg);\n\n\tif (invalidPackage) {\n\t\treturn;\n\t}\n\n\tvar expectedFilename = fullFilename\n\t.replace('fixtures', 'expected')\n\t.replace('package', 'manifest')\n\t.replace('.json', '');\n\n\tvar result = manifest.buildFromPackage(pkg).trim();\n\n\tvar expected = readFile(expectedFilename, 'utf8').trim()\n\t.replace('$YEAR$', new Date().getFullYear());\n\n\tvar resultLines = result.split('\\n');\n\tvar expectedLines = expected.split('\\n');\n\n\tresultLines.forEach(function (line, i) {\n\t\tline.should.be.eql(expectedLines[i]);\n\t});\n\n\t/*var err;\n\n\tif (result !== expected) {\n\n\t\terr = new Error(\"Wrong results for \" + filename);\n\t\terr.data = [];\n\n\t\terr.data.push(\"\\n\");\n\t\terr.data.push(filename.green + \"\\n\");\n\t\terr.data.push(path.relative(__dirname, expectedFilename).red + \"\\n\");\n\t\terr.data.push(\"\\n\");\n\n\t\tdiff.diffLines(expected, result).forEach(function(part){\n\t\t\t// green for additions, red for deletions\n\t\t\t// grey for common parts\n\t\t\tvar color =\n\t\t\tpart.added ? 'green' :\n\t\t\tpart.removed ? 'red' :\n\t\t\t'white';\n\n\t\t\tif (part.added || part.removed) {\n\t\t\t\terr.data.push(expose(part.value, color));\n\t\t\t}\n\t\t\telse {\n\t\t\t\terr.data.push(part.value[color]);\n\t\t\t}\n\t\t});\n\n\t\terr.data.push(\"\\n\");\n\t\terr.data.push(\"\\n\");\n\n\t\tthrow err;\n\t}*/\n}\n\nfunction expose(line, color) {\n\tline = replace(line, ' ', '·', color);\n\tline = replace(line, '\\t', '----', color);\n\treturn line;\n}\n\nfunction replace(line, from, to, color) {\n\treturn line.split(from).map(function (piece, index) {\n\t\tif (index) {\n\t\t\treturn to.grey + piece[color];\n\t\t}\n\t\telse {\n\t\t\treturn piece[color];\n\t\t}\n\t}).join('');\n}\n",
                "new_contents": "\nvar manifest = require('../../manifest');\n\nvar diff = require('diff');\nvar should = require('should');\n\nvar path = require('path');\nvar fs = require('fs');\n\ndescribe(\"Cases:\", function () {\n\tvar fixturesDir = path.resolve(__dirname, 'fixtures');\n\n\tfs.readdirSync(fixturesDir).forEach(function (filename) {\n\t\tvar fullname = path.resolve(fixturesDir, filename);\n\t\tvar invalidPackage = filename.indexOf('INVALID') >= 0;\n\n\t\tit(filename, function () {\n\t\t\tvar pkg = JSON.parse(fs.readFileSync(fullname, 'utf8'));\n\n\t\t\t// Validation\n\n\t\t\tif (invalidPackage) {\n\t\t\t\tvalidate.should.throw();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvalidate();\n\t\t\t}\n\n\t\t\t// Building\n\n\t\t\tbuild(filename, fullname, pkg);\n\n\t\t\tfunction validate() {\n\t\t\t\tmanifest.validatePackage(pkg);\n\t\t\t}\n\t\t});\n\t});\n});\n\nfunction build(filename, fullname, pkg) {\n\tvar expectedFilename = fullname\n\t.replace('fixtures', 'expected')\n\t.replace('package', 'manifest')\n\t.replace('.json', '');\n\n\tvar result = manifest.buildFromPackage(pkg).trim();\n\n\tvar expected = fs.readFileSync(expectedFilename, 'utf8')\n\t.trim()\n\t.replace('$YEAR$', new Date().getFullYear());\n\n\tvar resultLines = result.split('\\n');\n\tvar expectedLines = expected.split('\\n');\n\n\tresultLines.forEach(function (line, i) {\n\t\tline.should.be.eql(expectedLines[i]);\n\t});\n}\n",
                "subject": "More radical cleanup",
                "message": "More radical cleanup\n",
                "lang": "JavaScript",
                "license": "lgpl-2.1",
                "repos": "titanium-forks/smclab.titaniumifier,code4ape/titaniumifier,smclab/titaniumifier,yomybaby/titaniumifier"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10243,
            "row": {
                "commit": "dbcf68264585edef0285ce206c62597c023533b2",
                "old_file": "jquery.validation.js",
                "new_file": "jquery.validation.js",
                "old_contents": "(function($) {   \n    var plugin = $(this);\n    \n\t$.fn.validate = function(options) {\n\t\t// Update all configs\n\t\t var settings = $.extend({\n\t\t\terror: '#EB4847',\n\t\t\tsuccess: '#63C76A'\n\t\t}, options);\n\t\t\n\t\t// Check all fields\n\t\t$(this).each(function() {\n\t\t\t\n\t\t\t// On key up check all rules of the field\n\t\t\t$(this).keyup(function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\t\n\t\t\t\t// Explode rules\t\t\t\t\n\t\t\t\tvar rules = $(this).data('rules').split('|');\n\t\t\t\t\n\t\t\t\tvar error = false;\n\t\t\t\tfor (var i = 0; i < rules.length; i++) {\n\t\t\t\t\tvar rule = rules[i];\n\t\t\t\t\tvar regex = /(.*?)\\[(.*?)\\]/;\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\tvar func = rule;\n\t\t\t\t\tvar options = '';\n\t\t\t\t\t\n\t\t\t\t\t// Check if arguments are enclosed in brackets\t\t\t\n\t\t\t\t\tvar groups = regex.exec(rule);\t\n\t\t\t\t\tif(groups !== null){\n\t\t\t\t\t\tfunc = groups[1];\n\t\t\t\t\t\toptions = groups[2];\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// If the function exists call it.\t\t\t\n\t\t\t\t\tif (typeof(plugin[func]) !== \"undefined\") {\n\t\t\t\t\t\terror = plugin[func]($(this).val(), options);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Apply the correct css to the field.\n\t\t\t\tif(error){\n\t\t\t\t\t$(this).css('border-color', settings.error);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\t$(this).css('border-color', settings.success);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\t\t\t\n\t\treturn;\n\t};\n\t\n\t/**\n\t * Checks if the field is filled.\n \t * @param string value\n\t */\n\tplugin.required = function(value) {\n\t\tif(value.length == 0){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\t\n\t};\n\t\n\t/**\n\t * Checks if the field is x characters long.\n \t * @param string value\n \t * @param integer value\n\t */\n\tplugin.exactlength = function(value, options) {\n\t\tif(value.length == options){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n\t/**\n\t * Checks if the field is at least x characters long.\n \t * @param string value\n \t * @param integer value\n\t */\n\tplugin.minlength = function(value, options) {\n\t\tif(value.length < options){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n\t/**\n\t * Checks if the field is less than x characters long.\n \t * @param string value\n \t * @param integer value\n\t */\n\tplugin.maxlength = function(value, options) {\n\t\tif(value.length > options){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\t\n\t/**\n\t * Checks if the field is numeric.\n \t * @param string value\n\t */\n\tplugin.numeric = function(value) {\n\t\tvar regex = /^[\\-+]?[0-9]*\\.?[0-9]+$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the numeric value is between two values.\n \t * @param string value\n \t * @param integer value\n\t */\n\tplugin.between = function(value, options) {\n\t\tvar minmax = options.split('-');\n\t\tif(value < minmax[0]){\n\t\t\treturn true;\n\t\t}\n\t\tif(value > minmax[1]){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n}(jQuery));",
                "new_contents": "(function($) {   \n    var plugin = $(this);\n    \n\t$.fn.validate = function(options) {\n\t\t// Update all configs\n\t\t var settings = $.extend({\n\t\t\terror: '#EB4847',\n\t\t\tsuccess: '#63C76A'\n\t\t}, options);\n\t\t\n\t\t// Check all fields\n\t\t$(this).each(function() {\n\t\t\t\n\t\t\t// On key up check all rules of the field\n\t\t\t$(this).keyup(function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\t\n\t\t\t\t// Explode rules\t\t\t\t\n\t\t\t\tvar rules = $(this).data('rules').split('|');\n\t\t\t\t\n\t\t\t\tvar error = false;\n\t\t\t\tfor (var i = 0; i < rules.length; i++) {\n\t\t\t\t\tvar rule = rules[i];\n\t\t\t\t\tvar regex = /(.*?)\\[(.*?)\\]/;\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\tvar func = rule;\n\t\t\t\t\tvar options = '';\n\t\t\t\t\t\n\t\t\t\t\t// Check if arguments are enclosed in brackets\t\t\t\n\t\t\t\t\tvar groups = regex.exec(rule);\t\n\t\t\t\t\tif(groups !== null){\n\t\t\t\t\t\tfunc = groups[1];\n\t\t\t\t\t\toptions = groups[2];\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// If the function exists call it.\t\t\t\n\t\t\t\t\tif (typeof(plugin[func]) !== \"undefined\") {\n\t\t\t\t\t\terror = plugin[func]($(this).val(), options);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Apply the correct css to the field.\n\t\t\t\tif(error){\n\t\t\t\t\t$(this).css('border-color', settings.error);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\t$(this).css('border-color', settings.success);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\t\t\t\n\t\treturn;\n\t};\n\t\n\t/**\n\t * Checks if the field is filled.\n \t * @param string value\n\t */\n\tplugin.required = function(value) {\n\t\tif(value.length == 0){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\t\n\t};\n\t\n\t/**\n\t * Checks if the field is x characters long.\n \t * @param string value\n \t * @param integer value\n\t */\n\tplugin.exactlength = function(value, options) {\n\t\tif(value.length == options){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n\t/**\n\t * Checks if the field is at least x characters long.\n \t * @param string value\n \t * @param integer value\n\t */\n\tplugin.minlength = function(value, options) {\n\t\tif(value.length < options){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n\t/**\n\t * Checks if the field is less than x characters long.\n \t * @param string value\n \t * @param integer value\n\t */\n\tplugin.maxlength = function(value, options) {\n\t\tif(value.length > options){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\t\n\t/**\n\t * Checks if the field is numeric.\n \t * @param string value\n\t */\n\tplugin.numeric = function(value) {\n\t\tvar regex = /^[\\-+]?[0-9]*\\.?[0-9]+$/;\n\t\treturn !regex.test(value);\n\t};\n\t\n\t/**\n\t * Checks if the numeric value is between two values.\n \t * @param string value\n \t * @param integer value\n\t */\n\tplugin.between = function(value, options) {\n\t\tvar minmax = options.split('-');\n\t\tif(value >= minmax[0]){\n\t\t\treturn true;\n\t\t}\n\t\tif(value <= minmax[1]){\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\t\n\t};\n\t\n}(jQuery));",
                "subject": "Fixed between rule",
                "message": "Fixed between rule\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "seinoxygen/jquery-validation"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10244,
            "row": {
                "commit": "9db57c926914a5d828ba1561f86cba6c2eb98eef",
                "old_file": "js-src/react/main.js",
                "new_file": "js-src/react/main.js",
                "old_contents": "import React from 'react';\nimport ReactDOM from 'react-dom';\nimport {Navbar, Nav, NavItem, NavbarBrand, Button, ButtonToolbar, Grid, Row, Col,\nFormGroup, DropdownButton, Checkbox, MenuItem, ButtonGroup, FormControl, ControlLabel, Collapse} from 'react-bootstrap';\nimport 'whatwg-fetch';\n\nclass GakuseiNav extends React.Component {\n    constructor(props) {\n        super(props);\n    }\n    eventHandler(eventKey){\n        console.log(\"eventkey selected: \" + eventKey)\n        if (eventKey === 1) {\n            this.props.updater('play')\n        } else if (eventKey === 2) {\n            this.props.updater('about');\n        } else if (eventKey === 3) {\n            this.props.updater('nuggetsearch');\n        }\n    }\n    render() {\n        return (\n            <Navbar onSelect={this.eventHandler.bind(this)} inverse collapseOnSelect>\n                <Navbar.Header>\n                    <NavbarBrand>\n                        <span><a href=\"#\"><img height={'100%'}\n                                               src=\"/img/temp_gakusei_logo3.png\"\n                                               alt=\"Gakusei logo\"/></a>Gakusei</span>\n                    </NavbarBrand>\n                    <Navbar.Toggle />\n                </Navbar.Header>\n                <Navbar.Collapse>\n                    <Nav>\n                    <NavItem eventKey={1} href=\"#\">Play</NavItem>\n                    <NavItem eventKey={3} href=\"#\">NuggetSearch</NavItem>\n                    {/*<NavDropdown eventKey={3} title=\"Dropdown\" id=\"basic-nav-dropdown\">*/}\n                    {/*<MenuItem eventKey={3.1}>Action</MenuItem>*/}\n                    {/*<MenuItem eventKey={3.2}>Another action</MenuItem>*/}\n                    {/*<MenuItem eventKey={3.3}>Something else here</MenuItem>*/}\n                    {/*<MenuItem divider />*/}\n                    {/*<MenuItem eventKey={3.3}>Separated link</MenuItem>*/}\n                    {/*</NavDropdown>*/}\n                    </Nav>\n                    <Nav pullRight>\n                        <NavItem eventKey={2} href=\"#\">About</NavItem>\n                        <Navbar.Text>\n                            <Navbar.Link href=\"/logout\">Logout</Navbar.Link>\n                        </Navbar.Text>\n                    </Nav>\n                </Navbar.Collapse>\n            </Navbar>\n        );\n    }\n}\n\nclass AnswerButton extends React.Component {\n    render() {\n        return (\n            <Button bsStyle={this.props.buttonStyle}\n               bsSize=\"large\" block\n               onClick={this.props.onAnswerClick.bind(this, this.props.label)}\n               disabled = {this.props.disableButton}>\n               {this.props.buttonNumber + \". \" + this.props.label}\n            </Button>\n        );\n    }\n}\n\nclass NextButton extends React.Component {\n    render() {\n        return(\n            <Button bsStyle=\"info\" onClick={this.props.onMagicClick}>\n                Next Question (Enter)\n            </Button>\n        );\n    }\n}\n\nclass Gameplay extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {question: '',\n            answerReturn: '',\n            correctAlt: '',\n            randomOrderAlt: ['', '', '', ''],\n            buttonStyles: ['default', 'default', 'default', 'default'],\n            buttonDisabled: false\n        };\n        this.fetchQuestion = this.fetchQuestion.bind(this);\n        this.checkAnswer = this.checkAnswer.bind(this);\n    }\n\n    fetchQuestion() {\n        fetch('/api/question/', {credentials: \"same-origin\"})\n            .then(response => response.json())\n            .then(json =>\n                this.setState({ answerReturn: '',\n                                question: json.question,\n                                correctAlt: json.correctAlternative,\n                                randomOrderAlt: this.randomizeOrder([json.alternative1,\n                                                                     json.alternative2,\n                                                                     json.alternative3,\n                                                                     json.correctAlternative]),\n                                buttonStyles: ['default', 'default', 'default', 'default'],\n                                buttonDisabled: false\n                                })\n            ).catch(ex => console.log('json parsing failed', ex))\n    }\n\n    randomizeOrder(array) {\n        let i = array.length - 1;\n        for (; i > 0; i--) {\n            const j = Math.floor(Math.random() * (i + 1));\n            const temp = array[i];\n            array[i] = array[j];\n            array[j] = temp;\n        };\n        return array;\n    }\n\n    checkAnswer(answer) {\n        var newButtonStyles = [];\n        if(answer === this.state.correctAlt){\n            newButtonStyles = this.state.randomOrderAlt.map( (word) => (word === answer) ? 'success' : 'default');\n        }else{\n            newButtonStyles = this.state.randomOrderAlt.map( (word) => {\n                if(word === answer){\n                    return \"danger\";\n                }else if(word === this.state.correctAlt){\n                    return \"success\";\n                }else{\n                    return \"default\";\n                }\n            });\n        }\n\n        this.setState({\n            buttonDisabled: true,\n            buttonStyles: newButtonStyles\n        });\n    }\n\n    componentDidMount() {\n        this.fetchQuestion();\n        window.addEventListener(\"keydown\", this.onKeys.bind(this));\n    }\n\n    onKeys(event){\n        var keyDown = event.key;\n        if(keyDown === 'Enter'){\n            this.fetchQuestion();\n        }else if(keyDown === '1' && !this.state.buttonDisabled){\n            this.checkAnswer(this.state.randomOrderAlt[0]);\n        }else if(keyDown === '2' && !this.state.buttonDisabled){\n            this.checkAnswer(this.state.randomOrderAlt[1]);\n        }else if(keyDown === '3' && !this.state.buttonDisabled){\n            this.checkAnswer(this.state.randomOrderAlt[2]);\n        }else if(keyDown === '4' && !this.state.buttonDisabled){\n            this.checkAnswer(this.state.randomOrderAlt[3]);\n        }\n    }\n\n    render() {\n        return (\n            <div>\n                <Grid>\n                    <Row><h2 className=\"text-center\">{this.state.question}</h2></Row>\n                    <br/>\n                    <Row>\n                        <ButtonToolbar>\n                            <Col xs={5} xsOffset={1} sm={4} smOffset={2} md={3} mdOffset={3}>\n                                <AnswerButton label = {this.state.randomOrderAlt[0]}\n                                    buttonNumber = {1}\n                                    onAnswerClick={this.checkAnswer}\n                                    buttonStyle = {this.state.buttonStyles[0]}\n                                    disableButton = {this.state.buttonDisabled} />\n                            </Col>\n                            <Col xs={5} sm={4} md={3}>\n                                <AnswerButton label = {this.state.randomOrderAlt[1]}\n                                    buttonNumber = {2}\n                                    onAnswerClick={this.checkAnswer}\n                                    buttonStyle = {this.state.buttonStyles[1]}\n                                    disableButton = {this.state.buttonDisabled} />\n                            </Col>\n                        </ButtonToolbar>\n                    </Row>\n                    <br/>\n                    <Row>\n                        <ButtonToolbar>\n                            <Col xs={5} xsOffset={1} sm={4} smOffset={2} md={3} mdOffset={3}>\n                                <AnswerButton label = {this.state.randomOrderAlt[2]}\n                                    buttonNumber = {3}\n                                    onAnswerClick={this.checkAnswer}\n                                    buttonStyle = {this.state.buttonStyles[2]}\n                                    disableButton = {this.state.buttonDisabled} />\n                            </Col>\n                            <Col xs={5} sm={4} md={3}>\n                                <AnswerButton label = {this.state.randomOrderAlt[3]}\n                                    buttonNumber = {4}\n                                    onAnswerClick = {this.checkAnswer}\n                                    buttonStyle = {this.state.buttonStyles[3]}\n                                    disableButton = {this.state.buttonDisabled} />\n                            </Col>\n                        </ButtonToolbar>\n                    </Row>\n                    <br/><br/>\n                    <Row>\n                        <div className=\"text-center\"><NextButton onMagicClick={this.fetchQuestion}/></div>\n                    </Row>\n                    <br/>\n                    <Row>\n                        <div className=\"text-center\">{this.state.answerReturn}</div>\n                    </Row>\n                </Grid>\n            </div>\n        );\n    }\n}\n\nclass AboutPage extends React.Component {\n    render() {\n        return (\n            <div>\n                <br/>\n                <div className=\"text-center\">About page placeholder</div>\n            </div>\n        );\n    }\n}\n\nclass App extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            currentPage : <Gameplay/>\n        }\n    }\n\n    switchPage(newContent) {\n        console.log(\"Updating content root\");\n        if (newContent === 'play') {\n            this.setState({currentPage : <Gameplay/>})\n        }\n        else if (newContent === 'about') {\n            this.setState({currentPage : <AboutPage/>})\n        }\n        else if (newContent === 'nuggetsearch') {\n            this.setState({currentPage : <NuggetSearch/>})\n        }\n    }\n\n    render() {\n        return (\n            <div>\n                <GakuseiNav updater={this.switchPage.bind(this)} />\n                {this.state.currentPage}\n            </div>\n        );\n    }\n}\n\nclass NuggetSearch extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {wordType: '',\n            factType1: '',\n            factType2: '',\n            factType3: '',\n            factType4: '',\n            nuggetList: []\n        };\n        this.updateQueryInput = this.updateQueryInput.bind(this);\n        this.fetchCustomQuery = this.fetchCustomQuery.bind(this);\n    }\n\n    updateQueryInput(event){        \n        if (event.target.id === 'kanjiFactType'){\n            console.log(event.target.id + \": \" + event.target.checked);\n            this.setState({\n                factType1: event.target.checked ? 'kanji' : ''\n            });\n        } else if (event.target.id === 'readingFactType') {\n            console.log(event.target.id + \": \" + event.target.checked);\n            this.setState({\n                factType2: event.target.checked ? 'reading' : ''\n            });\n        } else if (event.target.id === 'writingFactType') {\n            console.log(event.target.id + \": \" + event.target.checked);\n            this.setState({\n                factType3: event.target.checked ? 'writing' : ''\n            });\n        } else if (event.target.id === 'englishFactType') {\n            console.log(event.target.id + \": \" + event.target.checked);\n            this.setState({\n                factType4: event.target.checked ? 'english_translation' : ''\n            });\n        } else if (event.target.id === 'wordType') {\n            console.log(event.target.id + \": \" + event.target.value);\n            this.setState({wordType: event.target.value});            \n        }        \n    }\n\n    fetchCustomQuery(event){\n        var fetchUrl = '/api/filter/nuggets?wordType=' + this.state.wordType \n            + '&factType1=' + this.state.factType1 \n            + '&factType2=' + this.state.factType2 \n            + '&factType3=' + this.state.factType3 \n            + '&factType4=' + this.state.factType4;\n        fetch(fetchUrl, \n            {credentials: \"same-origin\"})\n            .then(response => response.json())\n            .then(json =>\n                this.setState({ \n                    nuggetList: json\n            }))\n            .catch(ex => console.log('json parsing failed', ex));\n        console.log(fetchUrl);\n        //event.preventDefault();\n    }\n\n    render() {\n        return(\n            <div>\n                <QueryInput handleChange={this.updateQueryInput}\n                    handleSubmit={this.fetchCustomQuery}/>\n                <br/>\n                <SearchResults nuggetResults={this.state.nuggetList} />\n            </div>\n        )\n    }\n}\n\nclass QueryInput extends React.Component{\n    constructor(props) {\n        super(props);\n\n        this.handleChange = this.handleChange.bind(this);\n        this.handleSubmit = this.handleSubmit.bind(this);\n    }    \n\n    handleChange(event) {\n        this.props.handleChange(event);\n    }\n\n    handleSubmit(event){\n        this.props.handleSubmit();\n        event.preventDefault();\n    }\n\n    render() {\n        return(\n            <form href=\"#\" onSubmit={this.handleSubmit}>\n                <FormGroup>\n                    <ControlLabel>Query Input</ControlLabel>\n                    <FormControl componentClass=\"select\" id=\"wordType\" \n                    onChange={this.handleChange}>\n                        <option value=''>\n                            Select word type\n                        </option>\n                        <option value='verb'>\n                            Verb\n                        </option>\n                        <option value='adjective'>\n                            Adjective\n                        </option>\n                        <option value='noun'>\n                            Noun\n                        </option>\n                        <option value='adverb'>\n                            Adverb\n                        </option>\n                    </FormControl>                    \n                    {' '}\n                    <Checkbox id=\"kanjiFactType\" inline onChange={this.handleChange}>\n                        Kanji\n                    </Checkbox>\n                    {' '}\n                    <Checkbox id=\"readingFactType\" inline onChange={this.handleChange}>\n                        Japanese reading\n                    </Checkbox>\n                    {' '}\n                    <Checkbox  id=\"writingFactType\" inline onChange={this.handleChange}>\n                        Japanese writing\n                    </Checkbox>\n                    {' '}\n                    <Checkbox id=\"englishFactType\" inline onChange={this.handleChange}>\n                        English translation\n                    </Checkbox>                        \n                </FormGroup>\n                <Button type=\"submit\">\n                  Submit\n                </Button>\n            </form>\n        )\n    }\n}\n\nclass SearchResults extends React.Component{\n\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            factViewToggle: false,\n            expandId: ''\n        };\n\n        this.toggleFactView = this.toggleFactView.bind(this);\n    }\n\n    toggleFactView(nuggetId){\n        this.setState({\n            factViewToggle: !this.state.factViewToggle\n        });\n    }\n\n    render() {\n        return(\n            <div>\n                <NuggetList nuggetResults={this.props.nuggetResults}\n                />\n            </div>\n        )\n    }\n}\n\nfunction NuggetList(props){\n\n    const listRows = props.nuggetResults.map( (nugget) =>\n        <li key={nugget.id}>\n            {\"type: \" + nugget.type\n            + \" // description: \" + nugget.description}\n            <br/>\n            <FactList factlist={nugget.facts}/>\n        </li>\n    );\n    return(\n        <div>\n            <ul>{listRows}</ul>\n        </div>\n    );\n}\n\nfunction FactList(props) {\n\n    const factListRows = props.factlist.map( (fact) =>\n        <li key={fact.id} > {\"data: \" + fact.data\n        + \" // type: \" + fact.type\n        + \" // description: \" + fact.description}\n        </li>\n    );\n    return(\n        <div>\n            <ul>{factListRows}</ul>\n        </div>\n    );\n}\n\nReactDOM.render(<App/>, document.getElementById('index_root'));\n",
                "new_contents": "import React from 'react';\nimport ReactDOM from 'react-dom';\nimport {Navbar, Nav, NavItem, NavbarBrand, Button, ButtonToolbar, Grid, Row, Col,\nFormGroup, DropdownButton, Checkbox, MenuItem, ButtonGroup, FormControl, ControlLabel, Collapse} from 'react-bootstrap';\nimport 'whatwg-fetch';\n\nclass GakuseiNav extends React.Component {\n    constructor(props) {\n        super(props);\n    }\n    eventHandler(eventKey){\n        if (eventKey === 1) {\n            this.props.updater('play')\n        } else if (eventKey === 2) {\n            this.props.updater('about');\n        } else if (eventKey === 3) {\n            this.props.updater('nuggetsearch');\n        }\n    }\n    render() {\n        return (\n            <Navbar onSelect={this.eventHandler.bind(this)} inverse collapseOnSelect>\n                <Navbar.Header>\n                    <NavbarBrand>\n                        <span><a href=\"#\"><img height={'100%'}\n                                               src=\"/img/temp_gakusei_logo3.png\"\n                                               alt=\"Gakusei logo\"/></a>Gakusei</span>\n                    </NavbarBrand>\n                    <Navbar.Toggle />\n                </Navbar.Header>\n                <Navbar.Collapse>\n                    <Nav>\n                    <NavItem eventKey={1} href=\"#\">Play</NavItem>\n                    <NavItem eventKey={3} href=\"#\">List Items</NavItem>\n                    </Nav>\n                    <Nav pullRight>\n                        <NavItem eventKey={2} href=\"#\">About</NavItem>\n                        <Navbar.Text>\n                            <Navbar.Link href=\"/logout\">Logout</Navbar.Link>\n                        </Navbar.Text>\n                    </Nav>\n                </Navbar.Collapse>\n            </Navbar>\n        );\n    }\n}\n\nclass AnswerButton extends React.Component {\n    render() {\n        return (\n            <Button bsStyle={this.props.buttonStyle}\n               bsSize=\"large\" block\n               onClick={this.props.onAnswerClick.bind(this, this.props.label)}\n               disabled = {this.props.disableButton}>\n               {this.props.buttonNumber + \". \" + this.props.label}\n            </Button>\n        );\n    }\n}\n\nclass NextButton extends React.Component {\n    render() {\n        return(\n            <Button bsStyle=\"info\" onClick={this.props.onNextClick}>\n                Next Question (Enter)\n            </Button>\n        );\n    }\n}\n\nclass Gameplay extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {question: '',\n            answerReturn: '',\n            correctAlt: '',\n            randomOrderAlt: ['', '', '', ''],\n            buttonStyles: ['default', 'default', 'default', 'default'],\n            buttonDisabled: false\n        };\n        this.fetchQuestion = this.fetchQuestion.bind(this);\n        this.checkAnswer = this.checkAnswer.bind(this);\n    }\n\n    fetchQuestion() {\n        fetch('/api/question/', {credentials: \"same-origin\"})\n            .then(response => response.json())\n            .then(json =>\n                this.setState({ answerReturn: '',\n                                question: json.question,\n                                correctAlt: json.correctAlternative,\n                                randomOrderAlt: this.randomizeOrder([json.alternative1,\n                                                                     json.alternative2,\n                                                                     json.alternative3,\n                                                                     json.correctAlternative]),\n                                buttonStyles: ['default', 'default', 'default', 'default'],\n                                buttonDisabled: false\n                                })\n            ).catch(ex => console.log('json parsing failed', ex))\n    }\n\n    randomizeOrder(array) {\n        let i = array.length - 1;\n        for (; i > 0; i--) {\n            const j = Math.floor(Math.random() * (i + 1));\n            const temp = array[i];\n            array[i] = array[j];\n            array[j] = temp;\n        };\n        return array;\n    }\n\n    checkAnswer(answer) {\n        var newButtonStyles = [];\n        if(answer === this.state.correctAlt){\n            newButtonStyles = this.state.randomOrderAlt.map( (word) => (word === answer) ? 'success' : 'default');\n        } else {\n            newButtonStyles = this.state.randomOrderAlt.map( (word) => {\n                if(word === answer) {\n                    return \"danger\";\n                } else if(word === this.state.correctAlt) {\n                    return \"success\";\n                } else {\n                    return \"default\";\n                }\n            });\n        }\n\n        this.setState({\n            buttonDisabled: true,\n            buttonStyles: newButtonStyles\n        });\n    }\n\n    componentDidMount() {\n        this.fetchQuestion();\n        window.addEventListener(\"keydown\", this.onKeys.bind(this));\n    }\n\n    onKeys(event){\n        var keyDown = event.key;\n        if (keyDown === 'Enter') {\n            this.fetchQuestion();\n        } else if (keyDown === '1' && !this.state.buttonDisabled) {\n            this.checkAnswer(this.state.randomOrderAlt[0]);\n        } else if (keyDown === '2' && !this.state.buttonDisabled) {\n            this.checkAnswer(this.state.randomOrderAlt[1]);\n        } else if (keyDown === '3' && !this.state.buttonDisabled) {\n            this.checkAnswer(this.state.randomOrderAlt[2]);\n        } else if (keyDown === '4' && !this.state.buttonDisabled) {\n            this.checkAnswer(this.state.randomOrderAlt[3]);\n        }\n    }\n\n    render() {\n        return (\n            <div>\n                <Grid>\n                    <Row><h2 className=\"text-center\">{this.state.question}</h2></Row>\n                    <br/>\n                    <Row>\n                        <ButtonToolbar>\n                            <Col xs={5} xsOffset={1} sm={4} smOffset={2} md={3} mdOffset={3}>\n                                <AnswerButton label = {this.state.randomOrderAlt[0]}\n                                    buttonNumber = {1}\n                                    onAnswerClick={this.checkAnswer}\n                                    buttonStyle = {this.state.buttonStyles[0]}\n                                    disableButton = {this.state.buttonDisabled} />\n                            </Col>\n                            <Col xs={5} sm={4} md={3}>\n                                <AnswerButton label = {this.state.randomOrderAlt[1]}\n                                    buttonNumber = {2}\n                                    onAnswerClick={this.checkAnswer}\n                                    buttonStyle = {this.state.buttonStyles[1]}\n                                    disableButton = {this.state.buttonDisabled} />\n                            </Col>\n                        </ButtonToolbar>\n                    </Row>\n                    <br/>\n                    <Row>\n                        <ButtonToolbar>\n                            <Col xs={5} xsOffset={1} sm={4} smOffset={2} md={3} mdOffset={3}>\n                                <AnswerButton label = {this.state.randomOrderAlt[2]}\n                                    buttonNumber = {3}\n                                    onAnswerClick={this.checkAnswer}\n                                    buttonStyle = {this.state.buttonStyles[2]}\n                                    disableButton = {this.state.buttonDisabled} />\n                            </Col>\n                            <Col xs={5} sm={4} md={3}>\n                                <AnswerButton label = {this.state.randomOrderAlt[3]}\n                                    buttonNumber = {4}\n                                    onAnswerClick = {this.checkAnswer}\n                                    buttonStyle = {this.state.buttonStyles[3]}\n                                    disableButton = {this.state.buttonDisabled} />\n                            </Col>\n                        </ButtonToolbar>\n                    </Row>\n                    <br/><br/>\n                    <Row>\n                        <div className=\"text-center\"><NextButton onNextClick={this.fetchQuestion}/></div>\n                    </Row>\n                    <br/>\n                    <Row>\n                        <div className=\"text-center\">{this.state.answerReturn}</div>\n                    </Row>\n                </Grid>\n            </div>\n        );\n    }\n}\n\nclass AboutPage extends React.Component {\n    render() {\n        return (\n            <div>\n                <br/>\n                <div className=\"text-center\">About page placeholder</div>\n            </div>\n        );\n    }\n}\n\nclass App extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            currentPage : <Gameplay/>\n        }\n    }\n\n    switchPage(newContent) {\n        if (newContent === 'play') {\n            this.setState({currentPage : <Gameplay/>})\n        }\n        else if (newContent === 'about') {\n            this.setState({currentPage : <AboutPage/>})\n        }\n        else if (newContent === 'nuggetsearch') {\n            this.setState({currentPage : <NuggetSearch/>})\n        }\n    }\n\n    render() {\n        return (\n            <div>\n                <GakuseiNav updater={this.switchPage.bind(this)} />\n                {this.state.currentPage}\n            </div>\n        );\n    }\n}\n\nclass NuggetSearch extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {wordType: '',\n            factType1: '',\n            factType2: '',\n            factType3: '',\n            factType4: '',\n            nuggetList: []\n        };\n        this.updateQueryInput = this.updateQueryInput.bind(this);\n        this.fetchCustomQuery = this.fetchCustomQuery.bind(this);\n    }\n\n    updateQueryInput(event){        \n        if (event.target.id === 'kanjiFactType'){\n            this.setState({\n                factType1: event.target.checked ? 'kanji' : ''\n            });\n        } else if (event.target.id === 'readingFactType') {\n            this.setState({\n                factType2: event.target.checked ? 'reading' : ''\n            });\n        } else if (event.target.id === 'writingFactType') {\n            this.setState({\n                factType3: event.target.checked ? 'writing' : ''\n            });\n        } else if (event.target.id === 'englishFactType') {\n            this.setState({\n                factType4: event.target.checked ? 'english_translation' : ''\n            });\n        } else if (event.target.id === 'wordType') {\n            this.setState({wordType: event.target.value});            \n        }        \n    }\n\n    fetchCustomQuery(event){\n        var fetchUrl = '/api/filter/nuggets?wordType=' + this.state.wordType \n            + '&factType1=' + this.state.factType1 \n            + '&factType2=' + this.state.factType2 \n            + '&factType3=' + this.state.factType3 \n            + '&factType4=' + this.state.factType4;\n        fetch(fetchUrl, \n            {credentials: \"same-origin\"})\n            .then(response => response.json())\n            .then(json =>\n                this.setState({ \n                    nuggetList: json\n            }))\n            .catch(ex => console.log('json parsing failed', ex));\n    }\n\n    render() {\n        return(\n            <div>\n                <QueryInput handleChange={this.updateQueryInput}\n                    handleSubmit={this.fetchCustomQuery}/>\n                <br/>\n                <SearchResults nuggetResults={this.state.nuggetList} />\n            </div>\n        )\n    }\n}\n\nclass QueryInput extends React.Component{\n    constructor(props) {\n        super(props);\n\n        this.handleSubmit = this.handleSubmit.bind(this);\n    }\n\n    handleSubmit(event){\n        this.props.handleSubmit();\n        event.preventDefault();\n    }\n\n    render() {\n        return(\n            <form href=\"#\" onSubmit={this.handleSubmit}>\n                <FormGroup>\n                    <ControlLabel>Query Input</ControlLabel>\n                    <FormControl componentClass=\"select\" id=\"wordType\" \n                    onChange={this.props.handleChange}>\n                        <option value=''>\n                            Select word type\n                        </option>\n                        <option value='verb'>\n                            Verb\n                        </option>\n                        <option value='adjective'>\n                            Adjective\n                        </option>\n                        <option value='noun'>\n                            Noun\n                        </option>\n                        <option value='adverb'>\n                            Adverb\n                        </option>\n                    </FormControl>                    \n                    {' '}\n                    <Checkbox id=\"kanjiFactType\" inline onChange={this.handleChange}>\n                        Kanji\n                    </Checkbox>\n                    {' '}\n                    <Checkbox id=\"readingFactType\" inline onChange={this.handleChange}>\n                        Japanese reading\n                    </Checkbox>\n                    {' '}\n                    <Checkbox  id=\"writingFactType\" inline onChange={this.handleChange}>\n                        Japanese writing\n                    </Checkbox>\n                    {' '}\n                    <Checkbox id=\"englishFactType\" inline onChange={this.handleChange}>\n                        English translation\n                    </Checkbox>                        \n                </FormGroup>\n                <Button type=\"submit\">\n                  Submit\n                </Button>\n            </form>\n        )\n    }\n}\n\nclass SearchResults extends React.Component{\n\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            factViewToggle: false,\n            expandId: ''\n        };\n\n    }\n\n    render() {\n        return(\n            <div>\n                <NuggetList nuggetResults={this.props.nuggetResults} />\n            </div>\n        )\n    }\n}\n\n\n\nclass NuggetList extends React.Component {\n\n    constructor(props) {\n        super(props);\n\n        this.state = {};\n    }\n\n    render(){\n        const listRows = this.props.nuggetResults.map( (nugget) =>\n             <li key={nugget.id}>\n                 {\"type: \" + nugget.type\n                 + \" // description: \" + nugget.description}\n                 <FactList factlist={nugget.facts}/>\n             </li>\n         );\n        return(\n            <div>\n                <ul>{listRows}</ul>\n            </div>\n        )\n    }\n}\n\nclass FactList extends React.Component {\n\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            parentNugget: '',\n\n        };\n    }\n\n    render(){\n        const factListRows = this.props.factlist.map( (fact) =>\n            <li key={fact.id} > {\"data: \" + fact.data\n            + \" // type: \" + fact.type\n            + \" // description: \" + fact.description}\n            </li>\n        );\n\n        return(\n            <div>\n                <Button bsSize=\"xsmall\"\n                onClick={ ()=> this.setState({ open: !this.state.open })} inline={true}>\n                    +\n                </Button><br/>\n                <Collapse in={this.state.open}>\n                    <div>\n                        <ul>{factListRows}</ul>\n                    </div>\n                </Collapse>\n            </div>\n        )\n    }\n}\n\nReactDOM.render(<App/>, document.getElementById('index_root'));\n",
                "subject": "collapsable factlist + code cleanup",
                "message": "collapsable factlist + code cleanup\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "kits-ab/gakusei,kits-ab/gakusei,kits-ab/gakusei"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10245,
            "row": {
                "commit": "5aa3717ae50c0f09041bab2dafd3eef1eae7e4b9",
                "old_file": "js/DocumentLoader.js",
                "new_file": "js/DocumentLoader.js",
                "old_contents": "/*\nCopyright (C) 2016 Apple Inc. All Rights Reserved.\nSee LICENSE.txt for this sample’s licensing information\n\nAbstract:\nThis class handles the loading of resources from the network\n*/\n\n\nfunction DocumentLoader(baseURL) {\n    // Bind callback methods to current context\n    this.prepareURL = this.prepareURL.bind(this);\n    this.prepareElement = this.prepareElement.bind(this);\n    this.responses = [];\n    // Validate arguments\n    if (typeof baseURL !== \"string\") {\n        throw new TypeError(\"DocumentLoader: baseURL argument must be a string.\");\n    }\n    this.baseURL = baseURL;\n}\n\nDocumentLoader.prototype.post = function(options) {\n\tif (typeof options.url !== \"string\") {\n        throw new TypeError(\"DocumentLoader.fetch: url option must be a string.\");\n    }\n    const docURL = this.prepareURL(options.url);\n    const xhr = new XMLHttpRequest();    \n    xhr.open(\"POST\", docURL);\n    xhr.timeout = 0;\n    xhr.onload = function() {\n\t\tif (typeof options.success != \"undefined\") {\n\t\t\toptions.success();\n\t\t}  \n    };\n    xhr.onerror = function() {\n\t\tif (typeof options.failure != \"undefined\") {\n\t\t\toptions.failure();\n\t\t}  \n    };\n    xhr.send(options.data);\n}\n\n/*\n * Helper method to request templates from the server\n */\nDocumentLoader.prototype.fetch = function(options) {\n    if (typeof options.url !== \"string\") {\n        throw new TypeError(\"DocumentLoader.fetch: url option must be a string.\");\n    }    \n    // Cancel the previous request if it is still in-flight.\n    //if (options.concurrent !== true) {\n    //    this.cancelFetch();\n    //}\n    // Parse the request URL\n    const docURL = this.prepareURL(options.url);\n    const xhr = new XMLHttpRequest();    \n    xhr.open(\"GET\", docURL);\n    xhr.responseType = \"document\";\n    xhr.onload = function() {\n\t    console.log('got status '+xhr.status);\n\t    if (xhr.status == 202) {\n\t\t    var msg = JSON.parse(xhr.responseText)\n\t\t    try {\n\t\t\t    play(msg['url']);\n\t\t    } catch (e) {\n\t\t\t    console.log(e);\n\t\t    }\n\t\t    \n/*\n\t\t    console.log(\"got message: \" + xhr.responseText);\n\t\t    var time;\n\t\t    var playCache = localStorage.getItem('playCache');\n\t\t    if (playCache == null) {\n\t\t\t    playCache = '{}';\n\t\t    }\n\t\t    playCache = JSON.parse(playCache);\n\t\t    if (playCache[msg['url']] != null) { //if we've played this url before, retrieve it's stop time\n\t\t\t    time = playCache[msg['url']];\n\t\t    } else {\n\t\t\t    time = 0;\n\t\t    }\n\t\t    var singleVideo = new MediaItem(msg['type'], msg['url']);\n\t\t    if(msg['image'] != null) {\n\t\t    \tsingleVideo.artworkImageURL = msg['image'];\n\t\t    }\n\t\t    if(msg['description'] != null) {\n\t\t    \tsingleVideo.description = msg['description'];\n\t\t    }\n\t\t    if(msg['title'] != null) {\n\t\t    \tsingleVideo.title = msg['title'];\n\t\t    }\n\t\t\tsingleVideo.resumeTime = time;\n\t\t\tvar videoList = new Playlist();\n\t\t\tvideoList.push(singleVideo);\n\t\t\tvar myPlayer = new Player();\t\t\t\n\t\t\tmyPlayer.playlist = videoList;\n\t\t\t//var overlayDocument = createSubtitleDocument();\n\t\t\t//var subtitle = overlayDocument.getElementsByTagName(\"text\").item(0);\n\t\t\tmyPlayer.play();\n\t\t\tvar currenttime = 0;\n\t\t\tvar duration;\n\t\t\tif (myPlayer.currentMediaItemDuration == null) { //pre tvos 10\n\t\t\t\tduration = 0;\n\t\t\t\tmyPlayer.addEventListener(\"shouldHandleStateChange\", function(e) {\n\t\t\t\t\tduration = e.duration;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tduration = myPlayer.currentMediaItemDuration;\n\t\t\t}\n\t\t\tmyPlayer.addEventListener(\"timeDidChange\", function(info) {\n\t\t\t\tcurrenttime = info.time;\n\t\t\t\t//hack for duration\n\t\t\t\tif (duration == 0) {\n\t\t\t\t\tmyPlayer.pause(); //this will trigger \"shouldHandleStateChange\"\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tmyPlayer.play();\n\t\t\t\t\t},100);\n\t\t\t\t}\n\t\t\t\t//subtitle.textContent = \"timeDidChange \"+info.time;\n\t\t\t}, {\"interval\":1});\t\t\t\n\t\t\tmyPlayer.addEventListener(\"stateDidChange\", function(e) {  \n\t\t\t\tif(e.state == \"end\") {\n\t\t\t\t\toptions.abort();\n\t\t\t\t\tif ((duration - currenttime) * 100/duration <=3) { //if we've stopped at more than 97% play time, don't resume\n\t\t\t\t\t\tcurrenttime = 0;\n\t\t\t\t\t}\n\t\t\t\t\tplayCache[msg['url']] = currenttime;\n\t\t\t\t\tlocalStorage.setItem('playCache', JSON.stringify(playCache)); //save this url's stop time for future playback\n\t\t\t\t\tthis.fetch({\n\t\t\t\t\t\turl:msg['stop']+\"/\"+btoa(currenttime.toString()),\n\t\t\t\t\t\tabort: function() {\n\t\t\t\t\t\t\t//do nothing\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}.bind(this), false);  \n*/\t\t\t\t\t\n\t\t} else if(xhr.status == 204) {\n\t\t\t//no message\n\t\t} else if(xhr.status == 205) {\n\t\t\tconsole.log('sent response')\n\t    } else if(xhr.status == 206) {\n\t\t    options.abort();\n\t\t} else if(xhr.status == 208) {\n\t\t\tconst responseDoc = xhr.response;\n\t\t\tthis.prepareDocument(responseDoc);\n\t\t\toptions.success(responseDoc, true);\n\t\t} else if (xhr.status == 210) {\n\t\t\tvar msg = JSON.parse(xhr.responseText);\n\t\t\tif (msg['type'] == 'saveSettings') {\n\t\t\t\tsaveSettings(msg['addon'], msg['settings']);\n\t\t\t\toptions.abort();\n\t\t\t} else if(msg['type'] == 'loadSettings') {\n\t\t\t\tvar settings = loadSettings(msg['addon']);\n\t\t\t\tthis.post({\n\t\t\t\t\turl:'/response/'+msg['msgid'],\n\t\t\t\t\tdata:btoa(JSON.stringify(settings))\n\t\t\t\t});\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\toptions.url = msg['url']\n\t\t\t\t\tthis.fetch(options);\n\t\t\t\t}.bind(this), 1000)\t\t\t\t\n\t\t\t}\n\t\t} else if (xhr.status == 212) {\n\t\t\tvar msg = JSON.parse(xhr.responseText);\n\t\t\toptions.url = msg['url'];\n\t\t\tthis.fetch(options);\n\t    } else {\n        \tconst responseDoc = xhr.response;\n        \tif (typeof options.initial == \"boolean\" && options.initial) {\n\t        \tconsole.log(\"registering event handlers\");\n\t\t\t\tresponseDoc.addEventListener(\"disappear\", function() {\n\t\t\t\t\tif(navigationDocument.documents.length==1) {\n\t\t\t\t\t\t//if we got here than we've exited from the web server since the only page (root) has disappeared\n\t\t\t\t\t\tApp.onExit({});\n\t\t\t\t\t}\n\t\t\t\t}.bind(this));\t\t\t\t\n    \t\t}\n\t\t\tthis.prepareDocument(responseDoc);\n\t\t\tif (typeof options.success === \"function\") {\n            \toptions.success(responseDoc);\n        \t} else {\n            \tnavigationDocument.pushDocument(responseDoc);\n        \t}\n        }\n    }.bind(this);\n    xhr.onerror = function() {\n        if (typeof options.error === \"function\") {\n            options.error(xhr);\n        } else {\n            const alertDocument = createLoadErrorAlertDocument(docURL, xhr, true);\n            navigationDocument.presentModal(alertDocument);\n        }\n    };\n    xhr.timeout = 0;\n    xhr.send();\n    // Preserve the request so it can be cancelled by the next fetch\n    if (options.concurrent !== true) {\n        this._fetchXHR = xhr;\n    }\n};\n\n/*\n * Helper method to cancel a running XMLHttpRequest\n */\nDocumentLoader.prototype.cancelFetch = function() {\n\tconsole.log(\"Aborting fetch\");\n    const xhr = this._fetchXHR;\n    if (xhr && xhr.readyState !== XMLHttpRequest.DONE) {\n        xhr.abort();\n    }\n    delete this._fetchXHR;\n};\n\n/*\n * Helper method to convert a relative URL into an absolute URL\n */\nDocumentLoader.prototype.prepareURL = function(url) {\n    // Handle URLs relative to the \"server root\" (baseURL)\n    if (url.indexOf(\"/\") === 0) {\n        url = this.baseURL + url.substr(1);\n    }\n    return url;\n};\n\n/*\n * Helper method to mangle relative URLs in XMLHttpRequest response documents\n */\nDocumentLoader.prototype.prepareDocument = function(document) {\n    traverseElements(document.documentElement, this.prepareElement);   \n    if (typeof document.getElementById(\"progress\")!=\"undefined\") { //progress dialog\n\t    var progress = document.getElementById(\"progress\");\n\t    var url = progress.getAttribute(\"documentURL\");\n\t    var id = progress.getAttribute(\"msgid\");\n\t    setTimeout(function() {\n\t\t    this.fetch({\n\t\t\t\turl: url,\n\t\t\t\tsuccess: function(responseDoc) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconsole.log(\"updating progress dialog\");\n\t\t\t\t\t\tnavigationDocument.replaceDocument(responseDoc, document);\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tthis.post({\n\t\t\t\t\t\t\turl: \"/response/\" + id,\n\t\t\t\t\t\t\tdata: \"blah\"\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}.bind(this),\n\t\t\t\tabort: function() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconsole.log(\"Removing progress dialog\");\n\t\t\t\t\t\tvar loadingDocument = createLoadingDocument();\n\t\t\t\t\t\tnavigationDocument.replaceDocument(loadingDocument, document);\n\t\t\t\t\t\tnew DocumentController(this, url, loadingDocument);\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tthis.post({\n\t\t\t\t\t\t\turl: \"/response/\" + id,\n\t\t\t\t\t\t\tdata: \"blah\"\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}.bind(this)\n\t\t\t});\n\t\t}.bind(this), 1000);\t    \n    } else if (typeof document.getElementById(\"player\")!=\"undefined\") { //player\n\t    var m = document.getElementById(\"player\");\n\t    var singleVideo = new MediaItem(m.getAttribute('type'), m.getAttribute('url'));\n\t\tvar videoList = new Playlist();\n\t\tvideoList.push(singleVideo);\n\t\tvar myPlayer = m.getFeature('Player');\t\t\t\n\t\tmyPlayer.playlist = videoList;\n\t\tvar subtitle = m.getElementsByTagName(\"text\").item(0);\n\t\tmyPlayer.play();\n\t\tmyPlayer.addEventListener(\"timeDidChange\", function(info) {\n\t\t\tconsole.log(\"timeDidChange\");\n\t\t\tsubtitle.textContent = \"timeDidChange \"+info.time;\n\t\t}, {\"interval\":1});\n\t\tmyPlayer.addEventListener(\"stateDidChange\", function(e) {  \n\t\t\tif(e.state == \"end\") {\n\t\t\t\toptions.abort();\n\t\t\t\tthis.fetch({\n\t\t\t\t\turl:msg['stop'],\n\t\t\t\t\tabort: function() {\n\t\t\t\t\t\t//do nothing\n\t\t\t\t\t}\n\t\t\t\t});\n      \t\t} else if(e.state == \"playing\") {\n\t    \t\tconsole.log(\"attaching overlay\");\n\t    \t\tmyPlayer.overlayDocument = overlayDocument;\t      \t\t\t\n      \t\t}\n    \t}.bind(this), false);\n    }\n    traverseElements(document.documentElement, function(elem) {\n\t   if (elem.hasAttribute(\"notify\")) {\n\t\t   var url = elem.getAttribute(\"notify\");\n\t\t   elem.addEventListener(\"select\", function() {\n\t\t\t   this.fetch({\n\t\t\t\t\turl: url,\n\t\t\t\t\tabort: function() {\n\t\t\t\t\t\tnavigationDocument.removeDocument(document); //remove the document\n\t\t\t\t\t},\n\t\t\t\t\terror: function(xhr) {\n\t\t\t\t\t\t//do nothing\n\t\t\t\t\t}\t\t\t\t\n\t\t   \t\t});\n\t   \t\t}.bind(this)) \n\t   \t}\n\t   \tif(elem.hasAttribute(\"abort\")) {\n\t\t   \tvar url = elem.getAttribute(\"abort\");\n\t\t   \tdocument.addEventListener(\"unload\", function() {\n\t\t\t\tnotify(url);  \t\n\t\t   \t});\n\t   \t}\n\t   \tif(elem.hasAttribute(\"abortfunction\")) {\n\t\t   \t//var url = function() { return eval(elem.getAttribute(\"abortfunction\"));}.call({document:document});\t\t   \t\n\t\t   \tdocument.addEventListener(\"unload\", function() {\n\t\t\t   \teval(elem.getAttribute(\"abortfunction\"));\n\t\t   \t}.bind(this));\n\t   \t}\n    }.bind(this));\n};\n\n/*\n * Helper method to mangle relative URLs in DOM elements\n */\nDocumentLoader.prototype.prepareElement = function(elem) {\n    if (elem.hasAttribute(\"src\")) {\n        const rawSrc = elem.getAttribute(\"src\");\n        const parsedSrc = this.prepareURL(rawSrc);\n        elem.setAttribute(\"src\", parsedSrc);\n    }\n    if (elem.hasAttribute(\"srcset\")) {\n        // TODO Prepare srcset attribute\n    }\n}\n\n/**\n * Convenience function to iterate and recurse through a DOM tree\n */\nfunction traverseElements(elem, callback) {\n    callback(elem);\n    const children = elem.children;\n    for (var i = 0; i < children.length; ++i) {\n\t    traverseElements(children.item(i), callback);\n    }\n}\n\n\n\n",
                "new_contents": "/*\nCopyright (C) 2016 Apple Inc. All Rights Reserved.\nSee LICENSE.txt for this sample’s licensing information\n\nAbstract:\nThis class handles the loading of resources from the network\n*/\n\n\nfunction DocumentLoader(baseURL) {\n    // Bind callback methods to current context\n    this.prepareURL = this.prepareURL.bind(this);\n    this.prepareElement = this.prepareElement.bind(this);\n    this.responses = [];\n    // Validate arguments\n    if (typeof baseURL !== \"string\") {\n        throw new TypeError(\"DocumentLoader: baseURL argument must be a string.\");\n    }\n    this.baseURL = baseURL;\n}\n\nDocumentLoader.prototype.post = function(options) {\n\tif (typeof options.url !== \"string\") {\n        throw new TypeError(\"DocumentLoader.fetch: url option must be a string.\");\n    }\n    const docURL = this.prepareURL(options.url);\n    const xhr = new XMLHttpRequest();    \n    xhr.open(\"POST\", docURL);\n    xhr.timeout = 0;\n    xhr.onload = function() {\n\t\tif (typeof options.success != \"undefined\") {\n\t\t\toptions.success();\n\t\t}  \n    };\n    xhr.onerror = function() {\n\t\tif (typeof options.failure != \"undefined\") {\n\t\t\toptions.failure();\n\t\t}  \n    };\n    xhr.send(options.data);\n}\n\n/*\n * Helper method to request templates from the server\n */\nDocumentLoader.prototype.fetch = function(options) {\n    if (typeof options.url !== \"string\") {\n        throw new TypeError(\"DocumentLoader.fetch: url option must be a string.\");\n    }    \n    // Cancel the previous request if it is still in-flight.\n    //if (options.concurrent !== true) {\n    //    this.cancelFetch();\n    //}\n    // Parse the request URL\n    const docURL = this.prepareURL(options.url);\n    const xhr = new XMLHttpRequest();    \n    xhr.open(\"GET\", docURL);\n    xhr.responseType = \"document\";\n    xhr.onload = function() {\n\t    console.log('got status '+xhr.status);\n\t    if (xhr.status == 202) {\n\t\t    var msg = JSON.parse(xhr.responseText)\n/*\n\t\t    try {\n\t\t\t    play(msg['url']);\n\t\t    } catch (e) {\n\t\t\t    console.log(e);\n\t\t    }\n*/\n\t\t    \n\n\t\t    console.log(\"got message: \" + xhr.responseText);\n\t\t    var time;\n\t\t    var playCache = localStorage.getItem('playCache');\n\t\t    if (playCache == null) {\n\t\t\t    playCache = '{}';\n\t\t    }\n\t\t    playCache = JSON.parse(playCache);\n\t\t    if (playCache[msg['url']] != null) { //if we've played this url before, retrieve it's stop time\n\t\t\t    time = playCache[msg['url']];\n\t\t    } else {\n\t\t\t    time = 0;\n\t\t    }\n\t\t    var singleVideo = new MediaItem(msg['type'], msg['url']);\n\t\t    if(msg['image'] != null) {\n\t\t    \tsingleVideo.artworkImageURL = msg['image'];\n\t\t    }\n\t\t    if(msg['description'] != null) {\n\t\t    \tsingleVideo.description = msg['description'];\n\t\t    }\n\t\t    if(msg['title'] != null) {\n\t\t    \tsingleVideo.title = msg['title'];\n\t\t    }\n\t\t\tsingleVideo.resumeTime = time;\n\t\t\tvar videoList = new Playlist();\n\t\t\tvideoList.push(singleVideo);\n\t\t\tvar myPlayer = new Player();\t\t\t\n\t\t\tmyPlayer.playlist = videoList;\n\t\t\t//var overlayDocument = createSubtitleDocument();\n\t\t\t//var subtitle = overlayDocument.getElementsByTagName(\"text\").item(0);\n\t\t\tmyPlayer.play();\n\t\t\tvar currenttime = 0;\n\t\t\tvar duration;\n\t\t\tif (myPlayer.currentMediaItemDuration == null) { //pre tvos 10\n\t\t\t\tduration = 0;\n\t\t\t\tmyPlayer.addEventListener(\"shouldHandleStateChange\", function(e) {\n\t\t\t\t\tduration = e.duration;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tduration = myPlayer.currentMediaItemDuration;\n\t\t\t}\n\t\t\tmyPlayer.addEventListener(\"timeDidChange\", function(info) {\n\t\t\t\tcurrenttime = info.time;\n\t\t\t\t//hack for duration\n\t\t\t\tif (duration == 0) {\n\t\t\t\t\tmyPlayer.pause(); //this will trigger \"shouldHandleStateChange\"\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tmyPlayer.play();\n\t\t\t\t\t},100);\n\t\t\t\t}\n\t\t\t\t//subtitle.textContent = \"timeDidChange \"+info.time;\n\t\t\t}, {\"interval\":1});\t\t\t\n\t\t\tmyPlayer.addEventListener(\"stateDidChange\", function(e) {  \n\t\t\t\tif(e.state == \"end\") {\n\t\t\t\t\toptions.abort();\n\t\t\t\t\tif ((duration - currenttime) * 100/duration <=3) { //if we've stopped at more than 97% play time, don't resume\n\t\t\t\t\t\tcurrenttime = 0;\n\t\t\t\t\t}\n\t\t\t\t\tplayCache[msg['url']] = currenttime;\n\t\t\t\t\tlocalStorage.setItem('playCache', JSON.stringify(playCache)); //save this url's stop time for future playback\n\t\t\t\t\tthis.fetch({\n\t\t\t\t\t\turl:msg['stop']+\"/\"+btoa(currenttime.toString()),\n\t\t\t\t\t\tabort: function() {\n\t\t\t\t\t\t\t//do nothing\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}.bind(this), false);  \n\t\t\t\t\t\n\t\t} else if(xhr.status == 204) {\n\t\t\t//no message\n\t\t} else if(xhr.status == 205) {\n\t\t\tconsole.log('sent response')\n\t    } else if(xhr.status == 206) {\n\t\t    options.abort();\n\t\t} else if(xhr.status == 208) {\n\t\t\tconst responseDoc = xhr.response;\n\t\t\tthis.prepareDocument(responseDoc);\n\t\t\toptions.success(responseDoc, true);\n\t\t} else if (xhr.status == 210) {\n\t\t\tvar msg = JSON.parse(xhr.responseText);\n\t\t\tif (msg['type'] == 'saveSettings') {\n\t\t\t\tsaveSettings(msg['addon'], msg['settings']);\n\t\t\t\toptions.abort();\n\t\t\t} else if(msg['type'] == 'loadSettings') {\n\t\t\t\tvar settings = loadSettings(msg['addon']);\n\t\t\t\tthis.post({\n\t\t\t\t\turl:'/response/'+msg['msgid'],\n\t\t\t\t\tdata:btoa(JSON.stringify(settings))\n\t\t\t\t});\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\toptions.url = msg['url']\n\t\t\t\t\tthis.fetch(options);\n\t\t\t\t}.bind(this), 1000)\t\t\t\t\n\t\t\t}\n\t\t} else if (xhr.status == 212) {\n\t\t\tvar msg = JSON.parse(xhr.responseText);\n\t\t\toptions.url = msg['url'];\n\t\t\tthis.fetch(options);\n\t    } else {\n        \tconst responseDoc = xhr.response;\n        \tif (typeof options.initial == \"boolean\" && options.initial) {\n\t        \tconsole.log(\"registering event handlers\");\n\t\t\t\tresponseDoc.addEventListener(\"disappear\", function() {\n\t\t\t\t\tif(navigationDocument.documents.length==1) {\n\t\t\t\t\t\t//if we got here than we've exited from the web server since the only page (root) has disappeared\n\t\t\t\t\t\tApp.onExit({});\n\t\t\t\t\t}\n\t\t\t\t}.bind(this));\t\t\t\t\n    \t\t}\n\t\t\tthis.prepareDocument(responseDoc);\n\t\t\tif (typeof options.success === \"function\") {\n            \toptions.success(responseDoc);\n        \t} else {\n            \tnavigationDocument.pushDocument(responseDoc);\n        \t}\n        }\n    }.bind(this);\n    xhr.onerror = function() {\n        if (typeof options.error === \"function\") {\n            options.error(xhr);\n        } else {\n            const alertDocument = createLoadErrorAlertDocument(docURL, xhr, true);\n            navigationDocument.presentModal(alertDocument);\n        }\n    };\n    xhr.timeout = 0;\n    xhr.send();\n    // Preserve the request so it can be cancelled by the next fetch\n    if (options.concurrent !== true) {\n        this._fetchXHR = xhr;\n    }\n};\n\n/*\n * Helper method to cancel a running XMLHttpRequest\n */\nDocumentLoader.prototype.cancelFetch = function() {\n\tconsole.log(\"Aborting fetch\");\n    const xhr = this._fetchXHR;\n    if (xhr && xhr.readyState !== XMLHttpRequest.DONE) {\n        xhr.abort();\n    }\n    delete this._fetchXHR;\n};\n\n/*\n * Helper method to convert a relative URL into an absolute URL\n */\nDocumentLoader.prototype.prepareURL = function(url) {\n    // Handle URLs relative to the \"server root\" (baseURL)\n    if (url.indexOf(\"/\") === 0) {\n        url = this.baseURL + url.substr(1);\n    }\n    return url;\n};\n\n/*\n * Helper method to mangle relative URLs in XMLHttpRequest response documents\n */\nDocumentLoader.prototype.prepareDocument = function(document) {\n    traverseElements(document.documentElement, this.prepareElement);   \n    if (typeof document.getElementById(\"progress\")!=\"undefined\") { //progress dialog\n\t    var progress = document.getElementById(\"progress\");\n\t    var url = progress.getAttribute(\"documentURL\");\n\t    var id = progress.getAttribute(\"msgid\");\n\t    setTimeout(function() {\n\t\t    this.fetch({\n\t\t\t\turl: url,\n\t\t\t\tsuccess: function(responseDoc) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconsole.log(\"updating progress dialog\");\n\t\t\t\t\t\tnavigationDocument.replaceDocument(responseDoc, document);\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tthis.post({\n\t\t\t\t\t\t\turl: \"/response/\" + id,\n\t\t\t\t\t\t\tdata: \"blah\"\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}.bind(this),\n\t\t\t\tabort: function() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconsole.log(\"Removing progress dialog\");\n\t\t\t\t\t\tvar loadingDocument = createLoadingDocument();\n\t\t\t\t\t\tnavigationDocument.replaceDocument(loadingDocument, document);\n\t\t\t\t\t\tnew DocumentController(this, url, loadingDocument);\n\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\tthis.post({\n\t\t\t\t\t\t\turl: \"/response/\" + id,\n\t\t\t\t\t\t\tdata: \"blah\"\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}.bind(this)\n\t\t\t});\n\t\t}.bind(this), 1000);\t    \n    } else if (typeof document.getElementById(\"player\")!=\"undefined\") { //player\n\t    var m = document.getElementById(\"player\");\n\t    var singleVideo = new MediaItem(m.getAttribute('type'), m.getAttribute('url'));\n\t\tvar videoList = new Playlist();\n\t\tvideoList.push(singleVideo);\n\t\tvar myPlayer = m.getFeature('Player');\t\t\t\n\t\tmyPlayer.playlist = videoList;\n\t\tvar subtitle = m.getElementsByTagName(\"text\").item(0);\n\t\tmyPlayer.play();\n\t\tmyPlayer.addEventListener(\"timeDidChange\", function(info) {\n\t\t\tconsole.log(\"timeDidChange\");\n\t\t\tsubtitle.textContent = \"timeDidChange \"+info.time;\n\t\t}, {\"interval\":1});\n\t\tmyPlayer.addEventListener(\"stateDidChange\", function(e) {  \n\t\t\tif(e.state == \"end\") {\n\t\t\t\toptions.abort();\n\t\t\t\tthis.fetch({\n\t\t\t\t\turl:msg['stop'],\n\t\t\t\t\tabort: function() {\n\t\t\t\t\t\t//do nothing\n\t\t\t\t\t}\n\t\t\t\t});\n      \t\t} else if(e.state == \"playing\") {\n\t    \t\tconsole.log(\"attaching overlay\");\n\t    \t\tmyPlayer.overlayDocument = overlayDocument;\t      \t\t\t\n      \t\t}\n    \t}.bind(this), false);\n    }\n    traverseElements(document.documentElement, function(elem) {\n\t   if (elem.hasAttribute(\"notify\")) {\n\t\t   var url = elem.getAttribute(\"notify\");\n\t\t   elem.addEventListener(\"select\", function() {\n\t\t\t   this.fetch({\n\t\t\t\t\turl: url,\n\t\t\t\t\tabort: function() {\n\t\t\t\t\t\tnavigationDocument.removeDocument(document); //remove the document\n\t\t\t\t\t},\n\t\t\t\t\terror: function(xhr) {\n\t\t\t\t\t\t//do nothing\n\t\t\t\t\t}\t\t\t\t\n\t\t   \t\t});\n\t   \t\t}.bind(this)) \n\t   \t}\n\t   \tif(elem.hasAttribute(\"abort\")) {\n\t\t   \tvar url = elem.getAttribute(\"abort\");\n\t\t   \tdocument.addEventListener(\"unload\", function() {\n\t\t\t\tnotify(url);  \t\n\t\t   \t});\n\t   \t}\n\t   \tif(elem.hasAttribute(\"abortfunction\")) {\n\t\t   \t//var url = function() { return eval(elem.getAttribute(\"abortfunction\"));}.call({document:document});\t\t   \t\n\t\t   \tdocument.addEventListener(\"unload\", function() {\n\t\t\t   \teval(elem.getAttribute(\"abortfunction\"));\n\t\t   \t}.bind(this));\n\t   \t}\n    }.bind(this));\n};\n\n/*\n * Helper method to mangle relative URLs in DOM elements\n */\nDocumentLoader.prototype.prepareElement = function(elem) {\n    if (elem.hasAttribute(\"src\")) {\n        const rawSrc = elem.getAttribute(\"src\");\n        const parsedSrc = this.prepareURL(rawSrc);\n        elem.setAttribute(\"src\", parsedSrc);\n    }\n    if (elem.hasAttribute(\"srcset\")) {\n        // TODO Prepare srcset attribute\n    }\n}\n\n/**\n * Convenience function to iterate and recurse through a DOM tree\n */\nfunction traverseElements(elem, callback) {\n    callback(elem);\n    const children = elem.children;\n    for (var i = 0; i < children.length; ++i) {\n\t    traverseElements(children.item(i), callback);\n    }\n}\n\n\n\n",
                "subject": "revert to native player",
                "message": "revert to native player\n",
                "lang": "JavaScript",
                "license": "apache-2.0",
                "repos": "ggyeh/TVML-Kodi-Addons"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10246,
            "row": {
                "commit": "33c00f60d456ebe5880821600e152465865856a6",
                "old_file": "js/NumberProperty.js",
                "new_file": "js/NumberProperty.js",
                "old_contents": "// Copyright 2016-2017, University of Colorado Boulder\n\n/**\n * Property whose value must be a number.\n *\n * @author Chris Malley (PixelZoom, Inc.)\n */\ndefine( function( require ) {\n  'use strict';\n\n  // modules\n  var axon = require( 'AXON/axon' );\n  var inherit = require( 'PHET_CORE/inherit' );\n  var Property = require( 'AXON/Property' );\n  var NumberPropertyIO = require( 'AXON/NumberPropertyIO' );\n\n  // valid values for options.units\n  var VALID_UNITS = [\n    'amperes',\n    'milliamperes',\n    'becquerels',\n    'centimeters',\n    'centimeters-squared',\n    'coulombs',\n    'degrees Celsius',\n    'farads',\n    'kilograms',\n    'grams',\n    'gray',\n    'henrys',\n    'henries',\n    'hertz',\n    'joules',\n    'katals',\n    'kelvins',\n    'liters',\n    'liters/second',\n    'lumens',\n    'lux',\n    'meters',\n    'meters/second',\n    'meters/second/second',\n    'moles',\n    'moles/liter',\n    'nanometers',\n    'newtons',\n    'newtons/meters',\n    'newtons-second/meters',\n    'ohms',\n    'ohm-centimeters',\n    'pascals',\n    'percent',\n    'radians',\n    'radians/second',\n    'seconds',\n    'siemens',\n    'sieverts',\n    'steradians',\n    'tesla',\n    'view-coordinates/second',\n    'volts',\n    'watts',\n    'webers'\n  ];\n\n  // valid values for options.valueType\n  var VALID_VALUE_TYPES = [ 'FloatingPoint', 'Integer' ];\n\n  /**\n   * @param {number} value - initial value\n   * @param {Object} [options]\n   * @constructor\n   */\n  function NumberProperty( value, options ) {\n\n    options = _.extend( {\n      range: null, // {null|Range|{min:number, max:number}} range of the value\n      valueType: 'FloatingPoint', // {string} see VALID_VALUE_TYPES\n      phetioType: NumberPropertyIO\n    }, options );\n\n    assert && assert(\n      _.filter( [ options.validValues, options.isValidValue, options.range ], function( value ) { return value; } ).length <= 1,\n      'validValues, isValidValue and range are mutually-exclusive options' );\n\n    options.units && assert && assert( _.includes( VALID_UNITS, options.units ), 'invalid units: ' + options.units );\n    assert && assert( _.includes( VALID_VALUE_TYPES, options.valueType ), 'invalid type: ' + options.valueType );\n\n    assert && assert( isValidForValueType( value, options.valueType ),\n      'initial value ' + value + ' must be of type: ' + options.valueType );\n\n    // @public (read-only) - used by PhET-iO in NumberPropertyIO as metadata passed to the wrapper.\n    this.units = options.units;\n    this.range = options.range;\n    this.valueType = options.valueType;\n\n    if ( options.range ) {\n\n      // Add a validation function that includes the range check.\n      options.isValidValue = function( value ) {\n        return isValidForValueType( value, options.valueType ) && ( value >= options.range.min ) && ( value <= options.range.max );\n      };\n    }\n    else if ( options.validValues ) {\n\n      // Verify that the values are all numbers.\n      assert && assert( _.every( options.validValues, function( value ) { return isValidForValueType( value, options.valueType ); } ),\n        'validValues must contain numbers of the right valueType' );\n    }\n    else if ( options.isValidValue ) {\n\n      // Wrap the provided function so that we can verify that the value is a number.\n      // This prevents the client from having to check (or remember to check) that the value is a number.\n      var isValidValue = options.isValidValue;\n      options.isValidValue = function( value ) {\n        return isValidForValueType( value, options.valueType ) && isValidValue( value );\n      };\n    }\n    else {\n\n      // fallback to verifying that the value is a string\n      options.isValidValue = function( value ) {\n        return isValidForValueType( value, options.valueType );\n      };\n    }\n\n    Property.call( this, value, options );\n  }\n\n  axon.register( 'NumberProperty', NumberProperty );\n\n  /**\n   * If valueType is Integer, then the value must be an integer.\n   * @param value\n   * @param valueType\n   * @returns {boolean}\n   */\n  function isValidForValueType( value, valueType ) {\n    return ( typeof value === 'number' ) && !( valueType === 'Integer' && value % 1 !== 0);\n  }\n\n  return inherit( Property, NumberProperty );\n} );",
                "new_contents": "// Copyright 2016-2017, University of Colorado Boulder\n\n/**\n * Property whose value must be a number.\n *\n * @author Chris Malley (PixelZoom, Inc.)\n */\ndefine( function( require ) {\n  'use strict';\n\n  // modules\n  var axon = require( 'AXON/axon' );\n  var inherit = require( 'PHET_CORE/inherit' );\n  var Property = require( 'AXON/Property' );\n  var NumberPropertyIO = require( 'AXON/NumberPropertyIO' );\n\n  // valid values for options.units\n  var VALID_UNITS = [\n    'amperes',\n    'milliamperes',\n    'becquerels',\n    'centimeters',\n    'centimeters-squared',\n    'coulombs',\n    'degrees Celsius',\n    'farads',\n    'kilograms',\n    'grams',\n    'gray',\n    'henrys',\n    'henries',\n    'hertz',\n    'joules',\n    'katals',\n    'kelvins',\n    'liters',\n    'liters/second',\n    'lumens',\n    'lux',\n    'meters',\n    'meters/second',\n    'meters/second/second',\n    'moles',\n    'moles/liter',\n    'nanometers',\n    'newtons',\n    'newtons/meters',\n    'newtons-second/meters',\n    'ohms',\n    'ohm-centimeters',\n    'pascals',\n    'percent',\n    'radians',\n    'radians/second',\n    'seconds',\n    'siemens',\n    'sieverts',\n    'steradians',\n    'tesla',\n    'view-coordinates/second',\n    'volts',\n    'watts',\n    'webers'\n  ];\n\n  // valid values for options.valueType\n  var VALID_VALUE_TYPES = [ 'FloatingPoint', 'Integer' ];\n\n  /**\n   * @param {number} value - initial value\n   * @param {Object} [options]\n   * @constructor\n   */\n  function NumberProperty( value, options ) {\n\n    options = _.extend( {\n      range: null, // {null|Range|{min:number, max:number}} range of the value\n      valueType: 'FloatingPoint', // {string} see VALID_VALUE_TYPES\n      phetioType: NumberPropertyIO\n    }, options );\n\n    assert && assert(\n      _.filter( [ options.validValues, options.isValidValue, options.range ], function( value ) { return value; } ).length <= 1,\n      'validValues, isValidValue and range are mutually-exclusive options' );\n\n    options.units && assert && assert( _.includes( VALID_UNITS, options.units ), 'invalid units: ' + options.units );\n    assert && assert( _.includes( VALID_VALUE_TYPES, options.valueType ), 'invalid valueType: ' + options.valueType );\n\n    assert && assert( isValidForValueType( value, options.valueType ),\n      'initial value ' + value + ' must be of type: ' + options.valueType );\n\n    // @public (read-only) - used by PhET-iO in NumberPropertyIO as metadata passed to the wrapper.\n    this.units = options.units;\n    this.range = options.range;\n    this.valueType = options.valueType;\n\n    if ( options.range ) {\n\n      // Add a validation function that includes the range check.\n      options.isValidValue = function( value ) {\n        return isValidForValueType( value, options.valueType ) && ( value >= options.range.min ) && ( value <= options.range.max );\n      };\n    }\n    else if ( options.validValues ) {\n\n      // Verify that the values are all numbers.\n      assert && assert( _.every( options.validValues, function( value ) { return isValidForValueType( value, options.valueType ); } ),\n        'validValues must contain numbers of the right valueType' );\n    }\n    else if ( options.isValidValue ) {\n\n      // Wrap the provided function so that we can verify that the value is a number.\n      // This prevents the client from having to check (or remember to check) that the value is a number.\n      var isValidValue = options.isValidValue;\n      options.isValidValue = function( value ) {\n        return isValidForValueType( value, options.valueType ) && isValidValue( value );\n      };\n    }\n    else {\n\n      // fallback to verifying that the value is a string\n      options.isValidValue = function( value ) {\n        return isValidForValueType( value, options.valueType );\n      };\n    }\n\n    Property.call( this, value, options );\n  }\n\n  axon.register( 'NumberProperty', NumberProperty );\n\n  /**\n   * If valueType is Integer, then the value must be an integer.\n   * @param value\n   * @param valueType\n   * @returns {boolean}\n   */\n  function isValidForValueType( value, valueType ) {\n    return ( typeof value === 'number' ) && !( valueType === 'Integer' && value % 1 !== 0);\n  }\n\n  return inherit( Property, NumberProperty );\n} );",
                "subject": "fix assertion message",
                "message": "fix assertion message\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "phetsims/axon,phetsims/axon,phetsims/axon"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10247,
            "row": {
                "commit": "d94d56e1fadc4cb0de82608566da273b94dbf2ed",
                "old_file": "test/modules/events.js",
                "new_file": "test/modules/events.js",
                "old_contents": "// EVENT TESTS\n// ===========\n//\n// TODO: add moar tests\n\ndefine([ 'Ractive', '../vendor/Ractive-events-tap' ], function ( Ractive ) {\n\n\treturn function () {\n\n\t\tvar fixture = document.getElementById( 'qunit-fixture' );\n\n\t\tmodule( 'Events' );\n\n\t\ttest( 'on-click=\"someEvent\" fires an event when user clicks the element', function ( t ) {\n\t\t\tvar ractive;\n\n\t\t\texpect( 2 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<span id=\"test\" on-click=\"someEvent\">click me</span>'\n\t\t\t});\n\n\t\t\tractive.on( 'someEvent', function ( event ) {\n\t\t\t\tt.ok( true );\n\t\t\t\tt.equal( event.original.type, 'click' );\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.test, 'click' );\n\t\t});\n\n\t\ttest( 'Standard events have correct properties: node, original, keypath, context, index', function ( t ) {\n\t\t\tvar ractive, fakeEvent;\n\n\t\t\texpect( 5 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<span id=\"test\" on-click=\"someEvent\">click me</span>'\n\t\t\t});\n\n\t\t\tractive.on( 'someEvent', function ( event ) {\n\t\t\t\tt.equal( event.node, ractive.nodes.test );\n\t\t\t\tt.ok( event.original );\n\t\t\t\tt.equal( event.keypath, '' );\n\t\t\t\tt.equal( event.context, ractive.data );\n\t\t\t\tt.equal( event.index, undefined );\n\t\t\t});\n\n\t\t\tfakeEvent = simulant( 'click' );\n\n\t\t\tsimulant.fire( ractive.nodes.test, fakeEvent );\n\t\t});\n\n\t\ttest( 'event.keypath is set to the innermost context', function ( t ) {\n\t\t\tvar ractive;\n\n\t\t\texpect( 2 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '{{#foo}}<span id=\"test\" on-click=\"someEvent\">click me</span>{{/foo}}',\n\t\t\t\tdata: {\n\t\t\t\t\tfoo: { bar: 'test' }\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tractive.on( 'someEvent', function ( event ) {\n\t\t\t\tt.equal( event.keypath, 'foo' );\n\t\t\t\tt.equal( event.context.bar, 'test' );\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.test, 'click' );\n\t\t});\n\n\t\ttest( 'event.index stores current indices against their references', function ( t ) {\n\t\t\tvar ractive;\n\n\t\t\texpect( 4 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<ul>{{#array:i}}<li id=\"item_{{i}}\" on-click=\"someEvent\">{{i}}: {{.}}</li>{{/array}}</ul>',\n\t\t\t\tdata: {\n\t\t\t\t\tarray: [ 'a', 'b', 'c', 'd', 'e' ]\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tractive.on( 'someEvent', function ( event ) {\n\t\t\t\tt.equal( event.node.innerHTML, '2: c' );\n\t\t\t\tt.equal( event.keypath, 'array.2' );\n\t\t\t\tt.equal( event.context, 'c' );\n\t\t\t\tt.deepEqual( event.index, { i: 2 })\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.item_2, 'click' );\n\t\t});\n\n\t\ttest( 'event.index reports nested indices correctly', function ( t ) {\n\t\t\tvar ractive;\n\n\t\t\texpect( 2 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '{{#foo:x}}{{#bar:y}}{{#baz:z}}<span id=\"test_{{x}}{{y}}{{z}}\" on-click=\"someEvent\">{{x}}{{y}}{{z}}</span>{{/baz}}{{/bar}}{{/foo}}',\n\t\t\t\tdata: {\n\t\t\t\t\tfoo: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbar: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tbaz: [ 1, 2, 3 ]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tt.equal( ractive.nodes.test_001.innerHTML, '001' );\n\n\t\t\tractive.on( 'someEvent', function ( event ) {\n\t\t\t\tt.deepEqual( event.index, { x: 0, y: 0, z: 1 })\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.test_001, 'click' );\n\t\t});\n\n\t\ttest( 'proxy events can have dynamic names', function ( t ) {\n\t\t\tvar ractive, last;\n\n\t\t\texpect( 2 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<span id=\"test\" on-click=\"do_{{something}}\">click me</span>',\n\t\t\t\tdata: { something: 'foo' }\n\t\t\t});\n\n\t\t\tractive.on({\n\t\t\t\tdo_foo: function ( event ) {\n\t\t\t\t\tlast = 'foo';\n\t\t\t\t},\n\t\t\t\tdo_bar: function ( event ) {\n\t\t\t\t\tlast = 'bar';\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.test, 'click' );\n\t\t\tt.equal( last, 'foo' );\n\n\t\t\tractive.set( 'something', 'bar' );\n\n\t\t\tsimulant.fire( ractive.nodes.test, 'click' );\n\t\t\tt.equal( last, 'bar' );\n\t\t});\n\n\t\ttest( 'proxy event parameters are correctly parsed as JSON, or treated as a string', function ( t ) {\n\t\t\tvar ractive, last;\n\n\t\t\texpect( 3 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<span id=\"foo\" on-click=\"log:one\">click me</span><span id=\"bar\" on-click=\\'log:{\"bar\":true}\\'>click me</span><span id=\"baz\" on-click=\"log:[1,2,3]\">click me</span>'\n\t\t\t});\n\n\t\t\tractive.on({\n\t\t\t\tlog: function ( event, params ) {\n\t\t\t\t\tlast = params;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.foo, 'click' );\n\t\t\tt.equal( last, 'one' );\n\n\t\t\tsimulant.fire( ractive.nodes.bar, 'click' );\n\t\t\tt.deepEqual( last, { bar: true } );\n\n\t\t\tsimulant.fire( ractive.nodes.baz, 'click' );\n\t\t\tt.deepEqual( last, [ 1, 2, 3 ] );\n\t\t});\n\n\t\ttest( 'proxy events can have dynamic arguments', function ( t ) {\n\t\t\tvar ractive;\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<span id=\"foo\" on-click=\"foo:{{foo}}\">click me</span>',\n\t\t\t\tdata: { foo: 'bar' }\n\t\t\t});\n\n\t\t\texpect( 1 );\n\n\t\t\tractive.on({\n\t\t\t\tfoo: function ( event, foo ) {\n\t\t\t\t\tt.equal( foo, 'bar' );\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.foo, 'click' );\n\t\t});\n\n\t\ttest( 'proxy events can have multiple arguments', function ( t ) {\n\t\t\tvar ractive;\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<span id=\"foo\" on-click=\"one:1,2,3\">click me</span><span id=\"bar\" on-click=\"two:{a:1},{b:2}\">click me</span><span id=\"baz\" on-click=\"three:{c:{{c}}},{d:\\'{{d}}\\'}\">click me</span>',\n\t\t\t\tdata: { c: 3, d: 'four' }\n\t\t\t});\n\n\t\t\texpect( 7 );\n\n\t\t\tractive.on({\n\t\t\t\tone: function ( event, one, two, three ) {\n\t\t\t\t\tt.equal( one, 1 );\n\t\t\t\t\tt.equal( two, 2 );\n\t\t\t\t\tt.equal( three, 3 );\n\t\t\t\t},\n\t\t\t\ttwo: function ( event, one, two ) {\n\t\t\t\t\tt.equal( one.a, 1 );\n\t\t\t\t\tt.equal( two.b, 2 );\n\t\t\t\t},\n\t\t\t\tthree: function ( event, three, four ) {\n\t\t\t\t\tt.equal( three.c, 3 );\n\t\t\t\t\tt.equal( four.d, 'four' );\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.foo, 'click' );\n\t\t\tsimulant.fire( ractive.nodes.bar, 'click' );\n\t\t\tsimulant.fire( ractive.nodes.baz, 'click' );\n\t\t});\n\n\t\ttest( 'Splicing arrays correctly modifies proxy events', function ( t ) {\n\t\t\tvar ractive;\n\n\t\t\texpect( 4 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '{{#buttons:i}}<button id=\"button_{{i}}\" on-click=\"remove:{{i}}\">click me</button>{{/buttons}}',\n\t\t\t\tdata: { buttons: new Array(5) }\n\t\t\t});\n\n\t\t\tractive.on( 'remove', function ( event, num ) {\n\t\t\t\tthis.get( 'buttons' ).splice( num, 1 );\n\t\t\t});\n\n\t\t\tt.equal( ractive.findAll( 'button' ).length, 5 );\n\n\t\t\tsimulant.fire( ractive.nodes.button_2, 'click' );\n\t\t\tt.equal( ractive.findAll( 'button' ).length, 4 );\n\n\t\t\tsimulant.fire( ractive.nodes.button_2, 'click' );\n\t\t\tt.equal( ractive.findAll( 'button' ).length, 3 );\n\n\t\t\tsimulant.fire( ractive.nodes.button_2, 'click' );\n\t\t\tt.equal( ractive.findAll( 'button' ).length, 2 );\n\t\t});\n\n\t\ttest( 'Splicing arrays correctly modifies two-way bindings', function ( t ) {\n\t\t\tvar ractive, items;\n\n\t\t\texpect( 25 );\n\n\t\t\titems = [\n\t\t\t\t{ description: 'one' },\n\t\t\t\t{ description: 'two', done: true },\n\t\t\t\t{ description: 'three' }\n\t\t\t];\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<ul>{{#items:i}}<li><input id=\"input_{{i}}\" type=\"checkbox\" checked=\"{{.done}}\"> {{description}}</li>{{/items}}</ul>',\n\t\t\t\tdata: { items: items }\n\t\t\t});\n\n\t\t\t// 1-3\n\t\t\tt.equal( ractive.nodes.input_0.checked, false );\n\t\t\tt.equal( ractive.nodes.input_1.checked, true );\n\t\t\tt.equal( ractive.nodes.input_2.checked, false );\n\n\t\t\t// 4-6\n\t\t\tt.equal( !!ractive.get( 'items.0.done' ), false );\n\t\t\tt.equal( !!ractive.get( 'items.1.done' ), true );\n\t\t\tt.equal( !!ractive.get( 'items.2.done' ), false );\n\n\t\t\tsimulant.fire( ractive.nodes.input_0, 'click' );\n\n\t\t\t// 7-9\n\t\t\tt.equal( ractive.nodes.input_0.checked, true );\n\t\t\tt.equal( ractive.nodes.input_1.checked, true );\n\t\t\tt.equal( ractive.nodes.input_2.checked, false );\n\n\t\t\t// 10-12\n\t\t\tt.equal( !!ractive.get( 'items.0.done' ), true );\n\t\t\tt.equal( !!ractive.get( 'items.1.done' ), true );\n\t\t\tt.equal( !!ractive.get( 'items.2.done' ), false );\n\n\t\t\titems.shift();\n\n\t\t\t// 13-14\n\t\t\tt.equal( ractive.nodes.input_0.checked, true );\n\t\t\tt.equal( ractive.nodes.input_1.checked, false );\n\n\t\t\t// 15-16\n\t\t\tt.equal( !!ractive.get( 'items.0.done' ), true );\n\t\t\tt.equal( !!ractive.get( 'items.1.done' ), false );\n\n\t\t\tsimulant.fire( ractive.nodes.input_0, 'click' );\n\n\t\t\t// 17-18\n\t\t\tt.equal( ractive.nodes.input_0.checked, false );\n\t\t\tt.equal( ractive.nodes.input_1.checked, false );\n\n\t\t\t// 19-20\n\t\t\tt.equal( !!ractive.get( 'items.0.done' ), false );\n\t\t\tt.equal( !!ractive.get( 'items.1.done' ), false );\n\n\t\t\tsimulant.fire( ractive.nodes.input_1, 'click' );\n\n\t\t\t// 21-22\n\t\t\tt.equal( ractive.nodes.input_0.checked, false );\n\t\t\tt.equal( ractive.nodes.input_1.checked, true );\n\n\t\t\t// 23-24\n\t\t\tt.equal( !!ractive.get( 'items.0.done' ), false );\n\t\t\tt.equal( !!ractive.get( 'items.1.done' ), true );\n\n\t\t\t// 25\n\t\t\tt.equal( ractive.findAll( 'input' ).length, 2 );\n\t\t});\n\n\t\ttest( 'Mousedown followed by click results in a tap event', function ( t ) {\n\t\t\tvar ractive, tapped;\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<span id=\"test\" on-tap=\"tap\">tap me</span>',\n\t\t\t\tdebug: true\n\t\t\t});\n\n\t\t\tractive.on( 'tap', function () {\n\t\t\t\ttapped = true;\n\t\t\t});\n\n\t\t\tt.equal( tapped, undefined );\n\t\t\tsimulant.fire( ractive.nodes.test, 'mousedown' );\n\t\t\tsimulant.fire( ractive.nodes.test, 'click' );\n\t\t\tt.equal( tapped, true );\n\t\t});\n\n\t\t// TODO move this into Ractive-events-tap repo\n\t\tasyncTest( 'Pressing spacebar on a focused button results in a tap event', function ( t ) {\n\t\t\tvar ractive, node, tapped;\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<button id=\"test\" on-tap=\"tap\">tap me</button>'\n\t\t\t});\n\n\t\t\tnode = ractive.nodes.test;\n\n\t\t\tractive.on( 'tap', function ( event ) {\n\t\t\t\ttapped = true;\n\t\t\t});\n\n\t\t\tt.equal( tapped, undefined );\n\n\t\t\tsimulant.fire( node, 'keydown', { which: 32 });\n\t\t\tt.equal( tapped, undefined );\n\n\t\t\tnode.focus();\n\t\t\tt.equal( document.activeElement, node );\n\t\t\tsimulant.fire( node, 'keydown', { which: 32 });\n\n\t\t\tsetTimeout( function () {\n\t\t\t\tt.ok( tapped );\n\t\t\t\tstart();\n\t\t\t}, 0 );\n\t\t});\n\n\t\ttest( 'Calling ractive.off() without a keypath removes all handlers', function ( t ) {\n\t\t\tvar ractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: 'doesn\\'t matter'\n\t\t\t});\n\n\t\t\texpect( 0 );\n\n\t\t\tractive.on({\n\t\t\t\tfoo: function () {\n\t\t\t\t\tt.ok( false );\n\t\t\t\t},\n\t\t\t\tbar: function () {\n\t\t\t\t\tt.ok( false );\n\t\t\t\t},\n\t\t\t\tbaz: function () {\n\t\t\t\t\tt.ok( false );\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tractive.off();\n\n\t\t\tractive.fire( 'foo' );\n\t\t\tractive.fire( 'bar' );\n\t\t\tractive.fire( 'baz' );\n\t\t});\n\n\t};\n\n});\n",
                "new_contents": "// EVENT TESTS\n// ===========\n//\n// TODO: add moar tests\n\ndefine([ 'Ractive', '../vendor/Ractive-events-tap' ], function ( Ractive ) {\n\n\treturn function () {\n\n\t\tvar fixture = document.getElementById( 'qunit-fixture' );\n\n\t\tmodule( 'Events' );\n\n\t\ttest( 'on-click=\"someEvent\" fires an event when user clicks the element', function ( t ) {\n\t\t\tvar ractive;\n\n\t\t\texpect( 2 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<span id=\"test\" on-click=\"someEvent\">click me</span>'\n\t\t\t});\n\n\t\t\tractive.on( 'someEvent', function ( event ) {\n\t\t\t\tt.ok( true );\n\t\t\t\tt.equal( event.original.type, 'click' );\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.test, 'click' );\n\t\t});\n\n\t\ttest( 'Standard events have correct properties: node, original, keypath, context, index', function ( t ) {\n\t\t\tvar ractive, fakeEvent;\n\n\t\t\texpect( 5 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<span id=\"test\" on-click=\"someEvent\">click me</span>'\n\t\t\t});\n\n\t\t\tractive.on( 'someEvent', function ( event ) {\n\t\t\t\tt.equal( event.node, ractive.nodes.test );\n\t\t\t\tt.ok( event.original );\n\t\t\t\tt.equal( event.keypath, '' );\n\t\t\t\tt.equal( event.context, ractive.data );\n\t\t\t\tt.equal( event.index, undefined );\n\t\t\t});\n\n\t\t\tfakeEvent = simulant( 'click' );\n\n\t\t\tsimulant.fire( ractive.nodes.test, fakeEvent );\n\t\t});\n\n\t\ttest( 'event.keypath is set to the innermost context', function ( t ) {\n\t\t\tvar ractive;\n\n\t\t\texpect( 2 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '{{#foo}}<span id=\"test\" on-click=\"someEvent\">click me</span>{{/foo}}',\n\t\t\t\tdata: {\n\t\t\t\t\tfoo: { bar: 'test' }\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tractive.on( 'someEvent', function ( event ) {\n\t\t\t\tt.equal( event.keypath, 'foo' );\n\t\t\t\tt.equal( event.context.bar, 'test' );\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.test, 'click' );\n\t\t});\n\n\t\ttest( 'event.index stores current indices against their references', function ( t ) {\n\t\t\tvar ractive;\n\n\t\t\texpect( 4 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<ul>{{#array:i}}<li id=\"item_{{i}}\" on-click=\"someEvent\">{{i}}: {{.}}</li>{{/array}}</ul>',\n\t\t\t\tdata: {\n\t\t\t\t\tarray: [ 'a', 'b', 'c', 'd', 'e' ]\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tractive.on( 'someEvent', function ( event ) {\n\t\t\t\tt.equal( event.node.innerHTML, '2: c' );\n\t\t\t\tt.equal( event.keypath, 'array.2' );\n\t\t\t\tt.equal( event.context, 'c' );\n\t\t\t\tt.deepEqual( event.index, { i: 2 })\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.item_2, 'click' );\n\t\t});\n\n\t\ttest( 'event.index reports nested indices correctly', function ( t ) {\n\t\t\tvar ractive;\n\n\t\t\texpect( 2 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '{{#foo:x}}{{#bar:y}}{{#baz:z}}<span id=\"test_{{x}}{{y}}{{z}}\" on-click=\"someEvent\">{{x}}{{y}}{{z}}</span>{{/baz}}{{/bar}}{{/foo}}',\n\t\t\t\tdata: {\n\t\t\t\t\tfoo: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbar: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tbaz: [ 1, 2, 3 ]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tt.equal( ractive.nodes.test_001.innerHTML, '001' );\n\n\t\t\tractive.on( 'someEvent', function ( event ) {\n\t\t\t\tt.deepEqual( event.index, { x: 0, y: 0, z: 1 })\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.test_001, 'click' );\n\t\t});\n\n\t\ttest( 'proxy events can have dynamic names', function ( t ) {\n\t\t\tvar ractive, last;\n\n\t\t\texpect( 2 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<span id=\"test\" on-click=\"do_{{something}}\">click me</span>',\n\t\t\t\tdata: { something: 'foo' }\n\t\t\t});\n\n\t\t\tractive.on({\n\t\t\t\tdo_foo: function ( event ) {\n\t\t\t\t\tlast = 'foo';\n\t\t\t\t},\n\t\t\t\tdo_bar: function ( event ) {\n\t\t\t\t\tlast = 'bar';\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.test, 'click' );\n\t\t\tt.equal( last, 'foo' );\n\n\t\t\tractive.set( 'something', 'bar' );\n\n\t\t\tsimulant.fire( ractive.nodes.test, 'click' );\n\t\t\tt.equal( last, 'bar' );\n\t\t});\n\n\t\ttest( 'proxy event parameters are correctly parsed as JSON, or treated as a string', function ( t ) {\n\t\t\tvar ractive, last;\n\n\t\t\texpect( 3 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<span id=\"foo\" on-click=\"log:one\">click me</span><span id=\"bar\" on-click=\\'log:{\"bar\":true}\\'>click me</span><span id=\"baz\" on-click=\"log:[1,2,3]\">click me</span>'\n\t\t\t});\n\n\t\t\tractive.on({\n\t\t\t\tlog: function ( event, params ) {\n\t\t\t\t\tlast = params;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.foo, 'click' );\n\t\t\tt.equal( last, 'one' );\n\n\t\t\tsimulant.fire( ractive.nodes.bar, 'click' );\n\t\t\tt.deepEqual( last, { bar: true } );\n\n\t\t\tsimulant.fire( ractive.nodes.baz, 'click' );\n\t\t\tt.deepEqual( last, [ 1, 2, 3 ] );\n\t\t});\n\n\t\ttest( 'proxy events can have dynamic arguments', function ( t ) {\n\t\t\tvar ractive;\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<span id=\"foo\" on-click=\"foo:{{foo}}\">click me</span>',\n\t\t\t\tdata: { foo: 'bar' }\n\t\t\t});\n\n\t\t\texpect( 1 );\n\n\t\t\tractive.on({\n\t\t\t\tfoo: function ( event, foo ) {\n\t\t\t\t\tt.equal( foo, 'bar' );\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.foo, 'click' );\n\t\t});\n\n\t\ttest( 'proxy events can have multiple arguments', function ( t ) {\n\t\t\tvar ractive;\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<span id=\"foo\" on-click=\"one:1,2,3\">click me</span><span id=\"bar\" on-click=\"two:{a:1},{b:2}\">click me</span><span id=\"baz\" on-click=\"three:{c:{{c}}},{d:\\'{{d}}\\'}\">click me</span>',\n\t\t\t\tdata: { c: 3, d: 'four' }\n\t\t\t});\n\n\t\t\texpect( 7 );\n\n\t\t\tractive.on({\n\t\t\t\tone: function ( event, one, two, three ) {\n\t\t\t\t\tt.equal( one, 1 );\n\t\t\t\t\tt.equal( two, 2 );\n\t\t\t\t\tt.equal( three, 3 );\n\t\t\t\t},\n\t\t\t\ttwo: function ( event, one, two ) {\n\t\t\t\t\tt.equal( one.a, 1 );\n\t\t\t\t\tt.equal( two.b, 2 );\n\t\t\t\t},\n\t\t\t\tthree: function ( event, three, four ) {\n\t\t\t\t\tt.equal( three.c, 3 );\n\t\t\t\t\tt.equal( four.d, 'four' );\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tsimulant.fire( ractive.nodes.foo, 'click' );\n\t\t\tsimulant.fire( ractive.nodes.bar, 'click' );\n\t\t\tsimulant.fire( ractive.nodes.baz, 'click' );\n\t\t});\n\n\t\ttest( 'Splicing arrays correctly modifies proxy events', function ( t ) {\n\t\t\tvar ractive;\n\n\t\t\texpect( 4 );\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '{{#buttons:i}}<button id=\"button_{{i}}\" on-click=\"remove:{{i}}\">click me</button>{{/buttons}}',\n\t\t\t\tdata: { buttons: new Array(5) }\n\t\t\t});\n\n\t\t\tractive.on( 'remove', function ( event, num ) {\n\t\t\t\tthis.get( 'buttons' ).splice( num, 1 );\n\t\t\t});\n\n\t\t\tt.equal( ractive.findAll( 'button' ).length, 5 );\n\n\t\t\tsimulant.fire( ractive.nodes.button_2, 'click' );\n\t\t\tt.equal( ractive.findAll( 'button' ).length, 4 );\n\n\t\t\tsimulant.fire( ractive.nodes.button_2, 'click' );\n\t\t\tt.equal( ractive.findAll( 'button' ).length, 3 );\n\n\t\t\tsimulant.fire( ractive.nodes.button_2, 'click' );\n\t\t\tt.equal( ractive.findAll( 'button' ).length, 2 );\n\t\t});\n\n\t\ttest( 'Splicing arrays correctly modifies two-way bindings', function ( t ) {\n\t\t\tvar ractive, items;\n\n\t\t\texpect( 25 );\n\n\t\t\titems = [\n\t\t\t\t{ description: 'one' },\n\t\t\t\t{ description: 'two', done: true },\n\t\t\t\t{ description: 'three' }\n\t\t\t];\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<ul>{{#items:i}}<li><input id=\"input_{{i}}\" type=\"checkbox\" checked=\"{{.done}}\"> {{description}}</li>{{/items}}</ul>',\n\t\t\t\tdata: { items: items }\n\t\t\t});\n\n\t\t\t// 1-3\n\t\t\tt.equal( ractive.nodes.input_0.checked, false );\n\t\t\tt.equal( ractive.nodes.input_1.checked, true );\n\t\t\tt.equal( ractive.nodes.input_2.checked, false );\n\n\t\t\t// 4-6\n\t\t\tt.equal( !!ractive.get( 'items.0.done' ), false );\n\t\t\tt.equal( !!ractive.get( 'items.1.done' ), true );\n\t\t\tt.equal( !!ractive.get( 'items.2.done' ), false );\n\n\t\t\tsimulant.fire( ractive.nodes.input_0, 'click' );\n\n\t\t\t// 7-9\n\t\t\tt.equal( ractive.nodes.input_0.checked, true );\n\t\t\tt.equal( ractive.nodes.input_1.checked, true );\n\t\t\tt.equal( ractive.nodes.input_2.checked, false );\n\n\t\t\t// 10-12\n\t\t\tt.equal( !!ractive.get( 'items.0.done' ), true );\n\t\t\tt.equal( !!ractive.get( 'items.1.done' ), true );\n\t\t\tt.equal( !!ractive.get( 'items.2.done' ), false );\n\n\t\t\titems.shift();\n\n\t\t\t// 13-14\n\t\t\tt.equal( ractive.nodes.input_0.checked, true );\n\t\t\tt.equal( ractive.nodes.input_1.checked, false );\n\n\t\t\t// 15-16\n\t\t\tt.equal( !!ractive.get( 'items.0.done' ), true );\n\t\t\tt.equal( !!ractive.get( 'items.1.done' ), false );\n\n\t\t\tsimulant.fire( ractive.nodes.input_0, 'click' );\n\n\t\t\t// 17-18\n\t\t\tt.equal( ractive.nodes.input_0.checked, false );\n\t\t\tt.equal( ractive.nodes.input_1.checked, false );\n\n\t\t\t// 19-20\n\t\t\tt.equal( !!ractive.get( 'items.0.done' ), false );\n\t\t\tt.equal( !!ractive.get( 'items.1.done' ), false );\n\n\t\t\tsimulant.fire( ractive.nodes.input_1, 'click' );\n\n\t\t\t// 21-22\n\t\t\tt.equal( ractive.nodes.input_0.checked, false );\n\t\t\tt.equal( ractive.nodes.input_1.checked, true );\n\n\t\t\t// 23-24\n\t\t\tt.equal( !!ractive.get( 'items.0.done' ), false );\n\t\t\tt.equal( !!ractive.get( 'items.1.done' ), true );\n\n\t\t\t// 25\n\t\t\tt.equal( ractive.findAll( 'input' ).length, 2 );\n\t\t});\n\n\t\ttest( 'Mousedown followed by click results in a tap event', function ( t ) {\n\t\t\tvar ractive, tapped;\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<span id=\"test\" on-tap=\"tap\">tap me</span>',\n\t\t\t\tdebug: true\n\t\t\t});\n\n\t\t\tractive.on( 'tap', function () {\n\t\t\t\ttapped = true;\n\t\t\t});\n\n\t\t\tt.equal( tapped, undefined );\n\t\t\tsimulant.fire( ractive.nodes.test, 'mousedown' );\n\t\t\tsimulant.fire( ractive.nodes.test, 'click' );\n\t\t\tt.equal( tapped, true );\n\t\t});\n\n\t\t// TODO move this into Ractive-events-tap repo\n\t\tasyncTest( 'Pressing spacebar on a focused button results in a tap event', function ( t ) {\n\t\t\tvar ractive, node, tapped;\n\n\t\t\tractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '<button id=\"test\" on-tap=\"tap\">tap me</button>'\n\t\t\t});\n\n\t\t\tnode = ractive.nodes.test;\n\n\t\t\tractive.on( 'tap', function ( event ) {\n\t\t\t\ttapped = true;\n\t\t\t});\n\n\t\t\tt.equal( tapped, undefined );\n\n\t\t\tsimulant.fire( node, 'keydown', { which: 32 });\n\t\t\tt.equal( tapped, undefined );\n\n\t\t\tnode.focus();\n\t\t\tt.equal( document.activeElement, node );\n\t\t\tsimulant.fire( node, 'keydown', { which: 32 });\n\n\t\t\tsetTimeout( function () {\n\t\t\t\tt.ok( tapped );\n\t\t\t\tstart();\n\t\t\t}, 0 );\n\t\t});\n\n\t\ttest( 'Calling ractive.off() without a keypath removes all handlers', function ( t ) {\n\t\t\tvar ractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: 'doesn\\'t matter'\n\t\t\t});\n\n\t\t\texpect( 0 );\n\n\t\t\tractive.on({\n\t\t\t\tfoo: function () {\n\t\t\t\t\tt.ok( false );\n\t\t\t\t},\n\t\t\t\tbar: function () {\n\t\t\t\t\tt.ok( false );\n\t\t\t\t},\n\t\t\t\tbaz: function () {\n\t\t\t\t\tt.ok( false );\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tractive.off();\n\n\t\t\tractive.fire( 'foo' );\n\t\t\tractive.fire( 'bar' );\n\t\t\tractive.fire( 'baz' );\n\t\t});\n\n\t\ttest( 'Changes triggered by two-way bindings propagate properly (#460)', function ( t ) {\n\t\t\tvar changes, ractive = new Ractive({\n\t\t\t\tel: fixture,\n\t\t\t\ttemplate: '{{#items}}<label><input type=\"checkbox\" checked=\"{{completed}}\"> {{description}}</label>{{/items}}<p class=\"result\">{{ items.filter( completed ).length }}</p>',\n\t\t\t\tdata: {\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{ completed: true, description: 'fix this bug' },\n\t\t\t\t\t\t{ completed: false, description: 'fix other bugs' },\n\t\t\t\t\t\t{ completed: false, description: 'housework' }\n\t\t\t\t\t],\n\t\t\t\t\tcompleted: function ( item ) {\n\t\t\t\t\t\treturn !!item.completed;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tractive.on( 'change', function ( c ) {\n\t\t\t\tchanges = c;\n\t\t\t});\n\n\t\t\tt.htmlEqual( ractive.find( '.result' ).innerHTML, '1' );\n\n\t\t\tsimulant.fire( ractive.findAll( 'input' )[1], 'click' );\n\t\t\tt.htmlEqual( ractive.find( '.result' ).innerHTML, '2' );\n\n\t\t\tt.deepEqual( changes, { 'items.1.completed': true });\n\t\t});\n\n\t};\n\n});\n",
                "subject": "test for #460",
                "message": "test for #460\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "squaredup/ractive,ndimas/ractive,npmcomponent/RactiveJS-Ractive,pingjiang/ractive,pingjiang/ractive,ISNIT0/ractive,ndimas/ractive,pingjiang/ractive,JonDum/ractive,marcalexiei/ractive,thomsbg/ractive,dyx/ractive,heavyk/ractive,squaredup/ractive,heavyk/ractive,ractivejs/ractive,cgvarela/ractive,thomsbg/ractive,dyx/ractive,magicdawn/ractive,magicdawn/ractive,Rich-Harris/ractive,magicdawn/ractive,JonDum/ractive,aliprogrammer69/ractive,squaredup/ractive,aliprogrammer69/ractive,cgvarela/ractive,aliprogrammer69/ractive,marcalexiei/ractive,JonDum/ractive,ractivejs/ractive,dyx/ractive,ISNIT0/ractive,npmcomponent/RactiveJS-Ractive,Rich-Harris/ractive,thomsbg/ractive,cgvarela/ractive,marcalexiei/ractive,ndimas/ractive,ractivejs/ractive,ISNIT0/ractive,Rich-Harris/ractive,heavyk/ractive,p0lax/ractive,p0lax/ractive"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10248,
            "row": {
                "commit": "6e0124a56641b9873c9ead38913fab4f198455a8",
                "old_file": "js/ViewController.js",
                "new_file": "js/ViewController.js",
                "old_contents": "\n(function( window, $ ) {\n\n    \"use strict\";\n\n\n\n    /* Global Variables */\n\n    var listItems = $('.item');\n    var buttons   = $('.btn');\n\n    var framework = \"\";\n\n\n\n    /* Auxiliary Functions */\n\n    var loadIframe = function( iframe, test ) {\n\n        iframe = iframe[0];\n\n        var path = '../js/'  + framework + '/';\n\n        var js   = path + test + '.js';\n        var script= document.createElement('script');\n        script.type= 'text/javascript';\n        script.src= js;\n\n        var bodyiframe = iframe.contentDocument.body;\n        bodyiframe.appendChild( script );\n\n        toggleJaxCanvas( bodyiframe );\n\n    };\n\n\n    var loadTest = function ( test, callback ) {\n\n        var iframe = $('iframe');\n        iframe.attr({ 'src' : 'html/iframe.html' });\n\n        setTimeout(function() {\n            callback(iframe, test);\n        }, 200);\n\n    };\n\n\n    var getNameTest = function ( test ) {\n\n        var nameTest = test.find('a').attr('href');\n        return nameTest.slice( 1, nameTest.length );\n\n    };\n\n\n    var toggleJaxCanvas = function( body ) {\n\n        var jaxCanvas = $(body).find('#canvas');\n\n        if ( framework === 'jax' ) {\n            jaxCanvas.removeClass('hidden');\n\n        } else {\n            jaxCanvas.addClass('hidden');\n        }\n\n    };\n\n\n\n    /* Event Handlers */\n\n    var testHandler = function ( event ) {\n\n        event.preventDefault();\n\n        var num = $(this).prevAll().length;\n\n        listItems.removeClass('active');\n        var test = listItems.eq(num).addClass('active');\n\n        var nameTest = getNameTest( test );\n\n        loadTest( nameTest, loadIframe );\n\n    };\n\n\n    var buttonsHandler = function( event, param ) {\n\n        buttons.removeClass('active');\n        var b = $(event.target).toggleClass('active');\n\n        var f = b.text();\n        framework = f.toLowerCase();\n\n        var test = listItems.filter(function(i) {\n            return listItems.eq(i).hasClass('active');\n        });\n\n        var nameTest = getNameTest( test );\n        loadTest( nameTest, loadIframe );\n\n    };\n\n\n    /*\n    var showAlert = function ( opt ) {\n\n        var alert = $('.alert');\n        var TIME = 5000;\n\n        if ( alert.css('display') === 'none' ) {\n            alert.fadeIn();\n            setTimeout(function() {\n                alert.fadeOut();\n            }, TIME);\n        }\n\n    };\n    */\n\n\n\n    /* Main */\n\n    (function() {\n\n        // Initialize visualizator loading the first test and first framework\n        var name = getNameTest( listItems.first() );\n        loadTest( name, loadIframe );\n\n        framework = buttons.first()\n                        .addClass('active')\n                        .text().toLowerCase();\n\n\n        // Event Assignments\n        $(listItems).on('click', testHandler);\n        $(buttons).on('click', buttonsHandler);\n\n    })();\n\n\n\n\n})( window, jQuery );\n",
                "new_contents": "\n(function( window, $ ) {\n\n    \"use strict\";\n\n\n\n    /* Global Variables */\n\n    var listItems = $('.item');\n    var buttons   = $('.btn');\n\n    var framework = \"\";\n\n\n\n    /* Auxiliary Functions */\n\n    var loadIframe = function( iframe, test ) {\n\n        iframe = iframe[0];\n\n        var path = '../js/'  + framework + '/';\n\n        var script  = document.createElement('script');\n        script.type = 'text/javascript';\n        script.src  = path + test + '.js';\n\n        var bodyiframe = iframe.contentDocument.body;\n        bodyiframe.appendChild( script );\n\n        toggleJaxCanvas( bodyiframe );\n\n    };\n\n\n    var loadTest = function ( test, callback ) {\n\n        var iframe = $('iframe');\n        iframe.attr({ 'src' : 'html/iframe.html' });\n\n        setTimeout(function() {\n            callback(iframe, test);\n        }, 200);\n\n    };\n\n\n    var getNameTest = function ( test ) {\n\n        var nameTest = test.find('a').attr('href');\n        return nameTest.slice( 1, nameTest.length );\n\n    };\n\n\n    var toggleJaxCanvas = function( body ) {\n\n        var jaxCanvas = $(body).find('#canvas');\n\n        if ( framework === 'jax' ) {\n            jaxCanvas.removeClass('hidden');\n\n        } else {\n            jaxCanvas.addClass('hidden');\n        }\n\n    };\n\n\n\n    /* Event Handlers */\n\n    var testHandler = function ( event ) {\n\n        event.preventDefault();\n\n        var num = $(this).prevAll().length;\n\n        listItems.removeClass('active');\n        var test = listItems.eq(num).addClass('active');\n\n        var nameTest = getNameTest( test );\n\n        loadTest( nameTest, loadIframe );\n\n    };\n\n\n    var buttonsHandler = function( event ) {\n\n        event.preventDefault();\n\n        buttons.removeClass('active');\n        var b = $(event.target).toggleClass('active');\n\n        var f = b.text();\n        framework = f.toLowerCase();\n\n        var test = listItems.filter(function(i) {\n            return listItems.eq(i).hasClass('active');\n        });\n\n        var nameTest = getNameTest( test );\n        loadTest( nameTest, loadIframe );\n\n    };\n\n\n    /*\n    var showAlert = function ( opt ) {\n\n        var alert = $('.alert');\n        var TIME = 5000;\n\n        if ( alert.css('display') === 'none' ) {\n            alert.fadeIn();\n            setTimeout(function() {\n                alert.fadeOut();\n            }, TIME);\n        }\n\n    };\n    */\n\n\n\n    /* Main */\n\n    (function() {\n\n        // Initialize visualizator loading the first test and first framework\n        var name = getNameTest( listItems.first() );\n        loadTest( name, loadIframe );\n\n        framework = buttons.first()\n                        .addClass('active')\n                        .text().toLowerCase();\n\n\n        // Event Assignments\n        $(listItems).on('click', testHandler);\n        $(buttons).on('click', buttonsHandler);\n\n    })();\n\n\n\n})( window, jQuery );\n",
                "subject": "little change",
                "message": "little change\n",
                "lang": "JavaScript",
                "license": "agpl-3.0",
                "repos": "PDI-DGS-Protolab/WebGLExperiments,PDI-DGS-Protolab/WebGLExperiments"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10249,
            "row": {
                "commit": "c6fd98b6e30554d3df7d11c24fa5ae5c7d01ad8f",
                "old_file": "test/node/redirects.js",
                "new_file": "test/node/redirects.js",
                "old_contents": "\nvar EventEmitter = require('events').EventEmitter\n  , request = require('../../')\n  , express = require('express')\n  , assert = require('assert')\n  , app = express()\n  , should = require('should');\n\napp.get('/', function(req, res){\n  res.set('QUERY', JSON.stringify(req.query));\n  res.redirect('/movies');\n});\n\napp.get('/movies', function(req, res){\n  res.set('QUERY', JSON.stringify(req.query));\n  res.redirect('/movies/all');\n});\n\napp.get('/movies/all', function(req, res){\n  res.set('QUERY', JSON.stringify(req.query));\n  res.redirect('/movies/all/0');\n});\n\napp.get('/movies/all/0', function(req, res){\n  res.set('QUERY', JSON.stringify(req.query));\n  res.send('first movie page');\n});\n\napp.get('/movies/random', function(req, res){\n  res.redirect('/movie/4');\n});\n\napp.get('/movie/4', function(req, res){\n  setTimeout(function(){\n    res.send('not-so-random movie');\n  }, 1000);\n});\n\napp.post('/movie', function(req, res){\n  res.redirect('/movies/all/0');\n});\n\napp.get('/tobi', function(req, res){\n  res.send('tobi');\n});\n\napp.get('/relative', function(req, res){\n  res.set('Location', '/tobi');\n  res.status(302).end();\n});\n\napp.get('/header', function(req, res){\n  res.redirect('/header/2');\n});\n\napp.post('/header', function(req, res){\n  res.redirect('/header/2');\n});\n\napp.get('/header/2', function(req, res){\n  res.send(req.headers);\n});\n\napp.get('/bad-redirect', function(req, res){\n  res.status(307).end();\n});\n\napp.listen(3003);\n\ndescribe('request', function(){\n  describe('on redirect', function(){\n    it('should follow Location', function(done){\n      var redirects = [];\n\n      request\n      .get('http://localhost:3003/')\n      .on('redirect', function(res){\n        redirects.push(res.headers.location);\n      })\n      .end(function(err, res){\n        var arr = [];\n        arr.push('/movies');\n        arr.push('/movies/all');\n        arr.push('/movies/all/0');\n        redirects.should.eql(arr);\n        res.text.should.equal('first movie page');\n        done();\n      });\n    })\n\n    it('should retain header fields', function(done){\n      request\n      .get('http://localhost:3003/header')\n      .set('X-Foo', 'bar')\n      .end(function(err, res){\n        res.body.should.have.property('x-foo', 'bar');\n        done();\n      });\n    })\n\n    it('should remove Content-* fields', function(done){\n      request\n      .post('http://localhost:3003/header')\n      .type('txt')\n      .set('X-Foo', 'bar')\n      .set('X-Bar', 'baz')\n      .send('hey')\n      .end(function(err, res){\n        res.body.should.have.property('x-foo', 'bar');\n        res.body.should.have.property('x-bar', 'baz');\n        res.body.should.not.have.property('content-type');\n        res.body.should.not.have.property('content-length');\n        res.body.should.not.have.property('transfer-encoding');\n        done();\n      });\n    })\n\n    it('should preserve timeout across redirects', function(done){\n      request\n      .get('http://localhost:3003/movies/random')\n      .timeout(250)\n      .end(function(err, res){\n        assert(err instanceof Error, 'expected an error');\n        err.should.have.property('timeout', 250);\n        done();\n      });\n    })\n\n    it('should not resend query parameters', function(done) {\n      var redirects = [];\n      var query = [];\n\n      request\n      .get('http://localhost:3003/?foo=bar')\n      .on('redirect', function(res){\n        query.push(res.headers.query);\n        redirects.push(res.headers.location);\n      })\n      .end(function(err, res){\n        var arr = [];\n        arr.push('/movies');\n        arr.push('/movies/all');\n        arr.push('/movies/all/0');\n        redirects.should.eql(arr);\n        res.text.should.equal('first movie page');\n\n        query.should.eql(['{\"foo\":\"bar\"}', '{}', '{}']);\n        res.headers.query.should.eql('{}');\n        done();\n      });\n    })\n\n    it('should handle no location header', function(done){\n      request\n      .get('http://localhost:3003/bad-redirect')\n      .end(function(err, res){\n        err.message.should.equal('No location header for redirect');\n        done();\n      });\n    })\n\n    describe('when relative', function(){\n      it('should construct the FQDN', function(done){\n        var redirects = [];\n\n        request\n        .get('http://localhost:3003/relative')\n        .on('redirect', function(res){\n          redirects.push(res.headers.location);\n        })\n        .end(function(err, res){\n          var arr = [];\n          redirects.should.eql(['/tobi']);\n          res.text.should.equal('tobi');\n          done();\n        });\n      })\n    })\n  })\n\n  describe('req.redirects(n)', function(){\n    it('should alter the default number of redirects to follow', function(done){\n      var redirects = [];\n\n      request\n      .get('http://localhost:3003/')\n      .redirects(2)\n      .on('redirect', function(res){\n        redirects.push(res.headers.location);\n      })\n      .end(function(err, res){\n        var arr = [];\n        assert(res.redirect, 'res.redirect');\n        arr.push('/movies');\n        arr.push('/movies/all');\n        redirects.should.eql(arr);\n        res.text.should.match(/Moved Temporarily/);\n        done();\n      });\n    })\n  })\n\n  describe('on POST', function(){\n    it('should redirect as GET', function(done){\n      var redirects = [];\n\n      request\n      .post('http://localhost:3003/movie')\n      .send({ name: 'Tobi' })\n      .redirects(2)\n      .on('redirect', function(res){\n        redirects.push(res.headers.location);\n      })\n      .end(function(err, res){\n        var arr = [];\n        arr.push('/movies/all/0');\n        redirects.should.eql(arr);\n        res.text.should.equal('first movie page');\n        done();\n      });\n    })\n  })\n})\n",
                "new_contents": "\nvar EventEmitter = require('events').EventEmitter\n  , request = require('../../')\n  , express = require('express')\n  , assert = require('assert')\n  , app = express()\n  , should = require('should');\n\napp.get('/', function(req, res){\n  res.set('QUERY', JSON.stringify(req.query));\n  res.redirect('/movies');\n});\n\napp.get('/movies', function(req, res){\n  res.set('QUERY', JSON.stringify(req.query));\n  res.redirect('/movies/all');\n});\n\napp.get('/movies/all', function(req, res){\n  res.set('QUERY', JSON.stringify(req.query));\n  res.redirect('/movies/all/0');\n});\n\napp.get('/movies/all/0', function(req, res){\n  res.set('QUERY', JSON.stringify(req.query));\n  res.send('first movie page');\n});\n\napp.get('/movies/random', function(req, res){\n  res.redirect('/movie/4');\n});\n\napp.get('/movie/4', function(req, res){\n  setTimeout(function(){\n    res.send('not-so-random movie');\n  }, 1000);\n});\n\napp.post('/movie', function(req, res){\n  res.redirect('/movies/all/0');\n});\n\napp.put('/redirect-303', function(req, res){\n  res.redirect(303, '/reply-method');\n});\n\napp.put('/redirect-307', function(req, res){\n  res.redirect(307, '/reply-method');\n});\n\n\napp.all('/reply-method', function(req, res){\n  res.send('method=' + req.method.toLowerCase());\n});\n\napp.get('/tobi', function(req, res){\n  res.send('tobi');\n});\n\napp.get('/relative', function(req, res){\n  res.set('Location', '/tobi');\n  res.status(302).end();\n});\n\napp.get('/header', function(req, res){\n  res.redirect('/header/2');\n});\n\napp.post('/header', function(req, res){\n  res.redirect('/header/2');\n});\n\napp.get('/header/2', function(req, res){\n  res.send(req.headers);\n});\n\napp.get('/bad-redirect', function(req, res){\n  res.status(307).end();\n});\n\napp.listen(3003);\n\ndescribe('request', function(){\n  describe('on redirect', function(){\n    it('should follow Location', function(done){\n      var redirects = [];\n\n      request\n      .get('http://localhost:3003/')\n      .on('redirect', function(res){\n        redirects.push(res.headers.location);\n      })\n      .end(function(err, res){\n        var arr = [];\n        arr.push('/movies');\n        arr.push('/movies/all');\n        arr.push('/movies/all/0');\n        redirects.should.eql(arr);\n        res.text.should.equal('first movie page');\n        done();\n      });\n    })\n\n    it('should retain header fields', function(done){\n      request\n      .get('http://localhost:3003/header')\n      .set('X-Foo', 'bar')\n      .end(function(err, res){\n        res.body.should.have.property('x-foo', 'bar');\n        done();\n      });\n    })\n\n    it('should remove Content-* fields', function(done){\n      request\n      .post('http://localhost:3003/header')\n      .type('txt')\n      .set('X-Foo', 'bar')\n      .set('X-Bar', 'baz')\n      .send('hey')\n      .end(function(err, res){\n        res.body.should.have.property('x-foo', 'bar');\n        res.body.should.have.property('x-bar', 'baz');\n        res.body.should.not.have.property('content-type');\n        res.body.should.not.have.property('content-length');\n        res.body.should.not.have.property('transfer-encoding');\n        done();\n      });\n    })\n\n    it('should preserve timeout across redirects', function(done){\n      request\n      .get('http://localhost:3003/movies/random')\n      .timeout(250)\n      .end(function(err, res){\n        assert(err instanceof Error, 'expected an error');\n        err.should.have.property('timeout', 250);\n        done();\n      });\n    })\n\n    it('should not resend query parameters', function(done) {\n      var redirects = [];\n      var query = [];\n\n      request\n      .get('http://localhost:3003/?foo=bar')\n      .on('redirect', function(res){\n        query.push(res.headers.query);\n        redirects.push(res.headers.location);\n      })\n      .end(function(err, res){\n        var arr = [];\n        arr.push('/movies');\n        arr.push('/movies/all');\n        arr.push('/movies/all/0');\n        redirects.should.eql(arr);\n        res.text.should.equal('first movie page');\n\n        query.should.eql(['{\"foo\":\"bar\"}', '{}', '{}']);\n        res.headers.query.should.eql('{}');\n        done();\n      });\n    })\n\n    it('should handle no location header', function(done){\n      request\n      .get('http://localhost:3003/bad-redirect')\n      .end(function(err, res){\n        err.message.should.equal('No location header for redirect');\n        done();\n      });\n    })\n\n    describe('when relative', function(){\n      it('should construct the FQDN', function(done){\n        var redirects = [];\n\n        request\n        .get('http://localhost:3003/relative')\n        .on('redirect', function(res){\n          redirects.push(res.headers.location);\n        })\n        .end(function(err, res){\n          var arr = [];\n          redirects.should.eql(['/tobi']);\n          res.text.should.equal('tobi');\n          done();\n        });\n      })\n    })\n  })\n\n  describe('req.redirects(n)', function(){\n    it('should alter the default number of redirects to follow', function(done){\n      var redirects = [];\n\n      request\n      .get('http://localhost:3003/')\n      .redirects(2)\n      .on('redirect', function(res){\n        redirects.push(res.headers.location);\n      })\n      .end(function(err, res){\n        var arr = [];\n        assert(res.redirect, 'res.redirect');\n        arr.push('/movies');\n        arr.push('/movies/all');\n        redirects.should.eql(arr);\n        res.text.should.match(/Moved Temporarily/);\n        done();\n      });\n    })\n  })\n\n  describe('on POST', function(){\n    it('should redirect as GET', function(done){\n      var redirects = [];\n\n      request\n      .post('http://localhost:3003/movie')\n      .send({ name: 'Tobi' })\n      .redirects(2)\n      .on('redirect', function(res){\n        redirects.push(res.headers.location);\n      })\n      .end(function(err, res){\n        var arr = [];\n        arr.push('/movies/all/0');\n        redirects.should.eql(arr);\n        res.text.should.equal('first movie page');\n        done();\n      });\n    })\n  })\n\n  describe('on 303', function(){\n    it('should redirect with same method', function(done){\n      request\n      .put('http://localhost:3003/redirect-303')\n      .send({msg: \"hello\"})\n      .redirects(1)\n      .on('redirect', function(res) {\n        res.headers.location.should.equal('/reply-method')\n      })\n      .end(function(res){\n        res.text.should.equal('method=get');\n        done();\n      })\n    })\n  })\n\n  describe('on 307', function(){\n    it('should redirect with same method', function(done){\n      request\n      .put('http://localhost:3003/redirect-307')\n      .send({msg: \"hello\"})\n      .redirects(1)\n      .on('redirect', function(res) {\n        res.headers.location.should.equal('/reply-method')\n      })\n      .end(function(res){\n        res.text.should.equal('method=put');\n        done();\n      })\n    })\n  })\n})\n",
                "subject": "Test case for 307 redirects",
                "message": "Test case for 307 redirects\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "eligolding/superagent,fredigato/superagent,yeatszhang/superagent,soyuka/superagent,aaroncrows/superagent,jarvisaoieong/superagent,brainbytes/superagent,andyburke/superagent,sutoiku/superagent,visionmedia/superagent,zsh2938/superagent,h1bomb/superagent,killerlayup/superagent,geminiyellow/superagent,brainbytes/superagent,sebastianvera/superagent,ccapndave/superagent,yeatszhang/superagent,simonvizzini/superagent,deltreey/superagent,targos/superagent,reinaldo13/superagent,sebastianvera/superagent,targos/superagent,reinaldo13/superagent,stanzi83/superagent,philipshurpik/superagent,eligolding/superagent,visionmedia/superagent,modulexcite/superagent,aaroncrows/superagent,drinks/superagent,stasha/superagent,kmalakoff/superagent-ls,noikiy/suberagent,puterakahfi/superagent,yussan/superagent,h1bomb/superagent,zsh2938/superagent,craigspaeth/superagent,KingMario/superagent,nemisj/superagent,noikiy/suberagent,stanzi83/superagent,ccapndave/superagent,modulexcite/superagent,brotchie/superagent,andyburke/superagent,fredigato/superagent,ertrzyiks/superagent,visionmedia/superagent,killerlayup/superagent,wushuyi/superagent,geminiyellow/superagent,thejameskyle/superagent,jarvisaoieong/superagent,focusaurus/superagent,puterakahfi/superagent,drinks/superagent,focusaurus/superagent,kmalakoff/superagent-ls,KingMario/superagent,simonvizzini/superagent,sutoiku/superagent,nemisj/superagent,alinz/superagent,philipshurpik/superagent,brotchie/superagent,deltreey/superagent,KuroGuo/suberagent,alinz/superagent,stasha/superagent,thejameskyle/superagent,wushuyi/superagent,ertrzyiks/superagent,RubenVerborgh/superagent,KuroGuo/suberagent,RubenVerborgh/superagent,mvanlonden/superagent-webpack-client,soyuka/superagent,craigspaeth/superagent,yussan/superagent,mvanlonden/superagent-webpack-client"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10250,
            "row": {
                "commit": "44842aef1baacb6c8fee1bab6d2d8dbbae5d79c3",
                "old_file": "cli/server/parseNarrative.js",
                "new_file": "cli/server/parseNarrative.js",
                "old_contents": "const marked = require('marked');\nconst yamlFront = require('yaml-front-matter');  /* https://www.npmjs.com/package/yaml-front-matter */\nconst utils = require(\"../utils\");\n\nconst blockProxyHandler = {\n  set: (target, key, value) => {\n    if (key === \"url\") {\n      const urlParts = value.match(/.*(nextstrain.org|localhost).*?\/+([^?\\s]+)\\??(\\S*)/);\n      target.dataset = urlParts[2];\n      target.query = urlParts[3];\n      return true;\n    } else if (key === \"contents\") {\n      target.__html = marked(value, {sanitize: false, gfm: true});\n      return true;\n    } else if (key === \"mainDisplayMarkdown\") {\n      target[key] = value;\n      return true;\n    }\n    return false;\n  }\n};\n\nconst makeFrontMatterBlock = (frontMatter) => {\n  if (!frontMatter.title || !frontMatter.dataset) {\n    throw new Error(\"Incorrectly formatted frontmatter in narrative file\");\n  }\n  /* create markdown to represent the title page */\n  const markdown = [];\n  markdown.push(`# ${frontMatter.title}`);\n  if (frontMatter.authors) {\n    if (typeof frontMatter.authors === 'object' && Array.isArray(frontMatter.authors)) {\n      utils.warn(`Narrative parsing -- can't do author arrays yet`);\n    } else if (typeof frontMatter.authors === 'string') {\n      if (frontMatter.authorLinks && typeof frontMatter.authorLinks === \"string\") {\n        markdown.push(`### Author: [${frontMatter.authors}](${frontMatter.authorLinks})`);\n      } else {\n        markdown.push(`### Author: ${frontMatter.authors}`);\n      }\n      if (frontMatter.affiliations && typeof frontMatter.affiliations === \"string\") {\n        markdown[markdown.length-1] += \" <sup> 1 </sup>\";\n        markdown.push(`<sup> 1 </sup> ${frontMatter.affiliations}`);\n      }\n    }\n  }\n  if (frontMatter.date && typeof frontMatter.date === \"string\") {\n    markdown.push(`### Created: ${frontMatter.date}`);\n  }\n  if (frontMatter.updated && typeof frontMatter.updated === \"string\") {\n    markdown.push(`### Updated: ${frontMatter.updated}`);\n  }\n  if (frontMatter.abstract && typeof frontMatter.abstract === \"string\") {\n    markdown.push(`#### ${frontMatter.abstract}`);\n  }\n\n  const block = new Proxy({}, blockProxyHandler);\n  block.url = frontMatter.dataset;\n  block.contents = markdown.join(\"\\n\");\n  return block;\n};\n\n/**\n * Extract a code-block from the content, if it exists, tagged as auspiceMainDisplayMarkdown\n * Which we send to the client under a special key for parsing in the main display\n * This functionality is experimental, undocumented & subject to change.\n * The implementation relies on regex matching, which is not the best long term solution.\n */\nconst extractAuspiceMainDisplayMarkdown = (paragraph) => {\n  const groups = paragraph.match(/([\\s\\S]*)```auspiceMainDisplayMarkdown\\n([\\s\\S]+)\\n```([\\s\\S]*)/);\n  if (!groups) return [paragraph, false];\n\n  return [\n    groups[1]+groups[3], // the content above & below the auspiceMainDisplayMarkdown block\n    groups[2]            // the content within the auspiceMainDisplayMarkdown block\n  ];\n};\n\n/**\n * parses text (from the narrative markdown file)\n * into blocks.\n * Returned object (blocks) has properties \"__html\", \"dataset\", \"query\"\n * and will be sent (in JSON form) to the client\n * @param {string} fileContents string representing the entire markdown file\n * @return {Array} Array of Objects. See `blockProxyHandler` for shape of each object.\n */\nconst parseNarrativeFile = (fileContents) => {\n  const blocks = [];\n  const frontMatter = yamlFront.loadFront(fileContents);\n\n  const titlesAndParagraphs = frontMatter.__content\n    .replace(/\\r\\n/g, \"\\n\")                 // handle files with CRLF endings (windows)\n    .split(/\\n*[#\\s]+(\\[.+?\\]\\(.+?\\))\\n+/)  // matches titles defined as: # [title](url)\n    .filter((e) => !e.match(/^\\s*$/));      // remove empty paragraphs (often leading / trailing)\n\n  /* process the frontmatter content */\n  blocks.push(makeFrontMatterBlock(frontMatter));\n\n  /* process the markdown content */\n  const isTitle = (s) => s.match(/^\\[.+?\\]\\(.+?\\)$/);\n  let idx = 0;\n  while (idx < titlesAndParagraphs.length) {\n    if (!isTitle(titlesAndParagraphs[idx])) {\n      idx++; continue;\n    }\n\n    /* want to capture the following groups:\n    title text (1st element) and URL, possibly including query (2nd element) */\n    const matches = titlesAndParagraphs[idx].match(/\\[(.+?)\\]\\((\\S+)\\)/);\n    let paragraphContents = `# ${matches[1]}\\n`; // the title text\n    /* add in the next paragraph _if_ it's not itself a title */\n    if (!isTitle(titlesAndParagraphs[++idx])) {\n      paragraphContents += titlesAndParagraphs[idx++];\n    }\n\n    let mainDisplayMarkdown;\n    [paragraphContents, mainDisplayMarkdown] = extractAuspiceMainDisplayMarkdown(paragraphContents);\n\n    const block = new Proxy({}, blockProxyHandler);\n    block.url = matches[2];\n    block.contents = paragraphContents;\n    if (mainDisplayMarkdown) block.mainDisplayMarkdown = mainDisplayMarkdown;\n    blocks.push(block);\n  }\n\n  return blocks;\n};\n\n\nmodule.exports = {\n  default: parseNarrativeFile\n};\n",
                "new_contents": "const marked = require('marked');\nconst yamlFront = require('yaml-front-matter');  /* https://www.npmjs.com/package/yaml-front-matter */\nconst utils = require(\"../utils\");\n\nconst blockProxyHandler = {\n  set: (target, key, value) => {\n    if (key === \"url\") {\n      const urlParts = value.match(/.*(nextstrain.org|localhost).*?\/+([^?\\s]+)\\??(\\S*)/);\n      target.dataset = urlParts[2];\n      target.query = urlParts[3];\n      return true;\n    } else if (key === \"contents\") {\n      target.__html = marked(value, {sanitize: false, gfm: true});\n      return true;\n    } else if (key === \"mainDisplayMarkdown\") {\n      target[key] = value;\n      return true;\n    }\n    return false;\n  }\n};\n\nconst makeFrontMatterBlock = (frontMatter) => {\n  if (!frontMatter.title || !frontMatter.dataset) {\n    throw new Error(\"Incorrectly formatted frontmatter in narrative file\");\n  }\n  /* create markdown to represent the title page */\n  const markdown = [];\n  markdown.push(`# ${frontMatter.title}`);\n  if (frontMatter.authors) {\n    let authors = parseContributors(frontMatter, \"authors\", \"authorLinks\");\n    if (authors) {\n      markdown.push(`### Author: ${authors}`);\n      if (frontMatter.affiliations && typeof frontMatter.affiliations === \"string\") {\n        markdown[markdown.length-1] += \" <sup> 1 </sup>\";\n        markdown.push(`<sup> 1 </sup> ${frontMatter.affiliations}`);\n      }\n    }\n  }\n  if (frontMatter.translators) {\n    let translators = parseContributors(frontMatter, \"translators\", \"translatorLinks\");\n    if (translators) {\n      markdown.push(`### Translators: ${translators}`);\n    }\n  }\n  if (frontMatter.date && typeof frontMatter.date === \"string\") {\n    markdown.push(`### Created: ${frontMatter.date}`);\n  }\n  if (frontMatter.updated && typeof frontMatter.updated === \"string\") {\n    markdown.push(`### Updated: ${frontMatter.updated}`);\n  }\n  if (frontMatter.abstract && typeof frontMatter.abstract === \"string\") {\n    markdown.push(`#### ${frontMatter.abstract}`);\n  }\n\n  const block = new Proxy({}, blockProxyHandler);\n  block.url = frontMatter.dataset;\n  block.contents = markdown.join(\"\\n\");\n  return block;\n};\n\nconst parseContributors = (frontMatter, contributorsKey, contributorLinksKey) => {\n  const contributors = frontMatter[contributorsKey];\n  const contributorLinks = frontMatter[contributorLinksKey];\n\n  if (Array.isArray(contributors)) {\n    return parseContributorsArray(contributors, contributorLinks, contributorsKey, contributorLinksKey);\n  } else if (typeof contributors === 'string') {\n    return parseContributorsString(contributors, contributorLinks, contributorsKey, contributorLinksKey);\n  }\n}\n\nconst parseContributorsArray = (contributors, contributorLinks, contributorsKey, contributorLinksKey) => {\n  // validate links\n  if (contributorLinks) {\n    if (!Array.isArray(contributorLinks)) {\n      utils.warn(`Narrative parsing - if ${contributorsKey} is an array, then ${contributorLinksKey} must also be an array. Skipping links.`);\n      contributorLinks = undefined;\n    } else if (contributorLinks.length != contributors.length) {\n      utils.warn(`Narrative parsing - the length of ${contributorsKey} and ${contributorLinksKey} did not match. Skipping links.`);\n      contributorLinks = undefined;\n    }\n  }\n\n  if (contributorLinks) {\n    contributors = contributors.map((contributor, idx) => {\n      return contributorLink(contributor, contributorLinks[idx]);\n    });\n  }\n\n  return contributors.join(\", \");\n}\n\nconst parseContributorsString = (contributors, contributorLinks, contributorsKey, contributorLinksKey) => {\n  // validate links\n  if (contributorLinks) {\n    if (typeof contributorLinks !== \"string\") {\n      utils.warn(`Narrative parsing - if ${contributorsKey} is a string, then ${contributorLinksKey} must also be a string. Skipping links.`);\n      contributorLinks = undefined;\n    }\n  }\n\n  return contributorLink(contributors, contributorLinks);\n}\n\nconst contributorLink = (contributor, contributorLink) => {\n  if (contributorLink) {\n    return `[${contributor}](${contributorLink})`;\n  }\n  return contributor;\n}\n\n/**\n * Extract a code-block from the content, if it exists, tagged as auspiceMainDisplayMarkdown\n * Which we send to the client under a special key for parsing in the main display\n * This functionality is experimental, undocumented & subject to change.\n * The implementation relies on regex matching, which is not the best long term solution.\n */\nconst extractAuspiceMainDisplayMarkdown = (paragraph) => {\n  const groups = paragraph.match(/([\\s\\S]*)```auspiceMainDisplayMarkdown\\n([\\s\\S]+)\\n```([\\s\\S]*)/);\n  if (!groups) return [paragraph, false];\n\n  return [\n    groups[1]+groups[3], // the content above & below the auspiceMainDisplayMarkdown block\n    groups[2]            // the content within the auspiceMainDisplayMarkdown block\n  ];\n};\n\n/**\n * parses text (from the narrative markdown file)\n * into blocks.\n * Returned object (blocks) has properties \"__html\", \"dataset\", \"query\"\n * and will be sent (in JSON form) to the client\n * @param {string} fileContents string representing the entire markdown file\n * @return {Array} Array of Objects. See `blockProxyHandler` for shape of each object.\n */\nconst parseNarrativeFile = (fileContents) => {\n  const blocks = [];\n  const frontMatter = yamlFront.loadFront(fileContents);\n\n  const titlesAndParagraphs = frontMatter.__content\n    .replace(/\\r\\n/g, \"\\n\")                 // handle files with CRLF endings (windows)\n    .split(/\\n*[#\\s]+(\\[.+?\\]\\(.+?\\))\\n+/)  // matches titles defined as: # [title](url)\n    .filter((e) => !e.match(/^\\s*$/));      // remove empty paragraphs (often leading / trailing)\n\n  /* process the frontmatter content */\n  blocks.push(makeFrontMatterBlock(frontMatter));\n\n  /* process the markdown content */\n  const isTitle = (s) => s.match(/^\\[.+?\\]\\(.+?\\)$/);\n  let idx = 0;\n  while (idx < titlesAndParagraphs.length) {\n    if (!isTitle(titlesAndParagraphs[idx])) {\n      idx++; continue;\n    }\n\n    /* want to capture the following groups:\n    title text (1st element) and URL, possibly including query (2nd element) */\n    const matches = titlesAndParagraphs[idx].match(/\\[(.+?)\\]\\((\\S+)\\)/);\n    let paragraphContents = `# ${matches[1]}\\n`; // the title text\n    /* add in the next paragraph _if_ it's not itself a title */\n    if (!isTitle(titlesAndParagraphs[++idx])) {\n      paragraphContents += titlesAndParagraphs[idx++];\n    }\n\n    let mainDisplayMarkdown;\n    [paragraphContents, mainDisplayMarkdown] = extractAuspiceMainDisplayMarkdown(paragraphContents);\n\n    const block = new Proxy({}, blockProxyHandler);\n    block.url = matches[2];\n    block.contents = paragraphContents;\n    if (mainDisplayMarkdown) block.mainDisplayMarkdown = mainDisplayMarkdown;\n    blocks.push(block);\n  }\n\n  return blocks;\n};\n\n\nmodule.exports = {\n  default: parseNarrativeFile\n};\n",
                "subject": "Issue 933: Add translators to narrative parsing",
                "message": "Issue 933: Add translators to narrative parsing\n",
                "lang": "JavaScript",
                "license": "agpl-3.0",
                "repos": "nextstrain/auspice,nextstrain/auspice,nextstrain/auspice"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10251,
            "row": {
                "commit": "fb416aefa1ed97c08729a7a2aae095e4e3db9b87",
                "old_file": "test/nodejs/PCAtest.js",
                "new_file": "test/nodejs/PCAtest.js",
                "old_contents": "/**\n * Copyright (c) 2015, Jozef Stefan Institute, Quintelligence d.o.o. and contributors\n * All rights reserved.\n * \n * This source code is licensed under the FreeBSD license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n// JavaScript source code\nvar la = require(\"qminer\").la;\nvar analytics = require(\"qminer\").analytics;\nvar assert = require(\"../../src/nodejs/scripts/assert.js\");\n//Unit test for PCA\n\ndescribe(\"PCA test\", function () {\n    beforeEach(function () {\n\n    });\n    afterEach(function () {\n\n    });\n    describe(\"Constructor tests\", function () {\n        it(\"should not throw an exception\", function () {\n            assert.doesNotThrow(function () {\n                var pca = new analytics.PCA();\n            });\n        });\n        it(\"should return default values of parameters\", function () {\n            var pca = new analytics.PCA();\n            var params = pca.getParams();\n            assert.equal(params.iter, undefined);\n            assert.equal(params.k, undefined);\n        });\n        it(\"should return values of parameters\", function () {\n            var pca = new analytics.PCA({iter: 100, k: 50});\n            var params = pca.getParams();\n            assert.equal(params.iter, 100);\n            assert.equal(params.k, 50);\n        });\n        it(\"should return values of parameters and added keys\", function () {\n            var pca = new analytics.PCA({iter: 30, alpha: 3});\n            var params = pca.getParams();\n            assert.equal(params.iter, 30);\n            assert.equal(params.alpha, 3);\n        });\n        it(\"should return empty model parameters\", function () {\n            var pca = new analytics.PCA();\n            var model = pca.getModel();\n            assert.equal(model.P, undefined);\n            assert.equal(model.lambda, undefined);\n            assert.equal(model.mu, undefined);\n        });\n    });\n    describe(\"testing setParams\", function () {\n        it(\"should return changed values of parameters\", function () {\n            var pca = new analytics.PCA();\n            pca.setParams({iter: 10, k: 5});\n            var params = pca.getParams();\n            assert.equal(params.iter, 10);\n            assert.equal(params.k, 5);\n        });\n        it(\"should return changed values of parameters and added key values\", function () {\n            var pca = new analytics.PCA();\n            pca.setParams({ iter: 10, beta: 30 });\n            var params = pca.getParams();\n            assert.equal(params.iter, 10);\n            assert.equal(params.beta, 30);\n        });\n    });\n    describe(\"Fit testing\", function () {\n        it(\"should not throw an exception creating a model\", function () {\n            var pca = new analytics.PCA();\n            var matrix = new la.Matrix([[1, -1], [0, 0]]);\n            assert.doesNotThrow(function () {\n                pca.fit(matrix);\n            });\n        });\n        it(\"should throw an exception because k is bigger than matrix dimensions\", function () {\n            var pca = new analytics.PCA({ k: 5});\n            var matrix = new la.Matrix([[1, -1], [0, 0]]);\n            assert.throws(function () {\n                pca.fit(matrix);\n            });\n        });\n        it.skip(\"should return the model parameters after using fit\", function () {\n            var pca = new analytics.PCA();\n            var matrix = new la.Matrix([[0, 1], [-1, 0]]);\n            pca.fit(matrix);\n            var model = pca.getModel();\n            assert.eqtol(model.lambda[0], 1);\n            assert.eqtol(model.lambda[1], 0);\n            assert.eqtol(model.mu[0], -0.5);\n            assert.eqtol(model.mu[1], 0.5);\n            //assert.eqtol(model.P.at(0, 0), 0.707106781186547);\n            //assert.eqtol(model.P.at(1, 0), -0.707106781186547);\n            assert.eqtol(model.P.at(0, 1), 0);\n            assert.eqtol(model.P.at(1, 1), 0);\n        });\n    });\n});",
                "new_contents": "/**\n * Copyright (c) 2015, Jozef Stefan Institute, Quintelligence d.o.o. and contributors\n * All rights reserved.\n *\n * This source code is licensed under the FreeBSD license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n// JavaScript source code\nvar la = require(\"qminer\").la;\nvar analytics = require(\"qminer\").analytics;\nvar assert = require(\"../../src/nodejs/scripts/assert.js\");\n//Unit test for PCA\n\ndescribe(\"PCA test\", function () {\n    beforeEach(function () {\n\n    });\n    afterEach(function () {\n\n    });\n    describe(\"Constructor tests\", function () {\n        it(\"should not throw an exception\", function () {\n            assert.doesNotThrow(function () {\n                var pca = new analytics.PCA();\n            });\n        });\n        it(\"should return default values of parameters\", function () {\n            var pca = new analytics.PCA();\n            var params = pca.getParams();\n            assert.equal(params.iter, undefined);\n            assert.equal(params.k, undefined);\n        });\n        it(\"should return values of parameters\", function () {\n            var pca = new analytics.PCA({iter: 100, k: 50});\n            var params = pca.getParams();\n            assert.equal(params.iter, 100);\n            assert.equal(params.k, 50);\n        });\n        it(\"should return values of parameters and added keys\", function () {\n            var pca = new analytics.PCA({iter: 30, alpha: 3});\n            var params = pca.getParams();\n            assert.equal(params.iter, 30);\n            assert.equal(params.alpha, 3);\n        });\n        it(\"should return empty model parameters\", function () {\n            var pca = new analytics.PCA();\n            var model = pca.getModel();\n            assert.equal(model.P, undefined);\n            assert.equal(model.lambda, undefined);\n            assert.equal(model.mu, undefined);\n        });\n    });\n    describe(\"testing setParams\", function () {\n        it(\"should return changed values of parameters\", function () {\n            var pca = new analytics.PCA();\n            pca.setParams({iter: 10, k: 5});\n            var params = pca.getParams();\n            assert.equal(params.iter, 10);\n            assert.equal(params.k, 5);\n        });\n        it(\"should return changed values of parameters and added key values\", function () {\n            var pca = new analytics.PCA();\n            pca.setParams({ iter: 10, beta: 30 });\n            var params = pca.getParams();\n            assert.equal(params.iter, 10);\n            assert.equal(params.beta, 30);\n        });\n    });\n    describe(\"Fit testing\", function () {\n        it(\"should not throw an exception creating a model\", function () {\n            var pca = new analytics.PCA();\n            var matrix = new la.Matrix([[1, -1], [0, 0]]);\n            assert.doesNotThrow(function () {\n                pca.fit(matrix);\n            });\n        });\n        it(\"should throw an exception because k is bigger than matrix dimensions\", function () {\n            var pca = new analytics.PCA({ k: 5});\n            var matrix = new la.Matrix([[1, -1], [0, 0]]);\n            assert.throws(function () {\n                pca.fit(matrix);\n            });\n        });\n        it.skip(\"should return the model parameters after using fit\", function () {\n            var pca = new analytics.PCA();\n            var matrix = new la.Matrix([[0, 1], [-1, 0]]);\n            matrix.print();\n            pca.fit(matrix);\n            var model = pca.getModel();\n            assert.eqtol(model.lambda[0], 1);\n            assert.eqtol(model.lambda[1], 0);\n            assert.eqtol(model.mu[0], 0.5);\n            assert.eqtol(model.mu[1], -0.5);\n            assert.eqtol(model.P.at(0, 0), 0.707106781186547);\n            assert.eqtol(model.P.at(1, 0), 0.707106781186547);\n            assert.eqtol(model.P.at(0, 1), 0.707106781186547);\n            assert.eqtol(model.P.at(1, 1), -0.707106781186547);\n        });\n    });\n});\n",
                "subject": "Made skiped PCA test pass. Still need to check output is actually correct before un-skiping.",
                "message": "Made skiped PCA test pass. Still need to check output is actually correct before un-skiping.\n",
                "lang": "JavaScript",
                "license": "bsd-2-clause",
                "repos": "mkarlovc/qminer,mkarlovc/qminer,blazs/qminer,mkarlovc/qminer,mkarlovc/qminer,blazs/qminer,blazs/qminer,blazs/qminer,mkarlovc/qminer,mkarlovc/qminer,blazs/qminer,blazs/qminer"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10252,
            "row": {
                "commit": "a80de4e2131f7f68ae1493743ba6b85bd6aa0250",
                "old_file": "test/object/dotPath.js",
                "new_file": "test/object/dotPath.js",
                "old_contents": "var test = require('../../src/assertion/ttr')\nvar dotPath = require('../../src/object/dotPath')\n\ntest('create object path from a list of strings', function (t) {\n  t.is(dotPath('foo', 'bar', 'baz'), 'foo.bar.baz')\n})\n\ntest('create object path from an array of strings', function (t) {\n  t.is(dotPath(['foo', 'bar', 'baz']), 'foo.bar.baz')\n})\n\ntest('create object path from a strings', function (t) {\n  t.is(dotPath('foo.bar.baz'), 'foo.bar.baz')\n})\n\ntest('create object path from a list of arguments', function (t) {\n  function foo () {\n    return dotPath(arguments)\n  }\n\n  t.is(foo('foo', 'bar', 'baz'), 'foo.bar.baz')\n})\n\ntest('create object path from an array of arguments', function (t) {\n  function foo () {\n    return dotPath(arguments)\n  }\n\n  t.is(foo(['foo', 'bar', 'baz']), 'foo.bar.baz')\n})\n\ntest('create object path from a mixture of arrays and strings', function (t) {\n  t.is(dotPath('foo', ['bar', 'baz']), 'foo.bar.baz')\n  t.is(dotPath(['foo', 'bar'], 'baz'), 'foo.bar.baz')\n  t.is(dotPath(['foo', 'bar'], ['baz']), 'foo.bar.baz')\n  t.is(dotPath(['foo'], ['bar'], ['baz']), 'foo.bar.baz')\n  t.is(dotPath(['foo'], 'bar', ['baz']), 'foo.bar.baz')\n})\n\ntest('create object path from a mixture of arrays and strings as arguments', function (t) {\n  function foo () {\n    return dotPath(arguments)\n  }\n\n  t.is(foo('foo', ['bar', 'baz']), 'foo.bar.baz')\n  t.is(foo(['foo', 'bar'], 'baz'), 'foo.bar.baz')\n  t.is(foo(['foo', 'bar'], ['baz']), 'foo.bar.baz')\n  t.is(foo(['foo'], ['bar'], ['baz']), 'foo.bar.baz')\n  t.is(foo(['foo'], 'bar', ['baz']), 'foo.bar.baz')\n})\n\ntest.result()",
                "new_contents": "var test = require('../../src/assertion/ttr')\nvar dotPath = require('../../src/object/toPath')\n// var dotPath = require('../../src/object/dotPath')\n\ntest('create object path from a list of strings', function (t) {\n  t.is(dotPath('foo', 'bar', 'baz'), 'foo.bar.baz')\n})\n\ntest('create object path from an array of strings', function (t) {\n  t.is(dotPath(['foo', 'bar', 'baz']), 'foo.bar.baz')\n})\n\ntest('create object path from a strings', function (t) {\n  t.is(dotPath('foo.bar.baz'), 'foo.bar.baz')\n})\n\ntest('create object path from a list of arguments', function (t) {\n  function foo () {\n    return dotPath(arguments)\n  }\n\n  t.is(foo('foo', 'bar', 'baz'), 'foo.bar.baz')\n})\n\ntest('create object path from an array of arguments', function (t) {\n  function foo () {\n    return dotPath(arguments)\n  }\n\n  t.is(foo(['foo', 'bar', 'baz']), 'foo.bar.baz')\n})\n\ntest('create object path from a mixture of arrays and strings', function (t) {\n  t.is(dotPath('foo', ['bar', 'baz']), 'foo.bar.baz')\n  t.is(dotPath(['foo', 'bar'], 'baz'), 'foo.bar.baz')\n  t.is(dotPath(['foo', 'bar'], ['baz']), 'foo.bar.baz')\n  t.is(dotPath(['foo'], ['bar'], ['baz']), 'foo.bar.baz')\n  t.is(dotPath(['foo'], 'bar', ['baz']), 'foo.bar.baz')\n})\n\ntest('create object path from a mixture of arrays and strings as arguments', function (t) {\n  function foo () {\n    return dotPath(arguments)\n  }\n\n  t.is(foo('foo', ['bar', 'baz']), 'foo.bar.baz')\n  t.is(foo(['foo', 'bar'], 'baz'), 'foo.bar.baz')\n  t.is(foo(['foo', 'bar'], ['baz']), 'foo.bar.baz')\n  t.is(foo(['foo'], ['bar'], ['baz']), 'foo.bar.baz')\n  t.is(foo(['foo'], 'bar', ['baz']), 'foo.bar.baz')\n})\n\ntest('create object path when arguments is not the first value', function (t) {\n  function foo () {\n    return dotPath('options', arguments)\n  }\n\n  t.is(foo(['foo', 'bar', 'baz']), 'options.foo.bar.baz')\n})\n\ntest('create object path discarding any non-string values', function (t) {\n  function foo () {\n    return dotPath('options', arguments)\n  }\n\n  var fn = function () {\n    return\n  }\n\n  t.is(foo([fn, 'foo', 'bar', 'baz'], fn, new Date(), {a: 1}, 6, null), 'options.foo.bar.baz')\n})\n\ntest.result()",
                "subject": "update test/object/dotPath -- using src/object/toPath, add tests",
                "message": "update test/object/dotPath -- using src/object/toPath, add tests\n",
                "lang": "JavaScript",
                "license": "isc",
                "repos": "akileez/toolz,akileez/toolz"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10253,
            "row": {
                "commit": "b29daefa2e7465aa25fa86f806c99b72acb175f2",
                "old_file": "js/authentication.js",
                "new_file": "js/authentication.js",
                "old_contents": "var authentication\t= new function () {\r\n\r\n\r\n\r\n\r\n/**\r\n* @namespace Authentication\r\n*/\r\nvar self\t= this;\r\n\r\n\r\n\r\n\r\n/**\r\n* @field\r\n* @property {string}\r\n*/\r\nvar token;\r\n\r\n/**\r\n* @field\r\n* @property {int}\r\n*/\r\nvar userid;\r\n\r\n/**\r\n* @field\r\n* @property {string}\r\n*/\r\nvar username;\r\n\r\n\r\n\r\n\r\n/**\r\n* @function\r\n* @property {goog.async.Deferred}\r\n* @param {string} username\r\n* @param {string} password\r\n*/\r\nvar login;\r\n\r\n/**\r\n* @function\r\n* @property {void}\r\n*/\r\nvar logout;\r\n\r\n/**\r\n* @function\r\n* @property {goog.async.Deferred}\r\n* @param {string} username\r\n* @param {string} password\r\n*/\r\nvar createUser;\r\n\r\n/**\r\n* @function\r\n* @property {goog.async.Deferred}\r\n* @param {string} username\r\n* @param {string} oldPassword\r\n* @param {string} newPassword\r\n*/\r\nvar changePassword;\r\n\r\n\r\n\r\n\r\nvar _storage\t\t\t= new goog.net.Cookies(document);\r\nvar _tokenKey\t\t\t= 'napsterfm-token';\r\nvar _useridKey\t\t\t= 'napsterfm-userid';\r\nvar _usernameKey\t\t= 'napsterfm-username';\r\nvar _usernameToEmail\t= function (username) { return '{0}@firebase.com'.assign({0: username}); };\r\n\r\n\r\n\r\n\r\nself.token\t\t= self._storage.get(self._tokenKey);\r\nself.userid\t\t= self._storage.get(self._useridKey);\r\nself.username\t= self._storage.get(self._usernameKey);\r\n\r\n\r\n\r\n\r\nself.login\t\t= function (username, password) {\r\n\tvar status\t= new goog.async.Deferred();\r\n\r\n\tnew FirebaseAuthClient(datastore.root).login('password', self._usernameToEmail(username), password, function (error, token, user) {\r\n\t\tif (!error) {\r\n\t\t\tself._storage.set(self._tokenKey, token);\r\n\t\t\tself._storage.set(self._useridKey, user.id);\r\n\t\t\tself._storage.set(self._usernameKey, username);\r\n\r\n\t\t\tdocument.location.reload(true);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tstatus.callback(error);\r\n\t\t}\r\n\t});\r\n\r\n\treturn status;\r\n};\r\n\r\n\r\nself.logout\t\t= function () {\r\n\tdatastore.root.unauth();\r\n\r\n\tself._storage.remove(self._tokenKey);\r\n\tself._storage.remove(self._useridKey);\r\n\tself._storage.remove(self._usernameKey);\r\n\r\n\tdocument.location.reload(true);\r\n};\r\n\r\n\r\nself.createUser\t\t= function (username, password) {\r\n\tvar status\t= new goog.async.Deferred();\r\n\r\n\tnew FirebaseAuthClient(datastore.root).createUser(self._usernameToEmail(username), password, function (error, user) {\r\n\t\tif (!error) {\r\n\t\t\t/* TODO: Do something here */\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tstatus.callback(error);\r\n\t\t}\r\n\t});\r\n\r\n\treturn status;\r\n};\r\n\r\n\r\nself.changePassword\t\t= function (username, oldPassword, newPassword) {\r\n\tvar status\t= new goog.async.Deferred();\r\n\r\n\tnew FirebaseAuthClient(datastore.root).changePassword(self._usernameToEmail(username), oldPassword, newPassword, function (error, success) {\r\n\t\tif (!error) {\r\n\t\t\t/* TODO: Do something here */\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tstatus.callback(error);\r\n\t\t}\r\n\t});\r\n\r\n\treturn status;\r\n};\r\n\r\n\r\n\r\n\r\n/* Authenticate on startup */\r\nif (self.token) {\r\n\tdatastore.root.auth(self.token);\r\n}\r\n\r\n\r\n\r\n\r\n};\r\n",
                "new_contents": "var authentication\t= new function () {\r\n\r\n\r\n\r\n\r\n/**\r\n* @namespace Authentication\r\n*/\r\nvar self\t= this;\r\n\r\n\r\n\r\n\r\n/**\r\n* @field\r\n* @property {string}\r\n*/\r\nvar token;\r\n\r\n/**\r\n* @field\r\n* @property {int}\r\n*/\r\nvar userid;\r\n\r\n/**\r\n* @field\r\n* @property {string}\r\n*/\r\nvar username;\r\n\r\n\r\n\r\n\r\n/**\r\n* @function\r\n* @property {goog.async.Deferred}\r\n* @param {string} username\r\n* @param {string} password\r\n*/\r\nvar login;\r\n\r\n/**\r\n* @function\r\n* @property {void}\r\n*/\r\nvar logout;\r\n\r\n/**\r\n* @function\r\n* @property {goog.async.Deferred}\r\n* @param {string} username\r\n* @param {string} password\r\n*/\r\nvar createUser;\r\n\r\n/**\r\n* @function\r\n* @property {goog.async.Deferred}\r\n* @param {string} username\r\n* @param {string} oldPassword\r\n* @param {string} newPassword\r\n*/\r\nvar changePassword;\r\n\r\n\r\n\r\n\r\nvar _storage\t\t\t= new goog.net.Cookies(window);\r\nvar _tokenKey\t\t\t= 'napsterfm-token';\r\nvar _useridKey\t\t\t= 'napsterfm-userid';\r\nvar _usernameKey\t\t= 'napsterfm-username';\r\nvar _usernameToEmail\t= function (username) { return '{0}@firebase.com'.assign({0: username}); };\r\n\r\n\r\n\r\n\r\nself.token\t\t= self._storage.get(self._tokenKey);\r\nself.userid\t\t= self._storage.get(self._useridKey);\r\nself.username\t= self._storage.get(self._usernameKey);\r\n\r\n\r\n\r\n\r\nself.login\t\t= function (username, password) {\r\n\tvar status\t= new goog.async.Deferred();\r\n\r\n\tnew FirebaseAuthClient(datastore.root).login('password', self._usernameToEmail(username), password, function (error, token, user) {\r\n\t\tif (!error) {\r\n\t\t\tself._storage.set(self._tokenKey, token);\r\n\t\t\tself._storage.set(self._useridKey, user.id);\r\n\t\t\tself._storage.set(self._usernameKey, username);\r\n\r\n\t\t\tdocument.location.reload(true);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tstatus.callback(error);\r\n\t\t}\r\n\t});\r\n\r\n\treturn status;\r\n};\r\n\r\n\r\nself.logout\t\t= function () {\r\n\tdatastore.root.unauth();\r\n\r\n\tself._storage.remove(self._tokenKey);\r\n\tself._storage.remove(self._useridKey);\r\n\tself._storage.remove(self._usernameKey);\r\n\r\n\tdocument.location.reload(true);\r\n};\r\n\r\n\r\nself.createUser\t\t= function (username, password) {\r\n\tvar status\t= new goog.async.Deferred();\r\n\r\n\tnew FirebaseAuthClient(datastore.root).createUser(self._usernameToEmail(username), password, function (error, user) {\r\n\t\tif (!error) {\r\n\t\t\t/* TODO: Do something here */\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tstatus.callback(error);\r\n\t\t}\r\n\t});\r\n\r\n\treturn status;\r\n};\r\n\r\n\r\nself.changePassword\t\t= function (username, oldPassword, newPassword) {\r\n\tvar status\t= new goog.async.Deferred();\r\n\r\n\tnew FirebaseAuthClient(datastore.root).changePassword(self._usernameToEmail(username), oldPassword, newPassword, function (error, success) {\r\n\t\tif (!error) {\r\n\t\t\t/* TODO: Do something here */\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tstatus.callback(error);\r\n\t\t}\r\n\t});\r\n\r\n\treturn status;\r\n};\r\n\r\n\r\n\r\n\r\n/* Authenticate on startup */\r\nif (self.token) {\r\n\tdatastore.root.auth(self.token);\r\n}\r\n\r\n\r\n\r\n\r\n};\r\n",
                "subject": "Cookie usage",
                "message": "Cookie usage\n",
                "lang": "JavaScript",
                "license": "agpl-3.0",
                "repos": "buu700/napster.fm,buu700/napster.fm,buu700/napster.fm,buu700/napster.fm"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10254,
            "row": {
                "commit": "cf4554372842814fdbc3a0ffcd23857aec2e7af6",
                "old_file": "js/authentication.js",
                "new_file": "js/authentication.js",
                "old_contents": "var authentication\t= new function () {\r\n\r\n\r\n\r\n\r\n/**\r\n* @namespace Authentication\r\n*/\r\nvar self\t= this;\r\n\r\n\r\n\r\n\r\n/**\r\n* @field\r\n* @property {string}\r\n*/\r\nvar token;\r\nvar _tokenKey\t\t= 'napsterfm-token';\r\n\r\n/**\r\n* @field\r\n* @property {int}\r\n*/\r\nvar userid;\r\nvar _useridKey\t\t= 'napsterfm-userid';\r\n\r\n/**\r\n* @field\r\n* @property {string}\r\n*/\r\nvar username;\r\nvar _usernameKey\t= 'napsterfm-username';\r\nvar _usernameToEmail\t= function (username) { return '{0}@firebase.com'.assign({0: username}); };\r\n\r\n\r\n\r\n\r\n/**\r\n* @function\r\n* @property {goog.async.Deferred}\r\n* @param {string} username\r\n* @param {string} password\r\n*/\r\nvar login;\r\n\r\n/**\r\n* @function\r\n* @property {void}\r\n*/\r\nvar logout;\r\n\r\n/**\r\n* @function\r\n* @property {goog.async.Deferred}\r\n* @param {string} username\r\n* @param {string} password\r\n*/\r\nvar createUser;\r\n\r\n/**\r\n* @function\r\n* @property {goog.async.Deferred}\r\n* @param {string} username\r\n* @param {string} oldPassword\r\n* @param {string} newPassword\r\n*/\r\nvar changePassword;\r\n\r\n\r\n\r\n\r\nself.token\t\t= goog.storage.Storage.get(self._tokenKey);\r\nself.userid\t\t= goog.storage.Storage.get(self._useridKey);\r\nself.username\t= goog.storage.Storage.get(self._usernameKey);\r\n\r\n\r\n\r\n\r\nself.login\t\t= function (username, password) {\r\n\tvar status\t= new goog.async.Deferred();\r\n\r\n\tnew FirebaseAuthClient(datastore.root).login('password', self._usernameToEmail(username), password, function (error, token, user) {\r\n\t\tif (!error) {\r\n\t\t\tgoog.storage.Storage.set(self._tokenKey, token);\r\n\t\t\tgoog.storage.Storage.set(self._useridKey, user.id);\r\n\t\t\tgoog.storage.Storage.set(self._usernameKey, username);\r\n\r\n\t\t\tdocument.location.reload(true);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tstatus.callback(error);\r\n\t\t}\r\n\t});\r\n\r\n\treturn status;\r\n};\r\n\r\n\r\nself.logout\t\t= function () {\r\n\tdatastore.root.unauth();\r\n\r\n\tgoog.storage.Storage.remove(self._tokenKey);\r\n\tgoog.storage.Storage.remove(self._useridKey);\r\n\tgoog.storage.Storage.remove(self._usernameKey);\r\n\r\n\tdocument.location.reload(true);\r\n};\r\n\r\n\r\nself.createUser\t\t= function (username, password) {\r\n\tvar status\t= new goog.async.Deferred();\r\n\r\n\tnew FirebaseAuthClient(datastore.root).createUser(self._usernameToEmail(username), password, function (error, user) {\r\n\t\tif (!error) {\r\n\t\t\t/* TODO: Do something here */\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tstatus.callback(error);\r\n\t\t}\r\n\t});\r\n\r\n\treturn status;\r\n};\r\n\r\n\r\nself.changePassword\t\t= function (username, oldPassword, newPassword) {\r\n\tvar status\t= new goog.async.Deferred();\r\n\r\n\tnew FirebaseAuthClient(datastore.root).changePassword(self._usernameToEmail(username), oldPassword, newPassword, function (error, success) {\r\n\t\tif (!error) {\r\n\t\t\t/* TODO: Do something here */\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tstatus.callback(error);\r\n\t\t}\r\n\t});\r\n\r\n\treturn status;\r\n};\r\n\r\n\r\n\r\n\r\n/* Authenticate on startup */\r\nif (self.token) {\r\n\tdatastore.root.auth(self.token);\r\n}\r\n\r\n\r\n\r\n\r\n};\r\n",
                "new_contents": "var authentication\t= new function () {\r\n\r\n\r\n\r\n\r\n/**\r\n* @namespace Authentication\r\n*/\r\nvar self\t= this;\r\n\r\n\r\n\r\n\r\n/**\r\n* @field\r\n* @property {string}\r\n*/\r\nvar token;\r\n\r\n/**\r\n* @field\r\n* @property {int}\r\n*/\r\nvar userid;\r\n\r\n/**\r\n* @field\r\n* @property {string}\r\n*/\r\nvar username;\r\n\r\n\r\n\r\n\r\n/**\r\n* @function\r\n* @property {goog.async.Deferred}\r\n* @param {string} username\r\n* @param {string} password\r\n*/\r\nvar login;\r\n\r\n/**\r\n* @function\r\n* @property {void}\r\n*/\r\nvar logout;\r\n\r\n/**\r\n* @function\r\n* @property {goog.async.Deferred}\r\n* @param {string} username\r\n* @param {string} password\r\n*/\r\nvar createUser;\r\n\r\n/**\r\n* @function\r\n* @property {goog.async.Deferred}\r\n* @param {string} username\r\n* @param {string} oldPassword\r\n* @param {string} newPassword\r\n*/\r\nvar changePassword;\r\n\r\n\r\n\r\n\r\nvar _storage\t\t\t= new goog.storage.Storage();\r\nvar _tokenKey\t\t\t= 'napsterfm-token';\r\nvar _useridKey\t\t\t= 'napsterfm-userid';\r\nvar _usernameKey\t\t= 'napsterfm-username';\r\nvar _usernameToEmail\t= function (username) { return '{0}@firebase.com'.assign({0: username}); };\r\n\r\n\r\n\r\n\r\nself.token\t\t= self._storage.get(self._tokenKey);\r\nself.userid\t\t= self._storage.get(self._useridKey);\r\nself.username\t= self._storage.get(self._usernameKey);\r\n\r\n\r\n\r\n\r\nself.login\t\t= function (username, password) {\r\n\tvar status\t= new goog.async.Deferred();\r\n\r\n\tnew FirebaseAuthClient(datastore.root).login('password', self._usernameToEmail(username), password, function (error, token, user) {\r\n\t\tif (!error) {\r\n\t\t\tself._storage.set(self._tokenKey, token);\r\n\t\t\tself._storage.set(self._useridKey, user.id);\r\n\t\t\tself._storage.set(self._usernameKey, username);\r\n\r\n\t\t\tdocument.location.reload(true);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tstatus.callback(error);\r\n\t\t}\r\n\t});\r\n\r\n\treturn status;\r\n};\r\n\r\n\r\nself.logout\t\t= function () {\r\n\tdatastore.root.unauth();\r\n\r\n\tself._storage.remove(self._tokenKey);\r\n\tself._storage.remove(self._useridKey);\r\n\tself._storage.remove(self._usernameKey);\r\n\r\n\tdocument.location.reload(true);\r\n};\r\n\r\n\r\nself.createUser\t\t= function (username, password) {\r\n\tvar status\t= new goog.async.Deferred();\r\n\r\n\tnew FirebaseAuthClient(datastore.root).createUser(self._usernameToEmail(username), password, function (error, user) {\r\n\t\tif (!error) {\r\n\t\t\t/* TODO: Do something here */\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tstatus.callback(error);\r\n\t\t}\r\n\t});\r\n\r\n\treturn status;\r\n};\r\n\r\n\r\nself.changePassword\t\t= function (username, oldPassword, newPassword) {\r\n\tvar status\t= new goog.async.Deferred();\r\n\r\n\tnew FirebaseAuthClient(datastore.root).changePassword(self._usernameToEmail(username), oldPassword, newPassword, function (error, success) {\r\n\t\tif (!error) {\r\n\t\t\t/* TODO: Do something here */\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tstatus.callback(error);\r\n\t\t}\r\n\t});\r\n\r\n\treturn status;\r\n};\r\n\r\n\r\n\r\n\r\n/* Authenticate on startup */\r\nif (self.token) {\r\n\tdatastore.root.auth(self.token);\r\n}\r\n\r\n\r\n\r\n\r\n};\r\n",
                "subject": "goog.storage usage fix",
                "message": "goog.storage usage fix\n",
                "lang": "JavaScript",
                "license": "agpl-3.0",
                "repos": "buu700/napster.fm,buu700/napster.fm,buu700/napster.fm,buu700/napster.fm"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10255,
            "row": {
                "commit": "56c1c4d926cf477847a1b79a15fd56210bf96cf9",
                "old_file": "client/components/app/app.js",
                "new_file": "client/components/app/app.js",
                "old_contents": "React.render(\n  <div>\n    <NavBarTop />\n    <LeftContainer />\n    <CenterContainer />\n    <RightContainer />\n    <NavBarBot />\n  </div>,\n  document.getElementsByClassName('appWrapper')[0]\n);",
                "new_contents": "var Styling = React.createClass({\n  render: function(){\n    var style = {\n      '-webkit-touch-callout': 'none',\n      '-webkit-user-select': 'none',\n      '-khtml-user-select': 'none',\n      '-moz-user-select': 'none',\n      '-ms-user-select': 'none',\n      'user-select': 'none'\n    };\n    return (\n      <div style={style}>\n        <NavBarTop />\n        <LeftContainer />\n        <CenterContainer />\n        <RightContainer />\n        <NavBarBot />\n      </div>\n    );\n  }\n})\n\nReact.render(\n  <div>\n    <Styling />\n  </div>,\n  document.getElementsByClassName('appWrapper')[0]\n);",
                "subject": "(client) Disabled all page highlighting",
                "message": "(client) Disabled all page highlighting\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "joshtepei/pitunes,ScintillatingAcai/pitunes,ZLester/pitunes,joshtepei/pitunes,ZLester/pitunes,ScintillatingAcai/pitunes"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10256,
            "row": {
                "commit": "8e5e65377d527bcc8bd03c68949d027ff95ac1f0",
                "old_file": "app/fs-static.js",
                "new_file": "app/fs-static.js",
                "old_contents": "'use strict';\n\n// Node.js fs API implementations, synchronous and static methods\n\n// https://nodejs.org/api/fs.html\n\nconst fs = {};\n\n// TODO: write this data to disk too, so it is consistent on the OS filesystem\nconst STATIC_FILE_DATA = {\n  '/greeting': new Buffer('hello world'),\n\n  // npm reads its own version from its package.json\n  '/node_modules/npm/package.json': new Buffer(JSON.stringify({version: '3.6.0'})),\n\n  // cat ./node_modules/browser-pack/_prelude.js\n  // This should match ./prelude2.js (adds require.resolve addition), if the web-based browserify\n  // is to match the node-based browserify bundle output. TODO: refactor to avoid duplication\n  '/node_modules/browser-pack/_prelude.js': new Buffer(`//based on https://github.com/substack/browser-pack/blob/01d39894f7168983f66200e727cdaadf881cd39d/prelude.js\n// modules are defined as an array\n// [ module function, map of requireuires ]\n//\n// map of requireuires is short require name -> numeric require\n//\n// anything defined in a previous bundle is accessed via the\n// orig method which is the requireuire for previous bundles\n\n(function outer (modules, cache, entry) {\n    // Save the require from previous bundle to this closure if any\n    var previousRequire = typeof require == \"function\" && require;\n\n    function newRequire(name, jumped){\n        if(!cache[name]) {\n            if(!modules[name]) {\n                // if we cannot find the module within our internal map or\n                // cache jump to the current global require ie. the last bundle\n                // that was added to the page.\n                var currentRequire = typeof require == \"function\" && require;\n                if (!jumped && currentRequire) return currentRequire(name, true);\n\n                // If there are other bundles on this page the require from the\n                // previous one is saved to 'previousRequire'. Repeat this as\n                // many times as there are bundles until the module is found or\n                // we exhaust the require chain.\n                if (previousRequire) return previousRequire(name, true);\n                var err = new Error('Cannot find module \\'' + name + '\\'');\n                err.code = 'MODULE_NOT_FOUND';\n                throw err;\n            }\n            var m = cache[name] = {exports:{}};\n            var R = (x) => {\n                var id = modules[name][1][x];\n                return newRequire(id ? id : x);\n            };\n            // https://github.com/deathcap/webnpm/issues/5 Implement require.resolve\n            R.resolve = (module) => {\n                console.log('require.resolve', module);\n                return module;\n            };\n            modules[name][0].call(m.exports, R\n            ,m,m.exports,outer,modules,cache,entry);\n        }\n        return cache[name].exports;\n    }\n    for(var i=0;i<entry.length;i++) newRequire(entry[i]);\n\n    // Override the current require with this new one\n    return newRequire;\n})`),\n\n};\n\nconst STATIC_DIR_DATA = {\n  '/node_modules/npm/node_modules/npm-registry-client/lib': [\n    // ls node_modules/npm/node_modules/npm-registry-client/lib|perl -pe'chomp;$_=\"    \\\"$_\\\",\\n\"'\n    \"access.js\",\n    \"adduser.js\",\n    \"attempt.js\",\n    \"authify.js\",\n    \"deprecate.js\",\n    \"dist-tags\",\n    \"fetch.js\",\n    \"get.js\",\n    \"initialize.js\",\n    \"logout.js\",\n    \"ping.js\",\n    \"publish.js\",\n    \"request.js\",\n    \"star.js\",\n    \"stars.js\",\n    \"tag.js\",\n    \"team.js\",\n    \"unpublish.js\",\n    \"whoami.js\",\n  ],\n};\n\nfs.readFileSync = (file, options) => {\n  console.log('readFileSync',file,options);\n\n  const data = STATIC_FILE_DATA[file];\n  if (data === undefined) {\n    const e = new Error(`no such file or directory: ${file}`);\n    e.code = 'ENOENT';\n    e.errno = -2;\n    throw e;\n  }\n\n  let encoding = null;\n  if (typeof options === 'string') {\n    encoding = options;\n  } else if (typeof options === 'object') {\n    encoding = options.encoding;\n  }\n\n  return data.toString(encoding);\n};\n\nfs.readdirSync = (path) => {\n  if (path in STATIC_DIR_DATA) {\n    return STATIC_DIR_DATA[path];\n  }\n  const e = new Error(`no such file or directory, readdirSync '${path}'`);\n  e.errno = -2;\n  e.code = 'ENOENT';\n  throw e;\n};\n\nmodule.exports = fs;\n",
                "new_contents": "'use strict';\n\n// Node.js fs API implementations, synchronous and static methods\n\n// https://nodejs.org/api/fs.html\n\nconst fs = {};\n\n// TODO: write this data to disk too, so it is consistent on the OS filesystem\nconst STATIC_FILE_DATA = {\n  '/greeting': new Buffer('hello world'),\n\n  // npm reads its own version from its package.json\n  '/node_modules/npm/package.json': new Buffer(JSON.stringify({version: '3.6.0'})),\n\n  // cat ./node_modules/browser-pack/_prelude.js\n  // This should match ./prelude2.js (adds require.resolve addition), if the web-based browserify\n  // is to match the node-based browserify bundle output. TODO: refactor to avoid duplication\n  '/node_modules/browser-pack/_prelude.js': new Buffer(`//based on https://github.com/substack/browser-pack/blob/01d39894f7168983f66200e727cdaadf881cd39d/prelude.js\n// modules are defined as an array\n// [ module function, map of requireuires ]\n//\n// map of requireuires is short require name -> numeric require\n//\n// anything defined in a previous bundle is accessed via the\n// orig method which is the requireuire for previous bundles\n\n(function outer (modules, cache, entry) {\n    // Save the require from previous bundle to this closure if any\n    var previousRequire = typeof require == \"function\" && require;\n\n    function newRequire(name, jumped){\n        if(!cache[name]) {\n            if(!modules[name]) {\n                // if we cannot find the module within our internal map or\n                // cache jump to the current global require ie. the last bundle\n                // that was added to the page.\n                var currentRequire = typeof require == \"function\" && require;\n                if (!jumped && currentRequire) return currentRequire(name, true);\n\n                // If there are other bundles on this page the require from the\n                // previous one is saved to 'previousRequire'. Repeat this as\n                // many times as there are bundles until the module is found or\n                // we exhaust the require chain.\n                if (previousRequire) return previousRequire(name, true);\n                var err = new Error('Cannot find module \\'' + name + '\\'');\n                err.code = 'MODULE_NOT_FOUND';\n                throw err;\n            }\n            var m = cache[name] = {exports:{}};\n            var R = (x) => {\n                var id = modules[name][1][x];\n                return newRequire(id ? id : x);\n            };\n            // https://github.com/deathcap/webnpm/issues/5 Implement require.resolve\n            R.resolve = (module) => {\n                console.log('require.resolve', module);\n                return module;\n            };\n            modules[name][0].call(m.exports, R\n            ,m,m.exports,outer,modules,cache,entry);\n        }\n        return cache[name].exports;\n    }\n    for(var i=0;i<entry.length;i++) newRequire(entry[i]);\n\n    // Override the current require with this new one\n    return newRequire;\n})`),\n\n};\n\nconst STATIC_DIR_DATA = {\n  '/node_modules/npm/node_modules/npm-registry-client/lib': [\n    // ls node_modules/npm/node_modules/npm-registry-client/lib|perl -pe'chomp;$_=\"    \\\"$_\\\",\\n\"'\n    \"access.js\",\n    \"adduser.js\",\n    \"attempt.js\",\n    \"authify.js\",\n    \"deprecate.js\",\n    \"dist-tags\",\n    \"fetch.js\",\n    \"get.js\",\n    \"initialize.js\",\n    \"logout.js\",\n    \"ping.js\",\n    \"publish.js\",\n    \"request.js\",\n    \"star.js\",\n    \"stars.js\",\n    \"tag.js\",\n    \"team.js\",\n    \"unpublish.js\",\n    \"whoami.js\",\n  ],\n};\n\nfs.readFileSync = (file, options) => {\n  console.log('readFileSync',file,options);\n\n  const data = STATIC_FILE_DATA[file];\n  if (data === undefined) {\n    const e = new Error(`no such file or directory: ${file}`);\n    e.code = 'ENOENT';\n    e.errno = -2;\n    throw e;\n  }\n\n  let encoding = null;\n  if (typeof options === 'string') {\n    encoding = options;\n  } else if (typeof options === 'object') {\n    encoding = options.encoding;\n  }\n\n  return data.toString(encoding);\n};\n\nfs.readdirSync = (path) => {\n  if (path in STATIC_DIR_DATA) {\n    return STATIC_DIR_DATA[path];\n  }\n  const e = new Error(`no such file or directory, readdirSync '${path}'`);\n  e.errno = -2;\n  e.code = 'ENOENT';\n  throw e;\n};\n\nfs.statSync = (path) => {\n  if (path.startsWith('/node_modules/npm/node_modules/npm-registry-client/lib/')) {\n    return {\n      isFile: () => true,\n      isDirectory: () => false,\n    }\n  }\n  const e = new Error(`no such file or directory, statSync '${path}'`);\n  e.errno = -2;\n  e.code = 'ENOENT';\n  throw e;\n};\n\nmodule.exports = fs;\n",
                "subject": "Add a minimal fs.statSync() also for npm-registry-client",
                "message": "Add a minimal fs.statSync() also for npm-registry-client\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "deathcap/nodeachrome,deathcap/nodeachrome,deathcap/nodeachrome"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10257,
            "row": {
                "commit": "54aa4b9223905a09b3a4cb46014cd8af992147fc",
                "old_file": "js/cena1_exterior.js",
                "new_file": "js/cena1_exterior.js",
                "old_contents": "'use strict';\n\nsceneLoader[1] = function() {\n\n  // Iniciando a nova cena\n  scene[1] = new Game.Scene();\n  // Adicionando musica na cena\n  scene[1].setMusic(\"musicaAmbienteExterno.wav\", 1.0);\n\n  // Adicionando uma imagem de fundo\n  scene[1].background = new Game.Background(\"cenaExterior.jpg\");\n  scene[1].background.setBrightness(100);\n\n  // Criando um aliase de scene[1].item\n  var item = scene[1].item;\n\n  item.chiqueiro = new Game.Item(\"chiqueiro.png\");\n  item.chiqueiro.setPosition(238, 240);\n  item.chiqueiro.setZorder(15);\n  item.chiqueiro.onMouseOver = function() {\n    scene[1].setSubtitle(\"Chiqueiro\");\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n    item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();\n  }\n  item.chiqueiro.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n  }\n\n  item.horta = new Game.Item(\"horta.png\");\n  item.horta.setPosition(400, 660);\n  item.horta.setZorder(10);\n  item.horta.onMouseOver = function() {\n    scene[1].setSubtitle(\"Horta\");\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n    item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();\n  }\n  item.horta.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n  }\n\n  item.latrina = new Game.Item(\"latrina.png\");\n  item.latrina.setPosition(1450, 200);\n  item.latrina.setZorder(15);\n  item.latrina.onMouseOver = function() {\n    scene[1].setSubtitle(\"Fossa\");\n    somPopup();\n    item.popupLatrinaPoco.enable();\n    item.popupLatrinaPocoTexto.enable();\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n  }\n  item.latrina.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n    item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();\n  }\n\n  item.popupLatrinaPoco = new Game.Image(\"popupLatrinaPoco.png\");\n  item.popupLatrinaPoco.setPosition(1210, 440);\n  item.popupLatrinaPoco.setScale(0.24);\n  item.popupLatrinaPoco.disable();\n\n  item.popupLatrinaPocoTexto = new Game.Text(\n    \"Contaminação do poço artesiano\\n\" +\n    \"a partir da fossa. A localização\\n\" +\n    \"do poço deve levar em conta os\\n\" +\n    \"riscos de contaminação do lençol\\n\" +\n    \"freático, portanto, deve-se respei-\\n\" +\n    \"tar uma distância mínima de 15\\n\" +\n    \"metros de qualquer fossa e de 45\\n\" +\n    \"metros de chiqueiros, por exem-\\n\" +\n    \"plo. No ambiente representado\\n\" +\n    \"por esse Objeto de Aprendiza-\\n\" +\n    \"gem, estas regras não foram se-\\n\" +\n    \"guidas: a construção da fossa se\\n\" +\n    \"deu próxima ao poço.\"\n    ,estiloInfoPopup);\n  item.popupLatrinaPocoTexto.setPosition(1106, 430);\n  item.popupLatrinaPocoTexto.setAnchor(0.5, 0.5);\n  item.popupLatrinaPocoTexto.setZorder(4);\n  item.popupLatrinaPocoTexto.disable();\n\n  item.lixeira = new Game.Item(\"lixeira.png\");\n  item.lixeira.setPosition(567, 288);\n  item.lixeira.setZorder(16);\n  item.lixeira.onMouseOver = function() {\n    scene[1].setSubtitle(\"Lixo\");\n    somPopup();\n    item.popupChorume.enable();\n    item.popupChorumeTexto.enable();\n    item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();\n  }\n  item.lixeira.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n  }\n\n  item.popupChorume = new Game.Image(\"popupChorume.png\");\n  item.popupChorume.setPosition(900, 460);\n  item.popupChorume.setScale(0.27);\n  item.popupChorume.disable();\n\n  item.popupChorumeTexto = new Game.Text(\n    \"Contaminação do solo atra-\\n\" +\n    \"vés do chorume proveniente\\n\" +\n    \"do lixo depositado de modo\\n\" +\n    \"inadequado e por muito\\n\" +\n    \"tempo no local. O chorume\\n\" +\n    \"é um resíduo líquido forma-\\n\" +\n    \"do a partir da decomposição\\n\" +\n    \"de matéria orgânica presen-\\n\" +\n    \"te no lixo.\"\n    ,estiloInfoPopup);\n  item.popupChorumeTexto.setPosition(1010, 500);\n  item.popupChorumeTexto.setAnchor(0.5, 0.5);\n  item.popupChorumeTexto.setZorder(4);\n  item.popupChorumeTexto.disable();\n\n  item.pocoExterior = new Game.Item(\"pocoExterior.png\");\n  item.pocoExterior.setPosition(1723, 643);\n  item.pocoExterior.setZorder(10);\n  item.pocoExterior.onMouseOver = function() {\n    scene[1].setSubtitle(\"Poço artesiano\");\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n    item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();\n    /*item.popupLatrinaPoco.enable();\n    item.popupLatrinaPocoTexto.enable();\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();*/\n  }\n  item.pocoExterior.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n    /*item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();*/\n  }\n\n  item.vacaExterior = new Game.Image(\"vacaExterior.png\");\n  item.vacaExterior.setPosition(935, 252);\n  item.vacaExterior.setZorder(15);\n\n  // Adiciona uma seta para voltar na sala de aula\n  item.setaSalaDeAula = new Game.Item(\"seta.png\");\n  item.setaSalaDeAula.setPosition(210, 480);\n  item.setaSalaDeAula.setBrightness(220);\n  item.setaSalaDeAula.setScale(0.3);\n  item.setaSalaDeAula.setRotation(180);\n  item.setaSalaDeAula.setAlpha(0);\n  item.setaSalaDeAula.disable();\n  item.setaSalaDeAula.onMouseOver = function() {\n    scene[1].setSubtitle(\"Sala de aula\");\n    item.setaSalaDeAula.setBrightness(255);\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n    item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();\n  }\n  item.setaSalaDeAula.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n    item.setaSalaDeAula.setBrightness(220);\n  }\n  item.setaSalaDeAula.onClick = function(mouse) {\n    somSeta();\n    scene[1].setSubtitle(\"\");\n    changeScene(0); // Muda para a sala de aula\n  }\n\n  // Estados da cena\n  scene[1].state = 0;\n  scene[1].nextState = function() {\n    switch (scene[1].state) {\n      case 0:\n        scene[1].state = 1;\n        item.estPocoNormal.brightnessTarget = 150;\n        item.estPocoNormal.interactiveTarget = false;\n        item.estVacaNormal.brightnessTarget = 220;\n        item.estVacaNormal.interactiveTarget = true;\n        item.estPorcoNormal.brightnessTarget = 220;\n        item.estPorcoNormal.interactiveTarget = true;\n        item.estCenouraNormal.brightnessTarget = 150;\n        item.estCenouraNormal.interactiveTarget = false;\n        break;\n      case 1:\n        if (!item.estVacaNormal.interactiveTarget && !item.estPorcoNormal.interactiveTarget) {\n          scene[1].state = 2;\n          item.estCenouraNormal.brightnessTarget = 220;\n          item.estCenouraNormal.interactiveTarget = true;\n        }\n        break;\n      case 2:\n        scene[1].state = 3;\n        item.estPocoNormal.brightnessTarget = 220;\n        item.estPocoNormal.interactiveTarget = true;\n        item.estVacaNormal.brightnessTarget = 220;\n        item.estVacaNormal.interactiveTarget = true;\n        item.estPorcoNormal.brightnessTarget = 220;\n        item.estPorcoNormal.interactiveTarget = true;\n        break;\n      case 3:\n        item.estPocoNormal.brightnessTarget = 220;\n        item.estPocoNormal.interactiveTarget = true;\n        item.estVacaNormal.brightnessTarget = 220;\n        item.estVacaNormal.interactiveTarget = true;\n        item.estPorcoNormal.brightnessTarget = 220;\n        item.estPorcoNormal.interactiveTarget = true;\n        item.estCenouraNormal.brightnessTarget = 220;\n        item.estCenouraNormal.interactiveTarget = true;\n        break;\n    }\n    UpdateScreen();\n  }\n\n  // Carrega ciclos\n  carregaCicloGiardia();\n  carregaCicloTaeniaSaginata();\n  carregaCicloTaeniaSolium();\n  carregaCicloCisticercose();\n\n  // Scene darker and disable them by default\n  item.chiqueiro.setBrightness(100);\n  item.horta.setBrightness(100);\n  item.latrina.setBrightness(100);\n  item.lixeira.setBrightness(100);\n  item.pocoExterior.setBrightness(100);\n  item.vacaExterior.setBrightness(100);\n\n  item.estCenouraNormal.setBrightness(100);\n  item.estVacaNormal.setBrightness(100);\n  item.estPocoNormal.setBrightness(100);\n\n  // Livro inicial\n  item.livroCenaExteriorTitulo = new Game.Text(\n    \"<big>           Cena Exterior</big>\"\n  , estiloTitulo);\n  item.livroCenaExteriorTitulo.setPosition(248, 120);\n\n  item.livroCenaExteriorTexto1 = new Game.Text(\n    \"<big>     Nesta parte, você irá se deparar\\n\" +\n    \"com uma ordem programada de in-\\n\" +\n    \"teração com as personagens e suas\\n\" +\n    \"doenças. Apresentaremos quatro\\n\" +\n    \"doenças, mas apenas três parasitas.\\n\" +\n    \"Neste sentido, um dos parasitas é o\\n\" +\n    \"causador de duas doenças. Passe o\\n\" +\n    \"mouse pela tela e descubra qual é\\n\" +\n    \"esta ordem!</big>\"\n    , estiloTextoLivro);\n  item.livroCenaExteriorTexto1.setPosition(248, 300);\n\n  item.livroCenaExteriorInterrocacao = new Game.Image(\"interrogacao.png\");\n  item.livroCenaExteriorInterrocacao.setPosition(1270, 450);\n  item.livroCenaExteriorInterrocacao.setScale(1.4);\n\n  item.livroCenaExteriorTexto2 = new Game.Text(\n    \"<big>     Você conseguiu entender?! O\\n\" +\n    \"parasita Taenia solium pode gerar\\n\" +\n    \"a doença conhecida como Cisticer-\\n\" +\n    \"cose e também a doença dita Tenía-\\n\" +\n    \"se, a qual é muito parecida com a\\n\" +\n    \"Teníase causada pela Taenia sagina-\\n\" +\n    \"ta. Desta forma, estes dois parasitas\\n\" +\n    \"causam sintomas semelhantes.</big>\"\n    , estiloTextoLivro);\n  item.livroCenaExteriorTexto2.setPosition(990, 320);\n  item.livroCenaExteriorTexto2.setAlpha(0);\n  item.livroCenaExteriorTexto2.disable();\n\n  item.livroAberto = new Game.Item(\"livroAbertoSemMesa.png\");\n  item.livroAberto.setZorder(6);\n  item.livroAberto.setPosition(960, 540);\n  item.livroAberto.enable();\n  item.livroAberto.setAlpha(1);\n\n  // Fecha do primeiro livro (que aparece assim que entra na cena exterior)\n  item.fechaLivro = new Game.Item(\"botaoFechar.png\");\n  item.fechaLivro.setPosition(1840, 70);\n  item.fechaLivro.setZorder(1);\n  item.fechaLivro.setBrightness(200);\n  item.fechaLivro.setScale(0.14);\n  item.fechaLivro.enable();\n  item.fechaLivro.setAlpha(1);\n  item.fechaLivro.onMouseOver = function() {\n    item.fechaLivro.setBrightness(255);\n  }\n  item.fechaLivro.onMouseOut = function() {\n    item.fechaLivro.setBrightness(200);\n  }\n  item.fechaLivro.onClick = function(mouse) {\n    disableInteractiveness();\n    somClique();\n\n    // Esconde o livro\n    item.livroAberto.changeAlpha(0, 600);\n    item.fechaLivro.changeAlpha(0, 600);\n\n    // Esconde o texto\n    item.livroCenaExteriorTitulo.changeAlpha(0, 600);\n    item.livroCenaExteriorTexto1.changeAlpha(0, 600);\n    item.livroCenaExteriorInterrocacao.changeAlpha(0, 600);\n    item.livroCenaExteriorTexto2.changeAlpha(0, 600);\n\n    // Mostra setas da cena exterior\n    item.setaSalaDeAula.enable();\n    item.setaSalaDeAula.changeAlpha(1, 600);\n\n    scene[1].background.changeBrightness(210, 600);\n    item.chiqueiro.changeBrightness(210, 600);\n    item.horta.changeBrightness(210, 600);\n    item.latrina.changeBrightness(210, 600);\n    item.lixeira.changeBrightness(210, 600);\n    item.pocoExterior.changeBrightness(210, 600);\n    item.vacaExterior.changeBrightness(210, 600);\n\n    item.estPocoNormal.changeBrightness(210, 600);\n\n    setTimeout(function() {\n      item.livroAberto.disable();\n      item.fechaLivro.disable();\n      item.livroCenaExteriorTitulo.disable();\n      item.livroCenaExteriorTexto1.disable();\n      item.livroCenaExteriorInterrocacao.disable();\n      item.livroCenaExteriorTexto2.disable();\n\n      enableInteractiveness();\n    }, 650);\n  }\n\n  // Fechar do segundo livro (aparece apos ver Cisticercose pela primeira vez)\n  item.fechaLivro2 = new Game.Item(\"botaoFechar.png\");\n  item.fechaLivro2.setPosition(1840, 70);\n  item.fechaLivro2.setZorder(1);\n  item.fechaLivro2.setBrightness(200);\n  item.fechaLivro2.setScale(0.14);\n  item.fechaLivro2.disable();\n  item.fechaLivro2.setAlpha(0);\n  item.fechaLivro2.onMouseOver = function() {\n    item.fechaLivro2.setBrightness(255);\n  }\n  item.fechaLivro2.onMouseOut = function() {\n    item.fechaLivro2.setBrightness(200);\n  }\n  item.fechaLivro2.onClick = function(mouse) {\n    disableInteractiveness();\n    somClique();\n\n    // Esconde o livro\n    item.livroAberto.changeAlpha(0, 600);\n    item.fechaLivro2.changeAlpha(0, 600);\n\n    // Esconde o texto\n    item.livroCenaExteriorTitulo.changeAlpha(0, 600);\n    item.livroCenaExteriorTexto1.changeAlpha(0, 600);\n    item.livroCenaExteriorTexto2.changeAlpha(0, 600);\n\n    // Mostra cena\n    item.estCenouraNormal.enable();\n    item.estCenouraNormal.setBrightness(item.estCenouraNormal.brightnessTarget);\n    item.estCenouraNormal.changeAlpha(1, 600);\n\n    scene[1].background.changeBrightness(210, 600);\n    item.chiqueiro.changeBrightness(210, 600);\n    item.horta.changeBrightness(210, 600);\n    item.latrina.changeBrightness(210, 600);\n    item.lixeira.changeBrightness(210, 600);\n    item.pocoExterior.changeBrightness(210, 600);\n    item.vacaExterior.changeBrightness(210, 600);\n\n    item.estPocoNormal.changeBrightness(item.estPocoNormal.brightnessTarget, 600);\n    item.estVacaNormal.changeBrightness(item.estVacaNormal.brightnessTarget, 600);\n    item.estPorcoNormal.changeBrightness(item.estPorcoNormal.brightnessTarget, 600);\n    item.setaSalaDeAula.enable();\n    item.setaSalaDeAula.changeAlpha(1, 600);\n\n    item.cenouraBotaoOKhover.disable();\n    item.cenouraBalaoPrevencao.disable();\n    item.cenouraBalaoTransmissao.disable();\n    item.cenouraAbaSintomas.disable();\n    item.cenouraAbaPrevencao.disable();\n    item.cenouraAbaTransmissao.disable();\n    item.cenouraTextoPrevencao.disable();\n    item.cenouraTextoTransmissao.disable();\n\n    setTimeout(function() {\n      item.livroAberto.disable();\n      item.fechaLivro2.disable();\n      item.livroCenaExteriorTitulo.disable();\n      item.livroCenaExteriorTexto1.disable();\n\n      enableInteractiveness();\n    }, 650);\n\n    setTimeout(function() {\n      item.estPocoNormal.setInteractive(item.estPocoNormal.interactiveTarget);\n      item.estVacaNormal.setInteractive(item.estVacaNormal.interactiveTarget);\n      item.estPorcoNormal.setInteractive(item.estPorcoNormal.interactiveTarget);\n      item.estCenouraNormal.setInteractive(item.estCenouraNormal.interactiveTarget);\n\n      item.setaSalaDeAula.setInteractive(true);\n      item.chiqueiro.setInteractive(true);\n      item.horta.setInteractive(true);\n      item.latrina.setInteractive(true);\n      item.lixeira.setInteractive(true);\n      item.pocoExterior.setInteractive(true);\n\n      enableInteractiveness();\n      scene[1].saveInteractiveness();\n    }, 1300);\n  }\n\n  scene[1].addAllItemsToScene();\n}\n",
                "new_contents": "'use strict';\n\nsceneLoader[1] = function() {\n\n  // Iniciando a nova cena\n  scene[1] = new Game.Scene();\n  // Adicionando musica na cena\n  scene[1].setMusic(\"musicaAmbienteExterno.wav\", 1.0);\n\n  // Adicionando uma imagem de fundo\n  scene[1].background = new Game.Background(\"cenaExterior.jpg\");\n  scene[1].background.setBrightness(100);\n\n  // Criando um aliase de scene[1].item\n  var item = scene[1].item;\n\n  item.chiqueiro = new Game.Item(\"chiqueiro.png\");\n  item.chiqueiro.setPosition(238, 240);\n  item.chiqueiro.setZorder(15);\n  item.chiqueiro.onMouseOver = function() {\n    scene[1].setSubtitle(\"Chiqueiro\");\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n    item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();\n  }\n  item.chiqueiro.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n  }\n\n  item.horta = new Game.Item(\"horta.png\");\n  item.horta.setPosition(400, 660);\n  item.horta.setZorder(10);\n  item.horta.onMouseOver = function() {\n    scene[1].setSubtitle(\"Horta\");\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n    item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();\n  }\n  item.horta.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n  }\n\n  item.latrina = new Game.Item(\"latrina.png\");\n  item.latrina.setPosition(1450, 200);\n  item.latrina.setZorder(15);\n  item.latrina.onMouseOver = function() {\n    scene[1].setSubtitle(\"Fossa\");\n    somPopup();\n    item.popupLatrinaPoco.enable();\n    item.popupLatrinaPocoTexto.enable();\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n  }\n  item.latrina.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n    item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();\n  }\n\n  item.popupLatrinaPoco = new Game.Image(\"popupLatrinaPoco.png\");\n  item.popupLatrinaPoco.setPosition(1210, 440);\n  item.popupLatrinaPoco.setScale(0.24);\n  item.popupLatrinaPoco.disable();\n\n  item.popupLatrinaPocoTexto = new Game.Text(\n    \"Contaminação do poço artesiano\\n\" +\n    \"a partir da fossa. A localização\\n\" +\n    \"do poço deve levar em conta os\\n\" +\n    \"riscos de contaminação do lençol\\n\" +\n    \"freático, portanto, deve-se respei-\\n\" +\n    \"tar uma distância mínima de 15\\n\" +\n    \"metros de qualquer fossa e de 45\\n\" +\n    \"metros de chiqueiros, por exem-\\n\" +\n    \"plo. No ambiente representado\\n\" +\n    \"por esse Objeto de Aprendiza-\\n\" +\n    \"gem, estas regras não foram se-\\n\" +\n    \"guidas: a construção da fossa se\\n\" +\n    \"deu próxima ao poço.\"\n    ,estiloInfoPopup);\n  item.popupLatrinaPocoTexto.setPosition(1106, 430);\n  item.popupLatrinaPocoTexto.setAnchor(0.5, 0.5);\n  item.popupLatrinaPocoTexto.setZorder(4);\n  item.popupLatrinaPocoTexto.disable();\n\n  item.lixeira = new Game.Item(\"lixeira.png\");\n  item.lixeira.setPosition(567, 288);\n  item.lixeira.setZorder(16);\n  item.lixeira.onMouseOver = function() {\n    scene[1].setSubtitle(\"Lixo\");\n    somPopup();\n    item.popupChorume.enable();\n    item.popupChorumeTexto.enable();\n    item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();\n  }\n  item.lixeira.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n  }\n\n  item.popupChorume = new Game.Image(\"popupChorume.png\");\n  item.popupChorume.setPosition(900, 460);\n  item.popupChorume.setScale(0.27);\n  item.popupChorume.disable();\n\n  item.popupChorumeTexto = new Game.Text(\n    \"Contaminação do solo atra-\\n\" +\n    \"vés do chorume proveniente\\n\" +\n    \"do lixo depositado de modo\\n\" +\n    \"inadequado e por muito\\n\" +\n    \"tempo no local. O chorume\\n\" +\n    \"é um resíduo líquido forma-\\n\" +\n    \"do a partir da decomposição\\n\" +\n    \"de matéria orgânica presen-\\n\" +\n    \"te no lixo.\"\n    ,estiloInfoPopup);\n  item.popupChorumeTexto.setPosition(1010, 500);\n  item.popupChorumeTexto.setAnchor(0.5, 0.5);\n  item.popupChorumeTexto.setZorder(4);\n  item.popupChorumeTexto.disable();\n\n  item.pocoExterior = new Game.Item(\"pocoExterior.png\");\n  item.pocoExterior.setPosition(1723, 643);\n  item.pocoExterior.setZorder(10);\n  item.pocoExterior.onMouseOver = function() {\n    scene[1].setSubtitle(\"Poço artesiano\");\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n    item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();\n    /*item.popupLatrinaPoco.enable();\n    item.popupLatrinaPocoTexto.enable();\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();*/\n  }\n  item.pocoExterior.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n    /*item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();*/\n  }\n\n  item.vacaExterior = new Game.Image(\"vacaExterior.png\");\n  item.vacaExterior.setPosition(935, 252);\n  item.vacaExterior.setZorder(15);\n\n  // Adiciona uma seta para voltar na sala de aula\n  item.setaSalaDeAula = new Game.Item(\"seta.png\");\n  item.setaSalaDeAula.setPosition(210, 480);\n  item.setaSalaDeAula.setBrightness(220);\n  item.setaSalaDeAula.setScale(0.3);\n  item.setaSalaDeAula.setRotation(180);\n  item.setaSalaDeAula.setAlpha(0);\n  item.setaSalaDeAula.disable();\n  item.setaSalaDeAula.onMouseOver = function() {\n    scene[1].setSubtitle(\"Sala de aula\");\n    item.setaSalaDeAula.setBrightness(255);\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n    item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();\n  }\n  item.setaSalaDeAula.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n    item.setaSalaDeAula.setBrightness(220);\n  }\n  item.setaSalaDeAula.onClick = function(mouse) {\n    somSeta();\n    scene[1].setSubtitle(\"\");\n    changeScene(0); // Muda para a sala de aula\n  }\n\n  // Estados da cena\n  scene[1].state = 0;\n  scene[1].nextState = function() {\n    switch (scene[1].state) {\n      case 0:\n        scene[1].state = 1;\n        item.estPocoNormal.brightnessTarget = 150;\n        item.estPocoNormal.interactiveTarget = false;\n        item.estVacaNormal.brightnessTarget = 220;\n        item.estVacaNormal.interactiveTarget = true;\n        item.estPorcoNormal.brightnessTarget = 220;\n        item.estPorcoNormal.interactiveTarget = true;\n        item.estCenouraNormal.brightnessTarget = 150;\n        item.estCenouraNormal.interactiveTarget = false;\n        break;\n      case 1:\n        if (!item.estVacaNormal.interactiveTarget && !item.estPorcoNormal.interactiveTarget) {\n          scene[1].state = 2;\n          item.estCenouraNormal.brightnessTarget = 220;\n          item.estCenouraNormal.interactiveTarget = true;\n        }\n        break;\n      case 2:\n        scene[1].state = 3;\n        item.estPocoNormal.brightnessTarget = 220;\n        item.estPocoNormal.interactiveTarget = true;\n        item.estVacaNormal.brightnessTarget = 220;\n        item.estVacaNormal.interactiveTarget = true;\n        item.estPorcoNormal.brightnessTarget = 220;\n        item.estPorcoNormal.interactiveTarget = true;\n        break;\n      case 3:\n        item.estPocoNormal.brightnessTarget = 220;\n        item.estPocoNormal.interactiveTarget = true;\n        item.estVacaNormal.brightnessTarget = 220;\n        item.estVacaNormal.interactiveTarget = true;\n        item.estPorcoNormal.brightnessTarget = 220;\n        item.estPorcoNormal.interactiveTarget = true;\n        item.estCenouraNormal.brightnessTarget = 220;\n        item.estCenouraNormal.interactiveTarget = true;\n        break;\n    }\n    UpdateScreen();\n  }\n\n  // Carrega ciclos\n  carregaCicloGiardia();\n  carregaCicloTaeniaSaginata();\n  carregaCicloTaeniaSolium();\n  carregaCicloCisticercose();\n\n  // Scene darker and disable them by default\n  item.chiqueiro.setBrightness(100);\n  item.horta.setBrightness(100);\n  item.latrina.setBrightness(100);\n  item.lixeira.setBrightness(100);\n  item.pocoExterior.setBrightness(100);\n  item.vacaExterior.setBrightness(100);\n\n  item.estCenouraNormal.setBrightness(100);\n  item.estVacaNormal.setBrightness(100);\n  item.estPocoNormal.setBrightness(100);\n\n  // Livro inicial\n  item.livroCenaExteriorTitulo = new Game.Text(\n    \"<big>           Cena Exterior</big>\"\n  , estiloTitulo);\n  item.livroCenaExteriorTitulo.setPosition(248, 120);\n\n  item.livroCenaExteriorTexto1 = new Game.Text(\n    \"<big>     Nesta parte, você irá se deparar\\n\" +\n    \"com uma ordem programada de in-\\n\" +\n    \"teração com as personagens e suas\\n\" +\n    \"doenças. Apresentaremos quatro\\n\" +\n    \"doenças, mas apenas três parasitas.\\n\" +\n    \"Neste sentido, um dos parasitas é o\\n\" +\n    \"causador de duas doenças. Passe o\\n\" +\n    \"mouse pela tela e descubra qual é\\n\" +\n    \"esta ordem!</big>\"\n    , estiloTextoLivro);\n  item.livroCenaExteriorTexto1.setPosition(248, 350);\n\n  item.livroCenaExteriorInterrocacao = new Game.Image(\"interrogacao.png\");\n  item.livroCenaExteriorInterrocacao.setPosition(1270, 450);\n  item.livroCenaExteriorInterrocacao.setScale(1.4);\n\n  item.livroCenaExteriorTexto2 = new Game.Text(\n    \"<big>     Você conseguiu entender?!\\n\" +\n    \"  \\n\" +\n    \"  \\n\" +\n    \"O parasita <i>Taenia solium</i> pode gerar\\n\" +\n    \"a doença conhecida como Cisticer-\\n\" +\n    \"cose e também a doença dita Tenía-\\n\" +\n    \"se, a qual é muito parecida com a\\n\" +\n    \"Teníase causada pela <i>Taenia sagina-\\n\" +\n    \"ta</i>. Desta forma, estes dois parasitas\\n\" +\n    \"causam sintomas semelhantes.</big>\"\n    , estiloTextoLivro);\n  item.livroCenaExteriorTexto2.setPosition(990, 280);\n  item.livroCenaExteriorTexto2.setAlpha(0);\n  item.livroCenaExteriorTexto2.disable();\n\n  item.livroAberto = new Game.Item(\"livroAbertoSemMesa.png\");\n  item.livroAberto.setZorder(6);\n  item.livroAberto.setPosition(960, 540);\n  item.livroAberto.enable();\n  item.livroAberto.setAlpha(1);\n\n  // Fecha do primeiro livro (que aparece assim que entra na cena exterior)\n  item.fechaLivro = new Game.Item(\"botaoFechar.png\");\n  item.fechaLivro.setPosition(1840, 70);\n  item.fechaLivro.setZorder(1);\n  item.fechaLivro.setBrightness(200);\n  item.fechaLivro.setScale(0.14);\n  item.fechaLivro.enable();\n  item.fechaLivro.setAlpha(1);\n  item.fechaLivro.onMouseOver = function() {\n    item.fechaLivro.setBrightness(255);\n  }\n  item.fechaLivro.onMouseOut = function() {\n    item.fechaLivro.setBrightness(200);\n  }\n  item.fechaLivro.onClick = function(mouse) {\n    disableInteractiveness();\n    somClique();\n\n    // Esconde o livro\n    item.livroAberto.changeAlpha(0, 600);\n    item.fechaLivro.changeAlpha(0, 600);\n\n    // Esconde o texto\n    item.livroCenaExteriorTitulo.changeAlpha(0, 600);\n    item.livroCenaExteriorTexto1.changeAlpha(0, 600);\n    item.livroCenaExteriorInterrocacao.changeAlpha(0, 600);\n    item.livroCenaExteriorTexto2.changeAlpha(0, 600);\n\n    // Mostra setas da cena exterior\n    item.setaSalaDeAula.enable();\n    item.setaSalaDeAula.changeAlpha(1, 600);\n\n    scene[1].background.changeBrightness(210, 600);\n    item.chiqueiro.changeBrightness(210, 600);\n    item.horta.changeBrightness(210, 600);\n    item.latrina.changeBrightness(210, 600);\n    item.lixeira.changeBrightness(210, 600);\n    item.pocoExterior.changeBrightness(210, 600);\n    item.vacaExterior.changeBrightness(210, 600);\n\n    item.estPocoNormal.changeBrightness(210, 600);\n\n    setTimeout(function() {\n      item.livroAberto.disable();\n      item.fechaLivro.disable();\n      item.livroCenaExteriorTitulo.disable();\n      item.livroCenaExteriorTexto1.disable();\n      item.livroCenaExteriorInterrocacao.disable();\n      item.livroCenaExteriorTexto2.disable();\n\n      enableInteractiveness();\n    }, 650);\n  }\n\n  // Fechar do segundo livro (aparece apos ver Cisticercose pela primeira vez)\n  item.fechaLivro2 = new Game.Item(\"botaoFechar.png\");\n  item.fechaLivro2.setPosition(1840, 70);\n  item.fechaLivro2.setZorder(1);\n  item.fechaLivro2.setBrightness(200);\n  item.fechaLivro2.setScale(0.14);\n  item.fechaLivro2.disable();\n  item.fechaLivro2.setAlpha(0);\n  item.fechaLivro2.onMouseOver = function() {\n    item.fechaLivro2.setBrightness(255);\n  }\n  item.fechaLivro2.onMouseOut = function() {\n    item.fechaLivro2.setBrightness(200);\n  }\n  item.fechaLivro2.onClick = function(mouse) {\n    disableInteractiveness();\n    somClique();\n\n    // Esconde o livro\n    item.livroAberto.changeAlpha(0, 600);\n    item.fechaLivro2.changeAlpha(0, 600);\n\n    // Esconde o texto\n    item.livroCenaExteriorTitulo.changeAlpha(0, 600);\n    item.livroCenaExteriorTexto1.changeAlpha(0, 600);\n    item.livroCenaExteriorTexto2.changeAlpha(0, 600);\n\n    // Mostra cena\n    item.estCenouraNormal.enable();\n    item.estCenouraNormal.setBrightness(item.estCenouraNormal.brightnessTarget);\n    item.estCenouraNormal.changeAlpha(1, 600);\n\n    scene[1].background.changeBrightness(210, 600);\n    item.chiqueiro.changeBrightness(210, 600);\n    item.horta.changeBrightness(210, 600);\n    item.latrina.changeBrightness(210, 600);\n    item.lixeira.changeBrightness(210, 600);\n    item.pocoExterior.changeBrightness(210, 600);\n    item.vacaExterior.changeBrightness(210, 600);\n\n    item.estPocoNormal.changeBrightness(item.estPocoNormal.brightnessTarget, 600);\n    item.estVacaNormal.changeBrightness(item.estVacaNormal.brightnessTarget, 600);\n    item.estPorcoNormal.changeBrightness(item.estPorcoNormal.brightnessTarget, 600);\n    item.setaSalaDeAula.enable();\n    item.setaSalaDeAula.changeAlpha(1, 600);\n\n    item.cenouraBotaoOKhover.disable();\n    item.cenouraBalaoPrevencao.disable();\n    item.cenouraBalaoTransmissao.disable();\n    item.cenouraAbaSintomas.disable();\n    item.cenouraAbaPrevencao.disable();\n    item.cenouraAbaTransmissao.disable();\n    item.cenouraTextoPrevencao.disable();\n    item.cenouraTextoTransmissao.disable();\n\n    setTimeout(function() {\n      item.livroAberto.disable();\n      item.fechaLivro2.disable();\n      item.livroCenaExteriorTitulo.disable();\n      item.livroCenaExteriorTexto1.disable();\n\n      enableInteractiveness();\n    }, 650);\n\n    setTimeout(function() {\n      item.estPocoNormal.setInteractive(item.estPocoNormal.interactiveTarget);\n      item.estVacaNormal.setInteractive(item.estVacaNormal.interactiveTarget);\n      item.estPorcoNormal.setInteractive(item.estPorcoNormal.interactiveTarget);\n      item.estCenouraNormal.setInteractive(item.estCenouraNormal.interactiveTarget);\n\n      item.setaSalaDeAula.setInteractive(true);\n      item.chiqueiro.setInteractive(true);\n      item.horta.setInteractive(true);\n      item.latrina.setInteractive(true);\n      item.lixeira.setInteractive(true);\n      item.pocoExterior.setInteractive(true);\n\n      enableInteractiveness();\n      scene[1].saveInteractiveness();\n    }, 1300);\n  }\n\n  scene[1].addAllItemsToScene();\n}\n",
                "subject": "Small adjustments on extern book",
                "message": "Small adjustments on extern book\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "Yutsuten/AppEducacional-Parasitologia,mateus-etto/AppEducacional-Parasitologia,mateus-etto/AppEducacional-Parasitologia,Yutsuten/AppEducacional-Parasitologia"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10258,
            "row": {
                "commit": "7f12121ccce53e465057cbff1c9ee0042dba356c",
                "old_file": "app/home/home.js",
                "new_file": "app/home/home.js",
                "old_contents": "'use strict';\n\nangular.module('myApp.home', ['ngRoute', 'ngFileUpload'])\n\n.config(['$routeProvider', function($routeProvider) {\n  $routeProvider.when('/home', {\n    templateUrl: 'home/home.html',\n    controller: 'HomeCtrl'\n  });\n}])\n\n.controller('HomeCtrl', ['$scope', 'Upload', function($scope, Upload) {\n\t$scope.welcome = \"welcome to wordbase solver\"\n\t$scope.$watch('files', function() {\n\t\t$scope.formUpload = false;\n\t\tconsole.log(\"before upload\")\n\t\t$scope.upload($scope.files);\n\t});\n\t$scope.upload = function(files) {\n\t\tif(files && files.length) {\n\t\t\tvar file = files[0];\n\t\t\tconsole.log(\"uploading\")\n\t\t\tconsole.log(\"color: \", $scope.color);\n\t\t\tUpload.upload({\n\t\t\t\turl: 'http://52.74.179.193:8000/upload',\n\t\t\t\tfile: file,\n\t\t\t\tfields: {'color': $scope.color}\n\t\t\t}).progress(function(evt) {\n\t\t\t\tvar progressPercentage = parseInt(100.0 * evt.loaded/evt.total);\n\t\t\t\tconsole.log('progress: ' + progressPercentage + '% ' + evt.config.file.name);\n\t\t\t}).success(function(data, status, headers, config) {\n\t\t\t\tconsole.log('Response: ' + data);\n\t\t\t\tvar words = data.split(\" \");\n\t\t\t\tvar uniqueWords = [];\n\t\t\t\t$.each(words, function(i, el){\n\t\t\t\t    if($.inArray(el, uniqueWords) === -1) uniqueWords.push(el);\n\t\t\t\t});\n\t\t\t\t$scope.words = uniqueWords.slice(0, 30);\n\t\t\t\t\n\t\t\t});\n\t\t}\n\t};\n}]);\n",
                "new_contents": "'use strict';\n\nangular.module('myApp.home', ['ngRoute', 'ngFileUpload'])\n\n.config(['$routeProvider', function($routeProvider) {\n  $routeProvider.when('/home', {\n    templateUrl: 'home/home.html',\n    controller: 'HomeCtrl'\n  });\n}])\n\n.controller('HomeCtrl', ['$scope', 'Upload', function($scope, Upload) {\n\t$scope.color = 'orange';\n\t$scope.$watch('files', function() {\n\t\t$scope.formUpload = false;\n\t\tconsole.log(\"before upload\")\n\t\t$scope.upload($scope.files);\n\t});\n\t$scope.upload = function(files) {\n\t\tif(files && files.length) {\n\t\t\tvar file = files[0];\n\t\t\tconsole.log(\"uploading\")\n\t\t\tconsole.log(\"color: \", $scope.color);\n\t\t\tUpload.upload({\n\t\t\t\turl: 'http://52.74.179.193:8000/upload',\n\t\t\t\tfile: file,\n\t\t\t\tfields: {'color': $scope.color}\n\t\t\t}).progress(function(evt) {\n\t\t\t\tvar progressPercentage = parseInt(100.0 * evt.loaded/evt.total);\n\t\t\t\tconsole.log('progress: ' + progressPercentage + '% ' + evt.config.file.name);\n\t\t\t}).success(function(data, status, headers, config) {\n\t\t\t\tconsole.log('Response: ' + data);\n\t\t\t\tvar words = data.split(\" \");\n\t\t\t\tvar uniqueWords = [];\n\t\t\t\t$.each(words, function(i, el){\n\t\t\t\t    if($.inArray(el, uniqueWords) === -1) uniqueWords.push(el);\n\t\t\t\t});\n\t\t\t\t$scope.words = uniqueWords.slice(0, 30);\n\t\t\t\t\n\t\t\t});\n\t\t}\n\t};\n}]);\n",
                "subject": "set orange as default",
                "message": "set orange as default\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "uohzxela/wordbase-solver-web,uohzxela/wordbase-solver-web"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10259,
            "row": {
                "commit": "87de94aa848c87775605cdffcccfbd0fbeacbcf3",
                "old_file": "js/cena1_exterior.js",
                "new_file": "js/cena1_exterior.js",
                "old_contents": "'use strict';\n\nsceneLoader[1] = function() {\n\n  // Iniciando a nova cena\n  scene[1] = new Game.Scene();\n  // Adicionando musica na cena\n  scene[1].setMusic(\"musicaCenaExterna.mp3\");\n\n  // Adicionando uma imagem de fundo\n  scene[1].background = new Game.Background(\"cenaExterior.jpg\");\n  // Para ajuda no desenvolvimento, colocando um evento de clique no fundo para\n  // Mostrar as coordenadas\n  scene[1].background.setInteractive(true);\n  scene[1].background.click = function(mouse) {\n    var mousePosition = mouse.data.getLocalPosition(stage);\n    console.log(Math.round(mousePosition.x) + \"; \" + Math.round(mousePosition.y));\n  }\n\n  // Criando um aliase de scene[1].item\n  var item = scene[1].item;\n\n  item.chiqueiro = new Game.Item(\"chiqueiro.png\");\n  item.chiqueiro.setPosition(238, 240);\n  item.chiqueiro.setZorder(15);\n  item.chiqueiro.onMouseOver = function() {\n    scene[1].setSubtitle(\"Chiqueiro\");\n  }\n  item.chiqueiro.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n  }\n\n  item.horta = new Game.Item(\"horta.png\");\n  item.horta.setPosition(400, 660);\n  item.horta.setZorder(10);\n  item.horta.onMouseOver = function() {\n    scene[1].setSubtitle(\"Horta\");\n  }\n  item.horta.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n  }\n\n  item.latrina = new Game.Item(\"latrina.png\");\n  item.latrina.setPosition(1450, 200);\n  item.latrina.setZorder(15);\n  item.latrina.onMouseOver = function() {\n    scene[1].setSubtitle(\"Fossa\");\n  }\n  item.latrina.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n  }\n\n  item.lixeira = new Game.Item(\"lixeira.png\");\n  item.lixeira.setPosition(567, 288);\n  item.lixeira.setZorder(16);\n  item.lixeira.onMouseOver = function() {\n    scene[1].setSubtitle(\"Lixo\");\n    item.popupChorume.enable();\n    item.popupChorumeTexto.enable();\n  }\n  item.lixeira.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n  }\n\n  item.popupChorume = new Game.Image(\"popupChorume.png\");\n  item.popupChorume.setPosition(900, 460);\n  item.popupChorume.setScale(0.27);\n  item.popupChorume.disable();\n\n  item.popupChorumeTexto = new Game.Text(\n    \"Contaminação do solo atra-\\n\" +\n    \"vés do chorume proveniente\\n\" +\n    \"do lixo depositado de modo\\n\" +\n    \"inadequado e por muito\\n\" +\n    \"tempo no local. O chorume\\n\" +\n    \"é um resíduo líquido forma-\\n\" +\n    \"do a partir da decomposição\\n\" +\n    \"de matéria orgânica presen-\\n\" +\n    \"te no lixo.\"\n    ,estiloInfoPopup);\n  item.popupChorumeTexto.setPosition(1010, 500);\n  item.popupChorumeTexto.setAnchor(0.5, 0.5);\n  item.popupChorumeTexto.disable();\n\n  item.pocoExterior = new Game.Item(\"pocoExterior.png\");\n  item.pocoExterior.setPosition(1723, 643);\n  item.pocoExterior.setZorder(10);\n  item.pocoExterior.onMouseOver = function() {\n    scene[1].setSubtitle(\"Poço artesiano\");\n  }\n  item.pocoExterior.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n  }\n\n  item.vacaExterior = new Game.Image(\"vacaExterior.png\");\n  item.vacaExterior.setPosition(935, 252);\n  item.vacaExterior.setZorder(15);\n\n  // Adiciona uma seta para voltar na sala de aula\n  item.setaSalaDeAula = new Game.Item(\"seta.png\");\n  item.setaSalaDeAula.setPosition(210, 480);\n  item.setaSalaDeAula.setBrightness(220);\n  item.setaSalaDeAula.setScale(0.3);\n  item.setaSalaDeAula.setRotation(180);\n  item.setaSalaDeAula.setInteractive(true);\n  item.setaSalaDeAula.onMouseOver = function() {\n    scene[1].setSubtitle(\"Sala de aula\");\n    item.setaSalaDeAula.setBrightness(255);\n  }\n  item.setaSalaDeAula.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n    item.setaSalaDeAula.setBrightness(220);\n  }\n  item.setaSalaDeAula.onClick = function(mouse) {\n    changeScene(0); // Muda para a sala de aula\n  }\n\n  // Estados da cena\n  scene[1].state = 0;\n  scene[1].nextState = function() {\n    switch (scene[1].state) {\n      case 0:\n        scene[1].state = 1;\n        item.estPocoNormal.brightnessTarget = 150;\n        item.estPocoNormal.interactiveTarget = false;\n        item.estVacaNormal.brightnessTarget = 220;\n        item.estVacaNormal.interactiveTarget = true;\n        item.estPorcoNormal.brightnessTarget = 220;\n        item.estPorcoNormal.interactiveTarget = true;\n        item.estCenouraNormal.brightnessTarget = 150;\n        item.estCenouraNormal.interactiveTarget = false;\n        break;\n      case 1:\n        if (!item.estVacaNormal.interactiveTarget && !item.estPorcoNormal.interactiveTarget) {\n          scene[1].state = 2;\n          item.estCenouraNormal.brightnessTarget = 220;\n          item.estCenouraNormal.interactiveTarget = true;\n        }\n        break;\n      case 2:\n        scene[1].state = 3;\n        item.estPocoNormal.brightnessTarget = 220;\n        item.estPocoNormal.interactiveTarget = true;\n        item.estVacaNormal.brightnessTarget = 220;\n        item.estVacaNormal.interactiveTarget = true;\n        item.estPorcoNormal.brightnessTarget = 220;\n        item.estPorcoNormal.interactiveTarget = true;\n        break;\n      case 3:\n        item.estPocoNormal.brightnessTarget = 220;\n        item.estPocoNormal.interactiveTarget = true;\n        item.estVacaNormal.brightnessTarget = 220;\n        item.estVacaNormal.interactiveTarget = true;\n        item.estPorcoNormal.brightnessTarget = 220;\n        item.estPorcoNormal.interactiveTarget = true;\n        item.estCenouraNormal.brightnessTarget = 220;\n        item.estCenouraNormal.interactiveTarget = true;\n        break;\n    }\n    UpdateScreen();\n  }\n\n  // Carrega ciclos\n  carregaCicloGiardia();\n  carregaCicloTaeniaSaginata();\n  carregaCicloTaeniaSolium();\n  carregaCicloCisticercose();\n\n  scene[1].addAllItemsToScene();\n}\n",
                "new_contents": "'use strict';\n\nsceneLoader[1] = function() {\n\n  // Iniciando a nova cena\n  scene[1] = new Game.Scene();\n  // Adicionando musica na cena\n  scene[1].setMusic(\"musicaCenaExterna.mp3\");\n\n  // Adicionando uma imagem de fundo\n  scene[1].background = new Game.Background(\"cenaExterior.jpg\");\n  // Para ajuda no desenvolvimento, colocando um evento de clique no fundo para\n  // Mostrar as coordenadas\n  scene[1].background.setInteractive(true);\n  scene[1].background.click = function(mouse) {\n    var mousePosition = mouse.data.getLocalPosition(stage);\n    console.log(Math.round(mousePosition.x) + \"; \" + Math.round(mousePosition.y));\n  }\n\n  // Criando um aliase de scene[1].item\n  var item = scene[1].item;\n\n  item.chiqueiro = new Game.Item(\"chiqueiro.png\");\n  item.chiqueiro.setPosition(238, 240);\n  item.chiqueiro.setZorder(15);\n  item.chiqueiro.onMouseOver = function() {\n    scene[1].setSubtitle(\"Chiqueiro\");\n  }\n  item.chiqueiro.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n  }\n\n  item.horta = new Game.Item(\"horta.png\");\n  item.horta.setPosition(400, 660);\n  item.horta.setZorder(10);\n  item.horta.onMouseOver = function() {\n    scene[1].setSubtitle(\"Horta\");\n  }\n  item.horta.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n  }\n\n  item.latrina = new Game.Item(\"latrina.png\");\n  item.latrina.setPosition(1450, 200);\n  item.latrina.setZorder(15);\n  item.latrina.onMouseOver = function() {\n    scene[1].setSubtitle(\"Fossa\");\n    item.popupLatrinaPoco.enable();\n    item.popupLatrinaPocoTexto.enable();\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n  }\n  item.latrina.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n    item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();\n  }\n\n  item.popupLatrinaPoco = new Game.Image(\"popupLatrinaPoco.png\");\n  item.popupLatrinaPoco.setPosition(1210, 440);\n  item.popupLatrinaPoco.setScale(0.23);\n  item.popupLatrinaPoco.disable();\n\n  item.popupLatrinaPocoTexto = new Game.Text(\n    \"Contaminação do poço artesiano\\n\" +\n    \"a partir da fossa. A localização\\n\" +\n    \"do poço deve levar em conta os\\n\" +\n    \"riscos de contaminação do lençol\\n\" +\n    \"freático, portanto, deve-se respei-\\n\" +\n    \"tar uma distância mínima de 15\\n\" +\n    \"metros de qualquer fossa e de 45\\n\" +\n    \"metros de chiqueiros, por exem-\\n\" +\n    \"plo. No ambiente representado\\n\" +\n    \"por esse Objeto de Aprendiza-\\n\" +\n    \"gem, estas regras não foram se-\\n\" +\n    \"guidas: a construção da fossa se\\n\" +\n    \"deu próxima ao poço.\"\n    ,estiloInfoPopup);\n  item.popupLatrinaPocoTexto.setPosition(1110, 430);\n  item.popupLatrinaPocoTexto.setAnchor(0.5, 0.5);\n  item.popupLatrinaPocoTexto.disable();\n\n  item.lixeira = new Game.Item(\"lixeira.png\");\n  item.lixeira.setPosition(567, 288);\n  item.lixeira.setZorder(16);\n  item.lixeira.onMouseOver = function() {\n    scene[1].setSubtitle(\"Lixo\");\n    item.popupChorume.enable();\n    item.popupChorumeTexto.enable();\n    item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();\n  }\n  item.lixeira.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n  }\n\n  item.popupChorume = new Game.Image(\"popupChorume.png\");\n  item.popupChorume.setPosition(900, 460);\n  item.popupChorume.setScale(0.27);\n  item.popupChorume.disable();\n\n  item.popupChorumeTexto = new Game.Text(\n    \"Contaminação do solo atra-\\n\" +\n    \"vés do chorume proveniente\\n\" +\n    \"do lixo depositado de modo\\n\" +\n    \"inadequado e por muito\\n\" +\n    \"tempo no local. O chorume\\n\" +\n    \"é um resíduo líquido forma-\\n\" +\n    \"do a partir da decomposição\\n\" +\n    \"de matéria orgânica presen-\\n\" +\n    \"te no lixo.\"\n    ,estiloInfoPopup);\n  item.popupChorumeTexto.setPosition(1010, 500);\n  item.popupChorumeTexto.setAnchor(0.5, 0.5);\n  item.popupChorumeTexto.disable();\n\n  item.pocoExterior = new Game.Item(\"pocoExterior.png\");\n  item.pocoExterior.setPosition(1723, 643);\n  item.pocoExterior.setZorder(10);\n  item.pocoExterior.onMouseOver = function() {\n    scene[1].setSubtitle(\"Poço artesiano\");\n    item.popupLatrinaPoco.enable();\n    item.popupLatrinaPocoTexto.enable();\n    item.popupChorume.disable();\n    item.popupChorumeTexto.disable();\n  }\n  item.pocoExterior.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n    item.popupLatrinaPoco.disable();\n    item.popupLatrinaPocoTexto.disable();\n  }\n\n  item.vacaExterior = new Game.Image(\"vacaExterior.png\");\n  item.vacaExterior.setPosition(935, 252);\n  item.vacaExterior.setZorder(15);\n\n  // Adiciona uma seta para voltar na sala de aula\n  item.setaSalaDeAula = new Game.Item(\"seta.png\");\n  item.setaSalaDeAula.setPosition(210, 480);\n  item.setaSalaDeAula.setBrightness(220);\n  item.setaSalaDeAula.setScale(0.3);\n  item.setaSalaDeAula.setRotation(180);\n  item.setaSalaDeAula.setInteractive(true);\n  item.setaSalaDeAula.onMouseOver = function() {\n    scene[1].setSubtitle(\"Sala de aula\");\n    item.setaSalaDeAula.setBrightness(255);\n  }\n  item.setaSalaDeAula.onMouseOut = function() {\n    scene[1].setSubtitle(\"\");\n    item.setaSalaDeAula.setBrightness(220);\n  }\n  item.setaSalaDeAula.onClick = function(mouse) {\n    changeScene(0); // Muda para a sala de aula\n  }\n\n  // Estados da cena\n  scene[1].state = 0;\n  scene[1].nextState = function() {\n    switch (scene[1].state) {\n      case 0:\n        scene[1].state = 1;\n        item.estPocoNormal.brightnessTarget = 150;\n        item.estPocoNormal.interactiveTarget = false;\n        item.estVacaNormal.brightnessTarget = 220;\n        item.estVacaNormal.interactiveTarget = true;\n        item.estPorcoNormal.brightnessTarget = 220;\n        item.estPorcoNormal.interactiveTarget = true;\n        item.estCenouraNormal.brightnessTarget = 150;\n        item.estCenouraNormal.interactiveTarget = false;\n        break;\n      case 1:\n        if (!item.estVacaNormal.interactiveTarget && !item.estPorcoNormal.interactiveTarget) {\n          scene[1].state = 2;\n          item.estCenouraNormal.brightnessTarget = 220;\n          item.estCenouraNormal.interactiveTarget = true;\n        }\n        break;\n      case 2:\n        scene[1].state = 3;\n        item.estPocoNormal.brightnessTarget = 220;\n        item.estPocoNormal.interactiveTarget = true;\n        item.estVacaNormal.brightnessTarget = 220;\n        item.estVacaNormal.interactiveTarget = true;\n        item.estPorcoNormal.brightnessTarget = 220;\n        item.estPorcoNormal.interactiveTarget = true;\n        break;\n      case 3:\n        item.estPocoNormal.brightnessTarget = 220;\n        item.estPocoNormal.interactiveTarget = true;\n        item.estVacaNormal.brightnessTarget = 220;\n        item.estVacaNormal.interactiveTarget = true;\n        item.estPorcoNormal.brightnessTarget = 220;\n        item.estPorcoNormal.interactiveTarget = true;\n        item.estCenouraNormal.brightnessTarget = 220;\n        item.estCenouraNormal.interactiveTarget = true;\n        break;\n    }\n    UpdateScreen();\n  }\n\n  // Carrega ciclos\n  carregaCicloGiardia();\n  carregaCicloTaeniaSaginata();\n  carregaCicloTaeniaSolium();\n  carregaCicloCisticercose();\n\n  scene[1].addAllItemsToScene();\n}\n",
                "subject": "added popup on the well",
                "message": "added popup on the well\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "mateus-etto/AppEducacional-Parasitologia,mateus-etto/AppEducacional-Parasitologia,Yutsuten/AppEducacional-Parasitologia,Yutsuten/AppEducacional-Parasitologia"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10260,
            "row": {
                "commit": "2aed23d2f0eeea4a6005ed02027165c269e39a7c",
                "old_file": "modules/article-senders/client/directives/contenteditable.client.directives.js",
                "new_file": "modules/article-senders/client/directives/contenteditable.client.directives.js",
                "old_contents": "(function () {\n  'use strict';\n\n  angular\n    .module('article-senders')\n    .directive('contenteditable', ['$timeout', function ($timeout) {\n      return {\n        restrict: 'A',\n        require: '?ngModel',\n        link: function (scope, element, attrs, ngModel) {\n          // don't do anything unless this is actually bound to a model\n          if (!ngModel) {\n            return\n          }\n\n          // options\n          var opts = {};\n          angular.forEach([\n            'stripBr',\n            'noLineBreaks',\n            'selectNonEditable',\n            'moveCaretToEndOnChange',\n            'stripTags'\n          ], function (opt) {\n            var o = attrs[opt];\n            opts[opt] = o && o !== 'false';\n          });\n\n          // view -> model\n          element.bind('blur keyup change', function (e) {\n            scope.$apply(function () {\n              var html, html2, rerender;\n              html = element.html();\n              rerender = false;\n              if (opts.stripBr) {\n                html = html.replace(/<br>$/, '');\n              }\n              if (opts.noLineBreaks) {\n                html2 = html.replace(/<div>/g, '').replace(/<br>/g, '').replace(/<\/div>/g, '')\n                if (html2 !== html) {\n                  rerender = true;\n                  html = html2;\n                }\n              }\n              if (opts.stripTags) {\n                rerender = true;\n                html = html.replace(/<\\S[^><]*>/g, '');\n              }\n              ngModel.$setViewValue(html);\n              if (rerender) {\n                ngModel.$render();\n              }\n              \n            })\n          });\n\n          // model -> view\n          var oldRender = ngModel.$render;\n          ngModel.$render = function () {\n            var el, el2, range, sel;\n            if (!!oldRender) {\n              oldRender()\n            }\n            var html = ngModel.$viewValue || '';\n            if (opts.stripTags) {\n              html = html.replace(/<\\S[^><]*>/g, '')\n            }\n\n            element.html(html);\n            if (opts.moveCaretToEndOnChange) {\n              el = element[0];\n              range = document.createRange();\n              sel = window.getSelection();\n              if (el.childNodes.length > 0) {\n                el2 = el.childNodes[el.childNodes.length - 1];\n                range.setStartAfter(el2)\n              } else {\n                range.setStartAfter(el)\n              }\n              range.collapse(true);\n              sel.removeAllRanges();\n              sel.addRange(range)\n            }\n          };\n          if (opts.selectNonEditable) {\n            element.bind('click', function (e) {\n              var range, sel, target;\n              target = e.toElement;\n              if (target !== this && angular.element(target).attr('contenteditable') === 'false') {\n                range = document.createRange();\n                sel = window.getSelection();\n                range.setStartBefore(target);\n                range.setEndAfter(target);\n                sel.removeAllRanges();\n                sel.addRange(range);\n              }\n            })\n          }\n        }\n      }\n    }]);\n\n}());\n\n",
                "new_contents": "(function () {\n  'use strict';\n\n  angular\n    .module('article-senders')\n    .directive('contenteditable', ['$timeout', function ($timeout) {\n      return {\n        restrict: 'A',\n        require: '?ngModel',\n        link: function (scope, element, attrs, ngModel) {\n          // don't do anything unless this is actually bound to a model\n          if (!ngModel) {\n            return;\n          }\n\n          // options\n          var opts = {};\n          angular.forEach([\n            'stripBr',\n            'noLineBreaks',\n            'selectNonEditable',\n            'moveCaretToEndOnChange',\n            'stripTags'\n          ], function (opt) {\n            var o = attrs[opt];\n            opts[opt] = o && o !== 'false';\n          });\n\n          // view -> model\n          element.bind('blur keyup change', function (e) {\n            scope.$apply(function () {\n              var html,\n                html2,\n                rerender;\n\n              html = element.html();\n              rerender = false;\n              if (opts.stripBr) {\n                html = html.replace(/<br>$/, '');\n              }\n              if (opts.noLineBreaks) {\n                html2 = html.replace(/<div>/g, '').replace(/<br>/g, '').replace(/<\/div>/g, '');\n                if (html2 !== html) {\n                  rerender = true;\n                  html = html2;\n                }\n              }\n              if (opts.stripTags) {\n                rerender = true;\n                html = html.replace(/<\\S[^><]*>/g, '');\n              }\n              ngModel.$setViewValue(html);\n              if (rerender) {\n                ngModel.$render();\n              }\n              \n            });\n          });\n\n          // model -> view\n          var oldRender = ngModel.$render;\n          ngModel.$render = function () {\n            var el,\n              el2,\n              range,\n              sel;\n            \n            if (!!oldRender) {\n              oldRender();\n            }\n            var html = ngModel.$viewValue || '';\n            if (opts.stripTags) {\n              html = html.replace(/<\\S[^><]*>/g, '');\n            }\n\n            element.html(html);\n            if (opts.moveCaretToEndOnChange) {\n              el = element[0];\n              range = document.createRange();\n              sel = window.getSelection();\n              if (el.childNodes.length > 0) {\n                el2 = el.childNodes[el.childNodes.length - 1];\n                range.setStartAfter(el2);\n              } else {\n                range.setStartAfter(el);\n              }\n              range.collapse(true);\n              sel.removeAllRanges();\n              sel.addRange(range);\n            }\n          };\n          if (opts.selectNonEditable) {\n            element.bind('click', function (e) {\n              var range,\n                sel,\n                target;\n              \n              target = e.toElement;\n              if (target !== this && angular.element(target).attr('contenteditable') === 'false') {\n                range = document.createRange();\n                sel = window.getSelection();\n                range.setStartBefore(target);\n                range.setEndAfter(target);\n                sel.removeAllRanges();\n                sel.addRange(range);\n              }\n            });\n          }\n        }\n      };\n    }]);\n\n}());\n\n",
                "subject": "elint fix",
                "message": "elint fix\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "leorez/bitpr,leorez/bitpr,leorez/bitpr"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10261,
            "row": {
                "commit": "77a6fd244af4bcf28a906606b8797a98bbe07416",
                "old_file": "client/game/classes/s.HUD.js",
                "new_file": "client/game/classes/s.HUD.js",
                "old_contents": "s.HUD = function(options) {\n  this.game = options.game;\n\n  // Add crosshairs\n  this.crosshairs = new THREE.Sprite(new THREE.SpriteMaterial({\n    map: s.textures.crosshairs,\n    useScreenCoordinates: false,\n    blending: THREE.AdditiveBlending,\n    color: 0x00FF00\n  }));\n\n  this.game.camera.add(this.crosshairs);\n  this.crosshairs.position.setZ(-30);\n\n  // Create canvas\n  this.canvas = document.createElement('canvas');\n\n  this.width = this.canvas.width = window.innerWidth;\n  this.height = this.canvas.height = window.innerHeight;\n\n  this.canvas.style.position = 'absolute';\n  this.canvas.style.top = 0;\n  this.canvas.style.left = 0;\n\n  this.ctx = this.canvas.getContext('2d');\n  document.body.appendChild(this.canvas);\n\n  // Update on tick\n  this.update = this.update.bind(this);\n  this.game.hook(this.update);\n\n  // Set size when window size changed\n  this.fitWindow = this.fitWindow.bind(this);\n  $(window).on('resize', this.fitWindow);\n  this.fitWindow();\n};\n\ns.HUD.baseColor = 'rgba(0, 255, 0, 0.5)';\n\n// The height of the directional indicator (away from the circumference of the circle)\ns.HUD.directionalIndicatorHeight = 20;\n\n// The angular offset for the two sides of the directional indicator\ns.HUD.directionalIndicatorAngularWidth = Math.PI/32;\n\ns.HUD.friendlyIndicatorColor = 'rgba(0, 255, 0, 0.75)';\ns.HUD.enemyIndicatorColor = 'rgba(255, 143, 0, 0.75)';\ns.HUD.indicatorStroke = 'rgba(0, 0, 0, 0.5)';\n\ns.HUD.targetColor = 'rgba(255, 0, 0, 0.5)';\n\n// The radius of the circle around which directional circles should be drawn\ns.HUD.radius = 200;\n\n// The size of the target square relative to distance\ns.HUD.squareSizeFactor = 0.02;\n\ns.HUD.prototype.update = function() {\n  // Clear canvas\n  this.ctx.clearRect(0, 0, this.width, this.height);\n\n  this.drawTarget(s.game.spaceStation.root, s.HUD.friendlyIndicatorColor, 34, 5500);\n\n  this.drawTarget(s.game.moonBase1.root, s.HUD.enemyIndicatorColor, 34, 5500);\n};\n\ns.HUD.prototype.writeName = function(name, position, fillColor, textOffset) {\n  this.ctx.fillStyle = fillColor;\n  // @todo correctly center text\n  this.ctx.font = 'bold 14px Andale Mono';\n  var width = this.ctx.measureText(name).width;\n  this.ctx.fillText(name, position.x - width / 2, position.y + textOffset);\n};\n\ns.HUD.prototype.fitWindow = function() {\n  this.width = this.canvas.width = window.innerWidth;\n  this.height = this.canvas.height = window.innerHeight;\n  this.centerX = this.width / 2;\n  this.centerY = this.height / 2;\n};\n\ns.HUD.prototype.drawTarget = function(circleTarget, fillColor, distanceFromRadius, maxBoxDistance) {\n  var circleTargetInSight;\n  var distanceToCircleTarget;\n  var v2DcircleTarget;\n  var squareSize;\n\n  var vcircleTarget3D = circleTarget.position.clone();\n  var vcircleTarget2D = s.projector.projectVector(vcircleTarget3D, s.game.camera);\n\n  if (Math.abs(vcircleTarget2D.x) <= 0.95 && Math.abs(vcircleTarget2D.y) <= 0.95 && vcircleTarget2D.z < 1) {\n    circleTargetInSight = true;\n    distanceToCircleTarget = this.game.player.root.position.distanceTo(circleTarget.position);\n    squareSize = Math.round((this.width - distanceToCircleTarget/100)*s.HUD.squareSizeFactor);\n  }\n\n  // circleTarget targeting reticle and targeting box\n  if (!circleTargetInSight) {\n    var circleTarget2D = new THREE.Vector2(vcircleTarget2D.x, vcircleTarget2D.y);\n    circleTarget2D.multiplyScalar(1/circleTarget2D.length()).multiplyScalar(s.HUD.radius+distanceFromRadius);\n\n    if (vcircleTarget2D.z > 1) {\n      // Target is behind us\n      // Things get ugly so do nothing\n      // this.ctx.arc(-circleTarget2D.x+this.centerX, (-circleTarget2D.y+this.centerY), 10, 0, 2*Math.PI, false);\n    }\n    else {\n      // Target is in front of us\n      this.ctx.beginPath();\n      var directionalIndicatorCenterX = circleTarget2D.x+this.centerX\n      var directionalIndicatorCenterY = -(circleTarget2D.y-this.centerY);\n\n      // Calculate angle away from center\n      var directionalIndicatorAngle = Math.atan2(directionalIndicatorCenterY-this.centerY, directionalIndicatorCenterX-this.centerX)\n\n      // Calculate the tip of the triangle\n      var directionalIndicatorTopX = this.centerX + (s.HUD.radius + s.HUD.directionalIndicatorHeight) * Math.cos(directionalIndicatorAngle);\n      var directionalIndicatorTopY = this.centerY + (s.HUD.radius + s.HUD.directionalIndicatorHeight) * Math.sin(directionalIndicatorAngle);\n\n      // Calculate the first vertex of the triangle, on the circumference\n      var directionalIndicatorSide1X = this.centerX + s.HUD.radius * Math.cos(directionalIndicatorAngle + s.HUD.directionalIndicatorAngularWidth);\n      var directionalIndicatorSide1Y = this.centerY + s.HUD.radius * Math.sin(directionalIndicatorAngle + s.HUD.directionalIndicatorAngularWidth);\n\n      // Calculate the divot in the triangle, between the circumference and the tip\n      var directionalIndicatorDivotX = this.centerX + (s.HUD.radius + s.HUD.directionalIndicatorHeight/2) * Math.cos(directionalIndicatorAngle);\n      var directionalIndicatorDivotY = this.centerY + (s.HUD.radius + s.HUD.directionalIndicatorHeight/2) * Math.sin(directionalIndicatorAngle);\n\n      // Calculate the second vertex of the triangle, on the circumference\n      var directionalIndicatorSide2X = this.centerX + s.HUD.radius * Math.cos(directionalIndicatorAngle - s.HUD.directionalIndicatorAngularWidth);\n      var directionalIndicatorSide2Y = this.centerY + s.HUD.radius * Math.sin(directionalIndicatorAngle - s.HUD.directionalIndicatorAngularWidth);\n\n      // Move to tip\n      this.ctx.moveTo(directionalIndicatorTopX, directionalIndicatorTopY);\n\n      // Line to point 1\n      this.ctx.lineTo(directionalIndicatorSide1X, directionalIndicatorSide1Y);\n\n      // Line to divot\n      this.ctx.lineTo(directionalIndicatorDivotX, directionalIndicatorDivotY);\n\n      // Line to point 2\n      this.ctx.lineTo(directionalIndicatorSide2X, directionalIndicatorSide2Y);\n\n      // Line back to tip\n      this.ctx.lineTo(directionalIndicatorTopX, directionalIndicatorTopY);\n\n      this.ctx.fillStyle = fillColor;\n      this.ctx.fill();\n      this.ctx.lineWidth = 2;\n      this.ctx.strokeStyle = s.HUD.indicatorStroke;\n      this.ctx.stroke();\n    }\n  }\n\n  // Draw square around object\n  if (circleTargetInSight && distanceToCircleTarget > maxBoxDistance) {\n    v2DcircleTarget = vcircleTarget2D.clone();\n    v2DcircleTarget.x =  (this.width  + v2DcircleTarget.x*this.width )/2;\n    v2DcircleTarget.y = -(-this.height + v2DcircleTarget.y*this.height)/2;\n\n    this.ctx.strokeStyle = fillColor;\n    this.ctx.lineWidth = 1;\n    this.ctx.strokeRect(v2DcircleTarget.x-squareSize, v2DcircleTarget.y-squareSize, squareSize*2, squareSize*2);\n\n    if (circleTarget.name) {\n      var textOffset = squareSize * 2;\n      this.writeName(circleTarget.name, v2DcircleTarget, fillColor, textOffset);\n    }\n    else {\n      throw new Error('s.HUD: Name not defined for mesh');\n    }\n  }\n};\n",
                "new_contents": "s.HUD = function(options) {\n  this.game = options.game;\n\n  // Add crosshairs\n  this.crosshairs = new THREE.Sprite(new THREE.SpriteMaterial({\n    map: s.textures.crosshairs,\n    useScreenCoordinates: false,\n    blending: THREE.AdditiveBlending,\n    color: 0x00FF00\n  }));\n\n  this.game.camera.add(this.crosshairs);\n  this.crosshairs.position.setZ(-30);\n\n  // Create canvas\n  this.canvas = document.createElement('canvas');\n\n  this.width = this.canvas.width = window.innerWidth;\n  this.height = this.canvas.height = window.innerHeight;\n\n  this.canvas.style.position = 'absolute';\n  this.canvas.style.top = 0;\n  this.canvas.style.left = 0;\n\n  this.ctx = this.canvas.getContext('2d');\n  document.body.appendChild(this.canvas);\n\n  // Update on tick\n  this.update = this.update.bind(this);\n  this.game.hook(this.update);\n\n  // Set size when window size changed\n  this.fitWindow = this.fitWindow.bind(this);\n  $(window).on('resize', this.fitWindow);\n  this.fitWindow();\n};\n\ns.HUD.baseColor = 'rgba(0, 255, 0, 0.5)';\n\n// The height of the directional indicator (away from the circumference of the circle)\ns.HUD.directionalIndicatorHeight = 20;\n\n// The angular offset for the two sides of the directional indicator\ns.HUD.directionalIndicatorAngularWidth = Math.PI/32;\n\ns.HUD.friendlyIndicatorColor = 'rgba(0, 255, 0, 0.75)';\ns.HUD.enemyIndicatorColor = 'rgba(255, 143, 0, 0.75)';\ns.HUD.indicatorStroke = 'rgba(0, 0, 0, 0.5)';\n\ns.HUD.targetColor = 'rgba(255, 0, 0, 0.5)';\n\n// The radius of the circle around which directional circles should be drawn\ns.HUD.radius = 200;\n\n// The size of the target square relative to distance\ns.HUD.squareSizeFactor = 0.02;\n\ns.HUD.prototype.update = function() {\n  // Clear canvas\n  this.ctx.clearRect(0, 0, this.width, this.height);\n\n  this.drawTarget(s.game.spaceStation.root, s.HUD.friendlyIndicatorColor, 34, 5500);\n\n  this.drawTarget(s.game.moonBase1.root, s.HUD.enemyIndicatorColor, 34, 5500);\n};\n\ns.HUD.prototype.writeName = function(name, position, fillColor, textOffset) {\n  this.ctx.fillStyle = fillColor;\n  // @todo correctly center text\n  this.ctx.font = 'bold 14px Andale Mono';\n  var width = this.ctx.measureText(name).width;\n  this.ctx.fillText(name, position.x - width / 2, position.y + textOffset);\n};\n\ns.HUD.prototype.fitWindow = function() {\n  this.width = this.canvas.width = window.innerWidth;\n  this.height = this.canvas.height = window.innerHeight;\n  this.centerX = this.width / 2;\n  this.centerY = this.height / 2;\n};\n\ns.HUD.prototype.drawTarget = function(circleTarget, fillColor, distanceFromRadius, maxBoxDistance) {\n  var circleTargetInSight;\n  var distanceToCircleTarget;\n  var v2DcircleTarget;\n  var squareSize;\n\n  var vcircleTarget3D = circleTarget.position.clone();\n  var vcircleTarget2D = s.projector.projectVector(vcircleTarget3D, s.game.camera);\n\n  if (Math.abs(vcircleTarget2D.x) <= 0.95 && Math.abs(vcircleTarget2D.y) <= 0.95 && vcircleTarget2D.z < 1) {\n    circleTargetInSight = true;\n    distanceToCircleTarget = this.game.player.root.position.distanceTo(circleTarget.position);\n    squareSize = Math.round((this.width - distanceToCircleTarget/100)*s.HUD.squareSizeFactor);\n  }\n\n  // circleTarget targeting reticle and targeting box\n  if (!circleTargetInSight) {\n    var circleTarget2D = new THREE.Vector2(vcircleTarget2D.x, vcircleTarget2D.y);\n    circleTarget2D.multiplyScalar(1/circleTarget2D.length()).multiplyScalar(s.HUD.radius+distanceFromRadius);\n\n    var directionalIndicatorCenterX = circleTarget2D.x+this.centerX\n    var directionalIndicatorCenterY = -(circleTarget2D.y-this.centerY);\n    // Calculate angle away from center\n    var directionalIndicatorAngle = Math.atan2(directionalIndicatorCenterY-this.centerY, directionalIndicatorCenterX-this.centerX)\n\n    if (vcircleTarget2D.z > 1) {\n      var contextRotation = directionalIndicatorAngle + Math.PI/2;\n      // Target is behind us\n      this.ctx.beginPath();\n\n      // Move to center\n      this.ctx.translate(this.centerX, this.centerY);\n\n      // Rotate around axis\n      this.ctx.rotate(contextRotation);\n\n      // Draw half circle\n      this.ctx.arc(0, s.HUD.radius, 10, 0, Math.PI, false);\n      this.ctx.fillStyle = fillColor;\n      this.ctx.fill();\n      this.ctx.lineWidth = 2;\n      this.ctx.strokeStyle = s.HUD.indicatorStroke;\n\n      this.ctx.stroke();\n\n      // Move back\n      this.ctx.rotate(-contextRotation);\n      this.ctx.translate(-this.centerX, -this.centerY);\n    }\n    else {\n      // Target is in front of us\n      this.ctx.beginPath();\n\n      // Calculate the tip of the triangle\n      var directionalIndicatorTopX = this.centerX + (s.HUD.radius + s.HUD.directionalIndicatorHeight) * Math.cos(directionalIndicatorAngle);\n      var directionalIndicatorTopY = this.centerY + (s.HUD.radius + s.HUD.directionalIndicatorHeight) * Math.sin(directionalIndicatorAngle);\n\n      // Calculate the first vertex of the triangle, on the circumference\n      var directionalIndicatorSide1X = this.centerX + s.HUD.radius * Math.cos(directionalIndicatorAngle + s.HUD.directionalIndicatorAngularWidth);\n      var directionalIndicatorSide1Y = this.centerY + s.HUD.radius * Math.sin(directionalIndicatorAngle + s.HUD.directionalIndicatorAngularWidth);\n\n      // Calculate the divot in the triangle, between the circumference and the tip\n      var directionalIndicatorDivotX = this.centerX + (s.HUD.radius + s.HUD.directionalIndicatorHeight/2) * Math.cos(directionalIndicatorAngle);\n      var directionalIndicatorDivotY = this.centerY + (s.HUD.radius + s.HUD.directionalIndicatorHeight/2) * Math.sin(directionalIndicatorAngle);\n\n      // Calculate the second vertex of the triangle, on the circumference\n      var directionalIndicatorSide2X = this.centerX + s.HUD.radius * Math.cos(directionalIndicatorAngle - s.HUD.directionalIndicatorAngularWidth);\n      var directionalIndicatorSide2Y = this.centerY + s.HUD.radius * Math.sin(directionalIndicatorAngle - s.HUD.directionalIndicatorAngularWidth);\n\n      // Move to tip\n      this.ctx.moveTo(directionalIndicatorTopX, directionalIndicatorTopY);\n\n      // Line to point 1\n      this.ctx.lineTo(directionalIndicatorSide1X, directionalIndicatorSide1Y);\n\n      // Line to divot\n      this.ctx.lineTo(directionalIndicatorDivotX, directionalIndicatorDivotY);\n\n      // Line to point 2\n      this.ctx.lineTo(directionalIndicatorSide2X, directionalIndicatorSide2Y);\n\n      // Line back to tip\n      this.ctx.lineTo(directionalIndicatorTopX, directionalIndicatorTopY);\n\n      this.ctx.fillStyle = fillColor;\n      this.ctx.fill();\n      this.ctx.lineWidth = 2;\n      this.ctx.strokeStyle = s.HUD.indicatorStroke;\n      this.ctx.stroke();\n    }\n  }\n\n  // Draw square around object\n  if (circleTargetInSight && distanceToCircleTarget > maxBoxDistance) {\n    v2DcircleTarget = vcircleTarget2D.clone();\n    v2DcircleTarget.x =  (this.width  + v2DcircleTarget.x*this.width )/2;\n    v2DcircleTarget.y = -(-this.height + v2DcircleTarget.y*this.height)/2;\n\n    this.ctx.strokeStyle = fillColor;\n    this.ctx.lineWidth = 1;\n    this.ctx.strokeRect(v2DcircleTarget.x-squareSize, v2DcircleTarget.y-squareSize, squareSize*2, squareSize*2);\n\n    if (circleTarget.name) {\n      var textOffset = squareSize * 2;\n      this.writeName(circleTarget.name, v2DcircleTarget, fillColor, textOffset);\n    }\n    else {\n      throw new Error('s.HUD: Name not defined for mesh');\n    }\n  }\n};\n",
                "subject": "Fix directional indicators when target is behind you, show as smaller half circle",
                "message": "Fix directional indicators when target is behind you, show as smaller half circle\n",
                "lang": "JavaScript",
                "license": "bsd-2-clause",
                "repos": "satellite-game/Satellite-Mobile"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10262,
            "row": {
                "commit": "5092c33621d9a328e367bb506ebedc10a326bd6d",
                "old_file": "js/content-script.js",
                "new_file": "js/content-script.js",
                "old_contents": "'use strict';\n\nconst de_webextApi = {\n    download: function(downloadRequest){\n        browser.runtime.sendMessage(downloadRequest);\n    },\n    listen: function(){\n        browser.runtime.onMessage.addListener(function(message){\n            switch (message) {\n                case 'on': {de_listeners.switch(true); break;}\n                case 'off': {de_listeners.switch(false); break;}\n                case 'duplicate_warning': {de_button.jerkClass('warning'); break;}\n            }\n        });\n    },\n    settings: function(){\n        browser.storage.onChanged.addListener(function(changes){\n            let newSettings = {},\n                changesList = Object.keys(changes);\n\n            if (changesList.toString() === 'isCute') {\n                de_listeners.switch(changes.isCute.newValue);\n                return; // click on browser_action button changes only \"isCute\" setting\n            }\n\n            changesList.forEach(function(settingName){\n                newSettings[settingName] = changes[settingName].newValue;\n            });\n            de_settings.setSettings(newSettings);\n        });\n        browser.storage.local.get().then(function(items){\n            de_settings.setSettings(items);\n        });\n    },\n};\n\nconst de_settings = {\n    selectedSavePath: null,\n\n    setSettings: function(newSettings){\n        this.minSize = newSettings.minSize;\n        this.folders = newSettings.folders;\n        this.keysList = newSettings.folders.map(x => x.keyCode).concat([32]);\n        this.saveOnHover = newSettings.saveOnHover;\n        this.showSaveDialog = newSettings.showSaveDialog;\n        this.defaultSavePath = newSettings.defaultSavePath;\n        this.placeUnderCursor = newSettings.placeUnderCursor;\n        this.forbidDuplicateFiles = newSettings.forbidDuplicateFiles;\n        this.exclusions = newSettings.exclusions.split(' ');\n        this.originalNameButton = newSettings.originalNameByDefault ? 0 : 2;\n        [this.vertical, this.horizontal] = newSettings.position.split('-');\n        de_button.elem.style.backgroundImage = newSettings.icon;\n        de_button.elem.classList.toggle('shy', newSettings.hideButton);\n        de_listeners.switch(newSettings.isCute);\n    },\n};\n\nconst de_button = {\n    elem: null,\n    downloadRequest: {\n        src             : null,\n        originalName    : null,\n        backupName      : null,\n        showSaveDialog  : null,\n    },\n\n    init: function(){\n        let that = this,\n            btnElem;\n\n        function mouseupListener(event){\n            let downloadRequest = Object.assign(\n                    {path: de_settings.selectedSavePath || de_settings.defaultSavePath},\n                    that.downloadRequest,\n                    that.isOriginalNameButton(event) ? {} : {originalName: null}\n                ),\n                historyEntry = JSON.stringify(downloadRequest);\n\n            that.disableDefaultClick(event);\n            if (\n                !btnElem.classList.contains('click') ||\n                !that.downloadRequest.src ||\n                de_contentscript.downloadsHistory.includes(historyEntry)\n            ) {\n                btnElem.classList.remove('click');\n                return;\n            }\n\n            de_webextApi.download(downloadRequest);\n            de_settings.selectedSavePath = null;\n            de_contentscript.rememberDownload(historyEntry);\n            if (event.button === 1) {\n                that.copyToClipboard(that.downloadRequest.src);\n            }\n            btnElem.classList.remove('click');\n        }\n        function mousedownListener(event){\n            that.disableDefaultClick(event);\n            btnElem.classList.add('click')\n        }\n        function mouseoutListener(event){\n            btnElem.classList.remove('click');\n        }\n\n        that.elem = document.createElement('de_cbutton');\n        btnElem = that.elem;\n        btnElem.id = 'de-cute-id';\n        btnElem.addEventListener('click', that.disableDefaultClick);\n        btnElem.addEventListener('contextmenu', that.disableDefaultClick);\n        btnElem.addEventListener('mousedown', mousedownListener);\n        btnElem.addEventListener('mouseout', mouseoutListener);\n        btnElem.addEventListener('mouseup', mouseupListener);\n    },\n\n    disableDefaultClick: function(event){\n        event.stopPropagation();\n        event.preventDefault();\n    },\n\n    show: function(position, src, originalName){\n        let btnElem = this.elem;\n\n        this.prepareDL(src, originalName);\n        btnElem.style.top = position.top;\n        btnElem.style.bottom = position.bottom;\n        btnElem.style.left = position.left;\n        btnElem.style.right = position.right;\n        position.container.appendChild(btnElem);\n        setTimeout(() => btnElem.classList.add('visible'), 32);\n    },\n\n    hide: function(){\n        this.prepareDL(null, null);\n        this.elem.classList.remove('visible');\n    },\n\n    isVisible: function(){\n        return this.elem.classList.contains('visible');\n    },\n\n    emulateClick: function(buttonCode = 0){\n        this.jerkClass('implying-click', 'click');\n        this.elem.dispatchEvent(new MouseEvent('mouseup', {button: buttonCode}));\n    },\n\n    jerkClass: function(...classNames){\n        let buttonClasses = this.elem.classList;\n        buttonClasses.add(...classNames);\n        setTimeout(() => buttonClasses.remove(...classNames), 100);\n    },\n\n    prepareDL: function(src, originalName){\n        this.downloadRequest = {\n            src             : src,\n            originalName    : originalName,\n            backupName      : (src && de_contentscript.isSeparateTab) ? document.title : null,\n            showSaveDialog  : de_settings.showSaveDialog\n        };\n    },\n\n    isOriginalNameButton: function(event){\n        return event.button === de_settings.originalNameButton;\n    },\n\n    copyToClipboard: function(string){\n        let clpbrd = document.createElement('input'),\n            body = document.body;\n\n        body.appendChild(clpbrd);\n        clpbrd.value = string;\n        clpbrd.select();\n        document.execCommand('copy');\n        body.removeChild(clpbrd);\n    },\n};\n\nconst de_contentscript = {\n    host            : null,\n    bgSrc           : null,\n    actualNode      : null,\n    srcLocation     : null,\n    previousSrc     : null,\n    isSeparateTab   : null,\n    dollchanImproved: null,\n    historyTimer    : null,\n    downloadsHistory: [],\n\n    init: function(){\n        this.host = this.getFilteredHost();\n        this.isSeparateTab = document.contentType.startsWith('image/') || document.contentType.startsWith('video/');\n        this.srcLocation = this.isSeparateTab ? 'baseURI' : 'currentSrc';\n        window.addEventListener('load', e => this.dollchanImproved = !!document.querySelector('#de-main'), {once: true});\n\n        de_button.init();\n        de_webextApi.listen();\n        de_webextApi.settings();\n    },\n\n    getFilteredHost: function(){\n        return document.location.host.replace(/^www\\./, '').replace(/(.*)\\.(tumblr\\.com)$/, '$2');\n    },\n\n    rememberDownload: function(url){\n        let historyLen = 50;\n        if (!de_settings.forbidDuplicateFiles) {return;}\n        (this.downloadsHistory = this.downloadsHistory.slice(-historyLen + 1)).push(url);\n        this.refreshHistoryLifetime();\n    },\n\n    refreshHistoryLifetime: function(){\n        let historyLifetime = 300000; // 5 minutes\n        clearTimeout(this.historyTimer);\n        this.historyTimer = setTimeout(() => this.downloadsHistory = [], historyLifetime);\n    },\n\n    nodeTools: {\n        observer: new MutationObserver(mutations => {\n            let target = mutations.pop().target;\n            target.addEventListener('load', e => de_contentscript.nodeHandler(target), {once: true});\n        }),\n\n        addSrcObserver: function(node){\n            if (node.tagName !== 'IMG') {return;}\n            this.observer.disconnect();\n            this.observer.observe(node, {\n                attributes      : true,\n                childList       : false,\n                characterData   : false,\n                attributeFilter : ['src']\n            });\n        },\n        checkForBgSrc: function(node, modifier){\n            let bgImg;\n            if (!modifier) {return false;}\n\n            bgImg = getComputedStyle(node).getPropertyValue('background-image');\n            if (bgImg) {\n                let bgUrlMatches = bgImg.match(/^url\\([\\s\"']*(https?:\/\/[^\\s\"']+)[\\s\"']*\\).*/i);\n                if (bgUrlMatches) {\n                    de_contentscript.bgSrc = bgUrlMatches[1];\n                    return true;\n                }\n            }\n            return false;\n        },\n        filterByTag: function(tagName){\n            return (tagName !== 'IMG' && tagName !== 'VIDEO');\n        },\n        filterBySrc: function(src){\n            return (!src || !src.startsWith('http') || src.startsWith('https://www.google.com/recaptcha/'));\n        },\n        filterByClass: function(classList){\n            return de_settings.exclusions.some(exclusion => classList.contains(exclusion));\n        },\n        filterBySize: function(node, modifier){\n            let that = de_contentscript,\n                buttonPlaceholderSize = 50;\n\n            if (node.tagName === 'IMG' && node.width < buttonPlaceholderSize && node.height < buttonPlaceholderSize) {\n                return true;\n            }\n            if (that.isSeparateTab || node.tagName === 'VIDEO' || modifier) {\n                return false;\n            }\n            if (node.complete && !(node.naturalWidth < de_settings.minSize || node.naturalHeight < de_settings.minSize)) {\n                return false;\n            }\n            return (node.width < de_settings.minSize || node.height < de_settings.minSize);\n        },\n        deepSearchByHost: function(node, modifier){\n            let that = de_contentscript,\n                crutches = {\n                    'twitter.com': () => xpath('self::div[contains(@class, \"GalleryNav\")]/preceding-sibling::div[@class=\"Gallery-media\"]/img', node)\n                };\n            if (!modifier) {return false;}\n\n            that.actualNode = crutches[that.host] && crutches[that.host]();\n            return !!that.actualNode;\n        },\n    },\n\n    isTrash: function(node, modifier){\n        let tools = de_contentscript.nodeTools;\n        if (\n            tools.checkForBgSrc(node, modifier) ||\n            tools.deepSearchByHost(node, modifier)\n        ) {\n            return false;\n        }\n        if (tools.filterByTag(node.tagName)) {\n        \treturn true;\n        }\n        tools.addSrcObserver(node);\n        if (\n            tools.filterBySrc(node[de_contentscript.srcLocation]) ||\n            tools.filterByClass(node.classList)\n        ) {\n            return true;\n        }\n        return tools.filterBySize(node, modifier);\n    },\n\n    isPositioned: function(node){\n        return window.getComputedStyle(node).position !== 'static';\n    },\n\n    getPosition: function(node){\n        let nodeRect = node.getBoundingClientRect(),\n            parentRect,\n            offset = 6,\n            reverseOffset = 38, // offset + button width (32px)\n            position = {},\n            getMinOffset = sideSize => sideSize === 0 ? -999999 : 0; //crutch(?) for tumblr for image containers with 0px width/height\n\n        let sizeGettersRegular = {\n            left    : () => Math.max(0, nodeRect.left) + offset,\n            top     : () => Math.max(0, nodeRect.top) + offset,\n            right   : () => Math.min(document.documentElement.clientWidth, nodeRect.right) - reverseOffset,\n            bottom  : () => Math.min(document.documentElement.clientHeight, nodeRect.bottom) - reverseOffset,\n        };\n        let sizeGettersInPositioned = {\n            left    : () => nodeRect.left - parentRect.left - Math.min(0, nodeRect.left),\n            top     : () => nodeRect.top - parentRect.top - Math.min(0, nodeRect.top),\n            right   : () => parentRect.right - nodeRect.right + Math.max(0, nodeRect.right - document.documentElement.clientWidth),\n            bottom  : () => parentRect.bottom - nodeRect.bottom + Math.max(0, nodeRect.bottom - document.documentElement.clientHeight),\n        };\n\n        if (this.isPositioned(node.offsetParent)) {\n            parentRect = node.offsetParent.getBoundingClientRect();\n            position.container = node.offsetParent;\n            position[de_settings.horizontal] = Math.max(getMinOffset(parentRect.width), sizeGettersInPositioned[de_settings.horizontal]()) + offset + 'px';\n            position[de_settings.vertical] = Math.max(getMinOffset(parentRect.height), sizeGettersInPositioned[de_settings.vertical]()) + offset + 'px';\n        } else {\n            position.container = document.body;\n            position.left = sizeGettersRegular[de_settings.horizontal]() + window.scrollX + 'px';\n            position.top = sizeGettersRegular[de_settings.vertical]() + window.scrollY + 'px';\n        }\n\n        return position;\n    },\n\n    getPositionUnderCursor: function(mouseEvent){\n        if (!mouseEvent.target) {return null;}\n        return mouseEvent.target.offsetParent && this.isPositioned(mouseEvent.target.offsetParent) ? {\n            container: mouseEvent.target.offsetParent,\n            left: mouseEvent.layerX + 'px',\n            top: mouseEvent.layerY + 'px'\n        } : {\n            container: document.body,\n            left: mouseEvent.clientX + window.scrollX + 'px',\n            top: mouseEvent.clientY + window.scrollY + 'px'\n        };\n    },\n\n    nodeHandler: function(currentTarget, event = {}){\n        let that = de_contentscript,\n            src = currentTarget[that.srcLocation];\n\n        if (!currentTarget || (event.ctrlKey && !event.altKey)) {return;}\n        if (!src || src !== that.previousSrc) {\n            de_button.hide();\n        }\n        if (that.isTrash(currentTarget, event.shiftKey)) {\n            return;\n        }\n        that.previousSrc = src;\n        currentTarget = that.actualNode || currentTarget;\n\n        de_button.show(\n            Object.assign(\n                {left: null, top: null, right: null, bottom: null}, // only two position properties would be set at once, other two are null on purpose to reset their default values\n                (de_settings.placeUnderCursor && that.getPositionUnderCursor(event)) || that.getPosition(currentTarget)\n            ),\n            that.getOriginalSrc(currentTarget) || src || currentTarget.src || that.bgSrc,\n            that.getOriginalFilename(currentTarget)\n        );\n\n        if (event.ctrlKey && event.altKey && de_settings.saveOnHover) {\n            de_button.emulateClick();\n            de_button.jerkClass('visible');\n        }\n\n        that.bgSrc = null;\n        that.actualNode = null;\n    },\n\n    getOriginalSrc: function(node){\n        let getters = {\n                'vk.com': function(){\n                    let info = JSON.parse(node.getAttribute('onclick').match(/^.*\"?temp\"? *: *({[^{}]+}).*$/)[1]);\n                    return info['base'] + (info['w_'] || info['z_'] || info['y_'])[0] + '.jpg';\n                },\n                'twitter.com': function(){\n                    return node.currentSrc.replace(/(:[a-z0-9]+)?$/i, ':orig');\n                },\n                'tumblr.com': function(){\n                    return node.currentSrc.replace(/(tumblr_[a-z0-9]+)(_\\d{2,3}).(jpg|jpeg|png)$/i, '$1_1280.$3');\n                },\n            },\n            getter = getters[this.host],\n            originalSrc = null;\n\n        if (!getter || this.isSeparateTab) {return null;}\n        try {\n            originalSrc = getter();\n        } catch (e) {} //tfw no safe navigation operator in 2017\n\n        return originalSrc;\n    },\n\n    getOriginalFilename: function(node){\n        let getters = {\n                'boards.4chan.org': () => {\n                    let container = xpath('ancestor::div[contains(concat(\" \", normalize-space(@class), \" \"), \" file \")]//*[(@class=\"fileText\" and @title) or self::a]', node);\n                    return container.title || container.textContent;\n                },\n                '2ch.hk': () => {\n                    let container = xpath('ancestor::figure[@class=\"image\"]/figcaption/a', node);\n                    return container.title || container.textContent;\n                },\n                'iichan.hk': () => {\n                    return xpath('../preceding-sibling::span[@class=\"filesize\"]/em', node).textContent.split(', ')[2];\n                },\n                'boards.fireden.net': () => {\n                    let container = xpath('(../following-sibling::div[@class=\"post_file\"]|../../preceding-sibling::div[@class=\"post_file\"])/a[@class=\"post_file_filename\"]', node);\n                    return container.title || container.textContent;\n                },\n                '8ch.net': () => {\n                    let container = xpath('../preceding-sibling::p[@class=\"fileinfo\"]/span[@class=\"unimportant\"]/a', node);\n                    return container.title || container.textContent;\n                },\n            },\n            aliases = {'yuki.la': 'boards.4chan.org'},\n            getter = getters[this.host] || getters[aliases[this.host]],\n            originalFilename = null;\n\n        function tryFilenameFromDollchanImageByCenter(){\n            let filenameTry;\n            if (!de_contentscript.dollchanImproved) {return null;}\n            filenameTry = xpath('following-sibling::div[@class=\"de-fullimg-info\" and contains(ancestor::div[1]/@class, \"de-fullimg-wrap-center\")]/a[@class=\"de-fullimg-src\" and text() != \"Spoiler Image\"]', node);\n\n            return filenameTry ? filenameTry.textContent : null;\n        }\n\n        if (!getter || this.isSeparateTab) {return null;}\n        try {\n            originalFilename = tryFilenameFromDollchanImageByCenter() || getter();\n        } catch (e) {} //tfw still no safe navigation operator\n\n        return originalFilename;\n    },\n};\n\nconst de_listeners = {\n    mouseoverListener: function(event){\n        if (event.target.tagName === 'DE_CBUTTON' || (event.relatedTarget && event.relatedTarget.tagName === 'DE_CBUTTON')) {return;}\n        de_contentscript.nodeHandler(event.target, event);\n    },\n    keydownListener: function(event){\n        if (de_listeners.isHotkeyPossible(event)) {event.preventDefault();}\n    },\n    keyupListener: function(event){\n        if (event.keyCode === 81 && event.altKey) {de_button.hide(); return;}\n        if (!de_listeners.isHotkeyPossible(event)) {return;}\n\n        if (event.keyCode === 32) {\n            de_settings.selectedSavePath = null;\n            de_button.emulateClick(event.ctrlKey ? 2 : 0);\n            return;\n        }\n        for (const folder of de_settings.folders) {\n            if (\n                folder.keyCode !== event.keyCode ||\n                (folder.modifier && !event[folder.modifier]) ||\n                (!folder.modifier && (event.shiftKey || event.ctrlKey || event.altKey))\n            ) {\n                continue;\n            }\n\n            de_settings.selectedSavePath = folder.path;\n            de_button.emulateClick();\n            break;\n        }\n    },\n    \n    isHotkeyPossible: function(event){\n        return de_button.isVisible() && ['INPUT', 'TEXTAREA'].indexOf(event.target.tagName) === -1 && de_settings.keysList.indexOf(event.keyCode) > -1;\n    },\n\n    switch: function(turnOn = true){\n        let functionName = turnOn ? 'addEventListener' : 'removeEventListener';\n\n        window[functionName]('mouseover', de_listeners.mouseoverListener);\n        window[functionName]('keydown', de_listeners.keydownListener);\n        window[functionName]('keyup', de_listeners.keyupListener);\n    },\n};\n\nfunction xpath(path, contextNode){\n    return document.evaluate(path, contextNode, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\n}\n\nde_contentscript.init();\n",
                "new_contents": "'use strict';\n\nconst de_webextApi = {\n    download: function(downloadRequest){\n        browser.runtime.sendMessage(downloadRequest);\n    },\n    listen: function(){\n        browser.runtime.onMessage.addListener(function(message){\n            switch (message) {\n                case 'on': {de_listeners.switch(true); break;}\n                case 'off': {de_listeners.switch(false); break;}\n                case 'duplicate_warning': {de_button.jerkClass('warning'); break;}\n            }\n        });\n    },\n    settings: function(){\n        browser.storage.onChanged.addListener(function(changes){\n            let newSettings = {},\n                changesList = Object.keys(changes);\n\n            if (changesList.toString() === 'isCute') {\n                de_listeners.switch(changes.isCute.newValue);\n                return; // click on browser_action button changes only \"isCute\" setting\n            }\n\n            changesList.forEach(function(settingName){\n                newSettings[settingName] = changes[settingName].newValue;\n            });\n            de_settings.setSettings(newSettings);\n        });\n        browser.storage.local.get().then(function(items){\n            de_settings.setSettings(items);\n        });\n    },\n};\n\nconst de_settings = {\n    selectedSavePath: null,\n\n    setSettings: function(newSettings){\n        this.minSize = newSettings.minSize;\n        this.folders = newSettings.folders;\n        this.keysList = newSettings.folders.map(x => x.keyCode).concat([32]);\n        this.saveOnHover = newSettings.saveOnHover;\n        this.showSaveDialog = newSettings.showSaveDialog;\n        this.defaultSavePath = newSettings.defaultSavePath;\n        this.placeUnderCursor = newSettings.placeUnderCursor;\n        this.forbidDuplicateFiles = newSettings.forbidDuplicateFiles;\n        this.exclusions = newSettings.exclusions.split(' ');\n        this.originalNameButton = newSettings.originalNameByDefault ? 0 : 2;\n        [this.vertical, this.horizontal] = newSettings.position.split('-');\n        de_button.elem.style.backgroundImage = newSettings.icon;\n        de_button.elem.classList.toggle('shy', newSettings.hideButton);\n        de_listeners.switch(newSettings.isCute);\n    },\n};\n\nconst de_button = {\n    elem: null,\n    downloadRequest: {\n        src             : null,\n        originalName    : null,\n        backupName      : null,\n        showSaveDialog  : null,\n    },\n\n    init: function(){\n        let that = this,\n            btnElem;\n\n        function mouseupListener(event){\n            let downloadRequest = Object.assign(\n                    {path: de_settings.selectedSavePath || de_settings.defaultSavePath},\n                    that.downloadRequest,\n                    that.isOriginalNameButton(event) ? {} : {originalName: null}\n                ),\n                historyEntry = JSON.stringify(downloadRequest);\n\n            that.disableDefaultClick(event);\n            if (\n                !btnElem.classList.contains('click') ||\n                !that.downloadRequest.src ||\n                de_contentscript.downloadsHistory.includes(historyEntry)\n            ) {\n                btnElem.classList.remove('click');\n                return;\n            }\n\n            de_webextApi.download(downloadRequest);\n            de_settings.selectedSavePath = null;\n            de_contentscript.rememberDownload(historyEntry);\n            if (event.button === 1) {\n                that.copyToClipboard(that.downloadRequest.src);\n            }\n            btnElem.classList.remove('click');\n        }\n        function mousedownListener(event){\n            that.disableDefaultClick(event);\n            btnElem.classList.add('click')\n        }\n        function mouseoutListener(event){\n            btnElem.classList.remove('click');\n        }\n\n        that.elem = document.createElement('de_cbutton');\n        btnElem = that.elem;\n        btnElem.id = 'de-cute-id';\n        btnElem.addEventListener('click', that.disableDefaultClick);\n        btnElem.addEventListener('contextmenu', that.disableDefaultClick);\n        btnElem.addEventListener('mousedown', mousedownListener);\n        btnElem.addEventListener('mouseout', mouseoutListener);\n        btnElem.addEventListener('mouseup', mouseupListener);\n    },\n\n    disableDefaultClick: function(event){\n        event.stopPropagation();\n        event.preventDefault();\n    },\n\n    show: function(position, src, originalName){\n        let btnElem = this.elem;\n\n        this.prepareDL(src, originalName);\n        btnElem.style.top = position.top;\n        btnElem.style.bottom = position.bottom;\n        btnElem.style.left = position.left;\n        btnElem.style.right = position.right;\n        position.container.appendChild(btnElem);\n        setTimeout(() => btnElem.classList.add('visible'), 32);\n    },\n\n    hide: function(){\n        this.prepareDL(null, null);\n        this.elem.classList.remove('visible');\n    },\n\n    isVisible: function(){\n        return this.elem.classList.contains('visible');\n    },\n\n    emulateClick: function(buttonCode = 0){\n        this.jerkClass('implying-click', 'click');\n        this.elem.dispatchEvent(new MouseEvent('mouseup', {button: buttonCode}));\n    },\n\n    jerkClass: function(...classNames){\n        let buttonClasses = this.elem.classList;\n        buttonClasses.add(...classNames);\n        setTimeout(() => buttonClasses.remove(...classNames), 100);\n    },\n\n    prepareDL: function(src, originalName){\n        this.downloadRequest = {\n            src             : src,\n            originalName    : originalName,\n            backupName      : (src && de_contentscript.isSeparateTab) ? document.title : null,\n            showSaveDialog  : de_settings.showSaveDialog\n        };\n    },\n\n    isOriginalNameButton: function(event){\n        return event.button === de_settings.originalNameButton;\n    },\n\n    copyToClipboard: function(string){\n        let clpbrd = document.createElement('input'),\n            body = document.body;\n\n        body.appendChild(clpbrd);\n        clpbrd.value = string;\n        clpbrd.select();\n        document.execCommand('copy');\n        body.removeChild(clpbrd);\n    },\n};\n\nconst de_contentscript = {\n    host            : null,\n    bgSrc           : null,\n    actualNode      : null,\n    srcLocation     : null,\n    previousSrc     : null,\n    isSeparateTab   : null,\n    dollchanImproved: null,\n    historyTimer    : null,\n    downloadsHistory: [],\n\n    init: function(){\n        this.host = this.getFilteredHost();\n        this.isSeparateTab = document.contentType.startsWith('image/') || document.contentType.startsWith('video/');\n        this.srcLocation = this.isSeparateTab ? 'baseURI' : 'currentSrc';\n        window.addEventListener('load', e => this.dollchanImproved = !!document.querySelector('#de-main'), {once: true});\n\n        de_button.init();\n        de_webextApi.listen();\n        de_webextApi.settings();\n    },\n\n    getFilteredHost: function(){\n        return document.location.host.replace(/^www\\./, '').replace(/(.*)\\.(tumblr\\.com)$/, '$2');\n    },\n\n    rememberDownload: function(url){\n        let historyLen = 50;\n        if (!de_settings.forbidDuplicateFiles) {return;}\n        (this.downloadsHistory = this.downloadsHistory.slice(-historyLen + 1)).push(url);\n        this.refreshHistoryLifetime();\n    },\n\n    refreshHistoryLifetime: function(){\n        let historyLifetime = 300000; // 5 minutes\n        clearTimeout(this.historyTimer);\n        this.historyTimer = setTimeout(() => this.downloadsHistory = [], historyLifetime);\n    },\n\n    nodeTools: {\n        observer: new MutationObserver(mutations => {\n            let target = mutations.pop().target;\n            target.addEventListener('load', e => de_contentscript.nodeHandler(target), {once: true});\n        }),\n\n        addSrcObserver: function(node){\n            if (node.tagName !== 'IMG') {return;}\n            this.observer.disconnect();\n            this.observer.observe(node, {\n                attributes      : true,\n                childList       : false,\n                characterData   : false,\n                attributeFilter : ['src']\n            });\n        },\n        checkForBgSrc: function(node, modifier){\n            let bgImg;\n            if (!modifier) {return false;}\n\n            bgImg = getComputedStyle(node).getPropertyValue('background-image');\n            if (bgImg) {\n                let bgUrlMatches = bgImg.match(/^url\\([\\s\"']*(https?:\/\/[^\\s\"']+)[\\s\"']*\\).*/i);\n                if (bgUrlMatches) {\n                    de_contentscript.bgSrc = bgUrlMatches[1];\n                    return true;\n                }\n            }\n            return false;\n        },\n        filterByTag: function(tagName){\n            return (tagName !== 'IMG' && tagName !== 'VIDEO');\n        },\n        filterBySrc: function(src){\n            return (!src || !src.startsWith('http') || src.startsWith('https://www.google.com/recaptcha/'));\n        },\n        filterByClass: function(classList){\n            return de_settings.exclusions.some(exclusion => classList.contains(exclusion));\n        },\n        filterBySize: function(node, modifier){\n            let that = de_contentscript,\n                buttonPlaceholderSize = 50;\n\n            if (node.tagName === 'IMG' && (node.width < buttonPlaceholderSize || node.height < buttonPlaceholderSize)) {\n                return true;\n            }\n            if (that.isSeparateTab || node.tagName === 'VIDEO' || modifier) {\n                return false;\n            }\n            if (node.complete && !(node.naturalWidth < de_settings.minSize || node.naturalHeight < de_settings.minSize)) {\n                return false;\n            }\n            return (node.width < de_settings.minSize || node.height < de_settings.minSize);\n        },\n        deepSearchByHost: function(node, modifier){\n            let that = de_contentscript,\n                crutches = {\n                    'twitter.com': () => xpath('self::div[contains(@class, \"GalleryNav\")]/preceding-sibling::div[@class=\"Gallery-media\"]/img', node)\n                };\n            if (!modifier) {return false;}\n\n            that.actualNode = crutches[that.host] && crutches[that.host]();\n            return !!that.actualNode;\n        },\n    },\n\n    isTrash: function(node, modifier){\n        let tools = de_contentscript.nodeTools;\n        if (\n            tools.checkForBgSrc(node, modifier) ||\n            tools.deepSearchByHost(node, modifier)\n        ) {\n            return false;\n        }\n        if (tools.filterByTag(node.tagName)) {\n        \treturn true;\n        }\n        tools.addSrcObserver(node);\n        if (\n            tools.filterBySrc(node[de_contentscript.srcLocation]) ||\n            tools.filterByClass(node.classList)\n        ) {\n            return true;\n        }\n        return tools.filterBySize(node, modifier);\n    },\n\n    isPositioned: function(node){\n        return window.getComputedStyle(node).position !== 'static';\n    },\n\n    getPosition: function(node){\n        let nodeRect = node.getBoundingClientRect(),\n            parentRect,\n            offset = 6,\n            reverseOffset = 38, // offset + button width (32px)\n            position = {},\n            getMinOffset = sideSize => sideSize === 0 ? -999999 : 0; //crutch(?) for tumblr for image containers with 0px width/height\n\n        let sizeGettersRegular = {\n            left    : () => Math.max(0, nodeRect.left) + offset,\n            top     : () => Math.max(0, nodeRect.top) + offset,\n            right   : () => Math.min(document.documentElement.clientWidth, nodeRect.right) - reverseOffset,\n            bottom  : () => Math.min(document.documentElement.clientHeight, nodeRect.bottom) - reverseOffset,\n        };\n        let sizeGettersInPositioned = {\n            left    : () => nodeRect.left - parentRect.left - Math.min(0, nodeRect.left),\n            top     : () => nodeRect.top - parentRect.top - Math.min(0, nodeRect.top),\n            right   : () => parentRect.right - nodeRect.right + Math.max(0, nodeRect.right - document.documentElement.clientWidth),\n            bottom  : () => parentRect.bottom - nodeRect.bottom + Math.max(0, nodeRect.bottom - document.documentElement.clientHeight),\n        };\n\n        if (this.isPositioned(node.offsetParent)) {\n            parentRect = node.offsetParent.getBoundingClientRect();\n            position.container = node.offsetParent;\n            position[de_settings.horizontal] = Math.max(getMinOffset(parentRect.width), sizeGettersInPositioned[de_settings.horizontal]()) + offset + 'px';\n            position[de_settings.vertical] = Math.max(getMinOffset(parentRect.height), sizeGettersInPositioned[de_settings.vertical]()) + offset + 'px';\n        } else {\n            position.container = document.body;\n            position.left = sizeGettersRegular[de_settings.horizontal]() + window.scrollX + 'px';\n            position.top = sizeGettersRegular[de_settings.vertical]() + window.scrollY + 'px';\n        }\n\n        return position;\n    },\n\n    getPositionUnderCursor: function(mouseEvent){\n        if (!mouseEvent.target) {return null;}\n        return mouseEvent.target.offsetParent && this.isPositioned(mouseEvent.target.offsetParent) ? {\n            container: mouseEvent.target.offsetParent,\n            left: mouseEvent.layerX + 'px',\n            top: mouseEvent.layerY + 'px'\n        } : {\n            container: document.body,\n            left: mouseEvent.clientX + window.scrollX + 'px',\n            top: mouseEvent.clientY + window.scrollY + 'px'\n        };\n    },\n\n    nodeHandler: function(currentTarget, event = {}){\n        let that = de_contentscript,\n            src = currentTarget[that.srcLocation];\n\n        if (!currentTarget || (event.ctrlKey && !event.altKey)) {return;}\n        if (!src || src !== that.previousSrc) {\n            de_button.hide();\n        }\n        if (that.isTrash(currentTarget, event.shiftKey)) {\n            return;\n        }\n        that.previousSrc = src;\n        currentTarget = that.actualNode || currentTarget;\n\n        de_button.show(\n            Object.assign(\n                {left: null, top: null, right: null, bottom: null}, // only two position properties would be set at once, other two are null on purpose to reset their default values\n                (de_settings.placeUnderCursor && that.getPositionUnderCursor(event)) || that.getPosition(currentTarget)\n            ),\n            that.getOriginalSrc(currentTarget) || src || currentTarget.src || that.bgSrc,\n            that.getOriginalFilename(currentTarget)\n        );\n\n        if (event.ctrlKey && event.altKey && de_settings.saveOnHover) {\n            de_button.emulateClick();\n            de_button.jerkClass('visible');\n        }\n\n        that.bgSrc = null;\n        that.actualNode = null;\n    },\n\n    getOriginalSrc: function(node){\n        let getters = {\n                'vk.com': function(){\n                    let info = JSON.parse(node.getAttribute('onclick').match(/^.*\"?temp\"? *: *({[^{}]+}).*$/)[1]);\n                    return info['base'] + (info['w_'] || info['z_'] || info['y_'])[0] + '.jpg';\n                },\n                'twitter.com': function(){\n                    return node.currentSrc.replace(/(:[a-z0-9]+)?$/i, ':orig');\n                },\n                'tumblr.com': function(){\n                    return node.currentSrc.replace(/(tumblr_[a-z0-9]+)(_\\d{2,3}).(jpg|jpeg|png)$/i, '$1_1280.$3');\n                },\n            },\n            getter = getters[this.host],\n            originalSrc = null;\n\n        if (!getter || this.isSeparateTab) {return null;}\n        try {\n            originalSrc = getter();\n        } catch (e) {} //tfw no safe navigation operator in 2017\n\n        return originalSrc;\n    },\n\n    getOriginalFilename: function(node){\n        let getters = {\n                'boards.4chan.org': () => {\n                    let container = xpath('ancestor::div[contains(concat(\" \", normalize-space(@class), \" \"), \" file \")]//*[(@class=\"fileText\" and @title) or self::a]', node);\n                    return container.title || container.textContent;\n                },\n                '2ch.hk': () => {\n                    let container = xpath('ancestor::figure[@class=\"image\"]/figcaption/a', node);\n                    return container.title || container.textContent;\n                },\n                'iichan.hk': () => {\n                    return xpath('../preceding-sibling::span[@class=\"filesize\"]/em', node).textContent.split(', ')[2];\n                },\n                'boards.fireden.net': () => {\n                    let container = xpath('(../following-sibling::div[@class=\"post_file\"]|../../preceding-sibling::div[@class=\"post_file\"])/a[@class=\"post_file_filename\"]', node);\n                    return container.title || container.textContent;\n                },\n                '8ch.net': () => {\n                    let container = xpath('../preceding-sibling::p[@class=\"fileinfo\"]/span[@class=\"unimportant\"]/a', node);\n                    return container.title || container.textContent;\n                },\n            },\n            aliases = {'yuki.la': 'boards.4chan.org'},\n            getter = getters[this.host] || getters[aliases[this.host]],\n            originalFilename = null;\n\n        function tryFilenameFromDollchanImageByCenter(){\n            let filenameTry;\n            if (!de_contentscript.dollchanImproved) {return null;}\n            filenameTry = xpath('following-sibling::div[@class=\"de-fullimg-info\" and contains(ancestor::div[1]/@class, \"de-fullimg-wrap-center\")]/a[@class=\"de-fullimg-src\" and text() != \"Spoiler Image\"]', node);\n\n            return filenameTry ? filenameTry.textContent : null;\n        }\n\n        if (!getter || this.isSeparateTab) {return null;}\n        try {\n            originalFilename = tryFilenameFromDollchanImageByCenter() || getter();\n        } catch (e) {} //tfw still no safe navigation operator\n\n        return originalFilename;\n    },\n};\n\nconst de_listeners = {\n    mouseoverListener: function(event){\n        if (event.target.tagName === 'DE_CBUTTON' || (event.relatedTarget && event.relatedTarget.tagName === 'DE_CBUTTON')) {return;}\n        de_contentscript.nodeHandler(event.target, event);\n    },\n    keydownListener: function(event){\n        if (de_listeners.isHotkeyPossible(event)) {event.preventDefault();}\n    },\n    keyupListener: function(event){\n        if (event.keyCode === 81 && event.altKey) {de_button.hide(); return;}\n        if (!de_listeners.isHotkeyPossible(event)) {return;}\n\n        if (event.keyCode === 32) {\n            de_settings.selectedSavePath = null;\n            de_button.emulateClick(event.ctrlKey ? 2 : 0);\n            return;\n        }\n        for (const folder of de_settings.folders) {\n            if (\n                folder.keyCode !== event.keyCode ||\n                (folder.modifier && !event[folder.modifier]) ||\n                (!folder.modifier && (event.shiftKey || event.ctrlKey || event.altKey))\n            ) {\n                continue;\n            }\n\n            de_settings.selectedSavePath = folder.path;\n            de_button.emulateClick();\n            break;\n        }\n    },\n    \n    isHotkeyPossible: function(event){\n        return de_button.isVisible() && ['INPUT', 'TEXTAREA'].indexOf(event.target.tagName) === -1 && de_settings.keysList.indexOf(event.keyCode) > -1;\n    },\n\n    switch: function(turnOn = true){\n        let functionName = turnOn ? 'addEventListener' : 'removeEventListener';\n\n        window[functionName]('mouseover', de_listeners.mouseoverListener);\n        window[functionName]('keydown', de_listeners.keydownListener);\n        window[functionName]('keyup', de_listeners.keyupListener);\n    },\n};\n\nfunction xpath(path, contextNode){\n    return document.evaluate(path, contextNode, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\n}\n\nde_contentscript.init();\n",
                "subject": "more loose filtering by minimum image size",
                "message": "more loose filtering by minimum image size\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "Dezaimasu/cute-button,Dezaimasu/cute-button"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10263,
            "row": {
                "commit": "2b604763859b705928e75fe44146856a9323be14",
                "old_file": "client/game_files/drawing.js",
                "new_file": "client/game_files/drawing.js",
                "old_contents": "var background = new Image();\nbackground.src = 'img/background.jpg';\n\nfunction drawBackground() {\n\tcanvasContext.save();\n\tcanvasContext.fillStyle = 'black';\n\tcanvasContext.fillRect(0,0,canvas.width,canvas.height);\n\tcanvasContext.drawImage(background,world.x-myShip.x,world.y-myShip.y,world.width+canvas.width,world.height+canvas.height);\n\tcanvasContext.restore();\n}\n\nfunction drawFlashScreen(){\n\tcanvasContext.save();\n\tcanvasContext.fillStyle = 'red';\n\tcanvasContext.fillRect(0,0,canvas.width,canvas.height);\n\tcanvasContext.restore();\n}\n\n\n\nfunction drawText(text,x,y){\n\tcanvasContext.save();\n\tcanvasContext.fillStyle = 'white';\n\tcanvasContext.font=\"20px Georgia\";\n\tcanvasContext.fillText(text,x,y);\n\tcanvasContext.restore();\n}\nfunction drawTextF(text,x,y,color,font){\n\tcanvasContext.save();\n\tcanvasContext.fillStyle = color;\n\tcanvasContext.font=font;\n\tcanvasContext.fillText(text,x,y);\n\tcanvasContext.restore();\n}\n\nfunction drawFlashingText(text,x,y,color,font,flashColor,timeLeft){\n\tif(timeLeft%2 == 1){\n\t\tdrawTextF(text,x,y,flashColor,font);\n\t} else{\n\t\tdrawTextF(text,x,y,color,font);\n\t}\n}\n\n//DRAWING HUD UI\nfunction drawHUD(){\n\tdrawJoysticks();\n\tdrawAliveCounter();\n\tdrawKillCounter();\n    drawHPCounter();\n    drawToast();\n    drawPing();\n    drawTotalPlayers();\n    drawWeaponCooldown();\n    drawEventLog();\n\n    if(!camera.inBounds(world.whiteBound)){\n\t\tdrawBoundArrow();\n\t}\n\n    if(gameStarted){\n    \tdrawShrinkTimer();\n    } else{\n    \tdrawLobbyTimer();\n    }\n\n}\n\nfunction drawJoysticks(){\n\tif(joystickMovement != null && isTouchScreen){\n\t\tcanvasContext.save();\n\t\tcanvasContext.beginPath();\n\t\tcanvasContext.fillStyle = \"rgba(0, 0, 255, 0.3)\";\n\t\tcanvasContext.arc(joystickMovement.baseX,joystickMovement.baseY,joystickMovement.baseRadius,0,Math.PI*2,true);\n\t\tcanvasContext.fill();\n\n\t\tcanvasContext.strokeStyle = \"blue\";\n\t\tcanvasContext.beginPath();\n\t\tcanvasContext.arc(joystickMovement.stickX,joystickMovement.stickY,joystickMovement.stickRadius,0,Math.PI*2,true);\n\t\tcanvasContext.stroke();\n\n\t\tcanvasContext.restore();\n\t}\n\tif(joystickCamera != null && isTouchScreen){\n\t\tcanvasContext.save();\n\t\tcanvasContext.beginPath();\n\t\tcanvasContext.fillStyle = \"rgba(255, 0, 0, 0.3)\";\n\t\tcanvasContext.arc(joystickCamera.baseX,joystickCamera.baseY,joystickCamera.baseRadius,0,Math.PI*2,true);\n\t\tcanvasContext.fill();\n\n\t\tif( 1 - (cooldownRemaining/currentWeaponCooldown) >= 1){\n\t\t\tcanvasContext.strokeStyle = \"red\";\n\t\t\tcanvasContext.beginPath();\n\t\t\tcanvasContext.arc(joystickCamera.baseX,joystickCamera.baseY,joystickCamera.fireradius,0,Math.PI*2,true);\n\t\t\tcanvasContext.stroke();\n\t\t}\n\t\tcanvasContext.strokeStyle = \"red\";\n\t\tcanvasContext.beginPath();\n\t\tcanvasContext.arc(joystickCamera.stickX,joystickCamera.stickY,joystickCamera.stickRadius,0,Math.PI*2,true);\n\t\tcanvasContext.stroke();\n\n\t\tcanvasContext.beginPath();\n\t\tcanvasContext.moveTo(canvas.width/2,canvas.height/2);\n\t\tcanvasContext.lineTo(canvas.width/2+joystickCamera.dx*500,canvas.height/2+joystickCamera.dy*500);\n\t\tcanvasContext.stroke();\n\n\t\tcanvasContext.restore();\n\t}\n}\n\nfunction drawAliveCounter(){\n\tdrawText(getShipListCount() + \" alive\",eventLog.x + eventLog.width-60,eventLog.y-40);\n}\n\nfunction drawKillCounter(){\n\tdrawText(\"Killed \" + myShip.killList.length,eventLog.x,eventLog.y-40);\n}\n\nfunction drawHPCounter(){\n\tcanvasContext.save();\n\tcanvasContext.fillStyle = \"Green\";\n\tcanvasContext.fillRect(eventLog.x,eventLog.y-30,eventLog.width/2,20);\n\t\n\tcanvasContext.restore();\n\tdrawTextF(\"Health\",eventLog.x+(eventLog.width/4)-30,eventLog.y-15,\"#ECF0F1\",\"17px Georgia\");\n}\nfunction drawWeaponCooldown(){\n\tcanvasContext.save();\n\tcanvasContext.fillStyle = myShip.color;\n\tcanvasContext.fillRect(eventLog.x+eventLog.width/2,eventLog.y-30,(1 - (cooldownRemaining/currentWeaponCooldown))*eventLog.width/2,20);\n\tcanvasContext.restore();\n\tdrawTextF(\"Power\",eventLog.x+eventLog.width/2+(eventLog.width/4)-30,eventLog.y-15,\"#ECF0F1\",\"17px Georgia\");\n}\n\nfunction drawToast(){\n\tif(toastMessage != null){\n\t\tdrawText(toastMessage,canvas.width/2-(toastMessage.length*5),canvas.height/2+50);\n\t}\n}\nfunction drawTotalPlayers(){\n\tif(totalPlayers !=null){\n\t\tvar message = \"Players on Server: \" + totalPlayers;\n\t\tdrawTextF(message,canvas.width-(message.length*5),canvas.height - 15,\"#e0e0eb\",\"10px Georgia\");\n\t}\n}\n\nfunction drawPing(){\n\tif(ping != null){\n\t\tvar message = \"Ping: \" + ping;\n\t\tdrawTextF(message,canvas.width-(message.length*5) - 125,canvas.height - 15,\"#e0e0eb\",\"10px Georgia\");\n\t}\n}\n\n\nfunction drawBoundArrow(){\n\tvar dx = world.whiteBound.x - myShip.x;\n\tvar dy = world.whiteBound.y - myShip.y;\n\n\tvar x, y;\n\tvar arrowPad = 20;\n\tif (Math.abs(dy/dx) < (camera.yOffset) / (camera.xOffset)){\n\t\tif (dx > 0){\n\t\t\t//right edge\n\t\t\tx = 2 * camera.xOffset - arrowPad;\n\t\t}\n\t\telse{\n\t\t\t//left edge\n\t\t\tx = arrowPad;\n\t\t}\n\t\ty = (dy/dx) * (x - camera.xOffset) + camera.yOffset;\n\t}\n\telse {\n\t\tif (dy > 0){\n\t\t\t//bottom edge\n\t\t\ty = 2 * camera.yOffset - arrowPad;\n\t\t}\n\t\telse{\n\t\t\t//top edge\n\t\t\ty = arrowPad;\n\t\t}\n\t\tx = (dx/dy) * (y - camera.yOffset) + camera.xOffset;\n\t}\n\tvar rad = canvas.height/2 * 0.95;\n\tvar angle = Math.atan2(world.whiteBound.y-myShip.y,world.whiteBound.x-myShip.x) + Math.PI/2;\n\n\tcanvasContext.save();\n\tcanvasContext.translate(x, y);\n\tcanvasContext.rotate(angle);\n\tcanvasContext.strokeStyle = myShip.color;\n\tcanvasContext.beginPath();\n\tcanvasContext.lineWidth = 5;\n\tcanvasContext.moveTo(-20,23);\n\tcanvasContext.lineTo(0,3);\n\tcanvasContext.lineTo(20,23);\n\tcanvasContext.stroke();\n\tcanvasContext.restore();\n}\n\nfunction drawEventLog(){\n\tcanvasContext.save();\n\tcanvasContext.globalAlpha = 0.5;\n\tcanvasContext.fillStyle = eventLog.backgroundColor;\n\tcanvasContext.fillRect(eventLog.x,eventLog.y,eventLog.width,eventLog.height);\n\tcanvasContext.fillStyle = eventLog.textColor;\n\tcanvasContext.font=\teventLog.textStyle;\n\tvar len = eventLog.printList.length-1;\n\tif(len != -1){\n\t\tfor(var i=len;i>=0;i--){\n\t\t\tcanvasContext.fillText(eventLog.printList[i],eventLog.textX(),eventLog.textY()+(i*eventLog.textSize));\n\t\t}\n\t}\n\tcanvasContext.restore();\n}\n\nfunction drawShrinkTimer(){\n\tif(shrinkTimeLeft > 5){\n\t\tdrawText(shrinkTimeLeft + \" until shrink\",eventLog.x + eventLog.width/2-60,eventLog.y-40);\n\t} else if(shrinkTimeLeft > 0){\n\t\tdrawFlashingText(shrinkTimeLeft + \" until shrink\",eventLog.x + eventLog.width/2-60,eventLog.y-40,\"white\",\"22px Georgia\",\"red\",shrinkTimeLeft);\n\t} else{\n\t\tdrawFlashingText(\"Shrinking bounds..\",eventLog.x + eventLog.width/2-60,eventLog.y-40,\"red\",\"22px Georgia\");\n\t}\n}\n\nfunction drawLobbyTimer(){\n\tdrawText(lobbyTimeLeft + \" until start\",eventLog.x + eventLog.width/2-40,eventLog.y-40);\n}\n\n\n//DRAWING OBJECTS RELATIVE TO CAMERA\nfunction drawRelativeObjects(){\n\tif(myID != null && shipList != null && shipList[myID] != null){\n        myShip = shipList[myID];\n        camera.centerOnObject(myShip);\n\t\tcamera.draw();\n\t}\n\tdrawShips();\n\tdrawAsteroids();\n\tdrawItems();\n\tdrawBullets();\n\tdrawPlanets();\n\tdrawNebulas();\n\tdrawTradeShips();\n\tdrawWorld();\n\tdrawBounds();\n}\nfunction drawShip(ship){\n\tif(ship.shield != null && ship.shield.alive){\n\t\tdrawShield(ship);\n\t}\n\tcanvasContext.save();\n\tcanvasContext.translate(ship.x-myShip.x+camera.xOffset,ship.y-myShip.y+camera.yOffset);\n\tcanvasContext.rotate(ship.angle*Math.PI/180);\n\tcanvasContext.shadowColor = ship.glowColor;\n\tcanvasContext.shadowOffsetX = 1;\n\tcanvasContext.shadowOffsetY = 1;\n\tcanvasContext.shadowBlur = 16;\n\tcanvasContext.fillStyle = ship.color;\n\tcanvasContext.fillRect(-ship.width/2,-ship.height/2,ship.width,ship.height);\n\tcanvasContext.restore();\n}\nfunction drawShield(ship){\n\tcanvasContext.save();\n\tcanvasContext.beginPath();\n\tcanvasContext.strokeStyle = ship.shield.color;\n\tcanvasContext.arc(ship.x-myShip.x+camera.xOffset,ship.y-myShip.y+camera.yOffset,ship.shield.radius,0,Math.PI*2,true);\n\tcanvasContext.stroke();\n\tcanvasContext.restore();\n}\n\nfunction drawAsteroid(asteroid){\n\tcanvasContext.save();\n\tcanvasContext.beginPath();\n\tcanvasContext.fillStyle = asteroid.color;\n\tcanvasContext.arc(asteroid.x-myShip.x+camera.xOffset,asteroid.y-myShip.y+camera.yOffset,asteroid.radius,0,Math.PI*2,true);\n\tcanvasContext.fill();\n\tcanvasContext.restore();\n}\n\nfunction drawItem(item){\n\tcanvasContext.save();\n\tcanvasContext.fillStyle = item.color;\n\tcanvasContext.fillRect(item.x-myShip.x+camera.xOffset,item.y-myShip.y+camera.yOffset,item.width,item.height);\n\tcanvasContext.strokeStyle = \"white\";\n\tcanvasContext.lineWidth=2;\n    canvasContext.rect(item.x-myShip.x+camera.xOffset,item.y-myShip.y+camera.yOffset,item.width,item.height);\n    canvasContext.stroke();\n    canvasContext.restore();\n}\n\nfunction drawPlanet(planet){\n\tcanvasContext.save();\n\tcanvasContext.beginPath();\n\tcanvasContext.fillStyle = planet.color;\n\tcanvasContext.arc(planet.x-myShip.x+camera.xOffset,planet.y-myShip.y+camera.yOffset,planet.radius,0,Math.PI*2,true);\n\tcanvasContext.fill();\n\tcanvasContext.restore();\n}\n\nfunction drawNebula(nebula){\n\tcanvasContext.save();\n\tcanvasContext.beginPath();\n\tcanvasContext.fillStyle = nebula.color;\n\tcanvasContext.arc(nebula.x-myShip.x+camera.xOffset,nebula.y-myShip.y+camera.yOffset,nebula.radius,0,Math.PI*2,true);\n\tcanvasContext.fill();\n\tcanvasContext.restore();\n}\n\nfunction drawTradeShip(tradeShip){\n\tcanvasContext.save();\n\tcanvasContext.translate(tradeShip.x-myShip.x+camera.xOffset,tradeShip.y-myShip.y+camera.yOffset);\n\tcanvasContext.fillStyle = tradeShip.color;\n\tcanvasContext.rotate(tradeShip.angle*Math.PI/180);\n\tcanvasContext.fillRect(-tradeShip.width/2,-tradeShip.height/2,tradeShip.width,tradeShip.height);\n    canvasContext.restore();\n}\n\nfunction drawTradeShipTrail(circle){\n\tcanvasContext.save();\n\tcanvasContext.beginPath();\n\tcanvasContext.lineWidth = 3;\n\tcanvasContext.strokeStyle = circle.color;\n\tcanvasContext.arc(circle.x-myShip.x+camera.xOffset,circle.y-myShip.y+camera.yOffset,circle.radius,0,Math.PI*2,true);\n\tcanvasContext.stroke();\n\tcanvasContext.restore();\n}\n\nfunction drawBullet(bullet){\n\tcanvasContext.save();\n\tcanvasContext.translate(bullet.x-myShip.x+camera.xOffset,bullet.y-myShip.y+camera.yOffset);\n\tcanvasContext.rotate(bullet.angle*Math.PI/180);\n\tcanvasContext.fillStyle = bullet.color;\n\tcanvasContext.fillRect(-bullet.width/2,-bullet.height/2,bullet.width,bullet.height);\n\tcanvasContext.restore();\n}\n\nfunction drawWorld(){\n\tif(world != null){\n\t\tcanvasContext.save();\n\t\tcanvasContext.beginPath();\n        canvasContext.strokeStyle = world.color;\n        canvasContext.rect(world.x-myShip.x+camera.xOffset,world.y-myShip.y+camera.yOffset,world.width,world.height);\n        canvasContext.stroke();\n        canvasContext.restore();\n\t}\n}\n\nfunction drawBounds(){\n\tif(world.whiteBound != null){\n\t\tcanvasContext.save();\n\t\tcanvasContext.beginPath();\n\t\tcanvasContext.lineWidth = 3;\n\t\tcanvasContext.strokeStyle = world.whiteBound.color;\n\t\tcanvasContext.arc(world.whiteBound.x-myShip.x+camera.xOffset,world.whiteBound.y-myShip.y+camera.yOffset,world.whiteBound.radius,0,Math.PI*2,true);\n\t\tcanvasContext.stroke();\n\t\tcanvasContext.restore();\n\t}\n\tif(world.blueBound != null){\n\t\tcanvasContext.save();\n\t\tcanvasContext.beginPath();\n\t\tcanvasContext.lineWidth = 3;\n\t\tcanvasContext.strokeStyle = world.blueBound.color;\n\t\tcanvasContext.arc(world.blueBound.x-myShip.x+camera.xOffset,world.blueBound.y-myShip.y+camera.yOffset,world.blueBound.radius,0,Math.PI*2,true);\n\t\tcanvasContext.stroke();\n\t\tcanvasContext.restore();\n\t}\n}\n\n\nfunction drawShips(){\n\tfor(var shipKey in shipList){\n\t\tvar ship = shipList[shipKey];\n\t\tif(ship == null){\n\t\t\tcontinue;\n\t\t}\n\t\tif(shipKey == myID){\n\t\t\tdrawShip(ship);\n\t\t\tcontinue;\n\t\t}\n\t\tif(camera.inBounds(ship)){\n\t\t\tdrawShip(ship);\n\t\t}\n\t}\n}\n\nfunction drawAsteroids(){\n\tfor(var sig in asteroidList){\n\t\tif(asteroidList[sig] == null){\n\t\t\tcontinue;\n\t\t}\n\t\tif(camera.inBounds(asteroidList[sig])){\n\t\t\tdrawAsteroid(asteroidList[sig]);\n\t\t}\n\n\t}\n}\n\nfunction drawItems(){\n\tfor(var sig in itemList){\n\t\tif(itemList[sig] == null){\n\t\t\tcontinue;\n\t\t}\n\t\tif(camera.inBounds(itemList[sig])){\n\t\t\tdrawItem(itemList[sig]);\n\t\t}\n\n\t}\n}\n\n\n\nfunction drawPlanets(){\n\tfor(var sig in planetList){\n\t\tif(planetList[sig] == null){\n\t\t\tcontinue;\n\t\t}\n\t\tif(camera.inBounds(planetList[sig])){\n\t\t\tdrawPlanet(planetList[sig]);\n\t\t}\n\n\t}\n}\n\nfunction drawNebulas(){\n\tfor(var sig in nebulaList){\n\t\tif(nebulaList[sig] == null){\n\t\t\tcontinue;\n\t\t}\n\t\tif(camera.inBounds(nebulaList[sig])){\n\t\t\tdrawNebula(nebulaList[sig]);\n\t\t}\n\n\t}\n}\nfunction drawTradeShips(){\n\tfor(var sig in tradeShipList){\n\t\tif(tradeShipList[sig] == null){\n\t\t\tcontinue;\n\t\t}\n\t\tfor(var trailSig in tradeShipList[sig].trailList){\n\t\t\tvar circle = tradeShipList[sig].trailList[trailSig];\n\t\t\tif(circle != null){\n\t\t\t\tif(camera.inBounds(circle)){\n\t\t\t\t\tdrawTradeShipTrail(circle);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(camera.inBounds(tradeShipList[sig])){\n\t\t\tdrawTradeShip(tradeShipList[sig]);\n\t\t}\n\t}\n}\n\nfunction drawBullets(){\n\tfor(var sig in bulletList){\n\t\tif(bulletList[sig] == null){\n\t\t\tcontinue;\n\t\t}\n\t\tif(camera.inBounds(bulletList[sig])){\n\t\t\tdrawBullet(bulletList[sig]);\n\t\t}\n\t}\n}\n",
                "new_contents": "var background = new Image();\nbackground.src = 'img/background.jpg';\n\nfunction drawBackground() {\n\tcanvasContext.save();\n\tcanvasContext.fillStyle = 'black';\n\tcanvasContext.fillRect(0,0,canvas.width,canvas.height);\n\tcanvasContext.drawImage(background,world.x-myShip.x,world.y-myShip.y,world.width+canvas.width,world.height+canvas.height);\n\tcanvasContext.restore();\n}\n\nfunction drawFlashScreen(){\n\tcanvasContext.save();\n\tcanvasContext.fillStyle = 'red';\n\tcanvasContext.fillRect(0,0,canvas.width,canvas.height);\n\tcanvasContext.restore();\n}\n\n\n\nfunction drawText(text,x,y){\n\tcanvasContext.save();\n\tcanvasContext.fillStyle = 'white';\n\tcanvasContext.font=\"20px Georgia\";\n\tcanvasContext.fillText(text,x,y);\n\tcanvasContext.restore();\n}\nfunction drawTextF(text,x,y,color,font){\n\tcanvasContext.save();\n\tcanvasContext.fillStyle = color;\n\tcanvasContext.font=font;\n\tcanvasContext.fillText(text,x,y);\n\tcanvasContext.restore();\n}\n\nfunction drawFlashingText(text,x,y,color,font,flashColor,timeLeft){\n\tif(timeLeft%2 == 1){\n\t\tdrawTextF(text,x,y,flashColor,font);\n\t} else{\n\t\tdrawTextF(text,x,y,color,font);\n\t}\n}\n\n//DRAWING HUD UI\nfunction drawHUD(){\n\tdrawJoysticks();\n\tdrawAliveCounter();\n\tdrawKillCounter();\n    drawHPCounter();\n    drawToast();\n    drawPing();\n    drawTotalPlayers();\n    drawWeaponCooldown();\n    drawEventLog();\n\n    if(!camera.inBounds(world.whiteBound)){\n\t\tdrawBoundArrow();\n\t}\n\n    if(gameStarted){\n    \tdrawShrinkTimer();\n    } else{\n    \tdrawLobbyTimer();\n    }\n\n}\n\nfunction drawJoysticks(){\n\tif(joystickMovement != null && isTouchScreen){\n\t\tcanvasContext.save();\n\t\tcanvasContext.beginPath();\n\t\tcanvasContext.fillStyle = \"rgba(0, 0, 255, 0.3)\";\n\t\tcanvasContext.arc(joystickMovement.baseX,joystickMovement.baseY,joystickMovement.baseRadius,0,Math.PI*2,true);\n\t\tcanvasContext.fill();\n\n\t\tcanvasContext.strokeStyle = \"blue\";\n\t\tcanvasContext.beginPath();\n\t\tcanvasContext.arc(joystickMovement.stickX,joystickMovement.stickY,joystickMovement.stickRadius,0,Math.PI*2,true);\n\t\tcanvasContext.stroke();\n\n\t\tcanvasContext.restore();\n\t}\n\tif(joystickCamera != null && isTouchScreen){\n\t\tcanvasContext.save();\n\t\tcanvasContext.beginPath();\n\t\tcanvasContext.fillStyle = \"rgba(255, 0, 0, 0.3)\";\n\t\tcanvasContext.arc(joystickCamera.baseX,joystickCamera.baseY,joystickCamera.baseRadius,0,Math.PI*2,true);\n\t\tcanvasContext.fill();\n\n\t\tif( 1 - (cooldownRemaining/currentWeaponCooldown) >= 1){\n\t\t\tcanvasContext.strokeStyle = \"red\";\n\t\t\tcanvasContext.beginPath();\n\t\t\tcanvasContext.arc(joystickCamera.baseX,joystickCamera.baseY,joystickCamera.fireradius,0,Math.PI*2,true);\n\t\t\tcanvasContext.stroke();\n\t\t}\n\t\tcanvasContext.strokeStyle = \"red\";\n\t\tcanvasContext.beginPath();\n\t\tcanvasContext.arc(joystickCamera.stickX,joystickCamera.stickY,joystickCamera.stickRadius,0,Math.PI*2,true);\n\t\tcanvasContext.stroke();\n\n\t\tcanvasContext.beginPath();\n\t\tcanvasContext.moveTo(canvas.width/2,canvas.height/2);\n\t\tcanvasContext.lineTo(canvas.width/2+joystickCamera.dx*500,canvas.height/2+joystickCamera.dy*500);\n\t\tcanvasContext.stroke();\n\n\t\tcanvasContext.restore();\n\t}\n}\n\nfunction drawAliveCounter(){\n\tdrawText(getShipListCount() + \" alive\",eventLog.x + eventLog.width-60,eventLog.y-40);\n}\n\nfunction drawKillCounter(){\n\tdrawText(\"Killed \" + myShip.killList.length,eventLog.x,eventLog.y-40);\n}\n\nfunction drawHPCounter(){\n\tcanvasContext.save();\n\tif(shipList[myID].health > 70){\n\t\tcanvasContext.fillStyle = \"Green\";\n\t}else if(shipList[myID].health > 30){\n\t\tcanvasContext.fillStyle = \"yellow\";\n\t} else {\n\t\tcanvasContext.fillStyle = \"tomato\";\n\t}\n\t\n\tcanvasContext.fillRect(eventLog.x,eventLog.y-30,(shipList[myID].health/100)*eventLog.width/2,20);\n\tcanvasContext.restore();\n\tdrawTextF(\"Health\",eventLog.x+(eventLog.width/4)-30,eventLog.y-15,\"#ECF0F1\",\"17px Georgia\");\n}\nfunction drawWeaponCooldown(){\n\tcanvasContext.save();\n\tcanvasContext.fillStyle = myShip.color;\n\tcanvasContext.fillRect(eventLog.x+eventLog.width/2,eventLog.y-30,(1 - (cooldownRemaining/currentWeaponCooldown))*eventLog.width/2,20);\n\tcanvasContext.restore();\n\tdrawTextF(\"Power\",eventLog.x+eventLog.width/2+(eventLog.width/4)-30,eventLog.y-15,\"#ECF0F1\",\"17px Georgia\");\n}\n\nfunction drawToast(){\n\tif(toastMessage != null){\n\t\tdrawText(toastMessage,canvas.width/2-(toastMessage.length*5),canvas.height/2+50);\n\t}\n}\nfunction drawTotalPlayers(){\n\tif(totalPlayers !=null){\n\t\tvar message = \"Players on Server: \" + totalPlayers;\n\t\tdrawTextF(message,canvas.width-(message.length*5),canvas.height - 15,\"#e0e0eb\",\"10px Georgia\");\n\t}\n}\n\nfunction drawPing(){\n\tif(ping != null){\n\t\tvar message = \"Ping: \" + ping;\n\t\tdrawTextF(message,canvas.width-(message.length*5) - 125,canvas.height - 15,\"#e0e0eb\",\"10px Georgia\");\n\t}\n}\n\n\nfunction drawBoundArrow(){\n\tvar dx = world.whiteBound.x - myShip.x;\n\tvar dy = world.whiteBound.y - myShip.y;\n\n\tvar x, y;\n\tvar arrowPad = 20;\n\tif (Math.abs(dy/dx) < (camera.yOffset) / (camera.xOffset)){\n\t\tif (dx > 0){\n\t\t\t//right edge\n\t\t\tx = 2 * camera.xOffset - arrowPad;\n\t\t}\n\t\telse{\n\t\t\t//left edge\n\t\t\tx = arrowPad;\n\t\t}\n\t\ty = (dy/dx) * (x - camera.xOffset) + camera.yOffset;\n\t}\n\telse {\n\t\tif (dy > 0){\n\t\t\t//bottom edge\n\t\t\ty = 2 * camera.yOffset - arrowPad;\n\t\t}\n\t\telse{\n\t\t\t//top edge\n\t\t\ty = arrowPad;\n\t\t}\n\t\tx = (dx/dy) * (y - camera.yOffset) + camera.xOffset;\n\t}\n\tvar rad = canvas.height/2 * 0.95;\n\tvar angle = Math.atan2(world.whiteBound.y-myShip.y,world.whiteBound.x-myShip.x) + Math.PI/2;\n\n\tcanvasContext.save();\n\tcanvasContext.translate(x, y);\n\tcanvasContext.rotate(angle);\n\tcanvasContext.strokeStyle = myShip.color;\n\tcanvasContext.beginPath();\n\tcanvasContext.lineWidth = 5;\n\tcanvasContext.moveTo(-20,23);\n\tcanvasContext.lineTo(0,3);\n\tcanvasContext.lineTo(20,23);\n\tcanvasContext.stroke();\n\tcanvasContext.restore();\n}\n\nfunction drawEventLog(){\n\tcanvasContext.save();\n\tcanvasContext.globalAlpha = 0.5;\n\tcanvasContext.fillStyle = eventLog.backgroundColor;\n\tcanvasContext.fillRect(eventLog.x,eventLog.y,eventLog.width,eventLog.height);\n\tcanvasContext.fillStyle = eventLog.textColor;\n\tcanvasContext.font=\teventLog.textStyle;\n\tvar len = eventLog.printList.length-1;\n\tif(len != -1){\n\t\tfor(var i=len;i>=0;i--){\n\t\t\tcanvasContext.fillText(eventLog.printList[i],eventLog.textX(),eventLog.textY()+(i*eventLog.textSize));\n\t\t}\n\t}\n\tcanvasContext.restore();\n}\n\nfunction drawShrinkTimer(){\n\tif(shrinkTimeLeft > 5){\n\t\tdrawText(shrinkTimeLeft + \" until shrink\",eventLog.x + eventLog.width/2-60,eventLog.y-40);\n\t} else if(shrinkTimeLeft > 0){\n\t\tdrawFlashingText(shrinkTimeLeft + \" until shrink\",eventLog.x + eventLog.width/2-60,eventLog.y-40,\"white\",\"22px Georgia\",\"red\",shrinkTimeLeft);\n\t} else{\n\t\tdrawFlashingText(\"Shrinking bounds..\",eventLog.x + eventLog.width/2-60,eventLog.y-40,\"red\",\"22px Georgia\");\n\t}\n}\n\nfunction drawLobbyTimer(){\n\tdrawText(lobbyTimeLeft + \" until start\",eventLog.x + eventLog.width/2-40,eventLog.y-40);\n}\n\n\n//DRAWING OBJECTS RELATIVE TO CAMERA\nfunction drawRelativeObjects(){\n\tif(myID != null && shipList != null && shipList[myID] != null){\n        myShip = shipList[myID];\n        camera.centerOnObject(myShip);\n\t\tcamera.draw();\n\t}\n\tdrawShips();\n\tdrawAsteroids();\n\tdrawItems();\n\tdrawBullets();\n\tdrawPlanets();\n\tdrawNebulas();\n\tdrawTradeShips();\n\tdrawWorld();\n\tdrawBounds();\n}\nfunction drawShip(ship){\n\tif(ship.shield != null && ship.shield.alive){\n\t\tdrawShield(ship);\n\t}\n\tcanvasContext.save();\n\tcanvasContext.translate(ship.x-myShip.x+camera.xOffset,ship.y-myShip.y+camera.yOffset);\n\tcanvasContext.rotate(ship.angle*Math.PI/180);\n\tcanvasContext.shadowColor = ship.glowColor;\n\tcanvasContext.shadowOffsetX = 1;\n\tcanvasContext.shadowOffsetY = 1;\n\tcanvasContext.shadowBlur = 16;\n\tcanvasContext.fillStyle = ship.color;\n\tcanvasContext.fillRect(-ship.width/2,-ship.height/2,ship.width,ship.height);\n\tcanvasContext.restore();\n}\nfunction drawShield(ship){\n\tcanvasContext.save();\n\tcanvasContext.beginPath();\n\tcanvasContext.strokeStyle = ship.shield.color;\n\tcanvasContext.arc(ship.x-myShip.x+camera.xOffset,ship.y-myShip.y+camera.yOffset,ship.shield.radius,0,Math.PI*2,true);\n\tcanvasContext.stroke();\n\tcanvasContext.restore();\n}\n\nfunction drawAsteroid(asteroid){\n\tcanvasContext.save();\n\tcanvasContext.beginPath();\n\tcanvasContext.fillStyle = asteroid.color;\n\tcanvasContext.arc(asteroid.x-myShip.x+camera.xOffset,asteroid.y-myShip.y+camera.yOffset,asteroid.radius,0,Math.PI*2,true);\n\tcanvasContext.fill();\n\tcanvasContext.restore();\n}\n\nfunction drawItem(item){\n\tcanvasContext.save();\n\tcanvasContext.fillStyle = item.color;\n\tcanvasContext.fillRect(item.x-myShip.x+camera.xOffset,item.y-myShip.y+camera.yOffset,item.width,item.height);\n\tcanvasContext.strokeStyle = \"white\";\n\tcanvasContext.lineWidth=2;\n    canvasContext.rect(item.x-myShip.x+camera.xOffset,item.y-myShip.y+camera.yOffset,item.width,item.height);\n    canvasContext.stroke();\n    canvasContext.restore();\n}\n\nfunction drawPlanet(planet){\n\tcanvasContext.save();\n\tcanvasContext.beginPath();\n\tcanvasContext.fillStyle = planet.color;\n\tcanvasContext.arc(planet.x-myShip.x+camera.xOffset,planet.y-myShip.y+camera.yOffset,planet.radius,0,Math.PI*2,true);\n\tcanvasContext.fill();\n\tcanvasContext.restore();\n}\n\nfunction drawNebula(nebula){\n\tcanvasContext.save();\n\tcanvasContext.beginPath();\n\tcanvasContext.fillStyle = nebula.color;\n\tcanvasContext.arc(nebula.x-myShip.x+camera.xOffset,nebula.y-myShip.y+camera.yOffset,nebula.radius,0,Math.PI*2,true);\n\tcanvasContext.fill();\n\tcanvasContext.restore();\n}\n\nfunction drawTradeShip(tradeShip){\n\tcanvasContext.save();\n\tcanvasContext.translate(tradeShip.x-myShip.x+camera.xOffset,tradeShip.y-myShip.y+camera.yOffset);\n\tcanvasContext.fillStyle = tradeShip.color;\n\tcanvasContext.rotate(tradeShip.angle*Math.PI/180);\n\tcanvasContext.fillRect(-tradeShip.width/2,-tradeShip.height/2,tradeShip.width,tradeShip.height);\n    canvasContext.restore();\n}\n\nfunction drawTradeShipTrail(circle){\n\tcanvasContext.save();\n\tcanvasContext.beginPath();\n\tcanvasContext.lineWidth = 3;\n\tcanvasContext.strokeStyle = circle.color;\n\tcanvasContext.arc(circle.x-myShip.x+camera.xOffset,circle.y-myShip.y+camera.yOffset,circle.radius,0,Math.PI*2,true);\n\tcanvasContext.stroke();\n\tcanvasContext.restore();\n}\n\nfunction drawBullet(bullet){\n\tcanvasContext.save();\n\tcanvasContext.translate(bullet.x-myShip.x+camera.xOffset,bullet.y-myShip.y+camera.yOffset);\n\tcanvasContext.rotate(bullet.angle*Math.PI/180);\n\tcanvasContext.fillStyle = bullet.color;\n\tcanvasContext.fillRect(-bullet.width/2,-bullet.height/2,bullet.width,bullet.height);\n\tcanvasContext.restore();\n}\n\nfunction drawWorld(){\n\tif(world != null){\n\t\tcanvasContext.save();\n\t\tcanvasContext.beginPath();\n        canvasContext.strokeStyle = world.color;\n        canvasContext.rect(world.x-myShip.x+camera.xOffset,world.y-myShip.y+camera.yOffset,world.width,world.height);\n        canvasContext.stroke();\n        canvasContext.restore();\n\t}\n}\n\nfunction drawBounds(){\n\tif(world.whiteBound != null){\n\t\tcanvasContext.save();\n\t\tcanvasContext.beginPath();\n\t\tcanvasContext.lineWidth = 3;\n\t\tcanvasContext.strokeStyle = world.whiteBound.color;\n\t\tcanvasContext.arc(world.whiteBound.x-myShip.x+camera.xOffset,world.whiteBound.y-myShip.y+camera.yOffset,world.whiteBound.radius,0,Math.PI*2,true);\n\t\tcanvasContext.stroke();\n\t\tcanvasContext.restore();\n\t}\n\tif(world.blueBound != null){\n\t\tcanvasContext.save();\n\t\tcanvasContext.beginPath();\n\t\tcanvasContext.lineWidth = 3;\n\t\tcanvasContext.strokeStyle = world.blueBound.color;\n\t\tcanvasContext.arc(world.blueBound.x-myShip.x+camera.xOffset,world.blueBound.y-myShip.y+camera.yOffset,world.blueBound.radius,0,Math.PI*2,true);\n\t\tcanvasContext.stroke();\n\t\tcanvasContext.restore();\n\t}\n}\n\n\nfunction drawShips(){\n\tfor(var shipKey in shipList){\n\t\tvar ship = shipList[shipKey];\n\t\tif(ship == null){\n\t\t\tcontinue;\n\t\t}\n\t\tif(shipKey == myID){\n\t\t\tdrawShip(ship);\n\t\t\tcontinue;\n\t\t}\n\t\tif(camera.inBounds(ship)){\n\t\t\tdrawShip(ship);\n\t\t}\n\t}\n}\n\nfunction drawAsteroids(){\n\tfor(var sig in asteroidList){\n\t\tif(asteroidList[sig] == null){\n\t\t\tcontinue;\n\t\t}\n\t\tif(camera.inBounds(asteroidList[sig])){\n\t\t\tdrawAsteroid(asteroidList[sig]);\n\t\t}\n\n\t}\n}\n\nfunction drawItems(){\n\tfor(var sig in itemList){\n\t\tif(itemList[sig] == null){\n\t\t\tcontinue;\n\t\t}\n\t\tif(camera.inBounds(itemList[sig])){\n\t\t\tdrawItem(itemList[sig]);\n\t\t}\n\n\t}\n}\n\n\n\nfunction drawPlanets(){\n\tfor(var sig in planetList){\n\t\tif(planetList[sig] == null){\n\t\t\tcontinue;\n\t\t}\n\t\tif(camera.inBounds(planetList[sig])){\n\t\t\tdrawPlanet(planetList[sig]);\n\t\t}\n\n\t}\n}\n\nfunction drawNebulas(){\n\tfor(var sig in nebulaList){\n\t\tif(nebulaList[sig] == null){\n\t\t\tcontinue;\n\t\t}\n\t\tif(camera.inBounds(nebulaList[sig])){\n\t\t\tdrawNebula(nebulaList[sig]);\n\t\t}\n\n\t}\n}\nfunction drawTradeShips(){\n\tfor(var sig in tradeShipList){\n\t\tif(tradeShipList[sig] == null){\n\t\t\tcontinue;\n\t\t}\n\t\tfor(var trailSig in tradeShipList[sig].trailList){\n\t\t\tvar circle = tradeShipList[sig].trailList[trailSig];\n\t\t\tif(circle != null){\n\t\t\t\tif(camera.inBounds(circle)){\n\t\t\t\t\tdrawTradeShipTrail(circle);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(camera.inBounds(tradeShipList[sig])){\n\t\t\tdrawTradeShip(tradeShipList[sig]);\n\t\t}\n\t}\n}\n\nfunction drawBullets(){\n\tfor(var sig in bulletList){\n\t\tif(bulletList[sig] == null){\n\t\t\tcontinue;\n\t\t}\n\t\tif(camera.inBounds(bulletList[sig])){\n\t\t\tdrawBullet(bulletList[sig]);\n\t\t}\n\t}\n}\n",
                "subject": "forgot to scale health to current HP status",
                "message": "forgot to scale health to current HP status\n",
                "lang": "JavaScript",
                "license": "apache-2.0",
                "repos": "sjdodge123/spaceroyale.io,sjdodge123/spaceroyale.io,sjdodge123/spaceroyale.io"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10264,
            "row": {
                "commit": "18bea5a8e157fd6baf2e9571467919a3c6c5c516",
                "old_file": "src/dd-datepicker/tests/dd-datepicker.spec.js",
                "new_file": "src/dd-datepicker/tests/dd-datepicker.spec.js",
                "old_contents": "describe('datetimepicker', function () {\n    var $scope,\n        $sniffer,\n        $document,\n        $compile,\n        $timeout,\n        element,\n        currentYear = new Date().getFullYear();\n\n    beforeEach(function () {\n        module('dd.ui.dd-datepicker');\n        module('template/dd-datepicker/dd-datepicker.html');\n\n        inject(function ($rootScope, _$compile_, _$sniffer_, _$document_, _$timeout_) {\n            $scope = $rootScope.$new();\n            $sniffer = _$sniffer_;\n            $document = _$document_;\n            $compile = _$compile_;\n            $timeout = _$timeout_;\n\n            $scope.dateFormat = 'yyyy-MM-dd';\n            element = compileElement($scope);\n        });\n    });\n\n    function compileElement($scope) {\n        var element = $compile('<input dd-datepicker date-format=\"{{dateFormat}}\" date-disabled=\"dateDisabled(date, mode)\" ng-model=\"date\" />')($scope);\n        element.appendTo($document[0].body);\n        $scope.$digest();\n        return element;\n    }\n\n    describe('Init', function () {\n        it('set default values', function () {\n            $scope.date = new Date('2016-02-09T12:01:00+00:00');\n\n            var element = compileElement($scope);\n            var elementScope = element.isolateScope();\n            $timeout.flush();\n\n            expect(elementScope.displayModel).toBeDefined();\n            expect(elementScope.bootstrapDateModel).toBeDefined();\n        });\n    });\n\n    describe('Parse', function () {\n        it('does not change initial time', function () {\n            $scope.date = new Date('2016-08-25T12:01:00+00:00');\n            $scope.$digest();\n\n            changeInputValue(element, '2016-02-09');\n\n            expectUtcTime($scope.date, 12, 1, 0);\n        });\n    });\n\n    describe('Parse date formats', function () {\n        it('yyyy-MM-dd', function () {\n            changeInputValue(element, '2016-02-09');\n            expectDate(element, 2, 9);\n        });\n\n        it('MM/dd/yyyy', function () {\n            $scope.dateFormat = 'MM/dd/yyyy';\n            element = compileElement($scope);\n\n            changeInputValue(element, '02/09/2016');\n            expectDate(element, 2, 9);\n        });\n    });\n\n    describe('Parse custom formats', function () {\n        it('0812', function () {\n\n            changeInputValue(element, '0812');\n            expectDate(element, 8, 12);\n        });\n\n        it('08-12', function () {\n\n            changeInputValue(element, '08-12');\n            expectDate(element, 8, 12);\n        });\n\n        it('08 12', function () {\n\n            changeInputValue(element, '08 12');\n            expectDate(element, 8, 12);\n        });\n\n        it('08/12', function () {\n\n            changeInputValue(element, '08/12');\n            expectDate(element, 8, 12);\n        });\n\n        it('08.12', function () {\n\n            changeInputValue(element, '08.12');\n            expectDate(element, 8, 12);\n        });\n\n        it('8/12', function () {\n            $scope.dateFormat = 'M/d';\n            element = compileElement($scope);\n\n            changeInputValue(element, '8/12');\n            expectDate(element, 8, 12);\n        });\n\n        it('12/8', function () {\n            $scope.dateFormat = 'd/M';\n            element = compileElement($scope);\n\n            changeInputValue(element, '12/8');\n            expectDate(element, 8, 12);\n        });\n    });\n\n    describe('Return null for invalid', function () {\n\n        it('abcd', function () {\n            changeInputValue(element, 'abcd');\n            expect(element.isolateScope().ngModel).toBe(null);\n        });\n\n        it('9999', function () {\n            changeInputValue(element, '9999');\n            expect(element.isolateScope().ngModel).toBe(null);\n        });\n\n        it('10.50', function () {\n            changeInputValue(element, '10.50');\n            expect(element.isolateScope().ngModel).toBe(null);\n        });\n    });\n\n    describe('Validate by dateDisabled', function () {\n        it('return null if date disabled', function () {\n\n            $scope.dateDisabled = function (date, mode) {\n                var d = new Date('2016-08-30T15:00:00+00:00');\n                d.setHours(0, 0, 0, 0);\n                return mode === 'day' && date < d;\n            };\n            $scope.$digest();\n\n            changeInputValue(element, '08-12');\n\n            expect(element.isolateScope().ngModel).toBe(null);\n        });\n\n        it('return date if in range', function () {\n\n            var d = new Date('2016-08-30T15:00:00+00:00');\n            $scope.dateDisabled = function (date, mode) {\n                d.setHours(0, 0, 0, 0);\n                return mode === 'day' && date < d;\n            };\n            $scope.$digest();\n\n            changeInputValue(element, '08-30');\n\n            expect(element.isolateScope().ngModel.getTime()).toBe(d.getTime());\n        });\n    });\n\n    describe('Arrow keys', function () {\n\n        it('add one day on arrow key up click', function () {\n            $scope.date = new Date('2016-08-25');\n            $scope.$digest();\n\n            var input = element.find('.display-input');\n            var keyUpCode = 38;\n            triggerKeyDown(input, keyUpCode);\n\n            expect($scope.date.getDate()).toBe(26);\n        });\n\n        it('substract one day on arrow key down click', function () {\n            $scope.date = new Date('2016-08-25');\n            $scope.$digest();\n\n            var input = element.find('.display-input');\n            var keyDownCode = 40;\n            triggerKeyDown(input, keyDownCode);\n\n            expect($scope.date.getDate()).toBe(24);\n        });\n\n        it('dont change date if alt key clicked', function () {\n            $scope.date = new Date('2016-08-25');\n            $scope.$digest();\n\n            var input = element.find('.display-input');\n            var altKeyCode = 18;\n            triggerKeyDown(input, altKeyCode);\n\n            expect($scope.date.getDate()).toBe(25);\n        });\n\n        it('dont change initial time', function () {\n            $scope.date = new Date('2016-08-25T12:01:00+00:00');\n            $scope.$digest();\n\n            var input = element.find('.display-input');\n            var altKeyCode = 38;\n            triggerKeyDown(input, altKeyCode);\n\n            expectUtcTime($scope.date, 12, 1, 0);\n        });\n\n        it('set current date on enter click if input is empty', function () {\n            var input = element.find('.display-input');\n            var enterKeyCode = 13;\n            triggerKeyDown(input, enterKeyCode);\n\n            expect($scope.date).toBeDefined();\n        });\n\n    });\n\n    function expectDate(el, month, day) {\n        var model = el.isolateScope().ngModel;\n        expect(model.getFullYear()).toBe(currentYear);\n        expect(model.getMonth() + 1).toBe(month);\n        expect(model.getDate()).toBe(day);\n    }\n\n    function expectUtcTime(model, hour, minute, second) {\n        expect(model.getUTCHours()).toBe(hour);\n        expect(model.getUTCMinutes()).toBe(minute);\n        expect(model.getUTCSeconds()).toBe(second);\n    }\n\n    function changeInputValue(el, value) {\n        var input = el.find('input');\n        input.val(value);\n        input.trigger($sniffer.hasEvent('input') ? 'input' : 'change');\n        input.trigger('blur');\n        $timeout.flush();\n    }\n\n});",
                "new_contents": "describe('datetimepicker', function () {\n    var $scope,\n        $sniffer,\n        $document,\n        $compile,\n        $timeout,\n        element,\n        currentYear = new Date().getFullYear();\n\n    beforeEach(function () {\n        module('dd.ui.dd-datepicker');\n        module('template/dd-datepicker/dd-datepicker.html');\n\n        inject(function ($rootScope, _$compile_, _$sniffer_, _$document_, _$timeout_) {\n            $scope = $rootScope.$new();\n            $sniffer = _$sniffer_;\n            $document = _$document_;\n            $compile = _$compile_;\n            $timeout = _$timeout_;\n\n            $scope.dateFormat = 'yyyy-MM-dd';\n            element = compileElement($scope);\n        });\n    });\n\n    function compileElement($scope) {\n        var element = $compile('<input dd-datepicker date-format=\"{{dateFormat}}\" date-disabled=\"dateDisabled(date, mode)\" ng-model=\"date\" />')($scope);\n        element.appendTo($document[0].body);\n        $scope.$digest();\n        return element;\n    }\n\n    describe('Init', function () {\n        it('set default values', function () {\n            $scope.date = new Date('2016-02-09T12:01:00+00:00');\n\n            var element = compileElement($scope);\n            var elementScope = element.isolateScope();\n            $timeout.flush();\n\n            expect(elementScope.displayModel).toBeDefined();\n            expect(elementScope.bootstrapDateModel).toBeDefined();\n        });\n    });\n\n    describe('Parse date formats', function () {\n        it('yyyy-MM-dd', function () {\n            changeInputValue(element, '2016-02-09');\n            expectDate(element, 2, 9);\n        });\n\n        it('MM/dd/yyyy', function () {\n            $scope.dateFormat = 'MM/dd/yyyy';\n            element = compileElement($scope);\n\n            changeInputValue(element, '02/09/2016');\n            expectDate(element, 2, 9);\n        });\n    });\n\n    describe('Parse custom formats', function () {\n        it('0812', function () {\n\n            changeInputValue(element, '0812');\n            expectDate(element, 8, 12);\n        });\n\n        it('08-12', function () {\n\n            changeInputValue(element, '08-12');\n            expectDate(element, 8, 12);\n        });\n\n        it('08 12', function () {\n\n            changeInputValue(element, '08 12');\n            expectDate(element, 8, 12);\n        });\n\n        it('08/12', function () {\n\n            changeInputValue(element, '08/12');\n            expectDate(element, 8, 12);\n        });\n\n        it('08.12', function () {\n\n            changeInputValue(element, '08.12');\n            expectDate(element, 8, 12);\n        });\n\n        it('8/12', function () {\n            $scope.dateFormat = 'M/d';\n            element = compileElement($scope);\n\n            changeInputValue(element, '8/12');\n            expectDate(element, 8, 12);\n        });\n\n        it('12/8', function () {\n            $scope.dateFormat = 'd/M';\n            element = compileElement($scope);\n\n            changeInputValue(element, '12/8');\n            expectDate(element, 8, 12);\n        });\n    });\n\n    describe('Return null for invalid', function () {\n\n        it('abcd', function () {\n            changeInputValue(element, 'abcd');\n            expect(element.isolateScope().ngModel).toBe(null);\n        });\n\n        it('9999', function () {\n            changeInputValue(element, '9999');\n            expect(element.isolateScope().ngModel).toBe(null);\n        });\n\n        it('10.50', function () {\n            changeInputValue(element, '10.50');\n            expect(element.isolateScope().ngModel).toBe(null);\n        });\n    });\n\n    describe('Validate by dateDisabled', function () {\n        it('return null if date disabled', function () {\n\n            $scope.dateDisabled = function (date, mode) {\n                var d = new Date('2016-08-30T15:00:00+00:00');\n                d.setHours(0, 0, 0, 0);\n                return mode === 'day' && date < d;\n            };\n            $scope.$digest();\n\n            changeInputValue(element, '08-12');\n\n            expect(element.isolateScope().ngModel).toBe(null);\n        });\n\n        it('return date if in range', function () {\n\n            var d = new Date('2016-08-30T15:00:00+00:00');\n            $scope.dateDisabled = function (date, mode) {\n                d.setHours(0, 0, 0, 0);\n                return mode === 'day' && date < d;\n            };\n            $scope.$digest();\n\n            changeInputValue(element, '08-30');\n\n            expect(element.isolateScope().ngModel.getTime()).toBe(d.getTime());\n        });\n    });\n\n    describe('Arrow keys', function () {\n\n        it('add one day on arrow key up click', function () {\n            $scope.date = new Date('2016-08-25');\n            $scope.$digest();\n\n            var input = element.find('.display-input');\n            var keyUpCode = 38;\n            triggerKeyDown(input, keyUpCode);\n\n            expect($scope.date.getDate()).toBe(26);\n        });\n\n        it('substract one day on arrow key down click', function () {\n            $scope.date = new Date('2016-08-25');\n            $scope.$digest();\n\n            var input = element.find('.display-input');\n            var keyDownCode = 40;\n            triggerKeyDown(input, keyDownCode);\n\n            expect($scope.date.getDate()).toBe(24);\n        });\n\n        it('dont change date if alt key clicked', function () {\n            $scope.date = new Date('2016-08-25');\n            $scope.$digest();\n\n            var input = element.find('.display-input');\n            var altKeyCode = 18;\n            triggerKeyDown(input, altKeyCode);\n\n            expect($scope.date.getDate()).toBe(25);\n        });\n\n        it('dont change initial time', function () {\n            $scope.date = new Date('2016-08-25T12:01:00+00:00');\n            $scope.$digest();\n\n            var input = element.find('.display-input');\n            var altKeyCode = 38;\n            triggerKeyDown(input, altKeyCode);\n\n            expectUtcTime($scope.date, 12, 1, 0);\n        });\n\n        it('set current date on enter click if input is empty', function () {\n            var input = element.find('.display-input');\n            var enterKeyCode = 13;\n            triggerKeyDown(input, enterKeyCode);\n\n            expect($scope.date).toBeDefined();\n        });\n\n    });\n\n    function expectDate(el, month, day) {\n        var model = el.isolateScope().ngModel;\n        expect(model.getFullYear()).toBe(currentYear);\n        expect(model.getMonth() + 1).toBe(month);\n        expect(model.getDate()).toBe(day);\n    }\n\n    function expectUtcTime(model, hour, minute, second) {\n        expect(model.getUTCHours()).toBe(hour);\n        expect(model.getUTCMinutes()).toBe(minute);\n        expect(model.getUTCSeconds()).toBe(second);\n    }\n\n    function changeInputValue(el, value) {\n        var input = el.find('input');\n        input.val(value);\n        input.trigger($sniffer.hasEvent('input') ? 'input' : 'change');\n        input.trigger('blur');\n        $timeout.flush();\n    }\n\n});",
                "subject": "fix(datepicker): undo test",
                "message": "fix(datepicker): undo test\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "drivr/dd-ui,clickataxi/dd-ui,clickataxi/dd-ui,clickataxi/dd-ui,drivr/dd-ui,drivr/dd-ui"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10265,
            "row": {
                "commit": "1978720f20cf0976df9d803459e70105ec02b8db",
                "old_file": "js/custom-colored.js",
                "new_file": "js/custom-colored.js",
                "old_contents": "var config_tree = {\r\n        container: \"#custom-colored\",\r\n        nodeAlign: \"BOTTOM\",\r\n        connechild1rs: {\r\n            type: 'step'\r\n        },\r\n        node: {\r\n            HTMLclass: 'nodeExample1'\r\n        }\r\n    },\r\n    mainParent = {\r\n        HTMLclass: 'green',\r\n        text: {\r\n            name: \"Amit Mishra\",\r\n            contact: { \r\n            val: \"Code Coverage for S/4 HANA apps\",\r\n                href: \"https://jam4.sapjam.com/groups/xspW69TpSt2bMffMUFAnjy/documents/gDNpotIwhehoYefRuZqApY/slide_viewer\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I043155.jpg\"\r\n    },\r\n    child1 = {\r\n        parent: mainParent,\r\n        HTMLclass: 'green-top50',\r\n        text:{\r\n            name: \"Rohit Negi\",\r\n            contact: { \r\n                val: \"Fiori Launchpad (FLP)\",\r\n                href: \"https://jam4.sapjam.com/profile/4trybpJxmqo3vJj0TcUlRy/documents/X3wNojaoBzuTNSgAwew1yY\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I064952.jpg\"\r\n    },\r\n    child2 = {\r\n        parent: mainParent,\r\n        HTMLclass: 'green',\r\n        text:{\r\n            name: \"Shashank, Kulshrestha\",\r\n            contact: { \r\n                val: \"How to use HANA database as service in SCP\",\r\n                href: \"https://jam4.sapjam.com/profile/J3tnIiYdWQ5k114tkqxcK2/documents/dfh9q5awuwsbH4K1g5z5ed\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I331657.jpg\"\r\n    },\r\n    child11 = {\r\n        HTMLclass: 'green',\r\n        parent: child1,\r\n        text:{\r\n            name: \"Jayendra kartheek, Garnimetta\",\r\n            contact: { \r\n                val: \"AMD & UI5\",\r\n                href: \"https://jam4.sapjam.com/profile/bXWa3qEpS4zSs7SGA3H1VL/documents/J6F6Z1R4WIw2NkwV5Ek9lp\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I329692.jpg\"\r\n    },\r\n    child12 = {\r\n        parent: child1,\r\n        text:{\r\n            name: \"Sudhanshu, Yadav\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I330822.jpg\"\r\n    },\r\n    child21 = {\r\n        HTMLclass: 'green',\r\n        parent: child2,\r\n        text:{\r\n            name: \"Anurag\",\r\n            contact: { \r\n                val: \"Identity and Access Management\",\r\n                href: \"https://jam4.sapjam.com/blogs/show/92PBNa3NKlCcbocPkT9yeP\",\r\n                target: \"_blank\"\r\n            }\r\n            \r\n        },\r\n        image: \"./images/I311168.jpg\"\r\n    },\r\n    child22 = {\r\n        HTMLclass : \"green-top50\",\r\n        parent: child2,\r\n        text:{\r\n            name: \"Achint Kumar, Rathor\",\r\n            contact: { \r\n                val: \"Leveraging SCP services \\r\\n with our daily applications\",\r\n                href: \"https://jam4.sapjam.com/profile/fjIXTVQipnyoZzYWB0re6X/documents/AMdpgHlmuLTfqC7t2SkmjS\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I331047.jpg\"\r\n    },\r\n    child111 = {\r\n        HTMLclass: \"green\",\r\n        parent: child11,\r\n        text:{\r\n            name: \"Sreejith, Mohan Menon\",\r\n            contact: { \r\n                val: \"Developer OPS\",\r\n                href: \"https://jam4.sapjam.com/groups/xspW69TpSt2bMffMUFAnjy/documents/beBvh5cOEdEq844f3Xi7ZA/\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I043373.jpg\"\r\n    },\r\n    child112 = {\r\n        HTMLclass: 'green',\r\n        parent: child11,\r\n        text:{\r\n            name: \"Thejes, A.G\",\r\n            contact: { \r\n                val: \"Concept paper for Procure Area\",\r\n                href: \"https://jam4.sapjam.com/profile/3KQfOGbCRUwevjnRMQJy0o/documents/2V5L87b7IMZP4UrJGmSSuG\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I060438.jpg\"\r\n    },\r\n    child211 = {\r\n        HTMLclass: 'green',\r\n        parent: child21,\r\n        text:{\r\n            name: \"Sameer, Menon\",\r\n            contact: { \r\n                val: \"Documentation in Ixiasoft \\r\\n DITA CMS\",\r\n                href: \"https://jam4.sapjam.com/profile/NMjyYiTVkHl0Q8n6M5ELll/documents/dLRTFnACqdamDzRoAACVoX\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I331652.jpg\"\r\n    },\r\n    child212 = {\r\n        HTMLclass: \"green-top50\",\r\n        parent: child21,\r\n        text:{\r\n            name: \"Kriti, Srivastava\",\r\n            contact: { \r\n                val: \"How to develop an \\r\\n Analytical List Page application\",\r\n                href: \"https://jam4.sapjam.com/profile/n048yOIRaa0RuSUdLEQWBa/documents/AHRe4haPkIpwlvKTID43So\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I331382.jpg\"\r\n    },\r\n    child221 = {\r\n        HTMLclass:\"green\",\r\n        parent: child22,\r\n        text:{\r\n            name: \"Vipin,\\r\\nShivashankaran\",\r\n            contact: { \r\n                val: \"Big Data Analytical\\r\\n Models and Algorithms\",\r\n                href: \"https://jam4.sapjam.com/profile/0mxvG90hH6EBA4tznbpwLk/documents/lQKtaCtVNXv4y8O2lHKCdy\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I030005.jpg\"\r\n    },\r\n    child222 = {\r\n        parent: child22,\r\n        text:{\r\n            name: \"Kavya, Jampani\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331402.jpg\"\r\n    },\r\n\r\n    child2111 = {\r\n        HTMLclass: 'green-top50',\r\n        parent: child211,\r\n        text:{\r\n            name: \"Pramod, Indiresh\",\r\n            contact: { \r\n                val: \"S/4HANA Project Onboarding\",\r\n                href: \"https://jam4.sapjam.com/profile/3ydEu8ALXJLcGuxJ1KRqal/documents/iGIwn8uXW6PqMuSbrSCI0m\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I053023.jpg\"\r\n    },\r\n\r\n    child2112 = {\r\n        HTMLclass: \"green-top50\",\r\n        parent: child211,\r\n        text:{\r\n            name: \"Priya, Powar\",\r\n            contact: { \r\n                val: \"Steps to Implement \\r\\n non-standard UI elements \\r\\n using ABAP and extensions\",\r\n                href: \"https://jam4.sapjam.com/profile/UkXlkP7ErUirpey2LZTjoX/documents/UpdXdJr5XvLptAGBJehb88\",\r\n                target: \"_blank\"\r\n            }\r\n             \r\n        },\r\n        image: \"./images/I331407.jpg\"\r\n    },\r\n    child21111 = {\r\n        HTMLclass: \"green-bottom50\",\r\n        parent: child2111,\r\n        text:{\r\n            name: \"Abhiram, Ravikumar\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I333032.jpg\"\r\n    },\r\n    child21112 = {\r\n        parent: child2111,\r\n        text:{\r\n            name: \"Gouri, Shah\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331129.jpg\"\r\n    },\r\n\r\n    child211111 = {\r\n        HTMLclass: \"green\",\r\n        parent: child21111,\r\n        text:{\r\n            name: \"Debasish, Panda\",\r\n            contact: { \r\n                val: \"Influence of Personality \\r\\n type on a Team Player(HR)\",\r\n                href: \"https://jam4.sapjam.com/profile/6Q2XAYjsfhHWrRlk5fbOMM/documents/X07Cf0bXDgTlpODBWqPxet\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I034834.jpg\"\r\n    },\r\n    child211112 = {\r\n        parent: child21111,\r\n        text:{\r\n            name: \"Mahesh, Gopalan\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I014260.jpg\"\r\n    },\r\n    child2111121 = {\r\n        parent: child211112,\r\n        text:{\r\n            name: \"Samyak, Jain\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331420.jpg\"\r\n    },\r\n    child2111122 = {\r\n        parent: child211112,\r\n        text:{\r\n            name: \"Gagan, K\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331412.jpg\"\r\n    },\r\n    child2221 = {\r\n        parent: child222,\r\n        text:{\r\n            name: \"Sourabh, Kulkarni\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331582.jpg\"\r\n    },\r\n    child2222 = {\r\n        HTMLclass:\"green\",\r\n        parent: child222,\r\n        text:{\r\n            name: \"Vinayak Nath, Singh\",\r\n            contact: { \r\n                val: \"HTTP to ODATA Evolution\",\r\n                href: \"https://jam4.sapjam.com/profile/0jxcAAyn8yd9erj6zLqG2w/documents/nMn0x2Lt16XAHbmQUlKUXp\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I066990.jpg\"\r\n    },\r\n    child21121 = {\r\n        parent: child2112,\r\n        text:{\r\n            name: \"Kulkarni, Shruti\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331337.jpg\"\r\n    },\r\n    child21122 = {\r\n        parent: child2112,\r\n        text:{\r\n            name: \"Agarwal, Vaibhav\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I065600.jpg\"\r\n    },\r\n    child211211 = {\r\n        parent: child21121,\r\n        text:{\r\n            name: \"Shalini, Jha\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I069231.jpg\"\r\n    },\r\n    child211212 = {\r\n        parent: child21121,\r\n        text:{\r\n            name: \"Shweta, Johari\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I332758.jpg\"\r\n    },\r\n    child2121 = {\r\n        HTMLclass: \"green-top50\",\r\n        parent: child212,\r\n        text:{\r\n            name: \"Jemma, Vince\",\r\n            contact: { \r\n                val: \"Make use of \\r\\n eCATT script for creating data.\",\r\n                href: \"https://jam4.sapjam.com/profile/31zMgVfGgHFDQDO0WYu6o0/documents/u0ngCRJCYAhaMtySELJrRN\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I332721.jpg\"\r\n    },\r\n    child2122 = {\r\n        parent: child212,\r\n        text:{\r\n            name: \"Rishabh, Gour\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I330796.jpg\"\r\n    },\r\n    child21221 = {\r\n         HTMLclass: 'green',\r\n        parent: child2122,\r\n        text:{\r\n            name: \"Amitha, Srinivasan\",\r\n            contact: { \r\n                val: \"BOPF\",\r\n                href: \"https://jam4.sapjam.com/groups/xspW69TpSt2bMffMUFAnjy/documents/NjKuJ5hN3UEvNW35hFTjtG\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I304332.jpg\"\r\n    },\r\n    child212211 = {\r\n        HTMLclass: 'green',\r\n        parent: child21221,\r\n        text:{\r\n            name: \"Bhuvana, Raju\",\r\n            contact: { \r\n                val: \"Metadata Extension, \\r\\n Analytical Column Extension & \\r\\n CDS facets annotation\",\r\n                href: \"https://jam4.sapjam.com/profile/TpNxqn8bogdWpQi2V1rL2l/documents/tovMOrFIb2iu3G7T68im69\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I331594.jpg\"\r\n    },\r\n    child212212 = {\r\n        HTMLclass:\"green\",\r\n        parent: child21221,\r\n        text:{\r\n            name: \"Alik, Garai\",\r\n            contact: { \r\n                val: \"Extending Applications\",\r\n                href: \"https://jam4.sapjam.com/profile/BUEFvqDE5AbTF19Xn3JnAq/documents/oDzpsZU0Iu4DH2fkgTYPUf\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I332308.jpg\"\r\n    },\r\n    child2122121 = {\r\n        HTMLclass : \"green\",\r\n        parent: child212212,\r\n        text:{\r\n            name: \"Shivakumar\",\r\n            contact: { \r\n                val: \"How to create Analytical View\",\r\n                href: \"https://jam4.sapjam.com/profile/tapXgh0C9BmB5IJuE5yP7u/documents/B4gkrNbWoZNV33yXVQUpfm\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I329330.jpg\"\r\n    },\r\n    child2122122 = {\r\n        HTMLclass:\"green\",\r\n        parent: child212212,\r\n        text:{\r\n            name: \"Vishwarajsinh, Sodha\",\r\n            contact: { \r\n                val: \"Quality Management Process Overview\",\r\n                href: \"https://jam4.sapjam.com/profile/UpqFDTFUkrZ8v3hlbKaorF/documents/MAMA3Q5wXzEFL3Mkke6W8N\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I332723.jpg\"\r\n    },\r\n    child21222 = {\r\n        HTMLclass: \"green-top50\",\r\n        parent: child2122,\r\n        text:{\r\n            name: \"Shivani, Kandavelu\",\r\n            contact: { \r\n                val: \"creating and utilizing \\r\\n Authorisation Objects\",\r\n                href: \"https://jam4.sapjam.com/profile/UA7lQP6DfLKby0B6mWDFyO/documents/r1VhyKjnOwox1WFZWWJlZh\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I330821.jpg\"\r\n    },\r\n    child212221 = {\r\n        HTMLclass : \"green-bottom50\",\r\n        parent: child21222,\r\n        text:{\r\n            name: \"Shiv Shankar, S.S.V\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I330820.jpg\"\r\n    },\r\n    child2122211 = {\r\n        HTMLclass : \"green\",\r\n        parent: child212221,\r\n        text:{\r\n            name: \"Keerthi Abinesh, Ravikumar\",\r\n            title: \"\",\r\n            contact: { \r\n                val: \"CDS Test Double Framework\",\r\n                href: \"https://jam4.sapjam.com/profile/mlgpz7XBbZUEKOZisZypIU/documents/YgJ28mzKHV2Y4hNkRAVe0h\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I332211.jpg\"\r\n    },\r\n    child2122212 = {\r\n        parent: child21222,\r\n        text:{\r\n            name: \"Karan, Khanchandani\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331399.jpg\"\r\n    },\r\n    child212222 = {\r\n        HTMLclass:\"green-top50\",\r\n        parent: child212221,\r\n        text:{\r\n            name: \"Narendran, N.V\",\r\n            contact: { \r\n                val: \"Leveraging more of ABAP CDS\",\r\n                href: \"https://jam4.sapjam.com/profile/NZoAge5QtlhMjhizAhu2fN/documents/m94BpJ2nnnDpsMCaMZSca5\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I331181.jpg\"\r\n    },\r\n    child2122221 = {\r\n        parent: child212222,\r\n        text:{\r\n            name: \"Priyanka H, Mallesh\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I336217.jpg\"\r\n    },\r\n    child2122222 = {\r\n        parent: child212222,\r\n        text:{\r\n            name: \"Saranya, Nagabhushan\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/C5158471.jpg\"\r\n    },\r\n    child21211 = {\r\n        HTMLclass: \"green\",\r\n        parent: child2121,\r\n        text:{\r\n            name: \"Vigneshwari, Sambandan\",\r\n            contact: { \r\n                val: \"Types of navigation in FLP\",\r\n                href: \"https://jam4.sapjam.com/profile/fLIz8YDXHos2FDD0V8Nwa9/documents/eGOVJeSQozJxfxBGzIUWLs\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I332724.jpg\"\r\n    },\r\n    child21212 = {\r\n        parent: child2121,\r\n        text:{\r\n            name: \"Anagha, Ravinarayan\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331394.jpg\"\r\n    },\r\n    child212121 = {\r\n        parent: child21212,\r\n        text:{\r\n            name: \"Sindhu, Kishore\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331403.jpg\"\r\n    },\r\n    child212122 = {\r\n        HTMLclass: 'green-bottom50',\r\n        parent: child21212,\r\n        text:{\r\n            name: \"Sindhu, Janardhana\",\r\n            contact: { \r\n                val: \"Quality Assurance\",\r\n                href: \"https://jam4.sapjam.com/profile/0UMxunDTNOwnwPac26gqJG/documents/6mzxPaqt6a0gNvb5qp4LCo\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I071993.jpg\"\r\n    },\r\n    child2121221 = {\r\n        HTMLclass: 'green-top50',\r\n        parent: child212122,\r\n        text:{\r\n            name: \"Mangkhankhual, Hangshing\",\r\n            contact: { \r\n                val: \"How to design Gamification\",\r\n                href: \"https://jam4.sapjam.com/albums/K8CvJYCAXTfIzXH862ngED/photos/wGGOdGX8Qw85Aj7PcygqCn\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I329854.jpg\"\r\n    },\r\n    child21212211 = {\r\n        parent: child2121221,\r\n        text:{\r\n            name: \"Aashka, Shah\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I324332.jpg\"\r\n    },\r\n    child2121222 = {\r\n        HTMLclass : \"green\",\r\n        parent: child212122,\r\n        text:{\r\n            name: \"Preethi, Ramamourthy\",\r\n            contact: { \r\n                val: \"Authorization testing in cloud system\",\r\n                href: \"https://jam4.sapjam.com/profile/bSwvd4hgwsuneFsC91f122/documents/GtO9esUL5wruqzP2XZyITj\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I331397.jpg\"\r\n    },\r\n    child21212221 = {\r\n        HTMLclass: \"green\",\r\n        parent: child2121222,\r\n        text:{\r\n            name: \"Vighneswaran, CE\",\r\n            contact: { \r\n                val: \"Steps to Create \\r\\n UI Project Project Portal\",\r\n                href: \"https://jam4.sapjam.com/profile/2frAMd61QZnYsJWIywR6EP/documents/qrOS8S3q0oZYxtCSlYjDEH\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I049143.jpg\"\r\n    },\r\n    child21212222 = {\r\n        HTMLclass : \"green\",\r\n        parent: child2121222,\r\n        text:{\r\n            name: \"Madhu, GC\",\r\n            contact: { \r\n                val: \"CDS/SQL Performance trace and Analysis\",\r\n                href: \"https://jam4.sapjam.com/profile/6uBJuXU8M24adaMsTx5GVv/documents/noIan1Fsn3TcdWi6TwpbMj\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I049670.jpg\"\r\n    },\r\n    child2121211 = {\r\n        parent: child212121,\r\n        text:{\r\n            name: \"Sowmya, BG\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I311155.jpg\"\r\n    },\r\n    child21212111 = {\r\n        parent: child2121211,\r\n        text:{\r\n            name: \"Abhishek, P.G.\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I311001.jpg\"\r\n    },\r\n    child21212112 = {\r\n        parent: child2121211,\r\n        text:{\r\n            name: \"Nikhil, Hirve\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331388.jpg\"\r\n    },\r\n    child2121212 = {\r\n        HTMLclass:\"green-bottom50\",\r\n        parent: child212121,\r\n        text:{\r\n            name: \"Rimi, DE\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I311155.jpg\"\r\n    },\r\n    child21212121 = {\r\n        HTMLclass:\"green\",\r\n        parent: child2121212,\r\n        text:{\r\n            name: \"Pavan, Chittanpalli Vasudevan\",\r\n            contact: { \r\n                val: \"Data Protection Management System (DPMS)\",\r\n                href: \"https://jam4.sapjam.com/profile/jOhG5eKlecoc9oEAMAFmg4/documents/aC17uBdAOWM1qZj1zkKQ2C\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I032875.jpg\"\r\n    },\r\n    child212121211 = {\r\n        HTMLclass:\"green\",\r\n        parent: child21212121,\r\n        text:{\r\n            name: \"Karthik, M.K.\", \r\n            contact: { \r\n                val: \"An Overview on Digital Core, \\r\\n the need & SAP's offering\",\r\n                href: \"https://jam4.sapjam.com/profile/2a0Srzz6vfERufI8lDuVmW/documents/ydYf2hcv9lGDZ1yloULWYT\",\r\n                target: \"_blank\"\r\n            }\r\n            \r\n        },\r\n        image: \"./images/I032429.jpg\"\r\n    },\r\n    child212121212 = {\r\n        HTMLclass:\"green\",\r\n        parent: child21212121,\r\n        text:{\r\n            name: \"Shwetha Monappa, Nairy\",\r\n            contact: { \r\n                val: \"What is the best delivery model \\r\\n for a unit that works on \\r\\n Apps for Cloud \",\r\n                href: \"https://jam4.sapjam.com/profile/3oONVQywgecSNmqZmIBOyz/documents/Ewg1QYVUNu8rqqhPXXhOF6\",\r\n                target: \"_self\"\r\n            }\r\n        },\r\n        image: \"./images/I062039.jpg\"\r\n    },\r\n    child21212122 = {\r\n        HTMLclass:\"green\",\r\n        parent: child2121212,\r\n        text:{\r\n            name: \"Kanhu, Ranjan Padhi\",\r\n            contact: { \r\n                val: \"PPDS – Capacity Utilization Object Page \",\r\n                href: \"https://jam4.sapjam.com/blogs/show/0nSgm4clEwzwUmN19JC0FM\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I052877.jpg\"\r\n    },\r\n    chart_tree_config = [\r\n        config_tree,\r\n        mainParent,child1,child2,\r\n        child11,child12,\r\n        child21,child22,\r\n        child111,child112,\r\n        child211,child212,\r\n        child221,child222,\r\n        child2111,child2112,\r\n        child21111,child21112,\r\n        child211111,child211112,\r\n        child2111121,child2111122,\r\n        child2221,child2222,\r\n        child21121,child21122,\r\n        child211211,child211212,\r\n        child2121,child2122,\r\n        child21211,child21212,\r\n        child212121,child212122,\r\n        child2121221,child2121222,\r\n        child21212211,\r\n        child21212221,child21212222,\r\n        child2121211,child2121212,\r\n        child212121211,child212121212,\r\n        child21212111,child21212112,\r\n        child21212121,child21212122,\r\n        child21221,child21222,\r\n        child212211,child212212,\r\n        child2122121,child2122122,\r\n        child212221,child212222,\r\n        child2122211,child2122212,\r\n        child2122222,child2122221\r\n\r\n    ];\r\n",
                "new_contents": "var config_tree = {\r\n        container: \"#custom-colored\",\r\n        nodeAlign: \"BOTTOM\",\r\n        connechild1rs: {\r\n            type: 'step'\r\n        },\r\n        node: {\r\n            HTMLclass: 'nodeExample1'\r\n        }\r\n    },\r\n    mainParent = {\r\n        HTMLclass: 'green',\r\n        text: {\r\n            name: \"Amit Mishra\",\r\n            contact: { \r\n            val: \"Code Coverage for S/4 HANA apps\",\r\n                href: \"https://jam4.sapjam.com/groups/xspW69TpSt2bMffMUFAnjy/documents/gDNpotIwhehoYefRuZqApY/slide_viewer\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I043155.jpg\"\r\n    },\r\n    child1 = {\r\n        parent: mainParent,\r\n        HTMLclass: 'green-top50',\r\n        text:{\r\n            name: \"Rohit Negi\",\r\n            contact: { \r\n                val: \"Fiori Launchpad (FLP)\",\r\n                href: \"https://jam4.sapjam.com/profile/4trybpJxmqo3vJj0TcUlRy/documents/X3wNojaoBzuTNSgAwew1yY\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I064952.jpg\"\r\n    },\r\n    child2 = {\r\n        parent: mainParent,\r\n        HTMLclass: 'green',\r\n        text:{\r\n            name: \"Shashank, Kulshrestha\",\r\n            contact: { \r\n                val: \"How to use HANA database as service in SCP\",\r\n                href: \"https://jam4.sapjam.com/profile/J3tnIiYdWQ5k114tkqxcK2/documents/dfh9q5awuwsbH4K1g5z5ed\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I331657.jpg\"\r\n    },\r\n    child11 = {\r\n        HTMLclass: 'green',\r\n        parent: child1,\r\n        text:{\r\n            name: \"Jayendra kartheek, Garnimetta\",\r\n            contact: { \r\n                val: \"AMD & UI5\",\r\n                href: \"https://jam4.sapjam.com/profile/bXWa3qEpS4zSs7SGA3H1VL/documents/J6F6Z1R4WIw2NkwV5Ek9lp\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I329692.jpg\"\r\n    },\r\n    child12 = {\r\n        parent: child1,\r\n        text:{\r\n            name: \"Sudhanshu, Yadav\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I330822.jpg\"\r\n    },\r\n    child21 = {\r\n        HTMLclass: 'green',\r\n        parent: child2,\r\n        text:{\r\n            name: \"Anurag\",\r\n            contact: { \r\n                val: \"Identity and Access Management\",\r\n                href: \"https://jam4.sapjam.com/blogs/show/92PBNa3NKlCcbocPkT9yeP\",\r\n                target: \"_blank\"\r\n            }\r\n            \r\n        },\r\n        image: \"./images/I311168.jpg\"\r\n    },\r\n    child22 = {\r\n        HTMLclass : \"green-top50\",\r\n        parent: child2,\r\n        text:{\r\n            name: \"Achint Kumar, Rathor\",\r\n            contact: { \r\n                val: \"Leveraging SCP services \\r\\n with our daily applications\",\r\n                href: \"https://jam4.sapjam.com/profile/fjIXTVQipnyoZzYWB0re6X/documents/AMdpgHlmuLTfqC7t2SkmjS\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I331047.jpg\"\r\n    },\r\n    child111 = {\r\n        HTMLclass: \"green\",\r\n        parent: child11,\r\n        text:{\r\n            name: \"Sreejith, Mohan Menon\",\r\n            contact: { \r\n                val: \"Developer OPS\",\r\n                href: \"https://jam4.sapjam.com/groups/xspW69TpSt2bMffMUFAnjy/documents/beBvh5cOEdEq844f3Xi7ZA/\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I043373.jpg\"\r\n    },\r\n    child112 = {\r\n        HTMLclass: 'green',\r\n        parent: child11,\r\n        text:{\r\n            name: \"Thejes, A.G\",\r\n            contact: { \r\n                val: \"Concept paper for Procure Area\",\r\n                href: \"https://jam4.sapjam.com/profile/3KQfOGbCRUwevjnRMQJy0o/documents/2V5L87b7IMZP4UrJGmSSuG\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I060438.jpg\"\r\n    },\r\n    child211 = {\r\n        HTMLclass: 'green',\r\n        parent: child21,\r\n        text:{\r\n            name: \"Sameer, Menon\",\r\n            contact: { \r\n                val: \"Documentation in Ixiasoft \\r\\n DITA CMS\",\r\n                href: \"https://jam4.sapjam.com/profile/NMjyYiTVkHl0Q8n6M5ELll/documents/dLRTFnACqdamDzRoAACVoX\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I331652.jpg\"\r\n    },\r\n    child212 = {\r\n        HTMLclass: \"green-top50\",\r\n        parent: child21,\r\n        text:{\r\n            name: \"Kriti, Srivastava\",\r\n            contact: { \r\n                val: \"How to develop an \\r\\n Analytical List Page application\",\r\n                href: \"https://jam4.sapjam.com/profile/n048yOIRaa0RuSUdLEQWBa/documents/AHRe4haPkIpwlvKTID43So\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I331382.jpg\"\r\n    },\r\n    child221 = {\r\n        HTMLclass:\"green\",\r\n        parent: child22,\r\n        text:{\r\n            name: \"Vipin,\\r\\nShivashankaran\",\r\n            contact: { \r\n                val: \"Big Data Analytical\\r\\n Models and Algorithms\",\r\n                href: \"https://jam4.sapjam.com/profile/0mxvG90hH6EBA4tznbpwLk/documents/lQKtaCtVNXv4y8O2lHKCdy\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I030005.jpg\"\r\n    },\r\n    child222 = {\r\n        parent: child22,\r\n        text:{\r\n            name: \"Kavya, Jampani\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331402.jpg\"\r\n    },\r\n\r\n    child2111 = {\r\n        HTMLclass: 'green-top50',\r\n        parent: child211,\r\n        text:{\r\n            name: \"Pramod, Indiresh\",\r\n            contact: { \r\n                val: \"S/4HANA Project Onboarding\",\r\n                href: \"https://jam4.sapjam.com/profile/3ydEu8ALXJLcGuxJ1KRqal/documents/iGIwn8uXW6PqMuSbrSCI0m\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I053023.jpg\"\r\n    },\r\n\r\n    child2112 = {\r\n        HTMLclass: \"green-top50\",\r\n        parent: child211,\r\n        text:{\r\n            name: \"Priya, Powar\",\r\n            contact: { \r\n                val: \"Steps to Implement \\r\\n non-standard UI elements \\r\\n using ABAP and extensions\",\r\n                href: \"https://jam4.sapjam.com/profile/UkXlkP7ErUirpey2LZTjoX/documents/UpdXdJr5XvLptAGBJehb88\",\r\n                target: \"_blank\"\r\n            }\r\n             \r\n        },\r\n        image: \"./images/I331407.jpg\"\r\n    },\r\n    child21111 = {\r\n        HTMLclass: \"green-bottom50\",\r\n        parent: child2111,\r\n        text:{\r\n            name: \"Abhiram, Ravikumar\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I333032.jpg\"\r\n    },\r\n    child21112 = {\r\n        parent: child2111,\r\n        text:{\r\n            name: \"Gouri, Shah\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331129.jpg\"\r\n    },\r\n\r\n    child211111 = {\r\n        HTMLclass: \"green\",\r\n        parent: child21111,\r\n        text:{\r\n            name: \"Debasish, Panda\",\r\n            contact: { \r\n                val: \"Influence of Personality \\r\\n type on a Team Player(HR)\",\r\n                href: \"https://jam4.sapjam.com/profile/6Q2XAYjsfhHWrRlk5fbOMM/documents/X07Cf0bXDgTlpODBWqPxet\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I034834.jpg\"\r\n    },\r\n    child211112 = {\r\n        parent: child21111,\r\n        text:{\r\n            name: \"Mahesh, Gopalan\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I014260.jpg\"\r\n    },\r\n    child2111121 = {\r\n        parent: child211112,\r\n        text:{\r\n            name: \"Samyak, Jain\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331420.jpg\"\r\n    },\r\n    child2111122 = {\r\n        parent: child211112,\r\n        text:{\r\n            name: \"Gagan, K\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331412.jpg\"\r\n    },\r\n    child2221 = {\r\n        parent: child222,\r\n        text:{\r\n            name: \"Sourabh, Kulkarni\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331582.jpg\"\r\n    },\r\n    child2222 = {\r\n        HTMLclass:\"green\",\r\n        parent: child222,\r\n        text:{\r\n            name: \"Vinayak Nath, Singh\",\r\n            contact: { \r\n                val: \"HTTP to ODATA Evolution\",\r\n                href: \"https://jam4.sapjam.com/profile/0jxcAAyn8yd9erj6zLqG2w/documents/nMn0x2Lt16XAHbmQUlKUXp\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I066990.jpg\"\r\n    },\r\n    child21121 = {\r\n        parent: child2112,\r\n        text:{\r\n            name: \"Kulkarni, Shruti\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331337.jpg\"\r\n    },\r\n    child21122 = {\r\n        parent: child2112,\r\n        text:{\r\n            name: \"Agarwal, Vaibhav\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I065600.jpg\"\r\n    },\r\n    child211211 = {\r\n        parent: child21121,\r\n        text:{\r\n            name: \"Shalini, Jha\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I069231.jpg\"\r\n    },\r\n    child211212 = {\r\n        parent: child21121,\r\n        text:{\r\n            name: \"Shweta, Johari\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I332758.jpg\"\r\n    },\r\n    child2121 = {\r\n        HTMLclass: \"green-top50\",\r\n        parent: child212,\r\n        text:{\r\n            name: \"Jemma, Vince\",\r\n            contact: { \r\n                val: \"Make use of \\r\\n eCATT script for creating data.\",\r\n                href: \"https://jam4.sapjam.com/profile/31zMgVfGgHFDQDO0WYu6o0/documents/u0ngCRJCYAhaMtySELJrRN\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I332721.jpg\"\r\n    },\r\n    child2122 = {\r\n        parent: child212,\r\n        text:{\r\n            name: \"Rishabh, Gour\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I330796.jpg\"\r\n    },\r\n    child21221 = {\r\n         HTMLclass: 'green',\r\n        parent: child2122,\r\n        text:{\r\n            name: \"Amitha, Srinivasan\",\r\n            contact: { \r\n                val: \"Basics of BOPF and \\r\\n Steps to Create BOPF Object\",\r\n                href: \"https://jam4.sapjam.com/groups/xspW69TpSt2bMffMUFAnjy/documents/NjKuJ5hN3UEvNW35hFTjtG\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I304332.jpg\"\r\n    },\r\n    child212211 = {\r\n        HTMLclass: 'green',\r\n        parent: child21221,\r\n        text:{\r\n            name: \"Bhuvana, Raju\",\r\n            contact: { \r\n                val: \"Metadata Extension, \\r\\n Analytical Column Extension & \\r\\n CDS facets annotation\",\r\n                href: \"https://jam4.sapjam.com/profile/TpNxqn8bogdWpQi2V1rL2l/documents/tovMOrFIb2iu3G7T68im69\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I331594.jpg\"\r\n    },\r\n    child212212 = {\r\n        HTMLclass:\"green\",\r\n        parent: child21221,\r\n        text:{\r\n            name: \"Alik, Garai\",\r\n            contact: { \r\n                val: \"Extending Applications\",\r\n                href: \"https://jam4.sapjam.com/profile/BUEFvqDE5AbTF19Xn3JnAq/documents/oDzpsZU0Iu4DH2fkgTYPUf\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I332308.jpg\"\r\n    },\r\n    child2122121 = {\r\n        HTMLclass : \"green\",\r\n        parent: child212212,\r\n        text:{\r\n            name: \"Shivakumar\",\r\n            contact: { \r\n                val: \"How to create Analytical View\",\r\n                href: \"https://jam4.sapjam.com/profile/tapXgh0C9BmB5IJuE5yP7u/documents/B4gkrNbWoZNV33yXVQUpfm\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I329330.jpg\"\r\n    },\r\n    child2122122 = {\r\n        HTMLclass:\"green\",\r\n        parent: child212212,\r\n        text:{\r\n            name: \"Vishwarajsinh, Sodha\",\r\n            contact: { \r\n                val: \"Quality Management Process Overview\",\r\n                href: \"https://jam4.sapjam.com/profile/UpqFDTFUkrZ8v3hlbKaorF/documents/MAMA3Q5wXzEFL3Mkke6W8N\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I332723.jpg\"\r\n    },\r\n    child21222 = {\r\n        HTMLclass: \"green-top50\",\r\n        parent: child2122,\r\n        text:{\r\n            name: \"Shivani, Kandavelu\",\r\n            contact: { \r\n                val: \"creating and utilizing \\r\\n Authorisation Objects\",\r\n                href: \"https://jam4.sapjam.com/profile/UA7lQP6DfLKby0B6mWDFyO/documents/r1VhyKjnOwox1WFZWWJlZh\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I330821.jpg\"\r\n    },\r\n    child212221 = {\r\n        HTMLclass : \"green-bottom50\",\r\n        parent: child21222,\r\n        text:{\r\n            name: \"Shiv Shankar, S.S.V\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I330820.jpg\"\r\n    },\r\n    child2122211 = {\r\n        HTMLclass : \"green\",\r\n        parent: child212221,\r\n        text:{\r\n            name: \"Keerthi Abinesh, Ravikumar\",\r\n            title: \"\",\r\n            contact: { \r\n                val: \"CDS Test Double Framework\",\r\n                href: \"https://jam4.sapjam.com/profile/mlgpz7XBbZUEKOZisZypIU/documents/YgJ28mzKHV2Y4hNkRAVe0h\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I332211.jpg\"\r\n    },\r\n    child2122212 = {\r\n        parent: child21222,\r\n        text:{\r\n            name: \"Karan, Khanchandani\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331399.jpg\"\r\n    },\r\n    child212222 = {\r\n        HTMLclass:\"green-top50\",\r\n        parent: child212221,\r\n        text:{\r\n            name: \"Narendran, N.V\",\r\n            contact: { \r\n                val: \"Leveraging more of ABAP CDS\",\r\n                href: \"https://jam4.sapjam.com/profile/NZoAge5QtlhMjhizAhu2fN/documents/m94BpJ2nnnDpsMCaMZSca5\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I331181.jpg\"\r\n    },\r\n    child2122221 = {\r\n        parent: child212222,\r\n        text:{\r\n            name: \"Priyanka H, Mallesh\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I336217.jpg\"\r\n    },\r\n    child2122222 = {\r\n        parent: child212222,\r\n        text:{\r\n            name: \"Saranya, Nagabhushan\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/C5158471.jpg\"\r\n    },\r\n    child21211 = {\r\n        HTMLclass: \"green\",\r\n        parent: child2121,\r\n        text:{\r\n            name: \"Vigneshwari, Sambandan\",\r\n            contact: { \r\n                val: \"Types of navigation in FLP\",\r\n                href: \"https://jam4.sapjam.com/profile/fLIz8YDXHos2FDD0V8Nwa9/documents/eGOVJeSQozJxfxBGzIUWLs\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I332724.jpg\"\r\n    },\r\n    child21212 = {\r\n        parent: child2121,\r\n        text:{\r\n            name: \"Anagha, Ravinarayan\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331394.jpg\"\r\n    },\r\n    child212121 = {\r\n        parent: child21212,\r\n        text:{\r\n            name: \"Sindhu, Kishore\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331403.jpg\"\r\n    },\r\n    child212122 = {\r\n        HTMLclass: 'green-bottom50',\r\n        parent: child21212,\r\n        text:{\r\n            name: \"Sindhu, Janardhana\",\r\n            contact: { \r\n                val: \"Quality Assurance\",\r\n                href: \"https://jam4.sapjam.com/profile/0UMxunDTNOwnwPac26gqJG/documents/6mzxPaqt6a0gNvb5qp4LCo\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I071993.jpg\"\r\n    },\r\n    child2121221 = {\r\n        HTMLclass: 'green-top50',\r\n        parent: child212122,\r\n        text:{\r\n            name: \"Mangkhankhual, Hangshing\",\r\n            contact: { \r\n                val: \"How to design Gamification\",\r\n                href: \"https://jam4.sapjam.com/albums/K8CvJYCAXTfIzXH862ngED/photos/wGGOdGX8Qw85Aj7PcygqCn\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I329854.jpg\"\r\n    },\r\n    child21212211 = {\r\n        parent: child2121221,\r\n        text:{\r\n            name: \"Aashka, Shah\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I324332.jpg\"\r\n    },\r\n    child2121222 = {\r\n        HTMLclass : \"green\",\r\n        parent: child212122,\r\n        text:{\r\n            name: \"Preethi, Ramamourthy\",\r\n            contact: { \r\n                val: \"Authorization testing in cloud system\",\r\n                href: \"https://jam4.sapjam.com/profile/bSwvd4hgwsuneFsC91f122/documents/GtO9esUL5wruqzP2XZyITj\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I331397.jpg\"\r\n    },\r\n    child21212221 = {\r\n        HTMLclass: \"green\",\r\n        parent: child2121222,\r\n        text:{\r\n            name: \"Vighneswaran, CE\",\r\n            contact: { \r\n                val: \"Steps to Create \\r\\n UI Project Project Portal\",\r\n                href: \"https://jam4.sapjam.com/profile/2frAMd61QZnYsJWIywR6EP/documents/qrOS8S3q0oZYxtCSlYjDEH\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I049143.jpg\"\r\n    },\r\n    child21212222 = {\r\n        HTMLclass : \"green\",\r\n        parent: child2121222,\r\n        text:{\r\n            name: \"Madhu, GC\",\r\n            contact: { \r\n                val: \"CDS/SQL Performance trace and Analysis\",\r\n                href: \"https://jam4.sapjam.com/profile/6uBJuXU8M24adaMsTx5GVv/documents/noIan1Fsn3TcdWi6TwpbMj\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I049670.jpg\"\r\n    },\r\n    child2121211 = {\r\n        parent: child212121,\r\n        text:{\r\n            name: \"Sowmya, BG\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I311155.jpg\"\r\n    },\r\n    child21212111 = {\r\n        parent: child2121211,\r\n        text:{\r\n            name: \"Abhishek, P.G.\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I311001.jpg\"\r\n    },\r\n    child21212112 = {\r\n        parent: child2121211,\r\n        text:{\r\n            name: \"Nikhil, Hirve\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I331388.jpg\"\r\n    },\r\n    child2121212 = {\r\n        HTMLclass:\"green-bottom50\",\r\n        parent: child212121,\r\n        text:{\r\n            name: \"Rimi, DE\",\r\n            title: \"Started Writing Blog\"\r\n        },\r\n        image: \"./images/I311155.jpg\"\r\n    },\r\n    child21212121 = {\r\n        HTMLclass:\"green\",\r\n        parent: child2121212,\r\n        text:{\r\n            name: \"Pavan, Chittanpalli Vasudevan\",\r\n            contact: { \r\n                val: \"Data Protection Management System (DPMS)\",\r\n                href: \"https://jam4.sapjam.com/profile/jOhG5eKlecoc9oEAMAFmg4/documents/aC17uBdAOWM1qZj1zkKQ2C\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I032875.jpg\"\r\n    },\r\n    child212121211 = {\r\n        HTMLclass:\"green\",\r\n        parent: child21212121,\r\n        text:{\r\n            name: \"Karthik, M.K.\", \r\n            contact: { \r\n                val: \"An Overview on Digital Core, \\r\\n the need & SAP's offering\",\r\n                href: \"https://jam4.sapjam.com/profile/2a0Srzz6vfERufI8lDuVmW/documents/ydYf2hcv9lGDZ1yloULWYT\",\r\n                target: \"_blank\"\r\n            }\r\n            \r\n        },\r\n        image: \"./images/I032429.jpg\"\r\n    },\r\n    child212121212 = {\r\n        HTMLclass:\"green\",\r\n        parent: child21212121,\r\n        text:{\r\n            name: \"Shwetha Monappa, Nairy\",\r\n            contact: { \r\n                val: \"What is the best delivery model \\r\\n for a unit that works on \\r\\n Apps for Cloud \",\r\n                href: \"https://jam4.sapjam.com/profile/3oONVQywgecSNmqZmIBOyz/documents/Ewg1QYVUNu8rqqhPXXhOF6\",\r\n                target: \"_self\"\r\n            }\r\n        },\r\n        image: \"./images/I062039.jpg\"\r\n    },\r\n    child21212122 = {\r\n        HTMLclass:\"green\",\r\n        parent: child2121212,\r\n        text:{\r\n            name: \"Kanhu, Ranjan Padhi\",\r\n            contact: { \r\n                val: \"PPDS – Capacity Utilization Object Page \",\r\n                href: \"https://jam4.sapjam.com/blogs/show/0nSgm4clEwzwUmN19JC0FM\",\r\n                target: \"_blank\"\r\n            }\r\n        },\r\n        image: \"./images/I052877.jpg\"\r\n    },\r\n    chart_tree_config = [\r\n        config_tree,\r\n        mainParent,child1,child2,\r\n        child11,child12,\r\n        child21,child22,\r\n        child111,child112,\r\n        child211,child212,\r\n        child221,child222,\r\n        child2111,child2112,\r\n        child21111,child21112,\r\n        child211111,child211112,\r\n        child2111121,child2111122,\r\n        child2221,child2222,\r\n        child21121,child21122,\r\n        child211211,child211212,\r\n        child2121,child2122,\r\n        child21211,child21212,\r\n        child212121,child212122,\r\n        child2121221,child2121222,\r\n        child21212211,\r\n        child21212221,child21212222,\r\n        child2121211,child2121212,\r\n        child212121211,child212121212,\r\n        child21212111,child21212112,\r\n        child21212121,child21212122,\r\n        child21221,child21222,\r\n        child212211,child212212,\r\n        child2122121,child2122122,\r\n        child212221,child212222,\r\n        child2122211,child2122212,\r\n        child2122222,child2122221\r\n\r\n    ];\r\n",
                "subject": "Update custom-colored.js",
                "message": "Update custom-colored.js",
                "lang": "JavaScript",
                "license": "unlicense",
                "repos": "openfxdc/blogchallenge,openfxdc/blogchallenge"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10266,
            "row": {
                "commit": "7338145ca6b456354c21653ed4a6bc64185993dd",
                "old_file": "js/dd-colorpicker.js",
                "new_file": "js/dd-colorpicker.js",
                "old_contents": "/* global d3 */\n/* exported DDColorPicker*/\nfunction DDColorPicker(method,value){\n\t'use strict';\n\n\tthis.settings = {\n\t\theight: 420,\n\t\twidth: 820,\n\t\trows: 35,\n\t\tmargin: 20,\n\t};\n\n\tthis.extend = function(dst, src){\n\t\tfor (var attrname in src) { dst[attrname] = src[attrname]; }\n\t};\n\n\tthis.enterRect = function(rect){\n\t\trect.enter().append(\"rect\");\n\t};\n\n\tthis.updateRect = function(rectangle){\n\t\tvar $this = this;\n\t\trectangle\n\t\t\t.style(\"fill\", function(data){return d3.rgb(data.rgb[0],data.rgb[1],data.rgb[2]);})\n\t\t    .attr(\"x\", function(d,index){return (Math.floor(index/$this.settings.rows) * $this.settings.colWidth) + $this.settings.margin; })\n\t\t\t.attr(\"y\", function(d,index){return ( (index % $this.settings.rows) * $this.settings.rowHeight) + $this.settings.margin; })\n\t\t\t.style('stroke-width',function(d){return (d.selected === undefined | d.selected === false) ? '0' : '1';})\n\t\t\t.style('stroke',d3.rgb(0,0,0))\n\t\t\t.attr(\"width\", this.settings.colWidth)\n\t\t    .attr(\"height\", this.settings.rowHeight);\t\n\t};\n\t\t\n\tthis.ResetGrid = function(){\n\n\t\tthis.settings.cols = Math.ceil(this.settings.data.length / this.settings.rows);\n\t\tthis.settings.rowHeight = (this.settings.height - this.settings.margin*2) / this.settings.rows;\n\t\tthis.settings.colWidth = (this.settings.width - this.settings.margin * 2) / this.settings.cols;\n\t\tconsole.log('setting up a grid of ' + this.settings.rows + ' rows and ' + this.settings.cols + ' cols');\n\t\tconsole.dir(this.settings);\n\t};\n\t//constructor pattern from http://stackoverflow.com/questions/1114024/constructors-in-javascript-objects\n\t(function(that, settings){\n\t\tthat.extend(that.settings, settings);\n\t\tthat.ResetGrid();\n\n\t\tvar nA = that.settings.data;\n\n\t\tvar $ddColorPicker = that;\n\n\t\tthat.svg = d3.select(that.settings.elem)\n\t\t\t.append(\"svg\")\n\t\t\t.attr('width',that.settings.width)\n\t\t\t.attr('height',that.settings.height);\n\t\t\n\t\tthat.g = that.svg.append(\"g\");\n\t\t\n\t\t\n\t\tvar rect = that.g.selectAll(\"rect\")\n\t\t\t.data(nA);\n\t\t\n\t\t// Enter…\n\t\tthat.enterRect(rect);\n\n\t\t// Update..\n\t\tthat.updateRect(rect);\n\n\t\t// Exit…\n\t\trect.exit().remove();\n\t\t\n\t\trect.on('mouseover',function(){\n\t\t\t\n\t\t\tvar data = d3.select(this).data();\n\n\t\t\t//Update the color name text\n\t\t\tvar text = $ddColorPicker.svg.selectAll(\"#colorNameText\")\n\t\t\t\t.data(data)\n\t\t\t\t.text(function(d){return d.fullname;})\n\t\t\t\t.attr('fill',function(d){return d.Lab[0] > 50 ? d3.rgb(4,4,4) : d3.rgb(251,251,251);});\n\n\t\t\t//Create the text element\n\t\t\ttext\n\t\t\t\t.enter()\n\t\t\t\t.append('text')\n\t\t\t\t.attr('id', \"colorNameText\")\n\t\t\t\t.attr('x',that.settings.width - that.settings.margin)\n\t\t\t\t.attr('y',15)\n\t\t\t\t.attr(\"font-size\", \"10px\")\n\t\t\t\t.attr('text-anchor','end');\n\n\t\t\t//Update the background\n\t\t\tvar div = $ddColorPicker.svg.selectAll('#colorSelected').data(data);\n\n\t\t\t//Create the background\n\t\t\tdiv.enter()\n\t\t\t\t.insert('rect',':first-child')\n\t\t\t\t.attr('id','colorSelected')\n\t\t\t\t.attr('height',that.settings.height)\n\t\t\t\t.attr('width',that.settings.width);\n\n\t\t\tdiv\n\t\t\t\t.transition()\n\t\t\t\t.style('fill',function(d){return d3.rgb(d.rgb[0],d.rgb[1],d.rgb[2]);});\n\n\t\t\tif ($ddColorPicker.settings.onHoverChanged !== undefined){\n\t\t\t\t$ddColorPicker.settings.onHoverChanged(data[0]);\n\t\t\t}\n\t\t\t\n\t\t});\n\t\t\n\n\t\trect.on('click',function(d){\n\t\t\t\n\t\t\td.selected = d.selected === undefined ? true : !d.selected;\n\t\t\t$ddColorPicker.updateRect(rect);\n\t\t\td3.event.stopPropagation();\n\t\t\tif ($ddColorPicker.settings.onSelectedChanged !== undefined){\n\t\t\t\t$ddColorPicker.settings.onSelectedChanged($ddColorPicker.selectedData());\n\t\t\t}\n\t\t});\n\n\t\tthat.svg.on('click',function(){\n\t\t\td3.event.stopPropagation();\n\t\t})\n\t\t\n\t}(this,method));\n\n\tthis.selectedData = function(){\n\t\treturn this.settings.data.filter(function(item){return item.selected; });\n\t};\n\n\tthis.setRows = function(value){\n\t\tthis.settings.rows = value;\n\t\tthis.ResetGrid();\n\t\tvar rect = this.g.selectAll(\"rect\");\n\t\tthis.updateRect(rect);\n\t}\n\t//execute calles method\n\t\n\tif(typeof(method) === \"string\"){\n\t this[method](value);\n\t}\n}\n",
                "new_contents": "/* global d3 */\n/* exported DDColorPicker*/\nfunction DDColorPicker(method,value){\n\t'use strict';\n\n\tthis.settings = {\n\t\theight: 420,\n\t\twidth: 820,\n\t\trows: 35,\n\t\tmargin: 20,\n\t};\n\n\tthis.extend = function(dst, src){\n\t\tfor (var attrname in src) { dst[attrname] = src[attrname]; }\n\t};\n\n\tthis.enterRect = function(rect){\n\t\trect.enter().append(\"rect\");\n\t};\n\n\tthis.updateRect = function(rectangle){\n\t\tvar $this = this;\n\t\trectangle\n\t\t\t.style(\"fill\", function(data){return d3.rgb(data.rgb[0],data.rgb[1],data.rgb[2]);})\n\t\t    .attr(\"x\", function(d,index){return (Math.floor(index/$this.settings.rows) * $this.settings.colWidth) + $this.settings.margin; })\n\t\t\t.attr(\"y\", function(d,index){return ( (index % $this.settings.rows) * $this.settings.rowHeight) + $this.settings.margin; })\n\t\t\t.style('stroke-width',function(d){return (d.selected === undefined | d.selected === false) ? '0' : '1';})\n\t\t\t.style('stroke',d3.rgb(0,0,0))\n\t\t\t.attr(\"width\", this.settings.colWidth)\n\t\t    .attr(\"height\", this.settings.rowHeight);\t\n\t};\n\t\t\n\tthis.ResetGrid = function(){\n\n\t\tthis.settings.cols = Math.ceil(this.settings.data.length / this.settings.rows);\n\t\tthis.settings.rowHeight = (this.settings.height - this.settings.margin*2) / this.settings.rows;\n\t\tthis.settings.colWidth = (this.settings.width - this.settings.margin * 2) / this.settings.cols;\n\t\tthis.svg.attr('width',this.settings.width)\n\t\t\t.attr('height',this.settings.height)\n\t};\n\t//constructor pattern from http://stackoverflow.com/questions/1114024/constructors-in-javascript-objects\n\t(function(that, settings){\n\t\tthat.extend(that.settings, settings);\n\t\t\n\t\tthat.svg = d3.select(that.settings.elem)\n\t\t\t.append(\"svg\");\n\t\t\n\t\tthat.ResetGrid();\n\n\t\tvar nA = that.settings.data;\n\n\t\tvar $ddColorPicker = that;\n\n\t\t\n\t\tthat.g = that.svg.append(\"g\");\n\t\t\n\t\t\n\t\tvar rect = that.g.selectAll(\"rect\")\n\t\t\t.data(nA);\n\t\t\n\t\t// Enter…\n\t\tthat.enterRect(rect);\n\n\t\t// Update..\n\t\tthat.updateRect(rect);\n\n\t\t// Exit…\n\t\trect.exit().remove();\n\t\t\n\t\trect.on('mouseover',function(){\n\t\t\t\n\t\t\tvar data = d3.select(this).data();\n\n\t\t\t//Update the color name text\n\t\t\tvar text = $ddColorPicker.svg.selectAll(\"#colorNameText\")\n\t\t\t\t.data(data)\n\t\t\t\t.text(function(d){return d.fullname;})\n\t\t\t\t.attr('fill',function(d){return d.Lab[0] > 50 ? d3.rgb(4,4,4) : d3.rgb(251,251,251);});\n\n\t\t\t//Create the text element\n\t\t\ttext\n\t\t\t\t.enter()\n\t\t\t\t.append('text')\n\t\t\t\t.attr('id', \"colorNameText\")\n\t\t\t\t.attr('x',that.settings.width - that.settings.margin)\n\t\t\t\t.attr('y',15)\n\t\t\t\t.attr(\"font-size\", \"10px\")\n\t\t\t\t.attr('text-anchor','end');\n\n\t\t\t//Update the background\n\t\t\tvar div = $ddColorPicker.svg.selectAll('#colorSelected').data(data);\n\n\t\t\t//Create the background\n\t\t\tdiv.enter()\n\t\t\t\t.insert('rect',':first-child')\n\t\t\t\t.attr('id','colorSelected')\n\t\t\t\t.attr('height',that.settings.height)\n\t\t\t\t.attr('width',that.settings.width);\n\n\t\t\tdiv\n\t\t\t\t.transition()\n\t\t\t\t.style('fill',function(d){return d3.rgb(d.rgb[0],d.rgb[1],d.rgb[2]);});\n\n\t\t\tif ($ddColorPicker.settings.onHoverChanged !== undefined){\n\t\t\t\t$ddColorPicker.settings.onHoverChanged(data[0]);\n\t\t\t}\n\t\t\t\n\t\t});\n\t\t\n\n\t\trect.on('click',function(d){\n\t\t\t\n\t\t\td.selected = d.selected === undefined ? true : !d.selected;\n\t\t\t$ddColorPicker.updateRect(rect);\n\t\t\td3.event.stopPropagation();\n\t\t\tif ($ddColorPicker.settings.onSelectedChanged !== undefined){\n\t\t\t\t$ddColorPicker.settings.onSelectedChanged($ddColorPicker.selectedData());\n\t\t\t}\n\t\t});\n\n\t\tthat.svg.on('click',function(){\n\t\t\td3.event.stopPropagation();\n\t\t})\n\t\t\n\t}(this,method));\n\n\tthis.selectedData = function(){\n\t\treturn this.settings.data.filter(function(item){return item.selected; });\n\t};\n\n\tthis.setSetting = function(setting, value){\n\t\tthis.settings[setting] = value;\n\t\tthis.ResetGrid();\n\t\tvar rect = this.g.selectAll(\"rect\");\n\t\tthis.updateRect(rect);\n\t}\n\n\tthis.setRows = function(value){\n\t\tthis.setSetting('rows',value);\n\t}\n\n\tthis.setHeight = function(value){\n\t\tthis.setSetting('height',value);\n\t}\n\n\tthis.setWidth = function(value){\n\t\tthis.setSetting('width',value);\n\t}\n\n\t//execute called method\n\t\n\tif(typeof(method) === \"string\"){\n\t this[method](value);\n\t}\n}\n",
                "subject": "Refactored setRows; added setWidth and setHeight",
                "message": "Refactored setRows; added setWidth and setHeight\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "DavideMontersino/DD-ColorPicker"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10267,
            "row": {
                "commit": "3ea273305e5d6e896f556a6fc3a8c5ce75e15d4a",
                "old_file": "client/js/ld/LDDirectives.js",
                "new_file": "client/js/ld/LDDirectives.js",
                "old_contents": "'use strict';\n\n/*\n* Angular Directive References:\n*   http://www.codeproject.com/Articles/607873/Extending-HTML-with-AngularJS-Directives\n*   http://jsfiddle.net/Wijmo/LyJ2T/\n*/\n\nangular.module('ledita-app')\n.directive('activitydetail', [function() {\n    return {\n        restrict: 'E',\n        scope: { \n            showped: \"@\", \n            node: '=' \n        },\n        template:\n            \"<span> \" +\n            \"<p class='tabText'> \" +\n            \"    <i class='icon-home'></i> Modality: <span class='nodeBodyText'>{{ node.modality }}</span> \" +\n            \"</p> \" +\n            \"<p class='tabText'> \" +\n            \"    <i class='icon-time'></i> Duration: <span class='nodeBodyText'>{{ node | durationDisplay }}</span> \" +\n            \"</p> \" +\n            \"<p class='tabText'><i class='icon-th-large'></i> Students' organization: \" +\n            \"    <span class='nodeBodyText'>{{ node.org_label }}</span> \" +\n            \"</p> \" +\n            \"<p class='tabText' ng-show='node.technologies'><i class='icon-facetime-video'></i> Used Technologies: \" +\n            \"    <span ng-repeat='tech in node.technologies' class='nodeBodyText border'>{{ tech.technology_name }}</span> \" +\n            \"</p> \" +\n            \"<p class='tabText' ng-show='node.resources'><i class='icon-briefcase'></i> Didactical Resources: \" +\n            \"    <ul ng-repeat='resource in node.resources' class='listNode'> \" +\n            \"        <li><i class='icon-chevron-right'></i> \" +\n            \"            Name: <span class='nodeBodyText'>{{ resource.resource_name }}</span> \" +\n            \"            | Type:<span class='nodeBodyText'>{{ resource.resource_type }}</span><span ng-show='resource.resource_copy'> | \" +\n            \"            Copyright: <span \" +\n            \"                class='nodeBodyText'>{{ resource.resource_copy }}</span></span><span ng-show='resource.resource_descr'> | Description: <span \" +\n            \"                class='nodeBodyText'>{{ resource.resource_descr }}</span></span><span ng-show='resource.resource_link'> | <span \" +\n            \"                class='nodeBodyText'><a ng-href='{{ resource.resource_link }}' target='_blank'>Link</a></span></span> \" +\n            \"        </li> \" +\n            \"    </ul> \" +\n            \"</p> \" +\n            \"<p class='tabText' ng-show='node.pract_descr'><i class='icon-info-sign'></i> Activity Description:<br> \" +\n            \"    <span class='nodeBodyText'>{{ node.pract_descr }}</span> \" +\n            \"</p> \" +\n            \"<span ng-show='showped' ><p class='tabText' ng-show='node.edu_descr'><i class='icon-question-sign'></i> Pedagogical Suggestions:<br> \" +\n            \"    <span class='nodeBodyText'>{{ node.edu_descr }}</span></p></span> \" +\n            \"</span>\",\n        replace: true,        \n        transclude: false,    \n        link: function(scope, element, attrs) {\n        }\n    };\n}]);\n\nangular.module('ledita-app')\n.directive('lddetail', [function() {\n    return {\n        restrict: 'E',\n        scope: { \n            node: '=' \n        },\n        template:\n            \"<span> \" +\n            \"<p class='tabText'> \" +\n            \"    <i class='icon-time'></i> \" +\n            \"     Scope: <span class='nodeBodyText'>{{ node.scope }}</span> \" +\n            \"</p> \" +\n            \"<p class='tabText' ng-show='node.qcers'><i class='icon-flag' ></i> \" +\n            \"    Language Level: <span ng-repeat='qcer in node.qcers' class='nodeBodyText'>{{ qcer.qcer_name }}</span> \" +\n            \"</p> \" +\n            \"<p class='tabText'><i class='icon-share'></i> \" +\n            \"    <span class='nodeBodyText'> <a ng-href='#'>Link</a></span> \" +\n            \"</p> \" +\n            \"</span>\",\n        replace: true,        \n        transclude: false,    \n        link: function(scope, element, attrs) {\n        }\n    };\n}]);",
                "new_contents": "'use strict';\n\n/*\n* Angular Directive References:\n*   http://www.codeproject.com/Articles/607873/Extending-HTML-with-AngularJS-Directives\n*   http://jsfiddle.net/Wijmo/LyJ2T/\n*/\n\nangular.module('ledita-app')\n.directive('activitydetail', [function() {\n    return {\n        restrict: 'E',\n        scope: { \n            showped: \"@\", \n            node: '=' \n        },\n        template:\n            \"<span> \" +\n            \"<p class='tabText'> \" +\n            \"    <i class='icon-home'></i> Modality: <span class='nodeBodyText'>{{ node.modality }}</span> \" +\n            \"</p> \" +\n            \"<p class='tabText'> \" +\n            \"    <i class='icon-time'></i> Duration: <span class='nodeBodyText'>{{ node | durationDisplay }}</span> \" +\n            \"</p> \" +\n            \"<p class='tabText'><i class='icon-th-large'></i> Students' organization: \" +\n            \"    <span class='nodeBodyText'>{{ node.org_label }}</span> \" +\n            \"</p> \" +\n            \"<p class='tabText' ng-show='node.technologies'><i class='icon-facetime-video'></i> Used Technologies: \" +\n            \"    <span ng-repeat='tech in node.technologies' class='nodeBodyText border'>{{ tech.technology_name }}</span> \" +\n            \"</p> \" +\n            \"<p class='tabText' ng-show='node.resources'><i class='icon-briefcase'></i> Didactical Resources: \" +\n            \"    <ul ng-repeat='resource in node.resources' class='listNode'> \" +\n            \"        <li><i class='icon-chevron-right'></i> \" +\n            \"            Name: <span class='nodeBodyText'>{{ resource.resource_name }}</span> \" +\n            \"            | Type:<span class='nodeBodyText'>{{ resource.resource_type }}</span><span ng-show='resource.resource_copy'> | \" +\n            \"            Copyright: <span \" +\n            \"                class='nodeBodyText'>{{ resource.resource_copy }}</span></span><span ng-show='resource.resource_descr'> | Description: <span \" +\n            \"                class='nodeBodyText'>{{ resource.resource_descr }}</span></span><span ng-show='resource.resource_link'> | <span \" +\n            \"                class='nodeBodyText'><a ng-href='{{ resource.resource_link }}' target='_blank'>Link</a></span></span> \" +\n            \"        </li> \" +\n            \"    </ul> \" +\n            \"</p> \" +\n            \"<p class='tabText' ng-show='node.pract_descr'><i class='icon-info-sign'></i> Activity Description:<br> \" +\n            \"    <span class='nodeBodyText'>{{ node.pract_descr }}</span> \" +\n            \"</p> \" +\n            \"<span ng-show='showped' ><p class='tabText' ng-show='node.edu_descr'><i class='icon-question-sign'></i> Pedagogical Suggestions:<br> \" +\n            \"    <span class='nodeBodyText'>{{ node.edu_descr }}</span></p></span> \" +\n            \"</span>\",\n        replace: true,        \n        transclude: false,    \n        link: function(scope, element, attrs) {\n        }\n    };\n}]);\n\nangular.module('ledita-app')\n.directive('lddetail', [function() {\n    return {\n        restrict: 'E',\n        scope: { \n            node: '=' \n        },\n        template:\n            \"<span> \" +\n            \"<p class='tabText'> \" +\n            \"    <i class='icon-time'></i> \" +\n            \"     Scope: <span class='nodeBodyText'>{{ node.scope }}</span> \" +\n            \"</p> \" +\n            \"<p class='tabText' ng-show='node.qcers'><i class='icon-flag' ></i> \" +\n            \"    Language Level: <span ng-repeat='qcer in node.qcers' class='nodeBodyText'>{{ qcer.qcer_name }}</span> \" +\n            \"</p> \" +\n            \"<p class='tabText'><i class='icon-share'></i> \" +\n            \"    <span class='nodeBodyText'> <a ng-href='/ld/{{ node.node_id }}{{ node.group_child_id }}'>Link</a></span> \" +\n            \"</p> \" +\n            \"</span>\",\n        replace: true,        \n        transclude: false,    \n        link: function(scope, element, attrs) {\n        }\n    };\n}]);",
                "subject": "dynamic LD links in teacher and student tabs",
                "message": "dynamic LD links in teacher and student tabs\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "arpetti/LEDITA,arpetti/LEDITA"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10268,
            "row": {
                "commit": "525f51f562665fb2a4a45f6f58182043eb059411",
                "old_file": "client/lib/adaptors/qunit.js",
                "new_file": "client/lib/adaptors/qunit.js",
                "old_contents": "// if registerModule is defined call that. if not then check if this this has\r\n// been loaded as a node.js module and the code can execute right away.\r\n(typeof registerModule=='function' ? registerModule : function (fn){fn(module, require);}).call(this, function (module, require){\r\n\tvar exports=module.exports;\r\n\t\t\r\nvar isNodeJS = !(typeof window=='object'),\r\n\tglobalScope=function() {return this;}.call();\r\n\r\n/**\r\n * This code intercepts calls to the QUnit testing library to allow tests written for that library to run in BrowserDriver.\r\n */\r\n\r\nexports.initialize=function (){\r\n\t\r\n\tvar extend, sendMessage, onMessage;\r\n\t\r\n\tglobalScope.__adaptor__={\r\n\t\ttestCfg:{},\r\n\t\tstorage:{},\r\n\t\trequireLib:function (src, cb){\r\n\t\t\tvar sep=isNodeJS ? require('path').sep:'';\r\n\t\t\tif(src instanceof Array){\r\n\t\t\t\tfor(var i=0; i<src.length; i++)\r\n\t\t\t\t\tsrc[i]=(isNodeJS ? this.testCfg.clientBaseDir+sep+'lib'+sep : this.testCfg.serverUrl+'/lib/')+src[i];\r\n\t\t\t}else\r\n\t\t\t\tsrc=(isNodeJS ? this.testCfg.clientBaseDir+sep+'lib'+sep : this.testCfg.serverUrl+'/lib/')+src;\r\n\t\t\treturn require(src, cb);\r\n\t\t},\r\n\t\trequireCustomLib:function (src, cb){\r\n\t\t\tvar sep=isNodeJS ? require('path').sep:'';\r\n\t\t\tif(src instanceof Array){\r\n\t\t\t\tfor(var i=0; i<src.length; i++)\r\n\t\t\t\t\tsrc[i]=(isNodeJS ? this.testCfg.userLibsDir+require('path').sep : this.testCfg.serverUrl+this.testCfg.userLibsUrl+'/')+src[i];\r\n\t\t\t}else\r\n\t\t\t\tsrc=(isNodeJS ? this.testCfg.userLibsDir+require('path').sep : this.testCfg.serverUrl+this.testCfg.userLibsUrl+'/')+src;\r\n\t\t\treturn require(src, cb);\r\n\t\t},\r\n\t\trequire:function (src, cb){\r\n\t\t\treturn require(src, cb);\r\n\t\t},\r\n\t\tattachScript:attachScript,\r\n\t\tattachStylesheet:function (src, cb, doc){\r\n\t\t\tif(!doc)\r\n\t\t\t\tdoc=document;\r\n\t\t\tvar link=doc.createElement('link'),\r\n\t\t\t\thead=doc.getElementsByTagName('head')[0];\r\n\r\n//\t\t\tsrc = driver.storage.socketIOServerLocation\r\n//\t\t\t\t\t\t+'/manager/tests/lib/'\r\n//\t\t\t\t\t\t+src+'?cb='+(new Date()).getTime();\r\n\r\n\t\t\tlink.href=src;\r\n\t\t\tlink.rel='stylesheet';\r\n\t\t\tlink.type='text/css';\r\n\t\t\t\r\n\t\t\tif($.browser.msie) // no load event in IE so wait for readyState\r\n\t\t\t\tlink.onreadystatechange=function(){\r\n\t\t\t\t\tif(link.readyState == 'complete' || link.readyState == 'loaded'){\r\n\t\t\t\t\t\tlink.onreadystatechange=null;\r\n\t\t\t\t\t\tif(cb)\r\n\t\t\t\t\t\t\tcb();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\telse if(cb)\r\n\t\t\t\t$(link).one('load', cb);\r\n\t\t\t\t\r\n\t\t\thead.appendChild(link);\r\n\t\t\t\r\n\t\t\treturn link;\r\n\t\t}\r\n\t};\r\n\t\r\n\tvar sourceFilesQueue=[]\r\n\t\tprocessingSourceFile=false;\r\n\t\t\r\n\tfunction nextTick(cb){\r\n\t\tisNodeJS ? process.nextTick(cb) : setTimeout(cb, 0);\r\n\t}\r\n\t\t\r\n\tfunction processSourceFilesQueue(){\r\n\t\tif(!processingSourceFile && sourceFilesQueue.length){\r\n\t\t\tprocessingSourceFile=true;\r\n\t\t\tcurrentModule=undefined;\r\n\t\t\tfunction fileProcessed(){\r\n\t\t\t\tprocessingSourceFile=false;\r\n\t\t\t\tvar file=sourceFilesQueue.shift();\r\n\t\t\t\tsendMessage({\r\n\t\t\t\t\tid:'allTestsRead',\r\n\t\t\t\t\tfileName:file.fileName\r\n\t\t\t\t});\r\n\t\t\t\tnextTick(processSourceFilesQueue);\r\n\t\t\t}\r\n\t\t\tif(isNodeJS){\r\n\t\t\t\tvar vm = require(\"vm\"),\r\n\t\t\t\t\tfs = require(\"fs\");\r\n\r\n\t\t\t\tfs.readFile(sourceFilesQueue[0].filePath, function (err, fileData){\r\n\t\t\t\t\tif(err)\r\n\t\t\t\t\t\tconsole.log('ERR: processSourceFilesQueue failed loading \"'+sourceFilesQueue[0].filePath+'\": '+err)\r\n\t\t\t\t\telse{\r\n//\t\t\t\t\t\tconsole.log('runInThisContext '+sourceFilesQueue[0])\r\n\t\t\t\t\t\ttry{\r\n\t\t\t\t\t\t\tvm.runInThisContext(fileData, sourceFilesQueue[0].filePath);\r\n\t\t\t\t\t\t}catch(e){\r\n\t\t\t\t\t\t\tconsole.log('Exception occured while processing test source: '+e.stack);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfileProcessed();\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tattachScript(sourceFilesQueue[0].filePath, function (){\r\n\t\t\t\t\tfileProcessed();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * Loads a test source file so tests in it are registered in the environment and ready (but not scheduled) to be run. All loaded tests\r\n\t * are added to the testCache\r\n\t * @param\t{String}\tsrc\tThe path of the test file.\r\n\t */\r\n\tfunction loadTestsSource(file){\r\n//\t\tconsole.log('loadTestsSource '+path)\r\n\t\tif(file instanceof Array)\r\n\t\t\tsourceFilesQueue.push.apply(sourceFilesQueue, file);\r\n\t\telse\r\n\t\t\tsourceFilesQueue.push(file);\r\n\t\tprocessSourceFilesQueue();\r\n\t}\r\n\t\r\n\tvar currentModule=undefined,\r\n\t\ttestCache={};\r\n//\t\tcurrentFileName='';\r\n\tfunction addToTestCache(test){\r\n\t\tvar obj=testCache[test.fileName];\r\n\t\tif(!obj)\r\n\t\t\tobj=testCache[test.fileName]={};\r\n\t\tobj[test.name]=test;\r\n\t}\r\n\t\r\n\tvar testsQueue=[],\r\n\t\trunningTest;\r\n\tfunction processTestsQueue(){\r\n\t\tif(!runningTest && testsQueue.length){\r\n\t\t\tvar test=testsQueue.shift(),\r\n\t\t\t\tcacheObj=testCache[test.fileName];\r\n\t\t\tif(cacheObj)\r\n\t\t\t\textend(test, cacheObj[test.name]);\t\t\t\t\r\n\t\t\trunningTest=new Test(test);\r\n\t\t\trunningTest.run();\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction Test(cfg){\r\n\t\textend(this, cfg);\r\n\t}\r\n\tfunction onTestRead(test){\r\n//\t\tconsole.log('testRead', test.name, 'in', test.fileName)\r\n\t\taddToTestCache(test);\r\n\t\tsendMessage({\r\n\t\t\tid:'testRead',\r\n\t\t\ttest:test\r\n\t\t});\r\n//\t\tconsole.log('runningTest', runningTest, runningTest&&(runningTest.module==test.module))\r\n\t\tif(runningTest && runningTest.paused \r\n\t\t\t\t\t\t&& runningTest.fileName==test.fileName \r\n\t\t\t\t\t\t&& (!(runningTest.module&&test.module) || (runningTest.module.name==test.module.name)) \r\n\t\t\t\t\t\t&& runningTest.name==test.name){\r\n//\t\t\tconsole.log('resuming test ...');\r\n\t\t\textend(runningTest, test);\r\n\t\t\trunningTest.resume();\r\n\t\t}\r\n\t}\r\n\tfunction Module(){\r\n\t\tthis.initialize.apply(this, arguments);\r\n\t}\r\n\r\n\tfunction setup(QUnit){\r\n\t\textend(Test.prototype, {\r\n\t\t\trun:function (){\r\n\t\t\t\tif(!this.paused && !this.setupCount){\r\n\t\t\t\t\tif(this.fn){\r\n\t\t\t\t\t\tthis.reset();\r\n\t\t\t\t\t\tif(this.module && (typeof this.module.setup=='function')){\r\n\t\t\t\t\t\t\tthis.setupCount++;\r\n\t\t\t\t\t\t\tthis.module.setup.call(this.testEnvironment);\r\n\t\t\t\t\t\t\tthis.setupCount--;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.doRun();\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis.pause();\r\n\t\t\t\t\t\tconsole.log('waiting for test function ...');\r\n\t\t\t\t\t\tloadTestsSource(this);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdoRun:function (){\r\n\t\t\t\tif(!this.setupCount)\r\n\t\t\t\t\tthis.fn.call(this.environment);\r\n\t\t\t},\r\n\t\t\tend:function (){\r\n\t\t\t\tif(this.module && (typeof this.module.teardown=='function'))\r\n\t\t\t\t\tthis.module.teardown.call(this.testEnvironment);\r\n\t\t\t},\r\n\t\t\tpause:function (){\r\n\t\t\t\tthis.paused=true;\r\n\t\t\t},\r\n\t\t\tresume:function (){\r\n\t\t\t\tthis.paused=false;\r\n\t\t\t\tthis.run();\r\n\t\t\t},\r\n\t\t\treset:function (){\r\n\t\t\t\tthis.setupCount=0;\r\n\t\t\t\tthis.testEnvironment={\r\n\t\t\t\t\t__testInst:this\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\trequireLib:function (src, cb){\r\n\t\t\t\tvar sep=isNodeJS ? require('path').sep:'';\r\n\t\t\t\tif(src instanceof Array){\r\n\t\t\t\t\tfor(var i=0; i<src.length; i++)\n\t\t\t\t\t\tsrc[i]=(isNodeJS ? __adaptor__.testCfg.clientBaseDir+sep+'lib'+sep : __adaptor__.testCfg.serverUrl+'/lib/')+src[i];\r\n\t\t\t\t}else\r\n\t\t\t\t\tsrc=(isNodeJS ? __adaptor__.testCfg.clientBaseDir+sep+'lib'+sep : __adaptor__.testCfg.serverUrl+'/lib/')+src;\n\t\t\t\treturn this.require(src, cb);\r\n\t\t\t},\r\n\t\t\trequireCustomLib:function (src, cb){\r\n\t\t\t\tvar sep=isNodeJS ? require('path').sep:'';\r\n\t\t\t\tif(src instanceof Array){\r\n\t\t\t\t\tfor(var i=0; i<src.length; i++)\r\n\t\t\t\t\t\tsrc[i]=(isNodeJS ? __adaptor__.testCfg.userLibsDir+require('path').sep : __adaptor__.testCfg.serverUrl+__adaptor__.testCfg.userLibsUrl+'/')+src[i];\r\n\t\t\t\t}else\r\n\t\t\t\t\tsrc=(isNodeJS ? __adaptor__.testCfg.userLibsDir+require('path').sep : __adaptor__.testCfg.serverUrl+__adaptor__.testCfg.userLibsUrl+'/')+src;\r\n\t\t\t\treturn this.require(src, cb);\r\n\t\t\t},\r\n\t\t\trequire:function (src, cb){\r\n\t\t\t\tvar waitFn=this.waitForSetup();\r\n\t\t\t\treturn require(src, function (exports){\r\n\t\t\t\t\tcb&&cb(exports);\r\n\t\t\t\t\twaitFn();\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\twaitForSetup:function (){\r\n\t\t\t\tthis.setupCount++;\r\n\t\t\t\tvar test=this;\r\n\t\t\t\treturn function (){\r\n\t\t\t\t\ttest.setupCount--;\r\n\t\t\t\t\ttest.doRun();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t});\r\n\t\textend(Module.prototype, {\r\n\t\t\tinitialize:function (name, lifecycle){\r\n\t\t\t\tthis.name=name;\r\n\t\t\t\tif(lifecycle)\r\n\t\t\t\t\textend(this, lifecycle);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tQUnit.testStart(function (data){\r\n\t\t\tsendMessage(extend({\r\n\t\t\t\tid:'testStart',\r\n\t\t\t\tname:runningTest.name,\r\n\t\t\t\tmodule:runningTest.module?runningTest.module.name:'',\r\n\t\t\t\tfileName:runningTest.fileName\r\n\t\t\t}, data));\r\n\t\t});\r\n\t\tQUnit.testDone(function (data){\r\n\t\t\trunningTest.end();\r\n\t\t\tvar msg=extend({\r\n\t\t\t\tid:'testDone',\r\n\t\t\t\tname:runningTest.name,\r\n\t\t\t\tmodule:runningTest.module?runningTest.module.name:'',\r\n\t\t\t\tfileName:runningTest.fileName\r\n\t\t\t}, data);\r\n\t\t\trunningTest=null;\r\n\t\t\tsendMessage(msg);\r\n\t\t\tprocessTestsQueue();\r\n\t\t});\r\n\t\tQUnit.log(function (data){\r\n\t\t\tif(runningTest){\r\n\t\t\t\tsendMessage(extend({\r\n\t\t\t\t\tid:'assertion',\r\n\t\t\t\t\tname:runningTest.name,\r\n\t\t\t\t\tmodule:runningTest.module?runningTest.module.name:'',\r\n\t\t\t\t\tfileName:runningTest.fileName\r\n\t\t\t\t}, data));\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// add the test methods to global \r\n\t\textend(globalScope, QUnit.assert, {\r\n\t\t\tstart:QUnit.start,\r\n\t\t\tstop:QUnit.stop,\r\n\t\t\texpect:QUnit.expect,\r\n\t\t\ttest:function (testName, expected, callback){\r\n//\t\t\t\tconsole.log('test')\r\n\t\t\t\tvar mod=currentModule,\r\n\t\t\t\t\targs=Array.prototype.slice.call(arguments, 0);\r\n\t\t\t\tif(args.length === 2){\r\n\t\t\t\t\targs[2]=args[1]; // callback = expected;\r\n\t\t\t\t\targs[1]=1; // expected = 1;\r\n\t\t\t\t\texpected=1;\r\n\t\t\t\t}\r\n\t\t\t\tvar fn=args[2];\r\n\t\t\t\targs[2]=function (){\r\n\t\t\t\t\tfn.call(runningTest.testEnvironment);  // set scope to runningTest because QUnit will set it to its test environment object\r\n\t\t\t\t};\r\n\t\t\t\tvar test={\r\n\t\t\t\t\tmodule:mod, \r\n\t\t\t\t\tfileName:sourceFilesQueue[0].fileName, //currentFileName, \r\n\t\t\t\t\tname:testName, \r\n\t\t\t\t\tfn:function (){\r\n\t\t\t\t\t\tif(mod)\r\n\t\t\t\t\t\t\tQUnit.module(mod.name);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tQUnit.module('');\r\n\t\t\t\t\t\tQUnit.test.apply(QUnit, args);\r\n\t\t\t\t\t},\r\n\t\t\t\t\texpect:expected\r\n\t\t\t\t};\r\n\t\t\t\tonTestRead(test);\r\n\t\t\t},\t\t\t\r\n\t\t\tasyncTest:function (testName, expected, callback){\r\n\t\t\t\tvar mod=currentModule,\r\n\t\t\t\t\targs=Array.prototype.slice.call(arguments, 0);\r\n\t\t\t\tif(args.length === 2){\r\n\t\t\t\t\targs[2]=args[1]; // callback = expected;\r\n\t\t\t\t\targs[1]=1; // expected = 1;\r\n\t\t\t\t\texpected=1;\r\n\t\t\t\t}\r\n\t\t\t\tvar fn=args[2];\r\n\t\t\t\targs[2]=function (){\r\n\t\t\t\t\tfn.call(runningTest.testEnvironment);  // set scope to runningTest because QUnit will set it to its test environment object\r\n\t\t\t\t};\r\n\t\t\t\tvar test={\r\n\t\t\t\t\tmodule:mod, \r\n\t\t\t\t\tfileName:sourceFilesQueue[0].fileName, //currentFileName, \r\n\t\t\t\t\tname:testName, \r\n\t\t\t\t\tfn:function (){\r\n\t\t\t\t\t\tif(mod)\r\n\t\t\t\t\t\t\tQUnit.module(mod.name);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tQUnit.module('');\r\n\t\t\t\t\t\tQUnit.asyncTest.apply(QUnit, args);\r\n\t\t\t\t\t},\r\n\t\t\t\t\texpect:expected\r\n\t\t\t\t};\r\n\t\t\t\tonTestRead(test);\r\n\t\t\t},\t\t\t\r\n\t\t\tmodule:function (name, lifecycle){\r\n\t\t\t\tcurrentModule=new Module(name, lifecycle);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t// load the QUnit library\r\n\tif(isNodeJS){\r\n\t\textend=require('jquery.extend');\r\n\t\tsendMessage=function (msg){\r\n//\t\t\tconsole.log('sendMessage '+msg.id)\r\n\t\t\tprocess.send(msg);\r\n\t\t};\r\n\t\tonMessage=function (fn){\r\n\t\t\tprocess.on('message', fn);\r\n\t\t};\r\n\t\tsetup(require('../qunit'));\r\n\t\tsendMessage({\r\n\t\t\tid:'adaptorInitialized'\r\n\t\t});\r\n\t}else{\r\n\t\tsendMessage=function (msg){\r\n\t\t\twindow.__adaptor__.sendMessage(msg);\r\n\t\t};\r\n\t\t(function (){\r\n\t\t\tvar listeners=[];\r\n\t\t\twindow.__adaptor__.onMessage=function (msg){\r\n\t\t\t\tfor(var i=0; i<listeners.length; i++)\r\n\t\t\t\t\tlisteners[i](msg);\r\n\t\t\t};\r\n\t\t\tonMessage=function (fn){\r\n\t\t\t\tlisteners.push(fn);\r\n\t\t\t};\r\n\t\t}());\r\n\t\tattachScript(module.url.replace(/[^\/]*$/, '')+'../qunit.js', function (){\r\n\t\t\textend=$.extend;\r\n\t\t\t// do this because for now the lib is not loaded in a standard document wich to fire \"load\"\r\n\t\t\t//QUnit.config.blocking=false;\r\n\t\t\tQUnit.init();\r\n\t\t\tQUnit.config.autorun=true;\r\n\t\t\tQUnit.config.semaphore=0;\r\n\t\t\t\r\n\t\t\tsetup(QUnit);\r\n\t\t\tsendMessage({\r\n\t\t\t\tid:'adaptorInitialized'\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\tonMessage(function (msg){\r\n//\t\tconsole.log('testInstance received message '+msg.id);\r\n\t\tswitch(msg.id){\r\n\t\t\tcase 'loadTestsSource':\r\n\t\t\t\t\tloadTestsSource(msg);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'runTest':\r\n\t\t\t\t\tif(msg.test instanceof Array)\r\n\t\t\t\t\t\ttestsQueue.push.apply(testsQueue, msg.test);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\ttestsQueue.push(msg.test);\r\n\t\t\t\t\tprocessTestsQueue();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'testCfg':\r\n\t\t\t\t\textend(__adaptor__.testCfg, msg.cfg);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'reset': console.log('reset')\r\n\t\t\t\t\ttestCache={};\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t});\r\n};\r\n\r\nfunction attachScript(src, cb, doc){\r\n\tif(!doc)\r\n\t\tdoc=document;\r\n\tvar script=doc.createElement('SCRIPT'),\r\n\t\thead=doc.getElementsByTagName('head')[0];\r\n\tscript.src=src;\r\n\tscript.type='text/javascript';\r\n\t\r\n\tif($.browser.msie) // no load event in IE so wait for readyState\r\n\t\tscript.onreadystatechange=function(){\r\n\t\t\tif(script.readyState == 'complete' || script.readyState == 'loaded'){\r\n\t\t\t\tscript.onreadystatechange=null;\r\n\t\t\t\thead.removeChild(script);\r\n\t\t\t\tif(cb)\r\n\t\t\t\t\tcb();\r\n\t\t\t}\r\n\t\t};\r\n\telse\r\n\t\t$(script).one('load', function (){\r\n\t\t\thead.removeChild(script);\r\n\t\t\tif(cb)\r\n\t\t\t\tcb()\r\n\t\t});\r\n\t\t\r\n\thead.appendChild(script);\r\n\t\r\n\treturn script;\r\n}\r\nexports.createTestingInstance=function (cfg){\r\n\tvar inst={};\r\n\tif(isNodeJS){\r\n\t\tvar cp = require('child_process');\r\n\t\tinst.child=cp.fork(__dirname + '/../../node.js/testing-instance.js', ['adaptor='+__filename], {env: process.env});\r\n\t\tinst.onMessage=function (fn){\r\n\t\t\tthis.child.on('message', fn);\r\n\t\t};\r\n\t\tinst.sendMessage=function (msg){\r\n\t\t\tthis.child.send(msg);\r\n\t\t};\r\n\t\tinst.disconnect=function (){\r\n\t\t\tthis.child.disconnect();\r\n\t\t\tdelete this.child;\r\n\t\t};\r\n\t}else{\r\n\t\tinst.listeners=[];\r\n\t\tinst.el=document.createElement('iframe');\r\n\t\tinst.el.className='testing-instance';\r\n\t\tdocument.body.appendChild(inst.el);\r\n//\t\t$(inst.el).bind('load', function (){\r\n\t\t\t/**\r\n\t\t\t * TO-DO: try to use asyncFlow instead of nesting callbacks\r\n\t\t\t */\r\n\t\t\tvar doc=inst.el.contentWindow.document;\r\n\t\t\tattachScript(cfg.serverUrl+'/lib/jquery-1.7.1.min.js', function (){\r\n\t\t\t\t\tattachScript(cfg.serverUrl+'/lib/modules.js', function (){\r\n\t\t\t\t\t\t\tinst.el.contentWindow.registerModule.loadFromAbsPath(cfg.serverUrl+'/lib/adaptors/qunit', function (exports){\r\n\t\t\t\t\t\t\t\texports.initialize();\r\n\t\t\t\t\t\t\t\tinst.el.contentWindow.__adaptor__.sendMessage=function (msg){\r\n\t\t\t\t\t\t\t\t\tfor(var i=0; i<inst.listeners.length; i++)\r\n\t\t\t\t\t\t\t\t\t\tinst.listeners[i](msg);\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}, doc);\r\n\t\t\t\t}, doc);\r\n//\t\t});\r\n\t\tinst.onMessage=function (fn){\r\n\t\t\tthis.listeners.push(fn);\r\n\t\t};\r\n\t\tinst.sendMessage=function (msg){\r\n\t\t\tthis.el.contentWindow.__adaptor__.onMessage(msg);\r\n\t\t};\r\n\t\tinst.disconnect=function (){\r\n\t\t\t$(this.el).remove();\r\n\t\t\tdelete this.el;\r\n\t\t\tthis.listeners.splice(0, this.listeners.length);\r\n\t\t};\r\n\t}\t\r\n\treturn inst;\r\n};\r\n\r\n/**\r\n * \r\n */\r\nexports.getTestsInfoList=function (requirePath, cb){\r\n//\tconsole.log('getTestsInfoList ', requirePath);\r\n\tvar inst=exports.createTestingInstance();\r\n\tif(isNodeJS){\r\n\t\t/**\r\n\t\t * TO-DO: try to reuse the forked process\r\n\t\t */\r\n\t\tif(requirePath instanceof Array){\r\n\t\t\tvar sources=requirePath.slice(0),\t// copy the list\r\n\t\t\t\tallTests=[],\r\n\t\t\t\tcurrentTestsList=[];\r\n\t\t\tinst.onMessage(function sourceComplete(msg){\r\n\t\t\t\tif(msg.id=='testRead'){\r\n\t\t\t\t\tcurrentTestsList.push({\r\n\t\t\t\t\t\tmodule:msg.test.module?msg.test.module.name:'',\r\n\t\t\t\t\t\tfileName:msg.test.fileName,\r\n\t\t\t\t\t\tname:msg.test.name,\r\n\t\t\t\t\t\texpect:msg.test.expect\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}else if(msg.id=='allTestsRead'){\r\n\t\t\t\t\tallTests.push({\r\n\t\t\t\t\t\tfileName:sources.shift(),\r\n\t\t\t\t\t\ttests:currentTestsList\r\n\t\t\t\t\t});\r\n\t\t\t\t\tprocessNextSource();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tfunction processNextSource(){\r\n\t\t\t\tif(sources.length){\r\n\t\t\t\t\tcurrentTestsList=[];\r\n\t\t\t\t\tinst.sendMessage({\r\n\t\t\t\t\t\tid:'loadTestsSource',\r\n\t\t\t\t\t\tfileName:sources[0],\r\n\t\t\t\t\t\tfilePath:sources[0]\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tcb && cb(null, allTests);\r\n\t\t\t\t\tinst.disconnect();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprocessNextSource();\r\n\t\t}else{\r\n\t\t\tvar currentTestsList=[];\r\n\t\t\tinst.onMessage(function (msg){\r\n\t\t\t\tif(msg.id=='testRead'){\r\n\t\t\t\t\tcurrentTestsList.push({\r\n\t\t\t\t\t\tmodule:msg.test.module?msg.test.module.name:'',\r\n\t\t\t\t\t\tfileName:msg.test.fileName,\r\n\t\t\t\t\t\tname:msg.test.name,\r\n\t\t\t\t\t\texpect:msg.test.expect\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}else if(msg.id=='allTestsRead'){\r\n\t\t\t\t\tcb && cb(null, currentTestsList);\r\n\t\t\t\t\tinst.disconnect();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tinst.sendMessage({\r\n\t\t\t\tid:'loadTestsSource',\r\n\t\t\t\tfileName:requirePath,\r\n\t\t\t\tfilePath:requirePath\r\n\t\t\t});\r\n\t\t}\r\n\t}else{\r\n\t\t/**\r\n\t\t * not needed for now\r\n\t\t */\r\n\t}\r\n};\r\n\r\n}, typeof module=='object'?module:null);\r\n\r\n",
                "new_contents": "// if registerModule is defined call that. if not then check if this this has\r\n// been loaded as a node.js module and the code can execute right away.\r\n(typeof registerModule=='function' ? registerModule : function (fn){fn(module, require);}).call(this, function (module, require){\r\n\tvar exports=module.exports;\r\n\t\t\r\nvar isNodeJS = !(typeof window=='object'),\r\n\tglobalScope=function() {return this;}.call();\r\n\r\n/**\r\n * This code intercepts calls to the QUnit testing library to allow tests written for that library to run in BrowserDriver.\r\n */\r\n\r\nexports.initialize=function (){\r\n\t\r\n\tvar extend, sendMessage, onMessage;\r\n\t\r\n\tglobalScope.__adaptor__={\r\n\t\ttestCfg:{},\r\n\t\tstorage:{},\r\n\t\trequireLib:function (src, cb){\r\n\t\t\tvar sep=isNodeJS ? require('path').sep:'';\r\n\t\t\tif(src instanceof Array){\r\n\t\t\t\tfor(var i=0; i<src.length; i++)\r\n\t\t\t\t\tsrc[i]=(isNodeJS ? this.testCfg.clientBaseDir+sep+'lib'+sep : this.testCfg.serverUrl+'/lib/')+src[i];\r\n\t\t\t}else\r\n\t\t\t\tsrc=(isNodeJS ? this.testCfg.clientBaseDir+sep+'lib'+sep : this.testCfg.serverUrl+'/lib/')+src;\r\n\t\t\treturn require(src, cb);\r\n\t\t},\r\n\t\trequireCustomLib:function (src, cb){\r\n\t\t\tvar sep=isNodeJS ? require('path').sep:'';\r\n\t\t\tif(src instanceof Array){\r\n\t\t\t\tfor(var i=0; i<src.length; i++)\r\n\t\t\t\t\tsrc[i]=(isNodeJS ? this.testCfg.userLibsDir+require('path').sep : this.testCfg.serverUrl+this.testCfg.userLibsUrl+'/')+src[i];\r\n\t\t\t}else\r\n\t\t\t\tsrc=(isNodeJS ? this.testCfg.userLibsDir+require('path').sep : this.testCfg.serverUrl+this.testCfg.userLibsUrl+'/')+src;\r\n\t\t\treturn require(src, cb);\r\n\t\t},\r\n\t\trequire:function (src, cb){\r\n\t\t\treturn require(src, cb);\r\n\t\t},\r\n\t\tattachScript:attachScript,\r\n\t\tattachStylesheet:function (src, cb, doc){\r\n\t\t\tif(!doc)\r\n\t\t\t\tdoc=document;\r\n\t\t\tvar link=doc.createElement('link'),\r\n\t\t\t\thead=doc.getElementsByTagName('head')[0];\r\n\r\n//\t\t\tsrc = driver.storage.socketIOServerLocation\r\n//\t\t\t\t\t\t+'/manager/tests/lib/'\r\n//\t\t\t\t\t\t+src+'?cb='+(new Date()).getTime();\r\n\r\n\t\t\tlink.href=src;\r\n\t\t\tlink.rel='stylesheet';\r\n\t\t\tlink.type='text/css';\r\n\t\t\t\r\n\t\t\tif($.browser.msie) // no load event in IE so wait for readyState\r\n\t\t\t\tlink.onreadystatechange=function(){\r\n\t\t\t\t\tif(link.readyState == 'complete' || link.readyState == 'loaded'){\r\n\t\t\t\t\t\tlink.onreadystatechange=null;\r\n\t\t\t\t\t\tif(cb)\r\n\t\t\t\t\t\t\tcb();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\telse if(cb)\r\n\t\t\t\t$(link).one('load', cb);\r\n\t\t\t\t\r\n\t\t\thead.appendChild(link);\r\n\t\t\t\r\n\t\t\treturn link;\r\n\t\t}\r\n\t};\r\n\t\r\n\tvar sourceFilesQueue=[]\r\n\t\tprocessingSourceFile=false;\r\n\t\t\r\n\tfunction nextTick(cb){\r\n\t\tisNodeJS ? process.nextTick(cb) : setTimeout(cb, 0);\r\n\t}\r\n\t\t\r\n\tfunction processSourceFilesQueue(){\r\n\t\tif(!processingSourceFile && sourceFilesQueue.length){\r\n\t\t\tprocessingSourceFile=true;\r\n\t\t\tcurrentModule=undefined;\r\n\t\t\tfunction fileProcessed(){\r\n\t\t\t\tprocessingSourceFile=false;\r\n\t\t\t\tvar file=sourceFilesQueue.shift();\r\n\t\t\t\tsendMessage({\r\n\t\t\t\t\tid:'allTestsRead',\r\n\t\t\t\t\tfileName:file.fileName\r\n\t\t\t\t});\r\n\t\t\t\tnextTick(processSourceFilesQueue);\r\n\t\t\t}\r\n\t\t\tif(isNodeJS){\r\n\t\t\t\tvar vm = require(\"vm\"),\r\n\t\t\t\t\tfs = require(\"fs\");\r\n\r\n\t\t\t\tfs.readFile(sourceFilesQueue[0].filePath, function (err, fileData){\r\n\t\t\t\t\tif(err)\r\n\t\t\t\t\t\tconsole.log('ERR: processSourceFilesQueue failed loading \"'+sourceFilesQueue[0].filePath+'\": '+err)\r\n\t\t\t\t\telse{\r\n//\t\t\t\t\t\tconsole.log('runInThisContext '+sourceFilesQueue[0])\r\n\t\t\t\t\t\ttry{\r\n\t\t\t\t\t\t\tvm.runInThisContext(fileData, sourceFilesQueue[0].filePath);\r\n\t\t\t\t\t\t}catch(e){\r\n\t\t\t\t\t\t\tconsole.log('Exception occured while processing test source: '+e.stack);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfileProcessed();\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\tattachScript(sourceFilesQueue[0].filePath, function (){\r\n\t\t\t\t\tfileProcessed();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * Loads a test source file so tests in it are registered in the environment and ready (but not scheduled) to be run. All loaded tests\r\n\t * are added to the testCache\r\n\t * @param\t{String}\tsrc\tThe path of the test file.\r\n\t */\r\n\tfunction loadTestsSource(file){\r\n//\t\tconsole.log('loadTestsSource '+path)\r\n\t\tif(file instanceof Array)\r\n\t\t\tsourceFilesQueue.push.apply(sourceFilesQueue, file);\r\n\t\telse\r\n\t\t\tsourceFilesQueue.push(file);\r\n\t\tprocessSourceFilesQueue();\r\n\t}\r\n\t\r\n\tvar currentModule=undefined,\r\n\t\ttestCache={};\r\n//\t\tcurrentFileName='';\r\n\tfunction addToTestCache(test){\r\n\t\tvar obj=testCache[test.fileName];\r\n\t\tif(!obj)\r\n\t\t\tobj=testCache[test.fileName]={};\r\n\t\tobj[test.name]=test;\r\n\t}\r\n\t\r\n\tvar testsQueue=[],\r\n\t\trunningTest;\r\n\tfunction processTestsQueue(){\r\n\t\tif(!runningTest && testsQueue.length){\r\n\t\t\tvar test=testsQueue.shift(),\r\n\t\t\t\tcacheObj=testCache[test.fileName];\r\n\t\t\tif(cacheObj)\r\n\t\t\t\textend(test, cacheObj[test.name]);\t\t\t\t\r\n\t\t\trunningTest=new Test(test);\r\n\t\t\trunningTest.run();\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction Test(cfg){\r\n\t\textend(this, cfg);\r\n\t}\r\n\tfunction onTestRead(test){\r\n//\t\tconsole.log('testRead', test.name, 'in', test.fileName)\r\n\t\taddToTestCache(test);\r\n\t\tsendMessage({\r\n\t\t\tid:'testRead',\r\n\t\t\ttest:test\r\n\t\t});\r\n//\t\tconsole.log('runningTest', runningTest, runningTest&&(runningTest.module==test.module))\r\n\t\tif(runningTest && runningTest.paused \r\n\t\t\t\t\t\t&& runningTest.fileName==test.fileName \r\n\t\t\t\t\t\t&& (!(runningTest.module&&test.module) || (runningTest.module.name==test.module.name)) \r\n\t\t\t\t\t\t&& runningTest.name==test.name){\r\n//\t\t\tconsole.log('resuming test ...');\r\n\t\t\textend(runningTest, test);\r\n\t\t\trunningTest.resume();\r\n\t\t}\r\n\t}\r\n\tfunction Module(){\r\n\t\tthis.initialize.apply(this, arguments);\r\n\t}\r\n\r\n\tfunction setup(QUnit){\r\n\t\textend(Test.prototype, {\r\n\t\t\trun:function (){\r\n\t\t\t\tif(!this.paused && !this.setupCount){\r\n\t\t\t\t\tif(this.fn){\r\n\t\t\t\t\t\tthis.reset();\r\n\t\t\t\t\t\tif(this.module && (typeof this.module.setup=='function')){\r\n\t\t\t\t\t\t\tthis.setupCount++;\r\n\t\t\t\t\t\t\tthis.module.setup.call(this.testEnvironment);\r\n\t\t\t\t\t\t\tthis.setupCount--;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.doRun();\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis.pause();\r\n\t\t\t\t\t\tconsole.log('waiting for test function ...');\r\n\t\t\t\t\t\tloadTestsSource(this);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdoRun:function (){\r\n\t\t\t\tif(!this.setupCount)\r\n\t\t\t\t\tthis.fn.call(this.environment);\r\n\t\t\t},\r\n\t\t\tend:function (){\r\n\t\t\t\tif(this.module && (typeof this.module.teardown=='function'))\r\n\t\t\t\t\tthis.module.teardown.call(this.testEnvironment);\r\n\t\t\t},\r\n\t\t\tpause:function (){\r\n\t\t\t\tthis.paused=true;\r\n\t\t\t},\r\n\t\t\tresume:function (){\r\n\t\t\t\tthis.paused=false;\r\n\t\t\t\tthis.run();\r\n\t\t\t},\r\n\t\t\treset:function (){\r\n\t\t\t\tthis.setupCount=0;\r\n\t\t\t\tthis.testEnvironment={\r\n\t\t\t\t\t__testInst:this\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\trequireLib:function (src, cb){\r\n\t\t\t\tvar sep=isNodeJS ? require('path').sep:'';\r\n\t\t\t\tif(src instanceof Array){\r\n\t\t\t\t\tfor(var i=0; i<src.length; i++)\n\t\t\t\t\t\tsrc[i]=(isNodeJS ? __adaptor__.testCfg.clientBaseDir+sep+'lib'+sep : __adaptor__.testCfg.serverUrl+'/lib/')+src[i];\r\n\t\t\t\t}else\r\n\t\t\t\t\tsrc=(isNodeJS ? __adaptor__.testCfg.clientBaseDir+sep+'lib'+sep : __adaptor__.testCfg.serverUrl+'/lib/')+src;\n\t\t\t\treturn this.require(src, cb);\r\n\t\t\t},\r\n\t\t\trequireCustomLib:function (src, cb){\r\n\t\t\t\tvar sep=isNodeJS ? require('path').sep:'';\r\n\t\t\t\tif(src instanceof Array){\r\n\t\t\t\t\tfor(var i=0; i<src.length; i++)\r\n\t\t\t\t\t\tsrc[i]=(isNodeJS ? __adaptor__.testCfg.userLibsDir+require('path').sep : __adaptor__.testCfg.serverUrl+__adaptor__.testCfg.userLibsUrl+'/')+src[i];\r\n\t\t\t\t}else\r\n\t\t\t\t\tsrc=(isNodeJS ? __adaptor__.testCfg.userLibsDir+require('path').sep : __adaptor__.testCfg.serverUrl+__adaptor__.testCfg.userLibsUrl+'/')+src;\r\n\t\t\t\treturn this.require(src, cb);\r\n\t\t\t},\r\n\t\t\trequire:function (src, cb){\r\n\t\t\t\tvar waitFn=this.waitForSetup();\r\n\t\t\t\treturn require(src, function (exports){\r\n\t\t\t\t\tcb&&cb(exports);\r\n\t\t\t\t\twaitFn();\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\twaitForSetup:function (){\r\n\t\t\t\tthis.setupCount++;\r\n\t\t\t\tvar test=this;\r\n\t\t\t\treturn function (){\r\n\t\t\t\t\ttest.setupCount--;\r\n\t\t\t\t\ttest.doRun();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t});\r\n\t\textend(Module.prototype, {\r\n\t\t\tinitialize:function (name, lifecycle){\r\n\t\t\t\tthis.name=name;\r\n\t\t\t\tif(lifecycle)\r\n\t\t\t\t\textend(this, lifecycle);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tQUnit.testStart(function (data){\r\n\t\t\tsendMessage(extend({\r\n\t\t\t\tid:'testStart',\r\n\t\t\t\tname:runningTest.name,\r\n\t\t\t\tmodule:runningTest.module?runningTest.module.name:'',\r\n\t\t\t\tfileName:runningTest.fileName\r\n\t\t\t}, data));\r\n\t\t});\r\n\t\tQUnit.testDone(function (data){\r\n\t\t\trunningTest.end();\r\n\t\t\tvar msg=extend({\r\n\t\t\t\tid:'testDone',\r\n\t\t\t\tname:runningTest.name,\r\n\t\t\t\tmodule:runningTest.module?runningTest.module.name:'',\r\n\t\t\t\tfileName:runningTest.fileName\r\n\t\t\t}, data);\r\n\t\t\trunningTest=null;\r\n\t\t\tsendMessage(msg);\r\n\t\t\tprocessTestsQueue();\r\n\t\t});\r\n\t\tQUnit.log(function (data){\r\n\t\t\tif(runningTest){\r\n\t\t\t\tsendMessage(extend({\r\n\t\t\t\t\tid:'assertion',\r\n\t\t\t\t\tname:runningTest.name,\r\n\t\t\t\t\tmodule:runningTest.module?runningTest.module.name:'',\r\n\t\t\t\t\tfileName:runningTest.fileName\r\n\t\t\t\t}, data));\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// add the test methods to global \r\n\t\textend(globalScope, QUnit.assert, {\r\n\t\t\tstart:QUnit.start,\r\n\t\t\tstop:QUnit.stop,\r\n\t\t\texpect:QUnit.expect,\r\n\t\t\ttest:function (testName, expected, callback){\r\n//\t\t\t\tconsole.log('test')\r\n\t\t\t\tvar mod=currentModule,\r\n\t\t\t\t\targs=Array.prototype.slice.call(arguments, 0);\r\n\t\t\t\tif(args.length === 2){\r\n\t\t\t\t\targs[2]=args[1]; // callback = expected;\r\n\t\t\t\t\targs[1]=1; // expected = 1;\r\n\t\t\t\t\texpected=1;\r\n\t\t\t\t}\r\n\t\t\t\tvar fn=args[2];\r\n\t\t\t\targs[2]=function (){\r\n\t\t\t\t\tfn.call(runningTest.testEnvironment);  // set scope to runningTest because QUnit will set it to its test environment object\r\n\t\t\t\t};\r\n\t\t\t\tvar test={\r\n\t\t\t\t\tmodule:mod, \r\n\t\t\t\t\tfileName:sourceFilesQueue[0].fileName, //currentFileName, \r\n\t\t\t\t\tname:testName, \r\n\t\t\t\t\tfn:function (){\r\n\t\t\t\t\t\tif(mod)\r\n\t\t\t\t\t\t\tQUnit.module(mod.name);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tQUnit.module('');\r\n\t\t\t\t\t\tQUnit.test.apply(QUnit, args);\r\n\t\t\t\t\t},\r\n\t\t\t\t\texpect:expected\r\n\t\t\t\t};\r\n\t\t\t\tonTestRead(test);\r\n\t\t\t},\t\t\t\r\n\t\t\tasyncTest:function (testName, expected, callback){\r\n\t\t\t\tvar mod=currentModule,\r\n\t\t\t\t\targs=Array.prototype.slice.call(arguments, 0);\r\n\t\t\t\tif(args.length === 2){\r\n\t\t\t\t\targs[2]=args[1]; // callback = expected;\r\n\t\t\t\t\targs[1]=1; // expected = 1;\r\n\t\t\t\t\texpected=1;\r\n\t\t\t\t}\r\n\t\t\t\tvar fn=args[2];\r\n\t\t\t\targs[2]=function (){\r\n\t\t\t\t\tfn.call(runningTest.testEnvironment);  // set scope to runningTest because QUnit will set it to its test environment object\r\n\t\t\t\t};\r\n\t\t\t\tvar test={\r\n\t\t\t\t\tmodule:mod, \r\n\t\t\t\t\tfileName:sourceFilesQueue[0].fileName, //currentFileName, \r\n\t\t\t\t\tname:testName, \r\n\t\t\t\t\tfn:function (){\r\n\t\t\t\t\t\tif(mod)\r\n\t\t\t\t\t\t\tQUnit.module(mod.name);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tQUnit.module('');\r\n\t\t\t\t\t\tQUnit.asyncTest.apply(QUnit, args);\r\n\t\t\t\t\t},\r\n\t\t\t\t\texpect:expected\r\n\t\t\t\t};\r\n\t\t\t\tonTestRead(test);\r\n\t\t\t},\t\t\t\r\n\t\t\tmodule:function (name, lifecycle){\r\n\t\t\t\tcurrentModule=new Module(name, lifecycle);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t// load the QUnit library\r\n\tif(isNodeJS){\r\n\t\textend=require('jquery.extend');\r\n\t\tsendMessage=function (msg){\r\n//\t\t\tconsole.log('sendMessage '+msg.id)\r\n\t\t\tprocess.send(msg);\r\n\t\t};\r\n\t\tonMessage=function (fn){\r\n\t\t\tprocess.on('message', fn);\r\n\t\t};\r\n\t\tsetup(require('../qunit'));\r\n\t\tsendMessage({\r\n\t\t\tid:'adaptorInitialized'\r\n\t\t});\r\n\t}else{\r\n\t\tsendMessage=function (msg){\r\n\t\t\twindow.__adaptor__.sendMessage(msg);\r\n\t\t};\r\n\t\t(function (){\r\n\t\t\tvar listeners=[];\r\n\t\t\twindow.__adaptor__.onMessage=function (msg){\r\n\t\t\t\tfor(var i=0; i<listeners.length; i++)\r\n\t\t\t\t\tlisteners[i](msg);\r\n\t\t\t};\r\n\t\t\tonMessage=function (fn){\r\n\t\t\t\tlisteners.push(fn);\r\n\t\t\t};\r\n\t\t}());\r\n\t\tattachScript(module.url.replace(/[^\/]*$/, '')+'../qunit.js', function (){\r\n\t\t\textend=$.extend;\r\n\t\t\t// do this because for now the lib is not loaded in a standard document wich to fire \"load\"\r\n\t\t\t//QUnit.config.blocking=false;\r\n\t\t\tQUnit.init();\r\n\t\t\tQUnit.config.autorun=true;\r\n\t\t\tQUnit.config.semaphore=0;\r\n\t\t\t\r\n\t\t\tsetup(QUnit);\r\n\t\t\tsendMessage({\r\n\t\t\t\tid:'adaptorInitialized'\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\tonMessage(function (msg){\r\n//\t\tconsole.log('testInstance received message '+msg.id);\r\n\t\tswitch(msg.id){\r\n\t\t\tcase 'loadTestsSource':\r\n\t\t\t\t\tloadTestsSource(msg);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'runTest':\r\n\t\t\t\t\tif(msg.test instanceof Array)\r\n\t\t\t\t\t\ttestsQueue.push.apply(testsQueue, msg.test);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\ttestsQueue.push(msg.test);\r\n\t\t\t\t\tprocessTestsQueue();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'testCfg':\r\n\t\t\t\t\textend(__adaptor__.testCfg, msg.cfg);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'reset': console.log('reset')\r\n\t\t\t\t\ttestCache={};\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t});\r\n};\r\n\r\nfunction attachScript(src, cb, doc){\r\n\tif(!doc)\r\n\t\tdoc=document;\r\n\tvar script=doc.createElement('SCRIPT'),\r\n\t\thead=doc.getElementsByTagName('head')[0];\r\n\tscript.setAttribute('src', src);\r\n\tscript.setAttribute('type', 'text/javascript');\r\n\t\r\n\tif($.browser.msie) // no load event in IE so wait for readyState\r\n\t\tscript.onreadystatechange=function(){\r\n\t\t\tif(script.readyState == 'complete' || script.readyState == 'loaded'){\r\n\t\t\t\tscript.onreadystatechange=null;\r\n\t\t\t\thead.removeChild(script);\r\n\t\t\t\tif(cb)\r\n\t\t\t\t\tcb();\r\n\t\t\t}\r\n\t\t};\r\n\telse\r\n\t\t$(script).one('load', function (){\r\n\t\t\thead.removeChild(script);\r\n\t\t\tif(cb)\r\n\t\t\t\tcb()\r\n\t\t});\r\n\t\r\n\t\t\r\n\thead.appendChild(script);\r\n\t\r\n\treturn script;\r\n}\r\nexports.createTestingInstance=function (cfg){\r\n\tvar inst={};\r\n\tif(isNodeJS){\r\n\t\tvar cp = require('child_process');\r\n\t\tinst.child=cp.fork(__dirname + '/../../node.js/testing-instance.js', ['adaptor='+__filename], {env: process.env});\r\n\t\tinst.onMessage=function (fn){\r\n\t\t\tthis.child.on('message', fn);\r\n\t\t};\r\n\t\tinst.sendMessage=function (msg){\r\n\t\t\tthis.child.send(msg);\r\n\t\t};\r\n\t\tinst.disconnect=function (){\r\n\t\t\tthis.child.disconnect();\r\n\t\t\tdelete this.child;\r\n\t\t};\r\n\t}else{\r\n\t\tinst.listeners=[];\r\n\t\tinst.el=document.createElement('iframe');\r\n\t\tinst.el.className='testing-instance';\r\n\t\t$(inst.el).one('load', function (){\r\n\t\t\t/**\r\n\t\t\t * TO-DO: try to use asyncFlow instead of nesting callbacks\r\n\t\t\t */\r\n\t\t\tvar doc=inst.el.contentWindow.document;\r\n\t\t\tattachScript(cfg.serverUrl+'/lib/jquery-1.7.1.min.js', function (){\r\n\t\t\t\t\tattachScript(cfg.serverUrl+'/lib/modules.js', function (){\r\n\t\t\t\t\t\t\tinst.el.contentWindow.registerModule.loadFromAbsPath(cfg.serverUrl+'/lib/adaptors/qunit', function (exports){\r\n\t\t\t\t\t\t\t\texports.initialize();\r\n\t\t\t\t\t\t\t\tinst.el.contentWindow.__adaptor__.sendMessage=function (msg){\r\n\t\t\t\t\t\t\t\t\tfor(var i=0; i<inst.listeners.length; i++)\r\n\t\t\t\t\t\t\t\t\t\tinst.listeners[i](msg);\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}, doc);\r\n\t\t\t\t}, doc);\r\n\t\t});\r\n\t\tinst.onMessage=function (fn){\r\n\t\t\tthis.listeners.push(fn);\r\n\t\t};\r\n\t\tinst.sendMessage=function (msg){\r\n\t\t\tthis.el.contentWindow.__adaptor__.onMessage(msg);\r\n\t\t};\r\n\t\tinst.disconnect=function (){\r\n\t\t\t$(this.el).remove();\r\n\t\t\tdelete this.el;\r\n\t\t\tthis.listeners.splice(0, this.listeners.length);\r\n\t\t};\r\n\r\n\t\tdocument.body.appendChild(inst.el);\r\n\t}\t\r\n\treturn inst;\r\n};\r\n\r\n/**\r\n * \r\n */\r\nexports.getTestsInfoList=function (requirePath, cb){\r\n//\tconsole.log('getTestsInfoList ', requirePath);\r\n\tvar inst=exports.createTestingInstance();\r\n\tif(isNodeJS){\r\n\t\t/**\r\n\t\t * TO-DO: try to reuse the forked process\r\n\t\t */\r\n\t\tif(requirePath instanceof Array){\r\n\t\t\tvar sources=requirePath.slice(0),\t// copy the list\r\n\t\t\t\tallTests=[],\r\n\t\t\t\tcurrentTestsList=[];\r\n\t\t\tinst.onMessage(function sourceComplete(msg){\r\n\t\t\t\tif(msg.id=='testRead'){\r\n\t\t\t\t\tcurrentTestsList.push({\r\n\t\t\t\t\t\tmodule:msg.test.module?msg.test.module.name:'',\r\n\t\t\t\t\t\tfileName:msg.test.fileName,\r\n\t\t\t\t\t\tname:msg.test.name,\r\n\t\t\t\t\t\texpect:msg.test.expect\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}else if(msg.id=='allTestsRead'){\r\n\t\t\t\t\tallTests.push({\r\n\t\t\t\t\t\tfileName:sources.shift(),\r\n\t\t\t\t\t\ttests:currentTestsList\r\n\t\t\t\t\t});\r\n\t\t\t\t\tprocessNextSource();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tfunction processNextSource(){\r\n\t\t\t\tif(sources.length){\r\n\t\t\t\t\tcurrentTestsList=[];\r\n\t\t\t\t\tinst.sendMessage({\r\n\t\t\t\t\t\tid:'loadTestsSource',\r\n\t\t\t\t\t\tfileName:sources[0],\r\n\t\t\t\t\t\tfilePath:sources[0]\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tcb && cb(null, allTests);\r\n\t\t\t\t\tinst.disconnect();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprocessNextSource();\r\n\t\t}else{\r\n\t\t\tvar currentTestsList=[];\r\n\t\t\tinst.onMessage(function (msg){\r\n\t\t\t\tif(msg.id=='testRead'){\r\n\t\t\t\t\tcurrentTestsList.push({\r\n\t\t\t\t\t\tmodule:msg.test.module?msg.test.module.name:'',\r\n\t\t\t\t\t\tfileName:msg.test.fileName,\r\n\t\t\t\t\t\tname:msg.test.name,\r\n\t\t\t\t\t\texpect:msg.test.expect\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}else if(msg.id=='allTestsRead'){\r\n\t\t\t\t\tcb && cb(null, currentTestsList);\r\n\t\t\t\t\tinst.disconnect();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tinst.sendMessage({\r\n\t\t\t\tid:'loadTestsSource',\r\n\t\t\t\tfileName:requirePath,\r\n\t\t\t\tfilePath:requirePath\r\n\t\t\t});\r\n\t\t}\r\n\t}else{\r\n\t\t/**\r\n\t\t * not needed for now\r\n\t\t */\r\n\t}\r\n};\r\n\r\n}, typeof module=='object'?module:null);\r\n\r\n",
                "subject": "fixed to make it work in Firefox",
                "message": "fixed to make it work in Firefox",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "PerformanceHorizonGroup/JS-Browser-Driver,PerformanceHorizonGroup/JS-Browser-Driver"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10269,
            "row": {
                "commit": "f43a6434ca203ee18d4aaa7aeb2dd7a73ee988c0",
                "old_file": "js/example3/gauge.js",
                "new_file": "js/example3/gauge.js",
                "old_contents": "(function() {\n    dc.gauge = function(parent, chartGroup) {\n        var _chart = dc.colorMixin(dc.baseMixin({}));\n\n        var _sliceCssClass = \"pie-slice\";\n\n        var _domain = [ 0, 100 ];\n        var _gap = 1;\n        var _externalLabelRadius = 0;\n        var _innerRadiusPercentage = 0.5;\n        var _radius = 0;\n        var _maxAngle = 90;\n        var _minAngle = -90;\n        var _showLabels = false;\n        var _slices = 5;\n\n        function deg2rad(deg) {\n            return deg * Math.PI / 180;\n        }\n\n        function fill(d, i) {\n            return _chart.getColor(d.data, i);\n        }\n\n        function safeArc(d, i, arc) {\n            var path = arc(d, i);\n            if (path.indexOf(\"NaN\") >= 0) {\n                path = \"M0,0\";\n            }\n            return path;\n        }\n\n        function tweenPie(radius, innerRadius) {\n            return function(b) {\n                b.innerRadius = innerRadius;\n                var current = this._current;\n                if (!current || isNaN(current.startAngle) || isNaN(current.endAngle)) {\n                    current = {\n                        startAngle : 0,\n                        endAngle : 0\n                    };\n                }\n                var i = d3.interpolate(current, b);\n                this._current = i(0);\n                return function(t) {\n                    return safeArc(i(t), 0, d3.svg.arc().outerRadius(radius).innerRadius(innerRadius));\n                };\n            };\n        }\n\n        function positionLabels(labels, arc, radius, externalLabelRadius) {\n            dc.transition(labels, _chart.transitionDuration()).attr(\"transform\", function(d) {\n                var centroid;\n                if (externalLabelRadius) {\n                    centroid = d3.svg.arc().outerRadius(radius + externalLabelRadius).innerRadius(radius + externalLabelRadius).centroid(d);\n                } else {\n                    centroid = arc.centroid(d);\n                }\n                if (isNaN(centroid[0]) || isNaN(centroid[1])) {\n                    return \"translate(0,0)\";\n                } else {\n                    return \"translate(\" + centroid + \")\";\n                }\n            }).attr(\"text-anchor\", \"middle\").text(function(d) {\n                var data = d.data;\n                return _chart.label()(d.data);\n            });\n        }\n\n        function drawChart() {\n            // set radius on basis of chart dimension if missing\n            var radius = _radius ? _radius : (d3.min([_chart.width() / 2, _chart.height()]) - _externalLabelRadius);\n            var innerRadius = (_innerRadiusPercentage !== null ? d3.max([d3.min([ _innerRadiusPercentage, 1 ]), 0]) : 0.5) * radius;\n            var labelData = d3.scale.linear().range([0, 1]).domain(_domain).ticks(_slices);\n            var data = d3.range(_slices).map(function() { return 1/_slices; }).map(function(d, i) {\n                return { key: i, value: d };\n            });\n\n            var startRadian = deg2rad(_minAngle);\n            var endRadian = deg2rad(_maxAngle);\n\n            var arc = d3.svg.arc().outerRadius(radius).innerRadius(innerRadius);\n            var pie = d3.layout.pie().sort(null).startAngle(startRadian).endAngle(endRadian).value(_chart.valueAccessor());\n            var pieData = pie(data);\n\n            if (_g) {\n                // Get slices\n                var slices = _g.selectAll(\"g.\" + _sliceCssClass).data(pieData);\n\n                // Create elements\n                var slicesEnter = slices.enter().append(\"g\").attr(\"class\", function(d, i) {\n                    return _sliceCssClass + \" _\" + i;\n                });\n                var slicePath = slicesEnter.append(\"path\").attr(\"fill\", fill).attr(\"d\", function(d, i) {\n                    return safeArc(d, i, arc);\n                });\n                dc.transition(slicePath, _chart.transitionDuration(), function(s) {\n                    s.attrTween(\"d\", tweenPie(radius, innerRadius, endRadian, endRadian));\n                });\n\n                // Update elements\n                var slicePaths = _g.selectAll(\"g.\" + _sliceCssClass).data(pieData).select(\"path\").attr(\"d\", function(d, i) {\n                    return safeArc(d, i, arc);\n                });\n                dc.transition(slicePaths, _chart.transitionDuration(), function(s) {\n                    s.attrTween(\"d\", tweenPie(radius, innerRadius, endRadian, endRadian));\n                }).attr(\"fill\", fill);\n\n                // Remove elements\n                slices.exit().remove();\n\n//                // Update Labels\n//                var labels = _g.selectAll(\"text.\" + _sliceCssClass);\n//                if (_chart.renderLabel()) {\n//                    labels.data(pieData);\n//                    labels.exit().remove();\n//                    var labelsEnter = labels.enter().append(\"text\").attr(\"class\", function(d, i) {\n//                        var classes = _sliceCssClass + \" _\" + i;\n//                        if (_externalLabelRadius) {\n//                            classes += \" external\";\n//                        }\n//                        return classes;\n//                    });\n//                    positionLabels(labels, arc, radius, _externalLabelRadius);\n//                }\n            }\n        }\n\n        _chart._doRender = function() {\n            _chart.resetSvg();\n            _g = _chart.svg().append(\"g\")\n                .attr(\"transform\", \"translate(\" + (_chart.width() / 2) + \", \" + _chart.height() + \")\");\n            drawChart();\n            return _chart;\n        };\n\n        _chart._doRedraw = function() {\n            drawChart();\n            return _chart;\n        };\n\n        _chart.domain = function(_) {\n            if (!arguments.length) {\n                return _domain;\n            }\n            _domain = _;\n            return _chart;\n        };\n\n        _chart.externalLabelRadius = function(_) {\n            if (!arguments.length) {\n                return _externalLabelRadius;\n            }\n            _externalLabelRadius = _;\n            return _chart;\n        };\n\n        _chart.gap = function(_) {\n            if (!arguments.length) {\n                return _gap;\n            }\n            _gap = _;\n            return _chart;\n        };\n\n        _chart.innerRadiusPercentage = function(_) {\n            if (!arguments.length) {\n                return _innerRadiusPercentage;\n            }\n            _innerRadiusPercentage = _;\n            return _chart;\n        };\n\n        _chart.maxAngle = function(_) {\n            if (!arguments.length) {\n                return _maxAngle;\n            }\n            _maxAngle = _;\n            return _chart;\n        };\n\n        _chart.minAngle = function(_) {\n            if (!arguments.length) {\n                return _minAngle;\n            }\n            _minAngle = _;\n            return _chart;\n        };\n\n        _chart.radius = function(_) {\n            if (!arguments.length) {\n                return _radius;\n            }\n            _radius = _;\n            return _chart;\n        };\n\n        _chart.slices = function(_) {\n            if (!arguments.length) {\n                return _slices;\n            }\n            _slices = _;\n            return _chart;\n        };\n\n        return _chart.anchor(parent, chartGroup);\n    };\n})();\n",
                "new_contents": "(function() {\n    dc.gauge = function(parent, chartGroup) {\n        var _chart = dc.colorMixin(dc.baseMixin({}));\n\n        var _sliceCssClass = \"pie-slice\";\n\n        var _domain = [ 0, 100 ];\n        var _gap = 1;\n        var _externalLabelRadius = 0;\n        var _innerRadiusPercentage = 0.5;\n        var _radius = 0;\n        var _maxAngle = 90;\n        var _minAngle = -90;\n        var _showLabels = false;\n        var _slices = 5;\n\n        function deg2rad(deg) {\n            return deg * Math.PI / 180;\n        }\n\n        function fill(d, i) {\n            return _chart.getColor(d.data, i);\n        }\n\n        function safeArc(d, i, arc) {\n            var path = arc(d, i);\n            if (path.indexOf(\"NaN\") >= 0) {\n                path = \"M0,0\";\n            }\n            return path;\n        }\n\n        function tweenPie(radius, innerRadius) {\n            return function(b) {\n                b.innerRadius = innerRadius;\n                var current = this._current;\n                if (!current || isNaN(current.startAngle) || isNaN(current.endAngle)) {\n                    current = {\n                        startAngle : 0,\n                        endAngle : 0\n                    };\n                }\n                var i = d3.interpolate(current, b);\n                this._current = i(0);\n                return function(t) {\n                    return safeArc(i(t), 0, d3.svg.arc().outerRadius(radius).innerRadius(innerRadius));\n                };\n            };\n        }\n\n        function positionLabels(labels, arc, radius, externalLabelRadius) {\n            dc.transition(labels, _chart.transitionDuration()).attr(\"transform\", function(d) {\n                var centroid;\n                if (externalLabelRadius) {\n                    centroid = d3.svg.arc().outerRadius(radius + externalLabelRadius).innerRadius(radius + externalLabelRadius).centroid(d);\n                } else {\n                    centroid = arc.centroid(d);\n                }\n                if (isNaN(centroid[0]) || isNaN(centroid[1])) {\n                    return \"translate(0,0)\";\n                } else {\n                    return \"translate(\" + centroid + \")\";\n                }\n            }).attr(\"text-anchor\", \"middle\").text(function(d) {\n                var data = d.data;\n                return _chart.label()(d.data);\n            });\n        }\n\n        function drawChart() {\n            // set radius on basis of chart dimension if missing\n            var radius = (_radius ? _radius : Math.min(_chart.width() / 2, _chart.height())) - _externalLabelRadius;\n            var innerRadius = (_innerRadiusPercentage !== null ? Math.max(Math.min(_innerRadiusPercentage, 1), 0) : 0.5) * radius;\n            var labelData = d3.scale.linear().range([0, 1]).domain(_domain).ticks(_slices);\n            var data = d3.range(_slices).map(function() { return 1/_slices; }).map(function(d, i) {\n                return { key: i, value: d };\n            });\n\n            var startRadian = deg2rad(_minAngle);\n            var endRadian = deg2rad(_maxAngle);\n\n            var arc = d3.svg.arc().outerRadius(radius).innerRadius(innerRadius);\n            var pie = d3.layout.pie().sort(null).startAngle(startRadian).endAngle(endRadian).value(_chart.valueAccessor());\n            var pieData = pie(data);\n\n            if (_g) {\n                // Get slices\n                var slices = _g.selectAll(\"g.\" + _sliceCssClass).data(pieData);\n\n                // Create elements\n                var slicesEnter = slices.enter().append(\"g\").attr(\"class\", function(d, i) {\n                    return _sliceCssClass + \" _\" + i;\n                });\n                var slicePath = slicesEnter.append(\"path\").attr(\"fill\", fill).attr(\"d\", function(d, i) {\n                    return safeArc(d, i, arc);\n                });\n                dc.transition(slicePath, _chart.transitionDuration(), function(s) {\n                    s.attrTween(\"d\", tweenPie(radius, innerRadius, endRadian, endRadian));\n                });\n\n                // Update elements\n                var slicePaths = _g.selectAll(\"g.\" + _sliceCssClass).data(pieData).select(\"path\").attr(\"d\", function(d, i) {\n                    return safeArc(d, i, arc);\n                });\n                dc.transition(slicePaths, _chart.transitionDuration(), function(s) {\n                    s.attrTween(\"d\", tweenPie(radius, innerRadius, endRadian, endRadian));\n                }).attr(\"fill\", fill);\n\n                // Remove elements\n                slices.exit().remove();\n\n//                // Update Labels\n//                var labels = _g.selectAll(\"text.\" + _sliceCssClass);\n//                if (_chart.renderLabel()) {\n//                    labels.data(pieData);\n//                    labels.exit().remove();\n//                    var labelsEnter = labels.enter().append(\"text\").attr(\"class\", function(d, i) {\n//                        var classes = _sliceCssClass + \" _\" + i;\n//                        if (_externalLabelRadius) {\n//                            classes += \" external\";\n//                        }\n//                        return classes;\n//                    });\n//                    positionLabels(labels, arc, radius, _externalLabelRadius);\n//                }\n            }\n        }\n\n        _chart._doRender = function() {\n            _chart.resetSvg();\n            _g = _chart.svg().append(\"g\")\n                .attr(\"transform\", \"translate(\" + (_chart.width() / 2) + \", \" + _chart.height() + \")\");\n            drawChart();\n            return _chart;\n        };\n\n        _chart._doRedraw = function() {\n            drawChart();\n            return _chart;\n        };\n\n        _chart.domain = function(_) {\n            if (!arguments.length) {\n                return _domain;\n            }\n            _domain = _;\n            return _chart;\n        };\n\n        _chart.externalLabelRadius = function(_) {\n            if (!arguments.length) {\n                return _externalLabelRadius;\n            }\n            _externalLabelRadius = _;\n            return _chart;\n        };\n\n        _chart.gap = function(_) {\n            if (!arguments.length) {\n                return _gap;\n            }\n            _gap = _;\n            return _chart;\n        };\n\n        _chart.innerRadiusPercentage = function(_) {\n            if (!arguments.length) {\n                return _innerRadiusPercentage;\n            }\n            _innerRadiusPercentage = _;\n            return _chart;\n        };\n\n        _chart.maxAngle = function(_) {\n            if (!arguments.length) {\n                return _maxAngle;\n            }\n            _maxAngle = _;\n            return _chart;\n        };\n\n        _chart.minAngle = function(_) {\n            if (!arguments.length) {\n                return _minAngle;\n            }\n            _minAngle = _;\n            return _chart;\n        };\n\n        _chart.radius = function(_) {\n            if (!arguments.length) {\n                return _radius;\n            }\n            _radius = _;\n            return _chart;\n        };\n\n        _chart.slices = function(_) {\n            if (!arguments.length) {\n                return _slices;\n            }\n            _slices = _;\n            return _chart;\n        };\n\n        return _chart.anchor(parent, chartGroup);\n    };\n})();\n",
                "subject": "Updates to gauge",
                "message": "Updates to gauge\n",
                "lang": "JavaScript",
                "license": "apache-2.0",
                "repos": "mtraynham/charts"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10270,
            "row": {
                "commit": "0d1e4c88c4995e552d332fef479a9f20c9c69b78",
                "old_file": "client/planner-page/index.js",
                "new_file": "client/planner-page/index.js",
                "old_contents": "var config = require('config');\nvar FeedbackModal = require('feedback-modal');\nvar FilterView = require('filter-view');\nvar HelpMeChoose = require('help-me-choose-view');\nvar LeafletTransitiveLayer = require('Leaflet.TransitiveLayer');\nvar LocationsView = require('locations-view');\nvar log = require('./client/log')('planner-page');\nvar showMapView = require('map-view');\nvar OptionsView = require('options-view');\nvar PlannerNav = require('planner-nav');\nvar querystring = require('querystring');\nvar scrollbarSize = require('scrollbar-size');\nvar scrolling = require('scrolling');\nvar session = require('session');\nvar textModal = require('text-modal');\n//var transitive = require('transitive');\nvar ua = require('user-agent');\nvar view = require('view');\nvar showWelcomeWizard = require('welcome-flow');\nvar showPlannerWalkthrough = require('planner-walkthrough');\nvar geocode = require('geocode');\n\n\nvar FROM = config.geocode().start_address;\nvar TO = config.geocode().end_address;\nvar isMobile = window.innerWidth <= 480;\nvar center = config.geocode().center.split(',').map(parseFloat);\n\nvar View = view(require('./template.html'), function(view, model) {\n  view.scrollable = view.find('.scrollable');\n  view.panelFooter = view.find('.footer');\n\n  if (scrollbarSize > 0) {\n    if (ua.os.name === 'Windows' || ua.browser.name !== 'Chrome')\n      view.scrollable.style.marginRight = -scrollbarSize + 'px';\n\n    // Scrollbars are fun and implemented the same on every OS/Browser...right\n    if (ua.os.name === 'Windows' && ua.browser.name === 'Chrome')\n      view.scrollable.style.paddingRight = scrollbarSize + 'px';\n  }\n});\n\n/**\n * Expose `render`\n */\n\nmodule.exports = function(ctx, next) {\n  log('render');\n\n  var plan = ctx.plan;\n  var query = querystring.parse(window.location.search);\n\n  // Set up the views\n  var views = {\n    'filter-view': new FilterView(plan),\n    'locations-view': new LocationsView(plan),\n    'options-view': new OptionsView(plan),\n    'planner-nav': new PlannerNav(session)\n  };\n\n  ctx.view = new View(views);\n  ctx.view.on('rendered', function() {\n    // Set plan to loading\n    plan.loading(true);\n\n    for (var key in views) {\n      views[key].emit('rendered', views[key]);\n    }\n\n    // Show the map\n    var map = showMapView(ctx.view.find('.MapView'));\n\n    console.log(\"map ->\", map);\n\n    // Create the transitive layer\n    //var transitiveLayer = new LeafletTransitiveLayer(transitive);\n\n    // Set the transitive layer\n    //map.addLayer(transitiveLayer);\n\n    // Update map on plan change\n    updateMapOnPlanChange(plan, map);\n\n    map.on('click', function (e) {\n          var from = plan.from_ll();\n          var to = plan.to_ll();\n          if (!plan.coordinateIsValid(from)) {\n            plan.journey({\n          places: [\n            {\n              place_id: 'from',\n             place_lat: e.latlng.lat,\n              place_lon: e.latlng.lng,\n              place_name: 'From'\n           },\n            {\n              place_id: 'to',\n             place_lat: (plan.to_ll() ? plan.to_ll().lat : 0),\n              place_lon: (plan.to_ll() ? plan.to_ll().lng : 0),\n              place_name: 'To'\n            }\n          ]\n        });\n        plan.setAddress('from', e.latlng.lng + ',' + e.latlng.lat, function (err, res) {\n            plan.updateRoutes();\n        });\n          } else if (!plan.coordinateIsValid(to)) {\n        plan.journey({\n          places: [\n            {\n              place_id: 'from',\n              place_lat: plan.from_ll().lat,\n             place_lon: plan.from_ll().lng,\n              place_name: 'From'\n            },\n           {\n              place_id: 'to',\n              place_lat: e.latlng.lat,\n              place_lon: e.latlng.lng,\n              place_name: 'To'\n            }\n          ]\n        });\n        plan.setAddress('to', e.latlng.lng + ',' + e.latlng.lat, function (err, res) {\n            plan.updateRoutes();\n        });\n          }\n    });\n\n\n\n\n    // Clear plan & cookies for now, plan will re-save automatically on save\n      var from = plan.from_ll();\n      var to = plan.to_ll();\n      //plan.clearStore();\n\n    // If it's a shared URL or welcome is complete skip the welcome screen\n    console.log(\"query ->\", query);\n    if ((query.from && query.to)) {\n      showQuery(query);\n    } else {\n      console.log(\"plan.coordinateIsValid(from)\", plan.coordinateIsValid(from));\n      console.log(\"plan.coordinateIsValid(to)\", plan.coordinateIsValid(to));\n\n      if (plan.coordinateIsValid(from) && plan.coordinateIsValid(to)) {\n          plan.setAddresses(\n            from.lng + ',' + from.lat, // from\n            to.lng + ',' + to.lat, // to\n            function (err, res) {\n              plan.updateRoutes();\n              console.log(\"aqui la data del plan 4 ->\", plan.dataplan);\n            }\n          );\n          plan.updateRoutes();\n          console.log(\"aqui la data del plan 3 ->\", plan.dataplan);\n      } else {\n          console.log(from);\n          console.log(to);\n          plan.loading(false);\n      }\n    }\n  });\n\n  plan.on('updating options', function() {\n    ctx.view.panelFooter.classList.add('hidden');\n  });\n\n  plan.on('updating options complete', function(res) {\n    if (res && !res.err) ctx.view.panelFooter.classList.remove('hidden');\n  });\n\n  next();\n};\n\n/**\n * Reverse Commute\n */\n\nView.prototype.reverseCommute = function(e) {\n  e.preventDefault();\n  var plan = session.plan();\n  plan.set({\n    from: plan.to(),\n    from_id: plan.to_id(),\n    from_ll: plan.to_ll(),\n    to: plan.from(),\n    to_id: plan.from_id(),\n    to_ll: plan.from_ll()\n  });\n\n  plan.updateRoutes();\n\n  console.log(\"aqui la data del plan 5 ->\", plan.dataplan);\n};\n\n/**\n * Scroll\n */\n\nView.prototype.scroll = function(e) {\n  e.preventDefault();\n  this.scrollable.scrollTop += (this.scrollable.scrollHeight / 5);\n};\n\n/**\n * On submit\n */\n\nView.prototype.onsubmit = function(e) {\n  e.preventDefault();\n};\n\n/**\n * Help Me Choose\n */\n\nView.prototype.helpMeChoose = function(e) {\n  HelpMeChoose(session.plan().options()).show();\n};\n\n/**\n * Show feedback modal\n */\nView.prototype.feedback = function(e) {\n  e.preventDefault();\n  FeedbackModal().show();\n};\n\n/**\n * Hide Side Panel\n */\n\nView.prototype.hideSidePanel = function (e) {\n  var sidePanel = $('.SidePanel');\n  var fullscreen = $('.fullscreen');\n  var width = sidePanel.width();\n  var map = showMapView.getMap();\n\n  sidePanel.css({\n    'transition': 'transform 2s',\n    '-webkit-transition': '-webkit-transform 2s',\n    'transform': 'translate3d(' + width + 'px, 0, 0)'\n  });\n\n  fullscreen.css({\n    'transition': 'padding 2s',\n    'padding': '0'\n  });\n\n  setTimeout(function () {\n    map.invalidateSize();\n  }, 2100)\n};\n\n/**\n * Show Side Panel\n */\n\nView.prototype.showSidePanel = function (e) {\n  var sidePanel = $('.SidePanel');\n  var fullscreen = $('.fullscreen');\n  var width = sidePanel.width();\n  var map = showMapView.getMap();\n\n  sidePanel.css({\n    'transition': 'transform 2s',\n    '-webkit-transition': '-webkit-transform 2s',\n    'transform': 'translate3d(0, 0, 0)'\n  });\n\n  fullscreen.css({\n    'transition': 'padding 2s',\n    'padding-right': '320px'\n  });\n\n  setTimeout(function () {\n    var plan = session.plan();\n    map.invalidateSize();\n\n    plan = session.plan();\n    plan.updateRoutes();\n    //transitive.updateData(plan.journey());\n\n    plan.journey();\n\n  }, 2100)\n};\n\n/**\n * Show Journey\n */\n\nfunction showQuery(query) {\n  var plan = session.plan();\n  // If no querystring, see if we have them in the plan already\n  var from = query.from || plan.from() || FROM;\n  var to = query.to || plan.to() || TO;\n  var sameAddresses = from === plan.from() && to === plan.to();\n\n  // Set plan from querystring\n  if (query.modes) plan.setModes(query.modes);\n  if (query.start_time !== undefined) plan.start_time(parseInt(query.start_time, 10));\n  if (query.end_time !== undefined) plan.end_time(parseInt(query.end_time, 10));\n  if (query.days !== undefined) plan.days(query.days);\n\n  // If has valid coordinates, load\n  if (plan.validCoordinates() && sameAddresses) {\n    plan.journey({\n      places: plan.generatePlaces()\n    });\n    plan.updateRoutes();\n\n    console.log(\"aqui la data del plan 1 ->\", plan.dataplan);\n  } else {\n      if (!plan.validCoordinates()) {\n\t  plan.loading(false);\n\t  return;\n      } else {\n    // Set addresses and update the routes\n    plan.setAddresses(from, to, function(err) {\n      if (err) {\n        log.error('%e', err);\n      } else {\n        plan.journey({\n          places: plan.generatePlaces()\n        });\n        plan.updateRoutes();\n\n        console.log(\"aqui la data del plan 2 ->\", plan.dataplan);\n      }\n    });\n}\n  }\n}\n\n/**\n * Update Map on plan change\n */\n\nfunction updateMapOnPlanChange(plan, map) {\n  // Register plan update events\n    /*\n    for (i in map._layers) {\n        if (map._layers[i].options.format == undefined) {\n            try {\n                map.removeLayer(map._layers[i]);\n            } catch (e) {\n                console.log(\"problem with \" + e + map._layers[i]);\n            }\n        }\n    }\n    */\n\n\n    //map.removeLayer(polyline);\n/*\n\n  for (i in polyline_creadas) {\n        try {\n                map.removeLayer(polyline_creadas[i]);\n            } catch (e) {\n                console.log(\"problem with \" + e + map._layers[i]);\n            }\n\n  }\n  */\n\n  plan.on('change journey', function(journey) {\n\n  showMapView.cleanPolyline();\n  showMapView.cleanMarker();\n\n    if (journey && !isMobile) {\n      try {\n\n        log('updating data');\n\n        var datajourney = journey;\n        if (!(plan.dataplan.plan === undefined)) {\n            var new_plan = plan.dataplan.plan;\n            var itineraries = new_plan.itineraries;\n            console.log(\"plan actual\", plan);\n            var patterns = plan.dataplan.patterns;\n            var routes = plan.dataplan.routes;\n            console.log(\"patterns\", patterns);\n            console.log(\"routes\", routes);\n            console.log(\"itineraries\", itineraries);\n            showMapView.marker_map([new_plan.from.lat,new_plan.from.lon],[new_plan.to.lat,new_plan.to.lon], map);\n            for (i = 0; i < itineraries.length; i++) {\n                for (ii=0; ii < itineraries[i].legs.length; ii++) {\n                  console.log(\"legs[ii]\", itineraries[i].legs[ii]);\n                  var circle = [itineraries[i].legs[ii].to.lat, itineraries[i].legs[ii].to.lon, itineraries[i].legs[ii].to.name];\n                  //console.log(\"circle\", circle);\n\n\n                  showMapView.marker_map_point(circle, map);\n                  //\n                  if (itineraries[i].legs[ii].steps.length > 0){\n                     console.log(\"itineraries[i].legs[ii].steps.length\", itineraries[i].legs[ii].steps.length);\n                     var step_count = itineraries[i].legs[ii].steps.length;\n                     var step_div = parseFloat(step_count / 2);\n                     var current_step = Math.ceil(step_div);\n                      console.log(\"step_count ->\", step_count, \"step_div ->\", step_div, \"current_step ->\", current_step);\n                      console.log(\"---------------------\");\n                  }\n\n                  //for (i = 0; i < itineraries[i].legs[ii].steps.length; i++) {\n                  //     var circle2 = [itineraries[i].legs[ii].steps[i].lat, itineraries[i].legs[ii].steps[i].lon, ''];\n                  //\n                  //     //showMapView.marker_map_point(circle2, map);\n                  //}\n                  showMapView.drawRouteAmigo(itineraries[i].legs[ii].legGeometry.points, itineraries[i].legs[ii].mode);\n                }\n            }\n\n            //for (var k = 0; k < patterns.length; k++) {\n            //  var route_id = patterns[k].routeId;\n            //  var route_id_split = route_id.split(\":\");\n            //  var agency = route_id_split[0].toLowerCase();\n            //  var line = route_id_split[1].toLowerCase();\n            //  var routeId = route_id_split[0] + ':' + route_id_split[1];\n            //  console.log(\"agency ->\", agency, \"line ->\", line, \"routeId ->\", routeId);\n            //\n            //}\n            //\n            //for (var n = 0; n < routes.length; n++) {\n            //  var route_short_name = routes[n].shortName;\n            //  var route_long_name = routes[n].longName.toUpperCase();\n            //  console.log(\"route_short_name ->\", route_short_name, \"route_long_name ->\", route_long_name);\n            //\n            //}\n          console.log(\"entre if \")\n        }else{\n            console.log(\"ejecuta storage\");\n            var sesion_plan = JSON.parse(localStorage.getItem('dataplan'));\n            if(!(sesion_plan === null)) {\n                var itineraries = sesion_plan.itineraries;\n\n                showMapView.marker_map([sesion_plan.from.lat,sesion_plan.from.lon],[sesion_plan.to.lat,sesion_plan.to.lon], map);\n\n                for (i = 0; i < itineraries.length; i++) {\n                    for (ii=0; ii < itineraries[i].legs.length; ii++) {\n                      var circle = [itineraries[i].legs[ii].to.lat, itineraries[i].legs[ii].to.lon, itineraries[i].legs[ii].to.name];\n                      //console.log(\"circle\", circle);\n                      showMapView.marker_map_point(circle, map);\n                      showMapView.drawRouteAmigo(itineraries[i].legs[ii].legGeometry.points, itineraries[i].legs[ii].mode);\n                    }\n                }\n            }\n\n        }\n      } catch (e) {\n        console.log(\"entre cath\")\n\t    map.setView([center[1], center[0]], config.geocode().zoom);\n      }\n\n    }\n  });\n}\n\n\n/////////////function test circle maps  ////\n\nfunction getRouteId(patternId, patterns) {\n  for (var i = 0; i < patterns.length; i++) {\n    var pattern = patterns[i];\n    if (pattern.pattern_id === patternId) return pattern.route_id;\n  }\n}\n\nfunction getRoute(routeId, routes) {\n  for (var i = 0; i < routes.length; i++) {\n    var route = routes[i];\n    if (route.route_id === routeId) return route;\n  }\n}\n\nfunction getRouteShield(agency, route) {\n  if (agency === 'dc' && route.route_type === 1) return 'M';\n  return route.route_short_name || route.route_long_name.toUpperCase();\n}\n",
                "new_contents": "var config = require('config');\nvar FeedbackModal = require('feedback-modal');\nvar FilterView = require('filter-view');\nvar HelpMeChoose = require('help-me-choose-view');\nvar LeafletTransitiveLayer = require('Leaflet.TransitiveLayer');\nvar LocationsView = require('locations-view');\nvar log = require('./client/log')('planner-page');\nvar showMapView = require('map-view');\nvar OptionsView = require('options-view');\nvar PlannerNav = require('planner-nav');\nvar querystring = require('querystring');\nvar scrollbarSize = require('scrollbar-size');\nvar scrolling = require('scrolling');\nvar session = require('session');\nvar textModal = require('text-modal');\n//var transitive = require('transitive');\nvar ua = require('user-agent');\nvar view = require('view');\nvar showWelcomeWizard = require('welcome-flow');\nvar showPlannerWalkthrough = require('planner-walkthrough');\nvar geocode = require('geocode');\n\n\nvar FROM = config.geocode().start_address;\nvar TO = config.geocode().end_address;\nvar isMobile = window.innerWidth <= 480;\nvar center = config.geocode().center.split(',').map(parseFloat);\n\nvar View = view(require('./template.html'), function(view, model) {\n  view.scrollable = view.find('.scrollable');\n  view.panelFooter = view.find('.footer');\n\n  if (scrollbarSize > 0) {\n    if (ua.os.name === 'Windows' || ua.browser.name !== 'Chrome')\n      view.scrollable.style.marginRight = -scrollbarSize + 'px';\n\n    // Scrollbars are fun and implemented the same on every OS/Browser...right\n    if (ua.os.name === 'Windows' && ua.browser.name === 'Chrome')\n      view.scrollable.style.paddingRight = scrollbarSize + 'px';\n  }\n});\n\n/**\n * Expose `render`\n */\n\nmodule.exports = function(ctx, next) {\n  log('render');\n\n  var plan = ctx.plan;\n  var query = querystring.parse(window.location.search);\n\n  // Set up the views\n  var views = {\n    'filter-view': new FilterView(plan),\n    'locations-view': new LocationsView(plan),\n    'options-view': new OptionsView(plan),\n    'planner-nav': new PlannerNav(session)\n  };\n\n  ctx.view = new View(views);\n  ctx.view.on('rendered', function() {\n    // Set plan to loading\n    plan.loading(true);\n\n    for (var key in views) {\n      views[key].emit('rendered', views[key]);\n    }\n\n    // Show the map\n    var map = showMapView(ctx.view.find('.MapView'));\n\n    console.log(\"map ->\", map);\n\n    // Create the transitive layer\n    //var transitiveLayer = new LeafletTransitiveLayer(transitive);\n\n    // Set the transitive layer\n    //map.addLayer(transitiveLayer);\n\n    // Update map on plan change\n    updateMapOnPlanChange(plan, map);\n\n    map.on('click', function (e) {\n          var from = plan.from_ll();\n          var to = plan.to_ll();\n          if (!plan.coordinateIsValid(from)) {\n            plan.journey({\n          places: [\n            {\n              place_id: 'from',\n             place_lat: e.latlng.lat,\n              place_lon: e.latlng.lng,\n              place_name: 'From'\n           },\n            {\n              place_id: 'to',\n             place_lat: (plan.to_ll() ? plan.to_ll().lat : 0),\n              place_lon: (plan.to_ll() ? plan.to_ll().lng : 0),\n              place_name: 'To'\n            }\n          ]\n        });\n        plan.setAddress('from', e.latlng.lng + ',' + e.latlng.lat, function (err, res) {\n            plan.updateRoutes();\n        });\n          } else if (!plan.coordinateIsValid(to)) {\n        plan.journey({\n          places: [\n            {\n              place_id: 'from',\n              place_lat: plan.from_ll().lat,\n             place_lon: plan.from_ll().lng,\n              place_name: 'From'\n            },\n           {\n              place_id: 'to',\n              place_lat: e.latlng.lat,\n              place_lon: e.latlng.lng,\n              place_name: 'To'\n            }\n          ]\n        });\n        plan.setAddress('to', e.latlng.lng + ',' + e.latlng.lat, function (err, res) {\n            plan.updateRoutes();\n        });\n          }\n    });\n\n\n\n\n    // Clear plan & cookies for now, plan will re-save automatically on save\n      var from = plan.from_ll();\n      var to = plan.to_ll();\n      //plan.clearStore();\n\n    // If it's a shared URL or welcome is complete skip the welcome screen\n    console.log(\"query ->\", query);\n    if ((query.from && query.to)) {\n      showQuery(query);\n    } else {\n      console.log(\"plan.coordinateIsValid(from)\", plan.coordinateIsValid(from));\n      console.log(\"plan.coordinateIsValid(to)\", plan.coordinateIsValid(to));\n\n      if (plan.coordinateIsValid(from) && plan.coordinateIsValid(to)) {\n          plan.setAddresses(\n            from.lng + ',' + from.lat, // from\n            to.lng + ',' + to.lat, // to\n            function (err, res) {\n              plan.updateRoutes();\n              console.log(\"aqui la data del plan 4 ->\", plan.dataplan);\n            }\n          );\n          plan.updateRoutes();\n          console.log(\"aqui la data del plan 3 ->\", plan.dataplan);\n      } else {\n          console.log(from);\n          console.log(to);\n          plan.loading(false);\n      }\n    }\n  });\n\n  plan.on('updating options', function() {\n    ctx.view.panelFooter.classList.add('hidden');\n  });\n\n  plan.on('updating options complete', function(res) {\n    if (res && !res.err) ctx.view.panelFooter.classList.remove('hidden');\n  });\n\n  next();\n};\n\n/**\n * Reverse Commute\n */\n\nView.prototype.reverseCommute = function(e) {\n  e.preventDefault();\n  var plan = session.plan();\n  plan.set({\n    from: plan.to(),\n    from_id: plan.to_id(),\n    from_ll: plan.to_ll(),\n    to: plan.from(),\n    to_id: plan.from_id(),\n    to_ll: plan.from_ll()\n  });\n\n  plan.updateRoutes();\n\n  console.log(\"aqui la data del plan 5 ->\", plan.dataplan);\n};\n\n/**\n * Scroll\n */\n\nView.prototype.scroll = function(e) {\n  e.preventDefault();\n  this.scrollable.scrollTop += (this.scrollable.scrollHeight / 5);\n};\n\n/**\n * On submit\n */\n\nView.prototype.onsubmit = function(e) {\n  e.preventDefault();\n};\n\n/**\n * Help Me Choose\n */\n\nView.prototype.helpMeChoose = function(e) {\n  HelpMeChoose(session.plan().options()).show();\n};\n\n/**\n * Show feedback modal\n */\nView.prototype.feedback = function(e) {\n  e.preventDefault();\n  FeedbackModal().show();\n};\n\n/**\n * Hide Side Panel\n */\n\nView.prototype.hideSidePanel = function (e) {\n  var sidePanel = $('.SidePanel');\n  var fullscreen = $('.fullscreen');\n  var width = sidePanel.width();\n  var map = showMapView.getMap();\n\n  sidePanel.css({\n    'transition': 'transform 2s',\n    '-webkit-transition': '-webkit-transform 2s',\n    'transform': 'translate3d(' + width + 'px, 0, 0)'\n  });\n\n  fullscreen.css({\n    'transition': 'padding 2s',\n    'padding': '0'\n  });\n\n  setTimeout(function () {\n    map.invalidateSize();\n  }, 2100)\n};\n\n/**\n * Show Side Panel\n */\n\nView.prototype.showSidePanel = function (e) {\n  var sidePanel = $('.SidePanel');\n  var fullscreen = $('.fullscreen');\n  var width = sidePanel.width();\n  var map = showMapView.getMap();\n\n  sidePanel.css({\n    'transition': 'transform 2s',\n    '-webkit-transition': '-webkit-transform 2s',\n    'transform': 'translate3d(0, 0, 0)'\n  });\n\n  fullscreen.css({\n    'transition': 'padding 2s',\n    'padding-right': '320px'\n  });\n\n  setTimeout(function () {\n    var plan = session.plan();\n    map.invalidateSize();\n\n    plan = session.plan();\n    plan.updateRoutes();\n    //transitive.updateData(plan.journey());\n\n    plan.journey();\n\n  }, 2100)\n};\n\n/**\n * Show Journey\n */\n\nfunction showQuery(query) {\n  var plan = session.plan();\n  // If no querystring, see if we have them in the plan already\n  var from = query.from || plan.from() || FROM;\n  var to = query.to || plan.to() || TO;\n  var sameAddresses = from === plan.from() && to === plan.to();\n\n  // Set plan from querystring\n  if (query.modes) plan.setModes(query.modes);\n  if (query.start_time !== undefined) plan.start_time(parseInt(query.start_time, 10));\n  if (query.end_time !== undefined) plan.end_time(parseInt(query.end_time, 10));\n  if (query.days !== undefined) plan.days(query.days);\n\n  // If has valid coordinates, load\n  if (plan.validCoordinates() && sameAddresses) {\n    plan.journey({\n      places: plan.generatePlaces()\n    });\n    plan.updateRoutes();\n\n    console.log(\"aqui la data del plan 1 ->\", plan.dataplan);\n  } else {\n      if (!plan.validCoordinates()) {\n\t  plan.loading(false);\n\t  return;\n      } else {\n    // Set addresses and update the routes\n    plan.setAddresses(from, to, function(err) {\n      if (err) {\n        log.error('%e', err);\n      } else {\n        plan.journey({\n          places: plan.generatePlaces()\n        });\n        plan.updateRoutes();\n\n        console.log(\"aqui la data del plan 2 ->\", plan.dataplan);\n      }\n    });\n}\n  }\n}\n\n/**\n * Update Map on plan change\n */\n\nfunction updateMapOnPlanChange(plan, map) {\n  // Register plan update events\n    /*\n    for (i in map._layers) {\n        if (map._layers[i].options.format == undefined) {\n            try {\n                map.removeLayer(map._layers[i]);\n            } catch (e) {\n                console.log(\"problem with \" + e + map._layers[i]);\n            }\n        }\n    }\n    */\n\n\n    //map.removeLayer(polyline);\n/*\n\n  for (i in polyline_creadas) {\n        try {\n                map.removeLayer(polyline_creadas[i]);\n            } catch (e) {\n                console.log(\"problem with \" + e + map._layers[i]);\n            }\n\n  }\n  */\n\n  plan.on('change journey', function(journey) {\n\n  showMapView.cleanPolyline();\n  showMapView.cleanMarker();\n\n    if (journey && !isMobile) {\n      try {\n\n        log('updating data');\n\n        var datajourney = journey;\n        if (!(plan.dataplan.plan === undefined)) {\n            var new_plan = plan.dataplan.plan;\n            var itineraries = new_plan.itineraries;\n            console.log(\"plan actual\", plan);\n            var patterns = plan.dataplan.patterns;\n            var routes = plan.dataplan.routes;\n            console.log(\"patterns\", patterns);\n            console.log(\"routes\", routes);\n            console.log(\"itineraries\", itineraries);\n            showMapView.marker_map([new_plan.from.lat,new_plan.from.lon],[new_plan.to.lat,new_plan.to.lon], map);\n            for (i = 0; i < itineraries.length; i++) {\n                for (ii=0; ii < itineraries[i].legs.length; ii++) {\n                  console.log(\"legs[ii]\", itineraries[i].legs[ii]);\n\n                  var circle = [itineraries[i].legs[ii].to.lat, itineraries[i].legs[ii].to.lon, itineraries[i].legs[ii].to.name];\n                  //console.log(\"circle\", circle);\n\n\n                  //showMapView.marker_map_point(circle, map);\n                  //\n                  //if (itineraries[i].legs[ii].steps.length > 0){\n                  //   console.log(\"itineraries[i].legs[ii].steps.length\", itineraries[i].legs[ii].steps.length);\n                  //   var step_count = itineraries[i].legs[ii].steps.length;\n                  //   var step_div = parseFloat(step_count / 2);\n                  //   var current_step = Math.ceil(step_div);\n                  //    console.log(\"step_count ->\", step_count, \"step_div ->\", step_div, \"current_step ->\", current_step);\n                  //    console.log(\"---------------------\");\n                  //}\n\n                  //for (i = 0; i < itineraries[i].legs[ii].steps.length; i++) {\n                  //     var circle2 = [itineraries[i].legs[ii].steps[i].lat, itineraries[i].legs[ii].steps[i].lon, ''];\n                  //\n                  //     //showMapView.marker_map_point(circle2, map);\n                  //}\n                  showMapView.drawRouteAmigo(itineraries[i].legs[ii].legGeometry.points, itineraries[i].legs[ii].mode);\n                }\n                  console.log(\"circle\", circle);\n                  console.log(\"---------------------\");\n                  showMapView.marker_map_point(circle, map);\n\n            }\n\n            //for (var k = 0; k < patterns.length; k++) {\n            //  var route_id = patterns[k].routeId;\n            //  var route_id_split = route_id.split(\":\");\n            //  var agency = route_id_split[0].toLowerCase();\n            //  var line = route_id_split[1].toLowerCase();\n            //  var routeId = route_id_split[0] + ':' + route_id_split[1];\n            //  console.log(\"agency ->\", agency, \"line ->\", line, \"routeId ->\", routeId);\n            //\n            //}\n            //\n            //for (var n = 0; n < routes.length; n++) {\n            //  var route_short_name = routes[n].shortName;\n            //  var route_long_name = routes[n].longName.toUpperCase();\n            //  console.log(\"route_short_name ->\", route_short_name, \"route_long_name ->\", route_long_name);\n            //\n            //}\n          console.log(\"entre if \")\n        }else{\n            console.log(\"ejecuta storage\");\n            var sesion_plan = JSON.parse(localStorage.getItem('dataplan'));\n            if(!(sesion_plan === null)) {\n                var itineraries = sesion_plan.itineraries;\n\n                showMapView.marker_map([sesion_plan.from.lat,sesion_plan.from.lon],[sesion_plan.to.lat,sesion_plan.to.lon], map);\n\n                for (i = 0; i < itineraries.length; i++) {\n                    for (ii=0; ii < itineraries[i].legs.length; ii++) {\n                      var circle = [itineraries[i].legs[ii].to.lat, itineraries[i].legs[ii].to.lon, itineraries[i].legs[ii].to.name];\n                      //console.log(\"circle\", circle);\n                      showMapView.marker_map_point(circle, map);\n                      showMapView.drawRouteAmigo(itineraries[i].legs[ii].legGeometry.points, itineraries[i].legs[ii].mode);\n                    }\n                }\n            }\n\n        }\n      } catch (e) {\n        console.log(\"entre cath\")\n\t    map.setView([center[1], center[0]], config.geocode().zoom);\n      }\n\n    }\n  });\n}\n\n\n/////////////function test circle maps  ////\n\nfunction getRouteId(patternId, patterns) {\n  for (var i = 0; i < patterns.length; i++) {\n    var pattern = patterns[i];\n    if (pattern.pattern_id === patternId) return pattern.route_id;\n  }\n}\n\nfunction getRoute(routeId, routes) {\n  for (var i = 0; i < routes.length; i++) {\n    var route = routes[i];\n    if (route.route_id === routeId) return route;\n  }\n}\n\nfunction getRouteShield(agency, route) {\n  if (agency === 'dc' && route.route_type === 1) return 'M';\n  return route.route_short_name || route.route_long_name.toUpperCase();\n}\n",
                "subject": "remove console.log",
                "message": "remove console.log\n",
                "lang": "JavaScript",
                "license": "bsd-3-clause",
                "repos": "amigocloud/modeify,amigocloud/modified-tripplanner,tismart/modeify,amigocloud/modified-tripplanner,tismart/modeify,amigocloud/modified-tripplanner,tismart/modeify,amigocloud/modeify,amigocloud/modeify,amigocloud/modified-tripplanner,amigocloud/modeify,tismart/modeify"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10271,
            "row": {
                "commit": "886f9784adaf60b144cea5bad686bc5ea75c31aa",
                "old_file": "js/gittip/upgrade.js",
                "new_file": "js/gittip/upgrade.js",
                "old_contents": "Gittip.upgrade = {};\n\nGittip.upgrade.init = function () {\n\n    var userAgent = navigator.userAgent.toLowerCase();\n    var browser = (userAgent.indexOf('msie') != -1) ? parseInt(userAgent.split('msie')[1], 10) : -1;\n\n    if(browser != -1 && browser < 9) {\n        var message = '' +\n            '<div id=\"upgrade_browser\">' +\n            '   <div class=\"container\">' +\n            'This browser isn\\'t supported by GitTip.com. ' +\n            'We encourage You to upgrade or change browser. ' +\n            '<a href=\"http://browsehappy.com\">Learn more</a>' +\n            '   </div>' +\n            '</div>';\n        $(\"body\").prepend(message);\n    }\n};\n\n$(document).ready(Gittip.upgrade.init);\n",
                "new_contents": "Gittip.upgrade = {};\n\nGittip.upgrade.init = function () {\n\n    var userAgent = navigator.userAgent.toLowerCase();\n    var browser = (userAgent.indexOf('msie') != -1) ? parseInt(userAgent.split('msie')[1], 10) : -1;\n\n    if(browser != -1 && browser < 9) {\n        var message = '' +\n            '<div id=\"upgrade_browser\">' +\n            '   <div class=\"container\">' +\n            'You\\'re using a browser that we don\\'t support. ' +\n            'We encourage you to <a href=\"http://browsehappy.com/\">upgrade</a>.' +\n            '   </div>' +\n            '</div>';\n        $(\"body\").prepend(message);\n    }\n};\n\n$(document).ready(Gittip.upgrade.init);\n",
                "subject": "Clean up the browser upgrade message",
                "message": "Clean up the browser upgrade message\n\nGitTip.com? Really? :-(\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "gratipay/gratipay.com,studio666/gratipay.com,eXcomm/gratipay.com,mccolgst/www.gittip.com,eXcomm/gratipay.com,mccolgst/www.gittip.com,studio666/gratipay.com,eXcomm/gratipay.com,mccolgst/www.gittip.com,studio666/gratipay.com,gratipay/gratipay.com,gratipay/gratipay.com,mccolgst/www.gittip.com,gratipay/gratipay.com,studio666/gratipay.com,eXcomm/gratipay.com"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10272,
            "row": {
                "commit": "f9a6e570bad6d68d9fb2d16681e2d5bd351e059b",
                "old_file": "js/hterm_find_bar.js",
                "new_file": "js/hterm_find_bar.js",
                "old_contents": "// Copyright 2020 The Chromium OS Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n'use strict';\n\n/**\n * @fileoverview Find bar handling.\n */\n\n/**\n * Manage the find bar.\n *\n * @param {!hterm.Terminal} terminal\n * @constructor\n */\nhterm.FindBar = function(terminal) {\n  /**\n   * @private {!hterm.Terminal}\n   * @const\n   */\n  this.terminal_ = terminal;\n\n  /**\n   * @private {!hterm.ScrollPort}\n   * @const\n   */\n  this.scrollPort_ = terminal.getScrollPort();\n\n  /** @private {?Element} */\n  this.findBar_ = null;\n\n  /** @private {?Element} */\n  this.input_ = null;\n\n  /** @private {?Element} */\n  this.upArrow_ = null;\n\n  /** @private {?Element} */\n  this.downArrow_ = null;\n\n  /** @private {?Element} */\n  this.closeButton_ = null;\n\n  /** @type {boolean} */\n  this.underTest = false;\n\n  /**\n   * Stores current search results mapping row number to row results.\n   * Also works as cache for find-rows.\n   *\n   * @private {!Object<number, !hterm.FindBar.RowResult>}\n   */\n  this.results_ = {};\n\n  /**\n   * Timeout ID of pending find batch to run.\n   * Null indicates no search in progress.\n   *\n   * @private {?number}\n   */\n  this.pendingFind_ = null;\n\n  /**\n   * Timeout ID of pending redraw.\n   * Null indicates no redraw is scheduled.\n   *\n   * @private {?number}\n   */\n  this.pendingRedraw_ = null;\n\n  /**\n   * Lower case of find input field.\n   *\n   * @private {string}\n   */\n  this.searchText_ = '';\n\n  /** @private {number} */\n  this.batchRow_ = 0;\n\n  /** @private {number} */\n  this.batchNum_ = 0;\n\n  /**\n   * Callbacks to run after the specified batch. Used for testing.\n   *\n   * @private {!Object<number, function()>}\n   * @const\n   */\n  this.batchCallbacksForTest_ = {};\n\n  /** @type {number} */\n  this.batchSize = 50;\n\n  /**\n   * Findbar is visible or not.\n   *\n   * @type {boolean}\n   */\n  this.isVisible = false;\n\n  /**\n   * Keep track of visible rows.\n   *\n   * @private {!Array<!Element>}\n   */\n  this.visibleRows_ = [];\n\n  /**\n   * Listens for scroll events and redraws results.\n   *\n   * @private {function()}\n   * @const\n   */\n  this.onScroll_ = this.scheduleRedraw_.bind(this);\n};\n\n/** @typedef {{findRow: ?Element, rowResult: !Array<!hterm.FindBar.Result>}} */\nhterm.FindBar.RowResult;\n\n/** @typedef {{index: number, highlighter: ?Element}} */\nhterm.FindBar.Result;\n\n/**\n * Add find bar to the terminal.\n *\n * @param {!Document} document\n */\nhterm.FindBar.prototype.decorate = function(document) {\n  this.findBar_ = document.createElement('div');\n  this.findBar_.id = 'hterm:find-bar';\n  this.findBar_.setAttribute('aria-hidden', 'true');\n  this.findBar_.innerHTML = lib.resource.getData('hterm/html/find_bar');\n\n  this.input_ = this.findBar_.querySelector('input');\n  this.upArrow_ = this.findBar_.querySelector('#hterm\\\\:find-bar-up');\n  this.downArrow_ = this.findBar_.querySelector('#hterm\\\\:find-bar-down');\n  this.closeButton_ = this.findBar_.querySelector('#hterm\\\\:find-bar-close');\n\n  // Add aria-label and svg icons.\n  this.upArrow_.innerHTML = lib.resource\n      .getData('hterm/images/keyboard_arrow_up');\n  this.downArrow_.innerHTML = lib.resource\n      .getData('hterm/images/keyboard_arrow_down');\n  this.closeButton_.innerHTML = lib.resource.getData('hterm/images/close');\n\n  this.upArrow_.setAttribute('aria-label', hterm.msg('BUTTON_PREVIOUS'));\n  this.downArrow_.setAttribute('aria-label', hterm.msg('BUTTON_NEXT'));\n  this.input_.setAttribute('aria-label', hterm.msg('BUTTON_FIND'));\n  this.closeButton_.setAttribute('aria-label', hterm.msg('BUTTON_CLOSE'));\n\n  // Add event listeners to the elements.\n  const el = (e) => /** @type {!EventListener} */ (e.bind(this));\n  this.input_.addEventListener('input', el(this.onInput_));\n  this.input_.addEventListener('keydown', el(this.onKeyDown_));\n  this.input_.addEventListener('keypress', el(this.onKeyPressed_));\n  this.input_.addEventListener('textInput', el(this.onInputText_));\n  this.closeButton_.addEventListener('click', el(this.close));\n\n  document.body.appendChild(this.findBar_);\n\n  this.resultScreen_ = document.createElement('div');\n  this.resultScreen_.id = 'hterm:find-result-screen';\n  this.resultScreen_.innerHTML = lib.resource.getData('hterm/html/find_screen');\n  this.resultScreen_.style.display = 'none';\n  this.terminal_.getDocument().body.appendChild(this.resultScreen_);\n};\n\n/**\n * Display find bar.\n */\nhterm.FindBar.prototype.display = function() {\n  if (!this.underTest) {\n    // TODO(crbug.com/209178): To be implemented.\n    return;\n  }\n\n  this.scrollPort_.subscribe('scroll', this.onScroll_);\n\n  this.findBar_.classList.add('enabled');\n  this.findBar_.removeAttribute('aria-hidden');\n  this.input_.focus();\n  this.resultScreen_.style.display = '';\n\n  // Start searching for stored text in findbar.\n  this.input_.dispatchEvent(new Event('input'));\n};\n\n/**\n * Close find bar.\n */\nhterm.FindBar.prototype.close = function() {\n  // Clear all results of findbar.\n  this.resultScreen_.style.display = 'none';\n\n  this.scrollPort_.unsubscribe('scroll', this.onScroll_);\n\n  this.findBar_.classList.remove('enabled');\n  this.findBar_.setAttribute('aria-hidden', 'true');\n  this.terminal_.focus();\n\n  this.stopSearch();\n  this.results_ = {};\n};\n\n/**\n * Clears any pending find batch.\n */\nhterm.FindBar.prototype.stopSearch = function() {\n  if (this.pendingFind_ !== null) {\n    clearTimeout(this.pendingFind_);\n    this.pendingFind_ = null;\n  }\n  this.runBatchCallbackForTest_(0);\n};\n\n/**\n * Enable batch-wise searching when search text changes.\n */\nhterm.FindBar.prototype.syncResults_ = function() {\n  this.batchRow_ = 0;\n  this.batchNum_ = 0;\n  this.results_ = {};\n  this.redraw_();\n\n  // No input means no result. Just redraw the results.\n  if (!this.searchText_) {\n    return;\n  }\n\n  const rowCount = this.terminal_.getRowCount();\n  const runNextBatch = () => {\n    const batchEnd = Math.min(this.batchRow_ + this.batchSize, rowCount);\n    while (this.batchRow_ < batchEnd) {\n      this.findInRow_(this.batchRow_++);\n    }\n    if (this.batchRow_ < rowCount) {\n      this.pendingFind_ = setTimeout(runNextBatch);\n    } else {\n      this.stopSearch();\n    }\n    ++this.batchNum_;\n    this.runBatchCallbackForTest_(this.batchNum_);\n  };\n  runNextBatch();\n};\n\n/**\n * Find the results for a particular row and set them in result map.\n * TODO(crbug.com/209178): Add support for overflowed rows.\n *\n * @param {number} rowNum\n */\nhterm.FindBar.prototype.findInRow_ = function(rowNum) {\n  if (!this.searchText_ || this.results_[rowNum]) {\n    return;\n  }\n  const rowText = this.terminal_.getRowText(rowNum).toLowerCase();\n  const rowResult = [];\n\n  let i;\n  let startIndex = 0;\n  // Find and create highlight for matching texts.\n  while ((i = rowText.indexOf(this.searchText_, startIndex)) != -1) {\n    rowResult.push({index: i, highlighter: null});\n    startIndex = i + this.searchText_.length;\n  }\n  if (rowResult.length && !this.results_[rowNum]) {\n    this.results_[rowNum] = {findRow: null, rowResult};\n  }\n};\n\n/**\n * @param {!Event} event The event triggered on input in find bar.\n */\nhterm.FindBar.prototype.onInput_ = function(event) {\n  this.searchText_ = event.target.value.toLowerCase();\n\n  // If a batch is already pending, reset it.\n  clearTimeout(this.pendingFind_);\n  this.pendingFind_ = setTimeout(() => this.syncResults_());\n};\n\n/**\n * @param {!Event} event The event triggered on key press in find bar.\n */\nhterm.FindBar.prototype.onKeyPressed_ = function(event) {\n  event.stopPropagation();\n};\n\n/**\n * @param {!Event} event The event triggered on text input in find bar.\n */\nhterm.FindBar.prototype.onInputText_ = function(event) {\n  event.stopPropagation();\n};\n\n/**\n * @param {!Event} event The event triggered on keydown in find bar.\n */\nhterm.FindBar.prototype.onKeyDown_ = function(event) {\n  if (event.key == 'Escape') {\n    this.close();\n  }\n  // Stop Ctrl+F inside hterm find input opening browser find.\n  if (event.ctrlKey && event.key == 'f') {\n    event.preventDefault();\n  }\n  // TODO(crbug.com/209178): To be implemented.\n  event.stopPropagation();\n};\n\n/**\n * Set the background color to highlight find results.\n *\n * @param {string=} color The color to set.  If not defined, we reset to the\n *     saved user preference.\n */\nhterm.FindBar.prototype.setFindResultColor = function(color) {\n  if (color === undefined) {\n    color = this.terminal_.getPrefs().getString('find-result-color');\n  }\n\n  this.terminal_.setCssVar('find-result-color', color);\n};\n\n/**\n * Set the background color to highlight the selected find result.\n *\n * @param {string=} color The color to set.  If not defined, we reset to the\n *     saved user preference.\n */\nhterm.FindBar.prototype.setFindResultSelectedColor = function(color) {\n  if (color === undefined) {\n    color = this.terminal_.getPrefs().getString('find-result-selected-color');\n  }\n\n  this.terminal_.setCssVar('find-result-selected-color', color);\n};\n\n/**\n * Register a callback to be run after the specified batch (1-based).\n * Use batchNum 0 to set a callback to be run when search stops.\n * Used for testing.\n *\n * @param {number} batchNum\n * @param {function()} callback\n */\nhterm.FindBar.prototype.setBatchCallbackForTest = function(batchNum, callback) {\n  this.batchCallbacksForTest_[batchNum] = callback;\n};\n\n/**\n * Redraws the results of findbar on find result screen.\n */\nhterm.FindBar.prototype.redraw_ = function() {\n  const topRowIndex = this.scrollPort_.getTopRowIndex();\n  const bottomRowIndex = this.scrollPort_.getBottomRowIndex(topRowIndex);\n\n  // Clear the find result screen.\n  this.visibleRows_.forEach((row) => {\n    row.remove();\n  });\n  this.visibleRows_ = [];\n\n  for (let rowNum = topRowIndex; rowNum <= bottomRowIndex; rowNum++) {\n    const newRow = this.fetchRowNode_(rowNum);\n    this.resultScreen_.appendChild(newRow);\n    this.visibleRows_.push(newRow);\n  }\n\n  delete this.pendingRedraw_;\n};\n\n/**\n * Fetch find row element. If find-row is not available in results, it creates\n * a new one and store it in results.\n *\n * @param {number} rowNum\n * @return {!Element}\n */\nhterm.FindBar.prototype.fetchRowNode_ = function(rowNum) {\n  // Process row if batch hasn't yet got to it.\n  if (rowNum >= this.batchRow_) {\n    this.findInRow_(rowNum);\n  }\n  const row = this.results_[rowNum];\n  if (row && row.findRow) {\n    return row.findRow;\n  }\n\n  // Create a new find-row.\n  const findRow = this.terminal_.getDocument().createElement('find-row');\n  if (!row) {\n    return findRow;\n  }\n  row.rowResult.forEach((result) => {\n    const highlighter = this.terminal_.getDocument().createElement('div');\n    highlighter.classList.add('find-highlighter');\n    highlighter.style.left =\n        `calc(var(--hterm-charsize-width) * ${result.index})`;\n    highlighter.style.width =\n       `calc(var(--hterm-charsize-width) * ${this.searchText_.length})`;\n    result.highlighter = highlighter;\n    findRow.appendChild(highlighter);\n  });\n  return row.findRow = findRow;\n};\n\n/**\n * Synchronize redrawing of search results present on the screen.\n *\n * The sync will happen asynchronously, soon after the call stack winds down.\n * Multiple calls will be coalesced into a single sync.\n */\nhterm.FindBar.prototype.scheduleRedraw_ = function() {\n  if (this.pendingRedraw_) {\n    return;\n  }\n  this.pendingRedraw_ = setTimeout(() => {\n    this.redraw_();\n  });\n};\n\n/**\n * Runs the specified batch callback if it exists and removes it.\n *\n * @param {number} batchNum\n * @private\n */\nhterm.FindBar.prototype.runBatchCallbackForTest_ = function(batchNum) {\n  const callback = this.batchCallbacksForTest_[batchNum];\n  if (callback) {\n    callback();\n    delete this.batchCallbacksForTest_[batchNum];\n  }\n};\n",
                "new_contents": "// Copyright 2020 The Chromium OS Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n'use strict';\n\n/**\n * @fileoverview Find bar handling.\n */\n\n/**\n * Manage the find bar.\n *\n * @param {!hterm.Terminal} terminal\n * @constructor\n */\nhterm.FindBar = function(terminal) {\n  /**\n   * @private {!hterm.Terminal}\n   * @const\n   */\n  this.terminal_ = terminal;\n\n  /**\n   * @private {!hterm.ScrollPort}\n   * @const\n   */\n  this.scrollPort_ = terminal.getScrollPort();\n\n  /** @private {?Element} */\n  this.findBar_ = null;\n\n  /** @private {?Element} */\n  this.input_ = null;\n\n  /** @private {?Element} */\n  this.upArrow_ = null;\n\n  /** @private {?Element} */\n  this.downArrow_ = null;\n\n  /** @private {?Element} */\n  this.closeButton_ = null;\n\n  /** @type {boolean} */\n  this.underTest = false;\n\n  /**\n   * Stores current search results mapping row number to row results.\n   * Also works as cache for find-rows.\n   *\n   * @private {!Object<number, !hterm.FindBar.RowResult>}\n   */\n  this.results_ = {};\n\n  /**\n   * Timeout ID of pending find batch to run.\n   * Null indicates no search in progress.\n   *\n   * @private {?number}\n   */\n  this.pendingFind_ = null;\n\n  /**\n   * Timeout ID of pending redraw.\n   * Null indicates no redraw is scheduled.\n   *\n   * @private {?number}\n   */\n  this.pendingRedraw_ = null;\n\n  /**\n   * Lower case of find input field.\n   *\n   * @private {string}\n   */\n  this.searchText_ = '';\n\n  /** @private {number} */\n  this.batchRow_ = 0;\n\n  /** @private {number} */\n  this.batchNum_ = 0;\n\n  /**\n   * Callbacks to run after the specified batch. Used for testing.\n   *\n   * @private {!Object<number, function()>}\n   * @const\n   */\n  this.batchCallbacksForTest_ = {};\n\n  /** @type {number} */\n  this.batchSize = 50;\n\n  /**\n   * Findbar is visible or not.\n   *\n   * @type {boolean}\n   */\n  this.isVisible = false;\n\n  /**\n   * Keep track of visible rows.\n   *\n   * @private {!Array<!Element>}\n   */\n  this.visibleRows_ = [];\n\n  /**\n   * Listens for scroll events and redraws results.\n   *\n   * @private {function()}\n   * @const\n   */\n  this.onScroll_ = this.scheduleRedraw_.bind(this);\n};\n\n/** @typedef {{findRow: ?Element, rowResult: !Array<!hterm.FindBar.Result>}} */\nhterm.FindBar.RowResult;\n\n/** @typedef {{index: number, highlighter: ?Element}} */\nhterm.FindBar.Result;\n\n/**\n * Add find bar to the terminal.\n *\n * @param {!Document} document\n */\nhterm.FindBar.prototype.decorate = function(document) {\n  this.findBar_ = document.createElement('div');\n  this.findBar_.id = 'hterm:find-bar';\n  this.findBar_.setAttribute('aria-hidden', 'true');\n  this.findBar_.innerHTML = lib.resource.getData('hterm/html/find_bar');\n\n  this.input_ = this.findBar_.querySelector('input');\n  this.upArrow_ = this.findBar_.querySelector('#hterm\\\\:find-bar-up');\n  this.downArrow_ = this.findBar_.querySelector('#hterm\\\\:find-bar-down');\n  this.closeButton_ = this.findBar_.querySelector('#hterm\\\\:find-bar-close');\n\n  // Add aria-label and svg icons.\n  this.upArrow_.innerHTML = lib.resource\n      .getData('hterm/images/keyboard_arrow_up');\n  this.downArrow_.innerHTML = lib.resource\n      .getData('hterm/images/keyboard_arrow_down');\n  this.closeButton_.innerHTML = lib.resource.getData('hterm/images/close');\n\n  this.upArrow_.setAttribute('aria-label', hterm.msg('BUTTON_PREVIOUS'));\n  this.downArrow_.setAttribute('aria-label', hterm.msg('BUTTON_NEXT'));\n  this.input_.setAttribute('aria-label', hterm.msg('BUTTON_FIND'));\n  this.closeButton_.setAttribute('aria-label', hterm.msg('BUTTON_CLOSE'));\n\n  // Add event listeners to the elements.\n  const el = (e) => /** @type {!EventListener} */ (e.bind(this));\n  this.input_.addEventListener('input', el(this.onInput_));\n  this.input_.addEventListener('keydown', el(this.onKeyDown_));\n  this.input_.addEventListener('keypress', el(this.onKeyPressed_));\n  this.input_.addEventListener('textInput', el(this.onInputText_));\n  this.closeButton_.addEventListener('click', el(this.close));\n\n  document.body.appendChild(this.findBar_);\n\n  this.resultScreen_ = document.createElement('div');\n  this.resultScreen_.id = 'hterm:find-result-screen';\n  this.resultScreen_.innerHTML = lib.resource.getData('hterm/html/find_screen');\n  this.resultScreen_.style.display = 'none';\n  this.terminal_.getDocument().body.appendChild(this.resultScreen_);\n};\n\n/**\n * Display find bar.\n */\nhterm.FindBar.prototype.display = function() {\n  if (!this.underTest) {\n    // TODO(crbug.com/209178): To be implemented.\n    return;\n  }\n\n  this.scrollPort_.subscribe('scroll', this.onScroll_);\n\n  this.findBar_.classList.add('enabled');\n  this.findBar_.removeAttribute('aria-hidden');\n  this.input_.focus();\n  this.resultScreen_.style.display = '';\n\n  // Start searching for stored text in findbar.\n  this.input_.dispatchEvent(new Event('input'));\n};\n\n/**\n * Close find bar.\n */\nhterm.FindBar.prototype.close = function() {\n  // Clear all results of findbar.\n  this.resultScreen_.style.display = 'none';\n\n  this.scrollPort_.unsubscribe('scroll', this.onScroll_);\n\n  this.findBar_.classList.remove('enabled');\n  this.findBar_.setAttribute('aria-hidden', 'true');\n  this.terminal_.focus();\n\n  this.stopSearch();\n  this.results_ = {};\n};\n\n/**\n * Clears any pending find batch.\n */\nhterm.FindBar.prototype.stopSearch = function() {\n  if (this.pendingFind_ !== null) {\n    clearTimeout(this.pendingFind_);\n    this.pendingFind_ = null;\n  }\n  this.runBatchCallbackForTest_(0);\n};\n\n/**\n * Enable batch-wise searching when search text changes.\n */\nhterm.FindBar.prototype.syncResults_ = function() {\n  this.batchRow_ = 0;\n  this.batchNum_ = 0;\n  this.results_ = {};\n  this.redraw_();\n\n  // No input means no result. Just redraw the results.\n  if (!this.searchText_) {\n    return;\n  }\n\n  const rowCount = this.terminal_.getRowCount();\n  const runNextBatch = () => {\n    const batchEnd = Math.min(this.batchRow_ + this.batchSize, rowCount);\n    while (this.batchRow_ < batchEnd) {\n      this.findInRow_(this.batchRow_++);\n    }\n    if (this.batchRow_ < rowCount) {\n      this.pendingFind_ = setTimeout(runNextBatch);\n    } else {\n      this.stopSearch();\n    }\n    ++this.batchNum_;\n    this.runBatchCallbackForTest_(this.batchNum_);\n  };\n  runNextBatch();\n};\n\n/**\n * Find the results for a particular row and set them in result map.\n * TODO(crbug.com/209178): Add support for overflowed rows.\n *\n * @param {number} rowNum\n */\nhterm.FindBar.prototype.findInRow_ = function(rowNum) {\n  if (!this.searchText_ || this.results_[rowNum]) {\n    return;\n  }\n  const rowText = this.terminal_.getRowText(rowNum).toLowerCase();\n  const rowResult = [];\n\n  let i;\n  let startIndex = 0;\n  // Find and create highlight for matching texts.\n  while ((i = rowText.indexOf(this.searchText_, startIndex)) != -1) {\n    rowResult.push({index: i, highlighter: null});\n    startIndex = i + this.searchText_.length;\n  }\n  if (rowResult.length && !this.results_[rowNum]) {\n    this.results_[rowNum] = {findRow: null, rowResult};\n  }\n};\n\n/**\n * @param {!Event} event The event triggered on input in find bar.\n */\nhterm.FindBar.prototype.onInput_ = function(event) {\n  this.searchText_ = event.target.value.toLowerCase();\n\n  // If a batch is already pending, reset it.\n  clearTimeout(this.pendingFind_);\n  this.pendingFind_ = setTimeout(() => this.syncResults_());\n};\n\n/**\n * @param {!Event} event The event triggered on key press in find bar.\n */\nhterm.FindBar.prototype.onKeyPressed_ = function(event) {\n  event.stopPropagation();\n};\n\n/**\n * @param {!Event} event The event triggered on text input in find bar.\n */\nhterm.FindBar.prototype.onInputText_ = function(event) {\n  event.stopPropagation();\n};\n\n/**\n * @param {!Event} event The event triggered on keydown in find bar.\n */\nhterm.FindBar.prototype.onKeyDown_ = function(event) {\n  if (event.key == 'Escape') {\n    this.close();\n  }\n  // Stop Ctrl+F inside hterm find input opening browser find.\n  if (event.ctrlKey && event.key == 'f') {\n    event.preventDefault();\n  }\n  // TODO(crbug.com/209178): To be implemented.\n  event.stopPropagation();\n};\n\n/**\n * Set the background color to highlight find results.\n *\n * @param {string=} color The color to set.  If not defined, we reset to the\n *     saved user preference.\n */\nhterm.FindBar.prototype.setFindResultColor = function(color) {\n  if (color === undefined) {\n    color = this.terminal_.getPrefs().getString('find-result-color');\n  }\n\n  this.terminal_.setCssVar('find-result-color', color);\n};\n\n/**\n * Set the background color to highlight the selected find result.\n *\n * @param {string=} color The color to set.  If not defined, we reset to the\n *     saved user preference.\n */\nhterm.FindBar.prototype.setFindResultSelectedColor =\n    function(color = undefined) {\n  if (color === undefined) {\n    color = this.terminal_.getPrefs().getString('find-result-selected-color');\n  }\n\n  this.terminal_.setCssVar('find-result-selected-color', color);\n};\n\n/**\n * Register a callback to be run after the specified batch (1-based).\n * Use batchNum 0 to set a callback to be run when search stops.\n * Used for testing.\n *\n * @param {number} batchNum\n * @param {function()} callback\n */\nhterm.FindBar.prototype.setBatchCallbackForTest = function(batchNum, callback) {\n  this.batchCallbacksForTest_[batchNum] = callback;\n};\n\n/**\n * Redraws the results of findbar on find result screen.\n */\nhterm.FindBar.prototype.redraw_ = function() {\n  const topRowIndex = this.scrollPort_.getTopRowIndex();\n  const bottomRowIndex = this.scrollPort_.getBottomRowIndex(topRowIndex);\n\n  // Clear the find result screen.\n  this.visibleRows_.forEach((row) => {\n    row.remove();\n  });\n  this.visibleRows_ = [];\n\n  for (let rowNum = topRowIndex; rowNum <= bottomRowIndex; rowNum++) {\n    const newRow = this.fetchRowNode_(rowNum);\n    this.resultScreen_.appendChild(newRow);\n    this.visibleRows_.push(newRow);\n  }\n\n  delete this.pendingRedraw_;\n};\n\n/**\n * Fetch find row element. If find-row is not available in results, it creates\n * a new one and store it in results.\n *\n * @param {number} rowNum\n * @return {!Element}\n */\nhterm.FindBar.prototype.fetchRowNode_ = function(rowNum) {\n  // Process row if batch hasn't yet got to it.\n  if (rowNum >= this.batchRow_) {\n    this.findInRow_(rowNum);\n  }\n  const row = this.results_[rowNum];\n  if (row && row.findRow) {\n    return row.findRow;\n  }\n\n  // Create a new find-row.\n  const findRow = this.terminal_.getDocument().createElement('find-row');\n  if (!row) {\n    return findRow;\n  }\n  row.rowResult.forEach((result) => {\n    const highlighter = this.terminal_.getDocument().createElement('div');\n    highlighter.classList.add('find-highlighter');\n    highlighter.style.left =\n        `calc(var(--hterm-charsize-width) * ${result.index})`;\n    highlighter.style.width =\n       `calc(var(--hterm-charsize-width) * ${this.searchText_.length})`;\n    result.highlighter = highlighter;\n    findRow.appendChild(highlighter);\n  });\n  return row.findRow = findRow;\n};\n\n/**\n * Synchronize redrawing of search results present on the screen.\n *\n * The sync will happen asynchronously, soon after the call stack winds down.\n * Multiple calls will be coalesced into a single sync.\n */\nhterm.FindBar.prototype.scheduleRedraw_ = function() {\n  if (this.pendingRedraw_) {\n    return;\n  }\n  this.pendingRedraw_ = setTimeout(() => {\n    this.redraw_();\n  });\n};\n\n/**\n * Runs the specified batch callback if it exists and removes it.\n *\n * @param {number} batchNum\n * @private\n */\nhterm.FindBar.prototype.runBatchCallbackForTest_ = function(batchNum) {\n  const callback = this.batchCallbacksForTest_[batchNum];\n  if (callback) {\n    callback();\n    delete this.batchCallbacksForTest_[batchNum];\n  }\n};\n",
                "subject": "hterm: updated find-result-selected-color pref",
                "message": "hterm: updated find-result-selected-color pref\n\nChange-Id: I13a6ffb25c6a15bd2309bedb8b5355a503d1b859\nReviewed-on: https://chromium-review.googlesource.com/c/apps/libapps/+/2315458\nReviewed-by: Joel Hockey <9ecfc52dc2ffef73afac73f3495f294aeddf1231@chromium.org>\nTested-by: kokoro <2ac7b1f3fa578934c95181d4272be0d3bca00121@google.com>\n",
                "lang": "JavaScript",
                "license": "bsd-3-clause",
                "repos": "chromium/hterm,chromium/hterm,chromium/hterm,chromium/hterm"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10273,
            "row": {
                "commit": "26dc2959df0bf8ff8a37640358794516d83528d9",
                "old_file": "js/init_lazy_load.js",
                "new_file": "js/init_lazy_load.js",
                "old_contents": " $(function() {\n\n \tvar loadFunction = function(event) {\n\t    var currentImagesToShow = $(\".current figure img\");\n\t    \n\t    $('.current figure .lazy').lazy({\n\t     \teffect: 'fadeIn',\n\t\t    defaultImage: 'data:image/gif;base64,R0lGODlhgACAAPcAAPHBh/jgw3O6rPrp1PTLm8vR1DVNWfXRpY6comh6g5nNw1drdanVzP319dTZ2/769MLJzf78+ens7eN5dcvm4ffbuPn5+nuKkqXTyvjd3PC7e+6squLx7uykoneHj3OEjF1xeu+2cf317fr8/PfZtIrFuuBrZ6q0uf78/JHJvvzy8t3h40RaZWu2qLS9wu329GOyo/rp6FSrmvzx5YLBtXu+sebp67rd1umUkf348fnlzaKtstrt6en08uR8efHCiPrm5eWEgfz8/NxZVfnh4fPJlb3FyfX29kilk/vt3JXLwfbVrcfN0bnCxv306vLEjffdvPvt7eXy7/76+tTq5vfa2e+zscTi3LHZ0eqamPP09fC1tP/+/MHg2v337/bV1dLp5VmunfLGkeeLiJmlq+Hk5vzw4u+0bWJ1fvbS0DpRXd9lYuJ1cdre4PH49/XOzN1cWPLCwNDV2PTKybze19zu6ktga/XSqOWAfff7+u7w8fvs2vzu7vbXsJWiqOudmvTOoPG9vPPFxO6zavG8ukqmlOaIhf74+PG+gPG5uOuhn95hXeiRjv3+/vnix6WwtZyorq63vOPn6PT6+bG6v7bb1PnkyuFwbPrn0Mnk3/jfwfDy84iWnemXlO2opvrr12i1pvn8++6wroaUm06oloKRmO+5dvC3tvXUqrTa0/zz6PPIxvPEwm23qZKfpeufnPf4+PK/vvP5+P7794eVnPv9/fvu3t7v7IbEuPXQzvTMyqDQx0ynlX7As+eOi+zu7/339/vv4F6woD5VYfLz9PbU0oqYn5+qsPjf353Pxdfc3vnj447HvLjc1W5/iK3Xz4SSmr7f2cPh23i8r/fY1/PGxYGQl+6za36OlfT5+Pjev6iyt+Dw7dbr5/HDi/TJyO6yadxXU/7+/v/+/v///v7///7//vb399Do4/X6+fr7+/vr61BlcPzw7+v187e/xP39/cbj3vLDiv7+/+fz8c7n4u/39fvv70+pl1GpmP75+e+3c9js6P77+q/Y0P///yH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUDw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpBRjc1N0YzRjk4REMxMUUzQTY5NkRERDBGNjQ2NTNFMiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpBRjc1N0Y0MDk4REMxMUUzQTY5NkRERDBGNjQ2NTNFMiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkFGNzU3RjNEOThEQzExRTNBNjk2REREMEY2NDY1M0UyIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkFGNzU3RjNFOThEQzExRTNBNjk2REREMEY2NDY1M0UyIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1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',\n\t\t});\n\t};\n\n\t$( \".grid-wrap .imageContainer\" ).click(loadFunction);\n\t$( \".nav-prev\" ).click(loadFunction);\n\t$( \".nav-next\" ).click(loadFunction);\n\n});",
                "new_contents": " $(function() {\n\n \tvar loadFunction = function(event) {\n\t    var currentImagesToShow = $(\".current figure img\");\n\t    \n\t    $('.current figure .lazy').lazy({\n\t     \teffect: 'fadeIn'\n\t\t});\n\n\t    $('.show figure .lazy').lazy({\n\t     \teffect: 'fadeIn'\n\t\t});\t\t\n\t};\n\n\t$( \".grid-wrap .imageContainer\" ).click(loadFunction);\n\t$( \".nav-prev\" ).click(loadFunction);\n\t$( \".nav-next\" ).click(loadFunction);\n\n});",
                "subject": "performance test",
                "message": "performance test\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "ib-cakelove/ib-cakelove.github.io,ib-cakelove/ib-cakelove.github.io"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10274,
            "row": {
                "commit": "aa18671e343a9932831ebbb64bfda815fe8fc293",
                "old_file": "client/spec/helpers/pages.js",
                "new_file": "client/spec/helpers/pages.js",
                "old_contents": "var waitAndClick = require('./utils').waitAndClick;\n\nvar blogs = [\n    [\n        {\n            title: 'title: end to end image',\n            description: 'description: end to end image',\n            username: 'Victor the Editor',\n            picture_url: 'http://i.imgur.com/L0Ci8Yj.png'\n        },\n        {title: 'title: end To end three', description: 'description: end to end three', username: 'Victor the Editor'},\n        {title: 'title: end to end two', description: 'description: end to end two', username: 'Victor the Editor'},\n        {title: 'title: end to end One', description: 'description: end to end one', username: 'Victor the Editor'}\n    ], [\n        {title: 'title: end to end closed', description: 'description: end to end closed', username: 'Victor the Editor'}\n    ]\n], stateMap = {\n    'active': 0,\n    'archived': 1\n};\n\nfunction waitForModal() {\n    'use strict';\n     /*jshint validthis: true */\n    browser.wait(function() {\n        return element(by.css('.modal-footer')).isDisplayed();\n    }, 1000);\n    return this;\n}\nfunction okModal() {\n    'use strict';\n     /*jshint validthis: true */\n    element(by.css('[ng-click=\"ok()\"]')).click();\n    return this;\n}\nfunction BlogsPage() {\n    'use strict';\n    var self = this;\n\n    self.blog = new BlogPage(self);\n    self.team = new TeamPage(self);\n\n    self.blogs = blogs;\n\n    self.cloneBlog = function(index, state) {\n        index = index || 0;\n        state = state || 0;\n        if (parseInt(state, 10) !== state){\n            state = stateMap[state];\n        }\n        return JSON.parse(JSON.stringify(self.blogs[state][index]));\n    };\n\n    self.waitForModal = waitForModal.bind(self);\n\n    self.title = element(by.model('newBlog.title'));\n    self.description = element(by.css('[ng-model=\"newBlog.description\"]'));\n    self.file = element(by.css('input[type=\"file\"]'));\n\n    self.gridElement = element(by.css('.list-container table'));\n\n    self.switchView = function() {\n        element(by.css('button[ng-show=\"blogsView === \\'grid\\'\"]')).click();\n    };\n\n    self.getActiveBlogs = function() {\n        return self.blogs[0];\n    };\n\n    self.getArchivedBlogs = function() {\n        return self.blogs[1];\n    };\n\n    self.searchBlogs = function(search) {\n        element(by.css('[ng-click=\"flags.extended = !flags.extended\"]')).click()\n        .then(function() {\n            element(by.model('q')).waitReady()\n            .then(function(elem) {\n                elem.clear().sendKeys(search.search);\n                browser.getCurrentUrl().then(function(url) {\n                    expect(url.indexOf('q=' + search.search)).toBeGreaterThan(-1);\n                })\n                .then(function () {\n                    self.expectCount(search.blogs.length);\n                    for (var j = 0, countj = search.blogs.length; j < countj; j++) {\n                        self.expectBlog(self.blogs[0][search.blogs[j]], j);\n                    }\n                });\n            });\n        });\n        return self;\n    };\n\n    self.openCreateBlog = function() {\n        element(by.css('[ng-click=\"openNewBlog();\"]')).click();\n        return self;\n    };\n\n    self.createBlogNext = function() {\n        element(by.buttonText('Next')).click();\n        return self;\n    };\n\n    self.createBlogCreate = function() {\n        element(by.buttonText('Create')).click();\n        return self.blog;\n    };\n\n    self.openBlog = function(index) {\n        index = index || 0;\n        element(by.repeater('blog in blogs._items').row(index).column('blog.title')).click();\n        return self.blog;\n    };\n\n    self.expectBlog = function(blog, index) {\n        index = index || 0;\n        browser.waitForAngular();\n        var currentBlog = element.all(by.repeater('blog in blogs._items')).get(index);\n        expect(currentBlog.element(by.binding('blog.title')).getText()).toBe(blog.title);\n        expect(currentBlog.element(by.binding('blog.description')).getText()).toBe(blog.description);\n        if (blog.picture_url) {\n            expect(currentBlog.element(by.css('[if-background-image]')).isPresent()).toBe(true);\n        } else {\n            expect(currentBlog.element(by.css('[if-background-image]')).isPresent()).toBe(false);\n        }\n        expect(currentBlog.element(by.binding('blog.original_creator | username')).getText())\n        .toBe(blog.username);\n    };\n\n    self.expectCount = function(count) {\n        browser.waitForAngular();\n        expect(element.all(by.repeater('blog in blogs._items')).count()).toEqual(count);\n    };\n\n    self.selectState = function(state) {\n        state = state || 1;\n        if (parseInt(state, 10) !== state){\n            state = stateMap[state];\n        }\n        browser.waitForAngular();\n        element.all(by.repeater('state in states').row(state)).get(0).click();\n        return self;\n    };\n}\n\nfunction FreetypesManagerPage() {\n    'use strict';\n    var self = this;\n    self.title = element(by.css('[ng-model=\"vm.dialogFreetype.name\"]'));\n    self.template = element(by.css('[ng-model=\"vm.dialogFreetype.template\"]'));\n\n    self.getFreetypes = function() {\n        return element.all(by.repeater('freetype in vm.freetypes'));\n    };\n    self.openFreetypesManager = function() {\n        element(by.css('[ng-click=\"toggleMenu()\"]')).click();\n        browser.wait(function() {\n            return element(by.css('[href=\"#/freetypes/\"][title]')).isDisplayed();\n        });\n        waitAndClick(by.css('[href=\"#/freetypes/\"][title]'));\n        return self;\n    };\n    self.saveFreetype = function() {\n        return element(by.css('[ng-click=\"vm.saveFreetype()\"]')).click();\n    };\n    self.openNewFreetypeDialog = function() {\n        element(by.css('[ng-click=\"vm.openFreetypeDialog();\"]')).click();\n    };\n    self.createFreetypeData = function() {\n        return {\n            title: randomString(5),\n            template: 'name=$' + randomString(10)\n        };\n    };\n    self.editFreetype = function() {\n        var freeData = self.createFreetypeData();\n        self.title.sendKeys(freeData.title);\n        self.template.sendKeys(freeData.template);\n        return self.saveFreetype().then(function() {return freeData;});\n    };\n    self.removeFreetype = function(index) {\n        index = index || 0;\n        self.getFreetypes().get(index).click().all(by.css('[ng-click=\"vm.removeFreetype(freetype, $index);\"]')).click();\n        okModal();\n    };\n}\n\nfunction AdvertisingManagerPage() {\n    'use strict';\n    var self = this;\n    self.advertTitle = element(by.css('[ng-model=\"advert.name\"]'));\n    self.collectionTitle = element(by.css('[ng-model=\"collection.name\"]'));\n    self.advertEmbed = element(by.css('[ng-model=\"embed\"]'));\n\n    self.getAdverts = function() {\n        return element.all(by.repeater('advert in adverts'));\n    };\n    self.getCollections = function() {\n        return element.all(by.repeater('collection in collections'));\n    };\n    self.openAdvertisingManager = function() {\n        element(by.css('[ng-click=\"toggleMenu()\"]')).click();\n        browser.wait(function() {\n            return element(by.css('[href=\"#/advertising/\"][title]')).isDisplayed();\n        });\n        waitAndClick(by.css('[href=\"#/advertising/\"][title]'));\n        return self;\n    };\n    self.openAdvertsTab = function() {\n        waitAndClick(by.css('[ng-click=\"changeState(\\'adverts\\')\"]'));\n        return self;\n    };\n    self.openCollectionsTab = function() {\n        waitAndClick(by.css('[ng-click=\"changeState(\\'collections\\')\"]'));\n        return self;\n    };\n    self.saveAdvert = function() {\n        return element(by.css('[ng-click=\"saveAdvert()\"]')).click();\n    };\n    self.saveCollection = function() {\n        return element(by.css('[ng-click=\"saveCollection()\"]')).click();\n    };\n    self.openNewAdvertDialog = function() {\n        element(by.css('[dropdown__toggle]')).click();\n        browser.wait(function() {\n            return element(by.buttonText(\"Advertisement Remote\")).isDisplayed();\n        });\n        element(by.buttonText(\"Advertisement Remote\")).click();\n        return self;\n    };\n    self.openNewCollectionDialog = function() {\n        element(by.css('[ng-click=\"openCollectionDialog();\"]')).click();\n    }\n    self.createAdvertData = function() {\n        return {\n            title: randomString(5),\n            embed: randomString(10)\n        };\n    };\n    self.editFreetype = function() {\n        var freeData = self.createAdvertData();\n        self.advertTitle.sendKeys(freeData.title);\n        self.advertEmbed.sendKeys(freeData.embed);\n        return self.saveAdvert().then(function() {return freeData;});\n    };\n    self.editCollection = function() {\n        var freeData = self.createAdvertData();\n        self.collectionTitle.sendKeys(freeData.title);\n        return self.saveCollection().then(function() {return freeData;});\n    }\n    self.removeAdvert = function(index) {\n        index = index || 0;\n        self.getAdverts().get(index).click().all(by.css('[ng-click=\"removeAdvert(advert, $index);\"]')).click();\n        waitForModal();\n        okModal();\n    };\n    self.removeCollection = function(index) {\n        index = index || 0;\n        // self.getCollections().get(index).click().all(by.css('[ng-click=\"removeCollection(collection, $index)\"]')).click();\n        self.getCollections().get(index).all(by.id('toggle-collection-menu')).click();\n        element(by.css('[ng-click=\"removeCollection(collection, $index)\"]')).click();\n        okModal();\n    };\n}\n\nfunction ThemesManagerPage() {\n    'use strict';\n    var self = this;\n    self.themes = element.all(by.css('.theme'));\n    self.blogsRows = element.all(by.repeater('blog in vm.selectedTheme.blogs'));\n    self.fileThemeElement = element(by.css('#uploadAThemeFile'));\n    self.byRemove = by.css('[ng-click=\"vm.removeTheme(theme)\"]');\n    self.bySettings = by.css('[ng-click=\"vm.openThemeSettings(theme)\"]');\n    self.byPreview = by.css('[ng-click=\"theme.screenshot_url && vm.openThemePreview(theme)\"]');\n\n    self.openThemesManager = function() {\n        element(by.css('[ng-click=\"toggleMenu()\"]')).click();\n        browser.wait(function() {\n            return element(by.css('[href=\"#/themes/\"][title]')).isDisplayed();\n        });\n        waitAndClick(by.css('[href=\"#/themes/\"][title]'));\n        return self;\n    };\n\n    self.setAsDefault = function(theme_index) {\n        return self.themes.get(theme_index).element(by.css('[ng-click=\"vm.makeDefault(theme)\"]')).click();\n    };\n\n    self.openSettingsForTheme = function(themeIndex) {\n        //self.themes.get(themeIndex).element(self.bySettings).click();\n        //browser.wait(function() {\n        //    return element(by.css('[name=\"vm.themeSettingsForm\"]')).isDisplayed();\n        //});\n        //return self;\n        return self.themes.get(themeIndex).element(self.bySettings).click()\n            //.then(() => {\n            //    return browser.wait();\n            //})\n            .then(() => {\n                return element(by.css('[name=\"vm.themeSettingsForm\"]')).isDisplayed();\n            });\n    };\n\n    self.saveSettings = function() {\n        return element(by.css('[ng-click=\"vm.submitSettings(true)\"]'))\n            .click();\n    };\n\n    self.remove = function(theme_index) {\n        self.themes.get(theme_index).element(self.byRemove).click();\n        return self;\n    };\n\n    self.openPreview = function(theme_index) {\n        self.themes.get(theme_index).element(self.byPreview).click().then(function() {\n            expect(element(by.css('.theme-preview-modal .modal-dialog')).isDisplayed()).toBe(true);\n            element(by.css('.theme-preview-modal .close')).click();\n        });\n        return self;\n    };\n\n    self.expectTheme = function(index, params) {\n        var theme = self.themes.get(index);\n        // check if it is the default theme\n        expect(theme.element(by.css('.default-theme')).isDisplayed()).toBe(params.is_default_theme);\n        // check if the name match\n        if (params.name) {\n            expect(theme.element(by.css('h3')).getText()).toBe(params.name);\n        }\n        //this only makes sense if the theme has at least one blog using it\n        if (params.number_of_blogs_expected > 0) {\n            var number_of_blog_elmt = theme.element(by.css('span[data-name=\\'noOfBlogs\\']'));\n            // check if the number shown match\n            expect(number_of_blog_elmt.getText()).toBe(params.number_of_blogs_expected.toString());\n            // open the modal\n            number_of_blog_elmt.click();\n            // check if first row is displayed\n            if (params.number_of_blogs_expected > 0) {\n                expect(self.blogsRows.get(0).isDisplayed()).toBe(true);\n            }\n            // check if the number of row matchs\n            expect(self.blogsRows.count()).toBe(params.number_of_blogs_expected);\n            var close_modal = element(by.css('[ng-click=\"vm.closeThemeBlogsModal()\"]'));\n            close_modal.isPresent().then(function(is_present) {\n                if (is_present) {\n                    close_modal.click();\n                }\n            });\n        }\n    };\n}\n\nfunction BlogPage(blogs) {\n    'use strict';\n    var self = this;\n    self.blogs = blogs;\n    self.drafts = new DraftsPage(self);\n    self.comments = new CommentsPage(self);\n    self.contributions = new ContributionsPage(self);\n    self.settings = new BlogSettingsPage(self);\n    self.timeline = new TimelinePage(self);\n    self.editor = new EditPostPage(self);\n\n    self.openDrafts = function() {\n        element(by.css('[ng-click=\"openPanel(\\'drafts\\')\"]')).click();\n        return self.drafts;\n    };\n\n    self.openComments = function() {\n        element(by.css('[ng-click=\"openPanel(\\'comments\\')\"]')).click();\n        return self.comments;\n    };\n\n    self.openEditor = function() {\n        element(by.css('[ng-click=\"openPanel(\\'editor\\')\"]')).click();\n        return self.editor;\n    };\n\n    self.openFreetypesEditor = function(index) {\n        var freetypeIndex = index || 0;\n        element(by.css('[ng-click=\"toggleTypePostDialog()\"]')).click()\n        .then(function() {\n            element(by.repeater('freetype in freetypes').row(freetypeIndex)).click();\n        });\n        return self.editor;\n    };\n\n    self.openContributions = function() {\n        element(by.css('[ng-click=\"openPanel(\\'contributions\\')\"]')).click();\n        return self.contributions;\n    };\n\n    self.openList = function() {\n        return waitAndClick(by.css('[class=\"icon-th-large\"]')).then(function() {return self.blogs;});\n    };\n\n    self.openArchive =  function() {\n        element(by.repeater('state in states').row(0).column('state.text')).click();\n    };\n\n    self.openSettings = function() {\n        return waitAndClick(by.css('.settings-link')).then(function() {return self.settings;});\n    };\n\n    self.expectNotificationsNo = function(notifsNo) {\n        expect(element(by.css('span.notification-counter')).getText()).toBe(notifsNo.toString());\n    };\n}\n\nfunction AbstractPanelPage(blog) {\n    'use strict';\n    var self = this;\n    self.blog = blog;\n    self.column = element(by.css(self._class_name));\n    self.byPosts = by.repeater('post in postsList.pagesManager.allPosts()');\n    self.byEditButton = by.css('[ng-click=\"onEditClick(post)\"]');\n    self.byPublishButton = by.css('[ng-click=\"publishPost(post)\"]');\n\n    self.get = function(index) {\n        return self.column.element(self.byPosts.row(index));\n    };\n\n    self.getFull = function(index) {\n        return self.get(index).element(by.css('.lb-post__list')).getText();\n    };\n\n    self.all = function() {\n        return self.column.all(self.byPosts);\n    };\n\n    self.editButtonIsPresent = function(draft) {\n        return draft.element(self.byEditButton).isPresent();\n    };\n\n    self.edit = function(draft) {\n        draft.element(self.byEditButton).click();\n        return self;\n    };\n\n    self.publish = function(draft) {\n        draft.element(self.byPublishButton).click();\n        return self;\n    };\n\n    self.expectPost = function(index, data) {\n        expect(self.get(index).element(by.css('[html-content]')).getText()).toContain(data);\n        return self;\n    };\n\n    self.expectUnreadPost = function(index) {\n        expect(self.get(index).element(by.css('.unread')).isPresent()).toBe(true);\n        return self;\n    };\n}\n\nDraftsPage.prototype = Object.create(AbstractPanelPage.prototype);\nfunction DraftsPage(blog) {\n    'use strict';\n    var self = this;\n    self._class_name = '.panel--draft';\n    AbstractPanelPage.call(self);\n}\n\nCommentsPage.prototype = Object.create(AbstractPanelPage.prototype);\nfunction CommentsPage(blog) {\n    'use strict';\n    var self = this;\n    self._class_name = '.panel--comments';\n    AbstractPanelPage.call(self);\n}\n\nContributionsPage.prototype = Object.create(AbstractPanelPage.prototype);\nfunction ContributionsPage(blog) {\n    'use strict';\n    var self = this;\n    self._class_name = '.panel--contribution';\n    self.byFilterBox = by.css('.dropdown-content');\n    self.validFilterButton = element(self.byFilterBox).element(by.buttonText('Select'));\n    AbstractPanelPage.call(self);\n\n    self.openFiterByMember = function() {\n        return self.column.element(by.css('.btn--plus')).click();\n    };\n\n    self.filterByMember = function(member_name) {\n        return self.openFiterByMember().then(function() {\n            element(self.byFilterBox)\n            .element(by.css('[data-username=\"' + member_name + '\"]'))\n            .click().then(function() {\n                return self.validFilterButton.click();\n            });\n        });\n    };\n}\n\nfunction TimelinePage(blog) {\n    'use strict';\n    var self = this;\n    self.blog = blog;\n    self.column = element(by.css('.column--timeline'));\n    self.byPosts = by.repeater('post in posts');\n    self.byEdit = by.css('[ng-click=\"onEditClick(post)\"]');\n    self.byUnpublish = by.css('[ng-click=\"unpublishPost(post)\"]');\n    self.byTogglePin = by.css('[ng-click=\"togglePinStatus(post)\"]');\n    self.byPinnedDrawer = by.css('div.timeline-posts-list.pinned');\n    self.byStartMoving = by.css('[ng-click=\"preMovePost(post);\"]');\n    self.byMoveTo = by.css('[ng-click=\"movePost(index, \\'above\\');\"]');\n    self.byRemove = by.css('[ng-click=\"askRemovePost(post)\"]');\n    self.waitForModal = waitForModal.bind(self);\n    self.okModal = okModal.bind(self);\n    self.byHighlight = by.css('[ng-click=\"highlightPost(post)\"]');\n\n    self.get = function(index) {\n        return self.column.element(self.byPosts.row(index));\n    };\n\n    self.getText = function(index) {\n        return self.get(index).element(by.css('[lb-bind-html]')).getText();\n    };\n\n    self.getFull = function(index) {\n        return self.get(index).element(by.css('.lb-post__list')).getText();\n    };\n\n    self.getUpdated = function(index) {\n        return self.get(index).element(by.css('.updated-time')).getText();\n    };\n\n    self.edit = function(index) {\n        self.column.element(self.byPosts.row(index)).element(self.byEdit).click();\n        return self;\n    };\n\n    self.unpublish = function(index) {\n        self.column.element(self.byPosts.row(index)).element(self.byUnpublish).click();\n        return self;\n    };\n\n    self.highlight = function(index) {\n        self.column.element(self.byPosts.row(index)).element(self.byHighlight).click();\n        return self;\n    };\n    self.togglePin = function(index) {\n        self.column.element(self.byPosts.row(index)).element(self.byTogglePin).click();\n        return self;\n    };\n\n    self.isPinDrawerVisible = function() {\n        return element(self.byPinnedDrawer).isDisplayed();\n    };\n    self.startMoving = function(index) {\n        self.column.element(self.byPosts.row(index)).element(self.byStartMoving).click();\n        return self;\n    };\n\n    self.canBeMoved = function(index) {\n        return self.column.element(self.byPosts.row(index)).element(self.byStartMoving).isPresent();\n    };\n\n    self.moveTo = function(index) {\n        self.column.element(self.byPosts.row(index)).element(self.byMoveTo).click();\n        return self;\n    };\n\n    self.remove = function(index) {\n        self.column.element(self.byPosts.row(index)).element(self.byRemove).click();\n        return self;\n    };\n\n    self.all = function() {\n        return self.column.all(self.byPosts);\n    };\n\n    self.expectPost = function(index, data) {\n        var post = self.get(index);\n        expect(self.getText(index)).toBe(data.text);\n        if (data.username) {\n            expect(post.element(by.binding('post.mainItem.item.user.display_name')).getText()).toBe(data.username);\n        }\n        return self;\n    };\n}\n\nfunction EditPostPage() {\n    'use strict';\n    var self = this;\n\n    self.textElement = element(by.css('.editor .st-text-block'));\n    self.quoteElement = element(by.css('.editor .st-quote-block'));\n    self.fileElement = element(by.css('input[type=\"file\"]'));\n    self.imageElement = element(by.css('.st-block__editor img'));\n    self.errorElement = element(by.css('.st-msg'));\n    self.embedElement = element(by.css('.embed-input'));\n    self.iframe = element(by.css('.liveblog--card iframe'));\n    self.publishElement = element(by.css('[ng-click=\"publish()\"]'));\n    //for scorecards\n    self.homeName = element(by.css('[text=\"freetypeData.home.name\"] [ng-model=\"text\"]'));\n    self.homeScore = element(by.css('[text=\"freetypeData.home.score\"] [ng-model=\"text\"]'));\n    self.awayName = element(by.css('[text=\"freetypeData.away.name\"] [ng-model=\"text\"]'));\n    self.awayScore = element(by.css('[text=\"freetypeData.away.score\"] [ng-model=\"text\"]'));\n    self.player1Name = element.all(by.css('[text=\"iterator__1.name\"] [ng-model=\"text\"]')).get(0);\n    self.player1Time = element.all(by.css('[text=\"iterator__1.time\"] [ng-model=\"text\"]')).get(0);\n    self.player2Name = element.all(by.css('[text=\"iterator__1.name\"] [ng-model=\"text\"]')).get(1);\n    self.player2Time = element.all(by.css('[text=\"iterator__1.time\"] [ng-model=\"text\"]')).get(1);\n\n    self.addTop = function() {\n        // click on the \"+\" bar\n        element(by.css('.st-block-controls__top')).click();\n        return self;\n    };\n\n    self.addImage = function() {\n        element(by.css('[data-type=\"image\"]')).click();\n        return self;\n    };\n\n    self.addQuote = function(data) {\n        // click on the quote button\n        element(by.css('[data-type=\"quote\"]')).click();\n        element(by.css('.editor .quote-input')).sendKeys(data.quote);\n        element(by.css('.editor .js-cite-input')).sendKeys(data.author);\n        return self;\n    };\n\n    self.addEmbed = function() {\n        element(by.css('[data-type=\"embed\"]')).click();\n        return self;\n    };\n\n    self.saveDraft = function() {\n        element(by.css('[ng-click=\"saveAsDraft()\"]')).click();\n        return self;\n    };\n\n    self.saveContribution = function() {\n        return element(by.css('[ng-click=\"saveAsContribution()\"]')).click();\n    };\n\n    self.waitForPublish = function() {\n        browser.wait(function() {\n            return self.publishElement.isEnabled();\n        }, 2000);\n    };\n\n    self.publish = function() {\n        self.waitForPublish();\n        return self.publishElement.click();\n    };\n\n    self.publishText = function(data) {\n        data = (typeof data === 'string') ? data : randomString(10);\n        self.textElement.clear().sendKeys(data);\n        self.publish();\n        return data;\n    };\n\n    self.publishScorecard = function() {\n        var data = {\n            homeName: randomString(10),\n            homeScore: randomNumber(2),\n            awayName: randomString(10),\n            awayScore: randomNumber(2),\n            player1Name: randomString(10),\n            player1Time: randomNumber(2),\n            player2Name: randomString(10),\n            player2Time: randomNumber(2),\n        };\n        self.homeName.sendKeys(data.homeName);\n        self.homeScore.sendKeys(data.homeScore);\n        self.awayName.sendKeys(data.awayName);\n        self.awayScore.sendKeys(data.awayScore);\n        self.player1Name.sendKeys(data.player1Name);\n        self.player1Time.sendKeys(data.player1Time);\n\n        return self.publish().then(function() {return data;});\n    };\n\n    self.getPublishStatus = function(data) {\n        self.textElement.clear().sendKeys(data);\n        return self.publishElement.isEnabled();\n    };\n\n    self.writeMultiplePost = function() {\n        var data = {\n            body: randomString(10),\n            quote: randomString(10),\n            author: randomString(10)\n        };\n        self.textElement.sendKeys(data.body);\n        self.addTop()\n            .addQuote(data);\n        return data;\n    };\n\n    self.createDraft = function() {\n        var data = self.writeMultiplePost();\n        self.saveDraft();\n        return data;\n    };\n\n    self.createContribution = function() {\n        var data = self.writeMultiplePost();\n        return self.saveContribution().then(function() {return data;});\n    };\n\n    self.resetEditor = function(freestyle) {\n        var isFreestyle = freestyle || false;\n        element(by.css('[ng-click=\"askAndResetEditor()\"]')).click().then(function() {\n            if (!isFreestyle) {\n                browser.wait(function() {\n                    return element(by.css('.editor .st-text-block')).isPresent();\n                });\n                expect(element(by.css('.editor .st-text-block')).getText()).toEqual('');\n            }\n        });\n        return self;\n    };\n\n    self.waitForEditor = function() {\n        browser.wait(function() {\n            return element(by.css('.editor .st-text-block')).isPresent();\n        });\n        return self;\n    };\n}\n\nfunction BlogSettingsPage(blog) {\n    'use strict';\n    var self = this;\n\n    self.team = new TeamPage();\n    self.blog = blog;\n    self.title = element(by.model('settings.newBlog.title'));\n    self.description = element(by.css('[ng-model=\"settings.newBlog.description\"]'));\n    self.file = element(by.css('input[type=\"file\"]'));\n    self.saveAndClose = element(by.css('[ng-click=\"settings.saveAndClose()\"]'));\n\n    self.displayName = element(by.css('[data=\"original-creator-display-name\"]'));\n    self.userName = element(by.css('[data=\"original-creator-username\"]'));\n\n    self.contributors = element(by.css('.subsettings-content:nth-child(5)')).all(by.repeater('member in settings.members'));\n\n    // bind modal global methods.\n    self.waitForModal = waitForModal.bind(self);\n    self.okModal = okModal.bind(self);\n\n    self.done = function() {\n        self.saveAndClose.click();\n        return self.blog;\n    };\n    self.waitDone = function() {\n        browser.wait(function() {\n            return self.saveAndClose.isEnabled();\n        });\n        return self;\n    };\n    self.save = function() {\n        element(by.css('[ng-click=\"settings.save()\"]')).click();\n        return self;\n    };\n    self.openTeam = function() {\n        return element(by.css('[data=\"blog-settings-team\"] a')).click().then(function() {\n            browser.waitForAngular();\n            return self;\n        });\n    };\n\n    self.switchStatus = function() {\n        element(by.css('[data-blog-status-switch]')).click();\n        return self;\n    };\n\n    self.openUploadModal = function() {\n        element(by.css('[ng-click=\"settings.openUploadModal()\"]')).click();\n        return self;\n    };\n\n    self.upload = function() {\n        element(by.css('button[ng-click=\"save()\"]')).click();\n        return self;\n    };\n\n    self.removeImage = function() {\n        element(by.css('[ng-click=\"settings.removeImage()\"]')).click();\n        return self;\n    };\n\n    self.changeOwner = function() {\n        element(by.css('[data-button=\"CHANGE OWNER\"]')).click();\n        return self;\n    };\n\n    self.changeToOwner = function(index) {\n        index = index || 2;\n        element(by.repeater('user in settings.avUsers').row(index).column('user.display_name')).click();\n        return self;\n    };\n\n    self.selectOwner = function() {\n        browser.sleep(1000);\n        element(by.buttonText('Select')).click();\n        return self;\n    };\n\n    self.editTeam = function() {\n        element(by.css('[data-button=\"EDIT TEAM\"]')).click();\n        return self;\n    };\n\n    self.doneTeamEdit = function() {\n        element(by.css('[ng-click=\"settings.doneTeamEdit()\"]')).click();\n        return self;\n    };\n\n    self.removeBlog = function() {\n        element(by.buttonText('Remove blog')).click().then(function() {\n            element(by.css('button[ng-click=\"ok()\"]')).click();\n        });\n    };\n}\n\nfunction TeamPage() {\n    'use strict';\n    var self = this;\n    self.searchUser = function(search) {\n        element(by.model('search')).sendKeys(search);\n        return self;\n    };\n\n    self.waitChooseUser = function() {\n        browser.wait(function() {\n            return element(by.css('[ng-click=\"choose(user)\"]')).isPresent();\n        }, 5000);\n        return self;\n    };\n\n    self.changeToUser = function(index) {\n        index = index || 0;\n        element(by.repeater('user in users._items').row(index)).click();\n        return self;\n    };\n}\n\nfunction GeneralSettingsPage() {\n    'use strict';\n    var self = this;\n\n    self.themeModel = 'liveblogSettings.theme.value';\n\n    self.open = function() {\n        element(by.css('[ng-click=\"toggleMenu()\"]')).click();\n        browser.wait(function() {\n            return element(by.css('[href=\"#/settings\"]')).isDisplayed();\n        });\n        element(by.css('[href=\"#/settings\"]')).click();\n        return self;\n    };\n\n    self.save = function() {\n        browser.wait(function() {\n            return element(by.css('[ng-click=\"saveSettings()\"]')).isEnabled();\n        });\n        element(by.css('[ng-click=\"saveSettings()\"]')).click();\n        return self;\n    };\n\n    self.setSelected = function(model, value) {\n        element(by.model(model)).sendKeys(value);\n        return self;\n    };\n\n    self.setTheme = function(value) {\n        self.setSelected(self.themeModel, value);\n        return self;\n    };\n\n    self.expectSelected = function(model, value) {\n        browser.waitForAngular();\n        browser.sleep(1000);\n        expect(element(by.model(model)).element(by.css('option:checked')).getText()).toEqual(value);\n    };\n\n    self.expectTheme = function(value) {\n        self.expectSelected(self.themeModel, value);\n        return self;\n    };\n}\n\nfunction randomString(maxLen) {\n    'use strict';\n    maxLen = maxLen || 15;\n    var text = '';\n    var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    for (var i = 0; i < maxLen; i ++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n    return text;\n}\n\nfunction randomNumber(maxLen) {\n    'use strict';\n    maxLen = maxLen || 15;\n    var text = '';\n    var possible = '123456789';\n    for (var i = 0; i < maxLen; i ++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n    return String(parseInt(text, 10));\n}\n\nfunction ConsumersManagementPage() {\n    'use strict';\n    var self = this;\n    self.themes = element.all(by.css('.theme'));\n    self.blogsRows = element.all(by.repeater('blog in vm.selectedTheme.blogs'));\n    self.fileThemeElement = element(by.css('#uploadAThemeFile'));\n    self.byRemove = by.css('[ng-click=\"vm.removeTheme(theme)\"]');\n    self.bySettings = by.css('[ng-click=\"vm.openThemeSettings(theme)\"]');\n    self.byPreview = by.css('[ng-click=\"theme.screenshot_url && vm.openThemePreview(theme)\"]');\n\n    self.openConsumersManagement = function() {\n        element(by.css('[ng-click=\"toggleMenu()\"]')).click();\n        browser.wait(function() {\n            return element(by.css('[href=\"#/syndication/\"][title]')).isDisplayed();\n        });\n        waitAndClick(by.css('[href=\"#/syndication/\"][title]'));\n\n        browser.waitForAngular();\n        element.all(by.repeater('state in states').row(1)).click();\n\n        return self;\n    };\n}\n\nfunction ProducersManagementPage() {\n    'use strict';\n    var self = this;\n\n    self.openProducersManagement = function() {\n        element(by.css('[ng-click=\"toggleMenu()\"]')).click();\n        browser.wait(function() {\n            return element(by.css('[href=\"#/syndication/\"][title]')).isDisplayed();\n        });\n        waitAndClick(by.css('[href=\"#/syndication/\"][title]'));\n\n        //browser.waitForAngular();\n\n        return self;\n    };\n}\n\nexports.blogs = new BlogsPage();\nexports.generalSettings = new GeneralSettingsPage();\nexports.randomString = randomString;\nexports.themeManager = new ThemesManagerPage();\nexports.consumersManagement = new ConsumersManagementPage();\nexports.producersManagement = new ProducersManagementPage();\nexports.freetypesManager = new FreetypesManagerPage();\nexports.advertisingManager = new AdvertisingManagerPage();\n",
                "new_contents": "var waitAndClick = require('./utils').waitAndClick;\n\nvar blogs = [\n    [\n        {\n            title: 'title: end to end image',\n            description: 'description: end to end image',\n            username: 'Victor the Editor',\n            picture_url: 'http://i.imgur.com/L0Ci8Yj.png'\n        },\n        {title: 'title: end To end three', description: 'description: end to end three', username: 'Victor the Editor'},\n        {title: 'title: end to end two', description: 'description: end to end two', username: 'Victor the Editor'},\n        {title: 'title: end to end One', description: 'description: end to end one', username: 'Victor the Editor'}\n    ], [\n        {title: 'title: end to end closed', description: 'description: end to end closed', username: 'Victor the Editor'}\n    ]\n], stateMap = {\n    'active': 0,\n    'archived': 1\n};\n\nfunction waitForModal() {\n    'use strict';\n     /*jshint validthis: true */\n    browser.wait(function() {\n        return element(by.css('.modal-footer')).isDisplayed();\n    }, 1000);\n    return this;\n}\nfunction okModal() {\n    'use strict';\n     /*jshint validthis: true */\n    element(by.css('[ng-click=\"ok()\"]')).click();\n    return this;\n}\nfunction BlogsPage() {\n    'use strict';\n    var self = this;\n\n    self.blog = new BlogPage(self);\n    self.team = new TeamPage(self);\n\n    self.blogs = blogs;\n\n    self.cloneBlog = function(index, state) {\n        index = index || 0;\n        state = state || 0;\n        if (parseInt(state, 10) !== state){\n            state = stateMap[state];\n        }\n        return JSON.parse(JSON.stringify(self.blogs[state][index]));\n    };\n\n    self.waitForModal = waitForModal.bind(self);\n\n    self.title = element(by.model('newBlog.title'));\n    self.description = element(by.css('[ng-model=\"newBlog.description\"]'));\n    self.file = element(by.css('input[type=\"file\"]'));\n\n    self.gridElement = element(by.css('.list-container table'));\n\n    self.switchView = function() {\n        element(by.css('button[ng-show=\"blogsView === \\'grid\\'\"]')).click();\n    };\n\n    self.getActiveBlogs = function() {\n        return self.blogs[0];\n    };\n\n    self.getArchivedBlogs = function() {\n        return self.blogs[1];\n    };\n\n    self.searchBlogs = function(search) {\n        element(by.css('[ng-click=\"flags.extended = !flags.extended\"]')).click()\n        .then(function() {\n            element(by.model('q')).waitReady()\n            .then(function(elem) {\n                elem.clear().sendKeys(search.search);\n                browser.getCurrentUrl().then(function(url) {\n                    expect(url.indexOf('q=' + search.search)).toBeGreaterThan(-1);\n                })\n                .then(function () {\n                    self.expectCount(search.blogs.length);\n                    for (var j = 0, countj = search.blogs.length; j < countj; j++) {\n                        self.expectBlog(self.blogs[0][search.blogs[j]], j);\n                    }\n                });\n            });\n        });\n        return self;\n    };\n\n    self.openCreateBlog = function() {\n        element(by.css('[ng-click=\"openNewBlog();\"]')).click();\n        return self;\n    };\n\n    self.createBlogNext = function() {\n        element(by.buttonText('Next')).click();\n        return self;\n    };\n\n    self.createBlogCreate = function() {\n        element(by.buttonText('Create')).click();\n        return self.blog;\n    };\n\n    self.openBlog = function(index) {\n        index = index || 0;\n        element(by.repeater('blog in blogs._items').row(index).column('blog.title')).click();\n        return self.blog;\n    };\n\n    self.expectBlog = function(blog, index) {\n        index = index || 0;\n        browser.waitForAngular();\n        var currentBlog = element.all(by.repeater('blog in blogs._items')).get(index);\n        expect(currentBlog.element(by.binding('blog.title')).getText()).toBe(blog.title);\n        expect(currentBlog.element(by.binding('blog.description')).getText()).toBe(blog.description);\n        if (blog.picture_url) {\n            expect(currentBlog.element(by.css('[if-background-image]')).isPresent()).toBe(true);\n        } else {\n            expect(currentBlog.element(by.css('[if-background-image]')).isPresent()).toBe(false);\n        }\n        expect(currentBlog.element(by.binding('blog.original_creator | username')).getText())\n        .toBe(blog.username);\n    };\n\n    self.expectCount = function(count) {\n        browser.waitForAngular();\n        expect(element.all(by.repeater('blog in blogs._items')).count()).toEqual(count);\n    };\n\n    self.selectState = function(state) {\n        state = state || 1;\n        if (parseInt(state, 10) !== state){\n            state = stateMap[state];\n        }\n        browser.waitForAngular();\n        element.all(by.repeater('state in states').row(state)).get(0).click();\n        return self;\n    };\n}\n\nfunction FreetypesManagerPage() {\n    'use strict';\n    var self = this;\n    self.title = element(by.css('[ng-model=\"vm.dialogFreetype.name\"]'));\n    self.template = element(by.css('[ng-model=\"vm.dialogFreetype.template\"]'));\n\n    self.getFreetypes = function() {\n        return element.all(by.repeater('freetype in vm.freetypes'));\n    };\n    self.openFreetypesManager = function() {\n        element(by.css('[ng-click=\"toggleMenu()\"]')).click();\n        browser.wait(function() {\n            return element(by.css('[href=\"#/freetypes/\"][title]')).isDisplayed();\n        });\n        waitAndClick(by.css('[href=\"#/freetypes/\"][title]'));\n        return self;\n    };\n    self.saveFreetype = function() {\n        return element(by.css('[ng-click=\"vm.saveFreetype()\"]')).click();\n    };\n    self.openNewFreetypeDialog = function() {\n        element(by.css('[ng-click=\"vm.openFreetypeDialog();\"]')).click();\n    };\n    self.createFreetypeData = function() {\n        return {\n            title: randomString(5),\n            template: 'name=$' + randomString(10)\n        };\n    };\n    self.editFreetype = function() {\n        var freeData = self.createFreetypeData();\n        self.title.sendKeys(freeData.title);\n        self.template.sendKeys(freeData.template);\n        return self.saveFreetype().then(function() {return freeData;});\n    };\n    self.removeFreetype = function(index) {\n        index = index || 0;\n        self.getFreetypes().get(index).click().all(by.css('[ng-click=\"vm.removeFreetype(freetype, $index);\"]')).click();\n        okModal();\n    };\n}\n\nfunction AdvertisingManagerPage() {\n    'use strict';\n    var self = this;\n    self.advertTitle = element(by.css('[ng-model=\"advert.name\"]'));\n    self.collectionTitle = element(by.css('[ng-model=\"collection.name\"]'));\n    self.advertEmbed = element(by.css('[ng-model=\"embed\"]'));\n\n    self.getAdverts = function() {\n        return element.all(by.repeater('advert in adverts'));\n    };\n    self.getCollections = function() {\n        return element.all(by.repeater('collection in collections'));\n    };\n    self.openAdvertisingManager = function() {\n        element(by.css('[ng-click=\"toggleMenu()\"]')).click();\n        browser.wait(function() {\n            return element(by.css('[href=\"#/advertising/\"][title]')).isDisplayed();\n        });\n        waitAndClick(by.css('[href=\"#/advertising/\"][title]'));\n        return self;\n    };\n    self.openAdvertsTab = function() {\n        waitAndClick(by.css('[ng-click=\"changeState(\\'adverts\\')\"]'));\n        return self;\n    };\n    self.openCollectionsTab = function() {\n        waitAndClick(by.css('[ng-click=\"changeState(\\'collections\\')\"]'));\n        return self;\n    };\n    self.saveAdvert = function() {\n        return element(by.css('[ng-click=\"saveAdvert()\"]')).click();\n    };\n    self.saveCollection = function() {\n        return element(by.css('[ng-click=\"saveCollection()\"]')).click();\n    };\n    self.openNewAdvertDialog = function() {\n        element(by.css('[dropdown__toggle]')).click();\n        browser.wait(function() {\n            return element(by.buttonText(\"Advertisement Remote\")).isDisplayed();\n        });\n        element(by.buttonText(\"Advertisement Remote\")).click();\n        return self;\n    };\n    self.openNewCollectionDialog = function() {\n        element(by.css('[ng-click=\"openCollectionDialog();\"]')).click();\n    }\n    self.createAdvertData = function() {\n        return {\n            title: randomString(5),\n            embed: randomString(10)\n        };\n    };\n    self.editFreetype = function() {\n        var freeData = self.createAdvertData();\n        self.advertTitle.sendKeys(freeData.title);\n        self.advertEmbed.sendKeys(freeData.embed);\n        return self.saveAdvert().then(function() {return freeData;});\n    };\n    self.editCollection = function() {\n<<<<<<< HEAD\n        var freeData = self.createAdvertData();\n=======\n        var freeData = self.createFreetypeData();\n>>>>>>> 74af51c2... Intermediate\n        self.collectionTitle.sendKeys(freeData.title);\n        return self.saveCollection().then(function() {return freeData;});\n    }\n    self.removeAdvert = function(index) {\n        index = index || 0;\n        self.getAdverts().get(index).click().all(by.css('[ng-click=\"removeAdvert(advert, $index);\"]')).click();\n        waitForModal();\n        okModal();\n    };\n    self.removeCollection = function(index) {\n        index = index || 0;\n        // self.getCollections().get(index).click().all(by.css('[ng-click=\"removeCollection(collection, $index)\"]')).click();\n        self.getCollections().get(index).all(by.id('toggle-collection-menu')).click();\n        element(by.css('[ng-click=\"removeCollection(collection, $index)\"]')).click();\n        okModal();\n    };\n    self.removeAdvert = function(index) {\n        index = index || 0;\n        self.getFreetypes().get(index).click().all(by.css('[ng-click=\"removeCollection(freetype, $index);\"]')).click();\n        okModal();\n    };\n}\n\nfunction ThemesManagerPage() {\n    'use strict';\n    var self = this;\n    self.themes = element.all(by.css('.theme'));\n    self.blogsRows = element.all(by.repeater('blog in vm.selectedTheme.blogs'));\n    self.fileThemeElement = element(by.css('#uploadAThemeFile'));\n    self.byRemove = by.css('[ng-click=\"vm.removeTheme(theme)\"]');\n    self.bySettings = by.css('[ng-click=\"vm.openThemeSettings(theme)\"]');\n    self.byPreview = by.css('[ng-click=\"theme.screenshot_url && vm.openThemePreview(theme)\"]');\n\n    self.openThemesManager = function() {\n        element(by.css('[ng-click=\"toggleMenu()\"]')).click();\n        browser.wait(function() {\n            return element(by.css('[href=\"#/themes/\"][title]')).isDisplayed();\n        });\n        waitAndClick(by.css('[href=\"#/themes/\"][title]'));\n        return self;\n    };\n\n    self.setAsDefault = function(theme_index) {\n        return self.themes.get(theme_index).element(by.css('[ng-click=\"vm.makeDefault(theme)\"]')).click();\n    };\n\n    self.openSettingsForTheme = function(themeIndex) {\n        //self.themes.get(themeIndex).element(self.bySettings).click();\n        //browser.wait(function() {\n        //    return element(by.css('[name=\"vm.themeSettingsForm\"]')).isDisplayed();\n        //});\n        //return self;\n        return self.themes.get(themeIndex).element(self.bySettings).click()\n            //.then(() => {\n            //    return browser.wait();\n            //})\n            .then(() => {\n                return element(by.css('[name=\"vm.themeSettingsForm\"]')).isDisplayed();\n            });\n    };\n\n    self.saveSettings = function() {\n        return element(by.css('[ng-click=\"vm.submitSettings(true)\"]'))\n            .click();\n    };\n\n    self.remove = function(theme_index) {\n        self.themes.get(theme_index).element(self.byRemove).click();\n        return self;\n    };\n\n    self.openPreview = function(theme_index) {\n        self.themes.get(theme_index).element(self.byPreview).click().then(function() {\n            expect(element(by.css('.theme-preview-modal .modal-dialog')).isDisplayed()).toBe(true);\n            element(by.css('.theme-preview-modal .close')).click();\n        });\n        return self;\n    };\n\n    self.expectTheme = function(index, params) {\n        var theme = self.themes.get(index);\n        // check if it is the default theme\n        expect(theme.element(by.css('.default-theme')).isDisplayed()).toBe(params.is_default_theme);\n        // check if the name match\n        if (params.name) {\n            expect(theme.element(by.css('h3')).getText()).toBe(params.name);\n        }\n        //this only makes sense if the theme has at least one blog using it\n        if (params.number_of_blogs_expected > 0) {\n            var number_of_blog_elmt = theme.element(by.css('span[data-name=\\'noOfBlogs\\']'));\n            // check if the number shown match\n            expect(number_of_blog_elmt.getText()).toBe(params.number_of_blogs_expected.toString());\n            // open the modal\n            number_of_blog_elmt.click();\n            // check if first row is displayed\n            if (params.number_of_blogs_expected > 0) {\n                expect(self.blogsRows.get(0).isDisplayed()).toBe(true);\n            }\n            // check if the number of row matchs\n            expect(self.blogsRows.count()).toBe(params.number_of_blogs_expected);\n            var close_modal = element(by.css('[ng-click=\"vm.closeThemeBlogsModal()\"]'));\n            close_modal.isPresent().then(function(is_present) {\n                if (is_present) {\n                    close_modal.click();\n                }\n            });\n        }\n    };\n}\n\nfunction BlogPage(blogs) {\n    'use strict';\n    var self = this;\n    self.blogs = blogs;\n    self.drafts = new DraftsPage(self);\n    self.comments = new CommentsPage(self);\n    self.contributions = new ContributionsPage(self);\n    self.settings = new BlogSettingsPage(self);\n    self.timeline = new TimelinePage(self);\n    self.editor = new EditPostPage(self);\n\n    self.openDrafts = function() {\n        element(by.css('[ng-click=\"openPanel(\\'drafts\\')\"]')).click();\n        return self.drafts;\n    };\n\n    self.openComments = function() {\n        element(by.css('[ng-click=\"openPanel(\\'comments\\')\"]')).click();\n        return self.comments;\n    };\n\n    self.openEditor = function() {\n        element(by.css('[ng-click=\"openPanel(\\'editor\\')\"]')).click();\n        return self.editor;\n    };\n\n    self.openFreetypesEditor = function(index) {\n        var freetypeIndex = index || 0;\n        element(by.css('[ng-click=\"toggleTypePostDialog()\"]')).click()\n        .then(function() {\n            element(by.repeater('freetype in freetypes').row(freetypeIndex)).click();\n        });\n        return self.editor;\n    };\n\n    self.openContributions = function() {\n        element(by.css('[ng-click=\"openPanel(\\'contributions\\')\"]')).click();\n        return self.contributions;\n    };\n\n    self.openList = function() {\n        return waitAndClick(by.css('[class=\"icon-th-large\"]')).then(function() {return self.blogs;});\n    };\n\n    self.openArchive =  function() {\n        element(by.repeater('state in states').row(0).column('state.text')).click();\n    };\n\n    self.openSettings = function() {\n        return waitAndClick(by.css('.settings-link')).then(function() {return self.settings;});\n    };\n\n    self.expectNotificationsNo = function(notifsNo) {\n        expect(element(by.css('span.notification-counter')).getText()).toBe(notifsNo.toString());\n    };\n}\n\nfunction AbstractPanelPage(blog) {\n    'use strict';\n    var self = this;\n    self.blog = blog;\n    self.column = element(by.css(self._class_name));\n    self.byPosts = by.repeater('post in postsList.pagesManager.allPosts()');\n    self.byEditButton = by.css('[ng-click=\"onEditClick(post)\"]');\n    self.byPublishButton = by.css('[ng-click=\"publishPost(post)\"]');\n\n    self.get = function(index) {\n        return self.column.element(self.byPosts.row(index));\n    };\n\n    self.getFull = function(index) {\n        return self.get(index).element(by.css('.lb-post__list')).getText();\n    };\n\n    self.all = function() {\n        return self.column.all(self.byPosts);\n    };\n\n    self.editButtonIsPresent = function(draft) {\n        return draft.element(self.byEditButton).isPresent();\n    };\n\n    self.edit = function(draft) {\n        draft.element(self.byEditButton).click();\n        return self;\n    };\n\n    self.publish = function(draft) {\n        draft.element(self.byPublishButton).click();\n        return self;\n    };\n\n    self.expectPost = function(index, data) {\n        expect(self.get(index).element(by.css('[html-content]')).getText()).toContain(data);\n        return self;\n    };\n\n    self.expectUnreadPost = function(index) {\n        expect(self.get(index).element(by.css('.unread')).isPresent()).toBe(true);\n        return self;\n    };\n}\n\nDraftsPage.prototype = Object.create(AbstractPanelPage.prototype);\nfunction DraftsPage(blog) {\n    'use strict';\n    var self = this;\n    self._class_name = '.panel--draft';\n    AbstractPanelPage.call(self);\n}\n\nCommentsPage.prototype = Object.create(AbstractPanelPage.prototype);\nfunction CommentsPage(blog) {\n    'use strict';\n    var self = this;\n    self._class_name = '.panel--comments';\n    AbstractPanelPage.call(self);\n}\n\nContributionsPage.prototype = Object.create(AbstractPanelPage.prototype);\nfunction ContributionsPage(blog) {\n    'use strict';\n    var self = this;\n    self._class_name = '.panel--contribution';\n    self.byFilterBox = by.css('.dropdown-content');\n    self.validFilterButton = element(self.byFilterBox).element(by.buttonText('Select'));\n    AbstractPanelPage.call(self);\n\n    self.openFiterByMember = function() {\n        return self.column.element(by.css('.btn--plus')).click();\n    };\n\n    self.filterByMember = function(member_name) {\n        return self.openFiterByMember().then(function() {\n            element(self.byFilterBox)\n            .element(by.css('[data-username=\"' + member_name + '\"]'))\n            .click().then(function() {\n                return self.validFilterButton.click();\n            });\n        });\n    };\n}\n\nfunction TimelinePage(blog) {\n    'use strict';\n    var self = this;\n    self.blog = blog;\n    self.column = element(by.css('.column--timeline'));\n    self.byPosts = by.repeater('post in posts');\n    self.byEdit = by.css('[ng-click=\"onEditClick(post)\"]');\n    self.byUnpublish = by.css('[ng-click=\"unpublishPost(post)\"]');\n    self.byTogglePin = by.css('[ng-click=\"togglePinStatus(post)\"]');\n    self.byPinnedDrawer = by.css('div.timeline-posts-list.pinned');\n    self.byStartMoving = by.css('[ng-click=\"preMovePost(post);\"]');\n    self.byMoveTo = by.css('[ng-click=\"movePost(index, \\'above\\');\"]');\n    self.byRemove = by.css('[ng-click=\"askRemovePost(post)\"]');\n    self.waitForModal = waitForModal.bind(self);\n    self.okModal = okModal.bind(self);\n    self.byHighlight = by.css('[ng-click=\"highlightPost(post)\"]');\n\n    self.get = function(index) {\n        return self.column.element(self.byPosts.row(index));\n    };\n\n    self.getText = function(index) {\n        return self.get(index).element(by.css('[lb-bind-html]')).getText();\n    };\n\n    self.getFull = function(index) {\n        return self.get(index).element(by.css('.lb-post__list')).getText();\n    };\n\n    self.getUpdated = function(index) {\n        return self.get(index).element(by.css('.updated-time')).getText();\n    };\n\n    self.edit = function(index) {\n        self.column.element(self.byPosts.row(index)).element(self.byEdit).click();\n        return self;\n    };\n\n    self.unpublish = function(index) {\n        self.column.element(self.byPosts.row(index)).element(self.byUnpublish).click();\n        return self;\n    };\n\n    self.highlight = function(index) {\n        self.column.element(self.byPosts.row(index)).element(self.byHighlight).click();\n        return self;\n    };\n    self.togglePin = function(index) {\n        self.column.element(self.byPosts.row(index)).element(self.byTogglePin).click();\n        return self;\n    };\n\n    self.isPinDrawerVisible = function() {\n        return element(self.byPinnedDrawer).isDisplayed();\n    };\n    self.startMoving = function(index) {\n        self.column.element(self.byPosts.row(index)).element(self.byStartMoving).click();\n        return self;\n    };\n\n    self.canBeMoved = function(index) {\n        return self.column.element(self.byPosts.row(index)).element(self.byStartMoving).isPresent();\n    };\n\n    self.moveTo = function(index) {\n        self.column.element(self.byPosts.row(index)).element(self.byMoveTo).click();\n        return self;\n    };\n\n    self.remove = function(index) {\n        self.column.element(self.byPosts.row(index)).element(self.byRemove).click();\n        return self;\n    };\n\n    self.all = function() {\n        return self.column.all(self.byPosts);\n    };\n\n    self.expectPost = function(index, data) {\n        var post = self.get(index);\n        expect(self.getText(index)).toBe(data.text);\n        if (data.username) {\n            expect(post.element(by.binding('post.mainItem.item.user.display_name')).getText()).toBe(data.username);\n        }\n        return self;\n    };\n}\n\nfunction EditPostPage() {\n    'use strict';\n    var self = this;\n\n    self.textElement = element(by.css('.editor .st-text-block'));\n    self.quoteElement = element(by.css('.editor .st-quote-block'));\n    self.fileElement = element(by.css('input[type=\"file\"]'));\n    self.imageElement = element(by.css('.st-block__editor img'));\n    self.errorElement = element(by.css('.st-msg'));\n    self.embedElement = element(by.css('.embed-input'));\n    self.iframe = element(by.css('.liveblog--card iframe'));\n    self.publishElement = element(by.css('[ng-click=\"publish()\"]'));\n    //for scorecards\n    self.homeName = element(by.css('[text=\"freetypeData.home.name\"] [ng-model=\"text\"]'));\n    self.homeScore = element(by.css('[text=\"freetypeData.home.score\"] [ng-model=\"text\"]'));\n    self.awayName = element(by.css('[text=\"freetypeData.away.name\"] [ng-model=\"text\"]'));\n    self.awayScore = element(by.css('[text=\"freetypeData.away.score\"] [ng-model=\"text\"]'));\n    self.player1Name = element.all(by.css('[text=\"iterator__1.name\"] [ng-model=\"text\"]')).get(0);\n    self.player1Time = element.all(by.css('[text=\"iterator__1.time\"] [ng-model=\"text\"]')).get(0);\n    self.player2Name = element.all(by.css('[text=\"iterator__1.name\"] [ng-model=\"text\"]')).get(1);\n    self.player2Time = element.all(by.css('[text=\"iterator__1.time\"] [ng-model=\"text\"]')).get(1);\n\n    self.addTop = function() {\n        // click on the \"+\" bar\n        element(by.css('.st-block-controls__top')).click();\n        return self;\n    };\n\n    self.addImage = function() {\n        element(by.css('[data-type=\"image\"]')).click();\n        return self;\n    };\n\n    self.addQuote = function(data) {\n        // click on the quote button\n        element(by.css('[data-type=\"quote\"]')).click();\n        element(by.css('.editor .quote-input')).sendKeys(data.quote);\n        element(by.css('.editor .js-cite-input')).sendKeys(data.author);\n        return self;\n    };\n\n    self.addEmbed = function() {\n        element(by.css('[data-type=\"embed\"]')).click();\n        return self;\n    };\n\n    self.saveDraft = function() {\n        element(by.css('[ng-click=\"saveAsDraft()\"]')).click();\n        return self;\n    };\n\n    self.saveContribution = function() {\n        return element(by.css('[ng-click=\"saveAsContribution()\"]')).click();\n    };\n\n    self.waitForPublish = function() {\n        browser.wait(function() {\n            return self.publishElement.isEnabled();\n        }, 2000);\n    };\n\n    self.publish = function() {\n        self.waitForPublish();\n        return self.publishElement.click();\n    };\n\n    self.publishText = function(data) {\n        data = (typeof data === 'string') ? data : randomString(10);\n        self.textElement.clear().sendKeys(data);\n        self.publish();\n        return data;\n    };\n\n    self.publishScorecard = function() {\n        var data = {\n            homeName: randomString(10),\n            homeScore: randomNumber(2),\n            awayName: randomString(10),\n            awayScore: randomNumber(2),\n            player1Name: randomString(10),\n            player1Time: randomNumber(2),\n            player2Name: randomString(10),\n            player2Time: randomNumber(2),\n        };\n        self.homeName.sendKeys(data.homeName);\n        self.homeScore.sendKeys(data.homeScore);\n        self.awayName.sendKeys(data.awayName);\n        self.awayScore.sendKeys(data.awayScore);\n        self.player1Name.sendKeys(data.player1Name);\n        self.player1Time.sendKeys(data.player1Time);\n\n        return self.publish().then(function() {return data;});\n    };\n\n    self.getPublishStatus = function(data) {\n        self.textElement.clear().sendKeys(data);\n        return self.publishElement.isEnabled();\n    };\n\n    self.writeMultiplePost = function() {\n        var data = {\n            body: randomString(10),\n            quote: randomString(10),\n            author: randomString(10)\n        };\n        self.textElement.sendKeys(data.body);\n        self.addTop()\n            .addQuote(data);\n        return data;\n    };\n\n    self.createDraft = function() {\n        var data = self.writeMultiplePost();\n        self.saveDraft();\n        return data;\n    };\n\n    self.createContribution = function() {\n        var data = self.writeMultiplePost();\n        return self.saveContribution().then(function() {return data;});\n    };\n\n    self.resetEditor = function(freestyle) {\n        var isFreestyle = freestyle || false;\n        element(by.css('[ng-click=\"askAndResetEditor()\"]')).click().then(function() {\n            if (!isFreestyle) {\n                browser.wait(function() {\n                    return element(by.css('.editor .st-text-block')).isPresent();\n                });\n                expect(element(by.css('.editor .st-text-block')).getText()).toEqual('');\n            }\n        });\n        return self;\n    };\n\n    self.waitForEditor = function() {\n        browser.wait(function() {\n            return element(by.css('.editor .st-text-block')).isPresent();\n        });\n        return self;\n    };\n}\n\nfunction BlogSettingsPage(blog) {\n    'use strict';\n    var self = this;\n\n    self.team = new TeamPage();\n    self.blog = blog;\n    self.title = element(by.model('settings.newBlog.title'));\n    self.description = element(by.css('[ng-model=\"settings.newBlog.description\"]'));\n    self.file = element(by.css('input[type=\"file\"]'));\n    self.saveAndClose = element(by.css('[ng-click=\"settings.saveAndClose()\"]'));\n\n    self.displayName = element(by.css('[data=\"original-creator-display-name\"]'));\n    self.userName = element(by.css('[data=\"original-creator-username\"]'));\n\n    self.contributors = element(by.css('.subsettings-content:nth-child(5)')).all(by.repeater('member in settings.members'));\n\n    // bind modal global methods.\n    self.waitForModal = waitForModal.bind(self);\n    self.okModal = okModal.bind(self);\n\n    self.done = function() {\n        self.saveAndClose.click();\n        return self.blog;\n    };\n    self.waitDone = function() {\n        browser.wait(function() {\n            return self.saveAndClose.isEnabled();\n        });\n        return self;\n    };\n    self.save = function() {\n        element(by.css('[ng-click=\"settings.save()\"]')).click();\n        return self;\n    };\n    self.openTeam = function() {\n        return element(by.css('[data=\"blog-settings-team\"] a')).click().then(function() {\n            browser.waitForAngular();\n            return self;\n        });\n    };\n\n    self.switchStatus = function() {\n        element(by.css('[data-blog-status-switch]')).click();\n        return self;\n    };\n\n    self.openUploadModal = function() {\n        element(by.css('[ng-click=\"settings.openUploadModal()\"]')).click();\n        return self;\n    };\n\n    self.upload = function() {\n        element(by.css('button[ng-click=\"save()\"]')).click();\n        return self;\n    };\n\n    self.removeImage = function() {\n        element(by.css('[ng-click=\"settings.removeImage()\"]')).click();\n        return self;\n    };\n\n    self.changeOwner = function() {\n        element(by.css('[data-button=\"CHANGE OWNER\"]')).click();\n        return self;\n    };\n\n    self.changeToOwner = function(index) {\n        index = index || 2;\n        element(by.repeater('user in settings.avUsers').row(index).column('user.display_name')).click();\n        return self;\n    };\n\n    self.selectOwner = function() {\n        browser.sleep(1000);\n        element(by.buttonText('Select')).click();\n        return self;\n    };\n\n    self.editTeam = function() {\n        element(by.css('[data-button=\"EDIT TEAM\"]')).click();\n        return self;\n    };\n\n    self.doneTeamEdit = function() {\n        element(by.css('[ng-click=\"settings.doneTeamEdit()\"]')).click();\n        return self;\n    };\n\n    self.removeBlog = function() {\n        element(by.buttonText('Remove blog')).click().then(function() {\n            element(by.css('button[ng-click=\"ok()\"]')).click();\n        });\n    };\n}\n\nfunction TeamPage() {\n    'use strict';\n    var self = this;\n    self.searchUser = function(search) {\n        element(by.model('search')).sendKeys(search);\n        return self;\n    };\n\n    self.waitChooseUser = function() {\n        browser.wait(function() {\n            return element(by.css('[ng-click=\"choose(user)\"]')).isPresent();\n        }, 5000);\n        return self;\n    };\n\n    self.changeToUser = function(index) {\n        index = index || 0;\n        element(by.repeater('user in users._items').row(index)).click();\n        return self;\n    };\n}\n\nfunction GeneralSettingsPage() {\n    'use strict';\n    var self = this;\n\n    self.themeModel = 'liveblogSettings.theme.value';\n\n    self.open = function() {\n        element(by.css('[ng-click=\"toggleMenu()\"]')).click();\n        browser.wait(function() {\n            return element(by.css('[href=\"#/settings\"]')).isDisplayed();\n        });\n        element(by.css('[href=\"#/settings\"]')).click();\n        return self;\n    };\n\n    self.save = function() {\n        browser.wait(function() {\n            return element(by.css('[ng-click=\"saveSettings()\"]')).isEnabled();\n        });\n        element(by.css('[ng-click=\"saveSettings()\"]')).click();\n        return self;\n    };\n\n    self.setSelected = function(model, value) {\n        element(by.model(model)).sendKeys(value);\n        return self;\n    };\n\n    self.setTheme = function(value) {\n        self.setSelected(self.themeModel, value);\n        return self;\n    };\n\n    self.expectSelected = function(model, value) {\n        browser.waitForAngular();\n        browser.sleep(1000);\n        expect(element(by.model(model)).element(by.css('option:checked')).getText()).toEqual(value);\n    };\n\n    self.expectTheme = function(value) {\n        self.expectSelected(self.themeModel, value);\n        return self;\n    };\n}\n\nfunction randomString(maxLen) {\n    'use strict';\n    maxLen = maxLen || 15;\n    var text = '';\n    var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    for (var i = 0; i < maxLen; i ++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n    return text;\n}\n\nfunction randomNumber(maxLen) {\n    'use strict';\n    maxLen = maxLen || 15;\n    var text = '';\n    var possible = '123456789';\n    for (var i = 0; i < maxLen; i ++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n    return String(parseInt(text, 10));\n}\n\nfunction ConsumersManagementPage() {\n    'use strict';\n    var self = this;\n    self.themes = element.all(by.css('.theme'));\n    self.blogsRows = element.all(by.repeater('blog in vm.selectedTheme.blogs'));\n    self.fileThemeElement = element(by.css('#uploadAThemeFile'));\n    self.byRemove = by.css('[ng-click=\"vm.removeTheme(theme)\"]');\n    self.bySettings = by.css('[ng-click=\"vm.openThemeSettings(theme)\"]');\n    self.byPreview = by.css('[ng-click=\"theme.screenshot_url && vm.openThemePreview(theme)\"]');\n\n    self.openConsumersManagement = function() {\n        element(by.css('[ng-click=\"toggleMenu()\"]')).click();\n        browser.wait(function() {\n            return element(by.css('[href=\"#/syndication/\"][title]')).isDisplayed();\n        });\n        waitAndClick(by.css('[href=\"#/syndication/\"][title]'));\n\n        browser.waitForAngular();\n        element.all(by.repeater('state in states').row(1)).click();\n\n        return self;\n    };\n}\n\nfunction ProducersManagementPage() {\n    'use strict';\n    var self = this;\n\n    self.openProducersManagement = function() {\n        element(by.css('[ng-click=\"toggleMenu()\"]')).click();\n        browser.wait(function() {\n            return element(by.css('[href=\"#/syndication/\"][title]')).isDisplayed();\n        });\n        waitAndClick(by.css('[href=\"#/syndication/\"][title]'));\n\n        //browser.waitForAngular();\n\n        return self;\n    };\n}\n\nexports.blogs = new BlogsPage();\nexports.generalSettings = new GeneralSettingsPage();\nexports.randomString = randomString;\nexports.themeManager = new ThemesManagerPage();\nexports.consumersManagement = new ConsumersManagementPage();\nexports.producersManagement = new ProducersManagementPage();\nexports.freetypesManager = new FreetypesManagerPage();\nexports.advertisingManager = new AdvertisingManagerPage();\n",
                "subject": "Intermediate",
                "message": "Intermediate\n",
                "lang": "JavaScript",
                "license": "agpl-3.0",
                "repos": "superdesk/liveblog,liveblog/liveblog,superdesk/liveblog,superdesk/liveblog,hlmnrmr/liveblog,liveblog/liveblog,liveblog/liveblog,hlmnrmr/liveblog,liveblog/liveblog,hlmnrmr/liveblog,superdesk/liveblog,hlmnrmr/liveblog,liveblog/liveblog"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10275,
            "row": {
                "commit": "7dd87ca4fc051d82e82021249fb8b076fc460c82",
                "old_file": "client/src/city-generator.js",
                "new_file": "client/src/city-generator.js",
                "old_contents": "/* Contains code for better city level generation. */\n\nconst RG = require('./rg');\nconst LevelGenerator = require('./level-generator');\nconst MapGenerator = require('./map.generator');\nconst DungeonPopulate = require('./dungeon-populate');\n\nconst RNG = RG.Random.getRNG();\n\n/* Object for the city generator. */\nconst CityGenerator = function() {\n    LevelGenerator.call(this);\n    this.addDoors = true;\n    this.shouldRemoveMarkers = true;\n};\nRG.extend2(CityGenerator, LevelGenerator);\n\nCityGenerator.options = {\n    village: {\n        actorsPerLevel: 30,\n        maxDanger: 3,\n        itemsPerLevels: 6\n    },\n    capital: {\n\n    },\n    stronghold: {\n\n    },\n    fort: {\n\n    }\n};\n\nCityGenerator.prototype.create = function(cols, rows, conf) {\n    const level = this.createLevel(cols, rows, conf);\n\n    this.populateCityLevel(level, conf);\n    // TODO populate level with actors based on conf\n    return level;\n};\n\n/* Returns a castle level without populating it. */\nCityGenerator.prototype.createLevel = function(cols, rows, conf) {\n    const mapGen = new MapGenerator();\n    let mapObj = null;\n\n    if (conf.hasWall) {\n        mapObj = mapGen.createTownWithWall(cols, rows, conf);\n    }\n    else {\n        mapObj = mapGen.createTownBSP(cols, rows, conf);\n    }\n\n    const level = new RG.Map.Level();\n    level.setMap(mapObj.map);\n\n    level.addExtras('houses', mapObj.houses);\n    this.createHouseElements(level);\n    this.fillUnusedAreas(level, mapObj.unused);\n    return level;\n};\n\nCityGenerator.prototype.createHouseElements = function(level) {\n    const houses = level.getExtras().houses;\n    for (let i = 0; i < houses.length; i++) {\n        const doorXY = houses[i].door;\n        const door = new RG.Element.Door(true);\n        level.addElement(door, doorXY[0], doorXY[1]);\n        console.log('Adding door to', doorXY);\n    }\n};\n\nCityGenerator.prototype.fillUnusedAreas = function(level, areas) {\n    const map = level.getMap();\n    const elems = [RG.ELEM.GRASS, RG.ELEM.TREE, RG.ELEM.WATER];\n    areas.forEach(area => {\n        const baseElem = RNG.arrayGetRand(elems);\n        let {w, h} = area;\n        const {x, y} = area;\n        w -= 2; // Without this, areas overlap with houses\n        h -= 2;\n        for (let i = x; i <= x + w; i++) {\n            for (let j = y; j <= y + h; j++) {\n                map.setBaseElemXY(i, j, baseElem);\n            }\n        }\n    });\n};\n\nCityGenerator.prototype.populateCityLevel = function(level, conf) {\n    let houses = level.getExtras().houses;\n    const dungPopul = new DungeonPopulate(conf);\n    const shopHouses = dungPopul.createShops(level, conf);\n    houses = houses.filter(house => shopHouses.indexOf(house) < 0);\n    const trainerHouses = dungPopul.createTrainers(level, conf);\n    houses = houses.filter(house => trainerHouses.indexOf(house) < 0);\n    level.addExtras('houses', houses);\n    console.log('Creating townsfolk now');\n    this.createTownsfolk(level, conf);\n    console.log('shopHouses are', shopHouses);\n    console.log('trainerHouses are', trainerHouses);\n};\n\nCityGenerator.prototype.createTownsfolk = function(level, conf) {\n    const dungPopul = new DungeonPopulate(conf);\n    const houses = level.getExtras().houses;\n    houses.forEach(house => {\n        dungPopul.populateHouse(level, house, conf);\n    });\n};\n\nmodule.exports = CityGenerator;\n",
                "new_contents": "/* Contains code for better city level generation. */\n\nconst RG = require('./rg');\nconst LevelGenerator = require('./level-generator');\nconst MapGenerator = require('./map.generator');\nconst DungeonPopulate = require('./dungeon-populate');\n\nconst RNG = RG.Random.getRNG();\n\n/* Object for the city generator. */\nconst CityGenerator = function() {\n    LevelGenerator.call(this);\n    this.addDoors = true;\n    this.shouldRemoveMarkers = true;\n};\nRG.extend2(CityGenerator, LevelGenerator);\n\nCityGenerator.options = {\n    village: {\n        actorsPerLevel: 30,\n        maxDanger: 3,\n        itemsPerLevels: 6\n    },\n    capital: {\n\n    },\n    stronghold: {\n\n    },\n    fort: {\n\n    }\n};\n\nCityGenerator.prototype.create = function(cols, rows, conf) {\n    const level = this.createLevel(cols, rows, conf);\n\n    this.populateCityLevel(level, conf);\n    // TODO populate level with actors based on conf\n    return level;\n};\n\n/* Returns a castle level without populating it. */\nCityGenerator.prototype.createLevel = function(cols, rows, conf) {\n    const mapGen = new MapGenerator();\n    let mapObj = null;\n\n    if (conf.hasWall) {\n        mapObj = mapGen.createTownWithWall(cols, rows, conf);\n    }\n    else {\n        mapObj = mapGen.createTownBSP(cols, rows, conf);\n    }\n\n    const level = new RG.Map.Level();\n    level.setMap(mapObj.map);\n\n    level.addExtras('houses', mapObj.houses);\n    this.createHouseElements(level);\n    this.fillUnusedAreas(level, mapObj.unused);\n    return level;\n};\n\nCityGenerator.prototype.createHouseElements = function(level) {\n    const houses = level.getExtras().houses;\n    for (let i = 0; i < houses.length; i++) {\n        const doorXY = houses[i].door;\n        const door = new RG.Element.Door(true);\n        level.addElement(door, doorXY[0], doorXY[1]);\n    }\n};\n\nCityGenerator.prototype.fillUnusedAreas = function(level, areas) {\n    const map = level.getMap();\n    const elems = [RG.ELEM.GRASS, RG.ELEM.TREE, RG.ELEM.WATER];\n    areas.forEach(area => {\n        const baseElem = RNG.arrayGetRand(elems);\n        let {w, h} = area;\n        const {x, y} = area;\n        w -= 2; // Without this, areas overlap with houses\n        h -= 2;\n        for (let i = x; i <= x + w; i++) {\n            for (let j = y; j <= y + h; j++) {\n                map.setBaseElemXY(i, j, baseElem);\n            }\n        }\n    });\n};\n\nCityGenerator.prototype.populateCityLevel = function(level, conf) {\n    let houses = level.getExtras().houses;\n    const dungPopul = new DungeonPopulate(conf);\n\n    const shopHouses = dungPopul.createShops(level, conf);\n    houses = houses.filter(house => shopHouses.indexOf(house) < 0);\n\n    const trainerHouses = dungPopul.createTrainers(level, conf);\n    houses = houses.filter(house => trainerHouses.indexOf(house) < 0);\n\n    level.addExtras('houses', houses);\n    this.createTownsfolk(level, conf);\n};\n\nCityGenerator.prototype.createTownsfolk = function(level, conf) {\n    const dungPopul = new DungeonPopulate(conf);\n    const houses = level.getExtras().houses;\n    houses.forEach(house => {\n        dungPopul.populateHouse(level, house, conf);\n    });\n};\n\nmodule.exports = CityGenerator;\n",
                "subject": "Cleaned up.",
                "message": "Cleaned up.\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "tpoikela/battles,tpoikela/battles,tpoikela/battles,tpoikela/battles,tpoikela/battles"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10276,
            "row": {
                "commit": "bccb06c71171bfa7703dd4d88e2209c5ebbbe866",
                "old_file": "src/device-manager/lwm2m-device-management.js",
                "new_file": "src/device-manager/lwm2m-device-management.js",
                "old_contents": "/**\n * @license\n * Copyright (c) 2019 CANDY LINE INC.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport 'source-map-support/register';\n\nimport fs from 'fs';\nimport request from 'request';\nimport RED from 'node-red';\nimport si from 'systeminformation';\nimport consts from './consts';\nimport { LwM2MDeviceManagementBase } from './lwm2m-device-management-base';\n\nexport class LwM2MDeviceManagement extends LwM2MDeviceManagementBase {\n  static restart() {\n    // systemctl shuould restart the service\n    setTimeout(() => {\n      process.exit(219);\n    }, consts.REBOOT_DELAY_MS);\n  }\n\n  static stop() {\n    // systemctl shuould stop the service\n    setTimeout(() => {\n      process.exit(10);\n    }, consts.REBOOT_DELAY_MS);\n  }\n\n  constructor(deviceState) {\n    super();\n    this.deviceState = deviceState;\n    this.modemInfo = {};\n    this.candyPiBoardInfo = {};\n    this.tasks = {};\n    this.settings = {};\n  }\n\n  async init(settings) {\n    this.settings = Object.assign(this.settings, settings);\n    this.objectFilePath = `${settings.userDir}/${this.objectFile}`;\n    this.credentialFilePath = `${settings.userDir}/lwm2m_dm_cred.json`;\n    let enableDM = false;\n    if (\n      this.deviceState.candyBoardServiceSupported &&\n      process.env.DEVICE_MANAGEMENT_ENABLED === 'true'\n    ) {\n      enableDM = true;\n    }\n    if (\n      process.env.DEVEL !== 'true' &&\n      process.env.DEVICE_MANAGEMENT_BS_DTLS !== 'PSK'\n    ) {\n      enableDM = false;\n    }\n    if (enableDM) {\n      RED.log.info(`[CANDY RED] DM enabled. Setup started.`);\n      // setup DM flow\n      await this.setupDMFlow();\n\n      RED.log.info(`[CANDY RED] Collecting system info.`);\n      const { model, version } = await si.system();\n      this.candyPiBoardInfo.boardProductName = `${model} ${version}`;\n      const {\n        distro,\n        release,\n        codename,\n        logofile,\n        kernel,\n        arch\n      } = await si.osInfo();\n      this.candyPiBoardInfo.osName = distro;\n      this.candyPiBoardInfo.osVersion = `${release} ${codename}`;\n      this.candyPiBoardInfo.osId = logofile;\n      this.candyPiBoardInfo.kernel = kernel;\n      this.candyPiBoardInfo.arch = arch;\n\n      await new Promise(resolve => {\n        RED.log.info(`[CANDY RED] Collecting modem info.`);\n        fs.readFile(consts.MODEM_INFO_FILE_PATH, (err, data) => {\n          // Read a modem info file to retrieve IMEI when online\n          if (err) {\n            // Run candy modem show to retrieve IMEI when offline\n            let retry = 0;\n            const command = () => {\n              this.deviceState\n                ._candyRun('modem', 'show')\n                .then(result => {\n                  this.modemInfo = result.output;\n                  resolve();\n                })\n                .catch(err => {\n                  if (retry < 120 && err.code === 1) {\n                    setTimeout(command, 5000);\n                    retry++;\n                  } else {\n                    resolve();\n                    RED.log.error(\n                      `[CANDY RED] Failed to run candy modem show command => ${err.message ||\n                        JSON.stringify(err)}`\n                    );\n                  }\n                });\n            };\n            process.nextTick(command);\n          } else {\n            let dataString = data.toString().trim();\n            try {\n              this.modemInfo = JSON.parse(dataString).result;\n            } catch (_) {\n              RED.log.error(\n                `[CANDY RED] Unexpected modem info => [${dataString}]`\n              );\n            }\n            resolve();\n          }\n        });\n      });\n      this.internalEventBus.on('configure', context => {\n        RED.log.info(`[CANDY RED] Starting DM configuration.`);\n        this.decryptObjects();\n        const config = {};\n        // EPN\n        config.clientName = context.clientName;\n        if (this.modemInfo && this.modemInfo.imei) {\n          config.clientName = `urn:imei:${this.modemInfo.imei}`;\n        } else if (settings.deviceId) {\n          if (settings.deviceId.indexOf('urn:') !== 0) {\n            config.clientName = `urn:${settings.deviceId}`;\n          } else {\n            config.clientName = settings.deviceId;\n          }\n        }\n        config.serverId = 97;\n        config.clientPort = parseInt(\n          process.env.DEVICE_MANAGEMENT_CL_PORT || 57830\n        );\n        config.reconnectSec = parseInt(\n          process.env.DEVICE_MANAGEMENT_RECONNECT_SEC || 60\n        );\n        config.serverHost = process.env.DEVICE_MANAGEMENT_BS_HOST;\n        config.serverPort = process.env.DEVICE_MANAGEMENT_BS_PORT;\n        config.enableDTLS = process.env.DEVICE_MANAGEMENT_BS_DTLS === 'PSK';\n        if (config.enableDTLS) {\n          config.pskIdentity =\n            process.env.DEVICE_MANAGEMENT_BS_DTLS_PSK_ID || config.clientName;\n          config.presharedKey =\n            process.env.DEVICE_MANAGEMENT_BS_DTLS_PSK || config.clientName;\n        }\n        config.requestBootstrap = true;\n        config.saveProvisionedConfig = true;\n        config.useIPv4 = process.env.DEVICE_MANAGEMENT_BS_HOST_IPV6 !== 'true';\n        if (\n          this.settings.logging &&\n          this.settings.logging.console &&\n          this.settings.logging.console.level === 'debug'\n        ) {\n          config.redirectLwm2mClientLog = true;\n          config.dumpLwm2mMessages = true;\n        }\n        config.hideSensitiveInfo = false;\n        config.credentialFilePath = this.credentialFilePath;\n        // Wait until ppp0 goes online when DEVICE_MANAGEMENT_EXCLUSIVE_TO_MOBILE_NETWORK is true\n        let p;\n        if (\n          process.env.DEVICE_MANAGEMENT_EXCLUSIVE_TO_MOBILE_NETWORK === 'true'\n        ) {\n          p = new Promise(resolve => {\n            let retry = 0;\n            const command = () => {\n              this.deviceState\n                ._candyRun('connection', 'status', 0, true)\n                .then(result => {\n                  if (result === 'ONLINE') {\n                    resolve();\n                  } else {\n                    const err = {\n                      code: 1,\n                      message: 'Still OFFLINE'\n                    };\n                    throw err;\n                  }\n                })\n                .catch(err => {\n                  if (\n                    retry < consts.MAX_MOBILE_NETWORK_CONN_RETRY &&\n                    err.code === 1\n                  ) {\n                    setTimeout(command, 5000);\n                    retry++;\n                  } else {\n                    RED.log.error(\n                      `[CANDY RED] Connection Timeout => ${err.message ||\n                        JSON.stringify(err)}`\n                    );\n                    RED.log.error(`[CANDY RED] This service is terminated.`);\n                    return process.exit(10); // RestartPreventExitStatus=10\n                  }\n                });\n            };\n            process.nextTick(command);\n          });\n        } else {\n          p = Promise.resolve();\n        }\n        p.then(() => {\n          this.internalEventBus.emit('configurationDone', config);\n        });\n      });\n      this.internalEventBus.on('object-event', ev => {\n        RED.log.debug(`[CANDY RED] object-event => ${JSON.stringify(ev)}`);\n        switch (ev.eventType) {\n          case 'updated':\n          case 'deleted':\n          case 'created': {\n            this.triggerSaveObjectsTask();\n            break;\n          }\n          case 'executed': {\n            const uri = ev.uri.split('/');\n            const obj = this.objects[uri[1]];\n            if (obj) {\n              const ins = obj[uri[2]];\n              if (ins) {\n                const res = ins[uri[3]];\n                if (res.value && typeof res.value === 'function') {\n                  return res.value(ev.value);\n                }\n              }\n            }\n            RED.log.debug(\n              `[CANDY RED] Internal function associated with ${\n                ev.uri\n              } is missing.: ${JSON.stringify(ev)}`\n            );\n            break;\n          }\n          default:\n        }\n      });\n      await new Promise((resolve, reject) => {\n        // load MO files\n        fs.readdir(`${__dirname}/mo`, (err, dirs) => {\n          if (err) {\n            RED.log.error(`[CANDY RED] Failed to load MO files`);\n            return reject(err);\n          }\n          dirs\n            .filter(name => name.indexOf('.json') > 0)\n            .forEach(name => {\n              try {\n                const data = fs.readFileSync(`${__dirname}/mo/${name}`);\n                const mo = JSON.parse(data.toString(), this.functionResolver);\n                Object.keys(mo).forEach(objectId => {\n                  if (this.objects[objectId]) {\n                    RED.log.warn(\n                      `[CANDY RED] DUPLICATE ENTRY for the same ObjectID: ${objectId}. This will cause unexpected behaviors.`\n                    );\n                  }\n                });\n                Object.assign(this.objects, mo);\n                RED.log.info(\n                  `[CANDY RED] Loaded ObjectIDs => ${Object.keys(\n                    mo\n                  )} from [${name}]`\n                );\n              } catch (err) {\n                RED.log.error(\n                  `[CANDY RED] Failed to load a MO file: ${name} (${err.message ||\n                    err})`\n                );\n              }\n            });\n          return resolve();\n        });\n      });\n      await this.loadObjects();\n      return this.saveObjects();\n    } else {\n      // Reset DM flow if exists\n      return this.stripDMFlow();\n    }\n  }\n\n  async setupDMFlow() {\n    const installed = await this.installFlow('CANDY LINE DM', consts.DM_FLOW);\n    if (installed) {\n      LwM2MDeviceManagement.restart();\n    }\n  }\n\n  async stripDMFlow() {\n    const uninstalled = await this.uninstallFlow('CANDY LINE DM');\n    if (uninstalled) {\n      LwM2MDeviceManagement.restart();\n    }\n  }\n\n  _connectivityStatisticsStart() {\n    RED.log.info(`[CANDY RED] <connectivityStatisticsStart> Start`);\n    // TODO reset tx/rx counter\n    RED.log.info(`[CANDY RED] <connectivityStatisticsStart> End`);\n  }\n\n  _resolveCANDYLINEManufacturer() {\n    return process.env.DEVICE_MANAGEMENT_MANUFACTURER || 'CANDY LINE';\n  }\n\n  _resolveCANDYLINEModel() {\n    return (\n      process.env.DEVICE_MANAGEMENT_MODEL || this._resolveCANDYLINEProductName()\n    );\n  }\n\n  _resolveCANDYLINEProductName() {\n    let name = consts.MODULE_MODEL_MAPPINGS[this.modemInfo.model];\n    if (!name) {\n      name = `Unknown${this.modemInfo.model ? ` (${this.modemInfo.model})` : '' }`;\n    }\n    return name;\n  }\n\n  _resolveModuleName() {\n    return this.modemInfo.model;\n  }\n\n  _resolveModuleIdentifier() {\n    return this.modemInfo.imei;\n  }\n\n  _resolveModuleFirmwareVersion() {\n    return this.modemInfo.revision;\n  }\n\n  _resolveBoardProductName() {\n    return this.candyPiBoardInfo.boardProductName || 'N/A';\n  }\n\n  _resolveOSName() {\n    return this.candyPiBoardInfo.osName || 'N/A';\n  }\n\n  _resolveOSVersion() {\n    return this.candyPiBoardInfo.osVersion || 'N/A';\n  }\n\n  _resolveOSID() {\n    return this.candyPiBoardInfo.osId || 'N/A';\n  }\n\n  _resolveLinuxKernelRelease() {\n    return this.candyPiBoardInfo.kernel || 'N/A';\n  }\n\n  _resolveProcessorArchitecture() {\n    return this.candyPiBoardInfo.arch || 'N/A';\n  }\n\n  _applyConfigChanges() {\n    throw new Error('Unsupported Operation: applyConfigChanges()');\n  }\n\n  _resolveTotalBytesSent() {\n    // TODO\n    return -1;\n  }\n\n  _resolveTotalBytesReceived() {\n    // TODO\n    return -1;\n  }\n\n  _resolveCANDYREDVersion() {\n    return this.settings.version;\n  }\n\n  async _restartCANDYRED() {\n    RED.log.warn(`[CANDY RED] ** ** Process exits for restarting ** **`);\n    await this.syncObjects();\n    await this.saveObjects();\n    return LwM2MDeviceManagement.restart();\n  }\n\n  async _stopCANDYRED() {\n    RED.log.warn(`[CANDY RED] ** ** Process exits for stopping service ** **`);\n    await this.syncObjects();\n    await this.saveObjects();\n    return LwM2MDeviceManagement.stop();\n  }\n\n  _argsToString(src) {\n    switch (typeof src) {\n      case 'string': {\n        return src;\n      }\n      case 'object': {\n        if (src.type === 'Buffer') {\n          return Buffer.from(src.data).toString();\n        }\n        return src.toString();\n      }\n      default: {\n        return src.toString();\n      }\n    }\n  }\n\n  _argsToObject(src) {\n    try {\n      return JSON.parse(this._argsToString(src));\n    } catch (_) {\n      return null;\n    }\n  }\n\n  async _enableApplicationFlow(args) {\n    const pkg = this._argsToObject(args) || {};\n    RED.log.warn(\n      `[CANDY RED] TODO (_enableApplicationFlow) pkg => ${JSON.stringify(\n        pkg\n      )}, DO NOTHING!`\n    );\n  }\n\n  async _disableApplicationFlow(args) {\n    const pkg = this._argsToObject(args) || {};\n    RED.log.warn(\n      `[CANDY RED] TODO (_disableApplicationFlow) pkg => ${JSON.stringify(\n        pkg\n      )}, DO NOTHING!`\n    );\n  }\n\n  async _downloadFlowOrParse(args) {\n    const pkg = this._argsToObject(args) || {};\n    const resources = await this.readResources('^/42805/0/(2|3|4)$');\n    const downloadInfo = resources.reduce((accumulator, currentValue) => {\n      accumulator[currentValue.uri] = currentValue.value.value;\n      return accumulator;\n    }, {});\n    // eslint-disable-next-line require-atomic-updates\n    pkg.flowTabName = pkg.flowTabName || downloadInfo['/42805/0/2'];\n    if (!pkg.flowTabName) {\n      return Promise.reject({ message: `Flow tab name is missing` });\n    }\n    if (pkg.flow) {\n      if (typeof pkg.flow === 'string') {\n        try {\n          // eslint-disable-next-line require-atomic-updates\n          pkg.flow = JSON.parse(pkg.flow);\n          return Promise.resolve(pkg);\n        } catch (_) {\n          // Ignore parse error\n        }\n      }\n    }\n    if (!downloadInfo['/42805/0/3']) {\n      return Promise.reject({ message: `Cannot download flow` });\n    }\n    const headers = {};\n    if (downloadInfo['/42805/0/4']) {\n      Object.keys(downloadInfo['/42805/0/4']).forEach(id => {\n        const headerDef = downloadInfo['/42805/0/4'][id].value;\n        if (headerDef) {\n          const elements = headerDef.split(':');\n          headers[elements[0].trim()] = elements[1].trim();\n        }\n      });\n    }\n    return new Promise((resolve, reject) => {\n      const url = downloadInfo['/42805/0/3'];\n      if (\n        (process.env.DEVEL === 'true' && url.indexOf('http://') >= 0) ||\n        url.indexOf('https://') >= 0\n      ) {\n        request(\n          url,\n          {\n            headers: headers\n          },\n          (err, res, body) => {\n            if (err) {\n              return reject(err);\n            }\n            const { statusCode } = res;\n            if (statusCode !== 200) {\n              return reject(`Invalid Status Code: ${statusCode}`);\n            }\n            if (!body) {\n              return reject(`Empty body`);\n            }\n            try {\n              pkg.flow = JSON.parse(body);\n              return resolve(pkg);\n            } catch (_) {\n              return reject(`Invalid JSON: ${body}`);\n            }\n          }\n        );\n      } else if (url.indexOf('file://') >= 0) {\n        fs.readFile(url.substring(7), (err, data) => {\n          if (err) {\n            return reject(`Invalid Path: ${url}`);\n          }\n          try {\n            pkg.flow = JSON.parse(data);\n            return resolve(pkg);\n          } catch (_) {\n            return reject(`Invalid JSON: ${data.toString()}`);\n          }\n        });\n      } else {\n        return reject({ message: `Unsupported protocol scheme: ${url}` });\n      }\n    });\n  }\n\n  async _downloadAndInstallApplicationFlow(args) {\n    RED.log.info(\n      `[CANDY RED] <_downloadAndInstallApplicationFlow> Start; args => ${JSON.stringify(\n        args\n      )}`\n    );\n    try {\n      const result = await this._downloadFlowOrParse(args);\n      await this.installFlow(result.flowTabName, result.flow);\n      await this.writeResource('/42805/0/23', 1);\n    } catch (err) {\n      RED.log.error(\n        `[CANDY RED] <_downloadAndInstallApplicationFlow> err=>${\n          err ? (err.message ? err.message : err) : '(uknown)'\n        }`\n      );\n      await this.writeResource('/42805/0/23', 2);\n    }\n    RED.log.info(`[CANDY RED] <_downloadAndInstallApplicationFlow> End`);\n    return this.saveObjects();\n  }\n\n  async _uninstallApplicationFlow(args) {\n    RED.log.info(\n      `[CANDY RED] <_uninstallApplicationFlow> Start; args => ${JSON.stringify(\n        args\n      )}`\n    );\n    const flowTabName = this._argsToString(args);\n    let p;\n    if (flowTabName) {\n      p = this.uninstallFlow(flowTabName).then(() => {\n        return this.writeResource('/42805/0/25', 1);\n      });\n    } else {\n      p = this.writeResource('/42805/0/25', 2);\n    }\n    try {\n      await p;\n    } catch (err) {\n      RED.log.error(\n        `[CANDY RED] <_uninstallApplicationFlow> err=>${\n          err ? (err.message ? err.message : err) : '(uknown)'\n        }`\n      );\n      await this.writeResource('/42805/0/25', 3);\n    }\n    RED.log.info(`[CANDY RED] <_uninstallApplicationFlow> End`);\n    return this.saveObjects();\n  }\n\n  async _updateApplicationFlowList() {\n    try {\n      await new Promise((resolve, reject) => {\n        RED.log.info(`[CANDY RED] <_updateApplicationFlowList> Start`);\n        fs.readFile(this.deviceState.flowFilePath, (err, data) => {\n          if (err) {\n            return reject(err);\n          }\n          try {\n            const flows = JSON.parse(data.toString());\n            return this.writeResource(\n              '/42805/0/5',\n              flows\n                .filter(f => f.type === 'tab')\n                .map(f => {\n                  return f.label;\n                })\n            );\n          } catch (err) {\n            return reject(err);\n          }\n        });\n      });\n      await this.writeResource('/42805/0/27', 1);\n    } catch (err) {\n      RED.log.error(\n        `[CANDY RED] <_updateApplicationFlowList> err=>${\n          err ? (err.message ? err.message : err) : '(uknown)'\n        }`\n      );\n      await this.writeResource('/42805/0/27', 3);\n    }\n    RED.log.info(`[CANDY RED] <_updateApplicationFlowList> End`);\n    return this.saveObjects();\n  }\n\n  /*\n   * Replace ALL mindconnect agent configurations embedded in the flow file.\n   * CANRY RED process should exit after update (not restart in this function though)\n   */\n  async _updateMindConnectAgentConfiguration(flowFilePath) {\n    if (typeof flowFilePath !== 'string') {\n      // Ignore invalid values\n      flowFilePath = null;\n    }\n    try {\n      await this.writeResource('/43001/0/102', new Date().toISOString());\n      const flows = await new Promise((resolve, reject) => {\n        RED.log.info(`[CANDY RED] <updateMindConnectAgentConfiguration> Start`);\n        flowFilePath = flowFilePath || this.deviceState.flowFilePath;\n        if (Array.isArray(flowFilePath)) {\n          flowFilePath = flowFilePath[0];\n        }\n        fs.readFile(flowFilePath, (err, data) => {\n          if (err) {\n            return reject(err);\n          }\n          try {\n            const flows = JSON.parse(data.toString());\n            let agents = flows.filter(f => f.type === 'mindconnect');\n            if (agents.length === 0) {\n              return reject({ message: 'No mindconnect nodes to be modified' });\n            }\n            this.readResources(`/43001/.*`).then(result => {\n              const mindconnect = result.reduce((accumulator, currentValue) => {\n                accumulator[currentValue.uri] = currentValue.value.value;\n                return accumulator;\n              }, {});\n              agents.forEach(agent => {\n                const nodeName = mindconnect['/43001/0/10'];\n                agent.name = nodeName || '';\n                const clientCredentialProfile =\n                  consts.CLIENT_CREDENTIAL_PROFILE[mindconnect['/43001/0/2']];\n                agent.configtype = clientCredentialProfile || 'SHARED_SECRET';\n                const uploadFileChunks = mindconnect['/43001/0/8'];\n                agent.chunk = !!uploadFileChunks;\n                const retries = mindconnect['/43001/0/9'];\n                agent.retries = retries || 0;\n                const dataValidation = mindconnect['/43001/0/6'];\n                agent.validate = !!dataValidation;\n                const eventValidation = mindconnect['/43001/0/7'];\n                agent.validateevent = !!eventValidation;\n                const baseUrl = mindconnect['/43001/0/0'] || '';\n                const iat = mindconnect['/43001/0/1'] || '';\n                const clientId = mindconnect['/43001/0/3'] || '';\n                const tenant = mindconnect['/43001/0/4'] || '';\n                const expiration = mindconnect['/43001/0/5'] || '';\n                const agentconfig = {\n                  content: {\n                    baseUrl: baseUrl,\n                    iat: iat,\n                    clientCredentialProfile: [clientCredentialProfile],\n                    clientId: clientId,\n                    tenant: tenant\n                  },\n                  expiration: expiration\n                };\n                agent.agentconfig = JSON.stringify(agentconfig);\n              });\n              return resolve(flows);\n            });\n          } catch (err) {\n            return reject(err);\n          }\n        });\n      });\n      await this.deviceState.updateFlow(flows);\n      await this.writeResource('/43001/0/101', 0);\n      await this.writeResource('/43001/0/103', new Date().toISOString());\n      RED.log.warn(\n        '[CANDY RED] <updateMindConnectAgentConfiguration> FLOW IS UPDATED! RELOAD THE PAGE AFTER RECONNECTING SERVER!!'\n      );\n    } catch (err) {\n      RED.log.error(\n        `[CANDY RED] <updateMindConnectAgentConfiguration> err=>${\n          err ? err.message : '(uknown)'\n        }`\n      );\n      await this.writeResource('/43001/0/101', 1);\n    }\n    RED.log.info(`[CANDY RED] <updateMindConnectAgentConfiguration> End`);\n    await this.saveObjects();\n  }\n}\n",
                "new_contents": "/**\n * @license\n * Copyright (c) 2019 CANDY LINE INC.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport 'source-map-support/register';\n\nimport fs from 'fs';\nimport request from 'request';\nimport RED from 'node-red';\nimport si from 'systeminformation';\nimport consts from './consts';\nimport { LwM2MDeviceManagementBase } from './lwm2m-device-management-base';\n\nexport class LwM2MDeviceManagement extends LwM2MDeviceManagementBase {\n  static restart() {\n    // systemctl shuould restart the service\n    setTimeout(() => {\n      process.exit(219);\n    }, consts.REBOOT_DELAY_MS);\n  }\n\n  static stop() {\n    // systemctl shuould stop the service\n    setTimeout(() => {\n      process.exit(10);\n    }, consts.REBOOT_DELAY_MS);\n  }\n\n  constructor(deviceState) {\n    super();\n    this.deviceState = deviceState;\n    this.modemInfo = {};\n    this.candyPiBoardInfo = {};\n    this.tasks = {};\n    this.settings = {};\n  }\n\n  async init(settings) {\n    this.settings = Object.assign(this.settings, settings);\n    this.objectFilePath = `${settings.userDir}/${this.objectFile}`;\n    this.credentialFilePath = `${settings.userDir}/lwm2m_dm_cred.json`;\n    let enableDM = false;\n    if (\n      this.deviceState.candyBoardServiceSupported &&\n      process.env.DEVICE_MANAGEMENT_ENABLED === 'true'\n    ) {\n      enableDM = true;\n    }\n    if (\n      process.env.DEVEL !== 'true' &&\n      process.env.DEVICE_MANAGEMENT_BS_DTLS !== 'PSK'\n    ) {\n      enableDM = false;\n    }\n    if (enableDM) {\n      RED.log.info(`[CANDY RED] DM enabled. Setup started.`);\n      // setup DM flow\n      await this.setupDMFlow();\n\n      RED.log.info(`[CANDY RED] Collecting system info.`);\n      const { model, version } = await si.system();\n      this.candyPiBoardInfo.boardProductName = `${model} ${version}`;\n      const {\n        distro,\n        release,\n        codename,\n        logofile,\n        kernel,\n        arch\n      } = await si.osInfo();\n      this.candyPiBoardInfo.osName = distro;\n      this.candyPiBoardInfo.osVersion = `${release} ${codename}`;\n      this.candyPiBoardInfo.osId = logofile;\n      this.candyPiBoardInfo.kernel = kernel;\n      this.candyPiBoardInfo.arch = arch;\n\n      await new Promise(resolve => {\n        RED.log.info(`[CANDY RED] Collecting modem info.`);\n        fs.readFile(consts.MODEM_INFO_FILE_PATH, (err, data) => {\n          // Read a modem info file to retrieve IMEI when online\n          if (err) {\n            // Run candy modem show to retrieve IMEI when offline\n            let retry = 0;\n            const command = () => {\n              this.deviceState\n                ._candyRun('modem', 'show')\n                .then(result => {\n                  this.modemInfo = result.output;\n                  resolve();\n                })\n                .catch(err => {\n                  if (retry < 120 && err.code === 1) {\n                    setTimeout(command, 5000);\n                    retry++;\n                  } else {\n                    resolve();\n                    RED.log.error(\n                      `[CANDY RED] Failed to run candy modem show command => ${err.message ||\n                        JSON.stringify(err)}`\n                    );\n                  }\n                });\n            };\n            process.nextTick(command);\n          } else {\n            let dataString = data.toString().trim();\n            try {\n              this.modemInfo = JSON.parse(dataString).result;\n            } catch (_) {\n              RED.log.error(\n                `[CANDY RED] Unexpected modem info => [${dataString}]`\n              );\n            }\n            resolve();\n          }\n        });\n      });\n      this.internalEventBus.on('configure', context => {\n        RED.log.info(`[CANDY RED] Starting DM configuration.`);\n        this.decryptObjects();\n        const config = {};\n        // EPN\n        config.clientName = context.clientName;\n        if (this.modemInfo && this.modemInfo.imei) {\n          config.clientName = `urn:imei:${this.modemInfo.imei}`;\n        } else if (settings.deviceId) {\n          if (settings.deviceId.indexOf('urn:') !== 0) {\n            config.clientName = `urn:${settings.deviceId}`;\n          } else {\n            config.clientName = settings.deviceId;\n          }\n        }\n        config.serverId = 97;\n        config.clientPort = parseInt(\n          process.env.DEVICE_MANAGEMENT_CL_PORT || 57830\n        );\n        config.reconnectSec = parseInt(\n          process.env.DEVICE_MANAGEMENT_RECONNECT_SEC || 60\n        );\n        config.serverHost = process.env.DEVICE_MANAGEMENT_BS_HOST;\n        config.serverPort = process.env.DEVICE_MANAGEMENT_BS_PORT;\n        config.enableDTLS = process.env.DEVICE_MANAGEMENT_BS_DTLS === 'PSK';\n        if (config.enableDTLS) {\n          config.pskIdentity =\n            process.env.DEVICE_MANAGEMENT_BS_DTLS_PSK_ID || config.clientName;\n          config.presharedKey =\n            process.env.DEVICE_MANAGEMENT_BS_DTLS_PSK || config.clientName;\n        }\n        config.requestBootstrap = true;\n        config.saveProvisionedConfig = true;\n        config.useIPv4 = process.env.DEVICE_MANAGEMENT_BS_HOST_IPV6 !== 'true';\n        if (\n          this.settings.logging &&\n          this.settings.logging.console &&\n          this.settings.logging.console.level === 'debug'\n        ) {\n          config.redirectLwm2mClientLog = true;\n          config.dumpLwm2mMessages = true;\n        }\n        config.hideSensitiveInfo = false;\n        config.credentialFilePath = this.credentialFilePath;\n        // Wait until ppp0 goes online when DEVICE_MANAGEMENT_EXCLUSIVE_TO_MOBILE_NETWORK is true\n        let p;\n        if (\n          process.env.DEVICE_MANAGEMENT_EXCLUSIVE_TO_MOBILE_NETWORK === 'true'\n        ) {\n          p = new Promise(resolve => {\n            let retry = 0;\n            const command = () => {\n              this.deviceState\n                ._candyRun('connection', 'status', 0, true)\n                .then(result => {\n                  if (result === 'ONLINE') {\n                    resolve();\n                  } else {\n                    const err = {\n                      code: 1,\n                      message: 'Still OFFLINE'\n                    };\n                    throw err;\n                  }\n                })\n                .catch(err => {\n                  if (\n                    retry < consts.MAX_MOBILE_NETWORK_CONN_RETRY &&\n                    err.code === 1\n                  ) {\n                    setTimeout(command, 5000);\n                    retry++;\n                  } else {\n                    RED.log.error(\n                      `[CANDY RED] Connection Timeout => ${err.message ||\n                        JSON.stringify(err)}`\n                    );\n                    RED.log.error(`[CANDY RED] This service is terminated.`);\n                    return process.exit(10); // RestartPreventExitStatus=10\n                  }\n                });\n            };\n            process.nextTick(command);\n          });\n        } else {\n          p = Promise.resolve();\n        }\n        p.then(() => {\n          this.internalEventBus.emit('configurationDone', config);\n        });\n      });\n      this.internalEventBus.on('object-event', ev => {\n        RED.log.debug(`[CANDY RED] object-event => ${JSON.stringify(ev)}`);\n        switch (ev.eventType) {\n          case 'updated':\n          case 'deleted':\n          case 'created': {\n            this.triggerSaveObjectsTask();\n            break;\n          }\n          case 'executed': {\n            const uri = ev.uri.split('/');\n            const obj = this.objects[uri[1]];\n            if (obj) {\n              const ins = obj[uri[2]];\n              if (ins) {\n                const res = ins[uri[3]];\n                if (res.value && typeof res.value === 'function') {\n                  return res.value(ev.value);\n                }\n              }\n            }\n            RED.log.debug(\n              `[CANDY RED] Internal function associated with ${\n                ev.uri\n              } is missing.: ${JSON.stringify(ev)}`\n            );\n            break;\n          }\n          default:\n        }\n      });\n      await new Promise((resolve, reject) => {\n        // load MO files\n        fs.readdir(`${__dirname}/mo`, (err, dirs) => {\n          if (err) {\n            RED.log.error(`[CANDY RED] Failed to load MO files`);\n            return reject(err);\n          }\n          dirs\n            .filter(name => name.indexOf('.json') > 0)\n            .forEach(name => {\n              try {\n                const data = fs.readFileSync(`${__dirname}/mo/${name}`);\n                const mo = JSON.parse(data.toString(), this.functionResolver);\n                Object.keys(mo).forEach(objectId => {\n                  if (this.objects[objectId]) {\n                    RED.log.warn(\n                      `[CANDY RED] DUPLICATE ENTRY for the same ObjectID: ${objectId}. This will cause unexpected behaviors.`\n                    );\n                  }\n                });\n                Object.assign(this.objects, mo);\n                RED.log.info(\n                  `[CANDY RED] Loaded ObjectIDs => ${Object.keys(\n                    mo\n                  )} from [${name}]`\n                );\n              } catch (err) {\n                RED.log.error(\n                  `[CANDY RED] Failed to load a MO file: ${name} (${err.message ||\n                    err})`\n                );\n              }\n            });\n          return resolve();\n        });\n      });\n      await this.loadObjects();\n      return this.saveObjects();\n    } else {\n      // Reset DM flow if exists\n      return this.stripDMFlow();\n    }\n  }\n\n  async setupDMFlow() {\n    const installed = await this.installFlow('CANDY LINE DM', consts.DM_FLOW);\n    if (installed) {\n      LwM2MDeviceManagement.restart();\n    }\n  }\n\n  async stripDMFlow() {\n    const uninstalled = await this.uninstallFlow('CANDY LINE DM');\n    if (uninstalled) {\n      LwM2MDeviceManagement.restart();\n    }\n  }\n\n  _connectivityStatisticsStart() {\n    RED.log.info(`[CANDY RED] <connectivityStatisticsStart> Start`);\n    // TODO reset tx/rx counter\n    RED.log.info(`[CANDY RED] <connectivityStatisticsStart> End`);\n  }\n\n  _resolveCANDYLINEManufacturer() {\n    return process.env.DEVICE_MANAGEMENT_MANUFACTURER || 'CANDY LINE';\n  }\n\n  _resolveCANDYLINEModel() {\n    return (\n      process.env.DEVICE_MANAGEMENT_MODEL || this._resolveCANDYLINEProductName()\n    );\n  }\n\n  _resolveCANDYLINEProductName() {\n    let name = consts.MODULE_MODEL_MAPPINGS[this.modemInfo.model];\n    if (!name) {\n      name = `Unknown${\n        this.modemInfo.model ? ` (${this.modemInfo.model})` : ''\n      }`;\n    }\n    return name;\n  }\n\n  _resolveModuleName() {\n    return this.modemInfo.model;\n  }\n\n  _resolveModuleIdentifier() {\n    return this.modemInfo.imei;\n  }\n\n  _resolveModuleFirmwareVersion() {\n    return this.modemInfo.revision;\n  }\n\n  _resolveBoardProductName() {\n    return this.candyPiBoardInfo.boardProductName || 'N/A';\n  }\n\n  _resolveOSName() {\n    return this.candyPiBoardInfo.osName || 'N/A';\n  }\n\n  _resolveOSVersion() {\n    return this.candyPiBoardInfo.osVersion || 'N/A';\n  }\n\n  _resolveOSID() {\n    return this.candyPiBoardInfo.osId || 'N/A';\n  }\n\n  _resolveLinuxKernelRelease() {\n    return this.candyPiBoardInfo.kernel || 'N/A';\n  }\n\n  _resolveProcessorArchitecture() {\n    return this.candyPiBoardInfo.arch || 'N/A';\n  }\n\n  _applyConfigChanges() {\n    throw new Error('Unsupported Operation: applyConfigChanges()');\n  }\n\n  _resolveTotalBytesSent() {\n    // TODO\n    return -1;\n  }\n\n  _resolveTotalBytesReceived() {\n    // TODO\n    return -1;\n  }\n\n  _resolveCANDYREDVersion() {\n    return this.settings.version;\n  }\n\n  async _restartCANDYRED() {\n    RED.log.warn(`[CANDY RED] ** ** Process exits for restarting ** **`);\n    await this.syncObjects();\n    await this.saveObjects();\n    return LwM2MDeviceManagement.restart();\n  }\n\n  async _stopCANDYRED() {\n    RED.log.warn(`[CANDY RED] ** ** Process exits for stopping service ** **`);\n    await this.syncObjects();\n    await this.saveObjects();\n    return LwM2MDeviceManagement.stop();\n  }\n\n  _argsToString(src) {\n    switch (typeof src) {\n      case 'string': {\n        return src;\n      }\n      case 'object': {\n        if (src.type === 'Buffer') {\n          return Buffer.from(src.data).toString();\n        }\n        return src.toString();\n      }\n      default: {\n        return src.toString();\n      }\n    }\n  }\n\n  _argsToObject(src) {\n    try {\n      return JSON.parse(this._argsToString(src));\n    } catch (_) {\n      return null;\n    }\n  }\n\n  async _enableApplicationFlow(args) {\n    const pkg = this._argsToObject(args) || {};\n    RED.log.warn(\n      `[CANDY RED] TODO (_enableApplicationFlow) pkg => ${JSON.stringify(\n        pkg\n      )}, DO NOTHING!`\n    );\n  }\n\n  async _disableApplicationFlow(args) {\n    const pkg = this._argsToObject(args) || {};\n    RED.log.warn(\n      `[CANDY RED] TODO (_disableApplicationFlow) pkg => ${JSON.stringify(\n        pkg\n      )}, DO NOTHING!`\n    );\n  }\n\n  async _downloadFlowOrParse(args) {\n    const pkg = this._argsToObject(args) || {};\n    const resources = await this.readResources('^/42805/0/(2|3|4)$');\n    const downloadInfo = resources.reduce((accumulator, currentValue) => {\n      accumulator[currentValue.uri] = currentValue.value.value;\n      return accumulator;\n    }, {});\n    // eslint-disable-next-line require-atomic-updates\n    pkg.flowTabName = pkg.flowTabName || downloadInfo['/42805/0/2'];\n    if (!pkg.flowTabName) {\n      return Promise.reject({ message: `Flow tab name is missing` });\n    }\n    if (pkg.flow) {\n      if (typeof pkg.flow === 'string') {\n        try {\n          // eslint-disable-next-line require-atomic-updates\n          pkg.flow = JSON.parse(pkg.flow);\n          return Promise.resolve(pkg);\n        } catch (_) {\n          // Ignore parse error\n        }\n      }\n    }\n    if (!downloadInfo['/42805/0/3']) {\n      return Promise.reject({ message: `Cannot download flow` });\n    }\n    const headers = {};\n    if (downloadInfo['/42805/0/4']) {\n      Object.keys(downloadInfo['/42805/0/4']).forEach(id => {\n        const headerDef = downloadInfo['/42805/0/4'][id].value;\n        if (headerDef) {\n          const elements = headerDef.split(':');\n          headers[elements[0].trim()] = elements[1].trim();\n        }\n      });\n    }\n    return new Promise((resolve, reject) => {\n      const url = downloadInfo['/42805/0/3'];\n      if (\n        (process.env.DEVEL === 'true' && url.indexOf('http://') >= 0) ||\n        url.indexOf('https://') >= 0\n      ) {\n        request(\n          url,\n          {\n            headers: headers\n          },\n          (err, res, body) => {\n            if (err) {\n              return reject(err);\n            }\n            const { statusCode } = res;\n            if (statusCode !== 200) {\n              return reject(`Invalid Status Code: ${statusCode}`);\n            }\n            if (!body) {\n              return reject(`Empty body`);\n            }\n            try {\n              pkg.flow = JSON.parse(body);\n              return resolve(pkg);\n            } catch (_) {\n              return reject(`Invalid JSON: ${body}`);\n            }\n          }\n        );\n      } else if (url.indexOf('file://') >= 0) {\n        fs.readFile(url.substring(7), (err, data) => {\n          if (err) {\n            return reject(`Invalid Path: ${url}`);\n          }\n          try {\n            pkg.flow = JSON.parse(data);\n            return resolve(pkg);\n          } catch (_) {\n            return reject(`Invalid JSON: ${data.toString()}`);\n          }\n        });\n      } else {\n        return reject({ message: `Unsupported protocol scheme: ${url}` });\n      }\n    });\n  }\n\n  async _downloadAndInstallApplicationFlow(args) {\n    RED.log.info(\n      `[CANDY RED] <_downloadAndInstallApplicationFlow> Start; args => ${JSON.stringify(\n        args\n      )}`\n    );\n    try {\n      const result = await this._downloadFlowOrParse(args);\n      await this.installFlow(result.flowTabName, result.flow);\n      await this.writeResource('/42805/0/23', 1);\n    } catch (err) {\n      RED.log.error(\n        `[CANDY RED] <_downloadAndInstallApplicationFlow> err=>${\n          err ? (err.message ? err.message : err) : '(uknown)'\n        }`\n      );\n      await this.writeResource('/42805/0/23', 2);\n    }\n    RED.log.info(`[CANDY RED] <_downloadAndInstallApplicationFlow> End`);\n    return this.saveObjects();\n  }\n\n  async _uninstallApplicationFlow(args) {\n    RED.log.info(\n      `[CANDY RED] <_uninstallApplicationFlow> Start; args => ${JSON.stringify(\n        args\n      )}`\n    );\n    const flowTabName = this._argsToString(args);\n    let p;\n    if (flowTabName) {\n      p = this.uninstallFlow(flowTabName).then(() => {\n        return this.writeResource('/42805/0/25', 1);\n      });\n    } else {\n      p = this.writeResource('/42805/0/25', 2);\n    }\n    try {\n      await p;\n    } catch (err) {\n      RED.log.error(\n        `[CANDY RED] <_uninstallApplicationFlow> err=>${\n          err ? (err.message ? err.message : err) : '(uknown)'\n        }`\n      );\n      await this.writeResource('/42805/0/25', 3);\n    }\n    RED.log.info(`[CANDY RED] <_uninstallApplicationFlow> End`);\n    return this.saveObjects();\n  }\n\n  async _updateApplicationFlowList() {\n    try {\n      await new Promise((resolve, reject) => {\n        RED.log.info(`[CANDY RED] <_updateApplicationFlowList> Start`);\n        fs.readFile(this.deviceState.flowFilePath, (err, data) => {\n          if (err) {\n            return reject(err);\n          }\n          try {\n            const flows = JSON.parse(data.toString());\n            return this.writeResource(\n              '/42805/0/5',\n              flows\n                .filter(f => f.type === 'tab')\n                .map(f => {\n                  return f.label;\n                })\n            );\n          } catch (err) {\n            return reject(err);\n          }\n        });\n      });\n      await this.writeResource('/42805/0/27', 1);\n    } catch (err) {\n      RED.log.error(\n        `[CANDY RED] <_updateApplicationFlowList> err=>${\n          err ? (err.message ? err.message : err) : '(uknown)'\n        }`\n      );\n      await this.writeResource('/42805/0/27', 3);\n    }\n    RED.log.info(`[CANDY RED] <_updateApplicationFlowList> End`);\n    return this.saveObjects();\n  }\n\n  /*\n   * Replace ALL mindconnect agent configurations embedded in the flow file.\n   * CANRY RED process should exit after update (not restart in this function though)\n   */\n  async _updateMindConnectAgentConfiguration(flowFilePath) {\n    if (typeof flowFilePath !== 'string') {\n      // Ignore invalid values\n      flowFilePath = null;\n    }\n    try {\n      await this.writeResource('/43001/0/102', new Date().toISOString());\n      const flows = await new Promise((resolve, reject) => {\n        RED.log.info(`[CANDY RED] <updateMindConnectAgentConfiguration> Start`);\n        flowFilePath = flowFilePath || this.deviceState.flowFilePath;\n        if (Array.isArray(flowFilePath)) {\n          flowFilePath = flowFilePath[0];\n        }\n        fs.readFile(flowFilePath, (err, data) => {\n          if (err) {\n            return reject(err);\n          }\n          try {\n            const flows = JSON.parse(data.toString());\n            let agents = flows.filter(f => f.type === 'mindconnect');\n            if (agents.length === 0) {\n              return reject({ message: 'No mindconnect nodes to be modified' });\n            }\n            this.readResources(`/43001/.*`).then(result => {\n              const mindconnect = result.reduce((accumulator, currentValue) => {\n                accumulator[currentValue.uri] = currentValue.value.value;\n                return accumulator;\n              }, {});\n              agents.forEach(agent => {\n                const nodeName = mindconnect['/43001/0/10'];\n                agent.name = nodeName || '';\n                const clientCredentialProfile =\n                  consts.CLIENT_CREDENTIAL_PROFILE[mindconnect['/43001/0/2']];\n                agent.configtype = clientCredentialProfile || 'SHARED_SECRET';\n                const uploadFileChunks = mindconnect['/43001/0/8'];\n                agent.chunk = !!uploadFileChunks;\n                const retries = mindconnect['/43001/0/9'];\n                agent.retries = retries || 0;\n                const dataValidation = mindconnect['/43001/0/6'];\n                agent.validate = !!dataValidation;\n                const eventValidation = mindconnect['/43001/0/7'];\n                agent.validateevent = !!eventValidation;\n                const baseUrl = mindconnect['/43001/0/0'] || '';\n                const iat = mindconnect['/43001/0/1'] || '';\n                const clientId = mindconnect['/43001/0/3'] || '';\n                const tenant = mindconnect['/43001/0/4'] || '';\n                const expiration = mindconnect['/43001/0/5'] || '';\n                const agentconfig = {\n                  content: {\n                    baseUrl: baseUrl,\n                    iat: iat,\n                    clientCredentialProfile: [clientCredentialProfile],\n                    clientId: clientId,\n                    tenant: tenant\n                  },\n                  expiration: expiration\n                };\n                agent.agentconfig = JSON.stringify(agentconfig);\n              });\n              return resolve(flows);\n            });\n          } catch (err) {\n            return reject(err);\n          }\n        });\n      });\n      await this.deviceState.updateFlow(flows);\n      await this.writeResource('/43001/0/101', 0);\n      await this.writeResource('/43001/0/103', new Date().toISOString());\n      RED.log.warn(\n        '[CANDY RED] <updateMindConnectAgentConfiguration> FLOW IS UPDATED! RELOAD THE PAGE AFTER RECONNECTING SERVER!!'\n      );\n    } catch (err) {\n      RED.log.error(\n        `[CANDY RED] <updateMindConnectAgentConfiguration> err=>${\n          err ? err.message : '(uknown)'\n        }`\n      );\n      await this.writeResource('/43001/0/101', 1);\n    }\n    RED.log.info(`[CANDY RED] <updateMindConnectAgentConfiguration> End`);\n    await this.saveObjects();\n  }\n}\n",
                "subject": "Improve product name text",
                "message": "Improve product name text\n",
                "lang": "JavaScript",
                "license": "unknown",
                "repos": "CANDY-LINE/candy-red,CANDY-LINE/candy-red,dbaba/candy-red,dbaba/candy-red,CANDY-LINE/candy-red,dbaba/candy-red"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10277,
            "row": {
                "commit": "f42d8d5288e4d442e50770bb062ee29598278daf",
                "old_file": "js/kinome-overlay.js",
                "new_file": "js/kinome-overlay.js",
                "old_contents": "/* KinomeOverlay.js\n * Copyright 2012 (c) Joseph Lee & Nick Robin\n * This software may be distributed under the MIT License\n * See file LICENSE for details\n *\n * http://code.google.com/p/kinome-overlay\n */\n\n// Heavily used shortcut\npF = parseFloat;\n\n$(document).ready(function() {\n    $(\"#slope\").slider({ min: 0, max: 10, step: 1, value: 5,\n        slide: function(event, ui) {\n            KVM.slope(ui.value);\n        }\n    });\n    $(\"#yint\").slider({ min: -100, max: 100, step: 1, value: 1,\n        slide: function(event, ui) {\n            KVM.yint(ui.value);\n        }\n    });\n    $(\"#opac\").slider({ min: 0.1, max: 1, step: .1, value: .7,\n        slide: function(event, ui) {\n            KVM.opac(ui.value);\n        }\n    });\n\n    $(\"#tabs\").tabs();\n\n    // Color picker\n    function hexFromRGB(r, g, b) {\n        var hex = [\n            r.toString( 16 ),\n            g.toString( 16 ),\n            b.toString( 16 )\n        ];\n        $.each( hex, function( nr, val ) {\n            if ( val.length === 1 ) {\n                hex[ nr ] = \"0\" + val;\n            }\n        });\n        return hex.join( \"\" ).toUpperCase();\n    }\n    $(\".inh#red\").slider({\n        orientation: \"horizontal\",\n        range: \"min\",\n        max: 255,\n        value: 255,\n        slide: function(event, ui) {\n            KVM.inhR(ui.value);\n        },\n        change: function(event, ui) {\n            KVM.inhR(ui.value);\n        }\n    });\n    $(\".inh#green\").slider({\n        orientation: \"horizontal\",\n        range: \"min\",\n        max: 255,\n        value: 0,\n        slide: function(event, ui) {\n            KVM.inhG(ui.value);\n        },\n        change: function(event, ui) {\n            KVM.inhG(ui.value);\n        }\n    });\n    $(\".inh#blue\").slider({\n        orientation: \"horizontal\",\n        range: \"min\",\n        max: 255,\n        value: 0,\n        slide: function(event, ui) {\n            KVM.inhB(ui.value);\n        },\n        change: function(event, ui) {\n            KVM.inhB(ui.value);\n        }\n    });\n    $(\".act#red\").slider({\n        orientation: \"horizontal\",\n        range: \"min\",\n        max: 255,\n        value: 0,\n        slide: function(event, ui) {\n            KVM.actR(ui.value);\n        },\n        change: function(event, ui) {\n            KVM.actR(ui.value);\n        }\n    });\n    $(\".act#green\").slider({\n        orientation: \"horizontal\",\n        range: \"min\",\n        max: 255,\n        value: 255,\n        slide: function(event, ui) {\n            KVM.actG(ui.value);\n        },\n        change: function(event, ui) {\n            KVM.actG(ui.value);\n        }\n    });\n    $(\".act#blue\").slider({\n        orientation: \"horizontal\",\n        range: \"min\",\n        max: 255,\n        value: 0,\n        slide: function(event, ui) {\n            KVM.actB(ui.value);\n        },\n        change: function(event, ui) {\n            KVM.actB(ui.value);\n        }\n    });\n\n    // Demo button\n    $(\"#demo\").button();\n    $(\"#demo\").click(function() {\n        KVM.userData.destroyAll();\n        $.getJSON(\"demo.json\", function(demoData) {\n            KVM.applyData(demoData);\n        });\n    });\n\n\n    /**\n     * Kinome\n     * ViewModel\n     */\n    var KinomeViewModel = function() {\n        var self = this;\n\n        // radius scaling values\n        self.slope = ko.observable(5);\n        self.yint = ko.observable(0);\n\n        // opacity\n        self.opac = ko.observable(.70);\n\n        // Observable color values\n        self.inhR = ko.observable(255);\n        self.inhG = ko.observable(0);\n        self.inhB = ko.observable(0);\n\n        self.actR = ko.observable(0);\n        self.actG = ko.observable(255);\n        self.actB = ko.observable(0);\n\n\n        // Color picker\n        self.hexFromRGB = function (r, g, b) {\n            var hex = [\n                r.toString( 16 ),\n                g.toString( 16 ),\n                b.toString( 16 )\n            ];\n            $.each( hex, function( nr, val ) {\n                if ( val.length === 1 ) {\n                    hex[ nr ] = \"0\" + val;\n                }\n            });\n            return hex.join( \"\" ).toUpperCase();\n        };\n        self.inhColor = ko.computed(function() {\n            return \"#\" + self.hexFromRGB(self.inhR(),\n                self.inhG(),\n                self.inhB());\n        });\n        self.actColor = ko.computed(function() {\n            return \"#\" + self.hexFromRGB(self.actR(),\n                self.actG(),\n                self.actB());\n        });\n\n        // Synchronously get kinase coordinates\n        self.kinases = ko.observableArray([]);\n        $.ajax({\n            async: false,\n            dataType: \"json\",\n            url: \"kotable.json\",\n            success: function(data) {\n                while(data.length > 0) {\n                    var temp = data.pop();\n                    temp.x /= 4;\n                    temp.y /= 4;\n                    temp.Intensity = 0;\n                    self.kinases.push(temp);\n                }\n            }\n        });\n\n        /* Upload file handle */\n        self.userData = ko.observableArray();\n        self.reader = new FileReader();\n\n        // Event binding on View: input file-upload\n        self.onFileUpload = function() {\n            var upload_file = document.getElementById(\"csv_file\").files;\n            for (i = 0; i < upload_file.length; i++) {\n                self.reader.readAsText(upload_file[i]);\n            }\n        };\n\n        // Event triggered by finished file upload\n        // called upon completion of reader.readAsText\n        self.reader.onloadend = function(e) {\n\n            // parse input data\n            var data = self.reader.result.split(\"\\n\");\n            for (i = 0; i < data.length; i++) {\n                data[i] = data[i].split(\",\");\n            }\n            self.applyData(data);\n        };\n\n        // Return Kinase object by GeneID\n        self.getKinaseById = function (geneid) {\n            for (i = 0; i < self.kinases().length; i++) {\n                if (self.kinases()[i].GeneID = geneid) {\n                    return self.kinase()[i];\n                }\n            }\n            return undefined;\n        };\n\n        // Return radius based on intensity\n        self.getRadius = function (intensity) {\n            var radius = self.slope() * intensity * (Math.pow(-1, (intensity < 0))) + self.yint();\n            return radius >= 0 ? radius : 0;\n        };\n\n        // obtain approriate color for intensity\n        self.getColor = function (intensity) {\n            if (intensity >= 0) {\n                return self.actColor();\n            }\n            return self.inhColor();\n        };\n\n        // parse data\n        self.parseData = function (inputData) {\n\n        };\n\n        // purge all intensity data from kinases\n        self.clearData = function () {\n            for (i = 0; i < self.kinases().length; i++) {\n                self.kinases()[i].Intensity = 0;\n            }\n            self.userData.destroyAll();\n        };\n\n\n        // parse, plot user uploaded data\n        // uses closure of self.userData\n        // self.userData should be sufficiently parsed\n        // to an array of 2-element arrays:\n        // [ [ GeneID, intensity-value ], ... ]\n        self.applyData = function (inputData) {\n            while (inputData.length > 0) {\n                var temp = inputData.pop();\n                for (i = 0; i < self.kinases().length; i++) {\n                    if (self.kinases()[i].GeneID == temp[0]) {\n                        self.kinases()[i].Intensity = temp[1];\n                        self.userData.push(self.kinases()[i]);\n                    }\n                }\n            }\n        };\n\n    };\n\n    KVM = new KinomeViewModel();\n\n    ko.applyBindings(KVM);\n\n});\n",
                "new_contents": "/* KinomeOverlay.js\n * Copyright 2012 (c) Joseph Lee & Nick Robin\n * This software may be distributed under the MIT License\n * See file LICENSE for details\n *\n * http://code.google.com/p/kinome-overlay\n */\n\n// Heavily used shortcut\npF = parseFloat;\nabs = Math.abs;\npow = Math.pow;\n\n$(document).ready(function() {\n    $(\"#slope\").slider({ min: 0, max: 10, step: 1, value: 5,\n        slide: function(event, ui) {\n            KVM.slope(ui.value);\n        }\n    });\n    $(\"#yint\").slider({ min: -100, max: 100, step: 1, value: 1,\n        slide: function(event, ui) {\n            KVM.yint(ui.value);\n        }\n    });\n    $(\"#opac\").slider({ min: 0.1, max: 1, step: .1, value: .7,\n        slide: function(event, ui) {\n            KVM.opac(ui.value);\n        }\n    });\n\n    $(\"#tabs\").tabs();\n\n    // Color picker\n    function hexFromRGB(r, g, b) {\n        var hex = [\n            r.toString( 16 ),\n            g.toString( 16 ),\n            b.toString( 16 )\n        ];\n        $.each( hex, function( nr, val ) {\n            if ( val.length === 1 ) {\n                hex[ nr ] = \"0\" + val;\n            }\n        });\n        return hex.join( \"\" ).toUpperCase();\n    }\n    $(\".inh#red\").slider({\n        orientation: \"horizontal\",\n        range: \"min\",\n        max: 255,\n        value: 255,\n        slide: function(event, ui) {\n            KVM.inhR(ui.value);\n        },\n        change: function(event, ui) {\n            KVM.inhR(ui.value);\n        }\n    });\n    $(\".inh#green\").slider({\n        orientation: \"horizontal\",\n        range: \"min\",\n        max: 255,\n        value: 0,\n        slide: function(event, ui) {\n            KVM.inhG(ui.value);\n        },\n        change: function(event, ui) {\n            KVM.inhG(ui.value);\n        }\n    });\n    $(\".inh#blue\").slider({\n        orientation: \"horizontal\",\n        range: \"min\",\n        max: 255,\n        value: 0,\n        slide: function(event, ui) {\n            KVM.inhB(ui.value);\n        },\n        change: function(event, ui) {\n            KVM.inhB(ui.value);\n        }\n    });\n    $(\".act#red\").slider({\n        orientation: \"horizontal\",\n        range: \"min\",\n        max: 255,\n        value: 0,\n        slide: function(event, ui) {\n            KVM.actR(ui.value);\n        },\n        change: function(event, ui) {\n            KVM.actR(ui.value);\n        }\n    });\n    $(\".act#green\").slider({\n        orientation: \"horizontal\",\n        range: \"min\",\n        max: 255,\n        value: 255,\n        slide: function(event, ui) {\n            KVM.actG(ui.value);\n        },\n        change: function(event, ui) {\n            KVM.actG(ui.value);\n        }\n    });\n    $(\".act#blue\").slider({\n        orientation: \"horizontal\",\n        range: \"min\",\n        max: 255,\n        value: 0,\n        slide: function(event, ui) {\n            KVM.actB(ui.value);\n        },\n        change: function(event, ui) {\n            KVM.actB(ui.value);\n        }\n    });\n\n    // Demo button\n    $(\"#demo\").button();\n    $(\"#demo\").click(function() {\n        KVM.userData.destroyAll();\n        $.getJSON(\"demo.json\", function(demoData) {\n            KVM.applyData(demoData);\n        });\n    });\n\n\n    /**\n     * Kinome\n     * ViewModel\n     */\n    var KinomeViewModel = function() {\n        var self = this;\n\n        // radius scaling values\n        self.slope = ko.observable(5);\n        self.yint = ko.observable(0);\n\n        // opacity\n        self.opac = ko.observable(.70);\n\n        // Observable color values\n        self.inhR = ko.observable(255);\n        self.inhG = ko.observable(0);\n        self.inhB = ko.observable(0);\n\n        self.actR = ko.observable(0);\n        self.actG = ko.observable(255);\n        self.actB = ko.observable(0);\n\n\n        // Color picker\n        self.hexFromRGB = function (r, g, b) {\n            var hex = [\n                r.toString( 16 ),\n                g.toString( 16 ),\n                b.toString( 16 )\n            ];\n            $.each( hex, function( nr, val ) {\n                if ( val.length === 1 ) {\n                    hex[ nr ] = \"0\" + val;\n                }\n            });\n            return hex.join( \"\" ).toUpperCase();\n        };\n        self.inhColor = ko.computed(function() {\n            return \"#\" + self.hexFromRGB(self.inhR(),\n                self.inhG(),\n                self.inhB());\n        });\n        self.actColor = ko.computed(function() {\n            return \"#\" + self.hexFromRGB(self.actR(),\n                self.actG(),\n                self.actB());\n        });\n\n        // Synchronously get kinase coordinates\n        self.kinases = ko.observableArray([]);\n        $.ajax({\n            async: false,\n            dataType: \"json\",\n            url: \"kotable.json\",\n            success: function(data) {\n                while(data.length > 0) {\n                    var temp = data.pop();\n                    temp.x /= 4;\n                    temp.y /= 4;\n                    temp.Intensity = 0;\n                    self.kinases.push(temp);\n                }\n            }\n        });\n\n        /* Upload file handle */\n        self.userData = ko.observableArray();\n        self.reader = new FileReader();\n\n        // Event binding on View: input file-upload\n        self.onFileUpload = function() {\n            var upload_file = document.getElementById(\"csv_file\").files;\n            for (i = 0; i < upload_file.length; i++) {\n                self.reader.readAsText(upload_file[i]);\n            }\n        };\n\n        // Event triggered by finished file upload\n        // called upon completion of reader.readAsText\n        self.reader.onloadend = function(e) {\n\n            // parse input data\n            var data = self.reader.result.split(\"\\n\");\n            for (i = 0; i < data.length; i++) {\n                data[i] = data[i].split(\",\");\n            }\n            self.applyData(data);\n        };\n\n        // Return Kinase object by GeneID\n        self.getKinaseById = function (geneid) {\n            for (i = 0; i < self.kinases().length; i++) {\n                if (self.kinases()[i].GeneID = geneid) {\n                    return self.kinase()[i];\n                }\n            }\n            return undefined;\n        };\n\n        // Return radius based on intensity\n        self.getRadius = function (intensity) {\n            var radius = self.slope() * intensity * (pow(-1, (intensity < 0))) + self.yint();\n            return radius >= 0 ? radius : 0;\n        };\n\n        // obtain approriate color for intensity\n        self.getColor = function (intensity) {\n            if (intensity >= 0) {\n                return self.actColor();\n            }\n            return self.inhColor();\n        };\n\n        // parse data\n        self.parseData = function (inputData) {\n\n        };\n\n        // purge all intensity data from kinases\n        self.clearData = function () {\n            for (i = 0; i < self.kinases().length; i++) {\n                self.kinases()[i].Intensity = 0;\n            }\n            self.userData.destroyAll();\n        };\n\n\n        // parse, plot user uploaded data\n        // uses closure of self.userData\n        // self.userData should be sufficiently parsed\n        // to an array of 2-element arrays:\n        // [ [ GeneID, intensity-value ], ... ]\n        self.applyData = function (inputData) {\n            // sort inputData so smaller radii are visible\n            inputData.sort(function(left, right) {\n                var l = abs(left[1]);\n                var r = abs(right[1]);\n                return l == r ? 0 : (l < r ? -1 : 1);\n            });\n            console.log(inputData);\n            while (inputData.length > 0) {\n                var temp = inputData.pop();\n                for (i = 0; i < self.kinases().length; i++) {\n                    if (self.kinases()[i].GeneID == temp[0]) {\n                        self.kinases()[i].Intensity = temp[1];\n                        self.userData.push(self.kinases()[i]);\n                    }\n                }\n            }\n        };\n\n    };\n\n    KVM = new KinomeViewModel();\n\n    ko.applyBindings(KVM);\n\n});\n",
                "subject": "Sort userData by abs val of Intensity",
                "message": "Sort userData by abs val of Intensity\n\nThat way, smallest circles rendered last.\nOn top to avoid obscuring.\n\nSigned-off-by: Joseph Lee <e4d1decaf0dee5323423dceff9f3b0df1ff6c965@pdx.edu>\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "kinobus/kinome-overlay,kinobus/kinome-overlay,kinobus/kinome-cluster,kinobus/kinome-overlay"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10278,
            "row": {
                "commit": "2df8f71f89e4a9c896e7b7bfd05eea22a8f47285",
                "old_file": "client/src/factory.battle.js",
                "new_file": "client/src/factory.battle.js",
                "old_contents": "\nimport Constraints from './constraints';\n\nconst RG = require('./rg');\nRG.Factory = require('./factory');\nRG.Game = require('./game');\nRG.Game.Battle = require('./game.battle').Battle;\nRG.Game.Army = require('./game.battle').Army;\n\n/* Factory used for creating battles. */\nRG.Factory.Battle = function() {\n\n    /* Creates one battle into the level. TODO: Decide how to modify difficulty\n     * etc. TODO: Refactor into Factory.Battle. */\n    this.createBattle = function(level, conf = {}) {\n        const cols = conf.cols || 80;\n        const rows = conf.cols || 40;\n        const levelType = conf.levelType || 'forest';\n\n        const id = level ? level.getID() : 0;\n        const name = conf.name || 'Battle of level ' + id;\n\n        const battle = new RG.Game.Battle(name);\n        const forestConf = RG.getForestConf(cols, rows);\n        const battleLevel = RG.FACT.createLevel(levelType, cols, rows,\n            forestConf);\n        battle.setLevel(battleLevel);\n        const parser = RG.ObjectShell.getParser();\n\n        const factions = ['human', 'dwarf', 'dogfolk', 'wolfclan', 'goblin',\n            'catfolk', 'bearfolk', 'wildling', 'undead'];\n        const fact1 = RG.RAND.arrayGetRand(factions);\n        let fact2 = RG.RAND.arrayGetRand(factions);\n        while (fact1 === fact2) {\n            fact2 = RG.RAND.arrayGetRand(factions);\n        }\n\n        const armySize = conf.armySize || 20;\n        const numArmies = conf.numArmies || 2;\n        const facts = conf.armies || [fact1, fact2];\n        const maxDanger = conf.danger || 5;\n\n        // Generate all armies based on constraints\n        const armies = [];\n        for (let i = 0; i < numArmies; i++) {\n            const army = new RG.Game.Army(facts[i]);\n            const constr = [\n                {op: 'eq', prop: 'type', value: facts[i]},\n                {op: 'lte', prop: 'danger', value: maxDanger}\n            ];\n            const actorFunc = new Constraints().getConstraints(constr);\n            for (let i = 0; i < armySize; i++) {\n                const actor = parser.createRandomActor({func: actorFunc});\n                if (actor) {\n                    const comp = new RG.Component.InBattle();\n                    comp.setData({name: battle.getName(),\n                        army: army.getName()});\n                    actor.add(comp);\n                    army.addActor(actor);\n                }\n            }\n\n            // Army loses if 10% of actors remain, this gives some losing\n            // survivors, makes things more interesting\n            army.setDefeatThreshold(Math.round(0.1 * armySize));\n\n            // Assign random but legal coords to the army\n            let armyX = RG.RAND.getUniformInt(0, cols - 1);\n            const armyY = RG.RAND.getUniformInt(0, rows - 1);\n            if ((armyX + armySize) > (cols - 1)) {\n                armyX = cols - armySize;\n            }\n\n            battle.addArmy(army, armyX, armyY);\n            armies.push(army);\n        }\n\n        // Make army actors into each others enemies\n        armies.forEach(army1 => {\n            armies.forEach(army2 => {\n                if (army1.getName() !== army2.getName()) {\n                    army1.getActors().forEach(a1 => {\n                        army2.getActors().forEach(a2 => {\n                            a1.addEnemy(a2);\n                            a2.addEnemy(a1);\n                        });\n                    });\n                }\n            });\n\n            // Make the actors in army friends\n            army1.getActors().forEach(actor1 => {\n                army1.getActors().forEach(actor2 => {\n                    if (actor1.getID() !== actor2.getID()) {\n                        actor1.addFriend(actor2);\n                        actor2.addFriend(actor1);\n                    }\n                });\n            });\n        });\n\n        if (level) {\n            // Add connecting stairs between battle and area\n            const stairsBattle = new RG.Element.Stairs(false);\n            battleLevel.addElement(stairsBattle, 1, 1);\n            const stairsArea = new RG.Element.Stairs(true);\n\n            // const randCell = level.getFreeRandCell();\n            // level.addElement(stairsArea, randCell.getX(), randCell.getY());\n\n            level.addElement(stairsArea, 4, 4);\n\n            stairsArea.connect(stairsBattle);\n        }\n        return battle;\n    };\n\n};\n\nmodule.exports = RG.Factory.Battle;\n\n",
                "new_contents": "\nimport Constraints from './constraints';\n\nconst RG = require('./rg');\nRG.Factory = require('./factory');\nRG.Game = require('./game');\nRG.Game.Battle = require('./game.battle').Battle;\nRG.Game.Army = require('./game.battle').Army;\n\n/* Factory used for creating battles. */\nRG.Factory.Battle = function() {\n\n    /* Creates one battle into the level. TODO: Decide how to modify difficulty\n     * etc. TODO: Refactor into Factory.Battle. */\n    this.createBattle = function(level, conf = {}) {\n        const cols = conf.cols || 80;\n        const rows = conf.cols || 40;\n        const levelType = conf.levelType || 'forest';\n\n        const id = level ? level.getID() : 0;\n        const name = conf.name || 'Battle of level ' + id;\n\n        const battle = new RG.Game.Battle(name);\n        const forestConf = RG.getForestConf(cols, rows);\n        const battleLevel = RG.FACT.createLevel(levelType, cols, rows,\n            forestConf);\n        battle.setLevel(battleLevel);\n        const parser = RG.ObjectShell.getParser();\n\n        const factions = ['human', 'dwarf', 'dogfolk', 'wolfclan', 'goblin',\n            'catfolk', 'bearfolk', 'wildling', 'undead'];\n        const fact1 = RG.RAND.arrayGetRand(factions);\n        let fact2 = RG.RAND.arrayGetRand(factions);\n        while (fact1 === fact2) {\n            fact2 = RG.RAND.arrayGetRand(factions);\n        }\n\n        const armySize = conf.armySize || 20;\n        const numArmies = conf.numArmies || 2;\n        const facts = conf.armies || [fact1, fact2];\n        const maxDanger = conf.danger || 5;\n\n        // Generate all armies based on constraints\n        const armies = [];\n        for (let i = 0; i < numArmies; i++) {\n            const army = new RG.Game.Army(facts[i]);\n            const constr = [\n                {op: 'eq', prop: 'type', value: facts[i]},\n                {op: 'lte', prop: 'danger', value: maxDanger}\n            ];\n            const actorFunc = new Constraints().getConstraints(constr);\n            for (let i = 0; i < armySize; i++) {\n                const actor = parser.createRandomActor({func: actorFunc});\n                if (actor) {\n                    const comp = new RG.Component.InBattle();\n                    comp.setData({name: battle.getName(),\n                        army: army.getName()});\n                    actor.add(comp);\n                    army.addActor(actor);\n                }\n            }\n\n            // Army loses if 10% of actors remain, this gives some losing\n            // survivors, makes things more interesting\n            army.setDefeatThreshold(Math.round(0.1 * armySize));\n\n            // Assign random but legal coords to the army\n            let armyX = RG.RAND.getUniformInt(0, cols - 1);\n            const armyY = RG.RAND.getUniformInt(0, rows - 1);\n            if ((armyX + armySize) > (cols - 1)) {\n                armyX = cols - armySize;\n            }\n\n            battle.addArmy(army, armyX, armyY);\n            armies.push(army);\n        }\n\n        // Make army actors into each others enemies\n        armies.forEach(army1 => {\n            armies.forEach(army2 => {\n                if (army1.getName() !== army2.getName()) {\n                    army1.getActors().forEach(a1 => {\n                        army2.getActors().forEach(a2 => {\n                            a1.addEnemy(a2);\n                            a2.addEnemy(a1);\n                        });\n                    });\n                }\n            });\n\n            // Make the actors in army friends\n            army1.getActors().forEach(actor1 => {\n                army1.getActors().forEach(actor2 => {\n                    if (actor1.getID() !== actor2.getID()) {\n                        actor1.addFriend(actor2);\n                        actor2.addFriend(actor1);\n                    }\n                });\n            });\n        });\n\n        if (level) {\n            // Add connecting stairs between battle and area\n            const stairsBattle = new RG.Element.Stairs('stairsUp');\n            battleLevel.addElement(stairsBattle, 1, 1);\n            const stairsArea = new RG.Element.Stairs('stairsDown');\n\n            // const randCell = level.getFreeRandCell();\n            // level.addElement(stairsArea, randCell.getX(), randCell.getY());\n\n            level.addElement(stairsArea, 4, 4);\n\n            stairsArea.connect(stairsBattle);\n        }\n        return battle;\n    };\n\n};\n\nmodule.exports = RG.Factory.Battle;\n\n",
                "subject": "Changed arg to new Stairs() from bool to string.",
                "message": "Changed arg to new Stairs() from bool to string.\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "tpoikela/battles,tpoikela/battles,tpoikela/battles,tpoikela/battles,tpoikela/battles"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10279,
            "row": {
                "commit": "d13652c7b4f4e6d49f2107a4e978e44ed7a912e7",
                "old_file": "js/language/de-DE.js",
                "new_file": "js/language/de-DE.js",
                "old_contents": "if(!window.calendar_languages) {\n\twindow.calendar_languages = {};\n}\nwindow.calendar_languages['de-DE'] = {\n\terror_noview:     'Kalender: Ansicht {0} nicht gefunden',\n\terror_dateformat: 'Kalender: Falsches Datumsformat {0}. Sollte entweder \"now\" oder \"yyyy-mm-dd\" sein',\n\terror_loadurl:    'Kalender: Event-URL nicht gesetzt.',\n\terror_where:      'Kalender: Falsche Navigationsrichtung {0}. Nur \"next\", \"prev\" oder \"today\" sind erlaubt',\n\terror_timedevide: 'Kalender: Parameter für die Zeiteinteilung muss ein Teiler von 60 sein. Beispielsweise 10, 15, 30',\n\n\tno_events_in_day: 'Keine Ereignisse an diesem Tag.',\n\n\ttitle_year:  '{0}',\n\ttitle_month: '{0} {1}',\n\ttitle_week:  'Woche {0} im Jahr {1}',\n\ttitle_day:   '{0}, der {1}. {2} {3}',\n\n\tweek:        'Woche {0}',\n\tall_day:     'Ganztägig',\n\ttime:        'Zeit',\n\tevents:      'Ereignisse',\n\tbefore_time: 'Endet vor Zeitspanne',\n\tafter_time:  'Beginnt nach Zeitspanne',\n\n\tm0:  'Januar',\n\tm1:  'Februar',\n\tm2:  'März',\n\tm3:  'April',\n\tm4:  'Mai',\n\tm5:  'Juni',\n\tm6:  'Juli',\n\tm7:  'August',\n\tm8:  'September',\n\tm9:  'Oktober',\n\tm10: 'November',\n\tm11: 'Dezember',\n\n\tms0:  'Jan',\n\tms1:  'Feb',\n\tms2:  'Mär',\n\tms3:  'Apr',\n\tms4:  'Mai',\n\tms5:  'Jun',\n\tms6:  'Jul',\n\tms7:  'Aug',\n\tms8:  'Sep',\n\tms9:  'Okt',\n\tms10: 'Nov',\n\tms11: 'Dez',\n\n\td0: 'Sonntag',\n\td1: 'Montag',\n\td2: 'Dienstag',\n\td3: 'Mittwoch',\n\td4: 'Donnerstag',\n\td5: 'Freitag',\n\td6: 'Samstag',\n\n\tfirst_day: 1,\n\n\tholidays: {\n\t\t'01-01':     'Neujahr',\n\t\t'easter-2':  'Karfreitag',\n\t\t'easter+1':  'Ostermontag',\n\t\t'01-05':     'Erster Mai',\n\t\t'easter+39': 'Himmelfahrt',\n\t\t'easter+49': 'Pfingstsonntag',\n\t\t'easter+50': 'Pfingstmontag',\n\t\t'03-10':     'Tag der Deutschen Einheit',\n\t\t'25-12':     'Erster Weihnachtsfeiertag',\n\t\t'26-12':     'Zweiter Weihnachtsfeiertag',\n\t}\n};\n",
                "new_contents": "if(!window.calendar_languages) {\n\twindow.calendar_languages = {};\n}\nwindow.calendar_languages['de-DE'] = {\n\terror_noview:     'Kalender: Ansicht {0} nicht gefunden',\n\terror_dateformat: 'Kalender: Falsches Datumsformat {0}. Sollte entweder \"now\" oder \"yyyy-mm-dd\" sein',\n\terror_loadurl:    'Kalender: Event-URL nicht gesetzt.',\n\terror_where:      'Kalender: Falsche Navigationsrichtung {0}. Nur \"next\", \"prev\" oder \"today\" sind erlaubt',\n\terror_timedevide: 'Kalender: Parameter für die Zeiteinteilung muss ein Teiler von 60 sein. Beispielsweise 10, 15, 30',\n\n\tno_events_in_day: 'Keine Ereignisse an diesem Tag.',\n\n\ttitle_year:  '{0}',\n\ttitle_month: '{0} {1}',\n\ttitle_week:  '{0}. Kalenderwoche {1}',\n\ttitle_day:   '{0}, der {1}. {2} {3}',\n\n\tweek:        'Woche {0}',\n\tall_day:     'Ganztägig',\n\ttime:        'Zeit',\n\tevents:      'Ereignisse',\n\tbefore_time: 'Endet vor Zeitspanne',\n\tafter_time:  'Beginnt nach Zeitspanne',\n\n\tm0:  'Januar',\n\tm1:  'Februar',\n\tm2:  'März',\n\tm3:  'April',\n\tm4:  'Mai',\n\tm5:  'Juni',\n\tm6:  'Juli',\n\tm7:  'August',\n\tm8:  'September',\n\tm9:  'Oktober',\n\tm10: 'November',\n\tm11: 'Dezember',\n\n\tms0:  'Jan',\n\tms1:  'Feb',\n\tms2:  'Mär',\n\tms3:  'Apr',\n\tms4:  'Mai',\n\tms5:  'Jun',\n\tms6:  'Jul',\n\tms7:  'Aug',\n\tms8:  'Sep',\n\tms9:  'Okt',\n\tms10: 'Nov',\n\tms11: 'Dez',\n\n\td0: 'Sonntag',\n\td1: 'Montag',\n\td2: 'Dienstag',\n\td3: 'Mittwoch',\n\td4: 'Donnerstag',\n\td5: 'Freitag',\n\td6: 'Samstag',\n\n\tfirst_day: 1,\n\n\tholidays: {\n\t\t'01-01':     'Neujahr',\n\t\t'easter-2':  'Karfreitag',\n\t\t'easter+1':  'Ostermontag',\n\t\t'01-05':     'Erster Mai',\n\t\t'easter+39': 'Himmelfahrt',\n\t\t'easter+49': 'Pfingstsonntag',\n\t\t'easter+50': 'Pfingstmontag',\n\t\t'03-10':     'Tag der Deutschen Einheit',\n\t\t'25-12':     'Erster Weihnachtsfeiertag',\n\t\t'26-12':     'Zweiter Weihnachtsfeiertag',\n\t}\n};\n",
                "subject": "improved week display",
                "message": "improved week display\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "albertchau/Green,albertchau/Green"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10280,
            "row": {
                "commit": "4891fdf114cab42f991ab43aaff2192a74b37153",
                "old_file": "src/directives/form/easyassess.form.submit.js",
                "new_file": "src/directives/form/easyassess.form.submit.js",
                "old_contents": "var EasyAssess = require('../../easyassess.application');\n\nEasyAssess.directives[\"esFormSubmit\"]\n    = EasyAssess.app.directive(\"esFormSubmit\", function (esRequestService,ngDialog,Upload) {\n    return {\n        restrict: 'E',\n        replace: true,\n        transclude: false,\n        template:'<div>'\n                     +'<es-form-page>'\n                         +'<div>'\n                            +'<button type=\"button\" class=\"btn btn-primary\" ng-click=\"submit()\">提交</button>'\n                            +'<button type=\"button\" class=\"btn btn-primary\" ng-click=\"manageAttachment()\">上传附件</button>'\n                            //+'<button ng-if=\"esType!=\\'plan\\'\" type=\"button\" class=\"btn btn-primary\" ng-click=\"save()\">保存</button>'\n                         +'</div>'\n                         +'<es-app-tab-pane>'\n                         + '<es-app-tab es-active=\"true\" es-ref=\"formView\" es-title=\"表单\">'\n                            +'<div class=\"es-page-section\">'\n                            +'<es-form-header es-header=\"formHeader\" es-editable=\"false\"></es-form-header>'\n                            +'</div>'\n                            +'<div style=\"position: relative\">'\n                            +'<div style=\"width: 100%; overflow-x:auto; overflow-y: visible;\">'\n                            +'<div ng-repeat=\"group in template.groups\" class=\"es-page-section\">'\n                            +'<es-form-group-edit es-type=\"{{esType}}\" es-group=\"group\" es-data=\"helpData\"></es-form-group-edit>'\n                            + '</div>'\n                            +'</div>'\n                            +   '<div style=\"padding: 10px 0px 10px 0px;\">'\n                            +      '<span class=\"es-form-group-title\">填报说明:</span>'\n                            +      '<es-form-footer ng-if=\"template\" es-editable=\"false\" es-footer=\"template.footer\"></es-form-footer>'\n                            +   '</div>'\n                            +'</div>'\n                         + '</es-app-tab>'\n                         + '<es-app-tab es-ref=\"preView\" es-title=\"预览\">'\n                         +    '<es-form-result ng-if=\"template && previewModel\" es-form=\"previewModel\" es-template=\"template\"></es-form-result>'\n                         + '</es-app-tab>'\n                        +'</es-app-tab-pane>'\n                     +'</es-form-page>'\n                 +'</div>',\n        scope: {\n            esForm: \"=\",\n            esType: \"@\"\n        },\n\n        controller: [\"$scope\",\"ngDialog\", function($scope,ngDialog){\n            if ($scope.esType == 'assess'){\n                var url = EasyAssess.activeEnv['assess']() + 'template/' + $scope.esForm.securedAssessment.templateGuid;\n                esRequestService.esGet(url).then(function(data){\n                    $scope.template = data.data;\n                });\n            }else if($scope.esType == 'plan'){\n                $scope.template = $scope.esForm.template;\n            }\n\n            $scope.formHeader = {\n                name:$scope.esForm.formName\n            };\n            \n            if ($scope.esType =='assess'){\n                $scope.helpData =  $scope.esForm.securedAssessment.id;\n            }else{\n                $scope.helpData = null;\n            }\n\n            $scope.manageAttachment = function () {\n                ngDialog.open({\n                    template: '<div style=\"padding: 10px 10px 10px 10px;\">'\n                            +\t'<div class=\"es-dialog-form-line\">'\n                            +  '<span style=\"color: #9d261d;\">注意: 每个表单只能上传一个附件，重复上传会相互覆盖</span>'\n                            +  '</div>'\n                             +\t'<div class=\"es-dialog-form-line\">'\n                             +      '<a href=\"javascript:void(0)\" class=\"button\" ngf-select ng-model=\"file\" name=\"file\" ngf-max-size=\"20MB\" ngf-min-height=\"100\">选择文件</a>'\n                             +      '<a ng-if=\"attachment\" href=\"attachment\" style=\"padding-left: 20px;\">查看附件</a>'\n                             +  '</div>'\n\n                             +\t'<div class=\"es-dialog-form-line\">'\n                             +      '<button type=\"submit\" class=\"btn btn-primary\" ng-click=\"submit()\">上传</button>'\n                             +  '</div>'\n                             + '</div>',\n                    plain: true,\n                    controller: ['$scope', function ($dialogScope) {\n                        $dialogScope.attachment = $scope.esForm.attachment;\n                        $dialogScope.submit = function () {\n                            if (!$dialogScope.file) {\n                                EasyAssess.QuickMessage.error(\"请选择文件\");\n                            } else {\n                                $dialogScope.upload($dialogScope.file);\n                            }\n                        };\n\n                        $dialogScope.upload = function (file) {\n                            $dialogScope.fileInfo = file;\n                            Upload.upload({\n                                url: EasyAssess.activeEnv['assess']() + 'form/' + $scope.esForm.id + \"/attachment\",\n                                data: {\n                                    'attachment': file\n                                },\n                                withCredentials: true\n                            }).success(function (data, status, headers, config) {\n                                EasyAssess.QuickMessage.message(\"上传成功\");\n                                $dialogScope.closeThisDialog();\n                            }).error(function (data, status, headers, config) {\n                                EasyAssess.QuickMessage.error(\"上传失败\");\n                            });\n                        };\n                    }]\n                });\n            };\n            \n            $scope.answer = {\n                values:[],\n                codes:[],\n                details:[],\n                signatures: {}\n            };\n\n            $scope.save = function(){\n                if($scope.esType != 'plan'){\n                    angular.forEach($scope.rawCodeList,function(rawCode){\n                        delete rawCode['codeGuid']\n                    });\n                    $scope.answer.codes = $scope.rawCodeList;\n\n                    var url = EasyAssess.activeEnv['assess']() + 'form/' + $scope.esForm.id;\n                    $scope.esForm.status = \"S\";\n                    $scope.esForm.values = $scope.answer.values;\n                    $scope.esForm.codes = $scope.answer.codes;\n                    $scope.esForm.details = $scope.answer.details;\n                    $scope.esForm.signatures = $scope.answer.signatures;\n\n                    esRequestService.esPut(url, $scope.esForm).then(function(res){\n                        EasyAssess.QuickMessage.message(\"保存成功\");\n                    });\n                }\n            };\n\n            $scope.submit = function(){\n                ngDialog.openConfirm({\n                    template:   '<div class=\"ngdialog-message\">答案一旦提交无法修改,是否确定提交?</div>'\n                    + '<div align=\"right\"><button ng-click=\"confirm()\" class=\"btn btn-primary\">确定</button><button ng-click=\"closeThisDialog()\" class=\"btn btn-primary\">取消</button></div>',\n                    plain: true\n                }).then(\n                    function(){\n                        angular.forEach($scope.rawCodeList,function(rawCode){\n                            delete rawCode['codeGuid']\n                        });\n\n                        $scope.answer.codes = $scope.rawCodeList;\n\n\n                        if($scope.esType == 'plan'){\n                            $scope.$emit('submitted',{\"values\":$scope.answer.values,\"codes\":$scope.answer.codes, \"details\":$scope.answer.details, \"signatures\":$scope.answer.signatures});\n                        }else{\n                            var url = EasyAssess.activeEnv['assess']() + 'form/submit/' + $scope.esForm.id;\n                            esRequestService.esPut(url, {\"values\":$scope.answer.values,\"codes\":$scope.answer.codes,\"details\":$scope.answer.details, \"signatures\":$scope.answer.signatures}).then(function(res){\n                                $scope.$emit('submitted');\n                            });\n                        }\n                    }\n                );\n\n            };\n\n            $scope.rawCodeList = [];\n\n            $scope.$on('$codeItemLookup_selected',function(e, data, attrs){\n                var subjectGuid = attrs.subjectGuid;\n                var codeGroupGuid = attrs.codeGroupGuid\n\n                addCodeIntoList(e.targetScope, data, subjectGuid, codeGroupGuid);\n            });\n\n            $scope.$on('$tabSelected',function(e, ref, attrs){\n                if (ref==\"preView\") {\n                    $scope.previewModel = {\n                        values:$scope.answer.values,\n                        codes:$scope.rawCodeList,\n                        details:$scope.answer.details,\n                        signatures: $scope.answer.signatures\n                    };\n                } else {\n                    $scope.previewModel = null;\n                }\n            });\n\n            $scope.$on('removeSpecimen',function(e,data){\n                removeFromList(data);\n            });\n\n            $scope.$on(\"$rowguidLookup_selected\",function(e,data){\n            });\n\n            $scope.$on('valueChanged',function(e,data){\n                updateTheValueList(data);\n            });\n\n            $scope.$on('batchNumberChanged',function(e,data){\n                updateTheDetailList(data, 'batchNumber');\n            });\n\n            $scope.$on('expireChanged',function(e,data){\n                updateTheDetailList(data, 'expire');\n            });\n\n            $scope.$on('signatureChanged',function(e, data){\n                if (!$scope.answer.signatures[data.groupGuid]) {\n                    $scope.answer.signatures[data.groupGuid] = {};\n                }\n                $scope.answer.signatures[data.groupGuid][data.field] = data.value;\n            });\n\n            function updateTheDetailList(data, field) {\n                var exists = $scope.answer.details.find(function(detail){\n                   return detail.subjectGuid == data.subjectGuid;\n                });\n\n                if (exists) {\n                    exists[field] = data.value;\n                } else {\n                    var detail = {\n                        'subjectGuid': data.subjectGuid\n                    }\n                    detail[field] = data.value;\n                    $scope.answer.details.push(detail);\n                }\n            }\n\n            function updateTheValueList(data){\n                var updateCode = $scope.answer.values.find(function(item){\n                    return (item.subjectGuid === data.subjectGuid) && (item.specimenCode === data.specimenCode);\n                });\n\n                if (updateCode){\n                    updateCode.value = data.value\n                }else{\n                    $scope.answer.values.push(data);\n                }\n            }\n\n            function removeFromList(data){\n                $scope.answer.values = $scope.answer.values.filter(function(item){\n                    return item.specimenCode != data;\n                });\n            }\n\n            function addCodeIntoList(t, data, subjectGuid, codeGroupGuid){\n                var codeItem = {\n                    subject:{\n                        subject: t.esSubject.item.subject,\n                        unit: t.esSubject.item.unit\n                    },\n                    subjectGuid: t.esSubject.guid,\n                    codeNumber:data.codeNumber,\n                    codeName:data.name,\n                    codeGroup: {\n                        \"name\":data.group.name,\n                        \"id\":data.group.id,\n                        \"guid\":codeGroupGuid\n                    },\n                    codeGuid: t.esLookupGuid\n                };\n\n                var updatedItem = $scope.rawCodeList.find(function(item){\n                    return item.codeGuid  == codeItem.codeGuid\n                });\n\n                if(updatedItem){\n                    updatedItem.subject = codeItem.subject;\n                    updatedItem.subjectGuid = codeItem.subjectGuid;\n                    updatedItem.codeNumber = codeItem.codeNumber;\n                    updatedItem.codeName = codeItem.codeName;\n                    updatedItem.codeGroup = {\n                        \"name\": codeItem.codeGroup.name,\n                        \"id\": codeItem.codeGroup.id,\n                        \"guid\":codeGroupGuid\n                    }\n                }else{\n                    $scope.rawCodeList.push(codeItem);\n                }\n            }\n        }],\n\n    }\n});\n",
                "new_contents": "var EasyAssess = require('../../easyassess.application');\n\nEasyAssess.directives[\"esFormSubmit\"]\n    = EasyAssess.app.directive(\"esFormSubmit\", function (esRequestService,ngDialog,Upload) {\n    return {\n        restrict: 'E',\n        replace: true,\n        transclude: false,\n        template:'<div>'\n                     +'<es-form-page>'\n                         +'<div>'\n                            +'<button type=\"button\" class=\"btn btn-primary\" ng-click=\"submit()\">提交</button>'\n                            +'<button type=\"button\" class=\"btn btn-primary\" ng-click=\"manageAttachment()\">上传附件</button>'\n                            //+'<button ng-if=\"esType!=\\'plan\\'\" type=\"button\" class=\"btn btn-primary\" ng-click=\"save()\">保存</button>'\n                         +'</div>'\n                         +'<es-app-tab-pane>'\n                         + '<es-app-tab es-active=\"true\" es-ref=\"formView\" es-title=\"表单\">'\n                            +'<div class=\"es-page-section\">'\n                            +'<es-form-header es-header=\"formHeader\" es-editable=\"false\"></es-form-header>'\n                            +'</div>'\n                            +'<div style=\"position: relative\">'\n                            +'<div style=\"width: 100%; overflow-x:auto; overflow-y: visible;\">'\n                            +'<div ng-repeat=\"group in template.groups\" class=\"es-page-section\">'\n                            +'<es-form-group-edit es-type=\"{{esType}}\" es-group=\"group\" es-data=\"helpData\"></es-form-group-edit>'\n                            + '</div>'\n                            +'</div>'\n                            +   '<div style=\"padding: 10px 0px 10px 0px;\">'\n                            +      '<span class=\"es-form-group-title\">填报说明:</span>'\n                            +      '<es-form-footer ng-if=\"template\" es-editable=\"false\" es-footer=\"template.footer\"></es-form-footer>'\n                            +   '</div>'\n                            +'</div>'\n                         + '</es-app-tab>'\n                         + '<es-app-tab es-ref=\"preView\" es-title=\"预览\">'\n                         +    '<es-form-result ng-if=\"template && previewModel\" es-form=\"previewModel\" es-template=\"template\"></es-form-result>'\n                         + '</es-app-tab>'\n                        +'</es-app-tab-pane>'\n                     +'</es-form-page>'\n                 +'</div>',\n        scope: {\n            esForm: \"=\",\n            esType: \"@\"\n        },\n\n        controller: [\"$scope\",\"ngDialog\", function($scope,ngDialog){\n            if ($scope.esType == 'assess'){\n                var url = EasyAssess.activeEnv['assess']() + 'template/' + $scope.esForm.securedAssessment.templateGuid;\n                esRequestService.esGet(url).then(function(data){\n                    $scope.template = data.data;\n                });\n            }else if($scope.esType == 'plan'){\n                $scope.template = $scope.esForm.template;\n            }\n\n            $scope.formHeader = {\n                name:$scope.esForm.formName\n            };\n            \n            if ($scope.esType =='assess'){\n                $scope.helpData =  $scope.esForm.securedAssessment.id;\n            }else{\n                $scope.helpData = null;\n            }\n\n            $scope.manageAttachment = function () {\n                ngDialog.open({\n                    template: '<div style=\"padding: 10px 10px 10px 10px;\">'\n                            +\t'<div class=\"es-dialog-form-line\">'\n                            +  '<span style=\"color: #9d261d;\">注意: 每个表单只能上传一个附件，重复上传会相互覆盖</span>'\n                            +  '</div>'\n                             +\t'<div class=\"es-dialog-form-line\">'\n                             +      '<a href=\"javascript:void(0)\" class=\"button\" ngf-select ng-model=\"file\" name=\"file\" ngf-max-size=\"20MB\" ngf-min-height=\"100\">选择文件</a>'\n                             +      '<a ng-if=\"attachment\" href=\"attachment\" style=\"padding-left: 20px;\">查看附件</a>'\n                             +  '</div>'\n\n                             +\t'<div class=\"es-dialog-form-line\">'\n                             +      '<button type=\"submit\" class=\"btn btn-primary\" ng-click=\"submit()\">上传</button>'\n                             +  '</div>'\n                             + '</div>',\n                    plain: true,\n                    controller: ['$scope', function ($dialogScope) {\n                        if (!$dialogScope.attachment) {\n                            $dialogScope.attachment = $scope.esForm.attachment;\n                        }\n                        $dialogScope.submit = function () {\n                            if (!$dialogScope.file) {\n                                EasyAssess.QuickMessage.error(\"请选择文件\");\n                            } else {\n                                $dialogScope.upload($dialogScope.file);\n                            }\n                        };\n\n                        $dialogScope.upload = function (file) {\n                            $dialogScope.fileInfo = file;\n                            Upload.upload({\n                                url: EasyAssess.activeEnv['assess']() + 'form/' + $scope.esForm.id + \"/attachment\",\n                                data: {\n                                    'attachment': file\n                                },\n                                withCredentials: true\n                            }).success(function (data, status, headers, config) {\n                                EasyAssess.QuickMessage.message(\"上传成功\");\n                                $dialogScope.closeThisDialog();\n                            }).error(function (data, status, headers, config) {\n                                EasyAssess.QuickMessage.error(\"上传失败\");\n                            });\n                        };\n                    }]\n                });\n            };\n            \n            $scope.answer = {\n                values:[],\n                codes:[],\n                details:[],\n                signatures: {}\n            };\n\n            $scope.save = function(){\n                if($scope.esType != 'plan'){\n                    angular.forEach($scope.rawCodeList,function(rawCode){\n                        delete rawCode['codeGuid']\n                    });\n                    $scope.answer.codes = $scope.rawCodeList;\n\n                    var url = EasyAssess.activeEnv['assess']() + 'form/' + $scope.esForm.id;\n                    $scope.esForm.status = \"S\";\n                    $scope.esForm.values = $scope.answer.values;\n                    $scope.esForm.codes = $scope.answer.codes;\n                    $scope.esForm.details = $scope.answer.details;\n                    $scope.esForm.signatures = $scope.answer.signatures;\n\n                    esRequestService.esPut(url, $scope.esForm).then(function(res){\n                        EasyAssess.QuickMessage.message(\"保存成功\");\n                    });\n                }\n            };\n\n            $scope.submit = function(){\n                ngDialog.openConfirm({\n                    template:   '<div class=\"ngdialog-message\">答案一旦提交无法修改,是否确定提交?</div>'\n                    + '<div align=\"right\"><button ng-click=\"confirm()\" class=\"btn btn-primary\">确定</button><button ng-click=\"closeThisDialog()\" class=\"btn btn-primary\">取消</button></div>',\n                    plain: true\n                }).then(\n                    function(){\n                        angular.forEach($scope.rawCodeList,function(rawCode){\n                            delete rawCode['codeGuid']\n                        });\n\n                        $scope.answer.codes = $scope.rawCodeList;\n\n\n                        if($scope.esType == 'plan'){\n                            $scope.$emit('submitted',{\"values\":$scope.answer.values,\"codes\":$scope.answer.codes, \"details\":$scope.answer.details, \"signatures\":$scope.answer.signatures});\n                        }else{\n                            var url = EasyAssess.activeEnv['assess']() + 'form/submit/' + $scope.esForm.id;\n                            esRequestService.esPut(url, {\"values\":$scope.answer.values,\"codes\":$scope.answer.codes,\"details\":$scope.answer.details, \"signatures\":$scope.answer.signatures}).then(function(res){\n                                $scope.$emit('submitted');\n                            });\n                        }\n                    }\n                );\n\n            };\n\n            $scope.rawCodeList = [];\n\n            $scope.$on('$codeItemLookup_selected',function(e, data, attrs){\n                var subjectGuid = attrs.subjectGuid;\n                var codeGroupGuid = attrs.codeGroupGuid\n\n                addCodeIntoList(e.targetScope, data, subjectGuid, codeGroupGuid);\n            });\n\n            $scope.$on('$tabSelected',function(e, ref, attrs){\n                if (ref==\"preView\") {\n                    $scope.previewModel = {\n                        values:$scope.answer.values,\n                        codes:$scope.rawCodeList,\n                        details:$scope.answer.details,\n                        signatures: $scope.answer.signatures\n                    };\n                } else {\n                    $scope.previewModel = null;\n                }\n            });\n\n            $scope.$on('removeSpecimen',function(e,data){\n                removeFromList(data);\n            });\n\n            $scope.$on(\"$rowguidLookup_selected\",function(e,data){\n            });\n\n            $scope.$on('valueChanged',function(e,data){\n                updateTheValueList(data);\n            });\n\n            $scope.$on('batchNumberChanged',function(e,data){\n                updateTheDetailList(data, 'batchNumber');\n            });\n\n            $scope.$on('expireChanged',function(e,data){\n                updateTheDetailList(data, 'expire');\n            });\n\n            $scope.$on('signatureChanged',function(e, data){\n                if (!$scope.answer.signatures[data.groupGuid]) {\n                    $scope.answer.signatures[data.groupGuid] = {};\n                }\n                $scope.answer.signatures[data.groupGuid][data.field] = data.value;\n            });\n\n            function updateTheDetailList(data, field) {\n                var exists = $scope.answer.details.find(function(detail){\n                   return detail.subjectGuid == data.subjectGuid;\n                });\n\n                if (exists) {\n                    exists[field] = data.value;\n                } else {\n                    var detail = {\n                        'subjectGuid': data.subjectGuid\n                    }\n                    detail[field] = data.value;\n                    $scope.answer.details.push(detail);\n                }\n            }\n\n            function updateTheValueList(data){\n                var updateCode = $scope.answer.values.find(function(item){\n                    return (item.subjectGuid === data.subjectGuid) && (item.specimenCode === data.specimenCode);\n                });\n\n                if (updateCode){\n                    updateCode.value = data.value\n                }else{\n                    $scope.answer.values.push(data);\n                }\n            }\n\n            function removeFromList(data){\n                $scope.answer.values = $scope.answer.values.filter(function(item){\n                    return item.specimenCode != data;\n                });\n            }\n\n            function addCodeIntoList(t, data, subjectGuid, codeGroupGuid){\n                var codeItem = {\n                    subject:{\n                        subject: t.esSubject.item.subject,\n                        unit: t.esSubject.item.unit\n                    },\n                    subjectGuid: t.esSubject.guid,\n                    codeNumber:data.codeNumber,\n                    codeName:data.name,\n                    codeGroup: {\n                        \"name\":data.group.name,\n                        \"id\":data.group.id,\n                        \"guid\":codeGroupGuid\n                    },\n                    codeGuid: t.esLookupGuid\n                };\n\n                var updatedItem = $scope.rawCodeList.find(function(item){\n                    return item.codeGuid  == codeItem.codeGuid\n                });\n\n                if(updatedItem){\n                    updatedItem.subject = codeItem.subject;\n                    updatedItem.subjectGuid = codeItem.subjectGuid;\n                    updatedItem.codeNumber = codeItem.codeNumber;\n                    updatedItem.codeName = codeItem.codeName;\n                    updatedItem.codeGroup = {\n                        \"name\": codeItem.codeGroup.name,\n                        \"id\": codeItem.codeGroup.id,\n                        \"guid\":codeGroupGuid\n                    }\n                }else{\n                    $scope.rawCodeList.push(codeItem);\n                }\n            }\n        }],\n\n    }\n});\n",
                "subject": "Allow form editor download attachment",
                "message": "Allow form editor download attachment\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "EasyAssessSystem/web-ui,EasyAssessSystem/web-ui,EasyAssessSystem/web-ui,EasyAssessSystem/web-ui"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10281,
            "row": {
                "commit": "875f7ab41436a6c9fac204cd333b161eead1c238",
                "old_file": "client/src/js/utils/sagas.js",
                "new_file": "client/src/js/utils/sagas.js",
                "old_contents": "/**\n * Utility functions for working with sagas.\n *\n * @module sagaUtils\n */\nimport { replace } from \"connected-react-router\";\nimport { get, includes } from \"lodash-es\";\nimport { matchPath } from \"react-router-dom\";\nimport { put } from \"redux-saga/effects\";\nimport { LOGOUT } from \"../app/actionTypes\";\nimport { createFindURL } from \"./utils\";\n\n/**\n * Executes an API call by calling ``apiMethod`` with ``action``.\n *\n * If the call succeeds an action with ``actionType.SUCCEEDED`` and a ``data`` property is dispatched.\n *\n * If the call fails an action with ``actionType.FAILED`` and generic error properties is dispatched.\n *\n * @generator\n * @param apiMethod {function} the function to call with ``action``\n * @param action {object} an action to pass to ``apiMethod``\n * @param actionType {object} a request-style action type\n * @param context {object} data to assign to the `context` property of the action\n */\nexport function* apiCall(apiMethod, action, actionType, context = {}) {\n    try {\n        const response = yield apiMethod(action);\n        yield put({ type: actionType.SUCCEEDED, data: response.body, context });\n        return response;\n    } catch (error) {\n        const statusCode = get(error, \"response.statusCode\");\n\n        if (statusCode === 401) {\n            yield put({\n                type: LOGOUT.SUCCEEDED\n            });\n            return error.response;\n        }\n\n        if (get(error, \"response.body\")) {\n            yield putGenericError(actionType, error);\n            return error.response;\n        }\n\n        throw error;\n    }\n}\n\n/**\n * Executes an API call that uses Virtool's find implementation when the browser URL matches to ``path``.\n *\n * This generator is intended to be used in a saga triggered by ``LOCATION_CHANGE`` from ``connected-react-router``. If the\n * ``path`` matches the current browser URL and API request will be sent to the server with the search parameter\n * (if any) appended to the request URL.\n *\n * The actual API call is made using {@link apiCall}.\n *\n * @generator\n * @param path {string} the path that, when matched, will allow find calls\n * @param apiMethod {function} the API function to call\n * @param action {object} the action to pass to the ``apiMethod``\n * @param actionType {object} the request-style action type to dispatch when the call completes\n */\nexport function* apiFind(path, apiMethod, action, actionType) {\n    const { pathname } = action.payload;\n\n    const match = matchPath(pathname, { path, exact: true });\n\n    if (match) {\n        yield apiCall(apiMethod, {}, actionType);\n    }\n}\n\nexport function* pushFindTerm(term, contains) {\n    const url = createFindURL(term);\n\n    if (!contains || includes(url.pathname, contains)) {\n        yield put(replace(url.pathname + url.search));\n    }\n}\n\n/**\n * Should be called in the event of an HTTP error during an API call. Dispatches a ``FAILED`` request-style action\n * containing data related to the HTTP error.\n *\n * @generator\n * @param actionType {object} a request-style action type\n * @param error {object} the HTTP error from Superagent\n */\nexport function* putGenericError(actionType, error) {\n    const { body, status } = error.response;\n\n    yield put({\n        type: actionType.FAILED,\n        message: body.message,\n        error,\n        status\n    });\n}\n",
                "new_contents": "/**\n * Utility functions for working with sagas.\n *\n * @module sagaUtils\n */\nimport { replace } from \"connected-react-router\";\nimport { get, includes } from \"lodash-es\";\nimport { put } from \"redux-saga/effects\";\nimport { LOGOUT } from \"../app/actionTypes\";\nimport { createFindURL } from \"./utils\";\n\n/**\n * Executes an API call by calling ``apiMethod`` with ``action``.\n *\n * If the call succeeds an action with ``actionType.SUCCEEDED`` and a ``data`` property is dispatched.\n *\n * If the call fails an action with ``actionType.FAILED`` and generic error properties is dispatched.\n *\n * @generator\n * @param apiMethod {function} the function to call with ``action``\n * @param action {object} an action to pass to ``apiMethod``\n * @param actionType {object} a request-style action type\n * @param context {object} data to assign to the `context` property of the action\n */\nexport function* apiCall(apiMethod, action, actionType, context = {}) {\n    try {\n        const response = yield apiMethod(action);\n        yield put({ type: actionType.SUCCEEDED, data: response.body, context });\n        return response;\n    } catch (error) {\n        const statusCode = get(error, \"response.statusCode\");\n\n        if (statusCode === 401) {\n            yield put({\n                type: LOGOUT.SUCCEEDED\n            });\n            return error.response;\n        }\n\n        if (get(error, \"response.body\")) {\n            yield putGenericError(actionType, error);\n            return error.response;\n        }\n\n        throw error;\n    }\n}\n\nexport function* pushFindTerm(term, contains) {\n    const url = createFindURL(term);\n\n    if (!contains || includes(url.pathname, contains)) {\n        yield put(replace(url.pathname + url.search));\n    }\n}\n\n/**\n * Should be called in the event of an HTTP error during an API call. Dispatches a ``FAILED`` request-style action\n * containing data related to the HTTP error.\n *\n * @generator\n * @param actionType {object} a request-style action type\n * @param error {object} the HTTP error from Superagent\n */\nexport function* putGenericError(actionType, error) {\n    const { body, status } = error.response;\n\n    yield put({\n        type: actionType.FAILED,\n        message: body.message,\n        error,\n        status\n    });\n}\n",
                "subject": "Remove unused apiFind() generation function",
                "message": "Remove unused apiFind() generation function\n\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "igboyes/virtool,virtool/virtool,virtool/virtool,igboyes/virtool"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10282,
            "row": {
                "commit": "69e395cd2f3ff3e9cfe9fad27944781d0fe084e9",
                "old_file": "examples/advanced/custom_datatype.js",
                "new_file": "examples/advanced/custom_datatype.js",
                "old_contents": "// This example demonstrates importing a custom data type,\n// and extending an existing function (add) with support for this data type.\n\nconst { create, factory, all } = require('../..')\nconst math = create(all)\n\n// factory function which defines a new data type CustomValue\nconst createCustomValue = factory('CustomValue', ['typed'], ({ typed }) => {\n  // create a new data type\n  function CustomValue (value) {\n    this.value = value\n  }\n  CustomValue.prototype.isCustomValue = true\n  CustomValue.prototype.toString = function () {\n    return 'CustomValue:' + this.value\n  }\n\n  // define a new data type with typed-function\n  typed.addType({\n    name: 'CustomValue',\n    test: function (x) {\n      // test whether x is of type CustomValue\n      return x && x.isCustomValue === true\n    }\n  })\n\n  return CustomValue\n})\n\n// function add which can add the CustomValue data type\n// When imported in math.js, the existing function `add` with support for\n// CustomValue, because both implementations are typed-functions and do not\n// have conflicting signatures.\nconst createAddCustomValue = factory('add', ['typed', 'CustomValue'], ({ typed, CustomValue }) => {\n  return typed('add', {\n    'CustomValue, CustomValue': function (a, b) {\n      return new CustomValue(a.value + b.value)\n    }\n  })\n})\n\n// import the new data type and function\nmath.import([\n  createCustomValue,\n  createAddCustomValue\n])\n\n// use the new type\nconst ans = math.add(new math.CustomValue(2), new math.CustomValue(3))\n// ans = CustomValue(5)\n\nconsole.log(ans.toString())\n// outputs 'CustomValue:5'\n",
                "new_contents": "// This example demonstrates importing a custom data type,\n// and extending an existing function (add) with support for this data type.\n\nconst { create, factory, all } = require('../..')\nconst math = create(all)\n\n// factory function which defines a new data type CustomValue\nconst createCustomValue = factory('CustomValue', ['typed'], ({ typed }) => {\n  // create a new data type\n  function CustomValue (value) {\n    this.value = value\n  }\n  CustomValue.prototype.isCustomValue = true\n  CustomValue.prototype.toString = function () {\n    return 'CustomValue:' + this.value\n  }\n\n  // define a new data type with typed-function\n  typed.addType({\n    name: 'CustomValue',\n    test: function (x) {\n      // test whether x is of type CustomValue\n      return x && x.isCustomValue === true\n    }\n  })\n\n  return CustomValue\n})\n\n// function add which can add the CustomValue data type\n// When imported in math.js, the existing function `add` with support for\n// CustomValue, because both implementations are typed-functions and do not\n// have conflicting signatures.\nconst createAddCustomValue = factory('add', ['typed', 'CustomValue'], ({ typed, CustomValue }) => {\n  return typed('add', {\n    'CustomValue, CustomValue': function (a, b) {\n      return new CustomValue(a.value + b.value)\n    }\n  })\n})\n\n// import the new data type and function\nmath.import([\n  createCustomValue,\n  createAddCustomValue\n])\n\n// use the new type\nconst ans1 = math.add(new math.CustomValue(2), new math.CustomValue(3))\nconsole.log(ans1.toString())\n// outputs 'CustomValue:5'\n\n// you can automatically use the new type in functions which use `add` under the hood:\nconst ans2 = math.sum(new math.CustomValue(2), new math.CustomValue(3), new math.CustomValue(4))\nconsole.log(ans2.toString())\n// outputs 'CustomValue:9'\n",
                "subject": "Extend example `custom_datatype.js` demoing it a bit more",
                "message": "Extend example `custom_datatype.js` demoing it a bit more\n",
                "lang": "JavaScript",
                "license": "apache-2.0",
                "repos": "josdejong/mathjs,josdejong/mathjs,FSMaxB/mathjs,josdejong/mathjs,FSMaxB/mathjs,josdejong/mathjs,FSMaxB/mathjs,FSMaxB/mathjs,josdejong/mathjs,FSMaxB/mathjs"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10283,
            "row": {
                "commit": "2c0f703b53e195292ba9322c86e3be6b528bc2c5",
                "old_file": "src/directives/form/easyassess.form.submit.js",
                "new_file": "src/directives/form/easyassess.form.submit.js",
                "old_contents": "var EasyAssess = require('../../easyassess.application');\n\nEasyAssess.directives[\"esFormSubmit\"]\n    = EasyAssess.app.directive(\"esFormSubmit\", function (esRequestService,ngDialog,Upload) {\n    return {\n        restrict: 'E',\n        replace: true,\n        transclude: false,\n        template:'<div>'\n                     +'<es-form-page>'\n                         +'<div>'\n                            +'<button type=\"button\" class=\"btn btn-primary\" ng-click=\"submit()\">提交</button>'\n                            +'<button type=\"button\" class=\"btn btn-primary\" ng-click=\"manageAttachment()\">上传附件</button>'\n                            //+'<button ng-if=\"esType!=\\'plan\\'\" type=\"button\" class=\"btn btn-primary\" ng-click=\"save()\">保存</button>'\n                         +'</div>'\n                         +'<es-app-tab-pane>'\n                         + '<es-app-tab es-active=\"true\" es-ref=\"formView\" es-title=\"表单\">'\n                            +'<div class=\"es-page-section\">'\n                            +'<es-form-header es-header=\"formHeader\" es-editable=\"false\"></es-form-header>'\n                            +'</div>'\n                            +'<div style=\"position: relative\">'\n                            +'<div style=\"width: 100%; overflow-x:auto; overflow-y: visible;\">'\n                            +'<div ng-repeat=\"group in template.groups\" class=\"es-page-section\">'\n                            +'<es-form-group-edit es-type=\"{{esType}}\" es-group=\"group\" es-data=\"helpData\"></es-form-group-edit>'\n                            + '</div>'\n                            +'</div>'\n                            +   '<div style=\"padding: 10px 0px 10px 0px;\">'\n                            +      '<span class=\"es-form-group-title\">填报说明:</span>'\n                            +      '<es-form-footer ng-if=\"template\" es-editable=\"false\" es-footer=\"template.footer\"></es-form-footer>'\n                            +   '</div>'\n                            +'</div>'\n                         + '</es-app-tab>'\n                         + '<es-app-tab es-ref=\"preView\" es-title=\"预览\">'\n                         +    '<es-form-result ng-if=\"template && previewModel\" es-form=\"previewModel\" es-template=\"template\"></es-form-result>'\n                         + '</es-app-tab>'\n                        +'</es-app-tab-pane>'\n                     +'</es-form-page>'\n                 +'</div>',\n        scope: {\n            esForm: \"=\",\n            esType: \"@\"\n        },\n\n        controller: [\"$scope\",\"ngDialog\", function($scope,ngDialog){\n            if ($scope.esType == 'assess'){\n                var url = EasyAssess.activeEnv['assess']() + 'template/' + $scope.esForm.securedAssessment.templateGuid;\n                esRequestService.esGet(url).then(function(data){\n                    $scope.template = data.data;\n                });\n            }else if($scope.esType == 'plan'){\n                $scope.template = $scope.esForm.template;\n            }\n\n            $scope.formHeader = {\n                name:$scope.esForm.formName\n            };\n            \n            if ($scope.esType =='assess'){\n                $scope.helpData =  $scope.esForm.securedAssessment.id;\n            }else{\n                $scope.helpData = null;\n            }\n\n            $scope.manageAttachment = function () {\n                ngDialog.open({\n                    template: '<div style=\"padding: 10px 10px 10px 10px;\">'\n                            +\t'<div class=\"es-dialog-form-line\">'\n                            +  '<span style=\"color: #9d261d;\">注意: 每个表单只能上传一个附件，重复上传会相互覆盖</span>'\n                            +  '</div>'\n                             +\t'<div class=\"es-dialog-form-line\">'\n                             +      '<a href=\"javascript:void(0)\" class=\"button\" ngf-select ng-model=\"file\" name=\"file\" ngf-max-size=\"20MB\" ngf-min-height=\"100\">选择文件</a>'\n                             +      '<a ng-if=\"attachment\" href=\"attachment\" style=\"padding-left: 20px;\">查看附件</a>'\n                             +  '</div>'\n\n                             +\t'<div class=\"es-dialog-form-line\">'\n                             +      '<button type=\"submit\" class=\"btn btn-primary\" ng-click=\"submit()\">上传</button>'\n                             +  '</div>'\n                             + '</div>',\n                    plain: true,\n                    controller: ['$scope', function ($dialogScope) {\n                        $dialogScope.attachment = $scope.esForm.attachment;\n                        $dialogScope.submit = function () {\n                            if (!$dialogScope.file) {\n                                EasyAssess.QuickMessage.error(\"请选择文件\");\n                            } else {\n                                $dialogScope.upload($dialogScope.file);\n                            }\n                        };\n\n                        $dialogScope.upload = function (file) {\n                            $dialogScope.fileInfo = file;\n                            Upload.upload({\n                                url: EasyAssess.activeEnv['assess']() + 'form/' + $scope.esForm.id + \"/attachment\",\n                                data: {\n                                    'attachment': file\n                                },\n                                withCredentials: true\n                            }).success(function (data, status, headers, config) {\n                                $scope.esForm.attachment = data.data;\n                                EasyAssess.QuickMessage.message(\"上传成功\");\n                                $dialogScope.closeThisDialog();\n                            }).error(function (data, status, headers, config) {\n                                EasyAssess.QuickMessage.error(\"上传失败\");\n                            });\n                        };\n                    }]\n                });\n            };\n            \n            $scope.answer = {\n                values:[],\n                codes:[],\n                details:[],\n                signatures: {}\n            };\n\n            $scope.save = function(){\n                if($scope.esType != 'plan'){\n                    angular.forEach($scope.rawCodeList,function(rawCode){\n                        delete rawCode['codeGuid']\n                    });\n                    $scope.answer.codes = $scope.rawCodeList;\n\n                    var url = EasyAssess.activeEnv['assess']() + 'form/' + $scope.esForm.id;\n                    $scope.esForm.status = \"S\";\n                    $scope.esForm.values = $scope.answer.values;\n                    $scope.esForm.codes = $scope.answer.codes;\n                    $scope.esForm.details = $scope.answer.details;\n                    $scope.esForm.signatures = $scope.answer.signatures;\n\n                    esRequestService.esPut(url, $scope.esForm).then(function(res){\n                        EasyAssess.QuickMessage.message(\"保存成功\");\n                    });\n                }\n            };\n\n            $scope.submit = function(){\n                ngDialog.openConfirm({\n                    template:   '<div class=\"ngdialog-message\">答案一旦提交无法修改,是否确定提交?</div>'\n                    + '<div align=\"right\"><button ng-click=\"confirm()\" class=\"btn btn-primary\">确定</button><button ng-click=\"closeThisDialog()\" class=\"btn btn-primary\">取消</button></div>',\n                    plain: true\n                }).then(\n                    function(){\n                        angular.forEach($scope.rawCodeList,function(rawCode){\n                            delete rawCode['codeGuid']\n                        });\n\n                        $scope.answer.codes = $scope.rawCodeList;\n\n\n                        if($scope.esType == 'plan'){\n                            $scope.$emit('submitted',{\"values\":$scope.answer.values,\"codes\":$scope.answer.codes, \"details\":$scope.answer.details, \"signatures\":$scope.answer.signatures});\n                        }else{\n                            var url = EasyAssess.activeEnv['assess']() + 'form/submit/' + $scope.esForm.id;\n                            esRequestService.esPut(url, {\"values\":$scope.answer.values,\"codes\":$scope.answer.codes,\"details\":$scope.answer.details, \"signatures\":$scope.answer.signatures}).then(function(res){\n                                $scope.$emit('submitted');\n                            });\n                        }\n                    }\n                );\n\n            };\n\n            $scope.rawCodeList = [];\n\n            $scope.$on('$codeItemLookup_selected',function(e, data, attrs){\n                var subjectGuid = attrs.subjectGuid;\n                var codeGroupGuid = attrs.codeGroupGuid\n\n                addCodeIntoList(e.targetScope, data, subjectGuid, codeGroupGuid);\n            });\n\n            $scope.$on('$tabSelected',function(e, ref, attrs){\n                if (ref==\"preView\") {\n                    $scope.previewModel = {\n                        values:$scope.answer.values,\n                        codes:$scope.rawCodeList,\n                        details:$scope.answer.details,\n                        signatures: $scope.answer.signatures\n                    };\n                } else {\n                    $scope.previewModel = null;\n                }\n            });\n\n            $scope.$on('removeSpecimen',function(e,data){\n                removeFromList(data);\n            });\n\n            $scope.$on(\"$rowguidLookup_selected\",function(e,data){\n            });\n\n            $scope.$on('valueChanged',function(e,data){\n                updateTheValueList(data);\n            });\n\n            $scope.$on('batchNumberChanged',function(e,data){\n                updateTheDetailList(data, 'batchNumber');\n            });\n\n            $scope.$on('expireChanged',function(e,data){\n                updateTheDetailList(data, 'expire');\n            });\n\n            $scope.$on('signatureChanged',function(e, data){\n                if (!$scope.answer.signatures[data.groupGuid]) {\n                    $scope.answer.signatures[data.groupGuid] = {};\n                }\n                $scope.answer.signatures[data.groupGuid][data.field] = data.value;\n            });\n\n            function updateTheDetailList(data, field) {\n                var exists = $scope.answer.details.find(function(detail){\n                   return detail.subjectGuid == data.subjectGuid;\n                });\n\n                if (exists) {\n                    exists[field] = data.value;\n                } else {\n                    var detail = {\n                        'subjectGuid': data.subjectGuid\n                    }\n                    detail[field] = data.value;\n                    $scope.answer.details.push(detail);\n                }\n            }\n\n            function updateTheValueList(data){\n                var updateCode = $scope.answer.values.find(function(item){\n                    return (item.subjectGuid === data.subjectGuid) && (item.specimenCode === data.specimenCode);\n                });\n\n                if (updateCode){\n                    updateCode.value = data.value\n                }else{\n                    $scope.answer.values.push(data);\n                }\n            }\n\n            function removeFromList(data){\n                $scope.answer.values = $scope.answer.values.filter(function(item){\n                    return item.specimenCode != data;\n                });\n            }\n\n            function addCodeIntoList(t, data, subjectGuid, codeGroupGuid){\n                var codeItem = {\n                    subject:{\n                        subject: t.esSubject.item.subject,\n                        unit: t.esSubject.item.unit\n                    },\n                    subjectGuid: t.esSubject.guid,\n                    codeNumber:data.codeNumber,\n                    codeName:data.name,\n                    codeGroup: {\n                        \"name\":data.group.name,\n                        \"id\":data.group.id,\n                        \"guid\":codeGroupGuid\n                    },\n                    codeGuid: t.esLookupGuid\n                };\n\n                var updatedItem = $scope.rawCodeList.find(function(item){\n                    return item.codeGuid  == codeItem.codeGuid\n                });\n\n                if(updatedItem){\n                    updatedItem.subject = codeItem.subject;\n                    updatedItem.subjectGuid = codeItem.subjectGuid;\n                    updatedItem.codeNumber = codeItem.codeNumber;\n                    updatedItem.codeName = codeItem.codeName;\n                    updatedItem.codeGroup = {\n                        \"name\": codeItem.codeGroup.name,\n                        \"id\": codeItem.codeGroup.id,\n                        \"guid\":codeGroupGuid\n                    }\n                }else{\n                    $scope.rawCodeList.push(codeItem);\n                }\n            }\n        }],\n\n    }\n});\n",
                "new_contents": "var EasyAssess = require('../../easyassess.application');\n\nEasyAssess.directives[\"esFormSubmit\"]\n    = EasyAssess.app.directive(\"esFormSubmit\", function (esRequestService,ngDialog,Upload) {\n    return {\n        restrict: 'E',\n        replace: true,\n        transclude: false,\n        template:'<div>'\n                     +'<es-form-page>'\n                         +'<div>'\n                            +'<button type=\"button\" class=\"btn btn-primary\" ng-click=\"submit()\">提交</button>'\n                            +'<button type=\"button\" class=\"btn btn-primary\" ng-click=\"manageAttachment()\">上传附件</button>'\n                            //+'<button ng-if=\"esType!=\\'plan\\'\" type=\"button\" class=\"btn btn-primary\" ng-click=\"save()\">保存</button>'\n                         +'</div>'\n                         +'<es-app-tab-pane>'\n                         + '<es-app-tab es-active=\"true\" es-ref=\"formView\" es-title=\"表单\">'\n                            +'<div class=\"es-page-section\">'\n                            +'<es-form-header es-header=\"formHeader\" es-editable=\"false\"></es-form-header>'\n                            +'</div>'\n                            +'<div style=\"position: relative\">'\n                            +'<div style=\"width: 100%; overflow-x:auto; overflow-y: visible;\">'\n                            +'<div ng-repeat=\"group in template.groups\" class=\"es-page-section\">'\n                            +'<es-form-group-edit es-type=\"{{esType}}\" es-group=\"group\" es-data=\"helpData\"></es-form-group-edit>'\n                            + '</div>'\n                            +'</div>'\n                            +   '<div style=\"padding: 10px 0px 10px 0px;\">'\n                            +      '<span class=\"es-form-group-title\">填报说明:</span>'\n                            +      '<es-form-footer ng-if=\"template\" es-editable=\"false\" es-footer=\"template.footer\"></es-form-footer>'\n                            +   '</div>'\n                            +'</div>'\n                         + '</es-app-tab>'\n                         + '<es-app-tab es-ref=\"preView\" es-title=\"预览\">'\n                         +    '<es-form-result ng-if=\"template && previewModel\" es-form=\"previewModel\" es-template=\"template\"></es-form-result>'\n                         + '</es-app-tab>'\n                        +'</es-app-tab-pane>'\n                     +'</es-form-page>'\n                 +'</div>',\n        scope: {\n            esForm: \"=\",\n            esType: \"@\"\n        },\n\n        controller: [\"$scope\",\"ngDialog\", function($scope,ngDialog){\n            if ($scope.esType == 'assess'){\n                var url = EasyAssess.activeEnv['assess']() + 'template/' + $scope.esForm.securedAssessment.templateGuid;\n                esRequestService.esGet(url).then(function(data){\n                    $scope.template = data.data;\n                });\n            }else if($scope.esType == 'plan'){\n                $scope.template = $scope.esForm.template;\n            }\n\n            $scope.formHeader = {\n                name:$scope.esForm.formName\n            };\n            \n            if ($scope.esType =='assess'){\n                $scope.helpData =  $scope.esForm.securedAssessment.id;\n            }else{\n                $scope.helpData = null;\n            }\n\n            $scope.manageAttachment = function () {\n                ngDialog.open({\n                    template: '<div style=\"padding: 10px 10px 10px 10px;\">'\n                            +\t'<div class=\"es-dialog-form-line\">'\n                            +  '<span style=\"color: #9d261d;\">注意: 每个表单只能上传一个附件，重复上传会相互覆盖</span>'\n                            +  '</div>'\n                             +\t'<div class=\"es-dialog-form-line\">'\n                             +      '<a href=\"javascript:void(0)\" class=\"button\" ngf-select ng-model=\"file\" name=\"file\" ngf-max-size=\"20MB\" ngf-min-height=\"100\">选择文件</a>'\n                             +      '<a ng-if=\"attachment\" href=\"{{attachment}}\" style=\"padding-left: 20px;\">查看附件</a>'\n                             +  '</div>'\n\n                             +\t'<div class=\"es-dialog-form-line\">'\n                             +      '<button type=\"submit\" class=\"btn btn-primary\" ng-click=\"submit()\">上传</button>'\n                             +  '</div>'\n                             + '</div>',\n                    plain: true,\n                    controller: ['$scope', function ($dialogScope) {\n                        $dialogScope.attachment = $scope.esForm.attachment;\n                        $dialogScope.submit = function () {\n                            if (!$dialogScope.file) {\n                                EasyAssess.QuickMessage.error(\"请选择文件\");\n                            } else {\n                                $dialogScope.upload($dialogScope.file);\n                            }\n                        };\n\n                        $dialogScope.upload = function (file) {\n                            $dialogScope.fileInfo = file;\n                            Upload.upload({\n                                url: EasyAssess.activeEnv['assess']() + 'form/' + $scope.esForm.id + \"/attachment\",\n                                data: {\n                                    'attachment': file\n                                },\n                                withCredentials: true\n                            }).success(function (data, status, headers, config) {\n                                $scope.esForm.attachment = data.data;\n                                $dialogScope.attachment = data.data;\n                                EasyAssess.QuickMessage.message(\"上传成功\");\n                                $dialogScope.closeThisDialog();\n                            }).error(function (data, status, headers, config) {\n                                EasyAssess.QuickMessage.error(\"上传失败\");\n                            });\n                        };\n                    }]\n                });\n            };\n            \n            $scope.answer = {\n                values:[],\n                codes:[],\n                details:[],\n                signatures: {}\n            };\n\n            $scope.save = function(){\n                if($scope.esType != 'plan'){\n                    angular.forEach($scope.rawCodeList,function(rawCode){\n                        delete rawCode['codeGuid']\n                    });\n                    $scope.answer.codes = $scope.rawCodeList;\n\n                    var url = EasyAssess.activeEnv['assess']() + 'form/' + $scope.esForm.id;\n                    $scope.esForm.status = \"S\";\n                    $scope.esForm.values = $scope.answer.values;\n                    $scope.esForm.codes = $scope.answer.codes;\n                    $scope.esForm.details = $scope.answer.details;\n                    $scope.esForm.signatures = $scope.answer.signatures;\n\n                    esRequestService.esPut(url, $scope.esForm).then(function(res){\n                        EasyAssess.QuickMessage.message(\"保存成功\");\n                    });\n                }\n            };\n\n            $scope.submit = function(){\n                ngDialog.openConfirm({\n                    template:   '<div class=\"ngdialog-message\">答案一旦提交无法修改,是否确定提交?</div>'\n                    + '<div align=\"right\"><button ng-click=\"confirm()\" class=\"btn btn-primary\">确定</button><button ng-click=\"closeThisDialog()\" class=\"btn btn-primary\">取消</button></div>',\n                    plain: true\n                }).then(\n                    function(){\n                        angular.forEach($scope.rawCodeList,function(rawCode){\n                            delete rawCode['codeGuid']\n                        });\n\n                        $scope.answer.codes = $scope.rawCodeList;\n\n\n                        if($scope.esType == 'plan'){\n                            $scope.$emit('submitted',{\"values\":$scope.answer.values,\"codes\":$scope.answer.codes, \"details\":$scope.answer.details, \"signatures\":$scope.answer.signatures});\n                        }else{\n                            var url = EasyAssess.activeEnv['assess']() + 'form/submit/' + $scope.esForm.id;\n                            esRequestService.esPut(url, {\"values\":$scope.answer.values,\"codes\":$scope.answer.codes,\"details\":$scope.answer.details, \"signatures\":$scope.answer.signatures}).then(function(res){\n                                $scope.$emit('submitted');\n                            });\n                        }\n                    }\n                );\n\n            };\n\n            $scope.rawCodeList = [];\n\n            $scope.$on('$codeItemLookup_selected',function(e, data, attrs){\n                var subjectGuid = attrs.subjectGuid;\n                var codeGroupGuid = attrs.codeGroupGuid\n\n                addCodeIntoList(e.targetScope, data, subjectGuid, codeGroupGuid);\n            });\n\n            $scope.$on('$tabSelected',function(e, ref, attrs){\n                if (ref==\"preView\") {\n                    $scope.previewModel = {\n                        values:$scope.answer.values,\n                        codes:$scope.rawCodeList,\n                        details:$scope.answer.details,\n                        signatures: $scope.answer.signatures\n                    };\n                } else {\n                    $scope.previewModel = null;\n                }\n            });\n\n            $scope.$on('removeSpecimen',function(e,data){\n                removeFromList(data);\n            });\n\n            $scope.$on(\"$rowguidLookup_selected\",function(e,data){\n            });\n\n            $scope.$on('valueChanged',function(e,data){\n                updateTheValueList(data);\n            });\n\n            $scope.$on('batchNumberChanged',function(e,data){\n                updateTheDetailList(data, 'batchNumber');\n            });\n\n            $scope.$on('expireChanged',function(e,data){\n                updateTheDetailList(data, 'expire');\n            });\n\n            $scope.$on('signatureChanged',function(e, data){\n                if (!$scope.answer.signatures[data.groupGuid]) {\n                    $scope.answer.signatures[data.groupGuid] = {};\n                }\n                $scope.answer.signatures[data.groupGuid][data.field] = data.value;\n            });\n\n            function updateTheDetailList(data, field) {\n                var exists = $scope.answer.details.find(function(detail){\n                   return detail.subjectGuid == data.subjectGuid;\n                });\n\n                if (exists) {\n                    exists[field] = data.value;\n                } else {\n                    var detail = {\n                        'subjectGuid': data.subjectGuid\n                    }\n                    detail[field] = data.value;\n                    $scope.answer.details.push(detail);\n                }\n            }\n\n            function updateTheValueList(data){\n                var updateCode = $scope.answer.values.find(function(item){\n                    return (item.subjectGuid === data.subjectGuid) && (item.specimenCode === data.specimenCode);\n                });\n\n                if (updateCode){\n                    updateCode.value = data.value\n                }else{\n                    $scope.answer.values.push(data);\n                }\n            }\n\n            function removeFromList(data){\n                $scope.answer.values = $scope.answer.values.filter(function(item){\n                    return item.specimenCode != data;\n                });\n            }\n\n            function addCodeIntoList(t, data, subjectGuid, codeGroupGuid){\n                var codeItem = {\n                    subject:{\n                        subject: t.esSubject.item.subject,\n                        unit: t.esSubject.item.unit\n                    },\n                    subjectGuid: t.esSubject.guid,\n                    codeNumber:data.codeNumber,\n                    codeName:data.name,\n                    codeGroup: {\n                        \"name\":data.group.name,\n                        \"id\":data.group.id,\n                        \"guid\":codeGroupGuid\n                    },\n                    codeGuid: t.esLookupGuid\n                };\n\n                var updatedItem = $scope.rawCodeList.find(function(item){\n                    return item.codeGuid  == codeItem.codeGuid\n                });\n\n                if(updatedItem){\n                    updatedItem.subject = codeItem.subject;\n                    updatedItem.subjectGuid = codeItem.subjectGuid;\n                    updatedItem.codeNumber = codeItem.codeNumber;\n                    updatedItem.codeName = codeItem.codeName;\n                    updatedItem.codeGroup = {\n                        \"name\": codeItem.codeGroup.name,\n                        \"id\": codeItem.codeGroup.id,\n                        \"guid\":codeGroupGuid\n                    }\n                }else{\n                    $scope.rawCodeList.push(codeItem);\n                }\n            }\n        }],\n\n    }\n});\n",
                "subject": "Fixed wrong attahment url",
                "message": "Fixed wrong attahment url\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "EasyAssessSystem/web-ui,EasyAssessSystem/web-ui,EasyAssessSystem/web-ui,EasyAssessSystem/web-ui"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10284,
            "row": {
                "commit": "6afbc2b3f0fd302bc859cc259d9b2915507b3137",
                "old_file": "client/src/reducers/index.js",
                "new_file": "client/src/reducers/index.js",
                "old_contents": "import { combineReducers } from 'redux';\nimport { routerReducer } from 'react-router-redux';\nimport { auth } from './auth';\nimport { listing } from './listing';\nimport { listings } from './listings';\n\nexport default combineReducers({\n  auth,\n  listing,\n  listings,\n  routing: routerReducer,\n});\n\n",
                "new_contents": "import { combineReducers } from 'redux';\nimport { routerReducer } from 'react-router-redux';\nimport { auth } from './auth';\nimport { listing } from './listing';\nimport { listings } from './listings';\nimport ratings from '../components/Ratings/reducers';\n\nexport default combineReducers({\n  auth,\n  listing,\n  listings,\n  ratings,\n  routing: routerReducer,\n});\n\n",
                "subject": "Add ratings to combineReducers",
                "message": "Add ratings to combineReducers\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "Darkrender/raptor-ads,Velocies/raptor-ads,Velocies/raptor-ads,bwuphan/raptor-ads,Darkrender/raptor-ads,bwuphan/raptor-ads,wolnewitz/raptor-ads,wolnewitz/raptor-ads"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10285,
            "row": {
                "commit": "ca37e5256245097bd80c900f0e55e7c75e60d643",
                "old_file": "js/mlj/core/Scene.js",
                "new_file": "js/mlj/core/Scene.js",
                "old_contents": "/**\n * MLJLib\n * MeshLabJS Library\n * \n * Copyright(C) 2015\n * Paolo Cignoni \n * Visual Computing Lab\n * ISTI - CNR\n * \n * All rights reserved.\n *\n * This program is free software; you can redistribute it and/or modify it under \n * the terms of the GNU General Public License as published by the Free Software \n * Foundation; either version 2 of the License, or (at your option) any later \n * version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT \n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS \n * FOR A PARTICULAR PURPOSE. See theGNU General Public License \n * (http://www.gnu.org/licenses/gpl.txt) for more details.\n * \n */\n\n/**\n * @file \n *\n * @author Stefano Gabriele\n */\n\n/**\n * The MLJ.core.Scene namespace defines the functions to manage the scene, \n * i.e. the set of mesh layers that constitute the ''document'' of the MeshLabJS system.\n * This namespace also actually stores the set of meshes, the reference to current mesh, \n * the threejs container for the scene, the threejs camera and the threejs renderer \n * (e.g. the webgl context where the scene is rendered).\n *\n * @namespace MLJ.core.Scene\n * @memberOf MLJ.core\n * @author Stefano Gabriele\n *\n */\nMLJ.core.Scene = {};\n\n(function () {\n\n    /**\n     * Associative Array that contains all the meshes in the scene \n     * @type MLJ.util.AssociativeArray\n     * @memberOf MLJ.core.Scene     \n     */\n    var _layers = new MLJ.util.AssociativeArray();\n\n    /**\n     * Associative array that contains all the scene level \"background\" \n     * decorators (axes, background grid etc..)\n     * @type MLJ.util.AssociativeArray\n     * @memberOf MLJ.core.Scene\n     */\n    var _decorators = new MLJ.util.AssociativeArray();\n\n    /**\n     * Associative array that contains all the currently active post process\n     * rendering passes. For details see {@link MLJ.core.Scene.addPostProcessPass}.\n     * @type MLJ.util.AssociativeArray\n     * @memberOf MLJ.core.Scene\n     */\n    var _postProcessPasses = new MLJ.util.AssociativeArray();\n\n    /**\n     * Reference to current layer \n     * @type MLJ.core.Layer\n     * @memberOf MLJ.core.Scene     \n     */\n    var _selectedLayer;\n\n    /**\n     * It contains the ThreeJs Representation of the current set of layers. \n     * Each Layer is associated to a ThreeJS mesh whose contained in the MLJ.core.MeshFile object.\n     * @type THREE.Scene\n     * @memberOf MLJ.core.Scene     \n     */\n    var _scene;\n    \n    /**\n     * The ThreeJs group that contains all the layers. \n     * It also store the global transformation (scale + translation) \n     * that brings the global bbox of the scene\n     * in the origin of the camera reference system. \n     * @type THREE.Object\n     * @memberOf MLJ.core.Scene     \n     */\n    var _group;\n    \n    var _camera;\n\n    /**\n     * This scene contains 2D overlays that are drawn on top of everything else\n     * @memberOf MLJ.core.Scene     \n     */\n    var _scene2D;\n    \n    /**\n     * \"Fake\" camera object passed to the renderer when rendering the <code>_scene2D</code>\n     */\n    var _camera2D;\n\n    var _stats;\n    var _controls;\n    \n    /// @type {Object}\n    var _renderer;\n    var _this = this;\n\n    function get3DSize() {\n        var _3D = $('#_3D');\n\n        return {\n            width: _3D.innerWidth (),\n            height: _3D.innerHeight()\n        };\n    }\n\n    function initDragAndDrop() {\n        function FileDragHandler(e) {\n            e.stopPropagation();\n            e.preventDefault();\n            var files = e.target.files || e.dataTransfer.files;\n            MLJ.core.File.openMeshFile(files);\n        }\n\n        function FileDragHover(e) {\n            e.stopPropagation();\n            e.preventDefault();\n        }\n\n        $(window).ready(function () {\n            var ddd = document.getElementById(\"_3D\");\n            ddd.addEventListener(\"dragover\", FileDragHover, false);\n            ddd.addEventListener(\"dragleave\", FileDragHover, false);\n            ddd.addEventListener(\"drop\", FileDragHandler, false);\n        });\n    }\n\n    function initStats() {\n\n        var stats = new Stats();\n\n        stats.setMode(0); // 0: fps, 1: ms\n        stats.active = false;\n\n        // Align top-right\n        stats.domElement.style.visibility = 'hidden';\n        stats.domElement.style.position = 'absolute';\n        stats.domElement.style.right = '0px';\n        stats.domElement.style.top = '0px';\n        stats.domElement.style.zIndex = 100;\n\n        $(\"#_3D\").append( stats.domElement );\n\n        return stats;\n    }\n\n//SCENE INITIALIZATION  ________________________________________________________\n\n    function initScene() {\n        var _3DSize = get3DSize();\n\n        _scene = new THREE.Scene();\n        _camera = new THREE.PerspectiveCamera(45, _3DSize.width / _3DSize.height, 0.1, 1800);\n        _camera.position.z = 15;\n        _group = new THREE.Object3D();\n        _scene.add(_group);\n\n        _scene2D = new THREE.Scene();\n        _camera2D = new THREE.OrthographicCamera(0 , _3DSize.width / _3DSize.height, 1, 0, -1, 1);\n        _camera2D.position.z = -1;\n\n        _renderer = new THREE.WebGLRenderer({ \n            antialias: true, \n            alpha: true, \n            preserveDrawingBuffer:true});\n        //_renderer.shadowMapEnabled = true;\n        //_renderer.context.getSupportedExtensions();\n        _renderer.context.getExtension(\"EXT_frag_depth\");\n\n        \n        _renderer.setPixelRatio( window.devicePixelRatio );\n        _renderer.setSize(_3DSize.width, _3DSize.height);\n        $('#_3D').append(_renderer.domElement);\n        _scene.add(_camera);\n\n        _stats = initStats();\n        /*\n        requestAnimationFrame(function updateStats() {\n                                _stats.update();\n                                requestAnimationFrame(updateStats); });\n        */\n\n        //INIT CONTROLS\n        var container = document.getElementsByTagName('canvas')[0];\n        _controls = new THREE.TrackballControls(_camera, container);\n        _controls.rotateSpeed = 4.0;\n        _controls.zoomSpeed = 1.2;\n        _controls.panSpeed = 2.0;\n        _controls.noZoom = false;\n        _controls.noPan = false;\n        _controls.staticMoving = true;\n        _controls.dynamicDampingFactor = 0.3;\n        _controls.keys = [65, 83, 68];\n        \n        $(document).keydown(function(event) {           \n            if((event.ctrlKey || (event.metaKey && event.shiftKey)) && event.which === 72) {\n                event.preventDefault();\n                _controls.reset();\n            }\n        });\n        \n        //INIT LIGHTS \n        _this.lights.AmbientLight = new MLJ.core.AmbientLight(_scene, _camera, _renderer);\n        _this.lights.Headlight = new MLJ.core.Headlight(_scene, _camera, _renderer);\n\n        //EVENT HANDLERS\n        var $canvas = $('canvas')[0];\n        $canvas.addEventListener('touchmove', _controls.update.bind(_controls), false);\n        $canvas.addEventListener('mousemove', _controls.update.bind(_controls), false);        \n        $canvas.addEventListener('mousewheel', _controls.update.bind(_controls), false);        \n        $canvas.addEventListener('DOMMouseScroll', _controls.update.bind(_controls), false ); // firefox\n        \n        _controls.addEventListener('change', function () {            \n            MLJ.core.Scene.render();\n            $($canvas).trigger('onControlsChange');\n        });\n\n        $(window).resize(function () {\n            var size = get3DSize();\n\n            _camera.aspect = size.width / size.height;\n            _camera.updateProjectionMatrix();\n            _renderer.setSize(size.width, size.height);\n\n\n            colorBuffer.setSize(size.width, size.height);\n            targetBuffer.setSize(size.width, size.height);\n\n            _camera2D.left = size.width / size.height;\n            _camera2D.updateProjectionMatrix;\n\n            MLJ.core.Scene.render();\n        });\n\n        $(document).on(\"MeshFileOpened\",\n                function (event, layer) {\n                    MLJ.core.Scene.addLayer(layer);\n                });\n\n        $(document).on(\"MeshFileReloaded\",\n                function (event, layer) {\n                    \n                    // Restore three geometry to reflect the new state of the vcg mesh\n                    layer.updateThreeMesh();\n\n                    /**\n                     *  Triggered when a layer is reloaded\n                     *  @event MLJ.core.Scene#SceneLayerReloaded\n                     *  @type {Object}\n                     *  @property {MLJ.core.Layer} layer The reloaded mesh file\n                     *  @example\n                     *  <caption>Event Interception:</caption>\n                     *  $(document).on(\"SceneLayerReloaded\",\n                     *      function (event, layer) {\n                     *          //do something\n                     *      }\n                     *  );\n                     */                    \n                    $(document).trigger(\"SceneLayerReloaded\", [layer]);\n                });\n    }\n    \n    /* Compute global bounding box and translate and scale every object in proportion \n     * of global bounding box. First translate every object into original position, \n     * then scale all by reciprocal value of scale factor (note that scale factor \n     * and original position are stored into mesh object). Then it computes \n     * global bbox, scale every object, recalculate global bbox and finally\n     * translate every object in a right position.\n     */\n    function _computeGlobalBBbox()\n    {\n        var BBGlobal;\n        if (_layers.size() === 0) // map to the canonical cube\n            BBGlobal = new THREE.Box3(new THREE.Vector3(-1,-1,-1), new THREE.Vector3(1,1,1));\n        else {\n            BBGlobal = new THREE.Box3(); // map to the layers' boxes union\n            iter = _layers.iterator();\n            while (iter.hasNext()) {\n                threeMesh = iter.next().getThreeMesh();\n                var bbox = new THREE.Box3().setFromObject(threeMesh);\n                BBGlobal.union(bbox);\n            }\n        }\n        var scaleFac = 15.0 / (BBGlobal.min.distanceTo(BBGlobal.max));\n        var offset = BBGlobal.center().negate();;\n        _group.scale.set(scaleFac,scaleFac,scaleFac);\n        _group.position.set(offset.x*scaleFac,offset.y*scaleFac,offset.z*scaleFac);\n        _group.updateMatrix();\n//        console.log(\"Position:\" + offset.x +\" \"+ offset.y +\" \"+ offset.z );\n//        console.log(\"ScaleFactor:\" + scaleFac);\n        return BBGlobal;\n    }\n\n    this.getBBox = function () {\n        return _computeGlobalBBbox();\n    }\n  \n    this.lights = {\n        AmbientLight: null,\n        Headlight: null\n    };\n    \n    this.getCamera = function() {\n        return _camera;\n    };\n\n    this.getStats = function() {\n        return _stats;\n    }\n\n    this.getThreeJsGroup = function() {\n        return _group;\n    }\n\n    /**\n     * Selects the layer with the name <code>layerName</code>\n     * @param {String} layerName The name of the layer\n     * @memberOf MLJ.core.Scene     \n     * @author Stefano Gabriele\n     */\n    this.selectLayerByName = function (layerName) {\n        _selectedLayer = _layers.getByKey(layerName);\n        /**\n         *  Triggered when a layer is selected\n         *  @event MLJ.core.Scene#SceneLayerSelected\n         *  @type {Object}\n         *  @property {MLJ.core.Layer} layer The selected mesh file\n         *  @example\n         *  <caption>Event Interception:</caption>\n         *  $(document).on(\"SceneLayerSelected\",\n         *      function (event, layer) {\n         *          //do something\n         *      }\n         *  );\n         */\n        $(document).trigger(\"SceneLayerSelected\", [_selectedLayer]);        \n    };\n\n    /**\n     * Sets the visibility of layer with the name <code>layerName</code>\n     * @param {String} layerName The name of the layer\n     * @param {Boolean} visible <code>true</code> if the layers must be visible,\n     * <code>false</code> otherwise\n     * @memberOf MLJ.core.Scene     \n     * @author Stefano Gabriele\n     */\n    this.setLayerVisible = function (layerName, visible) {\n        var layer = _layers.getByKey(layerName);\n        layer.getThreeMesh().visible = visible;\n        \n        var iter = layer.overlays.iterator();\n        \n        while(iter.hasNext()) {\n            iter.next().visible = visible;\n        }\n\n        // if histogram overlay is defined show/hide labels\n        if (layer.__mlj_histogram) {\n            if (visible) layer.__mlj_histogram.show();\n            else layer.__mlj_histogram.hide();\n        }\n        \n        MLJ.core.Scene.render();\n    };\n\n    /**\n     * Adds a new layer in the scene\n     * @param {MLJ.core.Layer} layer The mesh file to add\n     * @memberOf MLJ.core.Scene     \n     * @author Stefano Gabriele\n     */\n    this.addLayer = function (layer) {\n        if (!(layer instanceof MLJ.core.Layer)) {\n            console.error(\"The parameter must be an instance of MLJ.core.MeshFile\");\n            return;\n        }\n        \n        // Initialize the THREE geometry used by overlays and rendering params\n        layer.initializeRenderingAttributes();\n        _group.add(layer.getThreeMesh());\n\n        //Add new mesh to associative array _layers            \n        _layers.set(layer.name, layer);\n        _selectedLayer = layer;\n\n        _computeGlobalBBbox();              \n\n        /**\n         *  Triggered when a layer is added\n         *  @event MLJ.core.Scene#SceneLayerAdded\n         *  @type {Object}\n         *  @property {MLJ.core.Layer} layer The last mesh file added\n         *  @property {Integer} layersNumber The number of layers in the scene\n         *  @example\n         *  <caption>Event Interception:</caption>\n         *  $(document).on(\"SceneLayerAdded\",\n         *      function (event, layer, layersNumber) {\n         *          //do something\n         *      }\n         *  );\n         */\n        $(document).trigger(\"SceneLayerAdded\", [layer, _layers.size()]);\n        \n        //render the scene\n        _this.render();\n    };       \n    \n    this.addOverlayLayer = function(layer, name, mesh, overlay2D) {\n        if(!(mesh instanceof THREE.Object3D)) {\n            console.warn(\"mesh parameter must be an instance of THREE.Object3D\");\n            return;\n        }\n        \n        layer.overlays.set(name,mesh);\n\n        mesh.visible = layer.getThreeMesh().visible;\n        if (overlay2D) {\n            _scene2D.add(mesh);\n        } else {\n//            _group.add(mesh);\n            layer.getThreeMesh().add(mesh);\n        }\n\n        _this.render();\n    };\n\n    function disposeObject(obj) {\n        if (obj.geometry) obj.geometry.dispose();\n        if (obj.material) obj.material.dispose();\n        if (obj.texture) obj.texture.dispose();\n    }\n    \n    this.removeOverlayLayer = function(layer, name, overlay2D) {        \n        var mesh = layer.overlays.getByKey(name);\n\n        if (mesh !== undefined) {\n            mesh = layer.overlays.remove(name);      \n\n            if (overlay2D) {\n                _scene2D.remove(mesh);                        \n            } else {\n                layer.getThreeMesh().remove(mesh);   \n//                _group.remove(mesh);                        \n            }\n\n            mesh.traverse(disposeObject);\n            disposeObject(mesh);\n\n            _this.render();                              \n        }\n    };  \n\n    /**\n     * Updates a layer. This function should be called if the <code>layer</code>\n     * geometry or properties was modified.\n     * @param {MLJ.core.Layer} layer The mesh file corresponding to the level\n     * @memberOf MLJ.core.Scene\n     * @author Stefano Gabriele\n     * @example\n     * //Apply Laplacian smooth filter\n     * Module.LaplacianSmooth(layer.ptrMesh, 1, false);\n     * //The filter has changed mesh geometry ...\n     * scene.updateLayer(layer);\n     */\n    this.updateLayer = function (layer) {\n        if (layer instanceof MLJ.core.Layer) {\n\n            if (_layers.getByKey(layer.name) === undefined) {\n                console.warn(\"Trying to update a layer not in the scene.\");\n                return;\n            }\n\n            layer.updateThreeMesh();\n            _computeGlobalBBbox();\n\n            //render the scene\n            this.render();\n\n            /**\n             *  Triggered when a layer is updated\n             *  @event MLJ.core.Scene#SceneLayerUpdated\n             *  @type {Object}\n             *  @property {MLJ.core.Layer} layer The updated mesh file\n             *  @example\n             *  <caption>Event Interception:</caption>\n             *  $(document).on(\"SceneLayerUpdated\",\n             *      function (event, layer) {\n             *          //do something\n             *      }\n             *  );\n             */\n            $(document).trigger(\"SceneLayerUpdated\", [layer]);\n\n        } else {\n            console.error(\"The parameter must be an instance of MLJ.core.Layer\");\n        }\n    };\n\n    /**\n     * Returns the layer corresponding to the given name\n     * @param {String} name The name of the layer     \n     * @memberOf MLJ.core.Scene\n     * @return {MLJ.core.Layer} The layer corresponding to the given name\n     * @author Stefano Gabriele     \n     */\n    this.getLayerByName = function (name) {\n        return _layers.getByKey(name);\n    };\n\n    function disambiguateName(meshName) {\n        var prefix, ext;\n        var ptIndex = meshName.lastIndexOf('.');\n        if (ptIndex > 0) {\n            prefix = meshName.substr(0, ptIndex);\n            ext = meshName.substr(ptIndex);\n        } else {\n            prefix = meshName;\n            ext = \"\";\n        }\n\n        if (/\\[(\\d+)\\]$/.test(prefix)) {\n            prefix = prefix.substr(0, prefix.lastIndexOf(\"[\"));\n        }\n\n        var maxNumTag = 0;\n        while (true) {\n            var collision = false;\n            var layerIterator = MLJ.core.Scene.getLayers().iterator();\n            while (layerIterator.hasNext() && !collision) {\n                if (meshName === layerIterator.next().name) collision = true;\n            }\n            if (collision) meshName = prefix + \"[\" + ++maxNumTag + \"]\" + ext;\n            else break;\n        }\n        return meshName;\n    }\n\n    \n    /**\n     * Creates a new mesh file using the c++ functions bound to JavaScript\n     * @param {String} name The name of the new mesh file\n     * @memberOf MLJ.core.File\n     * @returns {MLJ.core.Layer} The new layer\n     * @author Stefano Gabriele\n     */\n    this.createLayer = function (name) {\n        var layerName = disambiguateName(name);\n        var layer = new MLJ.core.Layer(layerName, new Module.CppMesh());\n        return layer;\n    };\n    \n    /**\n     * Removes the layer corresponding to the given name\n     * @param {String} name The name of the layer which must be removed  \n     * @memberOf MLJ.core.Scene     \n     * @author Stefano Gabriele     \n     */\n    this.removeLayerByName = function (name) {\n        var layer = this.getLayerByName(name);\n        \n        if (layer !== undefined) {\n            //remove layer from list\n            _layers.remove(name);\n                                                \n            $(document).trigger(\"SceneLayerRemoved\", [layer, _layers.size()]);\n            \n            layer.dispose();\n                      \n            if(_layers.size() > 0) {\n                _this.selectLayerByName(_layers.getFirst().name);\n            } else {\n                _this._selectedLayer = undefined;\n            }\n            \n            _computeGlobalBBbox();\n           \n            \n            MLJ.core.Scene.render(); \n        }\n    };\n\n    /**\n     * Adds a scene decorator. A scene decorator differs fron an overlay layer in\n     * that it's not tied to a particular layer, but to the scene as a whole (for\n     * example an axes descriptor that highlights the direction of the x, y, and z\n     * coordinates).\n     * @param {String} name - The name of the decorator\n     * @param {THREE.Object3D} decorator - The decorator object\n     * @memberOf MLJ.core.Scene\n     */\n    this.addSceneDecorator = function(name, decorator) {\n        if(!(decorator instanceof THREE.Object3D)) {\n            console.warn(\"MLJ.core.Scene.addSceneDecorator(): decorator parameter not an instance of THREE.Object3D\");\n            return;\n        }\n\n        _decorators.set(name, decorator)\n        _group.add(decorator);\n\n        _this.render();\n    };\n\n    /**\n     * Removes a decorator object from the scene.\n     * @param {String} name - The name of the decorator to remove\n     * @memberOf MLJ.core.Scene\n     */\n    this.removeSceneDecorator = function(name) {\n        var decorator = _decorators.getByKey(name)\n\n        if (decorator !== undefined) {\n            _decorators.remove(name);\n            _group.remove(decorator);\n            decorator.geometry.dispose();\n            decorator.material.dispose();  \n        } else {\n            console.warn(\"Warning: \" + name + \" decorator not in the scene\");\n        }\n\n        //render the scene\n        _this.render();\n    };\n\n    /**\n     * Returns the currently selected layer     \n     * @returns {MLJ.core.Layer} The currently selected layer\n     * @memberOf MLJ.core.Scene\n     * @author Stefano Gabriele     \n     */\n    this.getSelectedLayer = function () {\n        return _selectedLayer;\n    };\n\n    /**\n     * Returns the layers list\n     * @returns {MLJ.util.AssociativeArray} The layers list\n     * @memberOf MLJ.core.Scene\n     * @author Stefano Gabriele     \n     */\n    this.getLayers = function () {\n        return _layers;\n    };\n\n    this.get3DSize = function() { return get3DSize(); };\n    this.getRenderer = function() { return _renderer; };\n\n    this.getScene = function () {return _scene;};\n\n    /**\n     * Adds a post process pass to the rendering chain. As of now the interface\n     * to post process effects is minimal: an effect is simply a callable object\n     * that must accept two render buffers as parameters. The first buffer \n     * contains the color generated by the rendering chain of MeshLabJS up to\n     * the effect invocation, (this includes the basic scene rendering plus the\n     * result of any post process effect that was applied before the current\n     * one). The second buffer must be used as the render target of the pass,\n     * will be forwarded as input to the next effect, or will be transfered to\n     * the canvas if no other effects are active. Both buffers have the same\n     * size as the page canvas. Any other information that may be needed by an\n     * effect must be passed with closure variables or queried directly to\n     * {@link MLJ.core.Scene}. \n     *\n     * @param {String} name - The name of the pass\n     * @param {Object} pass - The callable (function) object that will apply the pass\n     * @memberOf MLJ.core.Scene\n     */\n    this.addPostProcessPass = function (name, pass) {\n        if(!jQuery.isFunction(pass)) {\n            console.warn(\"MLJ.core.Scene.addPostProcessPass(): pass parameter must be callable\");\n            return;\n        }\n        _postProcessPasses.set(name, pass);\n    }\n\n    /**\n     * Removes a post process effect from the rendering chain.\n     * @param {String} name - The name of the pass to remove\n     * @memberOf MLJ.core.Scene\n     */\n    this.removePostProcessPass = function (name) {\n        var pass = _postProcessPasses.remove(name);\n        if (pass == undefined) {\n            console.warn(\"Warning: \" + name + \" pass not enabled\");\n        }\n\n        _this.render();\n    }\n\n    var colorBuffer = new THREE.WebGLRenderTarget(0, 0, {\n        type: THREE.FloatType,\n        minFilter: THREE.NearestFilter\n    });\n    var targetBuffer = new THREE.WebGLRenderTarget(0, 0, {\n        type: THREE.FloatType,\n        minFilter: THREE.NearestFilter\n    });\n\n    var plane = new THREE.PlaneBufferGeometry(2, 2);\n    var quadMesh = new THREE.Mesh(\n        plane\n    );\n\n    var quadScene = new THREE.Scene();\n    quadScene.add(quadMesh);\n\n    quadMesh.material = new THREE.ShaderMaterial({\n        vertexShader:\n            \"varying vec2 vUv; \\\n             void main(void) \\\n             { \\\n                 vUv = uv; \\\n                 gl_Position = vec4(position.xyz, 1.0); \\\n             }\",\n        fragmentShader: \n            \"uniform sampler2D offscreen; \\\n             varying vec2 vUv; \\\n             void main(void) { gl_FragColor = texture2D(offscreen, vUv.xy); }\"\n    });\n    quadMesh.material.uniforms = {\n            offscreen: { type: \"t\", value: null }\n    };\n    \n\n    /**\n     * Renders the scene. If there are no post process effects enabled, the \n     * THREE.js scene that contains all the scene decorators and the overlay\n     * layers is rendered straight to the canvas. Otherwise, the basic scene is \n     * rendered to an off screen render target, and post process effects are\n     * applied one after the other (according to the user's activation order)\n     * before displaying the result.\n     * @memberOf MLJ.core.Scene  \n     */\n    this.render = function (fromReqAnimFrame) {\n\n        if (_stats.active && !fromReqAnimFrame) {\n            return;\n        }\n\n        if (_postProcessPasses.size() > 0) {\n            _renderer.render(_scene, _camera, colorBuffer, true);\n\n            var it = _postProcessPasses.iterator();\n\n            while (it.hasNext()) {\n                var pass = it.next();\n                pass(colorBuffer, targetBuffer);\n                // Swap rendering targets for the next pass\n                var tmp = colorBuffer;\n                colorBuffer = targetBuffer;\n                targetBuffer = tmp;\n            }\n\n            // final pass, render colorBuffer to the screen\n            quadMesh.material.uniforms.offscreen.value = colorBuffer;\n            _renderer.render(quadScene, _camera2D);\n        } else {\n            _renderer.render(_scene, _camera);\n        }\n\n        // render the 2D overlays\n        _renderer.autoClear = false;\n        _renderer.render(_scene2D, _camera2D);\n        _renderer.autoClear = true;\n    };\n\n\n\n    this.takeSnapshot = function() {\n        var canvas = _renderer.context.canvas;        \n        // draw to canvas...\n        canvas.toBlob(function(blob) {\n            saveAs(blob, \"snapshot.png\");\n        });\n    };\n    \n    this.resetTrackball = function() {\n        _controls.reset();\n    };\n    \n    \n    //INIT\n    $(window).ready(function () {\n        initScene();\n        initDragAndDrop();\n    });\n\n}).call(MLJ.core.Scene);\n",
                "new_contents": "/**\n * MLJLib\n * MeshLabJS Library\n * \n * Copyright(C) 2015\n * Paolo Cignoni \n * Visual Computing Lab\n * ISTI - CNR\n * \n * All rights reserved.\n *\n * This program is free software; you can redistribute it and/or modify it under \n * the terms of the GNU General Public License as published by the Free Software \n * Foundation; either version 2 of the License, or (at your option) any later \n * version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT \n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS \n * FOR A PARTICULAR PURPOSE. See theGNU General Public License \n * (http://www.gnu.org/licenses/gpl.txt) for more details.\n * \n */\n\n/**\n * @file \n *\n * @author Stefano Gabriele\n */\n\n/**\n * The MLJ.core.Scene namespace defines the functions to manage the scene, \n * i.e. the set of mesh layers that constitute the ''document'' of the MeshLabJS system.\n * This namespace also actually stores the set of meshes, the reference to current mesh, \n * the threejs container for the scene, the threejs camera and the threejs renderer \n * (e.g. the webgl context where the scene is rendered).\n *\n * @namespace MLJ.core.Scene\n * @memberOf MLJ.core\n * @author Stefano Gabriele\n *\n */\nMLJ.core.Scene = {};\n\n(function () {\n\n    /**\n     * Associative Array that contains all the meshes in the scene \n     * @type MLJ.util.AssociativeArray\n     * @memberOf MLJ.core.Scene     \n     */\n    var _layers = new MLJ.util.AssociativeArray();\n\n    /**\n     * Associative array that contains all the scene level \"background\" \n     * decorators (axes, background grid etc..)\n     * @type MLJ.util.AssociativeArray\n     * @memberOf MLJ.core.Scene\n     */\n    var _decorators = new MLJ.util.AssociativeArray();\n\n    /**\n     * Associative array that contains all the currently active post process\n     * rendering passes. For details see {@link MLJ.core.Scene.addPostProcessPass}.\n     * @type MLJ.util.AssociativeArray\n     * @memberOf MLJ.core.Scene\n     */\n    var _postProcessPasses = new MLJ.util.AssociativeArray();\n\n    /**\n     * Reference to current layer \n     * @type MLJ.core.Layer\n     * @memberOf MLJ.core.Scene     \n     */\n    var _selectedLayer;\n\n    /**\n     * It contains the ThreeJs Representation of the current set of layers. \n     * Each Layer is associated to a ThreeJS mesh whose contained in the MLJ.core.MeshFile object.\n     * @type THREE.Scene\n     * @memberOf MLJ.core.Scene     \n     */\n    var _scene;\n    \n    /**\n     * The ThreeJs group that contains all the layers. \n     * It also store the global transformation (scale + translation) \n     * that brings the global bbox of the scene\n     * in the origin of the camera reference system. \n     * @type THREE.Object\n     * @memberOf MLJ.core.Scene     \n     */\n    var _group;\n    \n    var _camera;\n\n    /**\n     * This scene contains 2D overlays that are drawn on top of everything else\n     * @memberOf MLJ.core.Scene     \n     */\n    var _scene2D;\n    \n    /**\n     * \"Fake\" camera object passed to the renderer when rendering the <code>_scene2D</code>\n     */\n    var _camera2D;\n\n    var _stats;\n    var _controls;\n    \n    /// @type {Object}\n    var _renderer;\n    var _this = this;\n\n    function get3DSize() {\n        var _3D = $('#_3D');\n\n        return {\n            width: _3D.innerWidth (),\n            height: _3D.innerHeight()\n        };\n    }\n\n    function initDragAndDrop() {\n        function FileDragHandler(e) {\n            e.stopPropagation();\n            e.preventDefault();\n            var files = e.target.files || e.dataTransfer.files;\n            MLJ.core.File.openMeshFile(files);\n        }\n\n        function FileDragHover(e) {\n            e.stopPropagation();\n            e.preventDefault();\n        }\n\n        $(window).ready(function () {\n            var ddd = document.getElementById(\"_3D\");\n            ddd.addEventListener(\"dragover\", FileDragHover, false);\n            ddd.addEventListener(\"dragleave\", FileDragHover, false);\n            ddd.addEventListener(\"drop\", FileDragHandler, false);\n        });\n    }\n\n    function initStats() {\n\n        var stats = new Stats();\n\n        stats.setMode(0); // 0: fps, 1: ms\n        stats.active = false;\n\n        // Align top-right\n        stats.domElement.style.visibility = 'hidden';\n        stats.domElement.style.position = 'absolute';\n        stats.domElement.style.right = '0px';\n        stats.domElement.style.top = '0px';\n        stats.domElement.style.zIndex = 100;\n\n        $(\"#_3D\").append( stats.domElement );\n\n        return stats;\n    }\n\n//SCENE INITIALIZATION  ________________________________________________________\n\n    function initScene() {\n        var _3DSize = get3DSize();\n\n        _scene = new THREE.Scene();\n        _camera = new THREE.PerspectiveCamera(45, _3DSize.width / _3DSize.height, 0.1, 1800);\n        _camera.position.z = 15;\n        _group = new THREE.Object3D();\n        _scene.add(_group);\n\n        _scene2D = new THREE.Scene();\n        _camera2D = new THREE.OrthographicCamera(0 , _3DSize.width / _3DSize.height, 1, 0, -1, 1);\n        _camera2D.position.z = -1;\n\n        _renderer = new THREE.WebGLRenderer({ \n            antialias: true, \n            alpha: true, \n            preserveDrawingBuffer:true});\n        //_renderer.shadowMapEnabled = true;\n        //_renderer.context.getSupportedExtensions();\n        _renderer.context.getExtension(\"EXT_frag_depth\");\n\n        \n        _renderer.setPixelRatio( window.devicePixelRatio );\n        _renderer.setSize(_3DSize.width, _3DSize.height);\n        $('#_3D').append(_renderer.domElement);\n        _scene.add(_camera);\n\n        _stats = initStats();\n        /*\n        requestAnimationFrame(function updateStats() {\n                                _stats.update();\n                                requestAnimationFrame(updateStats); });\n        */\n\n        //INIT CONTROLS\n        var container = document.getElementsByTagName('canvas')[0];\n        _controls = new THREE.TrackballControls(_camera, container);\n        _controls.rotateSpeed = 4.0;\n        _controls.zoomSpeed = 1.2;\n        _controls.panSpeed = 2.0;\n        _controls.noZoom = false;\n        _controls.noPan = false;\n        _controls.staticMoving = true;\n        _controls.dynamicDampingFactor = 0.3;\n        _controls.keys = [65, 83, 68];\n        \n        $(document).keydown(function(event) {           \n            if((event.ctrlKey || (event.metaKey && event.shiftKey)) && event.which === 72) {\n                event.preventDefault();\n                _controls.reset();\n            }\n        });\n        \n        //INIT LIGHTS \n        _this.lights.AmbientLight = new MLJ.core.AmbientLight(_scene, _camera, _renderer);\n        _this.lights.Headlight = new MLJ.core.Headlight(_scene, _camera, _renderer);\n\n        //EVENT HANDLERS\n        var $canvas = $('canvas')[0];\n        $canvas.addEventListener('touchmove', _controls.update.bind(_controls), false);\n        $canvas.addEventListener('mousemove', _controls.update.bind(_controls), false);        \n        $canvas.addEventListener('mousewheel', _controls.update.bind(_controls), false);        \n        $canvas.addEventListener('DOMMouseScroll', _controls.update.bind(_controls), false ); // firefox\n        \n        _controls.addEventListener('change', function () {            \n            MLJ.core.Scene.render();\n            $($canvas).trigger('onControlsChange');\n        });\n\n        $(window).resize(function () {\n            var size = get3DSize();\n\n            _camera.aspect = size.width / size.height;\n            _camera.updateProjectionMatrix();\n            _renderer.setSize(size.width, size.height);\n\n\n            colorBuffer.setSize(size.width, size.height);\n            targetBuffer.setSize(size.width, size.height);\n\n            _camera2D.left = size.width / size.height;\n            _camera2D.updateProjectionMatrix;\n\n            MLJ.core.Scene.render();\n        });\n\n        $(document).on(\"MeshFileOpened\",\n                function (event, layer) {\n                    MLJ.core.Scene.addLayer(layer);\n                });\n\n        $(document).on(\"MeshFileReloaded\",\n                function (event, layer) {\n                    \n                    // Restore three geometry to reflect the new state of the vcg mesh\n                    layer.updateThreeMesh();\n\n                    /**\n                     *  Triggered when a layer is reloaded\n                     *  @event MLJ.core.Scene#SceneLayerReloaded\n                     *  @type {Object}\n                     *  @property {MLJ.core.Layer} layer The reloaded mesh file\n                     *  @example\n                     *  <caption>Event Interception:</caption>\n                     *  $(document).on(\"SceneLayerReloaded\",\n                     *      function (event, layer) {\n                     *          //do something\n                     *      }\n                     *  );\n                     */                    \n                    $(document).trigger(\"SceneLayerReloaded\", [layer]);\n                });\n    }\n    \n    /* Compute global bounding box and translate and scale every object in proportion \n     * of global bounding box. First translate every object into original position, \n     * then scale all by reciprocal value of scale factor (note that scale factor \n     * and original position are stored into mesh object). Then it computes \n     * global bbox, scale every object, recalculate global bbox and finally\n     * translate every object in a right position.\n     */\n    function _computeGlobalBBbox()\n    {\n        var BBGlobal;\n        if (_layers.size() === 0) // map to the canonical cube\n            BBGlobal = new THREE.Box3(new THREE.Vector3(-1,-1,-1), new THREE.Vector3(1,1,1));\n        else {\n            BBGlobal = new THREE.Box3(); // map to the layers' boxes union\n            iter = _layers.iterator();\n            while (iter.hasNext()) {\n                threeMesh = iter.next().getThreeMesh();\n                // Note that the 3js method return the bbox wrt to the current transformation. \n                var bbox = new THREE.Box3().setFromObject(threeMesh);\n                BBGlobal.union(bbox);\n            }\n        }\n        var scaleFac = 15.0 / (BBGlobal.min.distanceTo(BBGlobal.max));\n        var offset = BBGlobal.center().negate();\n        offset.multiplyScalar(scaleFac);\n        _group.scale.multiplyScalar(scaleFac);\n        _group.position.add(offset);\n        _group.updateMatrix();\n        console.log(\"Position:\" + offset.x +\" \"+ offset.y +\" \"+ offset.z );\n        console.log(\"ScaleFactor:\" + _group.scale);\n        return BBGlobal;\n    }\n\n    this.getBBox = function () {\n        return _computeGlobalBBbox();\n    }\n  \n    this.lights = {\n        AmbientLight: null,\n        Headlight: null\n    };\n    \n    this.getCamera = function() {\n        return _camera;\n    };\n\n    this.getStats = function() {\n        return _stats;\n    }\n\n    this.getThreeJsGroup = function() {\n        return _group;\n    }\n\n    /**\n     * Selects the layer with the name <code>layerName</code>\n     * @param {String} layerName The name of the layer\n     * @memberOf MLJ.core.Scene     \n     * @author Stefano Gabriele\n     */\n    this.selectLayerByName = function (layerName) {\n        _selectedLayer = _layers.getByKey(layerName);\n        /**\n         *  Triggered when a layer is selected\n         *  @event MLJ.core.Scene#SceneLayerSelected\n         *  @type {Object}\n         *  @property {MLJ.core.Layer} layer The selected mesh file\n         *  @example\n         *  <caption>Event Interception:</caption>\n         *  $(document).on(\"SceneLayerSelected\",\n         *      function (event, layer) {\n         *          //do something\n         *      }\n         *  );\n         */\n        $(document).trigger(\"SceneLayerSelected\", [_selectedLayer]);        \n    };\n\n    /**\n     * Sets the visibility of layer with the name <code>layerName</code>\n     * @param {String} layerName The name of the layer\n     * @param {Boolean} visible <code>true</code> if the layers must be visible,\n     * <code>false</code> otherwise\n     * @memberOf MLJ.core.Scene     \n     * @author Stefano Gabriele\n     */\n    this.setLayerVisible = function (layerName, visible) {\n        var layer = _layers.getByKey(layerName);\n        layer.getThreeMesh().visible = visible;\n        \n        var iter = layer.overlays.iterator();\n        \n        while(iter.hasNext()) {\n            iter.next().visible = visible;\n        }\n\n        // if histogram overlay is defined show/hide labels\n        if (layer.__mlj_histogram) {\n            if (visible) layer.__mlj_histogram.show();\n            else layer.__mlj_histogram.hide();\n        }\n        \n        MLJ.core.Scene.render();\n    };\n\n    /**\n     * Adds a new layer in the scene\n     * @param {MLJ.core.Layer} layer The mesh file to add\n     * @memberOf MLJ.core.Scene     \n     * @author Stefano Gabriele\n     */\n    this.addLayer = function (layer) {\n        if (!(layer instanceof MLJ.core.Layer)) {\n            console.error(\"The parameter must be an instance of MLJ.core.MeshFile\");\n            return;\n        }\n        \n        // Initialize the THREE geometry used by overlays and rendering params\n        layer.initializeRenderingAttributes();\n        _group.add(layer.getThreeMesh());\n\n        //Add new mesh to associative array _layers            \n        _layers.set(layer.name, layer);\n        _selectedLayer = layer;\n\n        _computeGlobalBBbox();              \n\n        /**\n         *  Triggered when a layer is added\n         *  @event MLJ.core.Scene#SceneLayerAdded\n         *  @type {Object}\n         *  @property {MLJ.core.Layer} layer The last mesh file added\n         *  @property {Integer} layersNumber The number of layers in the scene\n         *  @example\n         *  <caption>Event Interception:</caption>\n         *  $(document).on(\"SceneLayerAdded\",\n         *      function (event, layer, layersNumber) {\n         *          //do something\n         *      }\n         *  );\n         */\n        $(document).trigger(\"SceneLayerAdded\", [layer, _layers.size()]);\n        \n        //render the scene\n        _this.render();\n    };       \n    \n    this.addOverlayLayer = function(layer, name, mesh, overlay2D) {\n        if(!(mesh instanceof THREE.Object3D)) {\n            console.warn(\"mesh parameter must be an instance of THREE.Object3D\");\n            return;\n        }\n        \n        layer.overlays.set(name,mesh);\n\n        mesh.visible = layer.getThreeMesh().visible;\n        if (overlay2D) {\n            _scene2D.add(mesh);\n        } else {\n//            _group.add(mesh);\n            layer.getThreeMesh().add(mesh);\n        }\n\n        _this.render();\n    };\n\n    function disposeObject(obj) {\n        if (obj.geometry) obj.geometry.dispose();\n        if (obj.material) obj.material.dispose();\n        if (obj.texture) obj.texture.dispose();\n    }\n    \n    this.removeOverlayLayer = function(layer, name, overlay2D) {        \n        var mesh = layer.overlays.getByKey(name);\n\n        if (mesh !== undefined) {\n            mesh = layer.overlays.remove(name);      \n\n            if (overlay2D) {\n                _scene2D.remove(mesh);                        \n            } else {\n                layer.getThreeMesh().remove(mesh);   \n//                _group.remove(mesh);                        \n            }\n\n            mesh.traverse(disposeObject);\n            disposeObject(mesh);\n\n            _this.render();                              \n        }\n    };  \n\n    /**\n     * Updates a layer. This function should be called if the <code>layer</code>\n     * geometry or properties was modified.\n     * @param {MLJ.core.Layer} layer The mesh file corresponding to the level\n     * @memberOf MLJ.core.Scene\n     * @author Stefano Gabriele\n     * @example\n     * //Apply Laplacian smooth filter\n     * Module.LaplacianSmooth(layer.ptrMesh, 1, false);\n     * //The filter has changed mesh geometry ...\n     * scene.updateLayer(layer);\n     */\n    this.updateLayer = function (layer) {\n        if (layer instanceof MLJ.core.Layer) {\n\n            if (_layers.getByKey(layer.name) === undefined) {\n                console.warn(\"Trying to update a layer not in the scene.\");\n                return;\n            }\n\n            layer.updateThreeMesh();\n            _computeGlobalBBbox();\n\n            //render the scene\n            this.render();\n\n            /**\n             *  Triggered when a layer is updated\n             *  @event MLJ.core.Scene#SceneLayerUpdated\n             *  @type {Object}\n             *  @property {MLJ.core.Layer} layer The updated mesh file\n             *  @example\n             *  <caption>Event Interception:</caption>\n             *  $(document).on(\"SceneLayerUpdated\",\n             *      function (event, layer) {\n             *          //do something\n             *      }\n             *  );\n             */\n            $(document).trigger(\"SceneLayerUpdated\", [layer]);\n\n        } else {\n            console.error(\"The parameter must be an instance of MLJ.core.Layer\");\n        }\n    };\n\n    /**\n     * Returns the layer corresponding to the given name\n     * @param {String} name The name of the layer     \n     * @memberOf MLJ.core.Scene\n     * @return {MLJ.core.Layer} The layer corresponding to the given name\n     * @author Stefano Gabriele     \n     */\n    this.getLayerByName = function (name) {\n        return _layers.getByKey(name);\n    };\n\n    function disambiguateName(meshName) {\n        var prefix, ext;\n        var ptIndex = meshName.lastIndexOf('.');\n        if (ptIndex > 0) {\n            prefix = meshName.substr(0, ptIndex);\n            ext = meshName.substr(ptIndex);\n        } else {\n            prefix = meshName;\n            ext = \"\";\n        }\n\n        if (/\\[(\\d+)\\]$/.test(prefix)) {\n            prefix = prefix.substr(0, prefix.lastIndexOf(\"[\"));\n        }\n\n        var maxNumTag = 0;\n        while (true) {\n            var collision = false;\n            var layerIterator = MLJ.core.Scene.getLayers().iterator();\n            while (layerIterator.hasNext() && !collision) {\n                if (meshName === layerIterator.next().name) collision = true;\n            }\n            if (collision) meshName = prefix + \"[\" + ++maxNumTag + \"]\" + ext;\n            else break;\n        }\n        return meshName;\n    }\n\n    \n    /**\n     * Creates a new mesh file using the c++ functions bound to JavaScript\n     * @param {String} name The name of the new mesh file\n     * @memberOf MLJ.core.File\n     * @returns {MLJ.core.Layer} The new layer\n     * @author Stefano Gabriele\n     */\n    this.createLayer = function (name) {\n        var layerName = disambiguateName(name);\n        var layer = new MLJ.core.Layer(layerName, new Module.CppMesh());\n        return layer;\n    };\n    \n    /**\n     * Removes the layer corresponding to the given name\n     * @param {String} name The name of the layer which must be removed  \n     * @memberOf MLJ.core.Scene     \n     * @author Stefano Gabriele     \n     */\n    this.removeLayerByName = function (name) {\n        var layer = this.getLayerByName(name);\n        \n        if (layer !== undefined) {\n            //remove layer from list\n            _layers.remove(name);\n                                                \n            $(document).trigger(\"SceneLayerRemoved\", [layer, _layers.size()]);\n            \n            layer.dispose();\n                      \n            if(_layers.size() > 0) {\n                _this.selectLayerByName(_layers.getFirst().name);\n            } else {\n                _this._selectedLayer = undefined;\n            }\n            \n            _computeGlobalBBbox();\n           \n            \n            MLJ.core.Scene.render(); \n        }\n    };\n\n    /**\n     * Adds a scene decorator. A scene decorator differs fron an overlay layer in\n     * that it's not tied to a particular layer, but to the scene as a whole (for\n     * example an axes descriptor that highlights the direction of the x, y, and z\n     * coordinates).\n     * @param {String} name - The name of the decorator\n     * @param {THREE.Object3D} decorator - The decorator object\n     * @memberOf MLJ.core.Scene\n     */\n    this.addSceneDecorator = function(name, decorator) {\n        if(!(decorator instanceof THREE.Object3D)) {\n            console.warn(\"MLJ.core.Scene.addSceneDecorator(): decorator parameter not an instance of THREE.Object3D\");\n            return;\n        }\n\n        _decorators.set(name, decorator)\n        _group.add(decorator);\n\n        _this.render();\n    };\n\n    /**\n     * Removes a decorator object from the scene.\n     * @param {String} name - The name of the decorator to remove\n     * @memberOf MLJ.core.Scene\n     */\n    this.removeSceneDecorator = function(name) {\n        var decorator = _decorators.getByKey(name)\n\n        if (decorator !== undefined) {\n            _decorators.remove(name);\n            _group.remove(decorator);\n            decorator.geometry.dispose();\n            decorator.material.dispose();  \n        } else {\n            console.warn(\"Warning: \" + name + \" decorator not in the scene\");\n        }\n\n        //render the scene\n        _this.render();\n    };\n\n    /**\n     * Returns the currently selected layer     \n     * @returns {MLJ.core.Layer} The currently selected layer\n     * @memberOf MLJ.core.Scene\n     * @author Stefano Gabriele     \n     */\n    this.getSelectedLayer = function () {\n        return _selectedLayer;\n    };\n\n    /**\n     * Returns the layers list\n     * @returns {MLJ.util.AssociativeArray} The layers list\n     * @memberOf MLJ.core.Scene\n     * @author Stefano Gabriele     \n     */\n    this.getLayers = function () {\n        return _layers;\n    };\n\n    this.get3DSize = function() { return get3DSize(); };\n    this.getRenderer = function() { return _renderer; };\n\n    this.getScene = function () {return _scene;};\n\n    /**\n     * Adds a post process pass to the rendering chain. As of now the interface\n     * to post process effects is minimal: an effect is simply a callable object\n     * that must accept two render buffers as parameters. The first buffer \n     * contains the color generated by the rendering chain of MeshLabJS up to\n     * the effect invocation, (this includes the basic scene rendering plus the\n     * result of any post process effect that was applied before the current\n     * one). The second buffer must be used as the render target of the pass,\n     * will be forwarded as input to the next effect, or will be transfered to\n     * the canvas if no other effects are active. Both buffers have the same\n     * size as the page canvas. Any other information that may be needed by an\n     * effect must be passed with closure variables or queried directly to\n     * {@link MLJ.core.Scene}. \n     *\n     * @param {String} name - The name of the pass\n     * @param {Object} pass - The callable (function) object that will apply the pass\n     * @memberOf MLJ.core.Scene\n     */\n    this.addPostProcessPass = function (name, pass) {\n        if(!jQuery.isFunction(pass)) {\n            console.warn(\"MLJ.core.Scene.addPostProcessPass(): pass parameter must be callable\");\n            return;\n        }\n        _postProcessPasses.set(name, pass);\n    }\n\n    /**\n     * Removes a post process effect from the rendering chain.\n     * @param {String} name - The name of the pass to remove\n     * @memberOf MLJ.core.Scene\n     */\n    this.removePostProcessPass = function (name) {\n        var pass = _postProcessPasses.remove(name);\n        if (pass == undefined) {\n            console.warn(\"Warning: \" + name + \" pass not enabled\");\n        }\n\n        _this.render();\n    }\n\n    var colorBuffer = new THREE.WebGLRenderTarget(0, 0, {\n        type: THREE.FloatType,\n        minFilter: THREE.NearestFilter\n    });\n    var targetBuffer = new THREE.WebGLRenderTarget(0, 0, {\n        type: THREE.FloatType,\n        minFilter: THREE.NearestFilter\n    });\n\n    var plane = new THREE.PlaneBufferGeometry(2, 2);\n    var quadMesh = new THREE.Mesh(\n        plane\n    );\n\n    var quadScene = new THREE.Scene();\n    quadScene.add(quadMesh);\n\n    quadMesh.material = new THREE.ShaderMaterial({\n        vertexShader:\n            \"varying vec2 vUv; \\\n             void main(void) \\\n             { \\\n                 vUv = uv; \\\n                 gl_Position = vec4(position.xyz, 1.0); \\\n             }\",\n        fragmentShader: \n            \"uniform sampler2D offscreen; \\\n             varying vec2 vUv; \\\n             void main(void) { gl_FragColor = texture2D(offscreen, vUv.xy); }\"\n    });\n    quadMesh.material.uniforms = {\n            offscreen: { type: \"t\", value: null }\n    };\n    \n\n    /**\n     * Renders the scene. If there are no post process effects enabled, the \n     * THREE.js scene that contains all the scene decorators and the overlay\n     * layers is rendered straight to the canvas. Otherwise, the basic scene is \n     * rendered to an off screen render target, and post process effects are\n     * applied one after the other (according to the user's activation order)\n     * before displaying the result.\n     * @memberOf MLJ.core.Scene  \n     */\n    this.render = function (fromReqAnimFrame) {\n\n        if (_stats.active && !fromReqAnimFrame) {\n            return;\n        }\n\n        if (_postProcessPasses.size() > 0) {\n            _renderer.render(_scene, _camera, colorBuffer, true);\n\n            var it = _postProcessPasses.iterator();\n\n            while (it.hasNext()) {\n                var pass = it.next();\n                pass(colorBuffer, targetBuffer);\n                // Swap rendering targets for the next pass\n                var tmp = colorBuffer;\n                colorBuffer = targetBuffer;\n                targetBuffer = tmp;\n            }\n\n            // final pass, render colorBuffer to the screen\n            quadMesh.material.uniforms.offscreen.value = colorBuffer;\n            _renderer.render(quadScene, _camera2D);\n        } else {\n            _renderer.render(_scene, _camera);\n        }\n\n        // render the 2D overlays\n        _renderer.autoClear = false;\n        _renderer.render(_scene2D, _camera2D);\n        _renderer.autoClear = true;\n    };\n\n\n\n    this.takeSnapshot = function() {\n        var canvas = _renderer.context.canvas;        \n        // draw to canvas...\n        canvas.toBlob(function(blob) {\n            saveAs(blob, \"snapshot.png\");\n        });\n    };\n    \n    this.resetTrackball = function() {\n        _controls.reset();\n    };\n    \n    \n    //INIT\n    $(window).ready(function () {\n        initScene();\n        initDragAndDrop();\n    });\n\n}).call(MLJ.core.Scene);\n",
                "subject": "Corrected the update of the bounding box.",
                "message": "Corrected the update of the bounding box.\n",
                "lang": "JavaScript",
                "license": "agpl-3.0",
                "repos": "cnr-isti-vclab/meshlabjs,cignoni/meshlabjs,cnr-isti-vclab/meshlabjs,cignoni/meshlabjs,cignoni/meshlabjs,cnr-isti-vclab/meshlabjs,cignoni/meshlabjs,cnr-isti-vclab/meshlabjs,cnr-isti-vclab/meshlabjs,cignoni/meshlabjs"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10286,
            "row": {
                "commit": "3275d8dd17eac8cdfa1b3a04ebb04ff11ebb168a",
                "old_file": "quickstart/public/js/videos/filter.user.js",
                "new_file": "quickstart/public/js/videos/filter.user.js",
                "old_contents": "$(function() {\n    $('#user_filter').on(\n        'submit',\n        function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n\n            $.get(\n                $(this).data('url').toString(),\n                { 'userId': $(this).find('select').val() },\n                function(data) {\n                    alert(data);\n                },\n                'html'\n            );\n        }\n    );\n});",
                "new_contents": "$(function() {\n    $('#user_filter').on(\n        'submit',\n        function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n\n            $.get(\n                $(this).data('url').toString(),\n                { 'userId': $(this).find('select').val() },\n                function(data) {\n                    $('#videos_list').fadeOut('fast').html(data).fadeIn('fast');\n                },\n                'html'\n            );\n        }\n    );\n});",
                "subject": "display results",
                "message": "display results\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "nejo/zf1_kickoff,nejo/zf1_kickoff"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10287,
            "row": {
                "commit": "cc07b94ae74c124da829bdbb0a163049b4759d32",
                "old_file": "js/models/actions.js",
                "new_file": "js/models/actions.js",
                "old_contents": "import moment from 'moment';\n\nimport appConfig, { githubOrgName } from '../../static/appConfig.json';\nimport auth from './auth';\nimport {\n\tderiveProjectId,\n\tderiveProposalId\n} from './reducers';\n\nexport const PROJECT_LIST_REQUESTED = 'PROJECT_LIST_REQUESTED';\nexport const PROJECT_LIST_RESPONDED = 'PROJECT_LIST_RESPONDED';\nexport const PROJECT_REQUESTED = 'PROJECT_REQUESTED';\nexport const PROJECT_RESPONDED = 'PROJECT_RESPONDED';\nexport const PROPOSAL_REQUESTED = 'PROPOSAL_REQUESTED';\nexport const PROPOSAL_RESPONDED = 'PROPOSAL_RESPONDED';\nexport const VIEWER_INFO_REQUESTED = 'VIEWER_INFO_REQUESTED';\nexport const VIEWER_INFO_RESPONDED = 'VIEWER_INFO_RESPONDED';\n\nexport const CREATE_PROJECT_REQUESTED = 'CREATE_PROJECT_REQUESTED';\nexport const CREATE_PROJECT_RESPONDED = 'CREATE_PROJECT_RESPONDED';\n\nexport default function (store, transport) {\n\n\treturn {\n\n\t\t// ================================================\n\t\t// READ METHODS\n\t\t// ================================================\n\n\t\t/**\n\t\t * Request all Open Redistricting projects.\n\t\t * A \"project\" is a GitHub repository within the \"open-redist\" GitHub Organization.\n\t\t */\n\t\trequestProjectList () {\n\n\t\t\tstore.dispatch({\n\t\t\t\ttype: PROJECT_LIST_REQUESTED\n\t\t\t});\n\n\t\t\tlet url = `https://api.github.com/orgs/${ githubOrgName }/repos`;\n\n\t\t\ttransport.request(url, this.parseProjectList, this.buildAuthHeader())\n\t\t\t.then(\n\t\t\t\tresponse => {\n\t\t\t\t\t// console.log(\">>>>> received project list:\", response);\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: PROJECT_LIST_RESPONDED,\n\t\t\t\t\t\tpayload: response\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\t// Fail loudly on error\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: PROJECT_LIST_RESPONDED,\n\t\t\t\t\t\terror: error\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(error => {\n\t\t\t\t// fail loudly if the application errors in response to the\n\t\t\t\t// reducer state change triggered by the successful store.dispatch\n\t\t\t\tthrow error;\n\t\t\t});\n\n\t\t},\n\n\t\tparseProjectList (response) {\n\n\t\t\t// extract only the subset of data needed for this application\n\t\t\treturn response.json()\n\t\t\t.then(json => {\n\n\t\t\t\treturn json;\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Request the following for one Open Redistricting project (repository):\n\t\t * - metadata\n\t\t * - file list\n\t\t * - proposal list (A \"proposal\" is a pull request (defaults to return only open requests) on a GitHub \"open-redist\" repository)\n\t\t */\n\t\trequestProject (projectId) {\n\n\t\t\tlet projectKey = deriveProjectId(githubOrgName, projectId);\n\t\t\tstore.dispatch({\n\t\t\t\ttype: PROJECT_REQUESTED,\n\t\t\t\tmeta: { projectKey }\n\t\t\t});\n\n\t\t\tPromise.all([\n\t\t\t\ttransport.request(`https://api.github.com/repos/${ githubOrgName }/${ projectId }`, this.parseProjectMetadata, this.buildAuthHeader()),\n\t\t\t\ttransport.request(`https://api.github.com/repos/${ githubOrgName }/${ projectId }/contents`, this.parseProjectContents, this.buildAuthHeader()),\n\t\t\t\ttransport.request(`https://api.github.com/repos/${ githubOrgName }/${ projectId }/pulls`, this.parseProjectProposals, this.buildAuthHeader())\n\t\t\t])\n\t\t\t.then(\n\t\t\t\tresponses => {\n\t\t\t\t\t// console.log(\">>>>> received project metadata:\", response);\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: PROJECT_RESPONDED,\n\t\t\t\t\t\tmeta: { projectKey },\n\t\t\t\t\t\tpayload: {\n\t\t\t\t\t\t\tmetadata: responses[0],\n\t\t\t\t\t\t\tcontents: responses[1],\n\t\t\t\t\t\t\tproposals: responses[2]\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\t// Fail loudly on error\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: PROJECT_RESPONDED,\n\t\t\t\t\t\tmeta: { projectKey },\n\t\t\t\t\t\terror: error\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(error => {\n\t\t\t\t// fail loudly if the application errors in response to the\n\t\t\t\t// reducer state change triggered by the successful store.dispatch\n\t\t\t\tthrow error;\n\t\t\t});\n\n\t\t},\n\n\t\tparseProjectMetadata (response) {\n\n\t\t\treturn response.json()\n\t\t\t.then(json => json);\n\n\t\t},\n\n\t\tparseProjectContents (response) {\n\n\t\t\t// extract only the subset of data needed for this application\n\t\t\treturn response.json()\n\t\t\t.then(json => ({\n\t\t\t\t\tall: json,\n\t\t\t\t\tmap: json.find(d => d.name.slice(-7) === 'geojson')\n\t\t\t}));\n\n\t\t},\n\n\t\tparseProjectProposals (response) {\n\n\t\t\t// extract only the subset of data needed for this application\n\t\t\treturn response.json()\n\t\t\t.then(json => json.reduce((acc, proposal) => {\n\t\t\t\tacc[proposal.number] = proposal;\n\t\t\t\treturn acc;\n\t\t\t}, {}));\n\n\t\t},\n\n\t\t/**\n\t\t * Request details for one proposal for an Open Redistricting project.\n\t\t * A \"proposal\" is a pull request on a GitHub \"open-redist\" repository.\n\t\t */\n\t\trequestProposal (projectId, proposalId) {\n\n\t\t\tlet proposalKey = deriveProposalId(githubOrgName, projectId, proposalId);\n\t\t\tstore.dispatch({\n\t\t\t\ttype: PROPOSAL_REQUESTED,\n\t\t\t\tmeta: { proposalKey }\n\t\t\t});\n\n\t\t\tlet url = `https://api.github.com/repos/${ githubOrgName }/${ projectId }/pulls/${ proposalId }`;\n\n\t\t\ttransport.request(url, this.parseProposal, this.buildAuthHeader())\n\t\t\t.then(\n\t\t\t\tresponse => {\n\t\t\t\t\t// console.log(\">>>>> received proposal:\", response);\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: PROPOSAL_RESPONDED,\n\t\t\t\t\t\tmeta: { proposalKey },\n\t\t\t\t\t\tpayload: response\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\t// Fail loudly on error\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: PROPOSAL_RESPONDED,\n\t\t\t\t\t\tmeta: { proposalKey },\n\t\t\t\t\t\terror: error\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(error => {\n\t\t\t\t// fail loudly if the application errors in response to the\n\t\t\t\t// reducer state change triggered by the successful store.dispatch\n\t\t\t\tthrow error;\n\t\t\t});\n\n\t\t},\n\n\t\tparseProposal (response) {\n\n\t\t\t// extract only the subset of data needed for this application\n\t\t\treturn response.json()\n\t\t\t.then(json => {\n\n\t\t\t\treturn json;\n\n\t\t\t});\n\n\t\t},\n\n\t\trequestProposalRevisions (proposal) {\n\n\t\t\tconsole.log(\">>>>> TODO: fetch proposal revisions from:\", proposal.commits_url);\n\t\t\t// TODO: fetch commits (revisions) and add to project > proposal > in reducers;\n\t\t\t// \t\t need to refactor / split up the increasingly massive projects reducers\n\t\t\t// \t\t while doing this.\n\n\t\t},\n\n\t\trequestProposalComments (proposal) {\n\n\t\t\tconsole.log(\">>>>> TODO: fetch proposal comments from:\", proposal.comments_url);\n\t\t\t// TODO: fetch comments and add to project > proposal > in reducers;\n\t\t\t// \t\t need to refactor / split up the increasingly massive projects reducers\n\t\t\t// \t\t while doing this.\n\n\t\t},\n\n\t\t/**\n\t\t * Determine if the authorized user is a member of the 'open-redist' organization.\n\t\t * If so, additionally checks response headers for write access (the 'public_repo' OAuth scope);\n\t\t * if write access is not yet granted, will push the user through the OAuth flow one more time\n\t\t * with increased permissions.\n\t\t * If the user is a member and is successfully granted, or already has, write access,\n\t\t * the `viewer` object in the store will have its `isMember` flag set to `true`.\n\t\t */\n\t\tauthedUserIsMember () {\n\n\t\t\tstore.dispatch({\n\t\t\t\ttype: VIEWER_INFO_REQUESTED\n\t\t\t});\n\n\t\t\tlet token = auth.getToken();\n\t\t\tif (!token) {\n\t\t\t\t// viewer is not currently logged in\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: VIEWER_INFO_RESPONDED,\n\t\t\t\t\t\tpayload: { isMember: false }\n\t\t\t\t\t});\n\t\t\t\t}, 1);\n\t\t\t\treturn;\n\t\t\t};\n\n\t\t\t// Get basic info about the authed user...\n\t\t\tlet url = 'https://api.github.com/user';\n\t\t\ttransport.request(url, null, this.buildAuthHeader())\n\t\t\t.then(\n\t\t\t\tresponse => {\n\t\t\t\t\t// ...and use that to determine if the user is part of the organization.\n\t\t\t\t\turl = `https://api.github.com/orgs/${ githubOrgName }/public_members/${ response.login }`;\n\t\t\t\t\treturn transport.request(url, null, {\n\t\t\t\t\t\t...this.buildAuthHeader(),\n\t\t\t\t\t\tstatusOnly: true\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\t// NOTE: we could get here if the access token expired, so need to handle this case\n\t\t\t\t\t// (possibly by redirecting to /login).\n\t\t\t\t\t// TODO: handle with general need-to-login redirect when implemented.\n\t\t\t\t\tconsole.error(\">>>>> ERROR GETTING AUTHED USER\");\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: VIEWER_INFO_RESPONDED,\n\t\t\t\t\t\tpayload: { isMember: false }\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t)\n\t\t\t.then(\n\t\t\t\t// If the user is part of the org, ensure write access.\n\t\t\t\tresponse => {\n\t\t\t\t\t// Check 'x-oauth-scopes' header for 'public_repo' scope.\n\t\t\t\t\tlet authedScopes = response.headers.get('x-oauth-scopes');\n\t\t\t\t\tif (!~authedScopes.indexOf('public_repo')) {\n\t\t\t\t\t\t// Authed user is part of the org, but does not yet have write access.\n\t\t\t\t\t\t// Send through OAuth flow one more time, requesting the proper scope.\n\t\t\t\t\t\tauth.authorize(true, ['public_repo']);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Authed user is part of the org and has write access. Hooray!\n\t\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\t\ttype: VIEWER_INFO_RESPONDED,\n\t\t\t\t\t\t\tpayload: { isMember: true }\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: VIEWER_INFO_RESPONDED,\n\t\t\t\t\t\tpayload: { isMember: false }\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(error => {\n\t\t\t\t// fail loudly if the application errors in response to the\n\t\t\t\t// reducer state change triggered by the successful store.dispatch\n\t\t\t\tthrow error;\n\t\t\t});\n\n\t\t},\n\n\t\tfetchJSON (path) {\n\n\t\t\treturn transport.request(path);\n\n\t\t},\n\n\n\n\t\t// ================================================\n\t\t// WRITE METHODS\n\t\t// ================================================\n\n\t\tcreateProject (name, description, base64File) {\n\n\t\t\tconst initialCommitMessage = 'Initial commit of geojson map',\n\t\t\t\tmapPath = 'map.geojson';\n\n\t\t\tlet projectId = deriveProjectId(githubOrgName, name),\n\t\t\t\tprojectResponse;\n\n\t\t\tstore.dispatch({\n\t\t\t\ttype: CREATE_PROJECT_REQUESTED,\n\t\t\t\tmeta: { projectId }\n\t\t\t});\n\n\t\t\tlet url = `https://api.github.com/orgs/${ githubOrgName }/repos`;\n\t\t\treturn transport.request(url, null, {\n\t\t\t\t...this.buildAuthHeader(),\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tname,\n\t\t\t\t\tdescription\n\t\t\t\t})\n\t\t\t})\n\t\t\t.then(\n\t\t\t\tresponse => {\n\t\t\t\t\tprojectResponse = response;\n\t\t\t\t\tprojectId = projectResponse.name;\n\t\t\t\t\turl = `https://api.github.com/repos/${ githubOrgName }/${ projectId }/contents/${ mapPath }`;\n\t\t\t\t\treturn transport.request(url, null, {\n\t\t\t\t\t\t...this.buildAuthHeader(),\n\t\t\t\t\t\tmethod: 'PUT',\n\t\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\t\tpath: mapPath,\n\t\t\t\t\t\t\tmessage: initialCommitMessage,\n\t\t\t\t\t\t\tcontent: base64File\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\t// NOTE: we could get here if the access token expired, so need to handle this case\n\t\t\t\t\t// (possibly by redirecting to /login).\n\t\t\t\t\t// TODO: handle with general need-to-login redirect when implemented.\n\t\t\t\t\tconsole.error(\"Error creating project (repository):\", error);\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: CREATE_PROJECT_RESPONDED,\n\t\t\t\t\t\tmeta: { projectId },\n\t\t\t\t\t\terror: error\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t)\n\t\t\t.then(\n\t\t\t\tresponse => {\n\t\t\t\t\tconsole.log(\">>>>> Success creating initial commit:\", response);\n\t\t\t\t\tconsole.log(\"TODO NEXT: add project to projects in reducers\");\n\t\t\t\t\tconsole.log(\"TODO NEXT: change add project dialog to use 'description' as name in context of open-redist.org, and automatically create repo name as slugified entered name.\");\n\t\t\t\t\tdebugger;\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: CREATE_PROJECT_RESPONDED,\n\t\t\t\t\t\tmeta: { projectId },\n\t\t\t\t\t\tpayload: projectResponse\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\tconsole.error(\"Error creating initial commit:\", error);\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: CREATE_PROJECT_RESPONDED,\n\t\t\t\t\t\tmeta: { projectId },\n\t\t\t\t\t\terror: error\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(error => {\n\t\t\t\t// fail loudly if the application errors in response to the\n\t\t\t\t// reducer state change triggered by the successful store.dispatch\n\t\t\t\tthrow error;\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Checks if authed user already has write access (the 'public_repo' OAuth scope).\n\t\t * If not, updates the authorization to include the 'public_repo' OAuth scope.\n\t\t * See https://developer.github.com/v3/oauth/#scopes for more info.\n\t\t * Returns a Promise that resolves once user has write access.\n\t\t * \n\t\t * NOTE: Strangely, cannot check authorizations with tokens, only with basic username/password.\n\t\t * \t\t Therefore, this method remains unused (because it doesn't work).\n\t\t */\n\t\tgrantWriteAccess () {\n\n\t\t\tlet clientId = appConfig.auth[process.env.NODE_ENV === 'production' ? 'prod' : 'dev'],\n\t\t\t\turl = 'https://api.github.com/authorizations';\n\n\t\t\treturn transport.request(url)//, null, this.buildAuthHeader())\n\t\t\t.then(\n\t\t\t\tresponse => {\n\t\t\t\t\tdebugger;\n\t\t\t\t\tlet openRedistApp = response.find(authedApp => authedApp.app.client_id === clientId);\n\n\t\t\t\t\tif (!openRedistApp) throw new Error('User is not currently authed.');\n\n\t\t\t\t\tif (~openRedistApp.scopes.indexOf('public_repo')) {\n\t\t\t\t\t\treturn { userHasWriteAccess: true };\n\t\t\t\t\t} else {\n\t\t\t\t\t\turl = `https://api.github.com/authorizations/${ openRedistApp.id }`;\n\t\t\t\t\t\treturn transport.request(url, null, {\n\t\t\t\t\t\t\t...this.buildAuthHeader(),\n\t\t\t\t\t\t\tmethod: 'PATCH',\n\t\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\t\tadd_scopes: [ 'public_repo' ]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\t// NOTE: we could get here if the access token expired, so need to handle this case\n\t\t\t\t\t// (possibly by redirecting to /login).\n\t\t\t\t\t// TODO: handle with general need-to-login redirect when implemented.\n\t\t\t\t\tconsole.error(\"Error getting existing authorizations:\", error);\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t)\n\t\t\t.then(\n\t\t\t\tresponse => {\n\t\t\t\t\tdebugger;\n\t\t\t\t\treturn { userHasWriteAccess: true };\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\tconsole.error(\"Error adding write access:\", error);\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(error => {\n\t\t\t\t// fail loudly if the application errors further down the promise chain.\n\t\t\t\tthrow error;\n\t\t\t});\n\n\t\t},\n\n\n\n\t\t// ================================================\n\t\t// UTILITIES\n\t\t// ================================================\n\n\t\t/**\n\t\t * Authentication is not necessary for many GitHub API methods,\n\t\t * but go ahead and auth calls if logged in because\n\t\t * GitHub grants higher rate limits for authed calls.\n\t\t */\n\t\tbuildAuthHeader () {\n\n\t\t\tlet token = auth.getToken();\n\t\t\tif (token) {\n\n\t\t\t\tlet headers = new Headers();\n\t\t\t\theaders.append('Authorization', `token ${ token }`);\n\t\t\t\treturn { headers };\n\n\t\t\t} else {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n};\n",
                "new_contents": "import moment from 'moment';\n\nimport appConfig, { githubOrgName } from '../../static/appConfig.json';\nimport auth from './auth';\nimport {\n\tderiveProjectId,\n\tderiveProposalId\n} from './reducers';\n\nexport const PROJECT_LIST_REQUESTED = 'PROJECT_LIST_REQUESTED';\nexport const PROJECT_LIST_RESPONDED = 'PROJECT_LIST_RESPONDED';\nexport const PROJECT_REQUESTED = 'PROJECT_REQUESTED';\nexport const PROJECT_RESPONDED = 'PROJECT_RESPONDED';\nexport const PROPOSAL_REQUESTED = 'PROPOSAL_REQUESTED';\nexport const PROPOSAL_RESPONDED = 'PROPOSAL_RESPONDED';\nexport const VIEWER_INFO_REQUESTED = 'VIEWER_INFO_REQUESTED';\nexport const VIEWER_INFO_RESPONDED = 'VIEWER_INFO_RESPONDED';\n\nexport const CREATE_PROJECT_REQUESTED = 'CREATE_PROJECT_REQUESTED';\nexport const CREATE_PROJECT_RESPONDED = 'CREATE_PROJECT_RESPONDED';\n\nexport default function (store, transport) {\n\n\treturn {\n\n\t\t// ================================================\n\t\t// READ METHODS\n\t\t// ================================================\n\n\t\t/**\n\t\t * Request all Open Redistricting projects.\n\t\t * A \"project\" is a GitHub repository within the \"open-redist\" GitHub Organization.\n\t\t */\n\t\trequestProjectList () {\n\n\t\t\tstore.dispatch({\n\t\t\t\ttype: PROJECT_LIST_REQUESTED\n\t\t\t});\n\n\t\t\tlet url = `https://api.github.com/orgs/${ githubOrgName }/repos`;\n\n\t\t\ttransport.request(url, this.parseProjectList, this.buildAuthHeader())\n\t\t\t.then(\n\t\t\t\tresponse => {\n\t\t\t\t\t// console.log(\">>>>> received project list:\", response);\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: PROJECT_LIST_RESPONDED,\n\t\t\t\t\t\tpayload: response\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\t// Fail loudly on error\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: PROJECT_LIST_RESPONDED,\n\t\t\t\t\t\terror: error\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(error => {\n\t\t\t\t// fail loudly if the application errors in response to the\n\t\t\t\t// reducer state change triggered by the successful store.dispatch\n\t\t\t\tthrow error;\n\t\t\t});\n\n\t\t},\n\n\t\tparseProjectList (response) {\n\n\t\t\t// extract only the subset of data needed for this application\n\t\t\treturn response.json()\n\t\t\t.then(json => {\n\n\t\t\t\treturn json;\n\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Request the following for one Open Redistricting project (repository):\n\t\t * - metadata\n\t\t * - file list\n\t\t * - proposal list (A \"proposal\" is a pull request (defaults to return only open requests) on a GitHub \"open-redist\" repository)\n\t\t */\n\t\trequestProject (projectId) {\n\n\t\t\tlet projectKey = deriveProjectId(githubOrgName, projectId);\n\t\t\tstore.dispatch({\n\t\t\t\ttype: PROJECT_REQUESTED,\n\t\t\t\tmeta: { projectKey }\n\t\t\t});\n\n\t\t\tPromise.all([\n\t\t\t\ttransport.request(`https://api.github.com/repos/${ githubOrgName }/${ projectId }`, this.parseProjectMetadata, this.buildAuthHeader()),\n\t\t\t\ttransport.request(`https://api.github.com/repos/${ githubOrgName }/${ projectId }/contents`, this.parseProjectContents, this.buildAuthHeader()),\n\t\t\t\ttransport.request(`https://api.github.com/repos/${ githubOrgName }/${ projectId }/pulls`, this.parseProjectProposals, this.buildAuthHeader())\n\t\t\t])\n\t\t\t.then(\n\t\t\t\tresponses => {\n\t\t\t\t\t// console.log(\">>>>> received project metadata:\", response);\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: PROJECT_RESPONDED,\n\t\t\t\t\t\tmeta: { projectKey },\n\t\t\t\t\t\tpayload: {\n\t\t\t\t\t\t\tmetadata: responses[0],\n\t\t\t\t\t\t\tcontents: responses[1],\n\t\t\t\t\t\t\tproposals: responses[2]\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\t// Fail loudly on error\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: PROJECT_RESPONDED,\n\t\t\t\t\t\tmeta: { projectKey },\n\t\t\t\t\t\terror: error\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(error => {\n\t\t\t\t// fail loudly if the application errors in response to the\n\t\t\t\t// reducer state change triggered by the successful store.dispatch\n\t\t\t\tthrow error;\n\t\t\t});\n\n\t\t},\n\n\t\tparseProjectMetadata (response) {\n\n\t\t\treturn response.json()\n\t\t\t.then(json => json);\n\n\t\t},\n\n\t\tparseProjectContents (response) {\n\n\t\t\t// extract only the subset of data needed for this application\n\t\t\treturn response.json()\n\t\t\t.then(json => ({\n\t\t\t\t\tall: json,\n\t\t\t\t\tmap: json.find(d => d.name.slice(-7) === 'geojson')\n\t\t\t}));\n\n\t\t},\n\n\t\tparseProjectProposals (response) {\n\n\t\t\t// extract only the subset of data needed for this application\n\t\t\treturn response.json()\n\t\t\t.then(json => json.reduce((acc, proposal) => {\n\t\t\t\tacc[proposal.number] = proposal;\n\t\t\t\treturn acc;\n\t\t\t}, {}));\n\n\t\t},\n\n\t\t/**\n\t\t * Request details for one proposal for an Open Redistricting project.\n\t\t * A \"proposal\" is a pull request on a GitHub \"open-redist\" repository.\n\t\t */\n\t\trequestProposal (projectId, proposalId) {\n\n\t\t\tlet proposalKey = deriveProposalId(githubOrgName, projectId, proposalId);\n\t\t\tstore.dispatch({\n\t\t\t\ttype: PROPOSAL_REQUESTED,\n\t\t\t\tmeta: { proposalKey }\n\t\t\t});\n\n\t\t\tlet url = `https://api.github.com/repos/${ githubOrgName }/${ projectId }/pulls/${ proposalId }`;\n\n\t\t\ttransport.request(url, this.parseProposal, this.buildAuthHeader())\n\t\t\t.then(\n\t\t\t\tresponse => {\n\t\t\t\t\t// console.log(\">>>>> received proposal:\", response);\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: PROPOSAL_RESPONDED,\n\t\t\t\t\t\tmeta: { proposalKey },\n\t\t\t\t\t\tpayload: response\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\t// Fail loudly on error\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: PROPOSAL_RESPONDED,\n\t\t\t\t\t\tmeta: { proposalKey },\n\t\t\t\t\t\terror: error\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(error => {\n\t\t\t\t// fail loudly if the application errors in response to the\n\t\t\t\t// reducer state change triggered by the successful store.dispatch\n\t\t\t\tthrow error;\n\t\t\t});\n\n\t\t},\n\n\t\tparseProposal (response) {\n\n\t\t\t// extract only the subset of data needed for this application\n\t\t\treturn response.json()\n\t\t\t.then(json => {\n\n\t\t\t\treturn json;\n\n\t\t\t});\n\n\t\t},\n\n\t\trequestProposalRevisions (proposal) {\n\n\t\t\tconsole.log(\">>>>> TODO: fetch proposal revisions from:\", proposal.commits_url);\n\t\t\t// TODO: fetch commits (revisions) and add to project > proposal > in reducers;\n\t\t\t// \t\t need to refactor / split up the increasingly massive projects reducers\n\t\t\t// \t\t while doing this.\n\n\t\t},\n\n\t\trequestProposalComments (proposal) {\n\n\t\t\tconsole.log(\">>>>> TODO: fetch proposal comments from:\", proposal.comments_url);\n\t\t\t// TODO: fetch comments and add to project > proposal > in reducers;\n\t\t\t// \t\t need to refactor / split up the increasingly massive projects reducers\n\t\t\t// \t\t while doing this.\n\n\t\t},\n\n\t\t/**\n\t\t * Determine if the authorized user is a member of the 'open-redist' organization.\n\t\t * If so, additionally checks response headers for write access (the 'public_repo' OAuth scope);\n\t\t * if write access is not yet granted, will push the user through the OAuth flow one more time\n\t\t * with increased permissions.\n\t\t * If the user is a member and is successfully granted, or already has, write access,\n\t\t * the `viewer` object in the store will have its `isMember` flag set to `true`.\n\t\t */\n\t\tauthedUserIsMember () {\n\n\t\t\tstore.dispatch({\n\t\t\t\ttype: VIEWER_INFO_REQUESTED\n\t\t\t});\n\n\t\t\tlet token = auth.getToken();\n\t\t\tif (!token) {\n\t\t\t\t// viewer is not currently logged in\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: VIEWER_INFO_RESPONDED,\n\t\t\t\t\t\tpayload: { isMember: false }\n\t\t\t\t\t});\n\t\t\t\t}, 1);\n\t\t\t\treturn;\n\t\t\t};\n\n\t\t\t// Get basic info about the authed user...\n\t\t\tlet url = 'https://api.github.com/user';\n\t\t\ttransport.request(url, null, this.buildAuthHeader())\n\t\t\t.then(\n\t\t\t\tresponse => {\n\t\t\t\t\t// ...and use that to determine if the user is part of the organization.\n\t\t\t\t\turl = `https://api.github.com/orgs/${ githubOrgName }/public_members/${ response.login }`;\n\t\t\t\t\treturn transport.request(url, null, {\n\t\t\t\t\t\t...this.buildAuthHeader(),\n\t\t\t\t\t\tstatusOnly: true\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\t// NOTE: we could get here if the access token expired, so need to handle this case\n\t\t\t\t\t// (possibly by redirecting to /login).\n\t\t\t\t\t// TODO: handle with general need-to-login redirect when implemented.\n\t\t\t\t\tconsole.error(\">>>>> ERROR GETTING AUTHED USER\");\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: VIEWER_INFO_RESPONDED,\n\t\t\t\t\t\tpayload: { isMember: false }\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t)\n\t\t\t.then(\n\t\t\t\t// If the user is part of the org, ensure write access.\n\t\t\t\tresponse => {\n\t\t\t\t\t// Check 'x-oauth-scopes' header for 'public_repo' scope.\n\t\t\t\t\tlet authedScopes = response.headers.get('x-oauth-scopes');\n\t\t\t\t\tif (!~authedScopes.indexOf('public_repo')) {\n\t\t\t\t\t\t// Authed user is part of the org, but does not yet have write access.\n\t\t\t\t\t\t// Send through OAuth flow one more time, requesting the proper scope.\n\t\t\t\t\t\tauth.authorize(true, ['public_repo']);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Authed user is part of the org and has write access. Hooray!\n\t\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\t\ttype: VIEWER_INFO_RESPONDED,\n\t\t\t\t\t\t\tpayload: { isMember: true }\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: VIEWER_INFO_RESPONDED,\n\t\t\t\t\t\tpayload: { isMember: false }\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(error => {\n\t\t\t\t// fail loudly if the application errors in response to the\n\t\t\t\t// reducer state change triggered by the successful store.dispatch\n\t\t\t\tthrow error;\n\t\t\t});\n\n\t\t},\n\n\t\tfetchJSON (path) {\n\n\t\t\treturn transport.request(path);\n\n\t\t},\n\n\n\n\t\t// ================================================\n\t\t// WRITE METHODS\n\t\t// ================================================\n\n\t\tcreateProject (name, description, base64MapFile) {\n\n\t\t\tconst readmeCommitMessage = 'Initial commit of README with name and description',\n\t\t\t\tmapCommitMessage = 'Initial commit of geojson map',\n\t\t\t\treadmePath = 'README.md',\n\t\t\t\tmapPath = 'map.geojson';\n\n\t\t\tlet projectResponse,\n\t\t\t\tprojectId;\n\n\t\t\t// don't have id until repo creation response,\n\t\t\t// so skip the CREATE_PROJECT_REQUESTED action.\n\t\t\t/*\n\t\t\t\tprojectId = deriveProjectId(githubOrgName, name);\n\n\t\t\tstore.dispatch({\n\t\t\t\ttype: CREATE_PROJECT_REQUESTED,\n\t\t\t\tmeta: { projectId }\n\t\t\t});\n\t\t\t*/\n\n\t\t\tlet url = `https://api.github.com/orgs/${ githubOrgName }/repos`;\n\t\t\treturn transport.request(url, null, {\n\t\t\t\t...this.buildAuthHeader(),\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tname,\t\t\t\t// GitHub will slugify this and use as the repo id\n\t\t\t\t\tdescription: name\t// We use this field here as a human-readable name\n\t\t\t\t})\n\t\t\t})\n\t\t\t.then(\n\t\t\t\tresponse => {\n\t\t\t\t\t// Success creating repo. Commit the README...\n\t\t\t\t\tprojectResponse = response;\n\t\t\t\t\tprojectId = projectResponse.name;\n\t\t\t\t\turl = `https://api.github.com/repos/${ githubOrgName }/${ projectId }/contents/${ readmePath }`;\n\t\t\t\t\treturn transport.request(url, null, {\n\t\t\t\t\t\t...this.buildAuthHeader(),\n\t\t\t\t\t\tmethod: 'PUT',\n\t\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\t\tpath: mapPath,\n\t\t\t\t\t\t\tmessage: readmeCommitMessage,\n\t\t\t\t\t\t\tcontent: window.btoa(unescape(encodeURIComponent(description)))\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\t// NOTE: we could get here if the access token expired, so need to handle this case\n\t\t\t\t\t// (possibly by redirecting to /login).\n\t\t\t\t\t// TODO: handle with general need-to-login redirect when implemented.\n\t\t\t\t\tconsole.error(\"Error creating project (repository):\", error);\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: CREATE_PROJECT_RESPONDED,\n\t\t\t\t\t\tmeta: { projectId },\n\t\t\t\t\t\terror: error\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t)\n\t\t\t.then(\n\t\t\t\tresponse => {\n\t\t\t\t\t// Success committing README. Commit the map...\n\t\t\t\t\turl = `https://api.github.com/repos/${ githubOrgName }/${ projectId }/contents/${ mapPath }`;\n\t\t\t\t\treturn transport.request(url, null, {\n\t\t\t\t\t\t...this.buildAuthHeader(),\n\t\t\t\t\t\tmethod: 'PUT',\n\t\t\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\t\t\tpath: mapPath,\n\t\t\t\t\t\t\tmessage: mapCommitMessage,\n\t\t\t\t\t\t\tcontent: base64MapFile\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\n\t\t\t\t}\n\t\t\t)\n\t\t\t.then(\n\t\t\t\tresponse => {\n\t\t\t\t\tconsole.log(\">>>>> Success creating initial commit:\", response);\n\t\t\t\t\tconsole.log(\"TODO NEXT: add project to projects in reducers\");\n\t\t\t\t\tconsole.log(\"TODO NEXT: change add project dialog to use 'description' as name in context of open-redist.org, and automatically create repo name as slugified entered name.\");\n\t\t\t\t\tdebugger;\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: CREATE_PROJECT_RESPONDED,\n\t\t\t\t\t\tmeta: { projectId },\n\t\t\t\t\t\tpayload: projectResponse\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\tconsole.error(\"Error creating initial commit:\", error);\n\t\t\t\t\tstore.dispatch({\n\t\t\t\t\t\ttype: CREATE_PROJECT_RESPONDED,\n\t\t\t\t\t\tmeta: { projectId },\n\t\t\t\t\t\terror: error\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(error => {\n\t\t\t\t// fail loudly if the application errors in response to the\n\t\t\t\t// reducer state change triggered by the successful store.dispatch\n\t\t\t\tthrow error;\n\t\t\t});\n\n\t\t},\n\n\t\t/**\n\t\t * Checks if authed user already has write access (the 'public_repo' OAuth scope).\n\t\t * If not, updates the authorization to include the 'public_repo' OAuth scope.\n\t\t * See https://developer.github.com/v3/oauth/#scopes for more info.\n\t\t * Returns a Promise that resolves once user has write access.\n\t\t * \n\t\t * NOTE: Strangely, cannot check authorizations with tokens, only with basic username/password.\n\t\t * \t\t Therefore, this method remains unused (because it doesn't work).\n\t\t */\n\t\tgrantWriteAccess () {\n\n\t\t\tlet clientId = appConfig.auth[process.env.NODE_ENV === 'production' ? 'prod' : 'dev'],\n\t\t\t\turl = 'https://api.github.com/authorizations';\n\n\t\t\treturn transport.request(url)//, null, this.buildAuthHeader())\n\t\t\t.then(\n\t\t\t\tresponse => {\n\t\t\t\t\tdebugger;\n\t\t\t\t\tlet openRedistApp = response.find(authedApp => authedApp.app.client_id === clientId);\n\n\t\t\t\t\tif (!openRedistApp) throw new Error('User is not currently authed.');\n\n\t\t\t\t\tif (~openRedistApp.scopes.indexOf('public_repo')) {\n\t\t\t\t\t\treturn { userHasWriteAccess: true };\n\t\t\t\t\t} else {\n\t\t\t\t\t\turl = `https://api.github.com/authorizations/${ openRedistApp.id }`;\n\t\t\t\t\t\treturn transport.request(url, null, {\n\t\t\t\t\t\t\t...this.buildAuthHeader(),\n\t\t\t\t\t\t\tmethod: 'PATCH',\n\t\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\t\tadd_scopes: [ 'public_repo' ]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\t// NOTE: we could get here if the access token expired, so need to handle this case\n\t\t\t\t\t// (possibly by redirecting to /login).\n\t\t\t\t\t// TODO: handle with general need-to-login redirect when implemented.\n\t\t\t\t\tconsole.error(\"Error getting existing authorizations:\", error);\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t)\n\t\t\t.then(\n\t\t\t\tresponse => {\n\t\t\t\t\tdebugger;\n\t\t\t\t\treturn { userHasWriteAccess: true };\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\tconsole.error(\"Error adding write access:\", error);\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch(error => {\n\t\t\t\t// fail loudly if the application errors further down the promise chain.\n\t\t\t\tthrow error;\n\t\t\t});\n\n\t\t},\n\n\n\n\t\t// ================================================\n\t\t// UTILITIES\n\t\t// ================================================\n\n\t\t/**\n\t\t * Authentication is not necessary for many GitHub API methods,\n\t\t * but go ahead and auth calls if logged in because\n\t\t * GitHub grants higher rate limits for authed calls.\n\t\t */\n\t\tbuildAuthHeader () {\n\n\t\t\tlet token = auth.getToken();\n\t\t\tif (token) {\n\n\t\t\t\tlet headers = new Headers();\n\t\t\t\theaders.append('Authorization', `token ${ token }`);\n\t\t\t\treturn { headers };\n\n\t\t\t} else {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n};\n",
                "subject": "Add description to a README and use entered 'name' as the repo description.",
                "message": "Add description to a README and use entered 'name' as the repo description.\n",
                "lang": "JavaScript",
                "license": "bsd-2-clause",
                "repos": "stamen/open-redistricting,stamen/open-redistricting"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10288,
            "row": {
                "commit": "feb809f83682ef866bd2fc5b4301e8969e3306ae",
                "old_file": "js/notify-manager.js",
                "new_file": "js/notify-manager.js",
                "old_contents": "var NotifyManager = {\n    init: function() {},\n\n    getWrapper: function(elem) {\n        return $(elem).find('.notifyjs-wrapper');\n    },\n\n    hide: function(elem) {\n        NotifyManager.getWrapper(elem).trigger('notify-hide');\n    },\n\n    onclick: function(elem, callback) {\n        /*\n        This method will attach click event to whole notification box\n        regardless of original click event in `notifyjs`.\n        */\n        NotifyManager.getWrapper(elem).click(callback);\n    },\n\n    playlistChangeNotify: function(success) {\n        if (success) {\n            $.notify(\n                getMsg('added'),\n                {\n                    position: 'top right',\n                    className: 'success',\n                    autoHide: 'true'\n                }\n            );\n        } else {\n            $.notify(\n                getMsg('alreadyOnPlaylist'),\n                {\n                    position: 'top right',\n                    className: 'warn',\n                    autoHide: 'true'\n                }\n            );\n        }\n    },\n\n    sharePlaylist: function(success, url) {\n        var msg = success ? getMsg('shared') + url : getMsg('cannotShare');\n        var style = success ? 'success' : 'warn';\n        $('.playlist-section .playlist-footer').notify(\n            msg,\n            {\n                position: 'top left',\n                className: style,\n                autoHide: true,\n                autoHideDelay: 10000,\n                clickToHide: false\n            }\n        );\n    },\n\n    playlistLoaded: function() {\n        if (!notifyReady) {\n            delayNotify(NotifyManager.playlistLoaded);\n            return;\n        }\n        $.notify(\n            getMsg('loaded'),\n            {\n                position: 'top right',\n                className: 'success',\n                autoHide: true\n            }\n        );\n    },\n\n    playlistCleared: function() {\n        $('.clear-playlist-button').notify(\n            getMsg('cleared'),\n            {\n                position: 'top right',\n                className: 'success',\n                autoHide: true\n            }\n        );\n    },\n\n    invalidAdderUrl: function() {\n        $('#add-by-url-input').notify(\n            getMsg('invalidUrl'),\n            {\n                position: 'bottom left',\n                className: 'error',\n                autoHide: true\n            }\n        );\n    },\n\n    inSharedPlaylist: function() {\n        // XXX: Temporal way to delay msg.\n        // Should fix the way to handle delaying.\n        if (!notifyReady) {\n            delayNotify(NotifyManager.inSharedPlaylist);\n            return;\n        }\n\n        $.notify(\n            getMsg('inSharedPlaylist'),\n            {\n                position: 'bottom left',\n                className: 'success',\n                clickToHide: true,\n                autoHide: false\n            }\n        );\n    },\n\n    notPlayable: function(title) {\n        $.notify(\n            getMsg('notPlayable') + title.slice(0, 40) + '...',\n            {\n                position: 'top right',\n                className: 'error',\n                clickToHide: true,\n                autoHide: true,\n                autoHideDelay: 10000\n            }\n        );\n    },\n\n    artistUrl: function(artist, url) {\n        $('.input-field-suppliment').notify(\n            artist + getMsg('artistUrl') + url,\n            {\n                position: 'top right',\n                className: 'info',\n                clickToHide: false,\n                autoHide: true,\n                autoHideDelay: 60000\n            }\n        );\n    },\n};\n\nfunction delayNotify(method) {\n    setTimeout(function() {\n        method();\n    }, 1000);\n    return;\n}\n\nfunction onNotifyReady() {\n    notifyReady = true;\n};\n",
                "new_contents": "var NotifyManager = {\n    init: function() {},\n\n    getWrapper: function(elem) {\n        return $(elem).find('.notifyjs-wrapper');\n    },\n\n    hide: function(elem) {\n        NotifyManager.getWrapper(elem).trigger('notify-hide');\n    },\n\n    onclick: function(elem, callback) {\n        /*\n        This method will attach click event to whole notification box\n        regardless of original click event in `notifyjs`.\n        */\n        var box = NotifyManager.getWrapper(elem);\n        box.unbind('click');\n        box.click(callback);\n    },\n\n    playlistChangeNotify: function(success) {\n        if (success) {\n            $.notify(\n                getMsg('added'),\n                {\n                    position: 'top right',\n                    className: 'success',\n                    autoHide: 'true'\n                }\n            );\n        } else {\n            $.notify(\n                getMsg('alreadyOnPlaylist'),\n                {\n                    position: 'top right',\n                    className: 'warn',\n                    autoHide: 'true'\n                }\n            );\n        }\n    },\n\n    sharePlaylist: function(success, url) {\n        var msg = success ? getMsg('shared') + url : getMsg('cannotShare');\n        var style = success ? 'success' : 'warn';\n        $('.playlist-section .playlist-footer').notify(\n            msg,\n            {\n                position: 'top left',\n                className: style,\n                autoHide: true,\n                autoHideDelay: 10000,\n                clickToHide: false\n            }\n        );\n    },\n\n    playlistLoaded: function() {\n        if (!notifyReady) {\n            delayNotify(NotifyManager.playlistLoaded);\n            return;\n        }\n        $.notify(\n            getMsg('loaded'),\n            {\n                position: 'top right',\n                className: 'success',\n                autoHide: true\n            }\n        );\n    },\n\n    playlistCleared: function() {\n        $('.clear-playlist-button').notify(\n            getMsg('cleared'),\n            {\n                position: 'top right',\n                className: 'success',\n                autoHide: true\n            }\n        );\n    },\n\n    invalidAdderUrl: function() {\n        $('#add-by-url-input').notify(\n            getMsg('invalidUrl'),\n            {\n                position: 'bottom left',\n                className: 'error',\n                autoHide: true\n            }\n        );\n    },\n\n    inSharedPlaylist: function() {\n        // XXX: Temporal way to delay msg.\n        // Should fix the way to handle delaying.\n        if (!notifyReady) {\n            delayNotify(NotifyManager.inSharedPlaylist);\n            return;\n        }\n\n        $.notify(\n            getMsg('inSharedPlaylist'),\n            {\n                position: 'bottom left',\n                className: 'success',\n                clickToHide: true,\n                autoHide: false\n            }\n        );\n    },\n\n    notPlayable: function(title) {\n        $.notify(\n            getMsg('notPlayable') + title.slice(0, 40) + '...',\n            {\n                position: 'top right',\n                className: 'error',\n                clickToHide: true,\n                autoHide: true,\n                autoHideDelay: 10000\n            }\n        );\n    },\n\n    artistUrl: function(artist, url) {\n        $('.input-field-suppliment').notify(\n            artist + getMsg('artistUrl') + url,\n            {\n                position: 'top right',\n                className: 'info',\n                clickToHide: false,\n                autoHide: true,\n                autoHideDelay: 60000\n            }\n        );\n    },\n};\n\nfunction delayNotify(method) {\n    setTimeout(function() {\n        method();\n    }, 1000);\n    return;\n}\n\nfunction onNotifyReady() {\n    notifyReady = true;\n};\n",
                "subject": "should unbind existing click event",
                "message": "should unbind existing click event\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "daftshady/dropbeat,daftshady/dropbeat,daftshady/dropbeat,daftshady/dropbeat"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10289,
            "row": {
                "commit": "2ded03a61d02969b167bd7182443eb0cfff365cd",
                "old_file": "rd_ui/app/scripts/controllers/dashboard.js",
                "new_file": "rd_ui/app/scripts/controllers/dashboard.js",
                "old_contents": "(function() {\n  var DashboardCtrl = function($scope, Events, Widget, $routeParams, $location, $http, $timeout, $q, Dashboard) {\n    $scope.refreshEnabled = false;\n    $scope.refreshRate = 60;\n\n    var loadDashboard = _.throttle(function() {\n      $scope.dashboard = Dashboard.get({ slug: $routeParams.dashboardSlug }, function (dashboard) {\n        Events.record(currentUser, \"view\", \"dashboard\", dashboard.id);\n\n        $scope.$parent.pageTitle = dashboard.name;\n\n        var promises = [];\n\n        $scope.dashboard.widgets = _.map($scope.dashboard.widgets, function (row) {\n          return _.map(row, function (widget) {\n            var w = new Widget(widget);\n\n            if (w.visualization) {\n              promises.push(w.getQuery().getQueryResult().toPromise());\n            }\n\n            return w;\n          });\n        });\n\n        $q.all(promises).then(function(queryResults) {\n          var filters = {};\n          _.each(queryResults, function(queryResult) {\n            var queryFilters = queryResult.getFilters();\n            _.each(queryFilters, function (queryFilter) {\n              var hasQueryStringValue = _.has($location.search(), queryFilter.name);\n\n              if (!(hasQueryStringValue || dashboard.dashboard_filters_enabled)) {\n                // If dashboard filters not enabled, or no query string value given, skip filters linking.\n                return;\n              }\n\n              if (!_.has(filters, queryFilter.name)) {\n                var filter = _.extend({}, queryFilter);\n                filters[filter.name] = filter;\n                filters[filter.name].originFilters = [];\n                if (hasQueryStringValue) {\n                  filter.current = $location.search()[filter.name];\n                }\n\n                $scope.$watch(function () { return filter.current }, function (value) {\n                  _.each(filter.originFilters, function (originFilter) {\n                    originFilter.current = value;\n                  });\n                });\n              }\n\n              // TODO: merge values.\n              filters[queryFilter.name].originFilters.push(queryFilter);\n            });\n          });\n\n          $scope.filters = _.values(filters);\n        });\n\n\n      }, function () {\n        // error...\n        // try again. we wrap loadDashboard with throttle so it doesn't happen too often.\\\n        // we might want to consider exponential backoff and also move this as a general solution in $http/$resource for\n        // all AJAX calls.\n        loadDashboard();\n      });\n    }, 1000);\n\n    loadDashboard();\n\n    var autoRefresh = function() {\n      if ($scope.refreshEnabled) {\n        $timeout(function() {\n          Dashboard.get({\n            slug: $routeParams.dashboardSlug\n          }, function(dashboard) {\n            var newWidgets = _.groupBy(_.flatten(dashboard.widgets), 'id');\n\n            _.each($scope.dashboard.widgets, function(row) {\n              _.each(row, function(widget, i) {\n                var newWidget = newWidgets[widget.id];\n                if (newWidget && newWidget[0].visualization.query.latest_query_data_id != widget.visualization.query.latest_query_data_id) {\n                  row[i] = new Widget(newWidget[0]);\n                }\n              });\n            });\n\n            autoRefresh();\n          });\n\n        }, $scope.refreshRate);\n      }\n    };\n\n    $scope.triggerRefresh = function() {\n      $scope.refreshEnabled = !$scope.refreshEnabled;\n\n      Events.record(currentUser, \"autorefresh\", \"dashboard\", dashboard.id, {'enable': $scope.refreshEnabled});\n\n      if ($scope.refreshEnabled) {\n        var refreshRate = _.min(_.map(_.flatten($scope.dashboard.widgets), function(widget) {\n          var schedule = widget.visualization.query.schedule;\n          if (schedule === null || schedule.match(/\\d\\d:\\d\\d/) !== null) {\n            return 60;\n          }\n          return widget.visualization.query.schedule;\n        }));\n\n        $scope.refreshRate = _.max([120, refreshRate * 2]) * 1000;\n\n        autoRefresh();\n      }\n    };\n  };\n\n  var WidgetCtrl = function($scope, $location, Events, Query) {\n    $scope.disableWidget = {'visibility': 'visible'};\n    $scope.checkWidth = function (width) {\n    console.log('ACA TAAAAAAA: ' + width);\n     if (width == 0)\n        $scope.disableWidget = {'visibility': 'hidden'};\n    }\n\n    $scope.deleteWidget = function() {\n      if (!confirm('Are you sure you want to remove \"' + $scope.widget.getName() + '\" from the dashboard?')) {\n        return;\n      }\n\n      Events.record(currentUser, \"delete\", \"widget\", $scope.widget.id);\n\n      $scope.widget.$delete(function() {\n        $scope.dashboard.widgets = _.map($scope.dashboard.widgets, function(row) {\n          return _.filter(row, function(widget) {\n            return widget.id != undefined;\n          })\n        });\n      });\n    };\n\n    Events.record(currentUser, \"view\", \"widget\", $scope.widget.id);\n\n    if ($scope.widget.visualization) {\n      Events.record(currentUser, \"view\", \"query\", $scope.widget.visualization.query.id);\n      Events.record(currentUser, \"view\", \"visualization\", $scope.widget.visualization.id);\n\n      $scope.query = $scope.widget.getQuery();\n      var parameters = Query.collectParamsFromQueryString($location, $scope.query);\n      var maxAge = $location.search()['maxAge'];\n      $scope.queryResult = $scope.query.getQueryResult(maxAge, parameters);\n\n      $scope.type = 'visualization';\n    } else {\n      $scope.type = 'textbox';\n    }\n  };\n\n  angular.module('redash.controllers')\n    .controller('DashboardCtrl', ['$scope', 'Events', 'Widget', '$routeParams', '$location', '$http', '$timeout', '$q', 'Dashboard', DashboardCtrl])\n    .controller('WidgetCtrl', ['$scope', '$location', 'Events', 'Query', WidgetCtrl])\n\n})();\n",
                "new_contents": "(function() {\n  var DashboardCtrl = function($scope, Events, Widget, $routeParams, $location, $http, $timeout, $q, Dashboard) {\n    $scope.refreshEnabled = false;\n    $scope.refreshRate = 60;\n\n    var loadDashboard = _.throttle(function() {\n      $scope.dashboard = Dashboard.get({ slug: $routeParams.dashboardSlug }, function (dashboard) {\n        Events.record(currentUser, \"view\", \"dashboard\", dashboard.id);\n\n        $scope.$parent.pageTitle = dashboard.name;\n\n        var promises = [];\n\n        $scope.dashboard.widgets = _.map($scope.dashboard.widgets, function (row) {\n          return _.map(row, function (widget) {\n            var w = new Widget(widget);\n\n            if (w.visualization) {\n              promises.push(w.getQuery().getQueryResult().toPromise());\n            }\n\n            return w;\n          });\n        });\n\n        $q.all(promises).then(function(queryResults) {\n          var filters = {};\n          _.each(queryResults, function(queryResult) {\n            var queryFilters = queryResult.getFilters();\n            _.each(queryFilters, function (queryFilter) {\n              var hasQueryStringValue = _.has($location.search(), queryFilter.name);\n\n              if (!(hasQueryStringValue || dashboard.dashboard_filters_enabled)) {\n                // If dashboard filters not enabled, or no query string value given, skip filters linking.\n                return;\n              }\n\n              if (!_.has(filters, queryFilter.name)) {\n                var filter = _.extend({}, queryFilter);\n                filters[filter.name] = filter;\n                filters[filter.name].originFilters = [];\n                if (hasQueryStringValue) {\n                  filter.current = $location.search()[filter.name];\n                }\n\n                $scope.$watch(function () { return filter.current }, function (value) {\n                  _.each(filter.originFilters, function (originFilter) {\n                    originFilter.current = value;\n                  });\n                });\n              }\n\n              // TODO: merge values.\n              filters[queryFilter.name].originFilters.push(queryFilter);\n            });\n          });\n\n          $scope.filters = _.values(filters);\n        });\n\n\n      }, function () {\n        // error...\n        // try again. we wrap loadDashboard with throttle so it doesn't happen too often.\\\n        // we might want to consider exponential backoff and also move this as a general solution in $http/$resource for\n        // all AJAX calls.\n        loadDashboard();\n      });\n    }, 1000);\n\n    loadDashboard();\n\n    var autoRefresh = function() {\n      if ($scope.refreshEnabled) {\n        $timeout(function() {\n          Dashboard.get({\n            slug: $routeParams.dashboardSlug\n          }, function(dashboard) {\n            var newWidgets = _.groupBy(_.flatten(dashboard.widgets), 'id');\n\n            _.each($scope.dashboard.widgets, function(row) {\n              _.each(row, function(widget, i) {\n                var newWidget = newWidgets[widget.id];\n                if (newWidget && newWidget[0].visualization.query.latest_query_data_id != widget.visualization.query.latest_query_data_id) {\n                  row[i] = new Widget(newWidget[0]);\n                }\n              });\n            });\n\n            autoRefresh();\n          });\n\n        }, $scope.refreshRate);\n      }\n    };\n\n    $scope.triggerRefresh = function() {\n      $scope.refreshEnabled = !$scope.refreshEnabled;\n\n      Events.record(currentUser, \"autorefresh\", \"dashboard\", dashboard.id, {'enable': $scope.refreshEnabled});\n\n      if ($scope.refreshEnabled) {\n        var refreshRate = _.min(_.map(_.flatten($scope.dashboard.widgets), function(widget) {\n          var schedule = widget.visualization.query.schedule;\n          if (schedule === null || schedule.match(/\\d\\d:\\d\\d/) !== null) {\n            return 60;\n          }\n          return widget.visualization.query.schedule;\n        }));\n\n        $scope.refreshRate = _.max([120, refreshRate * 2]) * 1000;\n\n        autoRefresh();\n      }\n    };\n  };\n\n  var WidgetCtrl = function($scope, $location, Events, Query) {\n    $scope.disableWidget = {'visibility': 'visible'};\n    $scope.checkWidth = function (width) {\n     if (width == 0)\n        $scope.disableWidget = {'visibility': 'hidden'};\n    }\n\n    $scope.deleteWidget = function() {\n      if (!confirm('Are you sure you want to remove \"' + $scope.widget.getName() + '\" from the dashboard?')) {\n        return;\n      }\n\n      Events.record(currentUser, \"delete\", \"widget\", $scope.widget.id);\n\n      $scope.widget.$delete(function() {\n        $scope.dashboard.widgets = _.map($scope.dashboard.widgets, function(row) {\n          return _.filter(row, function(widget) {\n            return widget.id != undefined;\n          })\n        });\n      });\n    };\n\n    Events.record(currentUser, \"view\", \"widget\", $scope.widget.id);\n\n    if ($scope.widget.visualization) {\n      Events.record(currentUser, \"view\", \"query\", $scope.widget.visualization.query.id);\n      Events.record(currentUser, \"view\", \"visualization\", $scope.widget.visualization.id);\n\n      $scope.query = $scope.widget.getQuery();\n      var parameters = Query.collectParamsFromQueryString($location, $scope.query);\n      var maxAge = $location.search()['maxAge'];\n      $scope.queryResult = $scope.query.getQueryResult(maxAge, parameters);\n\n      $scope.type = 'visualization';\n    } else {\n      $scope.type = 'textbox';\n    }\n  };\n\n  angular.module('redash.controllers')\n    .controller('DashboardCtrl', ['$scope', 'Events', 'Widget', '$routeParams', '$location', '$http', '$timeout', '$q', 'Dashboard', DashboardCtrl])\n    .controller('WidgetCtrl', ['$scope', '$location', 'Events', 'Query', WidgetCtrl])\n\n})();\n",
                "subject": "Hidden Widget final version",
                "message": "Hidden Widget final version\n",
                "lang": "JavaScript",
                "license": "bsd-2-clause",
                "repos": "jmvasquez/redashtest,jmvasquez/redashtest,jmvasquez/redashtest,jmvasquez/redashtest,jmvasquez/redashtest"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10290,
            "row": {
                "commit": "526d162002f14a4821d17379cb9bc462a1caa519",
                "old_file": "examples/dev/large-document/index.js",
                "new_file": "examples/dev/large-document/index.js",
                "old_contents": "/* eslint-disable no-console */\n\nimport { Editor, Raw } from '../..'\nimport React from 'react'\nimport faker from 'faker'\n\nconst HEADINGS = 100\nconst PARAGRAPHS = 8 // Paragraphs per heading\n\n/**\n * Define a schema.\n *\n * @type {Object}\n */\n\nconst schema = {\n  nodes: {\n    'heading': props => <h1 {...props.attributes}>{props.children}</h1>,\n    'paragraph': props => <p {...props.attributes} style={{ marginBottom: 20 }}>{props.children}</p>,\n  },\n  marks: {\n    bold: {\n      fontWeight: 'bold'\n    },\n    code: {\n      fontFamily: 'monospace',\n      backgroundColor: '#eee',\n      padding: '3px',\n      borderRadius: '4px'\n    },\n    italic: {\n      fontStyle: 'italic'\n    },\n    underlined: {\n      textDecoration: 'underline'\n    }\n  }\n}\n\nconst nodes = []\n\nfor (let h = 0; h < HEADINGS; h++) {\n  nodes.push({\n    kind: 'block',\n    type: 'heading',\n    nodes: [{ kind: 'text', text: faker.lorem.sentence() }]\n  })\n\n  for (let p = 0; p < PARAGRAPHS; p++) {\n    nodes.push({\n      kind: 'block',\n      type: 'paragraph',\n      nodes: [{ kind: 'text', text: faker.lorem.paragraph() }]\n    })\n  }\n}\n\n/**\n * The large text example.\n *\n * @type {Component}\n */\n\nclass LargeDocument extends React.Component {\n\n  /**\n   * Deserialize the initial editor state.\n   *\n   * @type {Object}\n   */\n\n  constructor() {\n    super()\n    console.time('deserializeLargeDocument')\n    this.state = { state: Raw.deserialize({ nodes }, { normalize: false, terse: true }) }\n    console.timeEnd('deserializeLargeDocument')\n  }\n\n  /**\n   * On change.\n   *\n   * @param {State} state\n   */\n\n  onChange = (state) => {\n    this.setState({ state })\n  }\n\n  /**\n   * On key down, if it's a formatting command toggle a mark.\n   *\n   * @param {Event} e\n   * @param {Object} data\n   * @param {State} state\n   * @return {State}\n   */\n\n  onKeyDown = (e, data, state) => {\n    if (!data.isMod) return\n    let mark\n\n    switch (data.key) {\n      case 'b':\n        mark = 'bold'\n        break\n      case 'i':\n        mark = 'italic'\n        break\n      case 'u':\n        mark = 'underlined'\n        break\n      case '`':\n        mark = 'code'\n        break\n      default:\n        return\n    }\n\n    state = state\n      .transform()\n      .toggleMark(mark)\n      .apply()\n\n    e.preventDefault()\n    return state\n  }\n\n  /**\n   * Render the editor.\n   *\n   * @return {Component} component\n   */\n\n  render = () => {\n    return (\n      <Editor\n        placeholder={'Enter some plain text...'}\n        schema={schema}\n        spellCheck={false}\n        state={this.state.state}\n        onChange={this.onChange}\n        onKeyDown={this.onKeyDown}\n      />\n    )\n  }\n\n}\n\n/**\n * Export.\n */\n\nexport default LargeDocument\n",
                "new_contents": "/* eslint-disable no-console */\n\nimport { Editor, Raw } from '../../..'\nimport React from 'react'\nimport faker from 'faker'\n\nconst HEADINGS = 100\nconst PARAGRAPHS = 8 // Paragraphs per heading\n\n/**\n * Define a schema.\n *\n * @type {Object}\n */\n\nconst schema = {\n  nodes: {\n    'heading': props => <h1 {...props.attributes}>{props.children}</h1>,\n    'paragraph': props => <p {...props.attributes} style={{ marginBottom: 20 }}>{props.children}</p>,\n  },\n  marks: {\n    bold: {\n      fontWeight: 'bold'\n    },\n    code: {\n      fontFamily: 'monospace',\n      backgroundColor: '#eee',\n      padding: '3px',\n      borderRadius: '4px'\n    },\n    italic: {\n      fontStyle: 'italic'\n    },\n    underlined: {\n      textDecoration: 'underline'\n    }\n  }\n}\n\nconst nodes = []\n\nfor (let h = 0; h < HEADINGS; h++) {\n  nodes.push({\n    kind: 'block',\n    type: 'heading',\n    nodes: [{ kind: 'text', text: faker.lorem.sentence() }]\n  })\n\n  for (let p = 0; p < PARAGRAPHS; p++) {\n    nodes.push({\n      kind: 'block',\n      type: 'paragraph',\n      nodes: [{ kind: 'text', text: faker.lorem.paragraph() }]\n    })\n  }\n}\n\n/**\n * The large text example.\n *\n * @type {Component}\n */\n\nclass LargeDocument extends React.Component {\n\n  /**\n   * Deserialize the initial editor state.\n   *\n   * @type {Object}\n   */\n\n  constructor() {\n    super()\n    console.time('deserializeLargeDocument')\n    this.state = { state: Raw.deserialize({ nodes }, { normalize: false, terse: true }) }\n    console.timeEnd('deserializeLargeDocument')\n  }\n\n  /**\n   * On change.\n   *\n   * @param {State} state\n   */\n\n  onChange = (state) => {\n    this.setState({ state })\n  }\n\n  /**\n   * On key down, if it's a formatting command toggle a mark.\n   *\n   * @param {Event} e\n   * @param {Object} data\n   * @param {State} state\n   * @return {State}\n   */\n\n  onKeyDown = (e, data, state) => {\n    if (!data.isMod) return\n    let mark\n\n    switch (data.key) {\n      case 'b':\n        mark = 'bold'\n        break\n      case 'i':\n        mark = 'italic'\n        break\n      case 'u':\n        mark = 'underlined'\n        break\n      case '`':\n        mark = 'code'\n        break\n      default:\n        return\n    }\n\n    state = state\n      .transform()\n      .toggleMark(mark)\n      .apply()\n\n    e.preventDefault()\n    return state\n  }\n\n  /**\n   * Render the editor.\n   *\n   * @return {Component} component\n   */\n\n  render = () => {\n    return (\n      <Editor\n        placeholder={'Enter some plain text...'}\n        schema={schema}\n        spellCheck={false}\n        state={this.state.state}\n        onChange={this.onChange}\n        onKeyDown={this.onKeyDown}\n      />\n    )\n  }\n\n}\n\n/**\n * Export.\n */\n\nexport default LargeDocument\n",
                "subject": "fix large document example imports",
                "message": "fix large document example imports\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "isubastiCadmus/slate,6174/slate,AlbertHilb/slate,ashutoshrishi/slate,ianstormtaylor/slate,ianstormtaylor/slate"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10291,
            "row": {
                "commit": "a281fd852e60d2fa5a2bcf77a64bbd29d3ed2d6e",
                "old_file": "react/components/UI/GenericButton/index.js",
                "new_file": "react/components/UI/GenericButton/index.js",
                "old_contents": "import styled, { css } from 'styled-components';\nimport { themeGet, fontSize, space, alignSelf } from 'styled-system';\n\nimport { defaultTo, preset } from 'react/styles/functions';\nimport { antialiased } from 'react/styles/mixins';\n\nexport const BUTTON_DEFAULT_FONT_SIZE = 3;\nexport const BUTTON_VARIANTS = { LARGE: 'LARGE', SMALL: 'SMALL' };\nexport const BUTTON_LARGE_PADDING = { px: 8, py: 5 };\nexport const BUTTON_SMALL_PADDING = { px: 6, py: 5 };\nexport const BUTTON_SMALL_BORDER_WIDTH = '1px';\nexport const BUTTON_LARGE_BORDER_WIDTH = '2px';\nexport const BUTTON_BORDER_RADIUS = '0.25em';\n\nexport const buttonSize = x => (\n  defaultTo(x.f, x.fontSize) < BUTTON_DEFAULT_FONT_SIZE\n    ? BUTTON_VARIANTS.SMALL\n    : BUTTON_VARIANTS.LARGE\n);\n\nexport const buttonColor = ({ color, theme }) => {\n  if (color) {\n    const value = themeGet(`colors.${color}`, 'colors.gray.base')({ theme });\n\n    return `\n      color: ${value};\n      border-color: ${value};\n    `;\n  }\n\n  return '';\n};\n\nexport const buttonPadding = x => preset(space, {\n  LARGE: BUTTON_LARGE_PADDING,\n  SMALL: BUTTON_SMALL_PADDING,\n}[buttonSize(x)]);\n\nexport const buttonBorderWidth = x => ({\n  LARGE: BUTTON_LARGE_BORDER_WIDTH,\n  SMALL: BUTTON_SMALL_BORDER_WIDTH,\n}[buttonSize(x)]);\n\nconst activeMixin = css`\n  border: ${buttonBorderWidth} solid ${x => x.theme.colors.gray.bold};\n  color: ${x => x.theme.colors.gray.bold};\n`;\n\nconst hoverMixin = css`\n  border: ${buttonBorderWidth} solid ${x => x.theme.colors.gray.medium};\n  color: ${x => x.theme.colors.gray.bold};\n`;\n\nconst disabledMixin = css`\n  pointer-events: none;\n  opacity: 0.5;\n`;\n\nexport const mixin = css`\n  all: initial;\n  display: inline-block;\n  ${preset(fontSize, { f: BUTTON_DEFAULT_FONT_SIZE })}\n  border: ${buttonBorderWidth} solid ${x => x.theme.colors.gray.regular};\n  border-radius: ${BUTTON_BORDER_RADIUS};\n  font-family: ${x => x.theme.fonts.sans};\n  font-weight: bold;\n  line-height: 1;\n  user-select: none;\n  cursor: pointer;\n  text-align: center;\n  ${alignSelf}\n  ${buttonPadding}\n  ${buttonColor}\n  ${antialiased}\n\n  ${x => x.minWidth && `min-width: ${x.minWidth};`}\n\n  ${x => x.hover && hoverMixin}\n  &:hover { ${hoverMixin} }\n\n  ${x => x.active && activeMixin}\n  &:active { ${activeMixin} }\n\n  ${x => x.disabled && disabledMixin}\n`;\n\nexport const GenericButtonLink = styled.a`\n  ${mixin}\n`;\n\nexport const GenericButton = styled.button`\n  ${mixin}\n`;\n\nexport default GenericButtonLink;\n",
                "new_contents": "import styled, { css } from 'styled-components';\nimport { themeGet, fontSize, space, alignSelf } from 'styled-system';\n\nimport { defaultTo, preset } from 'react/styles/functions';\nimport { antialiased } from 'react/styles/mixins';\n\nexport const BUTTON_DEFAULT_FONT_SIZE = 3;\nexport const BUTTON_VARIANTS = { LARGE: 'LARGE', SMALL: 'SMALL' };\nexport const BUTTON_LARGE_PADDING = { px: 8, py: 5 };\nexport const BUTTON_SMALL_PADDING = { px: 6, py: 5 };\nexport const BUTTON_SMALL_BORDER_WIDTH = '1px';\nexport const BUTTON_LARGE_BORDER_WIDTH = '2px';\nexport const BUTTON_BORDER_RADIUS = '0.25em';\n\nexport const buttonSize = x => (\n  defaultTo(x.f, x.fontSize) < BUTTON_DEFAULT_FONT_SIZE\n    ? BUTTON_VARIANTS.SMALL\n    : BUTTON_VARIANTS.LARGE\n);\n\nexport const buttonColor = ({ color, theme }) => {\n  if (color) {\n    const value = themeGet(`colors.${color}`, 'colors.gray.base')({ theme });\n\n    return `\n      color: ${value};\n      border-color: ${value};\n    `;\n  }\n\n  return '';\n};\n\nexport const buttonPadding = x => preset(space, {\n  LARGE: BUTTON_LARGE_PADDING,\n  SMALL: BUTTON_SMALL_PADDING,\n}[buttonSize(x)]);\n\nexport const buttonBorderWidth = x => ({\n  LARGE: BUTTON_LARGE_BORDER_WIDTH,\n  SMALL: BUTTON_SMALL_BORDER_WIDTH,\n}[buttonSize(x)]);\n\nconst activeMixin = css`\n  border: ${buttonBorderWidth} solid ${x => x.theme.colors.gray.bold};\n  color: ${x => x.theme.colors.gray.bold};\n`;\n\nconst hoverMixin = css`\n  border: ${buttonBorderWidth} solid ${x => x.theme.colors.gray.medium};\n  color: ${x => x.theme.colors.gray.bold};\n`;\n\nconst disabledMixin = css`\n  pointer-events: none;\n  opacity: 0.5;\n`;\n\nexport const mixin = css`\n  all: initial;\n  display: inline-block;\n  ${preset(fontSize, { f: BUTTON_DEFAULT_FONT_SIZE })}\n  border: ${buttonBorderWidth} solid ${x => x.theme.colors.gray.regular};\n  border-radius: ${BUTTON_BORDER_RADIUS};\n  font-family: ${x => x.theme.fonts.sans};\n  font-weight: bold;\n  line-height: 1;\n  user-select: none;\n  cursor: pointer;\n  text-align: center;\n  ${alignSelf}\n  ${buttonPadding}\n  ${buttonColor}\n  ${antialiased}\n\n  ${x => x.minWidth && `min-width: ${x.minWidth};`}\n\n  ${x => x.hover && hoverMixin}\n  &:hover { ${hoverMixin} }\n\n  ${x => x.active && activeMixin}\n  &:active { ${activeMixin} }\n\n  ${x => x.disabled && disabledMixin}\n`;\n\nexport const GenericButtonLink = styled.a`\n  ${mixin}\n`;\n\nexport const GenericButton = styled.button`\n  ${mixin}\n`;\n\nexport const DividerButton = styled.button.attrs({ f: 4 })`\n  all: initial;\n  text-align: center;\n  cursor: pointer;\n  display: block;\n  width: 100%;\n  ${preset(fontSize, { f: BUTTON_DEFAULT_FONT_SIZE })}\n  font-weight: bold;\n  font-family: ${x => x.theme.fonts.sans};\n  border-top: 1px solid ${x => x.theme.colors.gray.regular};\n  color: ${x => x.theme.colors.gray.regular};\n  padding: ${x => x.theme.space[5]} 0;\n\n  &:hover {\n    border-top-color: ${x => x.theme.colors.gray.bold};\n    color: ${x => x.theme.colors.gray.bold};\n  }\n\n  &:active {\n    border-top-color: ${x => x.theme.colors.gray.active};\n    color: ${x => x.theme.colors.gray.active};\n  }\n`;\n\nexport default GenericButtonLink;\n",
                "subject": "Add DividerButton and style TitledDialog more",
                "message": "Add DividerButton and style TitledDialog more\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "aredotna/ervell,aredotna/ervell,aredotna/ervell,aredotna/ervell,aredotna/ervell"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10292,
            "row": {
                "commit": "0500ff761befb1f69f9ff47a9e22df144f8c86db",
                "old_file": "src/Blob.js",
                "new_file": "src/Blob.js",
                "old_contents": "var Action = require('./engine/Action');\n\nfunction BlobComponent(args) {\n  this.velX = args.velX || 0;\n  this.velY = args.velY || 0;\n  this.parent = args.parent;\n  this.weight = args.weight || 0.15;\n  this.weightCap = args.weightCap;\n}\n\nvar BlobSystem = {\n  priority: 1500,\n  onAddedToEngine: function(engine) {\n    this.engine = engine;\n    this.entities = engine.e('blob', 'pos');\n  },\n  update: function(delta) {\n    for(var i = 0; i < this.entities.length; ++i) {\n      var entity = this.entities[i];\n      entity.c('pos').x += entity.c('blob').velX / 1000 * delta;\n      entity.c('pos').y += entity.c('blob').velY / 1000 * delta;\n      entity.c('blob').velX *= Math.pow(0.994, 1 / 32 * delta);\n      entity.c('blob').velY *= Math.pow(0.994, 1 / 32 * delta);\n      entity.c('pos').radius = Math.sqrt(entity.c('blob').weight);\n      // Find parent if available\n      if(entity.c('blob').weightCap) {\n        entity.c('blob').weight += (entity.c('blob').weightCap - entity.c('blob').weight) / 4;\n        if(Math.abs(entity.c('blob').weight - entity.c('blob').weightCap) < 1) {\n          entity.c('blob').weight = entity.c('blob').weightCap;\n          entity.c('blob').weightCap = null;\n        }\n      }\n      if(entity.c('blob').weightCap) continue;\n      // TODO: Implement better algorithm of this, such as QuadTree\n      for(var j = i+1; j < this.entities.length; ++j) {\n        var other = this.entities[j];\n        if(other.c('blob').weightCap) continue;\n        if(entity.c('blob').parent == other.id) {\n          if(!entity.c('pos').collides(other.c('pos'))) {\n           entity.c('blob').parent = null;\n          }\n          continue;\n        }\n        if(other.c('blob').parent == entity.id) {\n          if(!entity.c('pos').collides(other.c('pos'))) {\n            other.c('blob').parent = null;\n          }\n          continue;\n        }\n        if(entity.c('pos').collides(other.c('pos'))) {\n          // Bigger one eats smaller one\n          var big, small;\n          var bigPos, smallPos;\n          if(entity.c('pos').radius > other.c('pos').radius) {\n            big = entity;\n            small = other;\n          } else {\n            big = other;\n            small = entity;\n          }\n          bigPos = big.c('pos');\n          smallPos = small.c('pos');\n          var diff = bigPos.radius + smallPos.radius - bigPos.distance(smallPos);\n          var weightGain = Math.min(small.c('blob').weight, Math.max(0, small.c('blob').weight - \n            (smallPos.radius - diff) * (smallPos.radius - diff)));\n          big.c('blob').weight += weightGain;\n          bigPos.radius = Math.sqrt(big.c('blob').weight);\n          small.c('blob').weight -= weightGain;\n          small.c('blob').weight = Math.max(0, small.c('blob').weight);\n          smallPos.radius = Math.sqrt(small.c('blob').weight);\n          big.c('blob').velX += small.c('blob').velX / big.c('blob').weight * weightGain;\n          big.c('blob').velY += small.c('blob').velY / big.c('blob').weight * weightGain;\n        }\n      }\n    }\n    for(var i = 0; i < this.entities.length; ++i) {\n      var entity = this.entities[i];\n      if(entity.c('blob').weight <= 0.1) {\n        this.engine.removeEntity(entity);\n        i--\n      }\n    }\n  }\n}\n\nvar BlobSplitAction = Action.scaffold(function(engine) {\n  var weight = this.entity.c('blob').weight / 2;\n  var direction = Math.random() * Math.PI * 2;\n  engine.e().c('pos', {\n    x: this.entity.c('pos').x,\n    y: this.entity.c('pos').y,\n    radius: 1\n  }).c('blob', {\n    velX: Math.cos(direction) * Math.sqrt(weight) * 3 + this.entity.c('blob').velX,\n    velY: Math.sin(direction) * Math.sqrt(weight) * 3 + this.entity.c('blob').velY,\n    parent: this.entity.id,\n    weightCap: weight,\n    weight: 1\n  }).c('render', {\n    color: this.entity.c('render').color\n  });\n  this.entity.c('blob').weightCap = weight;\n  this.entity.c('blob').velX += Math.cos(direction) * -Math.sqrt(weight) * 3;\n  this.entity.c('blob').velY += Math.sin(direction) * -Math.sqrt(weight) * 3\n  ;\n  this.result = 1;\n});\n\nmodule.exports.component = BlobComponent;\nmodule.exports.system = BlobSystem;\nmodule.exports.splitAction = BlobSplitAction;\n",
                "new_contents": "var Action = require('./engine/Action');\n\nfunction BlobComponent(args) {\n  this.velX = args.velX || 0;\n  this.velY = args.velY || 0;\n  this.parent = args.parent;\n  this.weight = args.weight || 0.15;\n  this.weightCap = args.weightCap;\n}\n\nvar BlobSystem = {\n  priority: 1500,\n  onAddedToEngine: function(engine) {\n    this.engine = engine;\n    this.entities = engine.e('blob', 'pos');\n  },\n  update: function(delta) {\n    for(var i = 0; i < this.entities.length; ++i) {\n      var entity = this.entities[i];\n      entity.c('pos').x += entity.c('blob').velX / 1000 * delta;\n      entity.c('pos').y += entity.c('blob').velY / 1000 * delta;\n      entity.c('blob').velX *= Math.pow(0.994, 1 / 32 * delta);\n      entity.c('blob').velY *= Math.pow(0.994, 1 / 32 * delta);\n      entity.c('pos').radius = Math.sqrt(entity.c('blob').weight);\n      // Find parent if available\n      if(entity.c('blob').weightCap) {\n        entity.c('blob').weight += (entity.c('blob').weightCap - entity.c('blob').weight) / 4;\n        if(Math.abs(entity.c('blob').weight - entity.c('blob').weightCap) < 1) {\n          entity.c('blob').weight = entity.c('blob').weightCap;\n          entity.c('blob').weightCap = null;\n        }\n      }\n      if(entity.c('blob').weightCap) continue;\n      // TODO: Implement better algorithm of this, such as QuadTree\n      for(var j = i+1; j < this.entities.length; ++j) {\n        var other = this.entities[j];\n        if(other.c('blob').weightCap) continue;\n        if(entity.c('blob').parent == other.id) {\n          if(!entity.c('pos').collides(other.c('pos'))) {\n           entity.c('blob').parent = null;\n          }\n          continue;\n        }\n        if(other.c('blob').parent == entity.id) {\n          if(!entity.c('pos').collides(other.c('pos'))) {\n            other.c('blob').parent = null;\n          }\n          continue;\n        }\n        if(entity.c('pos').collides(other.c('pos'))) {\n          // Bigger one eats smaller one\n          var big, small;\n          var bigPos, smallPos;\n          if(entity.c('pos').radius > other.c('pos').radius) {\n            big = entity;\n            small = other;\n          } else {\n            big = other;\n            small = entity;\n          }\n          bigPos = big.c('pos');\n          smallPos = small.c('pos');\n          var diff = bigPos.radius + smallPos.radius - bigPos.distance(smallPos);\n          var weightGain = Math.min(small.c('blob').weight, Math.max(0, small.c('blob').weight - \n            (smallPos.radius - diff) * (smallPos.radius - diff)));\n          if(small.c('blob').weight-weightGain > 10) {\n            weightGain = small.c('blob').weight; \n          } \n          big.c('blob').weight += weightGain;\n          bigPos.radius = Math.sqrt(big.c('blob').weight);\n          small.c('blob').weight -= weightGain;\n          small.c('blob').weight = Math.max(0, small.c('blob').weight);\n          smallPos.radius = Math.sqrt(small.c('blob').weight);\n          big.c('blob').velX += small.c('blob').velX / big.c('blob').weight * weightGain;\n          big.c('blob').velY += small.c('blob').velY / big.c('blob').weight * weightGain;\n        }\n      }\n    }\n    for(var i = 0; i < this.entities.length; ++i) {\n      var entity = this.entities[i];\n      if(entity.c('blob').weight <= 0.1) {\n        this.engine.removeEntity(entity);\n        i--\n      }\n    }\n  }\n}\n\nvar BlobSplitAction = Action.scaffold(function(engine) {\n  var weight = this.entity.c('blob').weight / 2;\n  var direction = Math.random() * Math.PI * 2;\n  engine.e().c('pos', {\n    x: this.entity.c('pos').x,\n    y: this.entity.c('pos').y,\n    radius: 1\n  }).c('blob', {\n    velX: Math.cos(direction) * Math.sqrt(weight) * 3 + this.entity.c('blob').velX,\n    velY: Math.sin(direction) * Math.sqrt(weight) * 3 + this.entity.c('blob').velY,\n    parent: this.entity.id,\n    weightCap: weight,\n    weight: 1\n  }).c('render', {\n    color: this.entity.c('render').color\n  });\n  this.entity.c('blob').weightCap = weight;\n  this.entity.c('blob').velX += Math.cos(direction) * -Math.sqrt(weight) * 3;\n  this.entity.c('blob').velY += Math.sin(direction) * -Math.sqrt(weight) * 3\n  ;\n  this.result = 1;\n});\n\nmodule.exports.component = BlobComponent;\nmodule.exports.system = BlobSystem;\nmodule.exports.splitAction = BlobSplitAction;\n",
                "subject": "Remove tiny particles",
                "message": "Remove tiny particles\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "yoo2001818/Absorb"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10293,
            "row": {
                "commit": "a0971ac713759e74d2ffc62305c2ac53cb9cf9dd",
                "old_file": "src/textlint-rule-alex.js",
                "new_file": "src/textlint-rule-alex.js",
                "old_contents": "// LICENSE : MIT\n\"use strict\";\nimport {RuleHelper} from \"textlint-rule-helper\";\nimport alex from \"alex\";\nconst defaultOptions = {\n    allow: undefined,\n    deny: undefined,\n    noBinary: false,\n    profanitySureness: 0\n};\nmodule.exports = function textlintRuleAlex(context, options = {}) {\n    const {Syntax, RuleError, report, getSource} = context;\n    const helper = new RuleHelper(context);\n    const opts = {...defaultOptions, ...options};\n    console.log('opts', opts);\n    /*\n    { [1:5-1:14: `boogeyman` may be insensitive, use `boogey` instead]\n    message: '`boogeyman` may be insensitive, use `boogey` instead',\n    name: '1:5-1:14',\n    file: '',\n    reason: '`boogeyman` may be insensitive, use `boogey` instead',\n    line: 1,\n    column: 5,\n    location: Position { start: [Object], end: [Object] },\n    fatal: false,\n    ruleId: 'boogeyman-boogeywoman',\n    source: 'retext-equality' }\n     */\n    const reportError = (node, result) => {\n        const ruleError = new RuleError(`[${result.ruleId}] ${result.message}`, {\n            line: result.line - 1,\n            column: result.column - 1\n        });\n        report(node, ruleError);\n    };\n    return {\n        [Syntax.Str](node){\n            if (helper.isChildNode(node, [Syntax.Link, Syntax.Image, Syntax.BlockQuote, Syntax.Emphasis])) {\n                return;\n            }\n            const text = getSource(node);\n            const messages = alex(text, opts).messages;\n            messages.forEach((result) => {\n                reportError(node, result);\n            });\n        }\n    }\n}",
                "new_contents": "// LICENSE : MIT\n\"use strict\";\nimport {RuleHelper} from \"textlint-rule-helper\";\nimport alex from \"alex\";\nconst defaultOptions = {\n    allow: undefined,\n    deny: undefined,\n    noBinary: false,\n    profanitySureness: 0\n};\nmodule.exports = function textlintRuleAlex(context, options = {}) {\n    const {Syntax, RuleError, report, getSource} = context;\n    const helper = new RuleHelper(context);\n    const opts = {...defaultOptions, ...options};\n    /*\n    { [1:5-1:14: `boogeyman` may be insensitive, use `boogey` instead]\n    message: '`boogeyman` may be insensitive, use `boogey` instead',\n    name: '1:5-1:14',\n    file: '',\n    reason: '`boogeyman` may be insensitive, use `boogey` instead',\n    line: 1,\n    column: 5,\n    location: Position { start: [Object], end: [Object] },\n    fatal: false,\n    ruleId: 'boogeyman-boogeywoman',\n    source: 'retext-equality' }\n     */\n    const reportError = (node, result) => {\n        const ruleError = new RuleError(`[${result.ruleId}] ${result.message}`, {\n            line: result.line - 1,\n            column: result.column - 1\n        });\n        report(node, ruleError);\n    };\n    return {\n        [Syntax.Str](node){\n            if (helper.isChildNode(node, [Syntax.Link, Syntax.Image, Syntax.BlockQuote, Syntax.Emphasis])) {\n                return;\n            }\n            const text = getSource(node);\n            const messages = alex(text, opts).messages;\n            messages.forEach((result) => {\n                reportError(node, result);\n            });\n        }\n    }\n}",
                "subject": "chore: remove console.log",
                "message": "chore: remove console.log\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "azu/textlint-rule-alex"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10294,
            "row": {
                "commit": "8e1825ba74393dbf327e9138196ccb593228dcd6",
                "old_file": "redef/catalinker/server/workflow_config.js",
                "new_file": "redef/catalinker/server/workflow_config.js",
                "old_contents": "const _ = require('underscore')\n\nfunction maintenanceInputs (label, type) {\n  return {\n    // this is an input type used to search for a main resource, e.g. Work. The rendered input field\n    // will not be tied to a particular subject and predicate\n    searchMainResource: {\n      label: label,\n      indexType: type\n    },\n    // this is used to control how the search result in the support panel behaves\n    widgetOptions: {\n      maintenance: true,\n      // make it possible to create a work resource if necessary,\n      enableEditResource: {\n        formRefs: [ {\n          formId: 'create-' + type + '-form',\n          targetType: type\n        } ]\n      },\n      enableInPlaceEditing: true\n    }\n  }\n}\n\nfunction createdTimestamp () {\n  return {\n    rdfProperty: 'created',\n    readOnly: true,\n    oneLiner: true\n  }\n}\n\nfunction modifiedTimestamp () {\n  return {\n    rdfProperty: 'modified',\n    readOnly: true,\n    oneLiner: true\n  }\n}\n\nmodule.exports = (app) => {\n  app.get('/config', function (request, response) {\n    response.setHeader('Cache-Control', 'public, max-age=3600')\n    response.setHeader('Expires', new Date(Date.now() + 3600000).toUTCString())\n    const typeMap = {\n      // this map contains a map of all known independent resource types (i.e. not blank node types) as they appear in\n      // resource urls and their canonical names\n      work: 'Work',\n      person: 'Person',\n      publication: 'Publication',\n      genre: 'Genre',\n      subject: 'Subject',\n      place: 'Place',\n      event: 'Event',\n      serial: 'Serial',\n      corporation: 'Corporation',\n      instrument: 'Instrument',\n      compositionType: 'CompositionType',\n      workSeries: 'WorkSeries',\n    }\n    const personCorpNameProperties = [\n      'prefLabel',\n      'name,',\n      {\n        person: '#ordinal,',\n        event: '(ordinal).'\n      },\n      'subdivision',\n      {\n        'corporation|subject|work|place|genre|compositiontype|instrument': '(specification)',\n        person: 'specification,'\n      },\n      'birthYear-', 'deathYear,',\n      'nationality.fragment.'\n    ]\n    const config =\n      {\n        kohaOpacUri: (process.env.KOHA_OPAC_PORT || 'http://192.168.50.12:8080').replace(/^tcp:\//, 'http:/'),\n        kohaIntraUri: (process.env.KOHA_INTRA_PORT || 'http://192.168.50.12:8081').replace(/^tcp:\//, 'http:/'),\n        ontologyUri: '/services/ontology',\n        resourceApiUri: '/services/',\n        inputForms: [\n          {\n            id: 'create-person-form',\n            rdfType: 'Person',\n            labelForCreateButton: 'createNewPersonLabel',\n            inputs: [\n              {\n                rdfProperty: 'name',\n                displayValueSource: true,\n                // after resource is created, the value entered\n                // in input marked with this is used to populate displayValue of the parent input\n                preFillFromSearchField: true,\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'birthYear',\n                prefillFromSuggestion: true\n              },\n              {\n                rdfProperty: 'deathYear'\n              },\n              {\n                rdfProperty: 'nationality',\n                multiple: true\n              },\n              {\n                rdfProperty: 'gender'\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string-large'\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              {\n                rdfProperty: 'ordinal',\n                type: 'input-string'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-subject-form',\n            labelForCreateButton: 'createNewSubjectLabel',\n            rdfType: 'Subject',\n            inputs: [\n              {\n                rdfProperty: 'prefLabel',\n                displayValueSource: true,\n                type: 'input-string',\n                // after resource is created, the value entered\n                // in input marked with this is used to populate displayValue of the parent input\n                preFillFromSearchField: true\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string-large'\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-genre-form',\n            labelForCreateButton: 'createNewGenreLabel',\n            rdfType: 'Genre',\n            inputs: [\n              {\n                rdfProperty: 'prefLabel',\n                displayValueSource: true,\n                type: 'input-string',\n                // after resource is created, the value entered\n                // in input marked with this is used to populate displayValue of the parent input\n                preFillFromSearchField: true\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string-large'\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-corporation-form',\n            labelForCreateButton: 'createNewCorporationLabel',\n            rdfType: 'Corporation',\n            inputs: [\n              {\n                rdfProperty: 'name',\n                displayValueSource: true,\n                type: 'input-string',\n                // after resource is created, the value entered\n                // in input marked with this is used to populate displayValue of the parent input\n                preFillFromSearchField: true\n              },\n              {\n                rdfProperty: 'subdivision',\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'place',\n                type: 'searchable-authority-dropdown',\n                indexTypes: 'place',\n                indexDocumentFields: [ 'displayLine1' ]\n              },\n              {\n                rdfProperty: 'nationality',\n                multiple: true\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-main-work-form',\n            prefillFromAcceptedSource: true,\n            labelForCreateButton: 'createNewWorkLabel',\n            rdfType: 'Work',\n            inputs: [\n              {\n                rdfProperty: 'mainTitle',\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                preFillFromSearchField: true, // value of this field should be copied from the search field above\n                displayValueSource: true // after creation, send actual value in this field back to where the search started\n              },\n              {\n                type: 'input-string',\n                rdfProperty: 'subtitle'\n              },\n              {\n                type: 'input-string',\n                rdfProperty: 'partNumber'\n              },\n              {\n                type: 'input-string',\n                rdfProperty: 'partTitle'\n              },\n              {\n                rdfProperty: 'hasWorkType',\n                type: 'hidden-url-query-value',\n                widgetOptions: {\n                  queryParameter: 'hasWorkType',\n                  prefix: 'http://data.deichman.no/workType#'\n                }\n              }\n            ],\n            templateResourcePartsFrom: [ 'workTypeInput', 'mediaTypeInput']\n          },\n          {\n            id: 'create-work-form',\n            labelForCreateButton: 'createNewWorkLabel',\n            rdfType: 'Work',\n            inputs: [\n              {\n                rdfProperty: 'mainTitle',\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                preFillFromSearchField: true, // value of this field should be copied from the search field above\n                displayValueSource: true // after creation, send actual value in this field back to where the search started\n              },\n              {\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                rdfProperty: 'subtitle'\n              },\n              {\n                type: 'input-string',\n                rdfProperty: 'partNumber'\n              },\n              {\n                type: 'input-string',\n                rdfProperty: 'partTitle'\n              },\n              {\n                rdfProperty: 'hasWorkType'\n              }\n            ],\n            templateResourcePartsFrom: [ 'workTypeInput', 'mediaTypeInput' ]\n          },\n          {\n            id: 'create-workseries-form',\n            labelForCreateButton: 'createNewWorkSeriesLabel',\n            rdfType: 'WorkSeries',\n            inputs: [\n              {\n                rdfProperty: 'mainTitle',\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                preFillFromSearchField: true, // value of this field should be copied from the search field above\n                displayValueSource: true // after creation, send actual value in this field back to where the search started\n              },\n              {\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                rdfProperty: 'subtitle'\n              },\n              {\n                label: 'seriesPartNumber',\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                rdfProperty: 'partNumber'\n              },\n              {\n                label: 'subSeriesTitle',\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                rdfProperty: 'partTitle'\n              }\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-place-form',\n            labelForCreateButton: 'createNewPlaceLabel',\n            rdfType: 'Place',\n            inputs: [\n              {\n                label: 'nameLabel',\n                rdfProperty: 'prefLabel',\n                displayValueSource: true,\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                preFillFromSearchField: true // value of this field should be copied from the search field above\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string'\n                // input type must be defined explicitly, otherwise it will inherit from the search field above\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-event-form',\n            labelForCreateButton: 'createNewEventLabel',\n            rdfType: 'Event',\n            inputs: [\n              {\n                label: 'nameLabel',\n                rdfProperty: 'prefLabel',\n                displayValueSource: true,\n                type: 'input-string',\n                preFillFromSearchField: true // value of this field should be copied from the search field above\n              },\n              {\n                rdfProperty: 'place',\n                type: 'searchable-authority-dropdown',\n                indexTypes: 'place',\n                indexDocumentFields: [ 'displayLine1' ]\n              },\n              {\n                rdfProperty: 'ordinal',\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'date',\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-serial-form',\n            labelForCreateButton: 'createNewSeriesLabel',\n            rdfType: 'Serial',\n            inputs: [\n              {\n                label: 'seriesTitleLabel',\n                rdfProperty: 'mainTitle',\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                preFillFromSearchField: true, // value of this field should be copied from the search field above\n                displayValueSource: true // after creation, send actual value in this field back to where the search started\n              },\n              {\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                rdfProperty: 'subtitle'\n              },\n              {\n                label: 'seriesPartNumber',\n                type: 'input-string',\n                rdfProperty: 'partNumber'\n              },\n              {\n                label: 'subSeriesTitle',\n                type: 'input-string',\n                rdfProperty: 'partTitle'\n              },\n              {\n                type: 'input-string',\n                rdfProperty: 'issn'\n              },\n              {\n                label: 'publishedByLabel',\n                rdfProperty: 'publishedBy',\n                type: 'searchable-authority-dropdown',\n                indexTypes: 'corporation',\n                nameProperties: [ 'name', 'subdivision', 'placePrefLabel', '(specification)' ],\n                indexDocumentFields: [ 'displayLine1' ]\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-instrument-form',\n            labelForCreateButton: 'createNewInstrumentLabel',\n            rdfType: 'Instrument',\n            inputs: [\n              {\n                label: 'nameLabel',\n                rdfProperty: 'prefLabel',\n                type: 'input-string',\n                preFillFromSearchField: true\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-compositiontype-form',\n            labelForCreateButton: 'createNewCompositionTypeLabel',\n            rdfType: 'CompositionType',\n            inputs: [\n              {\n                label: 'nameLabel',\n                rdfProperty: 'prefLabel',\n                type: 'input-string',\n                preFillFromSearchField: true\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          }\n        ],\n        tabs: [\n          {\n            id: 'confirm-person',\n            rdfType: 'Work',\n            label: 'mainEntryLabel',\n            inputs: [\n              {\n                id: 'isbnInput',\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Book', 'Audiobook', 'SheetMusic', 'ComicBook', 'LanguageCourse', 'E-book' ]\n                },\n                // this is an input type used to search for a main resource, e.g. Work. The rendered input field\n                // will not be tied to a particular subject and predicate\n                searchForValueSuggestions: {\n                  label: 'BSSearchLabel',\n                  placeHolder: 'ISBNLabel',\n                  pattern: '^[ 0-9\\\\-]+[xX]?\\\\s*$',\n                  formatter: 'isbn',\n                  patternMismatchMessage: 'invalidIsbnNumber',\n                  parameterName: 'isbn',\n                  automationId: 'searchValueSuggestions',\n                  showOnlyWhenMissingTargetUri: 'Work', // only show this search field if a work has not been loaded or created\n                  sources: [ 'bibbi' ],\n                  preferredSource: {\n                    id: 'bibbi',\n                    name: 'Biblioteksentralen'\n                  },\n                  checkExistingResource: {\n                    url: 'services/publication/isbn',\n                    queryParameter: 'isbn',\n                    showDetails: [ 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.', 'publicationYear' ],\n                    type: 'Publication',\n                    legendSingular: 'alreadyRegisteredISBNSingular',\n                    legendPlural: 'alreadyRegisteredISBNPlural',\n                    editWithTemplate: {\n                      template: 'workflow',\n                      descriptionKey: 'maintPub'\n                    }\n                  }\n                }\n              },\n              {\n                id: 'dfbInputISBN',\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Book', 'Audiobook', 'SheetMusic', 'ComicBook', 'LanguageCourse', 'E-book' ]\n                },\n                // this is an input type used to search for a main resource, e.g. Work. The rendered input field\n                // will not be tied to a particular subject and predicate\n                searchForValueSuggestions: {\n                  label: 'DFBSearchLabel',\n                  placeHolder: 'DFBPlaceHolderISBN',\n                  formatter: 'isbn',\n                  patternMismatchMessage: 'invalidIsbnNumber',\n                  searchParameterSpecs: [\n                    {\n                      ccl: 'isbn',\n                      labelKey: 'ISBNLabel',\n                      pattern: '^(isbn:\\s*)?([0-9\\-]{10,}[xX]?)\\s*$',\n                      parameter: 'isbn',\n                      groupNumber: 2,\n                      validatePattern: '^[ 0-9\\\\-]+[xX]?\\\\s*$',\n                      verifyExists: 'isbn',\n                      checkExistingResource: {\n                        url: 'services/publication/isbn',\n                        showDetails: [ 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.', 'publicationYear' ],\n                        queryParameter: 'isbn',\n                        type: 'Publication',\n                        legendSingular: 'alreadyRegisteredISBNSingular',\n                        legendPlural: 'alreadyRegisteredISBNPlural',\n                        editWithTemplate: {\n                          template: 'workflow',\n                          descriptionKey: 'maintPub'\n                        }\n                      }\n                    },\n                    {\n                      ccl: 'id',\n                      labelKey: 'localIdlabel',\n                      pattern: '^(id:\\s*)?([0-9^\\\\-]+)\\s*$',\n                      groupNumber: 2,\n                      parameter: 'local_id'\n                    },\n                    {\n                      ccl: 'ti',\n                      labelKey: 'titleLabel',\n                      pattern: '^(ti:\\s*)?([^,]+)\\s*$',\n                      groupNumber: 2,\n                      parameter: 'title'\n                    },\n                    {\n                      ccl: 'fo',\n                      labelKey: 'authorLabel',\n                      pattern: '^(fo:\\s*)?(.+)\\s*$',\n                      groupNumber: 2,\n                      parameter: 'author'\n                    }\n                  ],\n                  automationId: 'searchValueSuggestions',\n                  showOnlyWhenMissingTargetUri: 'Work', // only show this search field if a work has not been loaded or created\n                  sources: [ 'dfb' ],\n                  preferredSource: {\n                    id: 'dfb',\n                    name: 'Det flerspråklige bibliotek'\n                  }\n                }\n              },\n              {\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Film', 'MusicRecording', 'Game' ]\n                },\n                // this is an input type used to search for a main resource, e.g. Work. The rendered input field\n                // will not be tied to a particular subject and predicate\n                searchForValueSuggestions: {\n                  label: 'BSSearchLabel',\n                  placeHolder: 'EANLabel',\n                  pattern: '[0-9]{12,14}',\n                  patternMismatchMessage: 'invalidEanNumber',\n                  parameterName: 'ean',\n                  automationId: 'searchEanValueSuggestions',\n                  showOnlyWhenMissingTargetUri: 'Work', // only show this search field if a work has not been loaded or created\n                  sources: [ 'bibbi' ],\n                  preferredSource: {\n                    id: 'bibbi',\n                    name: 'Biblioteksentralen'\n                  },\n                  checkExistingResource: {\n                    url: 'services/publication',\n                    queryParameter: 'hasEan',\n                    showDetails: [ 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.', 'publicationYear' ],\n                    type: 'Publication',\n                    legendSingular: 'alreadyRegisteredEANSingular',\n                    legendPlural: 'alreadyRegisteredEANPlural',\n                    editWithTemplate: {\n                      template: 'workflow',\n                      descriptionKey: 'maintPub'\n                    }\n                  }\n                }\n              },\n              {\n                id: 'dfbInputEAN',\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Film', 'MusicRecording', 'Game' ]\n                },\n                // this is an input type used to search for a main resource, e.g. Work. The rendered input field\n                // will not be tied to a particular subject and predicate\n                searchForValueSuggestions: {\n                  label: 'DFBSearchLabel',\n                  placeHolder: 'DFBPlaceHolderEAN',\n                  patternMismatchMessage: 'invalidEanNumber',\n                  searchParameterSpecs: [\n                    {\n                      ccl: 'ean',\n                      labelKey: 'EANLabel',\n                      pattern: '^(ean:\\\\s*)?([0-9\\-]{10,}[xX]?)\\\\s*$',\n                      parameter: 'ean',\n                      groupNumber: 2,\n                      validatePattern: '^[ 0-9\\\\-]+[xX]?\\\\s*$',\n                      checkExistingResource: {\n                        url: 'services/publication',\n                        queryParameter: 'hasEan',\n                        type: 'Publication',\n                        showDetails: [ 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.', 'publicationYear' ],\n                        legendSingular: 'alreadyRegisteredEANSingular',\n                        legendPlural: 'alreadyRegisteredEANPlural',\n                        editWithTemplate: {\n                          template: 'workflow',\n                          descriptionKey: 'maintPub'\n                        }\n                      }\n                    },\n                    {\n                      ccl: 'id',\n                      labelKey: 'localIdlabel',\n                      pattern: '^(id:\\\\s*)?([0-9^\\\\-]+)\\\\s*$',\n                      groupNumber: 2,\n                      parameter: 'local_id'\n                    },\n                    {\n                      ccl: 'ti',\n                      labelKey: 'titleLabel',\n                      pattern: '^(ti:\\\\s*)?([^,]+)\\\\s*$',\n                      groupNumber: 2,\n                      parameter: 'title'\n                    },\n                    {\n                      ccl: 'fo',\n                      labelKey: 'authorLabel',\n                      pattern: '^(fo:\\\\s*)?(.+)\\\\s*$',\n                      groupNumber: 2,\n                      parameter: 'author'\n                    }\n                  ],\n                  automationId: 'searchValueSuggestions',\n                  showOnlyWhenMissingTargetUri: 'Work', // only show this search field if a work has not been loaded or created\n                  sources: [ 'dfb' ],\n                  preferredSource: {\n                    id: 'dfb',\n                    name: 'Det flerspråklige bibliotek'\n                  }\n                }\n              },\n              {\n                label: 'missingMainEntryLabel',\n                id: 'missingMainEntry',\n                rdfProperty: 'missingMainEntry'\n              },\n              {\n                label: 'mainContributorLabel',\n                id: 'mainEntryInput',\n                reportFormat: {\n                  list: true\n                },\n                showOnlyWhen: {\n                  inputId: 'missingMainEntry',\n                  valueAsStringMatches: '^false$|^null$|^undefined'\n                },\n                subInputs: { // input is a group of sub inputs, which are connected to resource as other ends of a blank node\n                  rdfProperty: 'contributor', // the rdf property of the resource\n                  range: 'Contribution', // this is the shorthand name of the type of the blank node\n                  inputs: [ // these are the actual sub inputs\n                    {\n                      label: 'agentLabel',\n                      rdfProperty: 'agent',\n                      indexTypes: [ 'person', 'corporation' ],\n                      type: 'searchable-with-result-in-side-panel',\n                      required: true,\n                      nameProperties: personCorpNameProperties,\n                      headlineNameProperties: [ 'name', 'prefLabel'],\n                      previewProperties: [ {\n                        person: '#ordinal,',\n                        event: '(ordinal).'\n                      },\n                        'subdivision',\n                        {\n                          corporation: '(specification)',\n                          person: 'specification,'\n                        },\n                        'placePrefLabel,', 'birthYear-', 'deathYear', 'nationality.fragment.' ],\n                      dependentResourceTypes: [ 'Work', 'Publication' ], // when the creator is changed, unload current work and publication\n                      id: 'mainEntryPersonInput',\n                      widgetOptions: {\n                        showSelectItem: true, // show and enable select work radio button\n                        enableEditResource: {\n                          formRefs: [\n                            {\n                              formId: 'create-person-form',\n                              targetType: 'person'\n                            },\n                            {\n                              formId: 'create-corporation-form',\n                              targetType: 'corporation'\n                            }\n                          ],\n                          useAfterCreation: false\n                        },\n                        enableInPlaceEditing: true\n                      }\n                    },\n                    {\n                      id: 'mainEntryRoleInput',\n                      rdfProperty: 'role',\n                      required: true\n                    }\n                  ]\n                },\n                isMainEntry: true,\n                // blank nodes connected to this input is expected to have type deichman:MainEntry in addition to its own type (range)\n                subjects: [ 'Work' ], // blank node can be attached to the the loaded resource of one of these types\n                cssClassPrefix: 'additional-entries' // prefix of class names to identify a span surrounding this input or group of sub inputs.\n                // actual names are <prefix>-non-editable and <prefix>-editable to enable alternative presentation when not editable\n              },\n              {\n                label: 'improperWorkLabel',\n                rdfProperty: 'improperWork'\n              },\n              {\n                // this is an input type used to search for a main resource, e.g. Work. The rendered input field\n                // will not be tied to a particular subject and predicate\n                id: 'searchMainResourceInput',\n                isTitleSource: {\n                  priority: 3,\n                  qualifier: ' - verk'\n                },\n                searchMainResource: {\n                  label: 'searchWorkAsMainResourceLabel',\n                  placeHolder: 'workTitlePlaceHolder',\n                  indexType: 'work',\n                  automationId: 'searchWorkAsMainResource',\n                  showOnlyWhenMissingTargetUri: 'Work' // only show this search field if a work has not been loaded or created\n                },\n                suggestValueFrom: {\n                  domain: 'Work',\n                  predicate: '#mainTitle'\n                },\n                // this is used to control how the search result in the support panel behaves\n                widgetOptions: {\n                  // make it possible to create a work resource if necessary,\n                  enableEditResource: {\n                    formRefs: [ {\n                      formId: 'create-main-work-form',\n                      targetType: 'work'\n                    } ],\n                    useAfterCreation: {\n                      excludeInputRefs: [ 'mainEntryPersonInput', 'mainEntryRoleInput' ]\n                    }\n                  },\n                  filter: {\n                    inputRef: 'mainEntryPersonInput',\n                    name: 'personAsMainEntryFilter'\n                  }\n                }\n              }\n            ],\n            nextStep: {\n              showOnlyWhenInputHasValue: 'mediaTypeInput',\n              buttonLabel: 'nextStepDescription',\n              disabledUnless: {\n                presentTargetUri: 'Work',\n                inputIsNonEditableWhenNotOverridden: {\n                  nonEditableInput: 'mainEntryPersonInput',\n                  overridingInput: 'missingMainEntry'\n                },\n                disabledTooltip: 'For å komme videre, må du registrere hovedinnførsel og idenfisere eller opprette verk.'\n              },\n              createNewResource: {\n                type: 'Publication',\n                copyInputValues: {\n                  workMainTitle: 'publicationMainTitle',\n                  workSubtitle: 'publicationSubtitle',\n                  workPartNumber: 'publicationPartNumber',\n                  workPartTitle: 'publicationPartTitle'\n                },\n                templateResourcePartsFrom: [ 'mediaTypeInput' ]\n              }\n            }\n          },\n          {\n            id: 'describe-publication',\n            rdfType: 'Publication',\n            label: 'publicationTabLabel',\n            reportLabel: 'publicationLabel',\n            inputs: [\n              { rdfProperty: 'hasPrimaryCataloguingSource', initiallyHidden: true },\n              { rdfProperty: 'hasIdentifierInPrimaryCataloguingSource', initiallyHidden: true },\n              {\n                rdfProperty: 'mainTitle',\n                id: 'publicationMainTitle',\n                isTitleSource: {\n                  priority: 1,\n                  qualifier: ' - utgivelse'\n                }\n              },\n              {\n                rdfProperty: 'subtitle',\n                id: 'publicationSubtitle'\n              },\n              {\n                rdfProperty: 'untranscribedTitle',\n                id: 'untranscribedPublicationTitleInput',\n                esotericWhen: 'always',\n              },\n              {\n                rdfProperty: 'partNumber',\n                id: 'publicationPartNumber',\n                esotericWhen: { hasMediaType: [ 'MusicRecording', 'Book', 'Audiobook', 'LanguageCourse', 'Film' ] }\n              },\n              {\n                rdfProperty: 'partTitle',\n                id: 'publicationPartTitle',\n                esotericWhen: { hasMediaType: [ 'MusicRecording', 'Book', 'Audiobook', 'LanguageCourse', 'Film' ] },\n              },\n              {\n                rdfProperty: 'variantTitle',\n                esotericWhen: { hasMediaType: [ 'MusicRecording', 'Book', 'Audiobook', 'LanguageCourse', 'ComicBook' ] },\n                multiple: true,\n                addAnotherLabel: 'addAnotherVariantTitle',\n              },\n              {\n                rdfProperty: 'edition',\n                esotericWhen: { hasMediaType: [ 'MusicRecording', 'Book', 'Audiobook', 'LanguageCourse', 'ComicBook', 'Film' ] }\n              },\n              {\n                rdfProperty: 'publicationYear',\n                id: 'publicationYearInput',\n              },\n              {\n                includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'ComicBook', 'LanguageCourse', 'SheetMusic' ] },\n                rdfProperty: 'numberOfPages',\n                multiple: true,\n                addAnotherLabel: 'addAnotherPageNumber'\n              },\n              {\n                rdfProperty: 'hasExtent',\n                esotericWhen: { hasMediaType: [ 'Book', 'ComicBook' ] },\n                addAnotherLabel: 'addAnotherExtent'\n              },\n              {\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Other', 'Film', 'MusicRecording', 'Audiobook', 'LanguageCourse' ]\n                },\n                rdfProperty: 'duration',\n                type: 'input-duration'\n              },\n              {\n                includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'SheetMusic', 'ComicBook', 'LanguageCourse', 'E-book', 'Film' ] },\n                esotericWhen: { hasMediaType: [ 'Film' ] },\n                rdfProperty: 'illustrativeMatter',\n                multiple: true\n              },\n              {\n                includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'Audiobook', 'SheetMusic', 'ComicBook', 'LanguageCourse', 'E-book' ] },\n                rdfProperty: 'isbn',\n                multiple: true,\n                formatter: 'isbn',\n                addAnotherLabel: 'addAnotherISBN'\n              },\n              {\n                includeOnlyWhen: { hasMediaType: [ 'Other', 'SheetMusic' ] },\n                rdfProperty: 'hasIsmn',\n                multiple: true,\n                addAnotherLabel: 'addAnotherISMN'\n              },\n              {\n                includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'Audiobook', 'SheetMusic', 'ComicBook', 'LanguageCourse', 'E-book', 'Film', 'MusicRecording', 'Game' ] },\n                rdfProperty: 'hasEan',\n                esotericWhen: { hasMediaType: [ 'Book', 'Audiobook', 'LanguageCourse' ] },\n                multiple: true,\n                addAnotherLabel: 'addAnotherEAN'\n              },\n              {\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Other', 'Book', 'SheetMusic', 'LanguageCourse', 'ComicBook' ]\n                },\n                rdfProperty: 'binding'\n              },\n              {\n                rdfProperty: 'language',\n                multiple: true\n              },\n              {\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Film', 'Game' ]\n                },\n                rdfProperty: 'hasSubtitles',\n                multiple: 'true'\n              },\n              {\n                rdfProperty: 'hasMediaType',\n                id: 'mediaTypeInput',\n                widgetOptions: {\n                  queryParameter: 'hasMediaType',\n                  prefix: 'http://data.deichman.no/mediaType#'\n                }\n              },\n              {\n                rdfProperty: 'format',\n                esotericWhen: { hasMediaType: [ 'Book', 'ComicBook' ] },\n                multiple: true\n              },\n              {\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Other', 'Film', 'Game' ]\n                },\n                rdfProperty: 'ageLimit',\n                widgetOptions: {\n                  short: true\n                }\n              },\n              {\n                includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'E-book', 'ComicBook', 'SheetMusic' ] },\n                rdfProperty: 'writingSystem',\n                esotericWhen: { hasMediaType: [ 'Book', 'ComicBook' ] },\n                multiple: true\n              },\n              {\n                rdfProperty: 'hasFormatAdaptation',\n                includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'Audiobook', 'LanguageCourse', 'ComicBook', 'Film', 'E-book', 'SheetMusic' ] },\n                esotericWhen: { hasMediaType: [ 'Book', 'Audiobook', 'LanguageCourse', 'ComicBook', 'Film' ] },\n                multiple: true\n              },\n              {\n                id: 'publishedByInput',\n                rdfProperty: 'publishedBy',\n                multiple: true,\n                addAnotherLabel: 'addAnotherPublisher',\n                authority: true, // this indicates it is an authorized entity\n                nameProperties: [\n                  {\n                    person: 'name,',\n                    corporation: 'name.'\n                  },\n                  {\n                    person: '#ordinal,',\n                    event: '(ordinal).'\n                  },\n                  'subdivision',\n                  {\n                    corporation: '(specification)',\n                    person: 'specification,'\n                  },\n                  'placePrefLabel,',\n                  'birthYear-', 'deathYear'\n                ],\n                indexTypes: [ 'corporation', 'person' ], // this is the name of the elasticsearch index type from which authorities are searched within\n                preselectFirstIndexType: true,\n                // or authority select list are concatenated\n                type: 'searchable-with-result-in-side-panel',\n                widgetOptions: {\n                  selectIndexTypeLegend: 'selectActorType',\n                  enableEditResource: {\n                    formRefs: [\n                      {\n                        formId: 'create-corporation-form',\n                        targetType: 'corporation'\n                      },\n                      {\n                        formId: 'create-person-form',\n                        targetType: 'person'\n                      }\n                    ]\n                  },\n                  enableInPlaceEditing: true\n                },\n              },\n              {\n                id: 'hasPlaceOfPublicationInput',\n                rdfProperty: 'hasPlaceOfPublication',\n                multiple: true,\n                addAnotherLabel: 'addAnotherPublicationPlace',\n                authority: true, // this indicates it is an authorized entity\n                nameProperties: [ 'prefLabel', 'specification' ], // these are property names used to label already connected entities\n                indexTypes: 'place', // this is the name of the elasticsearch index type from which authorities are searched within\n                // the labels for authority select list are concatenated\n                type: 'searchable-with-result-in-side-panel',\n                widgetOptions: {\n                  enableEditResource: {\n                    formRefs: [ {\n                      formId: 'create-place-form',\n                      targetType: 'place'\n                    } ]\n                  },\n                  enableInPlaceEditing: true\n                }\n              },\n              {\n                label: 'seriesLabel',\n                multiple: true,\n                addAnotherLabel: 'addAnotherSeries',\n                subjects: [ 'Publication' ],\n                reportFormat: {\n                  list: true\n                },\n                subInputs: {\n                  rdfProperty: 'inSerial',\n                  range: 'SerialIssue',\n                  inputs: [\n                    {\n                      required: true,\n                      rdfProperty: 'serial',\n                      id: 'serialInput',\n                      indexTypes: 'serial',\n                      nameProperties: [ 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.', '(@publisherName)' ],\n                      type: 'searchable-with-result-in-side-panel',\n                      widgetOptions: {\n                        showSelectItem: false, // show and enable select work radio button\n                        enableEditResource: {\n                          formRefs: [ {\n                            formId: 'create-serial-form',\n                            targetType: 'serial'\n                          } ],\n                          useAfterCreation: false\n                        },\n                        enableInPlaceEditing: true\n                      }\n                    },\n                    {\n                      label: 'issueNumberLabel',\n                      rdfProperty: 'issue'\n                    }\n                  ]\n                },\n                esotericWhen: {\n                  hasMediaType: [ 'MusicRecording' ]\n                }\n              },\n              { rdfProperty: 'locationFormat' },\n              { rdfProperty: 'locationClassNumber' },\n              { rdfProperty: 'locationSignature' },\n              {\n                rdfProperty: 'hasDescription',\n                type: 'input-string-large'\n              },\n              {\n                rdfProperty: 'publicationOf',\n                id: 'publicationOfInput',\n                type: 'searchable-with-result-in-side-panel',\n                indexTypes: 'work',\n                authority: true,\n                nameProperties: [ 'mainTitle', 'subtitle' ],\n                label: '',\n                initiallyHidden: true,\n                dependentResourceTypes: [ 'Work' ], // unload work if this is cleared\n                widgetOptions: {\n                  // make it possible to create a work resource if necessary,\n                  enableEditResource: {\n                    formRefs: [ {\n                      formId: 'create-work-form',\n                      targetType: 'work'\n                    } ],\n                    useAfterCreation: false\n                  }\n                }\n              },\n              {\n                rdfProperty: 'recordId',\n                id: 'recordIdInput',\n                type: 'hidden-url-query-value',\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            nextStep: {\n              buttonLabel: 'nextStepDescribeWork',\n              showOnlyWhenInputHasValue: 'mediaTypeInput'\n            },\n            deleteResource: {\n              buttonLabel: 'deletePublication',\n              rdfType: 'Publication',\n              dialogKeypath: 'deletePublicationDialog',\n              dialogId: 'delete-publication-dialog',\n              dialogTemplateValues: {\n                work: 'workMainTitle',\n                title: 'publicationMainTitle',\n                creator: 'mainEntryPersonInput'\n              },\n              afterSuccess: {\n                restart: true\n              }\n            },\n            enableSpecialInput: {\n              inputId: 'publicationOfInput',\n              buttonLabel: 'changeWorkOfPublication',\n              confirmLabel: 'confirmChangeWorkOfPublication'\n            },\n            tools: [\n              {\n                template: 'copy-publication-and-work'\n              }\n            ]\n          },\n          {\n            id: 'describe-work',\n            rdfType: 'Work',\n            label: 'workTabLabel',\n            reportLabel: 'workLabel',\n            inputs: [\n              {\n                id: 'workMainTitle',\n                rdfProperty: 'mainTitle',\n                isTitleSource: {\n                  priority: 2,\n                  qualifier: ' - verk'\n                }\n              },\n              {\n                rdfProperty: 'subtitle',\n                id: 'workSubtitle'\n              },\n              {\n                rdfProperty: 'untranscribedTitle',\n                id: 'untranscribedWorkTitleInput',\n                esotericWhen: 'always',\n              },\n              {\n                rdfProperty: 'partNumber',\n                esotericWhen: { hasWorkType: [ 'Literature', 'Music', 'Film' ] },\n                id: 'workPartNumber'\n              },\n              {\n                rdfProperty: 'partTitle',\n                esotericWhen: { hasWorkType: [ 'Literature', 'Music', 'Film' ] },\n                id: 'workPartTitle'\n              },\n              {\n                rdfProperty: 'publicationYear',\n                label: 'publicationYearLabel',\n                id: 'workPublicationYear'\n              },\n              {\n                rdfProperty: 'nationality',\n                label: 'originCountryLabel',\n                esotericWhen: { hasWorkType: [ 'Other' ] },\n                multiple: 'true'\n              },\n              { rdfProperty: 'language', multiple: true },\n              {\n                rdfProperty: 'hasWorkType',\n                type: 'select-predefined-value',\n                hiddenUrlQueryValue: true,\n                id: 'workTypeInput',\n                widgetOptions: {\n                  queryParameter: 'hasWorkType',\n                  prefix: 'http://data.deichman.no/workType#',\n                  conditionalInputType: [\n                    {\n                      when: 'inWorkflow',\n                      replaceType: 'readonly-hidden-url-query-value'\n                    },\n                    {\n                      when: 'editingAuthority',\n                      replaceType: 'select-predefined-value'\n                    }\n                  ]\n                }\n              },\n              {\n                rdfProperty: 'literaryForm',\n                includeOnlyWhen: { hasWorkType: [ 'Other', 'Literature', 'Film', 'Game' ] },\n                multiple: true\n              },\n              {\n                includeOnlyWhen: { hasWorkType: [ 'Other', 'Literature', 'Film' ] },\n                rdfProperty: 'fictionNonfiction'\n              },\n              { rdfProperty: 'audience', multiple: true },\n              {\n                includeOnlyWhen: { hasWorkType: [ 'Other', 'Literature', 'Film' ] },\n                rdfProperty: 'biography',\n                multiple: true\n              },\n              {\n                rdfProperty: 'hasContentAdaptation',\n                includeOnlyWhen: { hasWorkType: [ 'Other', 'Literature', 'Film', 'Game' ] },\n                esotericWhen: { hasWorkType: [ 'Literature', 'Other', 'Film' ] },\n                multiple: true\n              },\n              {\n                label: 'workRelationLabel',\n                multiple: true,\n                addAnotherLabel: 'addAnotherRelation',\n                esotericWhen: { hasWorkType: [ 'Music' ] },\n                reportFormat: {\n                  list: true\n                },\n                subInputs: {\n                  maintainInverseRelation: {\n                    inverseSubjectInput: 'relatedToWorkInput',\n                    onlyWhenAll: [\n                      {\n                        inputId: 'relationTypeInput',\n                        valueAsStringMatches: '^.*continuedIn$|^.*continuationOf$|^.*relatedWork'\n                      },\n                      {\n                        inputId: 'relatedToWorkInput',\n                        valueAsStringMatches: '^.*\\\/work\\\/.*$'\n                      } ],\n                    valueMapping: {\n                      relationTypeInput: {\n                        'http://data.deichman.no/relationType#continuedIn': 'http://data.deichman.no/relationType#continuationOf',\n                        'http://data.deichman.no/relationType#continuationOf': 'http://data.deichman.no/relationType#continuedIn'\n                      }\n                    }\n                  },\n                  rdfProperty: 'isRelatedTo',\n                  range: 'WorkRelation',\n                  inputs: [\n                    {\n                      label: 'workSeriesWorkLabel',\n                      rdfProperty: 'work',\n                      id: 'relatedToWorkInput',\n                      required: true,\n                      indexTypes: [ 'workUnstructured', 'workseries' ],\n                      type: 'searchable-with-result-in-side-panel',\n                      nameProperties: [ '@mainEntryName.', 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.' ],\n                      preselectFirstIndexType: true,\n                      widgetOptions: {\n                        enableEditResource: {\n                          formRefs: [\n                            {\n                              formId: 'create-work-form',\n                              targetType: 'workUnstructured'\n                            },\n                            {\n                              formId: 'create-workseries-form',\n                              targetType: 'workseries'\n                            }\n                          ],\n                          useAfterCreation: false\n                        },\n                        enableInPlaceEditing: true,\n                        explanations: {\n                          patterns: [\n                            { match: '^.*\\\/work\\\/.*$', explanation: 'workExplanation' },\n                            { match: '^.*\\\/workSeries\\\/.*$', explanation: 'workSeriesExplanation' }\n                          ]\n                        }\n                      }\n                    },\n                    {\n                      label: 'relationTypeLabel',\n                      rdfProperty: 'hasRelationType',\n                      required: true,\n                      id: 'relationTypeInput'\n                    },\n                    {\n                      rdfProperty: 'partNumber',\n                      id: 'partNumberInput',\n                      showOnlyWhen: {\n                        inputId: 'relationTypeInput',\n                        valueAsStringMatches: '^.*partOf$',\n                        initial: 'hide'\n                      }\n                    }\n                  ],\n                },\n                subjects: [ 'Work' ] // blank node can be attached to the the loaded resource of one of these types\n              },\n              {\n                label: 'workSeriesLabel',\n                multiple: true,\n                addAnotherLabel: 'addAnotherWorkSeries',\n                esotericWhen: { hasWorkType: [ 'Music' ] },\n                reportFormat: {\n                  list: true\n                },\n                subInputs: {\n                  rdfProperty: 'isPartOfWorkSeries',\n                  range: 'WorkSeriesPart',\n                  inputs: [\n                    {\n                      rdfProperty: 'workSeries',\n                      label: 'seriesLabel',\n                      id: 'partOfWorkSeriesInput',\n                      required: true,\n                      indexTypes: [ 'workseries' ],\n                      type: 'searchable-with-result-in-side-panel',\n                      nameProperties: [ 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.' ],\n                      widgetOptions: {\n                        enableEditResource: {\n                          formRefs: [\n                            {\n                              formId: 'create-workseries-form',\n                              targetType: 'workseries'\n                            }\n                          ],\n                          useAfterCreation: false\n                        },\n                        enableInPlaceEditing: true\n                      }\n                    },\n                    {\n                      label: 'part',\n                      rdfProperty: 'partNumber',\n                      id: 'workSeriesPartNumberInput'\n                    }\n                  ]\n                },\n                subjects: [ 'Work' ] // blank node can be attached to the the loaded resource of one of these types\n              },\n              {\n                rdfProperty: 'hasSummary',\n                esotericWhen: { hasWorkType: [ 'Music' ] },\n                type: 'input-string-large'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            tools: [\n              {\n                template: 'inverse-one-to-many-relationship',\n                inverseRdfProperty: 'publicationOf',\n                showRelatedButtonLabel: 'showPublicationsAndSplitWork',\n                cloneParentButtonLabel: 'splitTheWork',\n                cloneParentDialogTitle: 'splitWork',\n                cloneParentButtonTooltip: 'makeWorkCopyForEachPubliation',\n                noInverseRelationsText: 'workHasNoPublications',\n                showRelatedTitle: 'workHasNumberOfPublications',\n                showFieldsOfRelated: [\n                  { field: 'mainTitle', width: '6-24', inputRef: 'workMainTitle' }, // there are 23/24th left for field layouts\n                  { field: 'subtitle', width: '5-24', inputRef: 'workSubtitle' },\n                  { field: 'partNumber', width: '2-24', inputRef: 'workPartNumber' },\n                  { field: 'partTitle', width: '5-24', inputRef: 'workPartTitle' },\n                  { field: 'recordId', width: '3-24' },\n                  { field: 'publicationYear', width: '2-24', inputRef: 'workPublicationYear' }\n                ],\n                cloneParentButtonExplanation: 'splitWorkLegend',\n                cloneParentDialogLegend: 'splitWorkDialogLegend'\n              }\n            ],\n            nextStep: {\n              buttonLabel: 'nextStepSubjects',\n              showOnlyWhenInputHasValue: 'mediaTypeInput'\n            },\n            deleteResource: {\n              buttonLabel: 'deleteWork',\n              preventDeleteIfReferred: true,\n              rdfType: 'Work',\n              dialogKeypath: 'deleteWorkDialog',\n              dialogId: 'delete-work-dialog',\n              dialogTemplateValues: {\n                title: 'workMainTitle',\n                creator: 'mainEntryPersonInput'\n              },\n              afterSuccess: {\n                restart: true\n              }\n            }\n          },\n          {\n            id: 'subjects',\n            rdfType: 'Work',\n            label: 'subjectsTabLabel',\n            reportLabel: 'maintGeneralSubjectLabelPlur',\n            inputs: [\n              {\n                includeOnlyWhen: { hasWorkType: [ 'Music', 'Film' ] },\n                esotericWhen: { hasWorkType: [ 'Film' ] },\n                rdfProperty: 'hasCompositionType',\n                multiple: true,\n                addAnotherLabel: 'addAnotherCompositionType',\n                id: 'compositionTypeInput',\n                type: 'searchable-with-result-in-side-panel',\n                nameProperties: [ 'prefLabel' ],\n                indexTypes: [ 'compositiontype' ],\n                labelForCreateButton: 'createNewCompositionType',\n                widgetOptions: {\n                  enableEditResource: {\n                    formRefs: [\n                      {\n                        formId: 'create-compositiontype-form',\n                        targetType: 'compositiontype'\n                      }\n                    ]\n                  },\n                  enableInPlaceEditing: true\n                }\n              },\n              {\n                includeOnlyWhen: { hasWorkType: 'Music' },\n                rdfProperty: 'inKey',\n                multiple: true\n              },\n              {\n                includeOnlyWhen: { hasWorkType: [ 'Music', 'Film' ] },\n                esotericWhen: { hasWorkType: [ 'Film' ] },\n                label: 'instrumentationLabel',\n                multiple: true,\n                addAnotherLabel: 'addAnotherInstrument',\n                subInputs: {\n                  rdfProperty: 'hasInstrumentation',\n                  range: 'Instrumentation',\n                  inputs: [\n                    {\n                      rdfProperty: 'hasInstrument',\n                      id: 'instrumentInput',\n                      indexTypes: [ 'instrument' ],\n                      type: 'searchable-with-result-in-side-panel',\n                      nameProperties: [ 'prefLabel' ],\n                      required: true,\n                      widgetOptions: {\n                        enableEditResource: {\n                          formRefs: [\n                            {\n                              formId: 'create-instrument-form',\n                              targetType: 'instrument'\n                            }\n                          ]\n                        },\n                        enableInPlaceEditing: true\n                      }\n                    },\n                    {\n                      label: 'numberOfPerformersLabel',\n                      rdfProperty: 'hasNumberOfPerformers',\n                      widgetOptions: {\n                        short: true\n                      }\n                    }\n                  ]\n                },\n                subjects: [ 'Work' ] // blank node can be attached to the the loaded resource of one of these types\n              },\n              {\n                rdfProperty: 'subject',\n                id: 'subjectInput',\n                esotericWhen: { hasWorkType: [ 'Music' ] },\n                multiple: true,\n                addAnotherLabel: 'addAnotherSubject',\n                type: 'searchable-with-result-in-side-panel',\n                reportFormat: {\n                  separateLines: true\n                },\n                authority: true, // this indicates it is an authorized entity\n                nameProperties: [ {\n                  work: '@mainEntryName.' // @ means use property extraction helper function\n                }, 'prefLabel', 'mainTitle:', 'subtitle', 'partNumber.', 'partTitle',\n                  {\n                    person: 'name,',\n                    corporation: 'name.'\n                  },\n                  {\n                    person: '#ordinal,', // # means remove previous member's trailing comma\n                    event: '(ordinal).'\n                  },\n                  'subdivision',\n                  {\n                    'corporation|subject|work|place|genre|compositiontype|instrument': '(specification)',\n                    person: 'specification,'\n                  },\n                  'placePrefLabel,',\n                  'date',\n                  'birthYear-', 'deathYear,',\n                  'nationality.fragment.'\n                ],\n                previewProperties: [\n                  'subtitle', 'partNumber.', 'partTitle',\n                  {\n                    person: '#ordinal,',\n                    event: '(ordinal)'\n                  },\n                  'subdivision',\n                  {\n                    'corporation|subject|work|place|genre|compositiontype|instrument': '(specification)',\n                    person: 'specification,'\n                  },\n                  'placePrefLabel,',\n                  'date',\n                  'birthYear-', 'deathYear',\n                  'nationality.fragment.' ],\n                indexTypes: [ 'subject', 'person', 'corporation', 'workUnstructured', 'place', 'event' ],\n                widgetOptions: {\n                  selectIndexTypeLegend: 'selectSubjectType',\n                  enableEditResource: {\n                    formRefs: [\n                      {\n                        formId: 'create-subject-form',\n                        targetType: 'subject' // these are matched against index types, hence lower case\n                      },\n                      {\n                        formId: 'create-work-form',\n                        targetType: 'workUnstructured'\n                      },\n                      {\n                        formId: 'create-person-form',\n                        targetType: 'person'\n                      },\n                      {\n                        formId: 'create-corporation-form',\n                        targetType: 'corporation'\n                      },\n                      {\n                        formId: 'create-place-form',\n                        targetType: 'place'\n                      },\n                      {\n                        formId: 'create-event-form',\n                        targetType: 'event'\n                      }\n                    ]\n                  },\n                  enableInPlaceEditing: true,\n                  explanations: {\n                    patterns: [\n                      { match: '^.*\\\/subject\\\/.*$', explanation: 'generalSubjectExplanation' },\n                      { match: '^.*\\\/person\\\/.*$', explanation: 'personExplanation' },\n                      { match: '^.*\\\/work\\\/.*$', explanation: 'workExplanation' },\n                      { match: '^.*\\\/place\\\/.*$', explanation: 'placeExplanation' },\n                      { match: '^.*\\\/corporation\\\/.*$', explanation: 'corporationExplanation' },\n                      { match: '^.*\\\/event\\\/.*$', explanation: 'eventExplanation' }\n                    ]\n                  }\n                }\n              },\n              {\n                label: 'classificationLabel',\n                multiple: true,\n                addAnotherLabel: 'addAnotherClassification',\n                subjects: [ 'Work' ],\n                reportFormat: {\n                  list: true\n                },\n                subInputs: {\n                  rdfProperty: 'hasClassification',\n                  range: 'ClassificationEntry',\n                  inputs: [\n                    {\n                      rdfProperty: 'hasClassificationNumber',\n                      required: true\n                    },\n                    {\n                      label: 'classificationSourceLabel',\n                      rdfProperty: 'hasClassificationSource',\n                      required: true\n                    },\n                    {\n                      rdfProperty: 'isMainClassificationNumber'\n                    }\n                  ]\n                }\n              },\n              {\n                rdfProperty: 'genre',\n                id: 'genreInput',\n                esotericWhen: { hasWorkType: [ 'Music' ] },\n                multiple: true,\n                addAnotherLabel: 'addAnotherGenre',\n                type: 'searchable-with-result-in-side-panel',\n                authority: true,\n                nameProperties: [ 'prefLabel', '(specification)' ],\n                indexTypes: [ 'genre' ],\n                widgetOptions: {\n                  enableEditResource: {\n                    formRefs: [ {\n                      formId: 'create-genre-form',\n                      targetType: 'genre'\n                    } ]\n                  },\n                  enableInPlaceEditing: true\n                }\n              },\n              {\n                rdfProperty: 'hasTag',\n                id: 'tagInput',\n                multiple: 'true',\n                esotericWhen: { hasWorkType: [ 'Music' ] },\n                addAnotherLabel: 'addAnotherTag'\n              }\n            ],\n            nextStep: {\n              showOnlyWhenInputHasValue: 'mediaTypeInput',\n              buttonLabel: 'nextStepDescribeParts'\n            }\n          },\n          {\n            id: 'collection-of-works',\n            rdfType: 'Publication',\n            label: 'publicationPartsTabLabel',\n            reportLabel: 'partsLabel',\n            inputs: [\n              {\n                label: 'publicationPartsLabel',\n                multiple: true,\n                reportFormat: {\n                  topLevel: true // this input is promoted to act on behalf of its group in the report\n                },\n                subInputs: { // input is a group of sub inputs, which are connected to resource as other ends of a blank node\n                  rdfProperty: 'hasPublicationPart', // the rdf property of the resource\n                  range: 'PublicationPart', // this is the shorthand name of the type of the blank node\n                  accordionHeader: 'collection',\n                  objectSortOrder: [\n                    { predicate: 'partNumber', isNumber: true },\n                    { predicate: 'startsAtPage' },\n                    { predicate: 'mainTitle' }\n                  ],\n                  pagination: 10,\n                  inputs: [\n                    {\n                      label: 'agentLabel',\n                      rdfProperty: 'agent',\n                      indexTypes: [ 'person', 'corporation' ],\n                      nameProperties: personCorpNameProperties,\n                      previewProperties: [ 'birthYear-', 'deathYear', 'place', 'subdivision', 'nationality.fragment.' ],\n                      type: 'searchable-with-result-in-side-panel',\n                      id: 'publicationPartActorInput',\n                      widgetOptions: {\n                        enableEditResource: {\n                          formRefs: [\n                            {\n                              formId: 'create-person-form',\n                              targetType: 'person'\n                            },\n                            {\n                              formId: 'create-corporation-form',\n                              targetType: 'corporation'\n                            }\n                          ],\n                          useAfterCreation: false\n                        },\n                        enableInPlaceEditing: true,\n                        whenEmptyExternalSuggestionCopyValueFrom: {\n                          inputRef: 'mainEntryPersonInput'\n                        }\n                      }\n                    },\n                    {\n                      rdfProperty: 'role',\n                      widgetOptions: {\n                        whenEmptyExternalSuggestionCopyValueFrom: {\n                          inputRef: 'mainEntryRoleInput',\n                          warnWhenCopyingSubset: {\n                            message: 'Fyll inn verdi for Rolle også for deler som bare har forslag om Aktør fra før',\n                            allowByDefault: false\n                          }\n                        }\n                      }\n                    },\n                    {\n                      label: 'pubPartMainTitleLabel',\n                      rdfProperty: 'mainTitle',\n                      required: true,\n                      widgetOptions: {\n                        enableBulkEntry: {\n                          autoNumberInputRef: 'publicationPartNumberInput',\n                          rows: 10\n                        }\n                      }\n                    },\n                    {\n                      label: 'workLabel',\n                      id: 'publicationPartWorkInput',\n                      rdfProperty: 'publicationOf',\n                      type: 'searchable-with-result-in-side-panel',\n                      nameProperties: [ '@mainEntryName.', 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.' ],\n                      indexTypes: [ 'workUnstructured' ], // this is the name of the elasticsearch index type from which authorities are searched within\n                      widgetOptions: {\n                        enableEditResource: {\n                          formRefs: [ {\n                            formId: 'create-work-form',\n                            targetType: 'workUnstructured' // these are matched against index types, hence lower case\n                          } ]\n                        },\n                        enableInPlaceEditing: true\n                      }\n                    },\n                    {\n                      label: 'part',\n                      rdfProperty: 'partNumber',\n                      id: 'publicationPartNumberInput'\n                    },\n                    // the following pair of properties is a range, which will be placed on the same line, with the label of the first one only.\n                    {\n                      includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'SheetMusic', 'ComicBook' ] },\n                      label: 'pageNumbers',\n                      id: 'startsAtPageInput',\n                      rdfProperty: 'startsAtPage',\n                      widgetOptions: {\n                        isRangeStart: true,\n                      }\n                    },\n                    {\n                      includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'SheetMusic', 'ComicBook' ] },\n                      label: 'emptyLabel',\n                      rdfProperty: 'endsAtPage',\n                      widgetOptions: {\n                        isRangeEnd: true,\n                      }\n                    }\n                  ]\n                },\n                addAnotherLabel: 'addAnotherPart',\n                subjects: [ 'Publication' ]\n              }\n            ],\n            nextStep: {\n              buttonLabel: 'nextStepAdditionalEntries',\n              showOnlyWhenInputHasValue: 'mediaTypeInput'\n            }\n          },\n          {\n            // additional entries, such as translator, illustrator, composer etc\n            id: 'confirm-addedentry',\n            rdfType: 'Work',\n            label: 'additionalEntriesTabLabel',\n            inputs: [\n              {\n                label: 'additionalEntryLabel',\n                multiple: true, // can have many of these\n                addAnotherLabel: 'addAnotherAdditionalEntry',\n                reportFormat: {\n                  list: true\n                },\n                subInputs: { // input is a group of sub inputs, which are connected to resource as other ends of a blank node\n                  rdfProperty: 'contributor', // the rdf property of the resource\n                  range: 'Contribution', // this is the shorthand name of the type of the blank node\n                  inputs: [ // these are the actual sub inputs\n                    {\n                      required: true,\n                      label: 'agentLabel',\n                      rdfProperty: 'agent',\n                      id: 'contributionAgentInput',\n                      indexTypes: [ 'person', 'corporation' ],\n                      nameProperties: personCorpNameProperties,\n                      previewProperties: [ 'specification', 'birthYear-', 'deathYear', 'nationality.fragment.' ],\n                      type: 'searchable-with-result-in-side-panel',\n                      widgetOptions: {\n                        showSelectItem: false, // show and enable select work radio button\n                        enableEditResource: {\n                          formRefs: [\n                            {\n                              formId: 'create-person-form',\n                              targetType: 'person'\n                            },\n                            {\n                              formId: 'create-corporation-form',\n                              targetType: 'corporation'\n                            }\n                          ],\n                          useAfterCreation: false\n                        },\n                        enableInPlaceEditing: true\n                      }\n                    },\n                    {\n                      required: true,\n                      rdfProperty: 'role'\n                    }\n                  ]\n                },\n                subjects: [ 'Work', 'Publication' ], // blank node can be attached to the the loaded resource of one of these types\n                cssClassPrefix: 'additional-entries' // prefix of class names to identify a span surrounding this input or group of sub inputs.\n                // actual names are <prefix>-non-editable and <prefix>-editable to enable alternative presentation when not editable\n              }\n            ],\n            nextStep: {\n              buttonLabel: 'finishRegisterPublication',\n              showOnlyWhenInputHasValue: 'mediaTypeInput',\n              restart: true\n            }\n          }\n        ],\n        authorityMaintenance: [\n          {\n            inputs: [\n              maintenanceInputs('maintPersonLabelPlur', 'person'),\n              maintenanceInputs('maintCorporationLabelPlur', 'corporation'),\n              maintenanceInputs('maintGeneralSubjectLabelPlur', 'subject'),\n              maintenanceInputs('maintPlaceLabelPlur', 'place'),\n              maintenanceInputs('maintEventLabelPlur', 'event'),\n              maintenanceInputs('maintGenreLabelPlur', 'genre'),\n              maintenanceInputs('maintSerialLabelPlur', 'serial'),\n              maintenanceInputs('maintWorkSeriesLabelPlur', 'workseries'),\n              maintenanceInputs('maintInstrumentLabelPlur', 'instrument'),\n              maintenanceInputs('maintCompositionTypeLabelPlur', 'compositiontype'),\n              {\n                // this is an input type used to search for a main resource, e.g. Work. The rendered input field\n                // will not be tied to a particular subject and predicate\n                searchMainResource: {\n                  label: 'maintPublicationLabelPlur',\n                  indexType: 'publication'\n                },\n                widgetOptions: {\n                  maintenance: true,\n                  editWithTemplate: {\n                    template: 'workflow',\n                    descriptionKey: 'maintPub'\n                  }\n                }\n              },\n              {\n                searchMainResource: {\n                  label: 'maintWorkLabelPlur',\n                  indexType: 'workUnstructured'\n                },\n                widgetOptions: {\n                  maintenance: true,\n                  editWithTemplate: {\n                    template: 'workflow',\n                    descriptionKey: 'maintWork'\n                  },\n                  editSubItemWithTemplate: 'workflow'\n                }\n              }\n            ]\n          }\n        ],\n        search: {\n          person: {\n            type: 'person',\n            alphabeticalList: true,\n            exactMatchCompareField: 'name',\n            selectIndexLabel: 'personLabel',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            resultItemLabelProperties2: [ 'displayLine2' ],\n            itemHandler: 'personItemHandler',\n            scrollToMiddleOfResultSet: true\n          },\n          subject: {\n            type: 'subject',\n            alphabeticalList: true,\n            exactMatchCompareField: 'prefLabel',\n            selectIndexLabel: 'generalSubjectLabel',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            scrollToMiddleOfResultSet: true\n          },\n          work: {\n            type: 'work',\n            structuredQuery: true,\n            selectIndexLabel: 'workLabel',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            resultItemLabelProperties2: [ 'displayLine2' ],\n            linkFromUri: {\n              regExp: '^http:\\\/\\\/data\\\\.deichman\\\\.no\\\/work\\\/(w[a-f0-9]+)$',\n              replacement: 'http://sok.deichman.no/work/$1',\n              toolTip: 'Vis verket på publikumssiden'\n            },\n            itemHandler: 'workItemHandler'\n          },\n          workUnstructured: {\n            type: 'work',\n            selectIndexLabel: 'workLabel',\n            legend: 'searchWorkLegend',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            resultItemLabelProperties2: [ 'displayLine2' ],\n            linkFromUri: {\n              regExp: '^http:\\\/\\\/data\\\\.deichman\\\\.no\\\/work\\\/(w[a-f0-9]+)$',\n              replacement: 'http://sok.deichman.no/work/$1',\n              toolTip: 'Vis verket på publikumssiden'\n            },\n            itemHandler: 'workItemHandler'\n          },\n          genre: {\n            type: 'genre',\n            selectIndexLabel: 'genreLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'prefLabel',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            scrollToMiddleOfResultSet: true\n          },\n          corporation: {\n            type: 'corporation',\n            selectIndexLabel: 'corporationLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'name',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            scrollToMiddleOfResultSet: true\n          },\n          place: {\n            type: 'place',\n            selectIndexLabel: 'placeLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'prefLabel',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            scrollToMiddleOfResultSet: true\n          },\n          event: {\n            type: 'event',\n            selectIndexLabel: 'eventLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'prefLabel',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            scrollToMiddleOfResultSet: true\n          },\n          serial: {\n            type: 'serial',\n            selectIndexLabel: 'serialLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'serialMainTitle',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            scrollToMiddleOfResultSet: true\n          },\n          publication: {\n            type: 'publication',\n            selectIndexLabel: 'publication',\n            legend: 'searchPublicationLegend',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            resultItemLabelProperties2: [ 'displayLine2' ],\n            itemHandler: 'publicationItemHandler',\n            publicationLink: true\n          },\n          instrument: {\n            type: 'instrument',\n            selectIndexLabel: 'instrumentLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'prefLabel',\n            resultItemLabelProperties: [ 'prefLabel', 'inParens:specification' ],\n            scrollToMiddleOfResultSet: true\n          },\n          compositiontype: {\n            type: 'compositionType',\n            selectIndexLabel: 'compositionTypeLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'prefLabel',\n            resultItemLabelProperties: [ 'prefLabel', 'inParens:specification' ],\n            scrollToMiddleOfResultSet: true\n          },\n          workseries: {\n            type: 'workSeries',\n            selectIndexLabel: 'workSeriesLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'workSeriesMainTitle',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            //resultItemDetailsLabelProperties: [ 'partNumber.', 'partTitle' ],\n            scrollToMiddleOfResultSet: true\n          }\n        },\n        relationTargetLabels: {\n          Work: [ 'mainTitle', ':subtitle', 'partNumber.', 'partTitle', 'publicationYear,' ],\n          Publication: [ 'mainTitle', ':subtitle', 'partNumber.', 'partTitle', 'publicationYear,' ],\n          PublicationPart: [ 'mainTitle' ]\n        },\n        typeMap: {\n          // this map contains a map of all known independent resource types (i.e. not blank node types) as they appear in\n          // resource urls and their canonical names\n          work: 'Work',\n          person: 'Person',\n          publication: 'Publication',\n          genre: 'Genre',\n          subject: 'Subject',\n          place: 'Place',\n          event: 'Event',\n          serial: 'Serial',\n          corporation: 'Corporation',\n          instrument: 'Instrument',\n          compositionType: 'CompositionType',\n          workSeries: 'WorkSeries'\n        },\n        rdfTypeToIndexType: {\n          'Work': 'work'\n        },\n        resourceTypeAliases: {\n          'compositiontype': 'compositionType',\n          'workseries': 'workSeries'\n        },\n        prefillValuesFromExternalSources: [\n          { resourceType: 'Work', demandTopBanana: true },\n          { resourceType: 'Publication' },\n          {\n            resourceType: 'Person',\n            wrappedIn: 'Contribution',\n            predicate: 'agent',\n            enableEditResource: true\n          },\n          {\n            resourceType: 'Person',\n            wrappedIn: 'PublicationPart',\n            predicate: 'agent',\n            enableEditResource: true\n          },\n          {\n            resourceType: 'Serial',\n            wrappedIn: 'SerialIssue',\n            predicate: 'serial',\n            enableEditResource: true\n          },\n          {\n            resourceType: 'Person',\n            wrappedIn: '/Work',\n            predicate: 'subject',\n            enableEditResource: true\n          },\n          {\n            resourceType: 'Place',\n            wrappedIn: '/Work',\n            predicate: 'subject',\n            enableEditResource: true\n          },\n          {\n            resourceType: 'Event',\n            wrappedIn: '/Work',\n            predicate: 'subject',\n            enableEditResource: true\n          },\n          {\n            resourceType: 'Work',\n            wrappedIn: '/Work',\n            predicate: 'subject',\n            enableEditResource: true\n          },\n          {\n            resourceType: 'Subject',\n            wrappedIn: '/Work',\n            predicate: 'subject',\n            enableEditResource: true\n          },\n          {\n            resourceType: '/Work',\n            wrappedIn: 'PublicationPart',\n            predicate: 'publicationOf',\n            enableEditResource: true\n          }\n        ],\n        translations: {\n          Work: {\n            indet: 'verk',\n            det: 'verket',\n          },\n          Publication: {\n            indet: 'utgivelse',\n            det: 'utgivelsen'\n          },\n          PublicationPart: {\n            indet: 'utgivelsesdel',\n            det: 'utgivelsendelen'\n          },\n          Person: {\n            indet: 'person',\n            det: 'personen'\n          },\n          Corporation: {\n            indet: 'korporasjon',\n            det: 'korporasjonen'\n          },\n          Subject: {\n            indet: 'emne',\n            det: 'emnet'\n          },\n          Place: {\n            indet: 'sted',\n            det: 'stedet'\n          },\n          Serial: {\n            indet: 'forlagsserie',\n            det: 'forlagsserien'\n          },\n          WorkSeries: {\n            indet: 'verksserie',\n            det: 'verksserien'\n          },\n          Genre: {\n            indet: 'sjanger',\n            det: 'sjangeren'\n          },\n          Event: {\n            indet: 'hendelse',\n            det: 'hendelsen'\n          }\n        },\n        abbreviations: {\n          'Del nummer': 'Delnr.',\n          'Utgivelsesår': 'Utg.år'\n        },\n        inverseLabels: {\n          'Emne': 'Som emne',\n          'Utgivelse av': 'Har utgivelse',\n          'Har delutgivelse': 'Utgitt som del',\n          'I serie': 'I samme serie',\n          'Del av verksserie': 'Andre verk i samme serie',\n          'Sjanger': 'Verk i samme sjanger',\n          'Utgivelsessted': 'Utgitt samme sted',\n          'Subject': 'As subject',\n          'Publication of': 'Published',\n          'Has publication part': 'Published as part',\n          'In serial': 'In the same series',\n          'Part of work series': 'Other works in same series',\n          'Genre': 'I this genre',\n          'Place of publication': 'Published at this place'\n        },\n        headlines: {\n          Work: [\n            {\n              input: 'mainEntryPersonInput',\n              postfix: '. '\n            },\n            {\n              input: 'workMainTitle',\n              joinBy: {\n                input: 'workSubtitle',\n                separator: ' : '\n              },\n              postfix: '. '\n            },\n            {\n              input: 'workPartNumber',\n              postfix: '. '\n            },\n            {\n              input: 'workPartTitle',\n              postfix: '. '\n            },\n          ],\n          Publication: [\n            {\n              input: 'mainEntryPersonInput',\n              postfix: '. '\n            },\n            {\n              input: 'publicationMainTitle',\n              joinBy: {\n                input: 'publicationSubtitle',\n                separator: ' : '\n              },\n              postfix: '. '\n            },\n            {\n              input: [ 'publicationPartNumber' ],\n              postfix: '. '\n            },\n            {\n              input: [ 'publicationPartTitle' ],\n              postfix: '. '\n            },\n            {\n              input: [ 'publicationYearInput' ],\n              postfix: ' '\n            },\n            {\n              input: [ 'recordIdInput' ],\n              prefix: '(',\n              postfix: ') '\n            }\n          ]\n        }\n      }\n    response.json(config)\n  })\n}\n",
                "new_contents": "const _ = require('underscore')\n\nfunction maintenanceInputs (label, type) {\n  return {\n    // this is an input type used to search for a main resource, e.g. Work. The rendered input field\n    // will not be tied to a particular subject and predicate\n    searchMainResource: {\n      label: label,\n      indexType: type\n    },\n    // this is used to control how the search result in the support panel behaves\n    widgetOptions: {\n      maintenance: true,\n      // make it possible to create a work resource if necessary,\n      enableEditResource: {\n        formRefs: [ {\n          formId: 'create-' + type + '-form',\n          targetType: type\n        } ]\n      },\n      enableInPlaceEditing: true\n    }\n  }\n}\n\nfunction createdTimestamp () {\n  return {\n    rdfProperty: 'created',\n    readOnly: true,\n    oneLiner: true\n  }\n}\n\nfunction modifiedTimestamp () {\n  return {\n    rdfProperty: 'modified',\n    readOnly: true,\n    oneLiner: true\n  }\n}\n\nmodule.exports = (app) => {\n  app.get('/config', function (request, response) {\n    response.setHeader('Cache-Control', 'public, max-age=3600')\n    response.setHeader('Expires', new Date(Date.now() + 3600000).toUTCString())\n    const typeMap = {\n      // this map contains a map of all known independent resource types (i.e. not blank node types) as they appear in\n      // resource urls and their canonical names\n      work: 'Work',\n      person: 'Person',\n      publication: 'Publication',\n      genre: 'Genre',\n      subject: 'Subject',\n      place: 'Place',\n      event: 'Event',\n      serial: 'Serial',\n      corporation: 'Corporation',\n      instrument: 'Instrument',\n      compositionType: 'CompositionType',\n      workSeries: 'WorkSeries',\n    }\n    const personCorpNameProperties = [\n      'prefLabel',\n      'name,',\n      {\n        person: '#ordinal,',\n        event: '(ordinal).'\n      },\n      'subdivision',\n      {\n        'corporation|subject|work|place|genre|compositiontype|instrument': '(specification)',\n        person: 'specification,'\n      },\n      'birthYear-', 'deathYear,',\n      'nationality.fragment.'\n    ]\n    const config =\n      {\n        kohaOpacUri: (process.env.KOHA_OPAC_PORT || 'http://192.168.50.12:8080').replace(/^tcp:\//, 'http:/'),\n        kohaIntraUri: (process.env.KOHA_INTRA_PORT || 'http://192.168.50.12:8081').replace(/^tcp:\//, 'http:/'),\n        ontologyUri: '/services/ontology',\n        resourceApiUri: '/services/',\n        inputForms: [\n          {\n            id: 'create-person-form',\n            rdfType: 'Person',\n            labelForCreateButton: 'createNewPersonLabel',\n            inputs: [\n              {\n                rdfProperty: 'name',\n                displayValueSource: true,\n                // after resource is created, the value entered\n                // in input marked with this is used to populate displayValue of the parent input\n                preFillFromSearchField: true,\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'birthYear',\n                prefillFromSuggestion: true\n              },\n              {\n                rdfProperty: 'deathYear'\n              },\n              {\n                rdfProperty: 'nationality',\n                multiple: true\n              },\n              {\n                rdfProperty: 'gender'\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string-large'\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              {\n                rdfProperty: 'ordinal',\n                type: 'input-string'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-subject-form',\n            labelForCreateButton: 'createNewSubjectLabel',\n            rdfType: 'Subject',\n            inputs: [\n              {\n                rdfProperty: 'prefLabel',\n                displayValueSource: true,\n                type: 'input-string',\n                // after resource is created, the value entered\n                // in input marked with this is used to populate displayValue of the parent input\n                preFillFromSearchField: true\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string-large'\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-genre-form',\n            labelForCreateButton: 'createNewGenreLabel',\n            rdfType: 'Genre',\n            inputs: [\n              {\n                rdfProperty: 'prefLabel',\n                displayValueSource: true,\n                type: 'input-string',\n                // after resource is created, the value entered\n                // in input marked with this is used to populate displayValue of the parent input\n                preFillFromSearchField: true\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string-large'\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-corporation-form',\n            labelForCreateButton: 'createNewCorporationLabel',\n            rdfType: 'Corporation',\n            inputs: [\n              {\n                rdfProperty: 'name',\n                displayValueSource: true,\n                type: 'input-string',\n                // after resource is created, the value entered\n                // in input marked with this is used to populate displayValue of the parent input\n                preFillFromSearchField: true\n              },\n              {\n                rdfProperty: 'subdivision',\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'place',\n                type: 'searchable-authority-dropdown',\n                indexTypes: 'place',\n                indexDocumentFields: [ 'displayLine1' ]\n              },\n              {\n                rdfProperty: 'nationality',\n                multiple: true\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-main-work-form',\n            prefillFromAcceptedSource: true,\n            labelForCreateButton: 'createNewWorkLabel',\n            rdfType: 'Work',\n            inputs: [\n              {\n                rdfProperty: 'mainTitle',\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                preFillFromSearchField: true, // value of this field should be copied from the search field above\n                displayValueSource: true // after creation, send actual value in this field back to where the search started\n              },\n              {\n                type: 'input-string',\n                rdfProperty: 'subtitle'\n              },\n              {\n                type: 'input-string',\n                rdfProperty: 'partNumber'\n              },\n              {\n                type: 'input-string',\n                rdfProperty: 'partTitle'\n              },\n              {\n                rdfProperty: 'hasWorkType',\n                type: 'hidden-url-query-value',\n                widgetOptions: {\n                  queryParameter: 'hasWorkType',\n                  prefix: 'http://data.deichman.no/workType#'\n                }\n              }\n            ],\n            templateResourcePartsFrom: [ 'workTypeInput', 'mediaTypeInput']\n          },\n          {\n            id: 'create-work-form',\n            labelForCreateButton: 'createNewWorkLabel',\n            rdfType: 'Work',\n            inputs: [\n              {\n                rdfProperty: 'mainTitle',\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                preFillFromSearchField: true, // value of this field should be copied from the search field above\n                displayValueSource: true // after creation, send actual value in this field back to where the search started\n              },\n              {\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                rdfProperty: 'subtitle'\n              },\n              {\n                type: 'input-string',\n                rdfProperty: 'partNumber'\n              },\n              {\n                type: 'input-string',\n                rdfProperty: 'partTitle'\n              },\n              {\n                rdfProperty: 'hasWorkType'\n              }\n            ],\n            templateResourcePartsFrom: [ 'workTypeInput', 'mediaTypeInput' ]\n          },\n          {\n            id: 'create-workseries-form',\n            labelForCreateButton: 'createNewWorkSeriesLabel',\n            rdfType: 'WorkSeries',\n            inputs: [\n              {\n                rdfProperty: 'mainTitle',\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                preFillFromSearchField: true, // value of this field should be copied from the search field above\n                displayValueSource: true // after creation, send actual value in this field back to where the search started\n              },\n              {\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                rdfProperty: 'subtitle'\n              },\n              {\n                label: 'seriesPartNumber',\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                rdfProperty: 'partNumber'\n              },\n              {\n                label: 'subSeriesTitle',\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                rdfProperty: 'partTitle'\n              }\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-place-form',\n            labelForCreateButton: 'createNewPlaceLabel',\n            rdfType: 'Place',\n            inputs: [\n              {\n                label: 'nameLabel',\n                rdfProperty: 'prefLabel',\n                displayValueSource: true,\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                preFillFromSearchField: true // value of this field should be copied from the search field above\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string'\n                // input type must be defined explicitly, otherwise it will inherit from the search field above\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-event-form',\n            labelForCreateButton: 'createNewEventLabel',\n            rdfType: 'Event',\n            inputs: [\n              {\n                label: 'nameLabel',\n                rdfProperty: 'prefLabel',\n                displayValueSource: true,\n                type: 'input-string',\n                preFillFromSearchField: true // value of this field should be copied from the search field above\n              },\n              {\n                rdfProperty: 'place',\n                type: 'searchable-authority-dropdown',\n                indexTypes: 'place',\n                indexDocumentFields: [ 'displayLine1' ]\n              },\n              {\n                rdfProperty: 'ordinal',\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'date',\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-serial-form',\n            labelForCreateButton: 'createNewSeriesLabel',\n            rdfType: 'Serial',\n            inputs: [\n              {\n                label: 'seriesTitleLabel',\n                rdfProperty: 'mainTitle',\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                preFillFromSearchField: true, // value of this field should be copied from the search field above\n                displayValueSource: true // after creation, send actual value in this field back to where the search started\n              },\n              {\n                type: 'input-string', // input type must be defined explicitly, otherwise it will inherit from the search field above\n                rdfProperty: 'subtitle'\n              },\n              {\n                label: 'seriesPartNumber',\n                type: 'input-string',\n                rdfProperty: 'partNumber'\n              },\n              {\n                label: 'subSeriesTitle',\n                type: 'input-string',\n                rdfProperty: 'partTitle'\n              },\n              {\n                type: 'input-string',\n                rdfProperty: 'issn'\n              },\n              {\n                label: 'publishedByLabel',\n                rdfProperty: 'publishedBy',\n                type: 'searchable-authority-dropdown',\n                indexTypes: 'corporation',\n                nameProperties: [ 'name', 'subdivision', 'placePrefLabel', '(specification)' ],\n                indexDocumentFields: [ 'displayLine1' ]\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-instrument-form',\n            labelForCreateButton: 'createNewInstrumentLabel',\n            rdfType: 'Instrument',\n            inputs: [\n              {\n                label: 'nameLabel',\n                rdfProperty: 'prefLabel',\n                type: 'input-string',\n                preFillFromSearchField: true\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          },\n          {\n            id: 'create-compositiontype-form',\n            labelForCreateButton: 'createNewCompositionTypeLabel',\n            rdfType: 'CompositionType',\n            inputs: [\n              {\n                label: 'nameLabel',\n                rdfProperty: 'prefLabel',\n                type: 'input-string',\n                preFillFromSearchField: true\n              },\n              {\n                rdfProperty: 'specification',\n                type: 'input-string'\n              },\n              {\n                rdfProperty: 'alternativeName',\n                type: 'input-string',\n                multiple: true,\n                addAnotherLabel: 'addAnotherAlternativeName'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            templateResourcePartsFrom: []\n          }\n        ],\n        tabs: [\n          {\n            id: 'confirm-person',\n            rdfType: 'Work',\n            label: 'mainEntryLabel',\n            inputs: [\n              {\n                id: 'isbnInput',\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Book', 'Audiobook', 'SheetMusic', 'ComicBook', 'LanguageCourse', 'E-book' ]\n                },\n                // this is an input type used to search for a main resource, e.g. Work. The rendered input field\n                // will not be tied to a particular subject and predicate\n                searchForValueSuggestions: {\n                  label: 'BSSearchLabel',\n                  placeHolder: 'ISBNLabel',\n                  pattern: '^[ 0-9\\\\-]+[xX]?\\\\s*$',\n                  formatter: 'isbn',\n                  patternMismatchMessage: 'invalidIsbnNumber',\n                  parameterName: 'isbn',\n                  automationId: 'searchValueSuggestions',\n                  showOnlyWhenMissingTargetUri: 'Work', // only show this search field if a work has not been loaded or created\n                  sources: [ 'bibbi' ],\n                  preferredSource: {\n                    id: 'bibbi',\n                    name: 'Biblioteksentralen'\n                  },\n                  checkExistingResource: {\n                    url: 'services/publication/isbn',\n                    queryParameter: 'isbn',\n                    showDetails: [ 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.', 'publicationYear' ],\n                    type: 'Publication',\n                    legendSingular: 'alreadyRegisteredISBNSingular',\n                    legendPlural: 'alreadyRegisteredISBNPlural',\n                    editWithTemplate: {\n                      template: 'workflow',\n                      descriptionKey: 'maintPub'\n                    }\n                  }\n                }\n              },\n              {\n                id: 'dfbInputISBN',\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Book', 'Audiobook', 'SheetMusic', 'ComicBook', 'LanguageCourse', 'E-book' ]\n                },\n                // this is an input type used to search for a main resource, e.g. Work. The rendered input field\n                // will not be tied to a particular subject and predicate\n                searchForValueSuggestions: {\n                  label: 'DFBSearchLabel',\n                  placeHolder: 'DFBPlaceHolderISBN',\n                  formatter: 'isbn',\n                  patternMismatchMessage: 'invalidIsbnNumber',\n                  searchParameterSpecs: [\n                    {\n                      ccl: 'isbn',\n                      labelKey: 'ISBNLabel',\n                      pattern: '^(isbn:\\s*)?([0-9\\-]{10,}[xX]?)\\s*$',\n                      parameter: 'isbn',\n                      groupNumber: 2,\n                      validatePattern: '^[ 0-9\\\\-]+[xX]?\\\\s*$',\n                      verifyExists: 'isbn',\n                      checkExistingResource: {\n                        url: 'services/publication/isbn',\n                        showDetails: [ 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.', 'publicationYear' ],\n                        queryParameter: 'isbn',\n                        type: 'Publication',\n                        legendSingular: 'alreadyRegisteredISBNSingular',\n                        legendPlural: 'alreadyRegisteredISBNPlural',\n                        editWithTemplate: {\n                          template: 'workflow',\n                          descriptionKey: 'maintPub'\n                        }\n                      }\n                    },\n                    {\n                      ccl: 'id',\n                      labelKey: 'localIdlabel',\n                      pattern: '^(id:\\s*)?([0-9^\\\\-]+)\\s*$',\n                      groupNumber: 2,\n                      parameter: 'local_id'\n                    },\n                    {\n                      ccl: 'ti',\n                      labelKey: 'titleLabel',\n                      pattern: '^(ti:\\s*)?([^,]+)\\s*$',\n                      groupNumber: 2,\n                      parameter: 'title'\n                    },\n                    {\n                      ccl: 'fo',\n                      labelKey: 'authorLabel',\n                      pattern: '^(fo:\\s*)?(.+)\\s*$',\n                      groupNumber: 2,\n                      parameter: 'author'\n                    }\n                  ],\n                  automationId: 'searchValueSuggestions',\n                  showOnlyWhenMissingTargetUri: 'Work', // only show this search field if a work has not been loaded or created\n                  sources: [ 'dfb' ],\n                  preferredSource: {\n                    id: 'dfb',\n                    name: 'Det flerspråklige bibliotek'\n                  }\n                }\n              },\n              {\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Film', 'MusicRecording', 'Game' ]\n                },\n                // this is an input type used to search for a main resource, e.g. Work. The rendered input field\n                // will not be tied to a particular subject and predicate\n                searchForValueSuggestions: {\n                  label: 'BSSearchLabel',\n                  placeHolder: 'EANLabel',\n                  pattern: '[0-9]{12,14}',\n                  patternMismatchMessage: 'invalidEanNumber',\n                  parameterName: 'ean',\n                  automationId: 'searchEanValueSuggestions',\n                  showOnlyWhenMissingTargetUri: 'Work', // only show this search field if a work has not been loaded or created\n                  sources: [ 'bibbi' ],\n                  preferredSource: {\n                    id: 'bibbi',\n                    name: 'Biblioteksentralen'\n                  },\n                  checkExistingResource: {\n                    url: 'services/publication',\n                    queryParameter: 'hasEan',\n                    showDetails: [ 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.', 'publicationYear' ],\n                    type: 'Publication',\n                    legendSingular: 'alreadyRegisteredEANSingular',\n                    legendPlural: 'alreadyRegisteredEANPlural',\n                    editWithTemplate: {\n                      template: 'workflow',\n                      descriptionKey: 'maintPub'\n                    }\n                  }\n                }\n              },\n              {\n                id: 'dfbInputEAN',\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Film', 'MusicRecording', 'Game' ]\n                },\n                // this is an input type used to search for a main resource, e.g. Work. The rendered input field\n                // will not be tied to a particular subject and predicate\n                searchForValueSuggestions: {\n                  label: 'DFBSearchLabel',\n                  placeHolder: 'DFBPlaceHolderEAN',\n                  patternMismatchMessage: 'invalidEanNumber',\n                  searchParameterSpecs: [\n                    {\n                      ccl: 'ean',\n                      labelKey: 'EANLabel',\n                      pattern: '^(ean:\\\\s*)?([0-9\\-]{10,}[xX]?)\\\\s*$',\n                      parameter: 'ean',\n                      groupNumber: 2,\n                      validatePattern: '^[ 0-9\\\\-]+[xX]?\\\\s*$',\n                      checkExistingResource: {\n                        url: 'services/publication',\n                        queryParameter: 'hasEan',\n                        type: 'Publication',\n                        showDetails: [ 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.', 'publicationYear' ],\n                        legendSingular: 'alreadyRegisteredEANSingular',\n                        legendPlural: 'alreadyRegisteredEANPlural',\n                        editWithTemplate: {\n                          template: 'workflow',\n                          descriptionKey: 'maintPub'\n                        }\n                      }\n                    },\n                    {\n                      ccl: 'id',\n                      labelKey: 'localIdlabel',\n                      pattern: '^(id:\\\\s*)?([0-9^\\\\-]+)\\\\s*$',\n                      groupNumber: 2,\n                      parameter: 'local_id'\n                    },\n                    {\n                      ccl: 'ti',\n                      labelKey: 'titleLabel',\n                      pattern: '^(ti:\\\\s*)?([^,]+)\\\\s*$',\n                      groupNumber: 2,\n                      parameter: 'title'\n                    },\n                    {\n                      ccl: 'fo',\n                      labelKey: 'authorLabel',\n                      pattern: '^(fo:\\\\s*)?(.+)\\\\s*$',\n                      groupNumber: 2,\n                      parameter: 'author'\n                    }\n                  ],\n                  automationId: 'searchValueSuggestions',\n                  showOnlyWhenMissingTargetUri: 'Work', // only show this search field if a work has not been loaded or created\n                  sources: [ 'dfb' ],\n                  preferredSource: {\n                    id: 'dfb',\n                    name: 'Det flerspråklige bibliotek'\n                  }\n                }\n              },\n              {\n                label: 'missingMainEntryLabel',\n                id: 'missingMainEntry',\n                rdfProperty: 'missingMainEntry'\n              },\n              {\n                label: 'mainContributorLabel',\n                id: 'mainEntryInput',\n                reportFormat: {\n                  list: true\n                },\n                showOnlyWhen: {\n                  inputId: 'missingMainEntry',\n                  valueAsStringMatches: '^false$|^null$|^undefined'\n                },\n                subInputs: { // input is a group of sub inputs, which are connected to resource as other ends of a blank node\n                  rdfProperty: 'contributor', // the rdf property of the resource\n                  range: 'Contribution', // this is the shorthand name of the type of the blank node\n                  inputs: [ // these are the actual sub inputs\n                    {\n                      label: 'agentLabel',\n                      rdfProperty: 'agent',\n                      indexTypes: [ 'person', 'corporation' ],\n                      type: 'searchable-with-result-in-side-panel',\n                      required: true,\n                      nameProperties: personCorpNameProperties,\n                      headlineNameProperties: [ 'name', 'prefLabel'],\n                      previewProperties: [ {\n                        person: '#ordinal,',\n                        event: '(ordinal).'\n                      },\n                        'subdivision',\n                        {\n                          corporation: '(specification)',\n                          person: 'specification,'\n                        },\n                        'placePrefLabel,', 'birthYear-', 'deathYear', 'nationality.fragment.' ],\n                      dependentResourceTypes: [ 'Work', 'Publication' ], // when the creator is changed, unload current work and publication\n                      id: 'mainEntryPersonInput',\n                      widgetOptions: {\n                        showSelectItem: true, // show and enable select work radio button\n                        enableEditResource: {\n                          formRefs: [\n                            {\n                              formId: 'create-person-form',\n                              targetType: 'person'\n                            },\n                            {\n                              formId: 'create-corporation-form',\n                              targetType: 'corporation'\n                            }\n                          ],\n                          useAfterCreation: false\n                        },\n                        enableInPlaceEditing: true\n                      }\n                    },\n                    {\n                      id: 'mainEntryRoleInput',\n                      rdfProperty: 'role',\n                      required: true\n                    }\n                  ]\n                },\n                isMainEntry: true,\n                // blank nodes connected to this input is expected to have type deichman:MainEntry in addition to its own type (range)\n                subjects: [ 'Work' ], // blank node can be attached to the the loaded resource of one of these types\n                cssClassPrefix: 'additional-entries' // prefix of class names to identify a span surrounding this input or group of sub inputs.\n                // actual names are <prefix>-non-editable and <prefix>-editable to enable alternative presentation when not editable\n              },\n              {\n                label: 'improperWorkLabel',\n                rdfProperty: 'improperWork'\n              },\n              {\n                // this is an input type used to search for a main resource, e.g. Work. The rendered input field\n                // will not be tied to a particular subject and predicate\n                id: 'searchMainResourceInput',\n                isTitleSource: {\n                  priority: 3,\n                  qualifier: ' - verk'\n                },\n                searchMainResource: {\n                  label: 'searchWorkAsMainResourceLabel',\n                  placeHolder: 'workTitlePlaceHolder',\n                  indexType: 'work',\n                  automationId: 'searchWorkAsMainResource',\n                  showOnlyWhenMissingTargetUri: 'Work' // only show this search field if a work has not been loaded or created\n                },\n                suggestValueFrom: {\n                  domain: 'Work',\n                  predicate: '#mainTitle'\n                },\n                // this is used to control how the search result in the support panel behaves\n                widgetOptions: {\n                  // make it possible to create a work resource if necessary,\n                  enableEditResource: {\n                    formRefs: [ {\n                      formId: 'create-main-work-form',\n                      targetType: 'work'\n                    } ],\n                    useAfterCreation: {\n                      excludeInputRefs: [ 'mainEntryPersonInput', 'mainEntryRoleInput' ]\n                    }\n                  },\n                  filter: {\n                    inputRef: 'mainEntryPersonInput',\n                    name: 'personAsMainEntryFilter'\n                  }\n                }\n              }\n            ],\n            nextStep: {\n              showOnlyWhenInputHasValue: 'mediaTypeInput',\n              buttonLabel: 'nextStepDescription',\n              disabledUnless: {\n                presentTargetUri: 'Work',\n                inputIsNonEditableWhenNotOverridden: {\n                  nonEditableInput: 'mainEntryPersonInput',\n                  overridingInput: 'missingMainEntry'\n                },\n                disabledTooltip: 'For å komme videre, må du registrere hovedinnførsel og idenfisere eller opprette verk.'\n              },\n              createNewResource: {\n                type: 'Publication',\n                copyInputValues: {\n                  workMainTitle: 'publicationMainTitle',\n                  workSubtitle: 'publicationSubtitle',\n                  workPartNumber: 'publicationPartNumber',\n                  workPartTitle: 'publicationPartTitle'\n                },\n                templateResourcePartsFrom: [ 'mediaTypeInput' ]\n              }\n            }\n          },\n          {\n            id: 'describe-publication',\n            rdfType: 'Publication',\n            label: 'publicationTabLabel',\n            reportLabel: 'publicationLabel',\n            inputs: [\n              { rdfProperty: 'hasPrimaryCataloguingSource', initiallyHidden: true },\n              { rdfProperty: 'hasIdentifierInPrimaryCataloguingSource', initiallyHidden: true },\n              {\n                rdfProperty: 'mainTitle',\n                id: 'publicationMainTitle',\n                isTitleSource: {\n                  priority: 1,\n                  qualifier: ' - utgivelse'\n                }\n              },\n              {\n                rdfProperty: 'subtitle',\n                id: 'publicationSubtitle'\n              },\n              {\n                rdfProperty: 'untranscribedTitle',\n                id: 'untranscribedPublicationTitleInput',\n                esotericWhen: 'always',\n              },\n              {\n                rdfProperty: 'partNumber',\n                id: 'publicationPartNumber',\n                esotericWhen: { hasMediaType: [ 'MusicRecording', 'Book', 'Audiobook', 'LanguageCourse', 'Film' ] }\n              },\n              {\n                rdfProperty: 'partTitle',\n                id: 'publicationPartTitle',\n                esotericWhen: { hasMediaType: [ 'MusicRecording', 'Book', 'Audiobook', 'LanguageCourse', 'Film' ] },\n              },\n              {\n                rdfProperty: 'variantTitle',\n                esotericWhen: { hasMediaType: [ 'MusicRecording', 'Book', 'Audiobook', 'LanguageCourse', 'ComicBook' ] },\n                multiple: true,\n                addAnotherLabel: 'addAnotherVariantTitle',\n              },\n              {\n                rdfProperty: 'edition',\n                esotericWhen: { hasMediaType: [ 'MusicRecording', 'Book', 'Audiobook', 'LanguageCourse', 'ComicBook', 'Film' ] }\n              },\n              {\n                rdfProperty: 'publicationYear',\n                id: 'publicationYearInput',\n              },\n              {\n                includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'ComicBook', 'LanguageCourse', 'SheetMusic' ] },\n                rdfProperty: 'numberOfPages',\n                multiple: true,\n                addAnotherLabel: 'addAnotherPageNumber'\n              },\n              {\n                rdfProperty: 'hasExtent',\n                esotericWhen: { hasMediaType: [ 'Book', 'ComicBook' ] },\n                addAnotherLabel: 'addAnotherExtent'\n              },\n              {\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Other', 'Film', 'MusicRecording', 'Audiobook', 'LanguageCourse' ]\n                },\n                rdfProperty: 'duration',\n                type: 'input-duration'\n              },\n              {\n                includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'SheetMusic', 'ComicBook', 'LanguageCourse', 'E-book', 'Film' ] },\n                esotericWhen: { hasMediaType: [ 'Film' ] },\n                rdfProperty: 'illustrativeMatter',\n                multiple: true\n              },\n              {\n                includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'Audiobook', 'SheetMusic', 'ComicBook', 'LanguageCourse', 'E-book' ] },\n                rdfProperty: 'isbn',\n                multiple: true,\n                formatter: 'isbn',\n                addAnotherLabel: 'addAnotherISBN'\n              },\n              {\n                includeOnlyWhen: { hasMediaType: [ 'Other', 'SheetMusic' ] },\n                rdfProperty: 'hasIsmn',\n                multiple: true,\n                addAnotherLabel: 'addAnotherISMN'\n              },\n              {\n                includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'Audiobook', 'SheetMusic', 'ComicBook', 'LanguageCourse', 'E-book', 'Film', 'MusicRecording', 'Game' ] },\n                rdfProperty: 'hasEan',\n                esotericWhen: { hasMediaType: [ 'Book', 'Audiobook', 'LanguageCourse' ] },\n                multiple: true,\n                addAnotherLabel: 'addAnotherEAN'\n              },\n              {\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Other', 'Book', 'SheetMusic', 'LanguageCourse', 'ComicBook' ]\n                },\n                rdfProperty: 'binding'\n              },\n              {\n                rdfProperty: 'language',\n                multiple: true\n              },\n              {\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Film', 'Game' ]\n                },\n                rdfProperty: 'hasSubtitles',\n                multiple: 'true'\n              },\n              {\n                rdfProperty: 'hasMediaType',\n                id: 'mediaTypeInput',\n                widgetOptions: {\n                  queryParameter: 'hasMediaType',\n                  prefix: 'http://data.deichman.no/mediaType#'\n                }\n              },\n              {\n                rdfProperty: 'format',\n                esotericWhen: { hasMediaType: [ 'Book', 'ComicBook' ] },\n                multiple: true\n              },\n              {\n                includeOnlyWhen: {\n                  hasMediaType: [ 'Other', 'Film', 'Game' ]\n                },\n                rdfProperty: 'ageLimit',\n                widgetOptions: {\n                  short: true\n                }\n              },\n              {\n                includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'E-book', 'ComicBook', 'SheetMusic' ] },\n                rdfProperty: 'writingSystem',\n                esotericWhen: { hasMediaType: [ 'Book', 'ComicBook' ] },\n                multiple: true\n              },\n              {\n                rdfProperty: 'hasFormatAdaptation',\n                includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'Audiobook', 'LanguageCourse', 'ComicBook', 'Film', 'E-book', 'SheetMusic' ] },\n                esotericWhen: { hasMediaType: [ 'Book', 'Audiobook', 'LanguageCourse', 'ComicBook', 'Film' ] },\n                multiple: true\n              },\n              {\n                id: 'publishedByInput',\n                rdfProperty: 'publishedBy',\n                multiple: true,\n                addAnotherLabel: 'addAnotherPublisher',\n                authority: true, // this indicates it is an authorized entity\n                nameProperties: [\n                  {\n                    person: 'name,',\n                    corporation: 'name.'\n                  },\n                  {\n                    person: '#ordinal,',\n                    event: '(ordinal).'\n                  },\n                  'subdivision',\n                  {\n                    corporation: '(specification)',\n                    person: 'specification,'\n                  },\n                  'placePrefLabel,',\n                  'birthYear-', 'deathYear'\n                ],\n                indexTypes: [ 'corporation', 'person' ], // this is the name of the elasticsearch index type from which authorities are searched within\n                preselectFirstIndexType: true,\n                // or authority select list are concatenated\n                type: 'searchable-with-result-in-side-panel',\n                widgetOptions: {\n                  selectIndexTypeLegend: 'selectActorType',\n                  enableEditResource: {\n                    formRefs: [\n                      {\n                        formId: 'create-corporation-form',\n                        targetType: 'corporation'\n                      },\n                      {\n                        formId: 'create-person-form',\n                        targetType: 'person'\n                      }\n                    ]\n                  },\n                  enableInPlaceEditing: true\n                },\n              },\n              {\n                id: 'hasPlaceOfPublicationInput',\n                rdfProperty: 'hasPlaceOfPublication',\n                multiple: true,\n                addAnotherLabel: 'addAnotherPublicationPlace',\n                authority: true, // this indicates it is an authorized entity\n                nameProperties: [ 'prefLabel', 'specification' ], // these are property names used to label already connected entities\n                indexTypes: 'place', // this is the name of the elasticsearch index type from which authorities are searched within\n                // the labels for authority select list are concatenated\n                type: 'searchable-with-result-in-side-panel',\n                widgetOptions: {\n                  enableEditResource: {\n                    formRefs: [ {\n                      formId: 'create-place-form',\n                      targetType: 'place'\n                    } ]\n                  },\n                  enableInPlaceEditing: true\n                }\n              },\n              {\n                label: 'seriesLabel',\n                multiple: true,\n                addAnotherLabel: 'addAnotherSeries',\n                subjects: [ 'Publication' ],\n                reportFormat: {\n                  list: true\n                },\n                subInputs: {\n                  rdfProperty: 'inSerial',\n                  range: 'SerialIssue',\n                  inputs: [\n                    {\n                      required: true,\n                      rdfProperty: 'serial',\n                      id: 'serialInput',\n                      indexTypes: 'serial',\n                      nameProperties: [ 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.', '(@publisherName)' ],\n                      type: 'searchable-with-result-in-side-panel',\n                      widgetOptions: {\n                        showSelectItem: false, // show and enable select work radio button\n                        enableEditResource: {\n                          formRefs: [ {\n                            formId: 'create-serial-form',\n                            targetType: 'serial'\n                          } ],\n                          useAfterCreation: false\n                        },\n                        enableInPlaceEditing: true\n                      }\n                    },\n                    {\n                      label: 'issueNumberLabel',\n                      rdfProperty: 'issue'\n                    }\n                  ]\n                },\n                esotericWhen: {\n                  hasMediaType: [ 'MusicRecording' ]\n                }\n              },\n              { rdfProperty: 'locationFormat' },\n              { rdfProperty: 'locationClassNumber' },\n              { rdfProperty: 'locationSignature' },\n              {\n                rdfProperty: 'hasDescription',\n                type: 'input-string-large'\n              },\n              {\n                rdfProperty: 'publicationOf',\n                id: 'publicationOfInput',\n                type: 'searchable-with-result-in-side-panel',\n                indexTypes: 'work',\n                authority: true,\n                nameProperties: [ 'mainTitle', 'subtitle' ],\n                label: '',\n                initiallyHidden: true,\n                dependentResourceTypes: [ 'Work' ], // unload work if this is cleared\n                widgetOptions: {\n                  // make it possible to create a work resource if necessary,\n                  enableEditResource: {\n                    formRefs: [ {\n                      formId: 'create-work-form',\n                      targetType: 'work'\n                    } ],\n                    useAfterCreation: false\n                  }\n                }\n              },\n              {\n                rdfProperty: 'recordId',\n                id: 'recordIdInput',\n                type: 'hidden-url-query-value',\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            nextStep: {\n              buttonLabel: 'nextStepDescribeWork',\n              showOnlyWhenInputHasValue: 'mediaTypeInput'\n            },\n            deleteResource: {\n              buttonLabel: 'deletePublication',\n              rdfType: 'Publication',\n              dialogKeypath: 'deletePublicationDialog',\n              dialogId: 'delete-publication-dialog',\n              dialogTemplateValues: {\n                work: 'workMainTitle',\n                title: 'publicationMainTitle',\n                creator: 'mainEntryPersonInput'\n              },\n              afterSuccess: {\n                restart: true\n              }\n            },\n            enableSpecialInput: {\n              inputId: 'publicationOfInput',\n              buttonLabel: 'changeWorkOfPublication',\n              confirmLabel: 'confirmChangeWorkOfPublication'\n            },\n            tools: [\n              {\n                template: 'copy-publication-and-work'\n              }\n            ]\n          },\n          {\n            id: 'describe-work',\n            rdfType: 'Work',\n            label: 'workTabLabel',\n            reportLabel: 'workLabel',\n            inputs: [\n              {\n                id: 'workMainTitle',\n                rdfProperty: 'mainTitle',\n                isTitleSource: {\n                  priority: 2,\n                  qualifier: ' - verk'\n                }\n              },\n              {\n                rdfProperty: 'subtitle',\n                id: 'workSubtitle'\n              },\n              {\n                rdfProperty: 'untranscribedTitle',\n                id: 'untranscribedWorkTitleInput',\n                esotericWhen: 'always',\n              },\n              {\n                rdfProperty: 'partNumber',\n                esotericWhen: { hasWorkType: [ 'Literature', 'Music', 'Film', 'Superwork' ] },\n                id: 'workPartNumber'\n              },\n              {\n                rdfProperty: 'partTitle',\n                esotericWhen: { hasWorkType: [ 'Literature', 'Music', 'Film', 'Superwork' ] },\n                id: 'workPartTitle'\n              },\n              {\n                rdfProperty: 'publicationYear',\n                label: 'publicationYearLabel',\n                id: 'workPublicationYear'\n              },\n              {\n                rdfProperty: 'nationality',\n                label: 'originCountryLabel',\n                esotericWhen: { hasWorkType: [ 'Other' ] },\n                multiple: 'true'\n              },\n              { rdfProperty: 'language', multiple: true },\n              {\n                rdfProperty: 'hasWorkType',\n                type: 'select-predefined-value',\n                hiddenUrlQueryValue: true,\n                id: 'workTypeInput',\n                widgetOptions: {\n                  queryParameter: 'hasWorkType',\n                  prefix: 'http://data.deichman.no/workType#',\n                  conditionalInputType: [\n                    {\n                      when: 'inWorkflow',\n                      replaceType: 'readonly-hidden-url-query-value'\n                    },\n                    {\n                      when: 'editingAuthority',\n                      replaceType: 'select-predefined-value'\n                    }\n                  ]\n                }\n              },\n              {\n                rdfProperty: 'literaryForm',\n                includeOnlyWhen: { hasWorkType: [ 'Other', 'Literature', 'Film', 'Game', 'Superwork' ] },\n                multiple: true\n              },\n              {\n                includeOnlyWhen: { hasWorkType: [ 'Other', 'Literature', 'Film', 'Superwork' ] },\n                rdfProperty: 'fictionNonfiction'\n              },\n              { rdfProperty: 'audience', multiple: true },\n              {\n                includeOnlyWhen: { hasWorkType: [ 'Other', 'Literature', 'Film', 'Superwork' ] },\n                rdfProperty: 'biography',\n                multiple: true\n              },\n              {\n                rdfProperty: 'hasContentAdaptation',\n                includeOnlyWhen: { hasWorkType: [ 'Other', 'Literature', 'Film', 'Game', 'Superwork' ] },\n                esotericWhen: { hasWorkType: [ 'Literature', 'Other', 'Film', 'Superwork' ] },\n                multiple: true\n              },\n              {\n                label: 'workRelationLabel',\n                multiple: true,\n                addAnotherLabel: 'addAnotherRelation',\n                esotericWhen: { hasWorkType: [ 'Music' ] },\n                reportFormat: {\n                  list: true\n                },\n                subInputs: {\n                  maintainInverseRelation: {\n                    inverseSubjectInput: 'relatedToWorkInput',\n                    onlyWhenAll: [\n                      {\n                        inputId: 'relationTypeInput',\n                        valueAsStringMatches: '^.*continuedIn$|^.*continuationOf$|^.*relatedWork'\n                      },\n                      {\n                        inputId: 'relatedToWorkInput',\n                        valueAsStringMatches: '^.*\\\/work\\\/.*$'\n                      } ],\n                    valueMapping: {\n                      relationTypeInput: {\n                        'http://data.deichman.no/relationType#continuedIn': 'http://data.deichman.no/relationType#continuationOf',\n                        'http://data.deichman.no/relationType#continuationOf': 'http://data.deichman.no/relationType#continuedIn'\n                      }\n                    }\n                  },\n                  rdfProperty: 'isRelatedTo',\n                  range: 'WorkRelation',\n                  inputs: [\n                    {\n                      label: 'workSeriesWorkLabel',\n                      rdfProperty: 'work',\n                      id: 'relatedToWorkInput',\n                      required: true,\n                      indexTypes: [ 'workUnstructured', 'workseries' ],\n                      type: 'searchable-with-result-in-side-panel',\n                      nameProperties: [ '@mainEntryName.', 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.' ],\n                      preselectFirstIndexType: true,\n                      widgetOptions: {\n                        enableEditResource: {\n                          formRefs: [\n                            {\n                              formId: 'create-work-form',\n                              targetType: 'workUnstructured'\n                            },\n                            {\n                              formId: 'create-workseries-form',\n                              targetType: 'workseries'\n                            }\n                          ],\n                          useAfterCreation: false\n                        },\n                        enableInPlaceEditing: true,\n                        explanations: {\n                          patterns: [\n                            { match: '^.*\\\/work\\\/.*$', explanation: 'workExplanation' },\n                            { match: '^.*\\\/workSeries\\\/.*$', explanation: 'workSeriesExplanation' }\n                          ]\n                        }\n                      }\n                    },\n                    {\n                      label: 'relationTypeLabel',\n                      rdfProperty: 'hasRelationType',\n                      required: true,\n                      id: 'relationTypeInput'\n                    },\n                    {\n                      rdfProperty: 'partNumber',\n                      id: 'partNumberInput',\n                      showOnlyWhen: {\n                        inputId: 'relationTypeInput',\n                        valueAsStringMatches: '^.*partOf$',\n                        initial: 'hide'\n                      }\n                    }\n                  ],\n                },\n                subjects: [ 'Work' ] // blank node can be attached to the the loaded resource of one of these types\n              },\n              {\n                label: 'workSeriesLabel',\n                multiple: true,\n                addAnotherLabel: 'addAnotherWorkSeries',\n                esotericWhen: { hasWorkType: [ 'Music' ] },\n                reportFormat: {\n                  list: true\n                },\n                subInputs: {\n                  rdfProperty: 'isPartOfWorkSeries',\n                  range: 'WorkSeriesPart',\n                  inputs: [\n                    {\n                      rdfProperty: 'workSeries',\n                      label: 'seriesLabel',\n                      id: 'partOfWorkSeriesInput',\n                      required: true,\n                      indexTypes: [ 'workseries' ],\n                      type: 'searchable-with-result-in-side-panel',\n                      nameProperties: [ 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.' ],\n                      widgetOptions: {\n                        enableEditResource: {\n                          formRefs: [\n                            {\n                              formId: 'create-workseries-form',\n                              targetType: 'workseries'\n                            }\n                          ],\n                          useAfterCreation: false\n                        },\n                        enableInPlaceEditing: true\n                      }\n                    },\n                    {\n                      label: 'part',\n                      rdfProperty: 'partNumber',\n                      id: 'workSeriesPartNumberInput'\n                    }\n                  ]\n                },\n                subjects: [ 'Work' ] // blank node can be attached to the the loaded resource of one of these types\n              },\n              {\n                rdfProperty: 'hasSummary',\n                esotericWhen: { hasWorkType: [ 'Music' ] },\n                type: 'input-string-large'\n              },\n              createdTimestamp(),\n              modifiedTimestamp()\n            ],\n            tools: [\n              {\n                template: 'inverse-one-to-many-relationship',\n                inverseRdfProperty: 'publicationOf',\n                showRelatedButtonLabel: 'showPublicationsAndSplitWork',\n                cloneParentButtonLabel: 'splitTheWork',\n                cloneParentDialogTitle: 'splitWork',\n                cloneParentButtonTooltip: 'makeWorkCopyForEachPubliation',\n                noInverseRelationsText: 'workHasNoPublications',\n                showRelatedTitle: 'workHasNumberOfPublications',\n                showFieldsOfRelated: [\n                  { field: 'mainTitle', width: '6-24', inputRef: 'workMainTitle' }, // there are 23/24th left for field layouts\n                  { field: 'subtitle', width: '5-24', inputRef: 'workSubtitle' },\n                  { field: 'partNumber', width: '2-24', inputRef: 'workPartNumber' },\n                  { field: 'partTitle', width: '5-24', inputRef: 'workPartTitle' },\n                  { field: 'recordId', width: '3-24' },\n                  { field: 'publicationYear', width: '2-24', inputRef: 'workPublicationYear' }\n                ],\n                cloneParentButtonExplanation: 'splitWorkLegend',\n                cloneParentDialogLegend: 'splitWorkDialogLegend'\n              }\n            ],\n            nextStep: {\n              buttonLabel: 'nextStepSubjects',\n              showOnlyWhenInputHasValue: 'mediaTypeInput'\n            },\n            deleteResource: {\n              buttonLabel: 'deleteWork',\n              preventDeleteIfReferred: true,\n              rdfType: 'Work',\n              dialogKeypath: 'deleteWorkDialog',\n              dialogId: 'delete-work-dialog',\n              dialogTemplateValues: {\n                title: 'workMainTitle',\n                creator: 'mainEntryPersonInput'\n              },\n              afterSuccess: {\n                restart: true\n              }\n            }\n          },\n          {\n            id: 'subjects',\n            rdfType: 'Work',\n            label: 'subjectsTabLabel',\n            reportLabel: 'maintGeneralSubjectLabelPlur',\n            inputs: [\n              {\n                includeOnlyWhen: { hasWorkType: [ 'Music', 'Film', 'Superwork' ] },\n                esotericWhen: { hasWorkType: [ 'Film' ] },\n                rdfProperty: 'hasCompositionType',\n                multiple: true,\n                addAnotherLabel: 'addAnotherCompositionType',\n                id: 'compositionTypeInput',\n                type: 'searchable-with-result-in-side-panel',\n                nameProperties: [ 'prefLabel' ],\n                indexTypes: [ 'compositiontype' ],\n                labelForCreateButton: 'createNewCompositionType',\n                widgetOptions: {\n                  enableEditResource: {\n                    formRefs: [\n                      {\n                        formId: 'create-compositiontype-form',\n                        targetType: 'compositiontype'\n                      }\n                    ]\n                  },\n                  enableInPlaceEditing: true\n                }\n              },\n              {\n                includeOnlyWhen: { hasWorkType: [ 'Music', 'Superwork' ] },\n                rdfProperty: 'inKey',\n                multiple: true\n              },\n              {\n                includeOnlyWhen: { hasWorkType: [ 'Music', 'Film', 'Superwork' ] },\n                esotericWhen: { hasWorkType: [ 'Film' ] },\n                label: 'instrumentationLabel',\n                multiple: true,\n                addAnotherLabel: 'addAnotherInstrument',\n                subInputs: {\n                  rdfProperty: 'hasInstrumentation',\n                  range: 'Instrumentation',\n                  inputs: [\n                    {\n                      rdfProperty: 'hasInstrument',\n                      id: 'instrumentInput',\n                      indexTypes: [ 'instrument' ],\n                      type: 'searchable-with-result-in-side-panel',\n                      nameProperties: [ 'prefLabel' ],\n                      required: true,\n                      widgetOptions: {\n                        enableEditResource: {\n                          formRefs: [\n                            {\n                              formId: 'create-instrument-form',\n                              targetType: 'instrument'\n                            }\n                          ]\n                        },\n                        enableInPlaceEditing: true\n                      }\n                    },\n                    {\n                      label: 'numberOfPerformersLabel',\n                      rdfProperty: 'hasNumberOfPerformers',\n                      widgetOptions: {\n                        short: true\n                      }\n                    }\n                  ]\n                },\n                subjects: [ 'Work' ] // blank node can be attached to the the loaded resource of one of these types\n              },\n              {\n                rdfProperty: 'subject',\n                id: 'subjectInput',\n                esotericWhen: { hasWorkType: [ 'Music' ] },\n                multiple: true,\n                addAnotherLabel: 'addAnotherSubject',\n                type: 'searchable-with-result-in-side-panel',\n                reportFormat: {\n                  separateLines: true\n                },\n                authority: true, // this indicates it is an authorized entity\n                nameProperties: [ {\n                  work: '@mainEntryName.' // @ means use property extraction helper function\n                }, 'prefLabel', 'mainTitle:', 'subtitle', 'partNumber.', 'partTitle',\n                  {\n                    person: 'name,',\n                    corporation: 'name.'\n                  },\n                  {\n                    person: '#ordinal,', // # means remove previous member's trailing comma\n                    event: '(ordinal).'\n                  },\n                  'subdivision',\n                  {\n                    'corporation|subject|work|place|genre|compositiontype|instrument': '(specification)',\n                    person: 'specification,'\n                  },\n                  'placePrefLabel,',\n                  'date',\n                  'birthYear-', 'deathYear,',\n                  'nationality.fragment.'\n                ],\n                previewProperties: [\n                  'subtitle', 'partNumber.', 'partTitle',\n                  {\n                    person: '#ordinal,',\n                    event: '(ordinal)'\n                  },\n                  'subdivision',\n                  {\n                    'corporation|subject|work|place|genre|compositiontype|instrument': '(specification)',\n                    person: 'specification,'\n                  },\n                  'placePrefLabel,',\n                  'date',\n                  'birthYear-', 'deathYear',\n                  'nationality.fragment.' ],\n                indexTypes: [ 'subject', 'person', 'corporation', 'workUnstructured', 'place', 'event' ],\n                widgetOptions: {\n                  selectIndexTypeLegend: 'selectSubjectType',\n                  enableEditResource: {\n                    formRefs: [\n                      {\n                        formId: 'create-subject-form',\n                        targetType: 'subject' // these are matched against index types, hence lower case\n                      },\n                      {\n                        formId: 'create-work-form',\n                        targetType: 'workUnstructured'\n                      },\n                      {\n                        formId: 'create-person-form',\n                        targetType: 'person'\n                      },\n                      {\n                        formId: 'create-corporation-form',\n                        targetType: 'corporation'\n                      },\n                      {\n                        formId: 'create-place-form',\n                        targetType: 'place'\n                      },\n                      {\n                        formId: 'create-event-form',\n                        targetType: 'event'\n                      }\n                    ]\n                  },\n                  enableInPlaceEditing: true,\n                  explanations: {\n                    patterns: [\n                      { match: '^.*\\\/subject\\\/.*$', explanation: 'generalSubjectExplanation' },\n                      { match: '^.*\\\/person\\\/.*$', explanation: 'personExplanation' },\n                      { match: '^.*\\\/work\\\/.*$', explanation: 'workExplanation' },\n                      { match: '^.*\\\/place\\\/.*$', explanation: 'placeExplanation' },\n                      { match: '^.*\\\/corporation\\\/.*$', explanation: 'corporationExplanation' },\n                      { match: '^.*\\\/event\\\/.*$', explanation: 'eventExplanation' }\n                    ]\n                  }\n                }\n              },\n              {\n                label: 'classificationLabel',\n                multiple: true,\n                addAnotherLabel: 'addAnotherClassification',\n                subjects: [ 'Work' ],\n                reportFormat: {\n                  list: true\n                },\n                subInputs: {\n                  rdfProperty: 'hasClassification',\n                  range: 'ClassificationEntry',\n                  inputs: [\n                    {\n                      rdfProperty: 'hasClassificationNumber',\n                      required: true\n                    },\n                    {\n                      label: 'classificationSourceLabel',\n                      rdfProperty: 'hasClassificationSource',\n                      required: true\n                    },\n                    {\n                      rdfProperty: 'isMainClassificationNumber'\n                    }\n                  ]\n                }\n              },\n              {\n                rdfProperty: 'genre',\n                id: 'genreInput',\n                esotericWhen: { hasWorkType: [ 'Music' ] },\n                multiple: true,\n                addAnotherLabel: 'addAnotherGenre',\n                type: 'searchable-with-result-in-side-panel',\n                authority: true,\n                nameProperties: [ 'prefLabel', '(specification)' ],\n                indexTypes: [ 'genre' ],\n                widgetOptions: {\n                  enableEditResource: {\n                    formRefs: [ {\n                      formId: 'create-genre-form',\n                      targetType: 'genre'\n                    } ]\n                  },\n                  enableInPlaceEditing: true\n                }\n              },\n              {\n                rdfProperty: 'hasTag',\n                id: 'tagInput',\n                multiple: 'true',\n                esotericWhen: { hasWorkType: [ 'Music' ] },\n                addAnotherLabel: 'addAnotherTag'\n              }\n            ],\n            nextStep: {\n              showOnlyWhenInputHasValue: 'mediaTypeInput',\n              buttonLabel: 'nextStepDescribeParts'\n            }\n          },\n          {\n            id: 'collection-of-works',\n            rdfType: 'Publication',\n            label: 'publicationPartsTabLabel',\n            reportLabel: 'partsLabel',\n            inputs: [\n              {\n                label: 'publicationPartsLabel',\n                multiple: true,\n                reportFormat: {\n                  topLevel: true // this input is promoted to act on behalf of its group in the report\n                },\n                subInputs: { // input is a group of sub inputs, which are connected to resource as other ends of a blank node\n                  rdfProperty: 'hasPublicationPart', // the rdf property of the resource\n                  range: 'PublicationPart', // this is the shorthand name of the type of the blank node\n                  accordionHeader: 'collection',\n                  objectSortOrder: [\n                    { predicate: 'partNumber', isNumber: true },\n                    { predicate: 'startsAtPage' },\n                    { predicate: 'mainTitle' }\n                  ],\n                  pagination: 10,\n                  inputs: [\n                    {\n                      label: 'agentLabel',\n                      rdfProperty: 'agent',\n                      indexTypes: [ 'person', 'corporation' ],\n                      nameProperties: personCorpNameProperties,\n                      previewProperties: [ 'birthYear-', 'deathYear', 'place', 'subdivision', 'nationality.fragment.' ],\n                      type: 'searchable-with-result-in-side-panel',\n                      id: 'publicationPartActorInput',\n                      widgetOptions: {\n                        enableEditResource: {\n                          formRefs: [\n                            {\n                              formId: 'create-person-form',\n                              targetType: 'person'\n                            },\n                            {\n                              formId: 'create-corporation-form',\n                              targetType: 'corporation'\n                            }\n                          ],\n                          useAfterCreation: false\n                        },\n                        enableInPlaceEditing: true,\n                        whenEmptyExternalSuggestionCopyValueFrom: {\n                          inputRef: 'mainEntryPersonInput'\n                        }\n                      }\n                    },\n                    {\n                      rdfProperty: 'role',\n                      widgetOptions: {\n                        whenEmptyExternalSuggestionCopyValueFrom: {\n                          inputRef: 'mainEntryRoleInput',\n                          warnWhenCopyingSubset: {\n                            message: 'Fyll inn verdi for Rolle også for deler som bare har forslag om Aktør fra før',\n                            allowByDefault: false\n                          }\n                        }\n                      }\n                    },\n                    {\n                      label: 'pubPartMainTitleLabel',\n                      rdfProperty: 'mainTitle',\n                      required: true,\n                      widgetOptions: {\n                        enableBulkEntry: {\n                          autoNumberInputRef: 'publicationPartNumberInput',\n                          rows: 10\n                        }\n                      }\n                    },\n                    {\n                      label: 'workLabel',\n                      id: 'publicationPartWorkInput',\n                      rdfProperty: 'publicationOf',\n                      type: 'searchable-with-result-in-side-panel',\n                      nameProperties: [ '@mainEntryName.', 'mainTitle:', 'subtitle.', 'partNumber.', 'partTitle.' ],\n                      indexTypes: [ 'workUnstructured' ], // this is the name of the elasticsearch index type from which authorities are searched within\n                      widgetOptions: {\n                        enableEditResource: {\n                          formRefs: [ {\n                            formId: 'create-work-form',\n                            targetType: 'workUnstructured' // these are matched against index types, hence lower case\n                          } ]\n                        },\n                        enableInPlaceEditing: true\n                      }\n                    },\n                    {\n                      label: 'part',\n                      rdfProperty: 'partNumber',\n                      id: 'publicationPartNumberInput'\n                    },\n                    // the following pair of properties is a range, which will be placed on the same line, with the label of the first one only.\n                    {\n                      includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'SheetMusic', 'ComicBook' ] },\n                      label: 'pageNumbers',\n                      id: 'startsAtPageInput',\n                      rdfProperty: 'startsAtPage',\n                      widgetOptions: {\n                        isRangeStart: true,\n                      }\n                    },\n                    {\n                      includeOnlyWhen: { hasMediaType: [ 'Other', 'Book', 'SheetMusic', 'ComicBook' ] },\n                      label: 'emptyLabel',\n                      rdfProperty: 'endsAtPage',\n                      widgetOptions: {\n                        isRangeEnd: true,\n                      }\n                    }\n                  ]\n                },\n                addAnotherLabel: 'addAnotherPart',\n                subjects: [ 'Publication' ]\n              }\n            ],\n            nextStep: {\n              buttonLabel: 'nextStepAdditionalEntries',\n              showOnlyWhenInputHasValue: 'mediaTypeInput'\n            }\n          },\n          {\n            // additional entries, such as translator, illustrator, composer etc\n            id: 'confirm-addedentry',\n            rdfType: 'Work',\n            label: 'additionalEntriesTabLabel',\n            inputs: [\n              {\n                label: 'additionalEntryLabel',\n                multiple: true, // can have many of these\n                addAnotherLabel: 'addAnotherAdditionalEntry',\n                reportFormat: {\n                  list: true\n                },\n                subInputs: { // input is a group of sub inputs, which are connected to resource as other ends of a blank node\n                  rdfProperty: 'contributor', // the rdf property of the resource\n                  range: 'Contribution', // this is the shorthand name of the type of the blank node\n                  inputs: [ // these are the actual sub inputs\n                    {\n                      required: true,\n                      label: 'agentLabel',\n                      rdfProperty: 'agent',\n                      id: 'contributionAgentInput',\n                      indexTypes: [ 'person', 'corporation' ],\n                      nameProperties: personCorpNameProperties,\n                      previewProperties: [ 'specification', 'birthYear-', 'deathYear', 'nationality.fragment.' ],\n                      type: 'searchable-with-result-in-side-panel',\n                      widgetOptions: {\n                        showSelectItem: false, // show and enable select work radio button\n                        enableEditResource: {\n                          formRefs: [\n                            {\n                              formId: 'create-person-form',\n                              targetType: 'person'\n                            },\n                            {\n                              formId: 'create-corporation-form',\n                              targetType: 'corporation'\n                            }\n                          ],\n                          useAfterCreation: false\n                        },\n                        enableInPlaceEditing: true\n                      }\n                    },\n                    {\n                      required: true,\n                      rdfProperty: 'role'\n                    }\n                  ]\n                },\n                subjects: [ 'Work', 'Publication' ], // blank node can be attached to the the loaded resource of one of these types\n                cssClassPrefix: 'additional-entries' // prefix of class names to identify a span surrounding this input or group of sub inputs.\n                // actual names are <prefix>-non-editable and <prefix>-editable to enable alternative presentation when not editable\n              }\n            ],\n            nextStep: {\n              buttonLabel: 'finishRegisterPublication',\n              showOnlyWhenInputHasValue: 'mediaTypeInput',\n              restart: true\n            }\n          }\n        ],\n        authorityMaintenance: [\n          {\n            inputs: [\n              maintenanceInputs('maintPersonLabelPlur', 'person'),\n              maintenanceInputs('maintCorporationLabelPlur', 'corporation'),\n              maintenanceInputs('maintGeneralSubjectLabelPlur', 'subject'),\n              maintenanceInputs('maintPlaceLabelPlur', 'place'),\n              maintenanceInputs('maintEventLabelPlur', 'event'),\n              maintenanceInputs('maintGenreLabelPlur', 'genre'),\n              maintenanceInputs('maintSerialLabelPlur', 'serial'),\n              maintenanceInputs('maintWorkSeriesLabelPlur', 'workseries'),\n              maintenanceInputs('maintInstrumentLabelPlur', 'instrument'),\n              maintenanceInputs('maintCompositionTypeLabelPlur', 'compositiontype'),\n              {\n                // this is an input type used to search for a main resource, e.g. Work. The rendered input field\n                // will not be tied to a particular subject and predicate\n                searchMainResource: {\n                  label: 'maintPublicationLabelPlur',\n                  indexType: 'publication'\n                },\n                widgetOptions: {\n                  maintenance: true,\n                  editWithTemplate: {\n                    template: 'workflow',\n                    descriptionKey: 'maintPub'\n                  }\n                }\n              },\n              {\n                searchMainResource: {\n                  label: 'maintWorkLabelPlur',\n                  indexType: 'workUnstructured'\n                },\n                widgetOptions: {\n                  maintenance: true,\n                  editWithTemplate: {\n                    template: 'workflow',\n                    descriptionKey: 'maintWork'\n                  },\n                  editSubItemWithTemplate: 'workflow'\n                }\n              }\n            ]\n          }\n        ],\n        search: {\n          person: {\n            type: 'person',\n            alphabeticalList: true,\n            exactMatchCompareField: 'name',\n            selectIndexLabel: 'personLabel',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            resultItemLabelProperties2: [ 'displayLine2' ],\n            itemHandler: 'personItemHandler',\n            scrollToMiddleOfResultSet: true\n          },\n          subject: {\n            type: 'subject',\n            alphabeticalList: true,\n            exactMatchCompareField: 'prefLabel',\n            selectIndexLabel: 'generalSubjectLabel',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            scrollToMiddleOfResultSet: true\n          },\n          work: {\n            type: 'work',\n            structuredQuery: true,\n            selectIndexLabel: 'workLabel',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            resultItemLabelProperties2: [ 'displayLine2' ],\n            linkFromUri: {\n              regExp: '^http:\\\/\\\/data\\\\.deichman\\\\.no\\\/work\\\/(w[a-f0-9]+)$',\n              replacement: 'http://sok.deichman.no/work/$1',\n              toolTip: 'Vis verket på publikumssiden'\n            },\n            itemHandler: 'workItemHandler'\n          },\n          workUnstructured: {\n            type: 'work',\n            selectIndexLabel: 'workLabel',\n            legend: 'searchWorkLegend',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            resultItemLabelProperties2: [ 'displayLine2' ],\n            linkFromUri: {\n              regExp: '^http:\\\/\\\/data\\\\.deichman\\\\.no\\\/work\\\/(w[a-f0-9]+)$',\n              replacement: 'http://sok.deichman.no/work/$1',\n              toolTip: 'Vis verket på publikumssiden'\n            },\n            itemHandler: 'workItemHandler'\n          },\n          genre: {\n            type: 'genre',\n            selectIndexLabel: 'genreLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'prefLabel',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            scrollToMiddleOfResultSet: true\n          },\n          corporation: {\n            type: 'corporation',\n            selectIndexLabel: 'corporationLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'name',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            scrollToMiddleOfResultSet: true\n          },\n          place: {\n            type: 'place',\n            selectIndexLabel: 'placeLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'prefLabel',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            scrollToMiddleOfResultSet: true\n          },\n          event: {\n            type: 'event',\n            selectIndexLabel: 'eventLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'prefLabel',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            scrollToMiddleOfResultSet: true\n          },\n          serial: {\n            type: 'serial',\n            selectIndexLabel: 'serialLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'serialMainTitle',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            scrollToMiddleOfResultSet: true\n          },\n          publication: {\n            type: 'publication',\n            selectIndexLabel: 'publication',\n            legend: 'searchPublicationLegend',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            resultItemLabelProperties2: [ 'displayLine2' ],\n            itemHandler: 'publicationItemHandler',\n            publicationLink: true\n          },\n          instrument: {\n            type: 'instrument',\n            selectIndexLabel: 'instrumentLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'prefLabel',\n            resultItemLabelProperties: [ 'prefLabel', 'inParens:specification' ],\n            scrollToMiddleOfResultSet: true\n          },\n          compositiontype: {\n            type: 'compositionType',\n            selectIndexLabel: 'compositionTypeLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'prefLabel',\n            resultItemLabelProperties: [ 'prefLabel', 'inParens:specification' ],\n            scrollToMiddleOfResultSet: true\n          },\n          workseries: {\n            type: 'workSeries',\n            selectIndexLabel: 'workSeriesLabel',\n            alphabeticalList: true,\n            exactMatchCompareField: 'workSeriesMainTitle',\n            resultItemLabelProperties: [ 'displayLine1' ],\n            //resultItemDetailsLabelProperties: [ 'partNumber.', 'partTitle' ],\n            scrollToMiddleOfResultSet: true\n          }\n        },\n        relationTargetLabels: {\n          Work: [ 'mainTitle', ':subtitle', 'partNumber.', 'partTitle', 'publicationYear,' ],\n          Publication: [ 'mainTitle', ':subtitle', 'partNumber.', 'partTitle', 'publicationYear,' ],\n          PublicationPart: [ 'mainTitle' ]\n        },\n        typeMap: {\n          // this map contains a map of all known independent resource types (i.e. not blank node types) as they appear in\n          // resource urls and their canonical names\n          work: 'Work',\n          person: 'Person',\n          publication: 'Publication',\n          genre: 'Genre',\n          subject: 'Subject',\n          place: 'Place',\n          event: 'Event',\n          serial: 'Serial',\n          corporation: 'Corporation',\n          instrument: 'Instrument',\n          compositionType: 'CompositionType',\n          workSeries: 'WorkSeries'\n        },\n        rdfTypeToIndexType: {\n          'Work': 'work'\n        },\n        resourceTypeAliases: {\n          'compositiontype': 'compositionType',\n          'workseries': 'workSeries'\n        },\n        prefillValuesFromExternalSources: [\n          { resourceType: 'Work', demandTopBanana: true },\n          { resourceType: 'Publication' },\n          {\n            resourceType: 'Person',\n            wrappedIn: 'Contribution',\n            predicate: 'agent',\n            enableEditResource: true\n          },\n          {\n            resourceType: 'Person',\n            wrappedIn: 'PublicationPart',\n            predicate: 'agent',\n            enableEditResource: true\n          },\n          {\n            resourceType: 'Serial',\n            wrappedIn: 'SerialIssue',\n            predicate: 'serial',\n            enableEditResource: true\n          },\n          {\n            resourceType: 'Person',\n            wrappedIn: '/Work',\n            predicate: 'subject',\n            enableEditResource: true\n          },\n          {\n            resourceType: 'Place',\n            wrappedIn: '/Work',\n            predicate: 'subject',\n            enableEditResource: true\n          },\n          {\n            resourceType: 'Event',\n            wrappedIn: '/Work',\n            predicate: 'subject',\n            enableEditResource: true\n          },\n          {\n            resourceType: 'Work',\n            wrappedIn: '/Work',\n            predicate: 'subject',\n            enableEditResource: true\n          },\n          {\n            resourceType: 'Subject',\n            wrappedIn: '/Work',\n            predicate: 'subject',\n            enableEditResource: true\n          },\n          {\n            resourceType: '/Work',\n            wrappedIn: 'PublicationPart',\n            predicate: 'publicationOf',\n            enableEditResource: true\n          }\n        ],\n        translations: {\n          Work: {\n            indet: 'verk',\n            det: 'verket',\n          },\n          Publication: {\n            indet: 'utgivelse',\n            det: 'utgivelsen'\n          },\n          PublicationPart: {\n            indet: 'utgivelsesdel',\n            det: 'utgivelsendelen'\n          },\n          Person: {\n            indet: 'person',\n            det: 'personen'\n          },\n          Corporation: {\n            indet: 'korporasjon',\n            det: 'korporasjonen'\n          },\n          Subject: {\n            indet: 'emne',\n            det: 'emnet'\n          },\n          Place: {\n            indet: 'sted',\n            det: 'stedet'\n          },\n          Serial: {\n            indet: 'forlagsserie',\n            det: 'forlagsserien'\n          },\n          WorkSeries: {\n            indet: 'verksserie',\n            det: 'verksserien'\n          },\n          Genre: {\n            indet: 'sjanger',\n            det: 'sjangeren'\n          },\n          Event: {\n            indet: 'hendelse',\n            det: 'hendelsen'\n          }\n        },\n        abbreviations: {\n          'Del nummer': 'Delnr.',\n          'Utgivelsesår': 'Utg.år'\n        },\n        inverseLabels: {\n          'Emne': 'Som emne',\n          'Utgivelse av': 'Har utgivelse',\n          'Har delutgivelse': 'Utgitt som del',\n          'I serie': 'I samme serie',\n          'Del av verksserie': 'Andre verk i samme serie',\n          'Sjanger': 'Verk i samme sjanger',\n          'Utgivelsessted': 'Utgitt samme sted',\n          'Subject': 'As subject',\n          'Publication of': 'Published',\n          'Has publication part': 'Published as part',\n          'In serial': 'In the same series',\n          'Part of work series': 'Other works in same series',\n          'Genre': 'I this genre',\n          'Place of publication': 'Published at this place'\n        },\n        headlines: {\n          Work: [\n            {\n              input: 'mainEntryPersonInput',\n              postfix: '. '\n            },\n            {\n              input: 'workMainTitle',\n              joinBy: {\n                input: 'workSubtitle',\n                separator: ' : '\n              },\n              postfix: '. '\n            },\n            {\n              input: 'workPartNumber',\n              postfix: '. '\n            },\n            {\n              input: 'workPartTitle',\n              postfix: '. '\n            },\n          ],\n          Publication: [\n            {\n              input: 'mainEntryPersonInput',\n              postfix: '. '\n            },\n            {\n              input: 'publicationMainTitle',\n              joinBy: {\n                input: 'publicationSubtitle',\n                separator: ' : '\n              },\n              postfix: '. '\n            },\n            {\n              input: [ 'publicationPartNumber' ],\n              postfix: '. '\n            },\n            {\n              input: [ 'publicationPartTitle' ],\n              postfix: '. '\n            },\n            {\n              input: [ 'publicationYearInput' ],\n              postfix: ' '\n            },\n            {\n              input: [ 'recordIdInput' ],\n              prefix: '(',\n              postfix: ') '\n            }\n          ]\n        }\n      }\n    response.json(config)\n  })\n}\n",
                "subject": "Add config for worktype superwork",
                "message": "Add config for worktype superwork",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "digibib/ls.ext,digibib/ls.ext,digibib/ls.ext,digibib/ls.ext"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10295,
            "row": {
                "commit": "d779e4cda3b7b09101bd0daccc23ad614982787f",
                "old_file": "src/Date.js",
                "new_file": "src/Date.js",
                "old_contents": "const React = require('react');\nconst moment = require('moment');\n\nconst dateShape = React.PropTypes.oneOfType([\n    React.PropTypes.number,\n    React.PropTypes.string,\n    React.PropTypes.instanceOf(Date)\n]);\n\nconst DateSpan =  React.createClass({\n    propTypes: {\n        // Date to display\n        date:            dateShape.isRequired,\n        // Interval to refresh the display\n        refresh: React.PropTypes.number,\n        // Format for output\n        format:          React.PropTypes.string,\n        // Is the date in UTC or Local\n        utc:             React.PropTypes.bool\n    },\n\n    contextTypes: {\n        now: dateShape\n    },\n\n    getDefaultProps: function() {\n        return {\n            format:   '',\n            interval: 10*1000,\n            utc:      true\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            now: 0\n        };\n    },\n\n    tick: function() {\n        this.setState({\n            now: Date.now()\n        });\n    },\n\n    componentDidMount: function() {\n        let { refresh, format } = this.props;\n\n        if (format) {\n            return;\n        }\n\n        this.interval = setInterval(this.tick, refresh);\n    },\n\n    componentWillUnmount: function() {\n        if (!this.interval) {\n            return;\n        }\n\n        clearInterval(this.interval);\n    },\n\n    render: function() {\n        let { date, format, utc } = this.props;\n        let now = this.state.now || this.context.now;\n        let displayDate;\n\n        // Parse the date\n        if (utc) {\n            date = moment.utc(date);\n        } else {\n            date = moment(date);\n        }\n\n        // Apply formating if provided\n        if (format) {\n            displayDate = date.format(format);\n        } else {\n            displayDate = date.from(now);\n        }\n\n        return <span>{displayDate}</span>;\n    }\n});\n\nconst DateContext =  React.createClass({\n    propTypes: {\n        children: React.PropTypes.node,\n        now:      dateShape\n    },\n\n    childContextTypes: {\n        now: dateShape\n    },\n\n    getChildContext: function() {\n        return {\n            now: this.props.now\n        };\n    },\n\n    render: function() {\n        return (React.Children.only(this.props.children));\n    }\n});\n\nmodule.exports = DateSpan;\nmodule.exports.shape = dateShape;\nmodule.exports.Context = DateContext;\n",
                "new_contents": "const React = require('react');\nconst moment = require('moment');\n\nconst dateShape = React.PropTypes.oneOfType([\n    React.PropTypes.number,\n    React.PropTypes.string,\n    React.PropTypes.instanceOf(Date)\n]);\n\nconst DateSpan =  React.createClass({\n    propTypes: {\n        // Date to display\n        date:            dateShape.isRequired,\n        // Interval to refresh the display\n        refresh: React.PropTypes.number,\n        // Format for output\n        format:          React.PropTypes.string,\n        // Is the date in UTC or Local\n        utc:             React.PropTypes.bool\n    },\n\n    contextTypes: {\n        now: dateShape\n    },\n\n    getDefaultProps: function() {\n        return {\n            format:   '',\n            interval: 10*1000,\n            utc:      true\n        };\n    },\n\n    getInitialState: function() {\n        return {\n            now: 0\n        };\n    },\n\n    tick: function() {\n        this.setState({\n            now: Date.now()\n        });\n    },\n\n    componentDidMount: function() {\n        let { refresh, format } = this.props;\n\n        if (format) {\n            return;\n        }\n\n        this.interval = setInterval(this.tick, refresh);\n    },\n\n    componentWillUnmount: function() {\n        if (!this.interval) {\n            return;\n        }\n\n        clearInterval(this.interval);\n    },\n\n    render: function() {\n        let { date, format, utc } = this.props;\n        let now = this.state.now || this.context.now;\n        let displayDate;\n\n        // Parse the date\n        if (utc) {\n            date = moment.utc(date);\n        } else {\n            date = moment(date);\n        }\n\n        // Apply formating if provided\n        if (format) {\n            displayDate = date.local().format(format);\n        } else {\n            displayDate = date.from(now);\n        }\n\n        return <span>{displayDate}</span>;\n    }\n});\n\nconst DateContext =  React.createClass({\n    propTypes: {\n        children: React.PropTypes.node,\n        now:      dateShape\n    },\n\n    childContextTypes: {\n        now: dateShape\n    },\n\n    getChildContext: function() {\n        return {\n            now: this.props.now\n        };\n    },\n\n    render: function() {\n        return (React.Children.only(this.props.children));\n    }\n});\n\nmodule.exports = DateSpan;\nmodule.exports.shape = dateShape;\nmodule.exports.Context = DateContext;\n",
                "subject": "Use local date when using format for display",
                "message": "Use local date when using format for display\n",
                "lang": "JavaScript",
                "license": "apache-2.0",
                "repos": "GitbookIO/styleguide,GitbookIO/styleguide,rlugojr/styleguide,rlugojr/styleguide"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10296,
            "row": {
                "commit": "3e9d4938491d0c38700078360c593a81c779ce76",
                "old_file": "src/type/introspection.js",
                "new_file": "src/type/introspection.js",
                "old_contents": "/* @flow */\n/**\n *  Copyright (c) 2015, Facebook, Inc.\n *  All rights reserved.\n *\n *  This source code is licensed under the BSD-style license found in the\n *  LICENSE file in the root directory of this source tree. An additional grant\n *  of patent rights can be found in the PATENTS file in the same directory.\n */\n\nimport isNullish from '../jsutils/isNullish';\nimport { astFromValue } from '../utilities/astFromValue';\nimport { print } from '../language/printer';\nimport {\n  GraphQLScalarType,\n  GraphQLObjectType,\n  GraphQLInterfaceType,\n  GraphQLUnionType,\n  GraphQLEnumType,\n  GraphQLInputObjectType,\n  GraphQLList,\n  GraphQLNonNull,\n} from './definition';\nimport { GraphQLString, GraphQLBoolean } from './scalars';\nimport { DirectiveLocation } from './directives';\nimport type { GraphQLFieldDefinition } from './definition';\n\n\nexport const __Schema = new GraphQLObjectType({\n  name: '__Schema',\n  description:\n    'A GraphQL Schema defines the capabilities of a GraphQL server. It ' +\n    'exposes all available types and directives on the server, as well as ' +\n    'the entry points for query, mutation, and subscription operations.',\n  fields: () => ({\n    types: {\n      description: 'A list of all types supported by this server.',\n      type: new GraphQLNonNull(new GraphQLList(new GraphQLNonNull(__Type))),\n      resolve(schema) {\n        const typeMap = schema.getTypeMap();\n        return Object.keys(typeMap).map(key => typeMap[key]);\n      }\n    },\n    queryType: {\n      description: 'The type that query operations will be rooted at.',\n      type: new GraphQLNonNull(__Type),\n      resolve: schema => schema.getQueryType()\n    },\n    mutationType: {\n      description: 'If this server supports mutation, the type that ' +\n                   'mutation operations will be rooted at.',\n      type: __Type,\n      resolve: schema => schema.getMutationType()\n    },\n    subscriptionType: {\n      description: 'If this server support subscription, the type that ' +\n                   'subscription operations will be rooted at.',\n      type: __Type,\n      resolve: schema => schema.getSubscriptionType()\n    },\n    directives: {\n      description: 'A list of all directives supported by this server.',\n      type:\n        new GraphQLNonNull(new GraphQLList(new GraphQLNonNull(__Directive))),\n      resolve: schema => schema.getDirectives(),\n    }\n  })\n});\n\nexport const __Directive = new GraphQLObjectType({\n  name: '__Directive',\n  description:\n    'A Directive provides a way to describe alternate runtime execution and ' +\n    'type validation behavior in a GraphQL document.' +\n    '\\n\\nIn some cases, you need to provide options to alter GraphQL\\'s ' +\n    'execution behavior in ways field arguments will not suffice, such as ' +\n    'conditionally including or skipping a field. Directives provide this by ' +\n    'describing additional information to the executor.',\n  fields: () => ({\n    name: { type: new GraphQLNonNull(GraphQLString) },\n    description: { type: GraphQLString },\n    locations: {\n      type: new GraphQLNonNull(new GraphQLList(new GraphQLNonNull(\n        __DirectiveLocation\n      )))\n    },\n    args: {\n      type:\n        new GraphQLNonNull(new GraphQLList(new GraphQLNonNull(__InputValue))),\n      resolve: directive => directive.args || []\n    },\n    // NOTE: the following three fields are deprecated and are no longer part\n    // of the GraphQL specification.\n    onOperation: {\n      deprecationReason: 'Use `locations`.',\n      type: new GraphQLNonNull(GraphQLBoolean),\n      resolve: d =>\n        d.locations.indexOf(DirectiveLocation.QUERY) !== -1 ||\n        d.locations.indexOf(DirectiveLocation.MUTATION) !== -1 ||\n        d.locations.indexOf(DirectiveLocation.SUBSCRIPTION) !== -1\n    },\n    onFragment: {\n      deprecationReason: 'Use `locations`.',\n      type: new GraphQLNonNull(GraphQLBoolean),\n      resolve: d =>\n        d.locations.indexOf(DirectiveLocation.FRAGMENT_SPREAD) !== -1 ||\n        d.locations.indexOf(DirectiveLocation.INLINE_FRAGMENT) !== -1 ||\n        d.locations.indexOf(DirectiveLocation.FRAGMENT_DEFINITION) !== -1\n    },\n    onField: {\n      deprecationReason: 'Use `locations`.',\n      type: new GraphQLNonNull(GraphQLBoolean),\n      resolve: d => d.locations.indexOf(DirectiveLocation.FIELD) !== -1\n    },\n  }),\n});\n\nexport const __DirectiveLocation = new GraphQLEnumType({\n  name: '__DirectiveLocation',\n  description:\n    'A Directive can be adjacent to many parts of the GraphQL language, a ' +\n    '__DirectiveLocation describes one such possible adjacencies.',\n  values: {\n    QUERY: {\n      value: DirectiveLocation.QUERY,\n      description: 'Location adjacent to a query operation.'\n    },\n    MUTATION: {\n      value: DirectiveLocation.MUTATION,\n      description: 'Location adjacent to a mutation operation.'\n    },\n    SUBSCRIPTION: {\n      value: DirectiveLocation.SUBSCRIPTION,\n      description: 'Location adjacent to a subscription operation.'\n    },\n    FIELD: {\n      value: DirectiveLocation.FIELD,\n      description: 'Location adjacent to a field.'\n    },\n    FRAGMENT_DEFINITION: {\n      value: DirectiveLocation.FRAGMENT_DEFINITION,\n      description: 'Location adjacent to a fragment definition.'\n    },\n    FRAGMENT_SPREAD: {\n      value: DirectiveLocation.FRAGMENT_SPREAD,\n      description: 'Location adjacent to a fragment spread.'\n    },\n    INLINE_FRAGMENT: {\n      value: DirectiveLocation.INLINE_FRAGMENT,\n      description: 'Location adjacent to an inline fragment.'\n    },\n    SCHEMA: {\n      value: DirectiveLocation.SCHEMA,\n      description: 'Location adjacent to a schema definition.'\n    },\n    SCALAR: {\n      value: DirectiveLocation.SCALAR,\n      description: 'Location adjacent to a scalar definition.'\n    },\n    OBJECT: {\n      value: DirectiveLocation.OBJECT,\n      description: 'Location adjacent to an object type definition.'\n    },\n    FIELD_DEFINITION: {\n      value: DirectiveLocation.FIELD_DEFINITION,\n      description: 'Location adjacent to a field definition.'\n    },\n    ARGUMENT_DEFINITION: {\n      value: DirectiveLocation.ARGUMENT_DEFINITION,\n      description: 'Location adjacent to an argument definition.'\n    },\n    INTERFACE: {\n      value: DirectiveLocation.INTERFACE,\n      description: 'Location adjacent to an interface definition.'\n    },\n    UNION: {\n      value: DirectiveLocation.UNION,\n      description: 'Location adjacent to a union definition.'\n    },\n    ENUM: {\n      value: DirectiveLocation.ENUM,\n      description: 'Location adjacent to an enum definition.'\n    },\n    ENUM_VALUE: {\n      value: DirectiveLocation.ENUM_VALUE,\n      description: 'Location adjacent to an enum value definition.'\n    },\n    INPUT_OBJECT: {\n      value: DirectiveLocation.INPUT_OBJECT,\n      description: 'Location adjacent to an input object type definition.'\n    },\n    INPUT_FIELD_DEFINITION: {\n      value: DirectiveLocation.INPUT_FIELD_DEFINITION,\n      description: 'Location adjacent to an input object field definition.'\n    },\n  }\n});\n\nexport const __Type = new GraphQLObjectType({\n  name: '__Type',\n  description:\n    'The fundamental unit of any GraphQL Schema is the type. There are ' +\n    'many kinds of types in GraphQL as represented by the `__TypeKind` enum.' +\n    '\\n\\nDepending on the kind of a type, certain fields describe ' +\n    'information about that type. Scalar types provide no information ' +\n    'beyond a name and description, while Enum types provide their values. ' +\n    'Object and Interface types provide the fields they describe. Abstract ' +\n    'types, Union and Interface, provide the Object types possible ' +\n    'at runtime. List and NonNull types compose other types.',\n  fields: () => ({\n    kind: {\n      type: new GraphQLNonNull(__TypeKind),\n      resolve(type) {\n        if (type instanceof GraphQLScalarType) {\n          return TypeKind.SCALAR;\n        } else if (type instanceof GraphQLObjectType) {\n          return TypeKind.OBJECT;\n        } else if (type instanceof GraphQLInterfaceType) {\n          return TypeKind.INTERFACE;\n        } else if (type instanceof GraphQLUnionType) {\n          return TypeKind.UNION;\n        } else if (type instanceof GraphQLEnumType) {\n          return TypeKind.ENUM;\n        } else if (type instanceof GraphQLInputObjectType) {\n          return TypeKind.INPUT_OBJECT;\n        } else if (type instanceof GraphQLList) {\n          return TypeKind.LIST;\n        } else if (type instanceof GraphQLNonNull) {\n          return TypeKind.NON_NULL;\n        }\n        throw new Error('Unknown kind of type: ' + type);\n      }\n    },\n    name: { type: GraphQLString },\n    description: { type: GraphQLString },\n    fields: {\n      type: new GraphQLList(new GraphQLNonNull(__Field)),\n      args: {\n        includeDeprecated: { type: GraphQLBoolean, defaultValue: false }\n      },\n      resolve(type, { includeDeprecated }) {\n        if (type instanceof GraphQLObjectType ||\n            type instanceof GraphQLInterfaceType) {\n          const fieldMap = type.getFields();\n          let fields =\n            Object.keys(fieldMap).map(fieldName => fieldMap[fieldName]);\n          if (!includeDeprecated) {\n            fields = fields.filter(field => !field.deprecationReason);\n          }\n          return fields;\n        }\n        return null;\n      }\n    },\n    interfaces: {\n      type: new GraphQLList(new GraphQLNonNull(__Type)),\n      resolve(type) {\n        if (type instanceof GraphQLObjectType) {\n          return type.getInterfaces();\n        }\n      }\n    },\n    possibleTypes: {\n      type: new GraphQLList(new GraphQLNonNull(__Type)),\n      resolve(type, args, context, { schema }) {\n        if (type instanceof GraphQLInterfaceType ||\n            type instanceof GraphQLUnionType) {\n          return schema.getPossibleTypes(type);\n        }\n      }\n    },\n    enumValues: {\n      type: new GraphQLList(new GraphQLNonNull(__EnumValue)),\n      args: {\n        includeDeprecated: { type: GraphQLBoolean, defaultValue: false }\n      },\n      resolve(type, { includeDeprecated }) {\n        if (type instanceof GraphQLEnumType) {\n          let values = type.getValues();\n          if (!includeDeprecated) {\n            values = values.filter(value => !value.deprecationReason);\n          }\n          return values;\n        }\n      }\n    },\n    inputFields: {\n      type: new GraphQLList(new GraphQLNonNull(__InputValue)),\n      resolve(type) {\n        if (type instanceof GraphQLInputObjectType) {\n          const fieldMap = type.getFields();\n          return Object.keys(fieldMap).map(fieldName => fieldMap[fieldName]);\n        }\n      }\n    },\n    ofType: { type: __Type }\n  })\n});\n\nexport const __Field = new GraphQLObjectType({\n  name: '__Field',\n  description:\n    'Object and Interface types are described by a list of Fields, each of ' +\n    'which has a name, potentially a list of arguments, and a return type.',\n  fields: () => ({\n    name: { type: new GraphQLNonNull(GraphQLString) },\n    description: { type: GraphQLString },\n    args: {\n      type:\n        new GraphQLNonNull(new GraphQLList(new GraphQLNonNull(__InputValue))),\n      resolve: field => field.args || []\n    },\n    type: { type: new GraphQLNonNull(__Type) },\n    isDeprecated: {\n      type: new GraphQLNonNull(GraphQLBoolean),\n      resolve: field => field.isDeprecated,\n    },\n    deprecationReason: {\n      type: GraphQLString,\n    }\n  })\n});\n\nexport const __InputValue = new GraphQLObjectType({\n  name: '__InputValue',\n  description:\n    'Arguments provided to Fields or Directives and the input fields of an ' +\n    'InputObject are represented as Input Values which describe their type ' +\n    'and optionally a default value.',\n  fields: () => ({\n    name: { type: new GraphQLNonNull(GraphQLString) },\n    description: { type: GraphQLString },\n    type: { type: new GraphQLNonNull(__Type) },\n    defaultValue: {\n      type: GraphQLString,\n      description:\n        'A GraphQL-formatted string representing the default value for this ' +\n        'input value.',\n      resolve: inputVal => isNullish(inputVal.defaultValue) ?\n        null :\n        print(astFromValue(inputVal.defaultValue, inputVal.type))\n    }\n  })\n});\n\nexport const __EnumValue = new GraphQLObjectType({\n  name: '__EnumValue',\n  description:\n    'One possible value for a given Enum. Enum values are unique values, not ' +\n    'a placeholder for a string or numeric value. However an Enum value is ' +\n    'returned in a JSON response as a string.',\n  fields: () => ({\n    name: { type: new GraphQLNonNull(GraphQLString) },\n    description: { type: GraphQLString },\n    isDeprecated: {\n      type: new GraphQLNonNull(GraphQLBoolean),\n      resolve: enumValue => enumValue.isDeprecated,\n    },\n    deprecationReason: {\n      type: GraphQLString,\n    }\n  })\n});\n\nexport const TypeKind = {\n  SCALAR: 'SCALAR',\n  OBJECT: 'OBJECT',\n  INTERFACE: 'INTERFACE',\n  UNION: 'UNION',\n  ENUM: 'ENUM',\n  INPUT_OBJECT: 'INPUT_OBJECT',\n  LIST: 'LIST',\n  NON_NULL: 'NON_NULL',\n};\n\nexport const __TypeKind = new GraphQLEnumType({\n  name: '__TypeKind',\n  description: 'An enum describing what kind of type a given `__Type` is.',\n  values: {\n    SCALAR: {\n      value: TypeKind.SCALAR,\n      description: 'Indicates this type is a scalar.'\n    },\n    OBJECT: {\n      value: TypeKind.OBJECT,\n      description: 'Indicates this type is an object. ' +\n                   '`fields` and `interfaces` are valid fields.'\n    },\n    INTERFACE: {\n      value: TypeKind.INTERFACE,\n      description: 'Indicates this type is an interface. ' +\n                   '`fields` and `possibleTypes` are valid fields.'\n    },\n    UNION: {\n      value: TypeKind.UNION,\n      description: 'Indicates this type is a union. ' +\n                   '`possibleTypes` is a valid field.'\n    },\n    ENUM: {\n      value: TypeKind.ENUM,\n      description: 'Indicates this type is an enum. ' +\n                   '`enumValues` is a valid field.'\n    },\n    INPUT_OBJECT: {\n      value: TypeKind.INPUT_OBJECT,\n      description: 'Indicates this type is an input object. ' +\n                   '`inputFields` is a valid field.'\n    },\n    LIST: {\n      value: TypeKind.LIST,\n      description: 'Indicates this type is a list. ' +\n                   '`ofType` is a valid field.'\n    },\n    NON_NULL: {\n      value: TypeKind.NON_NULL,\n      description: 'Indicates this type is a non-null. ' +\n                   '`ofType` is a valid field.'\n    },\n  }\n});\n\n/**\n * Note that these are GraphQLFieldDefinition and not GraphQLFieldConfig,\n * so the format for args is different.\n */\n\nexport const SchemaMetaFieldDef: GraphQLFieldDefinition = {\n  name: '__schema',\n  type: new GraphQLNonNull(__Schema),\n  description: 'Access the current type schema of this server.',\n  args: [],\n  resolve: (source, args, context, { schema }) => schema\n};\n\nexport const TypeMetaFieldDef: GraphQLFieldDefinition = {\n  name: '__type',\n  type: __Type,\n  description: 'Request the type information of a single type.',\n  args: [\n    { name: 'name', type: new GraphQLNonNull(GraphQLString) }\n  ],\n  resolve: (source, { name }: { name: string }, context, { schema }) =>\n    schema.getType(name)\n};\n\nexport const TypeNameMetaFieldDef: GraphQLFieldDefinition = {\n  name: '__typename',\n  type: new GraphQLNonNull(GraphQLString),\n  description: 'The name of the current Object type at runtime.',\n  args: [],\n  resolve: (source, args, context, { parentType }) => parentType.name\n};\n",
                "new_contents": "/* @flow */\n/**\n *  Copyright (c) 2015, Facebook, Inc.\n *  All rights reserved.\n *\n *  This source code is licensed under the BSD-style license found in the\n *  LICENSE file in the root directory of this source tree. An additional grant\n *  of patent rights can be found in the PATENTS file in the same directory.\n */\n\nimport isNullish from '../jsutils/isNullish';\nimport { astFromValue } from '../utilities/astFromValue';\nimport { print } from '../language/printer';\nimport {\n  GraphQLScalarType,\n  GraphQLObjectType,\n  GraphQLInterfaceType,\n  GraphQLUnionType,\n  GraphQLEnumType,\n  GraphQLInputObjectType,\n  GraphQLList,\n  GraphQLNonNull,\n} from './definition';\nimport { GraphQLString, GraphQLBoolean } from './scalars';\nimport { DirectiveLocation } from './directives';\nimport type { GraphQLFieldDefinition } from './definition';\n\n\nexport const __Schema = new GraphQLObjectType({\n  name: '__Schema',\n  description:\n    'A GraphQL Schema defines the capabilities of a GraphQL server. It ' +\n    'exposes all available types and directives on the server, as well as ' +\n    'the entry points for query, mutation, and subscription operations.',\n  fields: () => ({\n    types: {\n      description: 'A list of all types supported by this server.',\n      type: new GraphQLNonNull(new GraphQLList(new GraphQLNonNull(__Type))),\n      resolve(schema) {\n        const typeMap = schema.getTypeMap();\n        return Object.keys(typeMap).map(key => typeMap[key]);\n      }\n    },\n    queryType: {\n      description: 'The type that query operations will be rooted at.',\n      type: new GraphQLNonNull(__Type),\n      resolve: schema => schema.getQueryType()\n    },\n    mutationType: {\n      description: 'If this server supports mutation, the type that ' +\n                   'mutation operations will be rooted at.',\n      type: __Type,\n      resolve: schema => schema.getMutationType()\n    },\n    subscriptionType: {\n      description: 'If this server support subscription, the type that ' +\n                   'subscription operations will be rooted at.',\n      type: __Type,\n      resolve: schema => schema.getSubscriptionType()\n    },\n    directives: {\n      description: 'A list of all directives supported by this server.',\n      type:\n        new GraphQLNonNull(new GraphQLList(new GraphQLNonNull(__Directive))),\n      resolve: schema => schema.getDirectives(),\n    }\n  })\n});\n\nexport const __Directive = new GraphQLObjectType({\n  name: '__Directive',\n  description:\n    'A Directive provides a way to describe alternate runtime execution and ' +\n    'type validation behavior in a GraphQL document.' +\n    '\\n\\nIn some cases, you need to provide options to alter GraphQL\\'s ' +\n    'execution behavior in ways field arguments will not suffice, such as ' +\n    'conditionally including or skipping a field. Directives provide this by ' +\n    'describing additional information to the executor.',\n  fields: () => ({\n    name: { type: new GraphQLNonNull(GraphQLString) },\n    description: { type: GraphQLString },\n    locations: {\n      type: new GraphQLNonNull(new GraphQLList(new GraphQLNonNull(\n        __DirectiveLocation\n      )))\n    },\n    args: {\n      type:\n        new GraphQLNonNull(new GraphQLList(new GraphQLNonNull(__InputValue))),\n      resolve: directive => directive.args || []\n    },\n    // NOTE: the following three fields are deprecated and are no longer part\n    // of the GraphQL specification.\n    onOperation: {\n      deprecationReason: 'Use `locations`.',\n      type: new GraphQLNonNull(GraphQLBoolean),\n      resolve: d =>\n        d.locations.indexOf(DirectiveLocation.QUERY) !== -1 ||\n        d.locations.indexOf(DirectiveLocation.MUTATION) !== -1 ||\n        d.locations.indexOf(DirectiveLocation.SUBSCRIPTION) !== -1\n    },\n    onFragment: {\n      deprecationReason: 'Use `locations`.',\n      type: new GraphQLNonNull(GraphQLBoolean),\n      resolve: d =>\n        d.locations.indexOf(DirectiveLocation.FRAGMENT_SPREAD) !== -1 ||\n        d.locations.indexOf(DirectiveLocation.INLINE_FRAGMENT) !== -1 ||\n        d.locations.indexOf(DirectiveLocation.FRAGMENT_DEFINITION) !== -1\n    },\n    onField: {\n      deprecationReason: 'Use `locations`.',\n      type: new GraphQLNonNull(GraphQLBoolean),\n      resolve: d => d.locations.indexOf(DirectiveLocation.FIELD) !== -1\n    },\n  }),\n});\n\nexport const __DirectiveLocation = new GraphQLEnumType({\n  name: '__DirectiveLocation',\n  description:\n    'A Directive can be adjacent to many parts of the GraphQL language, a ' +\n    '__DirectiveLocation describes one such possible adjacencies.',\n  values: {\n    QUERY: {\n      value: DirectiveLocation.QUERY,\n      description: 'Location adjacent to a query operation.'\n    },\n    MUTATION: {\n      value: DirectiveLocation.MUTATION,\n      description: 'Location adjacent to a mutation operation.'\n    },\n    SUBSCRIPTION: {\n      value: DirectiveLocation.SUBSCRIPTION,\n      description: 'Location adjacent to a subscription operation.'\n    },\n    FIELD: {\n      value: DirectiveLocation.FIELD,\n      description: 'Location adjacent to a field.'\n    },\n    FRAGMENT_DEFINITION: {\n      value: DirectiveLocation.FRAGMENT_DEFINITION,\n      description: 'Location adjacent to a fragment definition.'\n    },\n    FRAGMENT_SPREAD: {\n      value: DirectiveLocation.FRAGMENT_SPREAD,\n      description: 'Location adjacent to a fragment spread.'\n    },\n    INLINE_FRAGMENT: {\n      value: DirectiveLocation.INLINE_FRAGMENT,\n      description: 'Location adjacent to an inline fragment.'\n    },\n    SCHEMA: {\n      value: DirectiveLocation.SCHEMA,\n      description: 'Location adjacent to a schema definition.'\n    },\n    SCALAR: {\n      value: DirectiveLocation.SCALAR,\n      description: 'Location adjacent to a scalar definition.'\n    },\n    OBJECT: {\n      value: DirectiveLocation.OBJECT,\n      description: 'Location adjacent to an object type definition.'\n    },\n    FIELD_DEFINITION: {\n      value: DirectiveLocation.FIELD_DEFINITION,\n      description: 'Location adjacent to a field definition.'\n    },\n    ARGUMENT_DEFINITION: {\n      value: DirectiveLocation.ARGUMENT_DEFINITION,\n      description: 'Location adjacent to an argument definition.'\n    },\n    INTERFACE: {\n      value: DirectiveLocation.INTERFACE,\n      description: 'Location adjacent to an interface definition.'\n    },\n    UNION: {\n      value: DirectiveLocation.UNION,\n      description: 'Location adjacent to a union definition.'\n    },\n    ENUM: {\n      value: DirectiveLocation.ENUM,\n      description: 'Location adjacent to an enum definition.'\n    },\n    ENUM_VALUE: {\n      value: DirectiveLocation.ENUM_VALUE,\n      description: 'Location adjacent to an enum value definition.'\n    },\n    INPUT_OBJECT: {\n      value: DirectiveLocation.INPUT_OBJECT,\n      description: 'Location adjacent to an input object type definition.'\n    },\n    INPUT_FIELD_DEFINITION: {\n      value: DirectiveLocation.INPUT_FIELD_DEFINITION,\n      description: 'Location adjacent to an input object field definition.'\n    },\n  }\n});\n\nexport const __Type = new GraphQLObjectType({\n  name: '__Type',\n  description:\n    'The fundamental unit of any GraphQL Schema is the type. There are ' +\n    'many kinds of types in GraphQL as represented by the `__TypeKind` enum.' +\n    '\\n\\nDepending on the kind of a type, certain fields describe ' +\n    'information about that type. Scalar types provide no information ' +\n    'beyond a name and description, while Enum types provide their values. ' +\n    'Object and Interface types provide the fields they describe. Abstract ' +\n    'types, Union and Interface, provide the Object types possible ' +\n    'at runtime. List and NonNull types compose other types.',\n  fields: () => ({\n    kind: {\n      type: new GraphQLNonNull(__TypeKind),\n      resolve(type) {\n        if (type instanceof GraphQLScalarType) {\n          return TypeKind.SCALAR;\n        } else if (type instanceof GraphQLObjectType) {\n          return TypeKind.OBJECT;\n        } else if (type instanceof GraphQLInterfaceType) {\n          return TypeKind.INTERFACE;\n        } else if (type instanceof GraphQLUnionType) {\n          return TypeKind.UNION;\n        } else if (type instanceof GraphQLEnumType) {\n          return TypeKind.ENUM;\n        } else if (type instanceof GraphQLInputObjectType) {\n          return TypeKind.INPUT_OBJECT;\n        } else if (type instanceof GraphQLList) {\n          return TypeKind.LIST;\n        } else if (type instanceof GraphQLNonNull) {\n          return TypeKind.NON_NULL;\n        }\n        throw new Error('Unknown kind of type: ' + type);\n      }\n    },\n    name: { type: GraphQLString },\n    description: { type: GraphQLString },\n    fields: {\n      type: new GraphQLList(new GraphQLNonNull(__Field)),\n      args: {\n        includeDeprecated: { type: GraphQLBoolean, defaultValue: false }\n      },\n      resolve(type, { includeDeprecated }) {\n        if (type instanceof GraphQLObjectType ||\n            type instanceof GraphQLInterfaceType) {\n          const fieldMap = type.getFields();\n          let fields =\n            Object.keys(fieldMap).map(fieldName => fieldMap[fieldName]);\n          if (!includeDeprecated) {\n            fields = fields.filter(field => !field.deprecationReason);\n          }\n          return fields;\n        }\n        return null;\n      }\n    },\n    interfaces: {\n      type: new GraphQLList(new GraphQLNonNull(__Type)),\n      resolve(type) {\n        if (type instanceof GraphQLObjectType) {\n          return type.getInterfaces();\n        }\n      }\n    },\n    possibleTypes: {\n      type: new GraphQLList(new GraphQLNonNull(__Type)),\n      resolve(type, args, context, { schema }) {\n        if (type instanceof GraphQLInterfaceType ||\n            type instanceof GraphQLUnionType) {\n          return schema.getPossibleTypes(type);\n        }\n      }\n    },\n    enumValues: {\n      type: new GraphQLList(new GraphQLNonNull(__EnumValue)),\n      args: {\n        includeDeprecated: { type: GraphQLBoolean, defaultValue: false }\n      },\n      resolve(type, { includeDeprecated }) {\n        if (type instanceof GraphQLEnumType) {\n          let values = type.getValues();\n          if (!includeDeprecated) {\n            values = values.filter(value => !value.deprecationReason);\n          }\n          return values;\n        }\n      }\n    },\n    inputFields: {\n      type: new GraphQLList(new GraphQLNonNull(__InputValue)),\n      resolve(type) {\n        if (type instanceof GraphQLInputObjectType) {\n          const fieldMap = type.getFields();\n          return Object.keys(fieldMap).map(fieldName => fieldMap[fieldName]);\n        }\n      }\n    },\n    ofType: { type: __Type }\n  })\n});\n\nexport const __Field = new GraphQLObjectType({\n  name: '__Field',\n  description:\n    'Object and Interface types are described by a list of Fields, each of ' +\n    'which has a name, potentially a list of arguments, and a return type.',\n  fields: () => ({\n    name: { type: new GraphQLNonNull(GraphQLString) },\n    description: { type: GraphQLString },\n    args: {\n      type:\n        new GraphQLNonNull(new GraphQLList(new GraphQLNonNull(__InputValue))),\n      resolve: field => field.args || []\n    },\n    type: { type: new GraphQLNonNull(__Type) },\n    isDeprecated: { type: new GraphQLNonNull(GraphQLBoolean) },\n    deprecationReason: {\n      type: GraphQLString,\n    }\n  })\n});\n\nexport const __InputValue = new GraphQLObjectType({\n  name: '__InputValue',\n  description:\n    'Arguments provided to Fields or Directives and the input fields of an ' +\n    'InputObject are represented as Input Values which describe their type ' +\n    'and optionally a default value.',\n  fields: () => ({\n    name: { type: new GraphQLNonNull(GraphQLString) },\n    description: { type: GraphQLString },\n    type: { type: new GraphQLNonNull(__Type) },\n    defaultValue: {\n      type: GraphQLString,\n      description:\n        'A GraphQL-formatted string representing the default value for this ' +\n        'input value.',\n      resolve: inputVal => isNullish(inputVal.defaultValue) ?\n        null :\n        print(astFromValue(inputVal.defaultValue, inputVal.type))\n    }\n  })\n});\n\nexport const __EnumValue = new GraphQLObjectType({\n  name: '__EnumValue',\n  description:\n    'One possible value for a given Enum. Enum values are unique values, not ' +\n    'a placeholder for a string or numeric value. However an Enum value is ' +\n    'returned in a JSON response as a string.',\n  fields: () => ({\n    name: { type: new GraphQLNonNull(GraphQLString) },\n    description: { type: GraphQLString },\n    isDeprecated: { type: new GraphQLNonNull(GraphQLBoolean) },\n    deprecationReason: {\n      type: GraphQLString,\n    }\n  })\n});\n\nexport const TypeKind = {\n  SCALAR: 'SCALAR',\n  OBJECT: 'OBJECT',\n  INTERFACE: 'INTERFACE',\n  UNION: 'UNION',\n  ENUM: 'ENUM',\n  INPUT_OBJECT: 'INPUT_OBJECT',\n  LIST: 'LIST',\n  NON_NULL: 'NON_NULL',\n};\n\nexport const __TypeKind = new GraphQLEnumType({\n  name: '__TypeKind',\n  description: 'An enum describing what kind of type a given `__Type` is.',\n  values: {\n    SCALAR: {\n      value: TypeKind.SCALAR,\n      description: 'Indicates this type is a scalar.'\n    },\n    OBJECT: {\n      value: TypeKind.OBJECT,\n      description: 'Indicates this type is an object. ' +\n                   '`fields` and `interfaces` are valid fields.'\n    },\n    INTERFACE: {\n      value: TypeKind.INTERFACE,\n      description: 'Indicates this type is an interface. ' +\n                   '`fields` and `possibleTypes` are valid fields.'\n    },\n    UNION: {\n      value: TypeKind.UNION,\n      description: 'Indicates this type is a union. ' +\n                   '`possibleTypes` is a valid field.'\n    },\n    ENUM: {\n      value: TypeKind.ENUM,\n      description: 'Indicates this type is an enum. ' +\n                   '`enumValues` is a valid field.'\n    },\n    INPUT_OBJECT: {\n      value: TypeKind.INPUT_OBJECT,\n      description: 'Indicates this type is an input object. ' +\n                   '`inputFields` is a valid field.'\n    },\n    LIST: {\n      value: TypeKind.LIST,\n      description: 'Indicates this type is a list. ' +\n                   '`ofType` is a valid field.'\n    },\n    NON_NULL: {\n      value: TypeKind.NON_NULL,\n      description: 'Indicates this type is a non-null. ' +\n                   '`ofType` is a valid field.'\n    },\n  }\n});\n\n/**\n * Note that these are GraphQLFieldDefinition and not GraphQLFieldConfig,\n * so the format for args is different.\n */\n\nexport const SchemaMetaFieldDef: GraphQLFieldDefinition = {\n  name: '__schema',\n  type: new GraphQLNonNull(__Schema),\n  description: 'Access the current type schema of this server.',\n  args: [],\n  resolve: (source, args, context, { schema }) => schema\n};\n\nexport const TypeMetaFieldDef: GraphQLFieldDefinition = {\n  name: '__type',\n  type: __Type,\n  description: 'Request the type information of a single type.',\n  args: [\n    { name: 'name', type: new GraphQLNonNull(GraphQLString) }\n  ],\n  resolve: (source, { name }: { name: string }, context, { schema }) =>\n    schema.getType(name)\n};\n\nexport const TypeNameMetaFieldDef: GraphQLFieldDefinition = {\n  name: '__typename',\n  type: new GraphQLNonNull(GraphQLString),\n  description: 'The name of the current Object type at runtime.',\n  args: [],\n  resolve: (source, args, context, { parentType }) => parentType.name\n};\n",
                "subject": "Simplify introspection",
                "message": "Simplify introspection\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "enaqx/graphql-js,baer/graphql-js,gabelevi/graphql-js,jjergus/graphql-js,baer/graphql-js,gabelevi/graphql-js,graphql/graphql-js,graphql/graphql-js,enaqx/graphql-js,tgriesser/graphql-js,enaqx/graphql-js,jjergus/graphql-js,graphql/graphql-js,tgriesser/graphql-js"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10297,
            "row": {
                "commit": "d0935d490f05f309804925002cb8b9439dc8cb06",
                "old_file": "data/abilities.js",
                "new_file": "data/abilities.js",
                "old_contents":"/*\n\nRatings and how they work:\n\n-2: Extremely detrimental\n\t  The sort of ability that relegates Pokemon with Uber-level BSTs\n\t  into NU.\n\tex. Slow Start, Truant\n\n-1: Detrimental\n\t  An ability that does more harm than good.\n\tex. Defeatist, Normalize\n\n 0: Useless\n\t  An ability with no net effect on a Pokemon during a battle.\n\tex. Pickup, Illuminate\n\n 1: Ineffective\n\t  An ability that has a minimal effect. Should never be chosen over\n\t  any other ability.\n\tex. Damp, Shell Armor\n\n 2: Situationally useful\n\t  An ability that can be useful in certain situations.\n\tex. Blaze, Insomnia\n\n 3: Useful\n\t  An ability that is generally useful.\n\tex. Volt Absorb, Iron Fist\n\n 4: Very useful\n\t  One of the most popular abilities. The difference between 3 and 4\n\t  can be ambiguous.\n\tex. Technician, Protean\n\n 5: Essential\n\t  The sort of ability that defines metagames.\n\tex. Drizzle, Shadow Tag\n\n*/\n\nexports.BattleAbilities = {\n\t\"adaptability\": {\n\t\tdesc: \"This Pokemon's attacks that receive STAB (Same Type Attack Bonus) are increased from 50% to 100%.\",\n\t\tshortDesc: \"This Pokemon's same-type attack bonus (STAB) is increased from 1.5x to 2x.\",\n\t\tonModifyMove: function(move) {\n\t\t\tmove.stab = 2;\n\t\t},\n\t\tid: \"adaptability\",\n\t\tname: \"Adaptability\",\n\t\trating: 3.5,\n\t\tnum: 91\n\t},\n\t\"aftermath\": {\n\t\tdesc: \"If a contact move knocks out this Pokemon, the opponent receives damage equal to one-fourth of its max HP.\",\n\t\tshortDesc: \"If this Pokemon is KOed with a contact move, that move's user loses 1/4 its max HP.\",\n\t\tid: \"aftermath\",\n\t\tname: \"Aftermath\",\n\t\tonFaint: function(target, source, effect) {\n\t\t\tif (effect && effect.effectType === 'Move' && effect.isContact && source) {\n\t\t\t\tthis.damage(source.maxhp/4, source, target);\n\t\t\t}\n\t\t},\n\t\trating: 3,\n\t\tnum: 106\n\t},\n\t\"aerilate\": {\n\t\tdesc: \"Turns all of this Pokemon's Normal-typed attacks into Flying-type and deal 1.3x damage. Does not affect Hidden Power.\",\n\t\tshortDesc: \"This Pokemon's Normal moves become Flying-type and do 1.3x damage.\",\n\t\tonModifyMove: function(move, pokemon) {\n\t\t\tif (move.type === 'Normal' && move.id !== 'hiddenpower') {\n\t\t\t\tmove.type = 'Flying';\n\t\t\t\tpokemon.addVolatile('aerilate');\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tduration: 1,\n\t\t\tonBasePowerPriority: 8,\n\t\t\tonBasePower: function(basePower, pokemon, target, move) {\n\t\t\t\treturn this.chainModify([0x14CD, 0x1000]);\n\t\t\t}\n\t\t},\n\t\tid: \"aerilate\",\n\t\tname: \"Aerilate\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"airlock\": {\n\t\tdesc: \"While this Pokemon is active, all weather conditions and their effects are disabled.\",\n\t\tshortDesc: \"While this Pokemon is active, all weather conditions and their effects are disabled.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-message', 'The effects of weather disappeared. (placeholder)');\n\t\t},\n\t\tonAnyModifyPokemon: function(pokemon) {\n\t\t\tpokemon.ignore['WeatherTarget'] = true;\n\t\t},\n\t\tonAnyTryWeather: false,\n\t\tid: \"airlock\",\n\t\tname: \"Air Lock\",\n\t\trating: 3,\n\t\tnum: 76\n\t},\n\t\"analytic\": {\n\t\tdesc: \"If the user moves last, the power of that move is increased by 30%.\",\n\t\tshortDesc: \"This Pokemon's attacks do 1.3x damage if it is the last to move in a turn.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (!this.willMove(defender)) {\n\t\t\t\tthis.debug('Analytic boost');\n\t\t\t\treturn this.chainModify([0x14CD, 0x1000]); // The Analytic modifier is slightly higher than the normal 1.3 (0x14CC)\n\t\t\t}\n\t\t},\n\t\tid: \"analytic\",\n\t\tname: \"Analytic\",\n\t\trating: 1,\n\t\tnum: 148\n\t},\n\t\"angerpoint\": {\n\t\tdesc: \"If this Pokemon, or its Substitute, is struck by a Critical Hit, its Attack is boosted to six stages.\",\n\t\tshortDesc: \"If this Pokemon (not a Substitute) is hit by a critical hit, its Attack is boosted by 12.\",\n\t\tonCriticalHit: function(target) {\n\t\t\tif (!target.volatiles['substitute']) {\n\t\t\t\ttarget.setBoost({atk: 6});\n\t\t\t\tthis.add('-setboost',target,'atk',12,'[from] ability: Anger Point');\n\t\t\t}\n\t\t},\n\t\tid: \"angerpoint\",\n\t\tname: \"Anger Point\",\n\t\trating: 2,\n\t\tnum: 83\n\t},\n\t\"anticipation\": {\n\t\tdesc: \"A warning is displayed if an opposing Pokemon has the moves Fissure, Guillotine, Horn Drill, Sheer Cold, or any attacking move from a type that is considered super effective against this Pokemon (including Counter, Mirror Coat, and Metal Burst). Hidden Power, Judgment, Natural Gift and Weather Ball are considered Normal-type moves. Flying Press is considered a Fighting-type move.\",\n\t\tshortDesc: \"On switch-in, this Pokemon shudders if any foe has a super effective or OHKO move.\",\n\t\tonStart: function(pokemon) {\n\t\t\tvar targets = pokemon.side.foe.active;\n\t\t\tfor (var i=0; i<targets.length; i++) {\n\t\t\t\tif (!targets[i] || targets[i].fainted) continue;\n\t\t\t\tfor (var j=0; j<targets[i].moveset.length; j++) {\n\t\t\t\t\tvar move = this.getMove(targets[i].moveset[j].move);\n\t\t\t\t\tif (move.category !== 'Status' && (this.getImmunity(move.type, pokemon) && this.getEffectiveness(move.type, pokemon) > 0 || move.ohko)) {\n\t\t\t\t\t\tthis.add('-message', pokemon.name+' shuddered! (placeholder)');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"anticipation\",\n\t\tname: \"Anticipation\",\n\t\trating: 1,\n\t\tnum: 107\n\t},\n\t\"arenatrap\": {\n\t\tdesc: \"When this Pokemon enters the field, its opponents cannot switch or flee the battle unless they are part Flying-type, have the Levitate ability, are holding Shed Shell, or they use the moves Baton Pass or U-Turn. Flying-type and Levitate Pokemon cannot escape if they are holding Iron Ball or Gravity is in effect. Levitate Pokemon also cannot escape if their ability is disabled through other means, such as Skill Swap or Gastro Acid.\",\n\t\tshortDesc: \"Prevents foes from switching out normally unless they have immunity to Ground.\",\n\t\tonFoeModifyPokemon: function(pokemon) {\n\t\t\tif (pokemon.runImmunity('Ground', false)) {\n\t\t\t\tpokemon.tryTrap();\n\t\t\t}\n\t\t},\n\t\tonFoeMaybeTrapPokemon: function(pokemon) {\n\t\t\tif (pokemon.runImmunity('Ground', false)) {\n\t\t\t\tpokemon.maybeTrapped = true;\n\t\t\t}\n\t\t},\n\t\tid: \"arenatrap\",\n\t\tname: \"Arena Trap\",\n\t\trating: 5,\n\t\tnum: 71\n\t},\n\t\"aromaveil\": {\n\t\tdesc: \"Protects allies from attacks that limit their move choices.\",\n\t\tshortDesc: \"Protects allies from attacks that limit their move choices.\",\n\t\tonAllyTryHit: function(target, source, move) {\n\t\t\tif (move && move.id in {disable:1, encore:1, healblock:1, imprison:1, taunt:1, torment:1}) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tid: \"aromaveil\",\n\t\tname: \"Aroma Veil\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"aurabreak\": {\n\t\tdesc: \"Reverses the effect of Dark Aura and Fairy Aura.\",\n\t\tshortDesc: \"Reverses the effect of Aura abilities.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability', pokemon, 'Aura Break');\n\t\t},\n\t\tid: \"aurabreak\",\n\t\tname: \"Aura Break\",\n\t\trating: 2,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"baddreams\": {\n\t\tdesc: \"If asleep, each of this Pokemon's opponents receives damage equal to one-eighth of its max HP.\",\n\t\tshortDesc: \"Causes sleeping adjacent foes to lose 1/8 of their max HP at the end of each turn.\",\n\t\tonResidualOrder: 26,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tif (!pokemon.hp) return;\n\t\t\tfor (var i=0; i<pokemon.side.foe.active.length; i++) {\n\t\t\t\tvar target = pokemon.side.foe.active[i];\n\t\t\t\tif (!target || !target.hp) continue;\n\t\t\t\tif (target.status === 'slp') {\n\t\t\t\t\tthis.damage(target.maxhp/8, target);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"baddreams\",\n\t\tname: \"Bad Dreams\",\n\t\trating: 2,\n\t\tnum: 123\n\t},\n\t\"battlearmor\": {\n\t\tdesc: \"Critical Hits cannot strike this Pokemon.\",\n\t\tshortDesc: \"This Pokemon cannot be struck by a critical hit.\",\n\t\tonCriticalHit: false,\n\t\tid: \"battlearmor\",\n\t\tname: \"Battle Armor\",\n\t\trating: 1,\n\t\tnum: 4\n\t},\n\t\"bigpecks\": {\n\t\tdesc: \"Prevents the Pokemon's Defense stat from being reduced.\",\n\t\tshortDesc: \"Prevents other Pokemon from lowering this Pokemon's Defense.\",\n\t\tonBoost: function(boost, target, source, effect) {\n\t\t\tif (source && target === source) return;\n\t\t\tif (boost['def'] && boost['def'] < 0) {\n\t\t\t\tboost['def'] = 0;\n\t\t\t\tif (!effect.secondaries) this.add(\"-fail\", target, \"unboost\", \"Defense\", \"[from] ability: Big Pecks\", \"[of] \"+target);\n\t\t\t}\n\t\t},\n\t\tid: \"bigpecks\",\n\t\tname: \"Big Pecks\",\n\t\trating: 1,\n\t\tnum: 145\n\t},\n\t\"blaze\": {\n\t\tdesc: \"When its health reaches one-third or less of its max HP, this Pokemon's Fire-type attacks receive a 50% boost in power.\",\n\t\tshortDesc: \"When this Pokemon has 1/3 or less of its max HP, its Fire attacks do 1.5x damage.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Fire' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Blaze boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Fire' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Blaze boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"blaze\",\n\t\tname: \"Blaze\",\n\t\trating: 2,\n\t\tnum: 66\n\t},\n\t\"bulletproof\": {\n\t\tdesc: \"This Pokemon is protected from some Ball and Bomb moves.\",\n\t\tshortDesc: \"This Pokemon is protected from ball and bomb moves.\",\n\t\tonTryHit: function(pokemon, target, move) {\n\t\t\tif (move.isBullet) {\n\t\t\t\tthis.add('-immune', pokemon, '[msg]', '[from] Bulletproof');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"bulletproof\",\n\t\tname: \"Bulletproof\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"cheekpouch\": {\n\t\tdesc: \"Restores HP when this Pokemon consumes a berry.\",\n\t\tshortDesc: \"Restores HP when this Pokemon consumes a berry.\",\n\t\tonEatItem: function(item, pokemon) {\n\t\t\tthis.heal(pokemon.maxhp/4);\n\t\t},\n\t\tid: \"cheekpouch\",\n\t\tname: \"Cheek Pouch\",\n\t\trating: 2,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"chlorophyll\": {\n\t\tdesc: \"If this Pokemon is active while Sunny Day is in effect, its speed is temporarily doubled.\",\n\t\tshortDesc: \"If Sunny Day is active, this Pokemon's Speed is doubled.\",\n\t\tonModifySpe: function(speMod) {\n\t\t\tif (this.isWeather('sunnyday')) {\n\t\t\t\treturn this.chain(speMod, 2);\n\t\t\t}\n\t\t},\n\t\tid: \"chlorophyll\",\n\t\tname: \"Chlorophyll\",\n\t\trating: 2,\n\t\tnum: 34\n\t},\n\t\"clearbody\": {\n\t\tdesc: \"Opponents cannot reduce this Pokemon's stats; they can, however, modify stat changes with Power Swap, Guard Swap and Heart Swap and inflict stat boosts with Swagger and Flatter. This ability does not prevent self-inflicted stat reductions.\",\n\t\tshortDesc: \"Prevents other Pokemon from lowering this Pokemon's stat stages.\",\n\t\tonBoost: function(boost, target, source, effect) {\n\t\t\tif (source && target === source) return;\n\t\t\tvar showMsg = false;\n\t\t\tfor (var i in boost) {\n\t\t\t\tif (boost[i] < 0) {\n\t\t\t\t\tdelete boost[i];\n\t\t\t\t\tshowMsg = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (showMsg && !effect.secondaries) this.add(\"-fail\", target, \"unboost\", \"[from] ability: Clear Body\", \"[of] \"+target);\n\t\t},\n\t\tid: \"clearbody\",\n\t\tname: \"Clear Body\",\n\t\trating: 2,\n\t\tnum: 29\n\t},\n\t\"cloudnine\": {\n\t\tdesc: \"While this Pokemon is active, all weather conditions and their effects are disabled.\",\n\t\tshortDesc: \"While this Pokemon is active, all weather conditions and their effects are disabled.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-message', 'The effects of weather disappeared. (placeholder)');\n\t\t},\n\t\tonAnyModifyPokemon: function(pokemon) {\n\t\t\tpokemon.ignore['WeatherTarget'] = true;\n\t\t},\n\t\tonAnyTryWeather: false,\n\t\tid: \"cloudnine\",\n\t\tname: \"Cloud Nine\",\n\t\trating: 3,\n\t\tnum: 13\n\t},\n\t\"colorchange\": {\n\t\tdesc: \"This Pokemon's type changes according to the type of the last move that hit this Pokemon.\",\n\t\tshortDesc: \"This Pokemon's type changes to match the type of the last move that hit it.\",\n\t\tonAfterMoveSecondary: function(target, source, move) {\n\t\t\tif (target.isActive && move && move.effectType === 'Move' && move.category !== 'Status') {\n\t\t\t\tif (!target.hasType(move.type)) {\n\t\t\t\t\tif (!target.setType(move.type)) return false;\n\t\t\t\t\tthis.add('-start', target, 'typechange', move.type, '[from] Color Change');\n\t\t\t\t\ttarget.update();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"colorchange\",\n\t\tname: \"Color Change\",\n\t\trating: 2,\n\t\tnum: 16\n\t},\n\t\"competitive\": {\n\t\tdesc: \"Raises the user's Special Attack stat by two stages when a stat is lowered, including the Special Attack stat. This does not include self-induced stat drops like those from Close Combat.\",\n\t\tshortDesc: \"This Pokemon's SpAtk is boosted by 2 for each of its stats that is lowered by a foe.\",\n\t\tonAfterEachBoost: function(boost, target, source) {\n\t\t\tif (!source || target.side === source.side) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar statsLowered = false;\n\t\t\tfor (var i in boost) {\n\t\t\t\tif (boost[i] < 0) {\n\t\t\t\t\tstatsLowered = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (statsLowered) {\n\t\t\t\tthis.boost({spa: 2});\n\t\t\t}\n\t\t},\n\t\tid: \"competitive\",\n\t\tname: \"Competitive\",\n\t\trating: 2,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"compoundeyes\": {\n\t\tdesc: \"The accuracy of this Pokemon's moves receives a 30% increase; for example, a 75% accurate move becomes 97.5% accurate.\",\n\t\tshortDesc: \"This Pokemon's moves have their accuracy boosted to 1.3x.\",\n\t\tonModifyMove: function(move) {\n\t\t\tif (typeof move.accuracy !== 'number') return;\n\t\t\tthis.debug('compoundeyes - enhancing accuracy');\n\t\t\tmove.accuracy *= 1.3;\n\t\t},\n\t\tid: \"compoundeyes\",\n\t\tname: \"Compound Eyes\",\n\t\trating: 3.5,\n\t\tnum: 14\n\t},\n\t\"contrary\": {\n\t\tdesc: \"Stat changes are inverted.\",\n\t\tshortDesc: \"If this Pokemon has a stat boosted it is lowered instead, and vice versa.\",\n\t\tonBoost: function(boost) {\n\t\t\tfor (var i in boost) {\n\t\t\t\tboost[i] *= -1;\n\t\t\t}\n\t\t},\n\t\tid: \"contrary\",\n\t\tname: \"Contrary\",\n\t\trating: 4,\n\t\tnum: 126\n\t},\n\t\"cursedbody\": {\n\t\tdesc: \"30% chance of disabling one of the opponent's moves when attacked. This works even if the attacker is behind a Substitute, but will not activate if the Pokemon with Cursed Body is behind a Substitute.\",\n\t\tshortDesc: \"If this Pokemon is hit by an attack, there is a 30% chance that move gets Disabled.\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (!source || source.volatiles['disable']) return;\n\t\t\tif (source !== target && move && move.effectType === 'Move') {\n\t\t\t\tif (this.random(10) < 3) {\n\t\t\t\t\tsource.addVolatile('disable');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"cursedbody\",\n\t\tname: \"Cursed Body\",\n\t\trating: 2,\n\t\tnum: 130\n\t},\n\t\"cutecharm\": {\n\t\tdesc: \"If an opponent of the opposite gender directly attacks this Pokemon, there is a 30% chance that the opponent will become Attracted to this Pokemon.\",\n\t\tshortDesc: \"30% chance of infatuating Pokemon of the opposite gender if they make contact.\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (move && move.isContact) {\n\t\t\t\tif (this.random(10) < 3) {\n\t\t\t\t\tsource.addVolatile('attract', target);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"cutecharm\",\n\t\tname: \"Cute Charm\",\n\t\trating: 1,\n\t\tnum: 56\n\t},\n\t\"damp\": {\n\t\tdesc: \"While this Pokemon is active, no Pokemon on the field can use Selfdestruct or Explosion.\",\n\t\tshortDesc: \"While this Pokemon is active, Selfdestruct, Explosion, and Aftermath do not work.\",\n\t\tid: \"damp\",\n\t\tonAnyTryMove: function(target, source, effect) {\n\t\t\tif (effect.id === 'selfdestruct' || effect.id === 'explosion') {\n\t\t\t\tthis.attrLastMove('[still]');\n\t\t\t\tthis.add('-activate', this.effectData.target, 'ability: Damp');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tonAnyDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && effect.id === 'aftermath') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tname: \"Damp\",\n\t\trating: 0.5,\n\t\tnum: 6\n\t},\n\t\"darkaura\": {\n\t\tdesc: \"Increases the power of all Dark-type moves in battle to 1.33x.\",\n\t\tshortDesc: \"Increases the power of all Dark-type moves in battle to 1.33x.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability', pokemon, 'Dark Aura');\n\t\t},\n\t\tonBasePowerPriority: 8,\n\t\tonAnyBasePower: function(basePower, attacker, defender, move) {\n\t\t\tvar reverseAura = false;\n\t\t\tfor (var p in attacker.side.active) {\n\t\t\t\tif (attacker.side.active[p] && attacker.side.active[p].ability === 'aurabreak') {\n\t\t\t\t\treverseAura = true;\n\t\t\t\t\tthis.debug('Reversing Dark Aura due to Aura Break');\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var p in defender.side.active) {\n\t\t\t\tif (defender.side.active[p] && defender.side.active[p].ability === 'aurabreak') {\n\t\t\t\t\treverseAura = true;\n\t\t\t\t\tthis.debug('Reversing Dark Aura due to Aura Break');\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (move.type === 'Dark') {\n\t\t\t\treturn this.chainModify(reverseAura? 0.75 : 4/3);\n\t\t\t}\n\t\t},\n\t\tid: \"darkaura\",\n\t\tname: \"Dark Aura\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"defeatist\": {\n\t\tdesc: \"Attack and Special Attack are halved when HP is less than half.\",\n\t\tshortDesc: \"When this Pokemon has 1/2 or less of its max HP, its Attack and Sp. Atk are halved.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk, pokemon) {\n\t\t\tif (pokemon.hp < pokemon.maxhp/2) {\n\t\t\t\treturn this.chainModify(0.5);\n\t\t\t}\n\t\t},\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(atk, pokemon) {\n\t\t\tif (pokemon.hp < pokemon.maxhp/2) {\n\t\t\t\treturn this.chainModify(0.5);\n\t\t\t}\n\t\t},\n\t\tonResidual: function(pokemon) {\n\t\t\tpokemon.update();\n\t\t},\n\t\tid: \"defeatist\",\n\t\tname: \"Defeatist\",\n\t\trating: -1,\n\t\tnum: 129\n\t},\n\t\"defiant\": {\n\t\tdesc: \"Raises the user's Attack stat by two stages when a stat is lowered, including the Attack stat. This does not include self-induced stat drops like those from Close Combat.\",\n\t\tshortDesc: \"This Pokemon's Attack is boosted by 2 for each of its stats that is lowered by a foe.\",\n\t\tonAfterEachBoost: function(boost, target, source) {\n\t\t\tif (!source || target.side === source.side) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar statsLowered = false;\n\t\t\tfor (var i in boost) {\n\t\t\t\tif (boost[i] < 0) {\n\t\t\t\t\tstatsLowered = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (statsLowered) {\n\t\t\t\tthis.boost({atk: 2});\n\t\t\t}\n\t\t},\n\t\tid: \"defiant\",\n\t\tname: \"Defiant\",\n\t\trating: 2,\n\t\tnum: 128\n\t},\n\t\"download\": {\n\t\tdesc: \"If this Pokemon switches into an opponent with equal Defenses or higher Defense than Special Defense, this Pokemon's Special Attack receives a 50% boost. If this Pokemon switches into an opponent with higher Special Defense than Defense, this Pokemon's Attack receive a 50% boost.\",\n\t\tshortDesc: \"On switch-in, Attack or Sp. Atk is boosted by 1 based on the foes' weaker Defense.\",\n\t\tonStart: function (pokemon) {\n\t\t\tvar foeactive = pokemon.side.foe.active;\n\t\t\tvar totaldef = 0;\n\t\t\tvar totalspd = 0;\n\t\t\tfor (var i=0; i<foeactive.length; i++) {\n\t\t\t\tif (!foeactive[i] || foeactive[i].fainted) continue;\n\t\t\t\ttotaldef += foeactive[i].getStat('def', false, true);\n\t\t\t\ttotalspd += foeactive[i].getStat('spd', false, true);\n\t\t\t}\n\t\t\tif (totaldef && totaldef >= totalspd) {\n\t\t\t\tthis.boost({spa:1});\n\t\t\t} else if (totalspd) {\n\t\t\t\tthis.boost({atk:1});\n\t\t\t}\n\t\t},\n\t\tid: \"download\",\n\t\tname: \"Download\",\n\t\trating: 4,\n\t\tnum: 88\n\t},\n\t\"drizzle\": {\n\t\tdesc: \"When this Pokemon enters the battlefield, the weather becomes Rain Dance (for 5 turns normally, or 8 turns while holding Damp Rock).\",\n\t\tshortDesc: \"On switch-in, the weather becomes Rain Dance.\",\n\t\tonStart: function(source) {\n\t\t\tthis.setWeather('raindance');\n\t\t},\n\t\tid: \"drizzle\",\n\t\tname: \"Drizzle\",\n\t\trating: 5,\n\t\tnum: 2\n\t},\n\t\"drought\": {\n\t\tdesc: \"When this Pokemon enters the battlefield, the weather becomes Sunny Day (for 5 turns normally, or 8 turns while holding Heat Rock).\",\n\t\tshortDesc: \"On switch-in, the weather becomes Sunny Day.\",\n\t\tonStart: function(source) {\n\t\t\tthis.setWeather('sunnyday');\n\t\t},\n\t\tid: \"drought\",\n\t\tname: \"Drought\",\n\t\trating: 5,\n\t\tnum: 70\n\t},\n\t\"dryskin\": {\n\t\tdesc: \"This Pokemon absorbs Water attacks and gains a weakness to Fire attacks. If Sunny Day is in effect, this Pokemon takes damage. If Rain Dance is in effect, this Pokemon recovers health.\",\n\t\tshortDesc: \"This Pokemon is healed 1/4 by Water, 1/8 by Rain; is hurt 1.25x by Fire, 1/8 by Sun.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Water') {\n\t\t\t\tif (!this.heal(target.maxhp/4)) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tonBasePowerPriority: 7,\n\t\tonFoeBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (this.effectData.target !== defender) return;\n\t\t\tif (move.type === 'Fire') {\n\t\t\t\treturn this.chainModify(1.25);\n\t\t\t}\n\t\t},\n\t\tonWeather: function(target, source, effect) {\n\t\t\tif (effect.id === 'raindance') {\n\t\t\t\tthis.heal(target.maxhp/8);\n\t\t\t} else if (effect.id === 'sunnyday') {\n\t\t\t\tthis.damage(target.maxhp/8);\n\t\t\t}\n\t\t},\n\t\tid: \"dryskin\",\n\t\tname: \"Dry Skin\",\n\t\trating: 3.5,\n\t\tnum: 87\n\t},\n\t\"earlybird\": {\n\t\tdesc: \"This Pokemon will remain asleep for half as long as it normally would; this includes both opponent-induced sleep and user-induced sleep via Rest.\",\n\t\tshortDesc: \"This Pokemon's sleep status lasts half as long as usual, self-induced or not.\",\n\t\tid: \"earlybird\",\n\t\tname: \"Early Bird\",\n\t\tisHalfSleep: true,\n\t\trating: 2.5,\n\t\tnum: 48\n\t},\n\t\"effectspore\": {\n\t\tdesc: \"If an opponent directly attacks this Pokemon, there is a 30% chance that the opponent will become either poisoned, paralyzed or put to sleep. There is an equal chance to inflict each status.\",\n\t\tshortDesc: \"30% chance of poisoning, paralyzing, or causing sleep on Pokemon making contact.\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (move && move.isContact && !source.status) {\n\t\t\t\tvar r = this.random(100);\n\t\t\t\tif (r < 11) source.setStatus('slp', target);\n\t\t\t\telse if (r < 21) source.setStatus('par', target);\n\t\t\t\telse if (r < 30) source.setStatus('psn', target);\n\t\t\t}\n\t\t},\n\t\tid: \"effectspore\",\n\t\tname: \"Effect Spore\",\n\t\trating: 2,\n\t\tnum: 27\n\t},\n\t\"fairyaura\": {\n\t\tdesc: \"Increases the power of all Fairy-type moves in battle to 1.33x.\",\n\t\tshortDesc: \"Increases the power of all Fairy-type moves in battle to 1.33x.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability', pokemon, 'Fairy Aura');\n\t\t},\n\t\tonBasePowerPriority: 8,\n\t\tonAnyBasePower: function(basePower, attacker, defender, move) {\n\t\t\tvar reverseAura = false;\n\t\t\tfor (var p in attacker.side.active) {\n\t\t\t\tif (attacker.side.active[p] && attacker.side.active[p].ability === 'aurabreak') {\n\t\t\t\t\treverseAura = true;\n\t\t\t\t\tthis.debug('Reversing Fairy Aura due to Aura Break');\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var p in defender.side.active) {\n\t\t\t\tif (defender.side.active[p] && defender.side.active[p].ability === 'aurabreak') {\n\t\t\t\t\treverseAura = true;\n\t\t\t\t\tthis.debug('Reversing Fairy Aura due to Aura Break');\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (move.type === 'Fairy') {\n\t\t\t\treturn this.chainModify(reverseAura? 0.75 : 4/3);\n\t\t\t}\n\t\t},\n\t\tid: \"fairyaura\",\n\t\tname: \"Fairy Aura\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"filter\": {\n\t\tdesc: \"This Pokemon receives one-fourth reduced damage from Super Effective attacks.\",\n\t\tshortDesc: \"This Pokemon receives 3/4 damage from super effective attacks.\",\n\t\tonSourceModifyDamage: function(damage, source, target, move) {\n\t\t\tif (this.getEffectiveness(move, target) > 0) {\n\t\t\t\tthis.debug('Filter neutralize');\n\t\t\t\t\treturn this.chainModify(0.75);\n\t\t\t}\n\t\t},\n\t\tid: \"filter\",\n\t\tname: \"Filter\",\n\t\trating: 3,\n\t\tnum: 111\n\t},\n\t\"flamebody\": {\n\t\tdesc: \"If an opponent directly attacks this Pokemon, there is a 30% chance that the opponent will become burned.\",\n\t\tshortDesc: \"30% chance of burning a Pokemon making contact with this Pokemon.\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (move && move.isContact) {\n\t\t\t\tif (this.random(10) < 3) {\n\t\t\t\t\tsource.trySetStatus('brn', target, move);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"flamebody\",\n\t\tname: \"Flame Body\",\n\t\trating: 2,\n\t\tnum: 49\n\t},\n\t\"flareboost\": {\n\t\tdesc: \"When the user with this ability is burned, its Special Attack is raised by 50%.\",\n\t\tshortDesc: \"When this Pokemon is burned, its special attacks do 1.5x damage.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (attacker.status === 'brn' && move.category === 'Special') {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"flareboost\",\n\t\tname: \"Flare Boost\",\n\t\trating: 3,\n\t\tnum: 138\n\t},\n\t\"flashfire\": {\n\t\tdesc: \"This Pokemon is immune to all Fire-type attacks; additionally, its own Fire-type attacks receive a 50% boost if a Fire-type move hits this Pokemon. Multiple boosts do not occur if this Pokemon is hit with multiple Fire-type attacks.\",\n\t\tshortDesc: \"This Pokemon's Fire attacks do 1.5x damage if hit by one Fire move; Fire immunity.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Fire') {\n\t\t\t\tmove.accuracy = true;\n\t\t\t\tif (!target.addVolatile('flashfire')) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tnoCopy: true, // doesn't get copied by Baton Pass\n\t\t\tonStart: function(target) {\n\t\t\t\tthis.add('-start',target,'ability: Flash Fire');\n\t\t\t},\n\t\t\tonModifyAtkPriority: 5,\n\t\t\tonModifyAtk: function(atk, attacker, defender, move) {\n\t\t\t\tif (move.type === 'Fire') {\n\t\t\t\t\tthis.debug('Flash Fire boost');\n\t\t\t\t\treturn this.chainModify(1.5);\n\t\t\t\t}\n\t\t\t},\n\t\t\tonModifySpAPriority: 5,\n\t\t\tonModifySpA: function(atk, attacker, defender, move) {\n\t\t\t\tif (move.type === 'Fire') {\n\t\t\t\t\tthis.debug('Flash Fire boost');\n\t\t\t\t\treturn this.chainModify(1.5);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"flashfire\",\n\t\tname: \"Flash Fire\",\n\t\trating: 3,\n\t\tnum: 18\n\t},\n\t\"flowergift\": {\n\t\tdesc: \"If this Pokemon is active while Sunny Day is in effect, its Attack and Special Defense stats (as well as its partner's stats in double battles) receive a 50% boost.\",\n\t\tshortDesc: \"If user is Cherrim and Sunny Day is active, it and allies' Attack and Sp. Def are 1.5x.\",\n\t\tonStart: function(pokemon) {\n\t\t\tdelete this.effectData.forme;\n\t\t},\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (!pokemon.isActive || pokemon.speciesid !== 'cherrim') return;\n\t\t\tif (this.isWeather('sunnyday')) {\n\t\t\t\tif (this.effectData.forme !== 'Sunshine') {\n\t\t\t\t\tthis.effectData.forme = 'Sunshine';\n\t\t\t\t\tthis.add('-formechange', pokemon, 'Cherrim-Sunshine');\n\t\t\t\t\tthis.add('-message', pokemon.name+' transformed! (placeholder)');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.effectData.forme) {\n\t\t\t\t\tdelete this.effectData.forme;\n\t\t\t\t\tthis.add('-formechange', pokemon, 'Cherrim');\n\t\t\t\t\tthis.add('-message', pokemon.name+' transformed! (placeholder)');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonModifyAtkPriority: 3,\n\t\tonAllyModifyAtk: function(atk) {\n\t\t\tif (this.effectData.target.template.speciesid !== 'cherrim') return;\n\t\t\tif (this.isWeather('sunnyday')) {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tonModifySpDPriority: 4,\n\t\tonAllyModifySpD: function(spd) {\n\t\t\tif (this.effectData.target.template.speciesid !== 'cherrim') return;\n\t\t\tif (this.isWeather('sunnyday')) {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"flowergift\",\n\t\tname: \"Flower Gift\",\n\t\trating: 3,\n\t\tnum: 122\n\t},\n\t\"flowerveil\": {\n\t\tdesc: \"Prevents lowering of ally Grass-type Pokemon's stats.\",\n\t\tshortDesc: \"Prevents lowering of ally Grass-type Pokemon's stats.\",\n\t\tonAllyBoost: function(boost, target, source, effect) {\n\t\t\tif ((source && target === source) || !target.hasType('Grass')) return;\n\t\t\tvar showMsg = false;\n\t\t\tfor (var i in boost) {\n\t\t\t\tif (boost[i] < 0) {\n\t\t\t\t\tdelete boost[i];\n\t\t\t\t\tshowMsg = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (showMsg && !effect.secondaries) this.add(\"-fail\", target, \"unboost\", \"[from] ability: Flower Veil\", \"[of] \"+target);\n\t\t},\n\t\tid: \"flowerveil\",\n\t\tname: \"Flower Veil\",\n\t\trating: 0,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"forecast\": {\n\t\tdesc: \"This Pokemon's type changes according to the current weather conditions: it becomes Fire-type during Sunny Day, Water-type during Rain Dance, Ice-type during Hail and remains its regular type otherwise.\",\n\t\tshortDesc: \"Castform's type changes to the current weather condition's type, except Sandstorm.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.baseTemplate.species !== 'Castform' || pokemon.transformed) return;\n\t\t\tvar forme = null;\n\t\t\tswitch (this.effectiveWeather()) {\n\t\t\tcase 'sunnyday':\n\t\t\t\tif (pokemon.template.speciesid !== 'castformsunny') forme = 'Castform-Sunny';\n\t\t\t\tbreak;\n\t\t\tcase 'raindance':\n\t\t\t\tif (pokemon.template.speciesid !== 'castformrainy') forme = 'Castform-Rainy';\n\t\t\t\tbreak;\n\t\t\tcase 'hail':\n\t\t\t\tif (pokemon.template.speciesid !== 'castformsnowy') forme = 'Castform-Snowy';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif (pokemon.template.speciesid !== 'castform') forme = 'Castform';\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (pokemon.isActive && forme) {\n\t\t\t\tpokemon.formeChange(forme);\n\t\t\t\tthis.add('-formechange', pokemon, forme);\n\t\t\t\tthis.add('-message', pokemon.name+' transformed! (placeholder)');\n\t\t\t}\n\t\t},\n\t\tid: \"forecast\",\n\t\tname: \"Forecast\",\n\t\trating: 4,\n\t\tnum: 59\n\t},\n\t\"forewarn\": {\n\t\tdesc: \"The move with the highest Base Power in the opponent's moveset is revealed.\",\n\t\tshortDesc: \"On switch-in, this Pokemon is alerted to the foes' move with the highest Base Power.\",\n\t\tonStart: function(pokemon) {\n\t\t\tvar targets = pokemon.side.foe.active;\n\t\t\tvar warnMoves = [];\n\t\t\tvar warnBp = 1;\n\t\t\tfor (var i=0; i<targets.length; i++) {\n\t\t\t\tif (targets[i].fainted) continue;\n\t\t\t\tfor (var j=0; j<targets[i].moveset.length; j++) {\n\t\t\t\t\tvar move = this.getMove(targets[i].moveset[j].move);\n\t\t\t\t\tvar bp = move.basePower;\n\t\t\t\t\tif (move.ohko) bp = 160;\n\t\t\t\t\tif (move.id === 'counter' || move.id === 'metalburst' || move.id === 'mirrorcoat') bp = 120;\n\t\t\t\t\tif (!bp && move.category !== 'Status') bp = 80;\n\t\t\t\t\tif (bp > warnBp) {\n\t\t\t\t\t\twarnMoves = [[move, targets[i]]];\n\t\t\t\t\t\twarnBp = bp;\n\t\t\t\t\t} else if (bp == warnBp) {\n\t\t\t\t\t\twarnMoves.push([move, targets[i]]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!warnMoves.length) return;\n\t\t\tvar warnMove = warnMoves[this.random(warnMoves.length)];\n\t\t\tthis.add('-activate', pokemon, 'ability: Forewarn', warnMove[0], warnMove[1]);\n\t\t},\n\t\tid: \"forewarn\",\n\t\tname: \"Forewarn\",\n\t\trating: 1,\n\t\tnum: 108\n\t},\n\t\"friendguard\": {\n\t\tdesc: \"Reduces the damage received from an ally in a double or triple battle.\",\n\t\tshortDesc: \"This Pokemon's allies receive 3/4 damage from other Pokemon's attacks.\",\n\t\tid: \"friendguard\",\n\t\tname: \"Friend Guard\",\n\t\tonAnyModifyDamage: function(damage, source, target, move) {\n\t\t\tif (target !== this.effectData.target && target.side === this.effectData.target.side) {\n\t\t\t\tthis.debug('Friend Guard weaken');\n\t\t\t\treturn this.chainModify(0.75);\n\t\t\t}\n\t\t},\n\t\trating: 0,\n\t\tnum: 132\n\t},\n\t\"frisk\": {\n\t\tdesc: \"When this Pokemon enters the field, it identifies all the opponent's held items.\",\n\t\tshortDesc: \"On switch-in, this Pokemon identifies the foe's held items.\",\n\t\tonStart: function(pokemon) {\n\t\t\tvar foeactive = pokemon.side.foe.active;\n\t\t\tfor (var i=0; i<foeactive.length; i++) {\n\t\t\t\tif (!foeactive[i] || foeactive[i].fainted) continue;\n\t\t\t\tif (foeactive[i].item) {\n\t\t\t\t\tthis.add('-item', foeactive[i], foeactive[i].getItem().name, '[from] ability: Frisk', '[of] '+pokemon, '[identify]');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"frisk\",\n\t\tname: \"Frisk\",\n\t\trating: 1.5,\n\t\tnum: 119\n\t},\n\t\"furcoat\": {\n\t\tdesc: \"Halves the damage done to this Pokemon by physical attacks.\",\n\t\tshortDesc: \"Halves physical damage done to this Pokemon.\",\n\t\tonModifyAtkPriority: 6,\n\t\tonSourceModifyAtk: function(atk, attacker, defender, move) {\n\t\t\treturn this.chainModify(0.5);\n\t\t},\n\t\tid: \"furcoat\",\n\t\tname: \"Fur Coat\",\n\t\trating: 3.5,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"galewings\": {\n\t\tdesc: \"This Pokemon's Flying-type moves have their priority increased by 1.\",\n\t\tshortDesc: \"Gives priority to Flying-type moves.\",\n\t\tonModifyPriority: function(priority, pokemon, target, move) {\n\t\t\tif (move && move.type === 'Flying') return priority + 1;\n\t\t},\n\t\tid: \"galewings\",\n\t\tname: \"Gale Wings\",\n\t\trating: 4.5,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"gluttony\": {\n\t\tdesc: \"This Pokemon consumes its held berry when its health reaches 50% max HP or lower.\",\n\t\tshortDesc: \"When this Pokemon has 1/2 or less of its max HP, it uses certain Berries early.\",\n\t\tid: \"gluttony\",\n\t\tname: \"Gluttony\",\n\t\trating: 1.5,\n\t\tnum: 82\n\t},\n\t\"gooey\": {\n\t\tdesc: \"Contact with this Pokemon lowers the attacker's Speed stat by 1.\",\n\t\tshortDesc: \"Contact with this Pokemon lowers the attacker's Speed.\",\n\t\tonAfterDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && effect.isContact) this.boost({spe: -1}, source, target);\n\t\t},\n\t\tid: \"gooey\",\n\t\tname: \"Gooey\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"grasspelt\": {\n\t\tdesc: \"This Pokemon's Defense is boosted in Grassy Terrain\",\n\t\tshortDesc: \"This Pokemon's Defense is boosted in Grassy Terrain.\",\n\t\tonModifyDefPriority: 6,\n\t\tonModifyDef: function(pokemon) {\n\t\t\tif (this.isTerrain('grassyterrain')) return this.chainModify(1.5);\n\t\t},\n\t\tid: \"grasspelt\",\n\t\tname: \"Grass Pelt\",\n\t\trating: 2,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"guts\": {\n\t\tdesc: \"When this Pokemon is poisoned (including Toxic), burned, paralyzed or asleep (including self-induced Rest), its Attack stat receives a 50% boost; the burn status' Attack drop is also ignored.\",\n\t\tshortDesc: \"If this Pokemon is statused, its Attack is 1.5x; burn's Attack drop is ignored.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk, pokemon) {\n\t\t\tif (pokemon.status) {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"guts\",\n\t\tname: \"Guts\",\n\t\trating: 3,\n\t\tnum: 62\n\t},\n\t\"harvest\": {\n\t\tdesc: \"When the user uses a held Berry, it has a 50% chance of having it restored at the end of the turn. This chance becomes 100% during Sunny Day.\",\n\t\tshortDesc: \"50% chance this Pokemon's Berry is restored at the end of each turn. 100% in Sun.\",\n\t\tid: \"harvest\",\n\t\tname: \"Harvest\",\n\t\tonResidualOrder: 26,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tif (this.isWeather('sunnyday') || this.random(2) === 0) {\n\t\t\t\tif (pokemon.hp && !pokemon.item && this.getItem(pokemon.lastItem).isBerry) {\n\t\t\t\t\tpokemon.setItem(pokemon.lastItem);\n\t\t\t\t\tthis.add('-item', pokemon, pokemon.getItem(), '[from] ability: Harvest');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\trating: 2,\n\t\tnum: 139\n\t},\n\t\"healer\": {\n\t\tdesc: \"Has a 30% chance of curing an adjacent ally's status ailment at the end of each turn in Double and Triple Battles.\",\n\t\tshortDesc: \"30% chance of curing an adjacent ally's status at the end of each turn.\",\n\t\tid: \"healer\",\n\t\tname: \"Healer\",\n\t\tonResidualOrder: 5,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tvar allyActive = pokemon.side.active;\n\t\t\tif (allyActive.length === 1) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (var i=0; i<allyActive.length; i++) {\n\t\t\t\tif (allyActive[i] && this.isAdjacent(pokemon, allyActive[i]) && allyActive[i].status && this.random(10) < 3) {\n\t\t\t\t\tallyActive[i].cureStatus();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\trating: 0,\n\t\tnum: 131\n\t},\n\t\"heatproof\": {\n\t\tdesc: \"This Pokemon receives half damage from both Fire-type attacks and residual burn damage.\",\n\t\tshortDesc: \"This Pokemon receives half damage from Fire-type attacks and burn damage.\",\n\t\tonBasePowerPriority: 7,\n\t\tonSourceBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (move.type === 'Fire') {\n\t\t\t\treturn this.chainModify(0.5);\n\t\t\t}\n\t\t},\n\t\tonDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && effect.id === 'brn') {\n\t\t\t\treturn damage / 2;\n\t\t\t}\n\t\t},\n\t\tid: \"heatproof\",\n\t\tname: \"Heatproof\",\n\t\trating: 2.5,\n\t\tnum: 85\n\t},\n\t\"heavymetal\": {\n\t\tdesc: \"The user's weight is doubled. This increases user's base power of Heavy Slam and Heat Crash, as well as damage taken from the opponent's Low Kick and Grass Knot, due to these moves being calculated by the target's weight.\",\n\t\tshortDesc: \"This Pokemon's weight is doubled.\",\n\t\tonModifyPokemon: function(pokemon) {\n\t\t\tpokemon.weightkg *= 2;\n\t\t},\n\t\tid: \"heavymetal\",\n\t\tname: \"Heavy Metal\",\n\t\trating: -1,\n\t\tnum: 134\n\t},\n\t\"honeygather\": {\n\t\tdesc: \"If it is not already holding an item, this Pokemon may find and be holding Honey after a battle.\",\n\t\tshortDesc: \"No competitive use.\",\n\t\tid: \"honeygather\",\n\t\tname: \"Honey Gather\",\n\t\trating: 0,\n\t\tnum: 118\n\t},\n\t\"hugepower\": {\n\t\tdesc: \"This Pokemon's Attack stat is doubled. Therefore, if this Pokemon's Attack stat on the status screen is 200, it effectively has an Attack stat of 400; which is then subject to the full range of stat boosts and reductions.\",\n\t\tshortDesc: \"This Pokemon's Attack is doubled.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk) {\n\t\t\treturn this.chainModify(2);\n\t\t},\n\t\tid: \"hugepower\",\n\t\tname: \"Huge Power\",\n\t\trating: 5,\n\t\tnum: 37\n\t},\n\t\"hustle\": {\n\t\tdesc: \"This Pokemon's Attack receives a 50% boost but its Physical attacks receive a 20% drop in Accuracy. For example, a 100% accurate move would become an 80% accurate move. The accuracy of moves that never miss, such as Aerial Ace, remains unaffected.\",\n\t\tshortDesc: \"This Pokemon's Attack is 1.5x and accuracy of its physical attacks is 0.8x.\",\n\t\t// This should be applied directly to the stat as opposed to chaining witht he others\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk) {\n\t\t\treturn this.modify(atk, 1.5);\n\t\t},\n\t\tonModifyMove: function(move) {\n\t\t\tif (move.category === 'Physical' && typeof move.accuracy === 'number') {\n\t\t\t\tmove.accuracy *= 0.8;\n\t\t\t}\n\t\t},\n\t\tid: \"hustle\",\n\t\tname: \"Hustle\",\n\t\trating: 3,\n\t\tnum: 55\n\t},\n\t\"hydration\": {\n\t\tdesc: \"If this Pokemon is active while Rain Dance is in effect, it recovers from poison, paralysis, burn, sleep and freeze at the end of the turn.\",\n\t\tshortDesc: \"This Pokemon has its status cured at the end of each turn if Rain Dance is active.\",\n\t\tonResidualOrder: 5,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tif (pokemon.status && this.isWeather('raindance')) {\n\t\t\t\tthis.debug('hydration');\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tid: \"hydration\",\n\t\tname: \"Hydration\",\n\t\trating: 2,\n\t\tnum: 93\n\t},\n\t\"hypercutter\": {\n\t\tdesc: \"Opponents cannot reduce this Pokemon's Attack stat; they can, however, modify stat changes with Power Swap or Heart Swap and inflict a stat boost with Swagger. This ability does not prevent self-inflicted stat reductions.\",\n\t\tshortDesc: \"Prevents other Pokemon from lowering this Pokemon's Attack.\",\n\t\tonBoost: function(boost, target, source, effect) {\n\t\t\tif (source && target === source) return;\n\t\t\tif (boost['atk'] && boost['atk'] < 0) {\n\t\t\t\tboost['atk'] = 0;\n\t\t\t\tif (!effect.secondaries) this.add(\"-fail\", target, \"unboost\", \"Attack\", \"[from] ability: Hyper Cutter\", \"[of] \"+target);\n\t\t\t}\n\t\t},\n\t\tid: \"hypercutter\",\n\t\tname: \"Hyper Cutter\",\n\t\trating: 1.5,\n\t\tnum: 52\n\t},\n\t\"icebody\": {\n\t\tdesc: \"If active while Hail is in effect, this Pokemon recovers one-sixteenth of its max HP after each turn. If a non-Ice-type Pokemon receives this ability through Skill Swap, Role Play or the Trace ability, it will not take damage from Hail.\",\n\t\tshortDesc: \"If Hail is active, this Pokemon heals 1/16 of its max HP each turn; immunity to Hail.\",\n\t\tonWeather: function(target, source, effect) {\n\t\t\tif (effect.id === 'hail') {\n\t\t\t\tthis.heal(target.maxhp/16);\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'hail') return false;\n\t\t},\n\t\tid: \"icebody\",\n\t\tname: \"Ice Body\",\n\t\trating: 3,\n\t\tnum: 115\n\t},\n\t\"illuminate\": {\n\t\tdesc: \"When this Pokemon is in the first slot of the player's party, it doubles the rate of wild encounters.\",\n\t\tshortDesc: \"No competitive use.\",\n\t\tid: \"illuminate\",\n\t\tname: \"Illuminate\",\n\t\trating: 0,\n\t\tnum: 35\n\t},\n\t\"illusion\": {\n\t\tdesc: \"Illusion will change the appearance of the Pokemon to a different species. This is dependent on the last Pokemon in the player's party. Along with the species itself, Illusion is broken when the user is damaged, but is not broken by Substitute, weather conditions, status ailments, or entry hazards. Illusion will replicate the type of Poke Ball, the species name, and the gender of the Pokemon it is masquerading as.\",\n\t\tshortDesc: \"This Pokemon appears as the last Pokemon in the party until it takes direct damage.\",\n\t\tonBeforeSwitchIn: function(pokemon) {\n\t\t\tpokemon.illusion = null;\n\t\t\tfor (var i=pokemon.side.pokemon.length-1; i>pokemon.position; i--) {\n\t\t\t\tif (!pokemon.side.pokemon[i]) continue;\n\t\t\t\tif (!pokemon.side.pokemon[i].fainted) break;\n\t\t\t}\n\t\t\tif (!pokemon.side.pokemon[i]) return;\n\t\t\tif (pokemon === pokemon.side.pokemon[i]) return;\n\t\t\tpokemon.illusion = pokemon.side.pokemon[i];\n\t\t},\n\t\t// illusion clearing is hardcoded in the damage function\n\t\tid: \"illusion\",\n\t\tname: \"Illusion\",\n\t\trating: 4.5,\n\t\tnum: 149\n\t},\n\t\"immunity\": {\n\t\tdesc: \"This Pokemon cannot become poisoned nor Toxic poisoned.\",\n\t\tshortDesc: \"This Pokemon cannot be poisoned. Gaining this Ability while poisoned cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.status === 'psn' || pokemon.status === 'tox') {\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type) {\n\t\t\tif (type === 'psn') return false;\n\t\t},\n\t\tid: \"immunity\",\n\t\tname: \"Immunity\",\n\t\trating: 1,\n\t\tnum: 17\n\t},\n\t\"imposter\": {\n\t\tdesc: \"As soon as the user comes into battle, it Transforms into its opponent, copying the opponent's stats exactly, with the exception of HP. Imposter copies all stat changes on the target originating from moves and abilities such as Swords Dance and Intimidate, but not from items such as Choice Specs. Imposter will not Transform the user if the opponent is an Illusion or if the opponent is behind a Substitute.\",\n\t\tshortDesc: \"On switch-in, this Pokemon copies the foe it's facing; stats, moves, types, Ability.\",\n\t\tonStart: function(pokemon) {\n\t\t\tvar target = pokemon.side.foe.active[pokemon.side.foe.active.length-1-pokemon.position];\n\t\t\tif (target) {\n\t\t\t\tpokemon.transformInto(target, pokemon);\n\t\t\t}\n\t\t},\n\t\tid: \"imposter\",\n\t\tname: \"Imposter\",\n\t\trating: 5,\n\t\tnum: 150\n\t},\n\t\"infiltrator\": {\n\t\tdesc: \"Ignores Substitute, Reflect, Light Screen, and Safeguard on the target.\",\n\t\tshortDesc: \"This Pokemon's moves ignore the foe's Substitute, Reflect, Light Screen, Safeguard, and Mist.\",\n\t\tonModifyMove: function(move) {\n\t\t\tmove.notSubBlocked = true;\n\t\t\tmove.ignoreScreens = true;\n\t\t},\n\t\tid: \"infiltrator\",\n\t\tname: \"Infiltrator\",\n\t\trating: 2.5,\n\t\tnum: 151\n\t},\n\t\"innerfocus\": {\n\t\tdesc: \"This Pokemon cannot be made to flinch.\",\n\t\tshortDesc: \"This Pokemon cannot be made to flinch.\",\n\t\tonFlinch: false,\n\t\tid: \"innerfocus\",\n\t\tname: \"Inner Focus\",\n\t\trating: 1,\n\t\tnum: 39\n\t},\n\t\"insomnia\": {\n\t\tdesc: \"This Pokemon cannot be put to sleep; this includes both opponent-induced sleep as well as user-induced sleep via Rest.\",\n\t\tshortDesc: \"This Pokemon cannot fall asleep. Gaining this Ability while asleep cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.status === 'slp') {\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'slp') return false;\n\t\t},\n\t\tid: \"insomnia\",\n\t\tname: \"Insomnia\",\n\t\trating: 2,\n\t\tnum: 15\n\t},\n\t\"intimidate\": {\n\t\tdesc: \"When this Pokemon enters the field, the Attack stat of each of its opponents lowers by one stage.\",\n\t\tshortDesc: \"On switch-in, this Pokemon lowers adjacent foes' Attack by 1.\",\n\t\tonStart: function(pokemon) {\n\t\t\tvar foeactive = pokemon.side.foe.active;\n\t\t\tfor (var i=0; i<foeactive.length; i++) {\n\t\t\t\tif (!foeactive[i] || foeactive[i].fainted) continue;\n\t\t\t\tif (foeactive[i].volatiles['substitute']) {\n\t\t\t\t\t// does it give a message?\n\t\t\t\t\tthis.add('-activate',foeactive[i],'Substitute','ability: Intimidate','[of] '+pokemon);\n\t\t\t\t} else {\n\t\t\t\t\tthis.add('-ability',pokemon,'Intimidate','[of] '+foeactive[i]);\n\t\t\t\t\tthis.boost({atk: -1}, foeactive[i], pokemon);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"intimidate\",\n\t\tname: \"Intimidate\",\n\t\trating: 3.5,\n\t\tnum: 22\n\t},\n\t\"ironbarbs\": {\n\t\tdesc: \"All moves that make contact with the Pokemon with Iron Barbs will damage the user by 1/8 of their maximum HP after damage is dealt.\",\n\t\tshortDesc: \"This Pokemon causes other Pokemon making contact to lose 1/8 of their max HP.\",\n\t\tonAfterDamageOrder: 1,\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (source && source !== target && move && move.isContact) {\n\t\t\t\tthis.damage(source.maxhp/8, source, target);\n\t\t\t}\n\t\t},\n\t\tid: \"ironbarbs\",\n\t\tname: \"Iron Barbs\",\n\t\trating: 3,\n\t\tnum: 160\n\t},\n\t\"ironfist\": {\n\t\tdesc: \"This Pokemon receives a 20% power boost for the following attacks: Bullet Punch, Comet Punch, Dizzy Punch, Drain Punch, Dynamicpunch, Fire Punch, Focus Punch, Hammer Arm, Ice Punch, Mach Punch, Mega Punch, Meteor Mash, Shadow Punch, Sky Uppercut, and Thunderpunch. Sucker Punch, which is known Ambush in Japan, is not boosted.\",\n\t\tshortDesc: \"This Pokemon's punch-based attacks do 1.2x damage. Sucker Punch is not boosted.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (move.isPunchAttack) {\n\t\t\t\tthis.debug('Iron Fist boost');\n\t\t\t\treturn this.chainModify(1.2);\n\t\t\t}\n\t\t},\n\t\tid: \"ironfist\",\n\t\tname: \"Iron Fist\",\n\t\trating: 3,\n\t\tnum: 89\n\t},\n\t\"justified\": {\n\t\tdesc: \"Will raise the user's Attack stat one level when hit by any Dark-type moves. Unlike other abilities with immunity to certain typed moves, the user will still receive damage from the attack. Justified will raise Attack one level for each hit of a multi-hit move like Beat Up.\",\n\t\tshortDesc: \"This Pokemon's Attack is boosted by 1 after it is damaged by a Dark-type attack.\",\n\t\tonAfterDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && effect.type === 'Dark') {\n\t\t\t\tthis.boost({atk:1});\n\t\t\t}\n\t\t},\n\t\tid: \"justified\",\n\t\tname: \"Justified\",\n\t\trating: 2,\n\t\tnum: 154\n\t},\n\t\"keeneye\": {\n\t\tdesc: \"This Pokemon's Accuracy cannot be lowered.\",\n\t\tshortDesc: \"Prevents other Pokemon from lowering this Pokemon's accuracy.\",\n\t\tonBoost: function(boost, target, source, effect) {\n\t\t\tif (source && target === source) return;\n\t\t\tif (boost['accuracy'] && boost['accuracy'] < 0) {\n\t\t\t\tboost['accuracy'] = 0;\n\t\t\t\tif (!effect.secondaries) this.add(\"-fail\", target, \"unboost\", \"accuracy\", \"[from] ability: Keen Eye\", \"[of] \"+target);\n\t\t\t}\n\t\t},\n\t\tonModifyMove: function(move) {\n\t\t\tmove.ignoreEvasion = true;\n\t\t},\n\t\tid: \"keeneye\",\n\t\tname: \"Keen Eye\",\n\t\trating: 1,\n\t\tnum: 51\n\t},\n\t\"klutz\": {\n\t\tdesc: \"This Pokemon ignores both the positive and negative effects of its held item, other than the speed-halving and EV-enhancing effects of Macho Brace, Power Anklet, Power Band, Power Belt, Power Bracer, Power Lens, and Power Weight. Fling cannot be used.\",\n\t\tshortDesc: \"This Pokemon's held item has no effect, except Macho Brace. Fling cannot be used.\",\n\t\tonModifyPokemonPriority: 1,\n\t\tonModifyPokemon: function(pokemon) {\n\t\t\tpokemon.ignore['Item'] = true;\n\t\t},\n\t\tid: \"klutz\",\n\t\tname: \"Klutz\",\n\t\trating: 0,\n\t\tnum: 103\n\t},\n\t\"leafguard\": {\n\t\tdesc: \"If this Pokemon is active while Sunny Day is in effect, it cannot become poisoned, burned, paralyzed or put to sleep (other than user-induced Rest). Leaf Guard does not heal status effects that existed before Sunny Day came into effect.\",\n\t\tshortDesc: \"If Sunny Day is active, this Pokemon cannot be statused and Rest will fail for it.\",\n\t\tonSetStatus: function(pokemon) {\n\t\t\tif (this.isWeather('sunnyday')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (move && move.id === 'yawn' && this.isWeather('sunnyday')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tid: \"leafguard\",\n\t\tname: \"Leaf Guard\",\n\t\trating: 1,\n\t\tnum: 102\n\t},\n\t\"levitate\": {\n\t\tdesc: \"This Pokemon is immune to Ground-type attacks, Spikes, Toxic Spikes and the Arena Trap ability; it loses these immunities while holding Iron Ball, after using Ingrain or if Gravity is in effect.\",\n\t\tshortDesc: \"This Pokemon is immune to Ground; Gravity, Ingrain, Smack Down, Iron Ball nullify it.\",\n\t\tonImmunity: function(type) {\n\t\t\tif (type === 'Ground') return false;\n\t\t},\n\t\tid: \"levitate\",\n\t\tname: \"Levitate\",\n\t\trating: 3.5,\n\t\tnum: 26\n\t},\n\t\"lightmetal\": {\n\t\tdesc: \"The user's weight is halved. This decreases the damage taken from Low Kick and Grass Knot, and also lowers user's base power of Heavy Slam and Heat Crash, due these moves being calculated by the target and user's weight.\",\n\t\tshortDesc: \"This Pokemon's weight is halved.\",\n\t\tonModifyPokemon: function(pokemon) {\n\t\t\tpokemon.weightkg /= 2;\n\t\t},\n\t\tid: \"lightmetal\",\n\t\tname: \"Light Metal\",\n\t\trating: 1,\n\t\tnum: 135\n\t},\n\t\"lightningrod\": {\n\t\tdesc: \"During double battles, this Pokemon draws any single-target Electric-type attack to itself. If an opponent uses an Electric-type attack that affects multiple Pokemon, those targets will be hit. This ability does not affect Electric Hidden Power or Judgment. The user is immune to Electric and its Special Attack is increased one stage when hit by one.\",\n\t\tshortDesc: \"This Pokemon draws Electric moves to itself to boost Sp. Atk by 1; Electric immunity.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Electric') {\n\t\t\t\tif (!this.boost({spa:1})) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tonAnyRedirectTargetPriority: 1,\n\t\tonAnyRedirectTarget: function(target, source, source2, move) {\n\t\t\tif (move.type !== 'Electric') return;\n\t\t\tif (this.validTarget(this.effectData.target, source, move.target)) {\n\t\t\t\treturn this.effectData.target;\n\t\t\t}\n\t\t},\n\t\tid: \"lightningrod\",\n\t\tname: \"Lightningrod\",\n\t\trating: 3.5,\n\t\tnum: 32\n\t},\n\t\"limber\": {\n\t\tdesc: \"This Pokemon cannot become paralyzed.\",\n\t\tshortDesc: \"This Pokemon cannot be paralyzed. Gaining this Ability while paralyzed cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.status === 'par') {\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'par') return false;\n\t\t},\n\t\tid: \"limber\",\n\t\tname: \"Limber\",\n\t\trating: 2,\n\t\tnum: 7\n\t},\n\t\"liquidooze\": {\n\t\tdesc: \"When another Pokemon uses Absorb, Drain Punch, Dream Eater, Giga Drain, Leech Life, Leech Seed or Mega Drain against this Pokemon, the attacking Pokemon loses the amount of health that it would have gained.\",\n\t\tshortDesc: \"This Pokemon damages those draining HP from it for as much as they would heal.\",\n\t\tid: \"liquidooze\",\n\t\tonSourceTryHeal: function(damage, target, source, effect) {\n\t\t\tthis.debug(\"Heal is occurring: \"+target+\" <- \"+source+\" :: \"+effect.id);\n\t\t\tvar canOoze = {drain: 1, leechseed: 1};\n\t\t\tif (canOoze[effect.id]) {\n\t\t\t\tthis.damage(damage);\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t},\n\t\tname: \"Liquid Ooze\",\n\t\trating: 1,\n\t\tnum: 64\n\t},\n\t\"magician\": {\n\t\tdesc: \"If this Pokemon is not holding an item, it steals the held item of a target it hits with a move.\",\n\t\tshortDesc: \"This Pokemon steals the held item of a target it hits with a move.\",\n\t\tonHit: function(target, source, move) {\n\t\t\t// We need to hard check if the ability is Magician since the event will be run both ways.\n\t\t\tif (target && target !== source && move && source.ability === 'magician') {\n\t\t\t\tif (source.item) return;\n\t\t\t\tvar yourItem = target.takeItem(source);\n\t\t\t\tif (!yourItem) return;\n\t\t\t\tif (!source.setItem(yourItem)) {\n\t\t\t\t\ttarget.item = yourItem.id; // bypass setItem so we don't break choicelock or anything\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.add('-item', source, yourItem, '[from] ability: Magician', '[of] ' + target);\n\t\t\t}\n\t\t},\n\t\tid: \"magician\",\n\t\tname: \"Magician\",\n\t\trating: 2,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"magicbounce\": {\n\t\tdesc: \"Non-damaging moves are reflected back at the user.\",\n\t\tshortDesc: \"This Pokemon blocks certain status moves and uses the move itself.\",\n\t\tid: \"magicbounce\",\n\t\tname: \"Magic Bounce\",\n\t\tonTryHitPriority: 1,\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target === source) return;\n\t\t\tif (move.hasBounced) return;\n\t\t\tif (typeof move.isBounceable === 'undefined') {\n\t\t\t\tmove.isBounceable = !!(move.category === 'Status' && (move.status || move.boosts || move.volatileStatus === 'confusion' || move.forceSwitch));\n\t\t\t}\n\t\t\tif (move.isBounceable) {\n\t\t\t\tvar newMove = this.getMoveCopy(move.id);\n\t\t\t\tnewMove.hasBounced = true;\n\t\t\t\tthis.useMove(newMove, target, source);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tonAllyTryHitSide: function(target, source, move) {\n\t\t\tif (target.side === source.side) return;\n\t\t\tif (move.hasBounced) return;\n\t\t\tif (typeof move.isBounceable === 'undefined') {\n\t\t\t\tmove.isBounceable = !!(move.category === 'Status' && (move.status || move.boosts || move.volatileStatus === 'confusion' || move.forceSwitch));\n\t\t\t}\n\t\t\tif (move.isBounceable) {\n\t\t\t\tvar newMove = this.getMoveCopy(move.id);\n\t\t\t\tnewMove.hasBounced = true;\n\t\t\t\tthis.useMove(newMove, target, source);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tduration: 1\n\t\t},\n\t\trating: 5,\n\t\tnum: 156\n\t},\n\t\"magicguard\": {\n\t\tdesc: \"Prevents all damage except from direct attacks.\",\n\t\tshortDesc: \"This Pokemon can only be damaged by direct attacks.\",\n\t\tonDamage: function(damage, target, source, effect) {\n\t\t\tif (effect.effectType !== 'Move') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tid: \"magicguard\",\n\t\tname: \"Magic Guard\",\n\t\trating: 4.5,\n\t\tnum: 98\n\t},\n\t\"magmaarmor\": {\n\t\tdesc: \"This Pokemon cannot become frozen.\",\n\t\tshortDesc: \"This Pokemon cannot be frozen. Gaining this Ability while frozen cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.status === 'frz') {\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'frz') return false;\n\t\t},\n\t\tid: \"magmaarmor\",\n\t\tname: \"Magma Armor\",\n\t\trating: 0.5,\n\t\tnum: 40\n\t},\n\t\"magnetpull\": {\n\t\tdesc: \"When this Pokemon enters the field, Steel-type opponents cannot switch out nor flee the battle unless they are holding Shed Shell or use attacks like U-Turn or Baton Pass.\",\n\t\tshortDesc: \"Prevents Steel-type foes from switching out normally.\",\n\t\tonFoeModifyPokemon: function(pokemon) {\n\t\t\tif (pokemon.hasType('Steel')) {\n\t\t\t\tpokemon.tryTrap();\n\t\t\t}\n\t\t},\n\t\tonFoeMaybeTrapPokemon: function(pokemon) {\n\t\t\tif (pokemon.hasType('Steel')) {\n\t\t\t\tpokemon.maybeTrapped = true;\n\t\t\t}\n\t\t},\n\t\tid: \"magnetpull\",\n\t\tname: \"Magnet Pull\",\n\t\trating: 4.5,\n\t\tnum: 42\n\t},\n\t\"marvelscale\": {\n\t\tdesc: \"When this Pokemon becomes burned, poisoned (including Toxic), paralyzed, frozen or put to sleep (including self-induced sleep via Rest), its Defense receives a 50% boost.\",\n\t\tshortDesc: \"If this Pokemon is statused, its Defense is 1.5x.\",\n\t\tonModifyDefPriority: 6,\n\t\tonModifyDef: function(def, pokemon) {\n\t\t\tif (pokemon.status) {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"marvelscale\",\n\t\tname: \"Marvel Scale\",\n\t\trating: 3,\n\t\tnum: 63\n\t},\n\t\"megalauncher\": {\n\t\tdesc: \"Boosts the power of Aura and Pulse moves, such as Aura Sphere and Dark Pulse, by 50%.\",\n\t\tshortDesc: \"Boosts the power of Aura/Pulse moves by 50%.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (move.isPulseMove) {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"megalauncher\",\n\t\tname: \"Mega Launcher\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"minus\": {\n\t\tdesc: \"This Pokemon's Special Attack receives a 50% boost in double battles if a partner has the Plus or Minus ability.\",\n\t\tshortDesc: \"If an ally has the Ability Plus or Minus, this Pokemon's Sp. Atk is 1.5x.\",\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(spa, pokemon) {\n\t\t\tvar allyActive = pokemon.side.active;\n\t\t\tif (allyActive.length === 1) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (var i=0; i<allyActive.length; i++) {\n\t\t\t\tif (allyActive[i] && allyActive[i].position !== pokemon.position && !allyActive[i].fainted && (allyActive[i].ability === 'minus' || allyActive[i].ability === 'plus')) {\n\t\t\t\t\treturn this.chainModify(1.5);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"minus\",\n\t\tname: \"Minus\",\n\t\trating: 0,\n\t\tnum: 58\n\t},\n\t\"moldbreaker\": {\n\t\tdesc: \"When this Pokemon becomes active, it nullifies the abilities of opposing active Pokemon that hinder this Pokemon's attacks. These abilities include Battle Armor, Clear Body, Damp, Dry Skin, Filter, Flash Fire, Flower Gift, Heatproof, Herbivore, Hyper Cutter, Immunity, Inner Focus, Insomnia, Keen Eye, Leaf Guard, Levitate, Lightningrod, Limber, Magma Armor, Marvel Scale, Motor Drive, Oblivious, Own Tempo, Sand Veil, Shell Armor, Shield Dust, Simple, Snow Cloak, Solid Rock, Soundproof, Sticky Hold, Storm Drain, Sturdy, Suction Cups, Tangled Feet, Thick Fat, Unaware, Vital Spirit, Volt Absorb, Water Absorb, Water Veil, White Smoke and Wonder Guard.\",\n\t\tshortDesc: \"This Pokemon's moves ignore the target's Ability if it could modify the effectiveness.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability', pokemon, 'Mold Breaker');\n\t\t},\n\t\tonAllyModifyPokemonPriority: 100,\n\t\tonAllyModifyPokemon: function(pokemon) {\n\t\t\tif (this.activePokemon === this.effectData.target && pokemon !== this.activePokemon) {\n\t\t\t\tpokemon.ignore['Ability'] = 'A';\n\t\t\t}\n\t\t},\n\t\tonFoeModifyPokemonPriority: 100,\n\t\tonFoeModifyPokemon: function(pokemon) {\n\t\t\tif (this.activePokemon === this.effectData.target) {\n\t\t\t\tpokemon.ignore['Ability'] = 'A';\n\t\t\t}\n\t\t},\n\t\tid: \"moldbreaker\",\n\t\tname: \"Mold Breaker\",\n\t\trating: 3,\n\t\tnum: 104\n\t},\n\t\"moody\": {\n\t\tdesc: \"At the end of each turn, the Pokemon raises a random stat that isn't already +6 by two stages, and lowers a random stat that isn't already -6 by one stage. These stats include accuracy and evasion.\",\n\t\tshortDesc: \"Boosts a random stat by 2 and lowers another stat by 1 at the end of each turn.\",\n\t\tonResidualOrder: 26,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tvar stats = [], i = '';\n\t\t\tvar boost = {};\n\t\t\tfor (var i in pokemon.boosts) {\n\t\t\t\tif (pokemon.boosts[i] < 6) {\n\t\t\t\t\tstats.push(i);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (stats.length) {\n\t\t\t\ti = stats[this.random(stats.length)];\n\t\t\t\tboost[i] = 2;\n\t\t\t}\n\t\t\tstats = [];\n\t\t\tfor (var j in pokemon.boosts) {\n\t\t\t\tif (pokemon.boosts[j] > -6 && j !== i) {\n\t\t\t\t\tstats.push(j);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (stats.length) {\n\t\t\t\ti = stats[this.random(stats.length)];\n\t\t\t\tboost[i] = -1;\n\t\t\t}\n\t\t\tthis.boost(boost);\n\t\t},\n\t\tid: \"moody\",\n\t\tname: \"Moody\",\n\t\trating: 5,\n\t\tnum: 141\n\t},\n\t\"motordrive\": {\n\t\tdesc: \"This Pokemon is immune to all Electric-type moves (including Status moves). If hit by an Electric-type attack, its Speed increases by one stage.\",\n\t\tshortDesc: \"This Pokemon's Speed is boosted by 1 if hit by an Electric move; Electric immunity.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Electric') {\n\t\t\t\tif (!this.boost({spe:1})) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"motordrive\",\n\t\tname: \"Motor Drive\",\n\t\trating: 3,\n\t\tnum: 78\n\t},\n\t\"moxie\": {\n\t\tdesc: \"If this Pokemon knocks out another Pokemon with a damaging attack, its Attack is raised by one stage.\",\n\t\tshortDesc: \"This Pokemon's Attack is boosted by 1 if it attacks and faints another Pokemon.\",\n\t\tonSourceFaint: function(target, source, effect) {\n\t\t\tif (effect && effect.effectType === 'Move') {\n\t\t\t\tthis.boost({atk:1}, source);\n\t\t\t}\n\t\t},\n\t\tid: \"moxie\",\n\t\tname: \"Moxie\",\n\t\trating: 4,\n\t\tnum: 153\n\t},\n\t\"multiscale\": {\n\t\tdesc: \"If this Pokemon is at full HP, it takes half damage from attacks.\",\n\t\tshortDesc: \"If this Pokemon is at full HP, it takes half damage from attacks.\",\n\t\tonSourceModifyDamage: function(damage, source, target, move) {\n\t\t\tif (target.hp >= target.maxhp) {\n\t\t\t\tthis.debug('Multiscale weaken');\n\t\t\t\treturn this.chainModify(0.5);\n\t\t\t}\n\t\t},\n\t\tid: \"multiscale\",\n\t\tname: \"Multiscale\",\n\t\trating: 4,\n\t\tnum: 136\n\t},\n\t\"multitype\": {\n\t\tdesc: \"If this Pokemon is Arceus, its type and sprite change to match its held Plate. Either way, this Pokemon is holding a Plate, the Plate cannot be taken (such as by Trick or Thief). This ability cannot be Skill Swapped, Role Played or Traced.\",\n\t\tshortDesc: \"If this Pokemon is Arceus, its type changes to match its held Plate.\",\n\t\t// Multitype's type-changing itself is implemented in statuses.js\n\t\tonTakeItem: function(item) {\n\t\t\tif (item.onPlate) return false;\n\t\t},\n\t\tid: \"multitype\",\n\t\tname: \"Multitype\",\n\t\trating: 4,\n\t\tnum: 121\n\t},\n\t\"mummy\": {\n\t\tdesc: \"When the user is attacked by a contact move, the opposing Pokemon's ability is turned into Mummy as well. Multitype, Wonder Guard and Mummy itself are the only abilities not affected by Mummy. The effect of Mummy is not removed by Mold Breaker, Turboblaze, or Teravolt.\",\n\t\tshortDesc: \"Pokemon making contact with this Pokemon have their Ability changed to Mummy.\",\n\t\tid: \"mummy\",\n\t\tname: \"Mummy\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (source && source !== target && move && move.isContact) {\n\t\t\t\tif (source.setAbility('mummy', source, 'mummy', true)) {\n\t\t\t\t\tthis.add('-ability', source, 'Mummy', '[from] Mummy');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\trating: 1,\n\t\tnum: 152\n\t},\n\t\"naturalcure\": {\n\t\tdesc: \"When this Pokemon switches out of battle, it is cured of poison (including Toxic), paralysis, burn, freeze and sleep (including self-induced Rest).\",\n\t\tshortDesc: \"This Pokemon has its status cured when it switches out.\",\n\t\tonSwitchOut: function(pokemon) {\n\t\t\tpokemon.setStatus('');\n\t\t},\n\t\tid: \"naturalcure\",\n\t\tname: \"Natural Cure\",\n\t\trating: 4,\n\t\tnum: 30\n\t},\n\t\"noguard\": {\n\t\tdesc: \"Every attack used by or against this Pokemon will always hit, even during evasive two-turn moves such as Fly and Dig.\",\n\t\tshortDesc: \"Every move used by or against this Pokemon will always hit.\",\n\t\tonModifyMove: function(move) {\n\t\t\tmove.accuracy = true;\n\t\t\tmove.alwaysHit = true;\n\t\t},\n\t\tonSourceModifyMove: function(move) {\n\t\t\tmove.accuracy = true;\n\t\t\tmove.alwaysHit = true;\n\t\t},\n\t\tid: \"noguard\",\n\t\tname: \"No Guard\",\n\t\trating: 4,\n\t\tnum: 99\n\t},\n\t\"normalize\": {\n\t\tdesc: \"Makes all of this Pokemon's attacks Normal-typed.\",\n\t\tshortDesc: \"This Pokemon's moves all become Normal-typed.\",\n\t\tonModifyMove: function(move) {\n\t\t\tif (move.id !== 'struggle') {\n\t\t\t\tmove.type = 'Normal';\n\t\t\t}\n\t\t},\n\t\tid: \"normalize\",\n\t\tname: \"Normalize\",\n\t\trating: -1,\n\t\tnum: 96\n\t},\n\t\"oblivious\": {\n\t\tdesc: \"This Pokemon cannot be infatuated (by Attract or Cute Charm) or taunted. Gaining this Ability while afflicted by either condition cures it.\",\n\t\tshortDesc: \"This Pokemon cannot be infatuated or taunted. Gaining this Ability cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.volatiles['attract']) {\n\t\t\t\tpokemon.removeVolatile('attract');\n\t\t\t\tthis.add(\"-message\", pokemon.name+\" got over its infatuation. (placeholder)\");\n\t\t\t}\n\t\t\tif (pokemon.volatiles['taunt']) {\n\t\t\t\tpokemon.removeVolatile('taunt');\n\t\t\t\t// TODO: Research proper message.\n\t\t\t\tthis.add(\"-message\", pokemon.name+\" got over its taunt. (placeholder)\");\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'attract') {\n\t\t\t\tthis.add('-immune', pokemon, '[from] Oblivious');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tonTryHit: function(pokemon, target, move) {\n\t\t\tif (move.id === 'captivate' || move.id === 'taunt') {\n\t\t\t\tthis.add('-immune', pokemon, '[msg]', '[from] Oblivious');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"oblivious\",\n\t\tname: \"Oblivious\",\n\t\trating: 0.5,\n\t\tnum: 12\n\t},\n\t\"overcoat\": {\n\t\tdesc: \"In battle, the Pokemon does not take damage from weather conditions like Sandstorm or Hail. It is also immune to powder moves.\",\n\t\tshortDesc: \"This Pokemon is immune to residual weather damage, and powder moves.\",\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'sandstorm' || type === 'hail' || type === 'powder') return false;\n\t\t},\n\t\tid: \"overcoat\",\n\t\tname: \"Overcoat\",\n\t\trating: 2,\n\t\tnum: 142\n\t},\n\t\"overgrow\": {\n\t\tdesc: \"When its health reaches one-third or less of its max HP, this Pokemon's Grass-type attacks receive a 50% boost in power.\",\n\t\tshortDesc: \"When this Pokemon has 1/3 or less of its max HP, its Grass attacks do 1.5x damage.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Grass' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Overgrow boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Grass' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Overgrow boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"overgrow\",\n\t\tname: \"Overgrow\",\n\t\trating: 2,\n\t\tnum: 65\n\t},\n\t\"owntempo\": {\n\t\tdesc: \"This Pokemon cannot be confused. Gaining this Ability while confused cures it.\",\n\t\tshortDesc: \"This Pokemon cannot be confused. Gaining this Ability while confused cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.volatiles['confusion']) {\n\t\t\t\tpokemon.removeVolatile('confusion');\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'confusion') {\n\t\t\t\tthis.add('-immune', pokemon, 'confusion');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tid: \"owntempo\",\n\t\tname: \"Own Tempo\",\n\t\trating: 1,\n\t\tnum: 20\n\t},\n\t\"parentalbond\": {\n\t\tdesc: \"Allows the Pokemon to hit twice with the same move in one turn. Second hit has 0.5x base power. Does not affect Status, multihit, or spread moves (in doubles).\",\n\t\tshortDesc: \"Hits twice in one turn. Second hit has 0.5x base power.\",\n\t\tonModifyMove: function(move, pokemon, target) {\n\t\t\tif (move.category !== 'Status' && !move.selfdestruct && !move.multihit && ((target.side && target.side.active.length < 2) || move.target in {any:1, normal:1, randomNormal:1})) {\n\t\t\t\tmove.multihit = 2;\n\t\t\t\tpokemon.addVolatile('parentalbond');\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tduration: 1,\n\t\t\tonBasePowerPriority: 8,\n\t\t\tonBasePower: function(basePower) {\n\t\t\t\tif (this.effectData.hit) {\n\t\t\t\t\treturn this.chainModify(0.5);\n\t\t\t\t} else {\n\t\t\t\t\tthis.effectData.hit = true;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"parentalbond\",\n\t\tname: \"Parental Bond\",\n\t\trating: 4.5,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"pickup\": {\n\t\tdesc: \"If an opponent uses a consumable item, Pickup will give the Pokemon the item used, if it is not holding an item. If multiple Pickup Pokemon are in play, one will pick up a copy of the used Berry, and may or may not use it immediately. Works on Berries, Gems, Absorb Bulb, Focus Sash, Herbs, Cell Battery, Red Card, and anything that is thrown with Fling.\",\n\t\tshortDesc: \"If this Pokemon has no item, it finds one used by an adjacent Pokemon this turn.\",\n\t\tonResidualOrder: 26,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tvar foe = pokemon.side.foe.randomActive();\n\t\t\tif (!foe) return;\n\t\t\tif (!pokemon.item && foe.lastItem && foe.usedItemThisTurn && foe.lastItem !== 'airballoon' && foe.lastItem !== 'ejectbutton') {\n\t\t\t\tpokemon.setItem(foe.lastItem);\n\t\t\t\tfoe.lastItem = '';\n\t\t\t\tvar item = pokemon.getItem();\n\t\t\t\tthis.add('-item', pokemon, item, '[from] Pickup');\n\t\t\t\tif (item.isBerry) pokemon.update();\n\t\t\t}\n\t\t},\n\t\tid: \"pickup\",\n\t\tname: \"Pickup\",\n\t\trating: 0,\n\t\tnum: 53\n\t},\n\t\"pickpocket\": {\n\t\tdesc: \"If this Pokemon has no item, it steals an item off an attacking Pokemon making contact.\",\n\t\tshortDesc: \"If this Pokemon has no item, it steals an item off a Pokemon making contact.\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (source && source !== target && move && move.isContact) {\n\t\t\t\tif (target.item) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar yourItem = source.takeItem(target);\n\t\t\t\tif (!yourItem) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!target.setItem(yourItem)) {\n\t\t\t\t\tsource.item = yourItem.id;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.add('-item', target, yourItem, '[from] ability: Pickpocket');\n\t\t\t}\n\t\t},\n\t\tid: \"pickpocket\",\n\t\tname: \"Pickpocket\",\n\t\trating: 1,\n\t\tnum: 124\n\t},\n\t\"pixilate\": {\n\t\tdesc: \"Turns all of this Pokemon's Normal-typed attacks into Fairy-type and deal 1.3x damage. Does not affect Hidden Power.\",\n\t\tshortDesc: \"This Pokemon's Normal moves become Fairy-type and do 1.3x damage.\",\n\t\tonModifyMove: function(move, pokemon) {\n\t\t\tif (move.type === 'Normal' && move.id !== 'hiddenpower') {\n\t\t\t\tmove.type = 'Fairy';\n\t\t\t\tpokemon.addVolatile('pixilate');\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tduration: 1,\n\t\t\tonBasePowerPriority: 8,\n\t\t\tonBasePower: function(basePower, pokemon, target, move) {\n\t\t\t\treturn this.chainModify([0x14CD, 0x1000]);\n\t\t\t}\n\t\t},\n\t\tid: \"pixilate\",\n\t\tname: \"Pixilate\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"plus\": {\n\t\tdesc: \"This Pokemon's Special Attack receives a 50% boost in double battles if a partner has the Plus or Minus ability.\",\n\t\tshortDesc: \"If an ally has the Ability Plus or Minus, this Pokemon's Sp. Atk is 1.5x.\",\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(spa, pokemon) {\n\t\t\tvar allyActive = pokemon.side.active;\n\t\t\tif (allyActive.length === 1) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (var i=0; i<allyActive.length; i++) {\n\t\t\t\tif (allyActive[i] && allyActive[i].position !== pokemon.position && !allyActive[i].fainted && (allyActive[i].ability === 'minus' || allyActive[i].ability === 'plus')) {\n\t\t\t\t\treturn this.chainModify(1.5);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"plus\",\n\t\tname: \"Plus\",\n\t\trating: 0,\n\t\tnum: 57\n\t},\n\t\"poisonheal\": {\n\t\tdesc: \"If this Pokemon becomes poisoned (including Toxic), it will recover 1/8 of its max HP after each turn.\",\n\t\tshortDesc: \"This Pokemon is healed by 1/8 of its max HP each turn when poisoned; no HP loss.\",\n\t\tonDamage: function(damage, target, source, effect) {\n\t\t\tif (effect.id === 'psn' || effect.id === 'tox') {\n\t\t\t\tthis.heal(target.maxhp/8);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tid: \"poisonheal\",\n\t\tname: \"Poison Heal\",\n\t\trating: 4,\n\t\tnum: 90\n\t},\n\t\"poisonpoint\": {\n\t\tdesc: \"If an opponent contact attacks this Pokemon, there is a 30% chance that the opponent will become poisoned.\",\n\t\tshortDesc: \"30% chance of poisoning a Pokemon making contact with this Pokemon.\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (move && move.isContact) {\n\t\t\t\tif (this.random(10) < 3) {\n\t\t\t\t\tsource.trySetStatus('psn', target, move);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"poisonpoint\",\n\t\tname: \"Poison Point\",\n\t\trating: 2,\n\t\tnum: 38\n\t},\n\t\"poisontouch\": {\n\t\tdesc: \"This Pokemon's contact attacks have a 30% chance of poisoning the target.\",\n\t\tshortDesc: \"This Pokemon's contact moves have a 30% chance of poisoning.\",\n\t\t// upokecenter says this is implemented as an added secondary effect\n\t\tonModifyMove: function(move) {\n\t\t\tif (!move || !move.isContact) return;\n\t\t\tif (!move.secondaries) {\n\t\t\t\tmove.secondaries = [];\n\t\t\t}\n\t\t\tmove.secondaries.push({\n\t\t\t\tchance: 30,\n\t\t\t\tstatus: 'psn'\n\t\t\t});\n\t\t},\n\t\tid: \"poisontouch\",\n\t\tname: \"Poison Touch\",\n\t\trating: 2,\n\t\tnum: 143\n\t},\n\t\"prankster\": {\n\t\tdesc: \"This Pokemon's Status moves have their priority increased by 1 stage.\",\n\t\tshortDesc: \"This Pokemon's Status moves have their priority increased by 1.\",\n\t\tonModifyPriority: function(priority, pokemon, target, move) {\n\t\t\tif (move && move.category === 'Status') {\n\t\t\t\treturn priority + 1;\n\t\t\t}\n\t\t},\n\t\tid: \"prankster\",\n\t\tname: \"Prankster\",\n\t\trating: 4.5,\n\t\tnum: 158\n\t},\n\t\"pressure\": {\n\t\tdesc: \"If this Pokemon is the target of a foe's move, that move loses one additional PP.\",\n\t\tshortDesc: \"If this Pokemon is the target of a foe's move, that move loses one additional PP.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability', pokemon, 'Pressure');\n\t\t},\n\t\tonSourceDeductPP: function(pp, target, source) {\n\t\t\tif (target.side === source.side) return;\n\t\t\treturn pp+1;\n\t\t},\n\t\tid: \"pressure\",\n\t\tname: \"Pressure\",\n\t\trating: 1.5,\n\t\tnum: 46\n\t},\n\t\"protean\": {\n\t\tdesc: \"Right before this Pokemon uses a move, it changes its type to match that move. Hidden Power is interpreted as its Hidden Power type, rather than Normal.\",\n\t\tshortDesc: \"Right before this Pokemon uses a move, it changes its type to match that move.\",\n\t\tonBeforeMove: function(pokemon, target, move) {\n\t\t\tif (!move || pokemon.volatiles.mustrecharge) return;\n\t\t\tvar moveType = (move.id === 'hiddenpower' ? pokemon.hpType : move.type);\n\t\t\tif (pokemon.getTypes().join() !== moveType) {\n\t\t\t\tif (!pokemon.setType(moveType)) return false;\n\t\t\t\tthis.add('-start', pokemon, 'typechange', moveType, '[from] Protean');\n\t\t\t}\n\t\t},\n\t\tid: \"protean\",\n\t\tname: \"Protean\",\n\t\trating: 4,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"purepower\": {\n\t\tdesc: \"This Pokemon's Attack stat is doubled. Note that this is the Attack stat itself, not the base Attack stat of its species.\",\n\t\tshortDesc: \"This Pokemon's Attack is doubled.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk) {\n\t\t\treturn this.chainModify(2);\n\t\t},\n\t\tid: \"purepower\",\n\t\tname: \"Pure Power\",\n\t\trating: 5,\n\t\tnum: 74\n\t},\n\t\"quickfeet\": {\n\t\tdesc: \"When this Pokemon is poisoned (including Toxic), burned, paralyzed, asleep (including self-induced Rest) or frozen, its Speed stat receives a 50% boost; the paralysis status' Speed drop is also ignored.\",\n\t\tshortDesc: \"If this Pokemon is statused, its Speed is 1.5x; paralysis' Speed drop is ignored.\",\n\t\tonModifySpe: function(speMod, pokemon) {\n\t\t\tif (pokemon.status) {\n\t\t\t\treturn this.chain(speMod, 1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"quickfeet\",\n\t\tname: \"Quick Feet\",\n\t\trating: 3,\n\t\tnum: 95\n\t},\n\t\"raindish\": {\n\t\tdesc: \"If the weather is Rain Dance, this Pokemon recovers 1/16 of its max HP after each turn.\",\n\t\tshortDesc: \"If the weather is Rain Dance, this Pokemon heals 1/16 of its max HP each turn.\",\n\t\tonWeather: function(target, source, effect) {\n\t\t\tif (effect.id === 'raindance') {\n\t\t\t\tthis.heal(target.maxhp/16);\n\t\t\t}\n\t\t},\n\t\tid: \"raindish\",\n\t\tname: \"Rain Dish\",\n\t\trating: 1.5,\n\t\tnum: 44\n\t},\n\t\"rattled\": {\n\t\tdesc: \"Raises the user's Speed one stage when hit by a Dark-, Bug-, or Ghost-type move.\",\n\t\tshortDesc: \"This Pokemon gets +1 Speed if hit by a Dark-, Bug-, or Ghost-type attack.\",\n\t\tonAfterDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && (effect.type === 'Dark' || effect.type === 'Bug' || effect.type === 'Ghost')) {\n\t\t\t\tthis.boost({spe:1});\n\t\t\t}\n\t\t},\n\t\tid: \"rattled\",\n\t\tname: \"Rattled\",\n\t\trating: 2,\n\t\tnum: 155\n\t},\n\t\"reckless\": {\n\t\tdesc: \"When this Pokemon uses an attack that causes recoil damage, or an attack that has a chance to cause recoil damage such as Jump Kick and High Jump Kick, the attacks's power receives a 20% boost.\",\n\t\tshortDesc: \"This Pokemon's attacks with recoil or crash damage do 1.2x damage; not Struggle.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (move.recoil || move.hasCustomRecoil) {\n\t\t\t\tthis.debug('Reckless boost');\n\t\t\t\treturn this.chainModify(1.2);\n\t\t\t}\n\t\t},\n\t\tid: \"reckless\",\n\t\tname: \"Reckless\",\n\t\trating: 3,\n\t\tnum: 120\n\t},\n\t\"refrigerate\": {\n\t\tdesc: \"Turns all of this Pokemon's Normal-typed attacks into Ice-typed and deal 1.3x damage. Does not affect Hidden Power.\",\n\t\tshortDesc: \"This Pokemon's Normal moves become Ice-type and do 1.3x damage.\",\n\t\tonModifyMove: function(move, pokemon) {\n\t\t\tif (move.type === 'Normal' && move.id !== 'hiddenpower') {\n\t\t\t\tmove.type = 'Ice';\n\t\t\t\tpokemon.addVolatile('refrigerate');\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tduration: 1,\n\t\t\tonBasePowerPriority: 8,\n\t\t\tonBasePower: function(basePower, pokemon, target, move) {\n\t\t\t\treturn this.chainModify([0x14CD, 0x1000]);\n\t\t\t}\n\t\t},\n\t\tid: \"refrigerate\",\n\t\tname: \"Refrigerate\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"regenerator\": {\n\t\tdesc: \"This Pokemon heals 1/3 of its max HP when it switches out.\",\n\t\tshortDesc: \"This Pokemon heals 1/3 of its max HP when it switches out.\",\n\t\tonSwitchOut: function(pokemon) {\n\t\t\tpokemon.heal(pokemon.maxhp/3);\n\t\t},\n\t\tid: \"regenerator\",\n\t\tname: \"Regenerator\",\n\t\trating: 4,\n\t\tnum: 144\n\t},\n\t\"rivalry\": {\n\t\tdesc: \"This Pokemon's attacks do 1.25x damage if their target is the same gender, but 0.75x if their target is the opposite gender.\",\n\t\tshortDesc: \"This Pokemon's attacks do 1.25x on same gender targets; 0.75x on opposite gender.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (attacker.gender && defender.gender) {\n\t\t\t\tif (attacker.gender === defender.gender) {\n\t\t\t\t\tthis.debug('Rivalry boost');\n\t\t\t\t\treturn this.chainModify(1.25);\n\t\t\t\t} else {\n\t\t\t\t\tthis.debug('Rivalry weaken');\n\t\t\t\t\treturn this.chainModify(0.75);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"rivalry\",\n\t\tname: \"Rivalry\",\n\t\trating: 0.5,\n\t\tnum: 79\n\t},\n\t\"rockhead\": {\n\t\tdesc: \"This Pokemon does not receive recoil damage except from Struggle, Life Orb, or crash damage from Jump Kick or High Jump Kick.\",\n\t\tshortDesc: \"This Pokemon does not take recoil damage besides Struggle, Life Orb, crash damage.\",\n\t\tonModifyMove: function(move) {\n\t\t\tdelete move.recoil;\n\t\t},\n\t\tid: \"rockhead\",\n\t\tname: \"Rock Head\",\n\t\trating: 3,\n\t\tnum: 69\n\t},\n\t\"roughskin\": {\n\t\tdesc: \"Causes recoil damage equal to 1/8 of the opponent's max HP if an opponent makes contact.\",\n\t\tshortDesc: \"This Pokemon causes other Pokemon making contact to lose 1/8 of their max HP.\",\n\t\tonAfterDamageOrder: 1,\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (source && source !== target && move && move.isContact) {\n\t\t\t\tthis.damage(source.maxhp/8, source, target);\n\t\t\t}\n\t\t},\n\t\tid: \"roughskin\",\n\t\tname: \"Rough Skin\",\n\t\trating: 3,\n\t\tnum: 24\n\t},\n\t\"runaway\": {\n\t\tdesc: \"Unless this Pokemon is under the effects of a trapping move or ability, such as Mean Look or Shadow Tag, it will escape from wild Pokemon battles without fail.\",\n\t\tshortDesc: \"No competitive use.\",\n\t\tid: \"runaway\",\n\t\tname: \"Run Away\",\n\t\trating: 0,\n\t\tnum: 50\n\t},\n\t\"sandforce\": {\n\t\tdesc: \"Raises the power of this Pokemon's Rock, Ground, and Steel-type moves by 1.3x if the weather is Sandstorm. This Pokemon is also immune to residual Sandstorm damage.\",\n\t\tshortDesc: \"This Pokemon's Rock/Ground/Steel attacks do 1.3x in Sandstorm; immunity to it.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (this.isWeather('sandstorm')) {\n\t\t\t\tif (move.type === 'Rock' || move.type === 'Ground' || move.type === 'Steel') {\n\t\t\t\t\tthis.debug('Sand Force boost');\n\t\t\t\t\treturn this.chainModify([0x14CD, 0x1000]); // The Sand Force modifier is slightly higher than the normal 1.3 (0x14CC)\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'sandstorm') return false;\n\t\t},\n\t\tid: \"sandforce\",\n\t\tname: \"Sand Force\",\n\t\trating: 2,\n\t\tnum: 159\n\t},\n\t\"sandrush\": {\n\t\tdesc: \"This Pokemon's Speed is doubled if the weather is Sandstorm. This Pokemon is also immune to residual Sandstorm damage.\",\n\t\tshortDesc: \"If Sandstorm is active, this Pokemon's Speed is doubled; immunity to Sandstorm.\",\n\t\tonModifySpe: function(speMod, pokemon) {\n\t\t\tif (this.isWeather('sandstorm')) {\n\t\t\t\treturn this.chain(speMod, 2);\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'sandstorm') return false;\n\t\t},\n\t\tid: \"sandrush\",\n\t\tname: \"Sand Rush\",\n\t\trating: 2,\n\t\tnum: 146\n\t},\n\t\"sandstream\": {\n\t\tdesc: \"When this Pokemon enters the battlefield, the weather becomes Sandstorm (for 5 turns normally, or 8 turns while holding Smooth Rock).\",\n\t\tshortDesc: \"On switch-in, the weather becomes Sandstorm.\",\n\t\tonStart: function(source) {\n\t\t\tthis.setWeather('sandstorm');\n\t\t},\n\t\tid: \"sandstream\",\n\t\tname: \"Sand Stream\",\n\t\trating: 4.5,\n\t\tnum: 45\n\t},\n\t\"sandveil\": {\n\t\tdesc: \"This Pokemon's Evasion is boosted by 1.25x if the weather is Sandstorm. This Pokemon is also immune to residual Sandstorm damage.\",\n\t\tshortDesc: \"If Sandstorm is active, this Pokemon's evasion is 1.25x; immunity to Sandstorm.\",\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'sandstorm') return false;\n\t\t},\n\t\tonAccuracy: function(accuracy) {\n\t\t\tif (typeof accuracy !== 'number') return;\n\t\t\tif (this.isWeather('sandstorm')) {\n\t\t\t\tthis.debug('Sand Veil - decreasing accuracy');\n\t\t\t\treturn accuracy * 0.8;\n\t\t\t}\n\t\t},\n\t\tid: \"sandveil\",\n\t\tname: \"Sand Veil\",\n\t\trating: 1.5,\n\t\tnum: 8\n\t},\n\t\"sapsipper\": {\n\t\tdesc: \"This Pokemon is immune to Grass moves. If hit by a Grass move, its Attack is increased by one stage (once for each hit of Bullet Seed). Does not affect Aromatherapy.\",\n\t\tshortDesc: \"This Pokemon's Attack is boosted by 1 if hit by any Grass move; Grass immunity.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Grass') {\n\t\t\t\tif (!this.boost({atk:1})) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"sapsipper\",\n\t\tname: \"Sap Sipper\",\n\t\trating: 3.5,\n\t\tnum: 157\n\t},\n\t\"scrappy\": {\n\t\tdesc: \"This Pokemon has the ability to hit Ghost-type Pokemon with Normal-type and Fighting-type moves. Effectiveness of these moves takes into account the Ghost-type Pokemon's other weaknesses and resistances.\",\n\t\tshortDesc: \"This Pokemon can hit Ghost-types with Normal- and Fighting-type moves.\",\n\t\tonModifyMove: function(move) {\n\t\t\tif (move.type in {'Fighting':1,'Normal':1}) {\n\t\t\t\tmove.affectedByImmunities = false;\n\t\t\t}\n\t\t},\n\t\tid: \"scrappy\",\n\t\tname: \"Scrappy\",\n\t\trating: 3,\n\t\tnum: 113\n\t},\n\t\"serenegrace\": {\n\t\tdesc: \"This Pokemon's moves have their secondary effect chance doubled. For example, if this Pokemon uses Ice Beam, it will have a 20% chance to freeze its target.\",\n\t\tshortDesc: \"This Pokemon's moves have their secondary effect chance doubled.\",\n\t\tonModifyMove: function(move) {\n\t\t\tif (move.secondaries) {\n\t\t\t\tthis.debug('doubling secondary chance');\n\t\t\t\tfor (var i=0; i<move.secondaries.length; i++) {\n\t\t\t\t\tmove.secondaries[i].chance *= 2;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"serenegrace\",\n\t\tname: \"Serene Grace\",\n\t\trating: 4,\n\t\tnum: 32\n\t},\n\t\"shadowtag\": {\n\t\tdesc: \"When this Pokemon enters the field, its non-Ghost-type opponents cannot switch or flee the battle unless they have the same ability, are holding Shed Shell, or they use the moves Baton Pass or U-Turn.\",\n\t\tshortDesc: \"Prevents foes from switching out normally unless they also have this Ability.\",\n\t\tonFoeModifyPokemon: function(pokemon) {\n\t\t\tif (pokemon.ability !== 'shadowtag') {\n\t\t\t\tpokemon.tryTrap();\n\t\t\t}\n\t\t},\n\t\tonFoeMaybeTrapPokemon: function(pokemon) {\n\t\t\tif (pokemon.ability !== 'shadowtag') {\n\t\t\t\tpokemon.maybeTrapped = true;\n\t\t\t}\n\t\t},\n\t\tid: \"shadowtag\",\n\t\tname: \"Shadow Tag\",\n\t\trating: 5,\n\t\tnum: 23\n\t},\n\t\"shedskin\": {\n\t\tdesc: \"At the end of each turn, this Pokemon has a 33% chance to heal itself from poison (including Toxic), paralysis, burn, freeze or sleep (including self-induced Rest).\",\n\t\tshortDesc: \"This Pokemon has a 33% chance to have its status cured at the end of each turn.\",\n\t\tonResidualOrder: 5,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tif (pokemon.hp && pokemon.status && this.random(3) === 0) {\n\t\t\t\tthis.debug('shed skin');\n\t\t\t\tthis.add('-activate', pokemon, 'ability: Shed Skin');\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tid: \"shedskin\",\n\t\tname: \"Shed Skin\",\n\t\trating: 4,\n\t\tnum: 61\n\t},\n\t\"sheerforce\": {\n\t\tdesc: \"Raises the base power of all moves that have any secondary effects by 30%, but the secondary effects are ignored. Some side effects of moves, such as recoil, draining, stat reduction, and switching out usually aren't considered secondary effects. If a Pokemon with Sheer Force is holding a Life Orb and uses an attack that would be boosted by Sheer Force, then the move gains both boosts and the user receives no Life Orb recoil (only if the attack is boosted by Sheer Force).\",\n\t\tshortDesc: \"This Pokemon's attacks with secondary effects do 1.3x damage; nullifies the effects.\",\n\t\tonModifyMove: function(move, pokemon) {\n\t\t\tif (move.secondaries) {\n\t\t\t\tdelete move.secondaries;\n\t\t\t\tmove.negateSecondary = true;\n\t\t\t\tpokemon.addVolatile('sheerforce');\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tduration: 1,\n\t\t\tonBasePowerPriority: 8,\n\t\t\tonBasePower: function(basePower, pokemon, target, move) {\n\t\t\t\treturn this.chainModify([0x14CD, 0x1000]); // The Sheer Force modifier is slightly higher than the normal 1.3 (0x14CC)\n\t\t\t}\n\t\t},\n\t\tid: \"sheerforce\",\n\t\tname: \"Sheer Force\",\n\t\trating: 4,\n\t\tnum: 125\n\t},\n\t\"shellarmor\": {\n\t\tdesc: \"Attacks targeting this Pokemon can't be critical hits.\",\n\t\tshortDesc: \"This Pokemon cannot be struck by a critical hit.\",\n\t\tonCriticalHit: false,\n\t\tid: \"shellarmor\",\n\t\tname: \"Shell Armor\",\n\t\trating: 1,\n\t\tnum: 75\n\t},\n\t\"shielddust\": {\n\t\tdesc: \"If the opponent uses a move that has secondary effects that affect this Pokemon in addition to damage, the move's secondary effects will not trigger (For example, Ice Beam loses its 10% freeze chance).\",\n\t\tshortDesc: \"This Pokemon is not affected by the secondary effect of another Pokemon's attack.\",\n\t\tonTrySecondaryHit: function() {\n\t\t\tthis.debug('Shield Dust prevent secondary');\n\t\t\treturn null;\n\t\t},\n\t\tid: \"shielddust\",\n\t\tname: \"Shield Dust\",\n\t\trating: 2,\n\t\tnum: 19\n\t},\n\t\"simple\": {\n\t\tdesc: \"This Pokemon doubles all of its positive and negative stat modifiers. For example, if this Pokemon uses Curse, its Attack and Defense stats increase by two stages and its Speed stat decreases by two stages.\",\n\t\tshortDesc: \"This Pokemon has its own stat boosts and drops doubled as they happen.\",\n\t\tonBoost: function(boost) {\n\t\t\tfor (var i in boost) {\n\t\t\t\tboost[i] *= 2;\n\t\t\t}\n\t\t},\n\t\tid: \"simple\",\n\t\tname: \"Simple\",\n\t\trating: 4,\n\t\tnum: 86\n\t},\n\t\"skilllink\": {\n\t\tdesc: \"When this Pokemon uses an attack that strikes multiple times in one turn, such as Fury Attack or Spike Cannon, such attacks will always strike for the maximum number of hits.\",\n\t\tshortDesc: \"This Pokemon's multi-hit attacks always hit the maximum number of times.\",\n\t\tonModifyMove: function(move) {\n\t\t\tif (move.multihit && move.multihit.length) {\n\t\t\t\tmove.multihit = move.multihit[1];\n\t\t\t}\n\t\t},\n\t\tid: \"skilllink\",\n\t\tname: \"Skill Link\",\n\t\trating: 4,\n\t\tnum: 92\n\t},\n\t\"slowstart\": {\n\t\tdesc: \"After this Pokemon switches into the battle, its Attack and Speed stats are halved for five turns. For example, if this Pokemon has an Attack stat of 400, its Attack will be 200 until the effects of Slow Start wear off.\",\n\t\tshortDesc: \"On switch-in, this Pokemon's Attack and Speed are halved for 5 turns.\",\n\t\tonStart: function(pokemon) {\n\t\t\tpokemon.addVolatile('slowstart');\n\t\t},\n\t\teffect: {\n\t\t\tduration: 5,\n\t\t\tonStart: function(target) {\n\t\t\t\tthis.add('-start', target, 'Slow Start');\n\t\t\t},\n\t\t\tonModifyAtkPriority: 5,\n\t\t\tonModifyAtk: function(atk, pokemon) {\n\t\t\t\tif (pokemon.ability !== 'slowstart') {\n\t\t\t\t\tpokemon.removeVolatile('slowstart');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn this.chainModify(0.5);\n\t\t\t},\n\t\t\tonModifySpe: function(speMod, pokemon) {\n\t\t\t\tif (pokemon.ability !== 'slowstart') {\n\t\t\t\t\tpokemon.removeVolatile('slowstart');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn this.chain(speMod, 0.5);\n\t\t\t},\n\t\t\tonEnd: function(target) {\n\t\t\t\tthis.add('-end', target, 'Slow Start');\n\t\t\t}\n\t\t},\n\t\tid: \"slowstart\",\n\t\tname: \"Slow Start\",\n\t\trating: -2,\n\t\tnum: 112\n\t},\n\t\"sniper\": {\n\t\tdesc: \"When this Pokemon lands a Critical Hit, the damage is increased to another 1.5x.\",\n\t\tshortDesc: \"If this Pokemon strikes with a critical hit, the damage is increased by 50%\",\n\t\tonModifyDamage: function(damage, source, target, move) {\n\t\t\tif (move.crit) {\n\t\t\t\tthis.debug('Sniper boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"sniper\",\n\t\tname: \"Sniper\",\n\t\trating: 1,\n\t\tnum: 97\n\t},\n\t\"snowcloak\": {\n\t\tdesc: \"This Pokemon's Evasion is boosted by 1.25x if the weather is Hail. This Pokemon is also immune to residual Hail damage.\",\n\t\tshortDesc: \"If Hail is active, this Pokemon's evasion is 1.25x; immunity to Hail.\",\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'hail') return false;\n\t\t},\n\t\tonAccuracy: function(accuracy) {\n\t\t\tif (typeof accuracy !== 'number') return;\n\t\t\tif (this.isWeather('hail')) {\n\t\t\t\tthis.debug('Snow Cloak - decreasing accuracy');\n\t\t\t\treturn accuracy * 0.8;\n\t\t\t}\n\t\t},\n\t\tid: \"snowcloak\",\n\t\tname: \"Snow Cloak\",\n\t\trating: 1,\n\t\tnum: 81\n\t},\n\t\"snowwarning\": {\n\t\tdesc: \"When this Pokemon enters the battlefield, the weather becomes Hail (for 5 turns normally, or 8 turns while holding Icy Rock).\",\n\t\tshortDesc: \"On switch-in, the weather becomes Hail.\",\n\t\tonStart: function(source) {\n\t\t\tthis.setWeather('hail');\n\t\t},\n\t\tid: \"snowwarning\",\n\t\tname: \"Snow Warning\",\n\t\trating: 4,\n\t\tnum: 117\n\t},\n\t\"solarpower\": {\n\t\tdesc: \"If the weather is Sunny Day, this Pokemon's Special Attack is 1.5x, but it loses 1/8 of its max HP at the end of every turn.\",\n\t\tshortDesc: \"If Sunny Day is active, this Pokemon's Sp. Atk is 1.5x and loses 1/8 max HP per turn.\",\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(spa, pokemon) {\n\t\t\tif (this.isWeather('sunnyday')) {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tonWeather: function(target, source, effect) {\n\t\t\tif (effect.id === 'sunnyday') {\n\t\t\t\tthis.damage(target.maxhp/8);\n\t\t\t}\n\t\t},\n\t\tid: \"solarpower\",\n\t\tname: \"Solar Power\",\n\t\trating: 1.5,\n\t\tnum: 94\n\t},\n\t\"solidrock\": {\n\t\tdesc: \"Super-effective attacks only deal 3/4 their usual damage against this Pokemon.\",\n\t\tshortDesc: \"This Pokemon receives 3/4 damage from super effective attacks.\",\n\t\tonSourceModifyDamage: function(damage, source, target, move) {\n\t\t\tif (this.getEffectiveness(move, target) > 0) {\n\t\t\t\tthis.debug('Solid Rock neutralize');\n\t\t\t\treturn this.chainModify(0.75);\n\t\t\t}\n\t\t},\n\t\tid: \"solidrock\",\n\t\tname: \"Solid Rock\",\n\t\trating: 3,\n\t\tnum: 116\n\t},\n\t\"soundproof\": {\n\t\tdesc: \"This Pokemon is immune to the effects of sound-based moves, which are: Bug Buzz, Chatter, Echoed Voice, Grasswhistle, Growl, Heal Bell, Hyper Voice, Metal Sound, Perish Song, Relic Song, Roar, Round, Screech, Sing, Snarl, Snore, Supersonic, and Uproar. This ability doesn't affect Heal Bell.\",\n\t\tshortDesc: \"This Pokemon is immune to sound-based moves, except Heal Bell.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.isSoundBased) {\n\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"soundproof\",\n\t\tname: \"Soundproof\",\n\t\trating: 2,\n\t\tnum: 43\n\t},\n\t\"speedboost\": {\n\t\tdesc: \"At the end of every turn, this Pokemon's Speed increases by one stage (except the turn it switched in).\",\n\t\tshortDesc: \"This Pokemon's Speed is boosted by 1 at the end of each full turn on the field.\",\n\t\tonResidualOrder: 26,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tif (pokemon.activeTurns) {\n\t\t\t\tthis.boost({spe:1});\n\t\t\t}\n\t\t},\n\t\tid: \"speedboost\",\n\t\tname: \"Speed Boost\",\n\t\trating: 4.5,\n\t\tnum: 3\n\t},\n\t\"stall\": {\n\t\tdesc: \"This Pokemon moves last among Pokemon using the same or greater priority moves.\",\n\t\tshortDesc: \"This Pokemon moves last among Pokemon using the same or greater priority moves.\",\n\t\tonModifyPriority: function(priority) {\n\t\t\treturn priority - 0.1;\n\t\t},\n\t\tid: \"stall\",\n\t\tname: \"Stall\",\n\t\trating: -1,\n\t\tnum: 100\n\t},\n\t\"stancechange\": {\n\t\tdesc: \"Only affects Aegislash. If this Pokemon uses a Physical or Special move, it changes to Blade forme. If this Pokemon uses King's Shield, it changes to Shield forme.\",\n\t\tshortDesc: \"The Pokemon changes form depending on how it battles.\",\n\t\tonBeforeMovePriority: 10,\n\t\tonBeforeMove: function(attacker, defender, move) {\n\t\t\tif (attacker.template.baseSpecies !== 'Aegislash') return;\n\t\t\tif (move.category === 'Status' && move.id !== 'kingsshield') return;\n\t\t\tvar targetSpecies = (move.id === 'kingsshield'?'Aegislash':'Aegislash-Blade');\n\t\t\tif (attacker.template.species !== targetSpecies && attacker.formeChange(targetSpecies)) {\n\t\t\t\tthis.add('-formechange', attacker, targetSpecies);\n\t\t\t}\n\t\t},\n\t\tid: \"stancechange\",\n\t\tname: \"Stance Change\",\n\t\trating: 4.5,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"static\": {\n\t\tdesc: \"If an opponent contact attacks this Pokemon, there is a 30% chance that the opponent will become paralyzed.\",\n\t\tshortDesc: \"30% chance of paralyzing a Pokemon making contact with this Pokemon.\",\n\t\tonAfterDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && effect.isContact) {\n\t\t\t\tif (this.random(10) < 3) {\n\t\t\t\t\tsource.trySetStatus('par', target, effect);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"static\",\n\t\tname: \"Static\",\n\t\trating: 2,\n\t\tnum: 9\n\t},\n\t\"steadfast\": {\n\t\tdesc: \"If this Pokemon flinches, its Speed increases by one stage.\",\n\t\tshortDesc: \"If this Pokemon flinches, its Speed is boosted by 1.\",\n\t\tonFlinch: function(pokemon) {\n\t\t\tthis.boost({spe: 1});\n\t\t},\n\t\tid: \"steadfast\",\n\t\tname: \"Steadfast\",\n\t\trating: 1,\n\t\tnum: 80\n\t},\n\t\"stench\": {\n\t\tdesc: \"This Pokemon's damaging moves that don't already have a flinch chance gain a 10% chance to cause flinch.\",\n\t\tshortDesc: \"This Pokemon's attacks without a chance to flinch have a 10% chance to flinch.\",\n\t\tonModifyMove: function(move) {\n\t\t\tif (move.category !== \"Status\") {\n\t\t\t\tthis.debug('Adding Stench flinch');\n\t\t\t\tif (!move.secondaries) move.secondaries = [];\n\t\t\t\tfor (var i=0; i<move.secondaries.length; i++) {\n\t\t\t\t\tif (move.secondaries[i].volatileStatus === 'flinch') return;\n\t\t\t\t}\n\t\t\t\tmove.secondaries.push({\n\t\t\t\t\tchance: 10,\n\t\t\t\t\tvolatileStatus: 'flinch'\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tid: \"stench\",\n\t\tname: \"Stench\",\n\t\trating: 0,\n\t\tnum: 1\n\t},\n\t\"stickyhold\": {\n\t\tdesc: \"This Pokemon cannot lose its held item due to another Pokemon's attack.\",\n\t\tshortDesc: \"This Pokemon cannot lose its held item due to another Pokemon's attack.\",\n\t\tonTakeItem: function(item, pokemon, source) {\n\t\t\tif (source && source !== pokemon) return false;\n\t\t},\n\t\tid: \"stickyhold\",\n\t\tname: \"Sticky Hold\",\n\t\trating: 1,\n\t\tnum: 60\n\t},\n\t\"stormdrain\": {\n\t\tdesc: \"During double battles, this Pokemon draws any single-target Water-type attack to itself. If an opponent uses an Water-type attack that affects multiple Pokemon, those targets will be hit. This ability does not affect Water Hidden Power, Judgment or Weather Ball. The user is immune to Water and its Special Attack is increased one stage when hit by one.\",\n\t\tshortDesc: \"This Pokemon draws Water moves to itself to boost Sp. Atk by 1; Water immunity.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Water') {\n\t\t\t\tif (!this.boost({spa:1})) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tonAnyRedirectTargetPriority: 1,\n\t\tonAnyRedirectTarget: function(target, source, source2, move) {\n\t\t\tif (move.type !== 'Water') return;\n\t\t\tif (this.validTarget(this.effectData.target, source, move.target)) {\n\t\t\t\tmove.accuracy = true;\n\t\t\t\treturn this.effectData.target;\n\t\t\t}\n\t\t},\n\t\tid: \"stormdrain\",\n\t\tname: \"Storm Drain\",\n\t\trating: 3.5,\n\t\tnum: 114\n\t},\n\t\"strongjaw\": {\n\t\tdesc: \"This Pokemon receives a 50% power boost for jaw attacks such as Bite and Crunch.\",\n\t\tshortDesc: \"This Pokemon's bite-based attacks do 1.5x damage.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (move.isBiteAttack) {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"strongjaw\",\n\t\tname: \"Strong Jaw\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"sturdy\": {\n\t\tdesc: \"This Pokemon is immune to OHKO moves, and will survive with 1 HP if hit by an attack which would KO it while at full health.\",\n\t\tshortDesc: \"If this Pokemon is at full HP, it lives one hit with at least 1HP. OHKO moves fail on it.\",\n\t\tonDamagePriority: -100,\n\t\tonDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && effect.ohko) {\n\t\t\t\tthis.add('-activate',target,'Sturdy');\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif (target.hp === target.maxhp && damage >= target.hp && effect && effect.effectType === 'Move') {\n\t\t\t\tthis.add('-activate',target,'Sturdy');\n\t\t\t\treturn target.hp - 1;\n\t\t\t}\n\t\t},\n\t\tid: \"sturdy\",\n\t\tname: \"Sturdy\",\n\t\trating: 3,\n\t\tnum: 5\n\t},\n\t\"suctioncups\": {\n\t\tdesc: \"This Pokemon cannot be forced to switch out by another Pokemon's attack or item.\",\n\t\tshortDesc: \"This Pokemon cannot be forced to switch out by another Pokemon's attack or item.\",\n\t\tonDragOutPriority: 1,\n\t\tonDragOut: function(pokemon) {\n\t\t\tthis.add('-activate', pokemon, 'ability: Suction Cups');\n\t\t\treturn null;\n\t\t},\n\t\tid: \"suctioncups\",\n\t\tname: \"Suction Cups\",\n\t\trating: 2.5,\n\t\tnum: 21\n\t},\n\t\"superluck\": {\n\t\tdesc: \"This Pokemon's critical hit ratio is boosted by 1.\",\n\t\tshortDesc: \"This Pokemon's critical hit ratio is boosted by 1.\",\n\t\tonModifyMove: function(move) {\n\t\t\tmove.critRatio++;\n\t\t},\n\t\tid: \"superluck\",\n\t\tname: \"Super Luck\",\n\t\trating: 1,\n\t\tnum: 105\n\t},\n\t\"swarm\": {\n\t\tdesc: \"When its health reaches 1/3 or less of its max HP, this Pokemon's Bug-type attacks do 1.5x damage.\",\n\t\tshortDesc: \"When this Pokemon has 1/3 or less of its max HP, its Bug attacks do 1.5x damage.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Bug' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Swarm boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Bug' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Swarm boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"swarm\",\n\t\tname: \"Swarm\",\n\t\trating: 2,\n\t\tnum: 68\n\t},\n\t\"sweetveil\": {\n\t\tdesc: \"Prevents allies from being put to Sleep.\",\n\t\tshortDesc: \"Prevents allies from being put to Sleep.\",\n\t\tid: \"sweetveil\",\n\t\tname: \"Sweet Veil\",\n\t\tonAllySetStatus: function(status, target, source, effect) {\n\t\t\tif (status.id === 'slp') {\n\t\t\t\tthis.debug('Sweet Veil interrupts sleep');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tonAllyTryHit: function(target, source, move) {\n\t\t\tif (move && move.id === 'yawn') {\n\t\t\t\tthis.debug('Sweet Veil blocking yawn');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\trating: 0,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"swiftswim\": {\n\t\tdesc: \"If the weather is Rain Dance, this Pokemon's Speed is doubled.\",\n\t\tshortDesc: \"If the weather is Rain Dance, this Pokemon's Speed is doubled.\",\n\t\tonModifySpe: function(speMod, pokemon) {\n\t\t\tif (this.isWeather('raindance')) {\n\t\t\t\treturn this.chain(speMod, 2);\n\t\t\t}\n\t\t},\n\t\tid: \"swiftswim\",\n\t\tname: \"Swift Swim\",\n\t\trating: 2,\n\t\tnum: 33\n\t},\n\t\"symbiosis\": {\n\t\tdesc: \"This Pokemon immediately passes its item to an ally after their item is consumed.\",\n\t\tshortDesc: \"This Pokemon passes its item to an ally after their item is consumed.\",\n\t\tonAllyAfterUseItem: function(item, pokemon) {\n\t\t\tvar sourceItem = this.effectData.target.takeItem();\n\t\t\tif (!sourceItem) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (pokemon.setItem(sourceItem)) {\n\t\t\t\tthis.add('-activate', pokemon, 'ability: Symbiosis', sourceItem, '[of] '+this.effectData.target);\n\t\t\t}\n\t\t},\n\t\tid: \"symbiosis\",\n\t\tname: \"Symbiosis\",\n\t\trating: 0,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"synchronize\": {\n\t\tdesc: \"If an opponent burns, poisons or paralyzes this Pokemon, it receives the same condition.\",\n\t\tshortDesc: \"If another Pokemon burns/poisons/paralyzes this Pokemon, it also gets that status.\",\n\t\tonAfterSetStatus: function(status, target, source) {\n\t\t\tif (!source || source === target) return;\n\t\t\tif (status.id === 'slp' || status.id === 'frz') return;\n\t\t\tsource.trySetStatus(status, target);\n\t\t},\n\t\tid: \"synchronize\",\n\t\tname: \"Synchronize\",\n\t\trating: 3,\n\t\tnum: 28\n\t},\n\t\"tangledfeet\": {\n\t\tdesc: \"When this Pokemon is confused, attacks targeting it have a 50% chance of missing.\",\n\t\tshortDesc: \"This Pokemon's evasion is doubled as long as it is confused.\",\n\t\tonAccuracy: function(accuracy, target) {\n\t\t\tif (typeof accuracy !== 'number') return;\n\t\t\tif (target && target.volatiles['confusion']) {\n\t\t\t\tthis.debug('Tangled Feet - decreasing accuracy');\n\t\t\t\treturn accuracy * 0.5;\n\t\t\t}\n\t\t},\n\t\tid: \"tangledfeet\",\n\t\tname: \"Tangled Feet\",\n\t\trating: 1,\n\t\tnum: 77\n\t},\n\t\"technician\": {\n\t\tdesc: \"When this Pokemon uses an attack that has 60 Base Power or less (including Struggle), the move's Base Power receives a 50% boost. For example, a move with 60 Base Power effectively becomes a move with 90 Base Power.\",\n\t\tshortDesc: \"This Pokemon's attacks of 60 Base Power or less do 1.5x damage. Includes Struggle.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (basePower <= 60) {\n\t\t\t\tthis.debug('Technician boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"technician\",\n\t\tname: \"Technician\",\n\t\trating: 4,\n\t\tnum: 101\n\t},\n\t\"telepathy\": {\n\t\tdesc: \"This Pokemon will not take damage from its allies' spread moves in double and triple battles.\",\n\t\tshortDesc: \"This Pokemon does not take damage from its allies' attacks.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target.side === source.side && move.category !== 'Status') {\n\t\t\t\tthis.add('-activate', target, 'ability: Telepathy');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"telepathy\",\n\t\tname: \"Telepathy\",\n\t\trating: 0,\n\t\tnum: 140\n\t},\n\t\"teravolt\": {\n\t\tdesc: \"When this Pokemon becomes active, it nullifies the abilities of opposing active Pokemon that hinder this Pokemon's attacks. These abilities include Battle Armor, Clear Body, Damp, Dry Skin, Filter, Flash Fire, Flower Gift, Heatproof, Hyper Cutter, Immunity, Inner Focus, Insomnia, Keen Eye, Leaf Guard, Levitate, Lightningrod, Limber, Magma Armor, Marvel Scale, Motor Drive, Oblivious, Own Tempo, Sand Veil, Shell Armor, Shield Dust, Simple, Snow Cloak, Solid Rock, Soundproof, Sticky Hold, Storm Drain, Sturdy, Suction Cups, Tangled Feet, Thick Fat, Unaware, Vital Spirit, Volt Absorb, Water Absorb, Water Veil, White Smoke and Wonder Guard.\",\n\t\tshortDesc: \"This Pokemon's moves ignore the target's Ability if it could modify the effectiveness.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability', pokemon, 'Teravolt');\n\t\t},\n\t\tonAllyModifyPokemon: function(pokemon) {\n\t\t\tif (this.activePokemon === this.effectData.target && pokemon !== this.activePokemon) {\n\t\t\t\tpokemon.ignore['Ability'] = 'A';\n\t\t\t}\n\t\t},\n\t\tonFoeModifyPokemon: function(pokemon) {\n\t\t\tif (this.activePokemon === this.effectData.target) {\n\t\t\t\tpokemon.ignore['Ability'] = 'A';\n\t\t\t}\n\t\t},\n\t\tid: \"teravolt\",\n\t\tname: \"Teravolt\",\n\t\trating: 3,\n\t\tnum: 164\n\t},\n\t\"thickfat\": {\n\t\tdesc: \"This Pokemon receives half damage from Ice-type and Fire-type attacks.\",\n\t\tshortDesc: \"This Pokemon receives half damage from Fire- and Ice-type attacks.\",\n\t\tonModifyAtkPriority: 6,\n\t\tonSourceModifyAtk: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Ice' || move.type === 'Fire') {\n\t\t\t\tthis.debug('Thick Fat weaken');\n\t\t\t\treturn this.chainModify(0.5);\n\t\t\t}\n\t\t},\n\t\tonModifySpAPriority: 5,\n\t\tonSourceModifySpA: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Ice' || move.type === 'Fire') {\n\t\t\t\tthis.debug('Thick Fat weaken');\n\t\t\t\treturn this.chainModify(0.5);\n\t\t\t}\n\t\t},\n\t\tid: \"thickfat\",\n\t\tname: \"Thick Fat\",\n\t\trating: 3,\n\t\tnum: 47\n\t},\n\t\"tintedlens\": {\n\t\tdesc: \"This Pokemon's attacks that are not very effective on a target do double damage.\",\n\t\tshortDesc: \"This Pokemon's attacks that are not very effective on a target do double damage.\",\n\t\tonModifyDamage: function(damage, source, target, move) {\n\t\t\tif (this.getEffectiveness(move, target) < 0) {\n\t\t\t\tthis.debug('Tinted Lens boost');\n\t\t\t\treturn this.chainModify(2);\n\t\t\t}\n\t\t},\n\t\tid: \"tintedlens\",\n\t\tname: \"Tinted Lens\",\n\t\trating: 4,\n\t\tnum: 110\n\t},\n\t\"torrent\": {\n\t\tdesc: \"When its health reaches 1/3 or less of its max HP, this Pokemon's Water-type attacks do 1.5x damage.\",\n\t\tshortDesc: \"When this Pokemon has 1/3 or less of its max HP, its Water attacks do 1.5x damage.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Water' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Torrent boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Water' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Torrent boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"torrent\",\n\t\tname: \"Torrent\",\n\t\trating: 2,\n\t\tnum: 67\n\t},\n\t\"toxicboost\": {\n\t\tdesc: \"When this Pokemon is poisoned, its physical attacks do 1.5x damage.\",\n\t\tshortDesc: \"When this Pokemon is poisoned, its physical attacks do 1.5x damage.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif ((attacker.status === 'psn' || attacker.status === 'tox') && move.category === 'Physical') {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"toxicboost\",\n\t\tname: \"Toxic Boost\",\n\t\trating: 3,\n\t\tnum: 137\n\t},\n\t\"toughclaws\": {\n\t\tdesc: \"This Pokemon's contact attacks do 1.33x damage.\",\n\t\tshortDesc: \"This Pokemon's contact attacks do 33% more damage.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (move.isContact) {\n\t\t\t\treturn this.chainModify(1.33);\n\t\t\t}\n\t\t},\n\t\tid: \"toughclaws\",\n\t\tname: \"Tough Claws\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"trace\": {\n\t\tdesc: \"When this Pokemon enters the field, it temporarily copies an opponent's ability. This ability remains with this Pokemon until it leaves the field.\",\n\t\tshortDesc: \"On switch-in, or when it can, this Pokemon copies a random adjacent foe's Ability.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tvar target = pokemon.side.foe.randomActive();\n\t\t\tif (!target) return;\n\t\t\tvar ability = this.getAbility(target.ability);\n\t\t\tvar bannedAbilities = {flowergift:1, forecast:1, illusion:1, imposter:1, multitype:1, stancechange:1, trace:1, zenmode:1};\n\t\t\tif (bannedAbilities[target.ability]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.add('-ability',pokemon, ability,'[from] ability: Trace','[of] '+target);\n\t\t\tpokemon.setAbility(ability);\n\t\t},\n\t\tid: \"trace\",\n\t\tname: \"Trace\",\n\t\trating: 3.5,\n\t\tnum: 36\n\t},\n\t\"truant\": {\n\t\tdesc: \"After this Pokemon is switched into battle, it skips every other turn.\",\n\t\tshortDesc: \"This Pokemon skips every other turn instead of using a move.\",\n\t\tonBeforeMove: function(pokemon, target, move) {\n\t\t\tif (pokemon.removeVolatile('truant')) {\n\t\t\t\tthis.add('cant',pokemon,'ability: Truant', move);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tpokemon.addVolatile('truant');\n\t\t},\n\t\tonBeforeMovePriority: 99,\n\t\teffect: {\n\t\t\tduration: 2\n\t\t},\n\t\tid: \"truant\",\n\t\tname: \"Truant\",\n\t\trating: -2,\n\t\tnum: 54\n\t},\n\t\"turboblaze\": {\n\t\tdesc: \"When this Pokemon becomes active, it nullifies the abilities of opposing active Pokemon that hinder this Pokemon's attacks. These abilities include Battle Armor, Clear Body, Damp, Dry Skin, Filter, Flash Fire, Flower Gift, Heatproof, Hyper Cutter, Immunity, Inner Focus, Insomnia, Keen Eye, Leaf Guard, Levitate, Lightningrod, Limber, Magma Armor, Marvel Scale, Motor Drive, Oblivious, Own Tempo, Sand Veil, Shell Armor, Shield Dust, Simple, Snow Cloak, Solid Rock, Soundproof, Sticky Hold, Storm Drain, Sturdy, Suction Cups, Tangled Feet, Thick Fat, Unaware, Vital Spirit, Volt Absorb, Water Absorb, Water Veil, White Smoke and Wonder Guard.\",\n\t\tshortDesc: \"This Pokemon's moves ignore the target's Ability if it could modify the effectiveness.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability', pokemon, 'Turboblaze');\n\t\t},\n\t\tonAllyModifyPokemon: function(pokemon) {\n\t\t\tif (this.activePokemon === this.effectData.target && pokemon !== this.activePokemon) {\n\t\t\t\tpokemon.ignore['Ability'] = 'A';\n\t\t\t}\n\t\t},\n\t\tonFoeModifyPokemon: function(pokemon) {\n\t\t\tif (this.activePokemon === this.effectData.target) {\n\t\t\t\tpokemon.ignore['Ability'] = 'A';\n\t\t\t}\n\t\t},\n\t\tid: \"turboblaze\",\n\t\tname: \"Turboblaze\",\n\t\trating: 3,\n\t\tnum: 163\n\t},\n\t\"unaware\": {\n\t\tdesc: \"This Pokemon ignores an opponent's stat boosts for Attack, Defense, Special Attack and Special Defense. These boosts will still affect Base Power calculation for Punishment and Stored Power.\",\n\t\tshortDesc: \"This Pokemon ignores other Pokemon's stat changes when taking or doing damage.\",\n\t\tid: \"unaware\",\n\t\tname: \"Unaware\",\n\t\tonModifyMove: function(move, user, target) {\n\t\t\tmove.ignoreEvasion = true;\n\t\t\tmove.ignoreDefensive = true;\n\t\t},\n\t\tonSourceModifyMove: function(move, user, target) {\n\t\t\tif (user.ability === 'moldbreaker' || user.ability === 'turboblaze' || user.ability === 'teravolt') return;\n\t\t\tmove.ignoreAccuracy = true;\n\t\t\tmove.ignoreOffensive = true;\n\t\t},\n\t\trating: 3,\n\t\tnum: 109\n\t},\n\t\"unburden\": {\n\t\tdesc: \"Doubles this Pokemon's Speed if it loses its held item (such as by eating Berries, using Gems, or via Thief, Knock Off, etc).\",\n\t\tshortDesc: \"Speed is doubled on held item loss; boost is lost if it switches, gets new item/Ability.\",\n\t\tonUseItem: function(item, pokemon) {\n\t\t\tpokemon.addVolatile('unburden');\n\t\t},\n\t\tonTakeItem: function(item, pokemon) {\n\t\t\tpokemon.addVolatile('unburden');\n\t\t},\n\t\teffect: {\n\t\t\tonModifySpe: function(speMod, pokemon) {\n\t\t\t\tif (pokemon.ability !== 'unburden') {\n\t\t\t\t\tpokemon.removeVolatile('unburden');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!pokemon.item) {\n\t\t\t\t\treturn this.chain(speMod, 2);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"unburden\",\n\t\tname: \"Unburden\",\n\t\trating: 3.5,\n\t\tnum: 84\n\t},\n\t\"unnerve\": {\n\t\tdesc: \"While this Pokemon is active, prevents opposing Pokemon from using their Berries.\",\n\t\tshortDesc: \"While this Pokemon is active, prevents opposing Pokemon from using their Berries.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability',pokemon,'Unnerve',pokemon.side.foe);\n\t\t},\n\t\tonFoeEatItem: false,\n\t\tid: \"unnerve\",\n\t\tname: \"Unnerve\",\n\t\trating: 1,\n\t\tnum: 127\n\t},\n\t\"victorystar\": {\n\t\tdesc: \"Raises every friendly Pokemon's Accuracy, including this Pokemon's, by 10% (multiplied).\",\n\t\tshortDesc: \"This Pokemon and its allies' moves have their accuracy boosted to 1.1x.\",\n\t\tonAllyModifyMove: function(move) {\n\t\t\tif (typeof move.accuracy === 'number') {\n\t\t\t\tmove.accuracy *= 1.1;\n\t\t\t}\n\t\t},\n\t\tid: \"victorystar\",\n\t\tname: \"Victory Star\",\n\t\trating: 2,\n\t\tnum: 162\n\t},\n\t\"vitalspirit\": {\n\t\tdesc: \"This Pokemon cannot fall asleep (Rest will fail if it tries to use it). Gaining this Ability while asleep cures it.\",\n\t\tshortDesc: \"This Pokemon cannot fall asleep. Gaining this Ability while asleep cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.status === 'slp') {\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type) {\n\t\t\tif (type === 'slp') return false;\n\t\t},\n\t\tid: \"vitalspirit\",\n\t\tname: \"Vital Spirit\",\n\t\trating: 2,\n\t\tnum: 72\n\t},\n\t\"voltabsorb\": {\n\t\tdesc: \"This Pokemon is immune to Electric moves. If hit by an Electric move, it recovers 25% of its max HP.\",\n\t\tshortDesc: \"This Pokemon heals 1/4 of its max HP when hit by Electric moves; Electric immunity.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Electric') {\n\t\t\t\tif (!this.heal(target.maxhp/4)) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"voltabsorb\",\n\t\tname: \"Volt Absorb\",\n\t\trating: 3.5,\n\t\tnum: 10\n\t},\n\t\"waterabsorb\": {\n\t\tdesc: \"This Pokemon is immune to Water moves. If hit by an Water move, it recovers 25% of its max HP.\",\n\t\tshortDesc: \"This Pokemon heals 1/4 of its max HP when hit by Water moves; Water immunity.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Water') {\n\t\t\t\tif (!this.heal(target.maxhp/4)) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"waterabsorb\",\n\t\tname: \"Water Absorb\",\n\t\trating: 3.5,\n\t\tnum: 11\n\t},\n\t\"waterveil\": {\n\t\tdesc: \"This Pokemon cannot become burned. Gaining this Ability while burned cures it.\",\n\t\tshortDesc: \"This Pokemon cannot be burned. Gaining this Ability while burned cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.status === 'brn') {\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'brn') return false;\n\t\t},\n\t\tid: \"waterveil\",\n\t\tname: \"Water Veil\",\n\t\trating: 1.5,\n\t\tnum: 41\n\t},\n\t\"weakarmor\": {\n\t\tdesc: \"Causes physical moves to lower the Pokemon's Defense and increase its Speed stat by one stage.\",\n\t\tshortDesc: \"If a physical attack hits this Pokemon, Defense is lowered 1 and Speed is boosted 1.\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (move.category === 'Physical') {\n\t\t\t\tthis.boost({spe:1, def:-1});\n\t\t\t}\n\t\t},\n\t\tid: \"weakarmor\",\n\t\tname: \"Weak Armor\",\n\t\trating: 0,\n\t\tnum: 133\n\t},\n\t\"whitesmoke\": {\n\t\tdesc: \"Opponents cannot reduce this Pokemon's stats; they can, however, modify stat changes with Power Swap, Guard Swap and Heart Swap and inflict stat boosts with Swagger and Flatter. This ability does not prevent self-inflicted stat reductions. [Field Effect]\ If this Pokemon is in the lead spot, the rate of wild Pokemon battles decreases by 50%.\",\n\t\tshortDesc: \"Prevents other Pokemon from lowering this Pokemon's stat stages.\",\n\t\tonBoost: function(boost, target, source, effect) {\n\t\t\tif (source && target === source) return;\n\t\t\tvar showMsg = false;\n\t\t\tfor (var i in boost) {\n\t\t\t\tif (boost[i] < 0) {\n\t\t\t\t\tdelete boost[i];\n\t\t\t\t\tshowMsg = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (showMsg && !effect.secondaries) this.add(\"-fail\", target, \"unboost\", \"[from] ability: White Smoke\", \"[of] \"+target);\n\t\t},\n\t\tid: \"whitesmoke\",\n\t\tname: \"White Smoke\",\n\t\trating: 2,\n\t\tnum: 73\n\t},\n\t\"wonderguard\": {\n\t\tdesc: \"This Pokemon only receives damage from attacks belonging to types that cause Super Effective to this Pokemon. Wonder Guard does not protect a Pokemon from status ailments (burn, freeze, paralysis, poison, sleep, Toxic or any of their side effects or damage), recoil damage nor the moves Beat Up, Bide, Doom Desire, Fire Fang, Future Sight, Hail, Leech Seed, Sandstorm, Spikes, Stealth Rock and Struggle. Wonder Guard cannot be Skill Swapped nor Role Played. Trace, however, does copy Wonder Guard.\",\n\t\tshortDesc: \"This Pokemon can only be damaged by super effective moves and indirect damage.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target === source || move.category === 'Status' || move.type === '???' || move.id === 'struggle') return;\n\t\t\tthis.debug('Wonder Guard immunity: '+move.id);\n\t\t\tif (this.getEffectiveness(move, target) <= 0) {\n\t\t\t\tthis.add('-activate', target, 'ability: Wonder Guard');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"wonderguard\",\n\t\tname: \"Wonder Guard\",\n\t\trating: 5,\n\t\tnum: 25\n\t},\n\t\"wonderskin\": {\n\t\tdesc: \"Causes the chance of a status move working to be halved. It does not affect moves that inflict status as a secondary effect like Thunder's chance to paralyze.\",\n\t\tshortDesc: \"All status moves with a set % accuracy are 50% accurate if used on this Pokemon.\",\n\t\tonAccuracyPriority: 10,\n\t\tonAccuracy: function(accuracy, target, source, move) {\n\t\t\tif (move.category === 'Status' && typeof move.accuracy === 'number') {\n\t\t\t\tthis.debug('Wonder Skin - setting accuracy to 50');\n\t\t\t\treturn 50;\n\t\t\t}\n\t\t},\n\t\tid: \"wonderskin\",\n\t\tname: \"Wonder Skin\",\n\t\trating: 3,\n\t\tnum: 147\n\t},\n\t\"zenmode\": {\n\t\tdesc: \"When Darmanitan's HP drops to below half, it will enter Zen Mode at the end of the turn. If it loses its ability, or recovers HP to above half while in Zen mode, it will change back. This ability only works on Darmanitan, even if it is copied by Role Play, Entrainment, or swapped with Skill Swap.\",\n\t\tshortDesc: \"If this Pokemon is Darmanitan, it changes to Zen Mode whenever it is below half HP.\",\n\t\tonResidualOrder: 27,\n\t\tonResidual: function(pokemon) {\n\t\t\tif (pokemon.baseTemplate.species !== 'Darmanitan') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (pokemon.hp <= pokemon.maxhp/2 && pokemon.template.speciesid==='darmanitan'){\n\t\t\t\tpokemon.addVolatile('zenmode');\n\t\t\t} else if (pokemon.hp > pokemon.maxhp/2 && pokemon.template.speciesid==='darmanitanzen') {\n\t\t\t\tpokemon.removeVolatile('zenmode');\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tonStart: function(pokemon) {\n\t\t\t\tif (pokemon.formeChange('Darmanitan-Zen')) {\n\t\t\t\t\tthis.add('-formechange', pokemon, 'Darmanitan-Zen');\n\t\t\t\t\tthis.add('-message', 'Zen Mode triggered! (placeholder)');\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t\tonEnd: function(pokemon) {\n\t\t\t\tif (pokemon.formeChange('Darmanitan')) {\n\t\t\t\t\tthis.add('-formechange', pokemon, 'Darmanitan');\n\t\t\t\t\tthis.add('-message', 'Zen Mode ended! (placeholder)');\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t\tonUpdate: function(pokemon) {\n\t\t\t\tif (pokemon.ability !== 'zenmode') {\n\t\t\t\t\tpokemon.transformed = false;\n\t\t\t\t\tpokemon.removeVolatile('zenmode');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"zenmode\",\n\t\tname: \"Zen Mode\",\n\t\trating: -1,\n\t\tnum: 161\n\t},\n\n\t// CAP\n\t\"mountaineer\": {\n\t\tdesc: \"This Pokémon avoids all Rock-type attacks and hazards when switching in.\",\n\t\tshortDesc: \"On switch-in, this Pokemon avoids all Rock-type attacks and Stealth Rock.\",\n\t\tonDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && effect.id === 'stealthrock') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, target) {\n\t\t\tif (type === 'Rock' && !target.activeTurns) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tid: \"mountaineer\",\n\t\tisNonstandard: true,\n\t\tname: \"Mountaineer\",\n\t\trating: 3.5,\n\t\tnum: -2\n\t},\n\t\"rebound\": {\n\t\tdesc: \"It can reflect the effect of status moves when switching in.\",\n\t\tshortDesc: \"On switch-in, this Pokemon blocks certain status moves and uses the move itself.\",\n\t\tid: \"rebound\",\n\t\tisNonstandard: true,\n\t\tname: \"Rebound\",\n\t\tonTryHitPriority: 1,\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (this.effectData.target.activeTurns) return;\n\n\t\t\tif (target === source) return;\n\t\t\tif (move.hasBounced) return;\n\t\t\tif (typeof move.isBounceable === 'undefined') {\n\t\t\t\tmove.isBounceable = !!(move.category === 'Status' && (move.status || move.boosts || move.volatileStatus === 'confusion' || move.forceSwitch));\n\t\t\t}\n\t\t\tif (move.isBounceable) {\n\t\t\t\tvar newMove = this.getMoveCopy(move.id);\n\t\t\t\tnewMove.hasBounced = true;\n\t\t\t\tthis.useMove(newMove, target, source);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tonAllyTryHitSide: function(target, source, move) {\n\t\t\tif (this.effectData.target.activeTurns) return;\n\n\t\t\tif (target.side === source.side) return;\n\t\t\tif (move.hasBounced) return;\n\t\t\tif (typeof move.isBounceable === 'undefined') {\n\t\t\t\tmove.isBounceable = !!(move.category === 'Status' && (move.status || move.boosts || move.volatileStatus === 'confusion' || move.forceSwitch));\n\t\t\t}\n\t\t\tif (move.isBounceable) {\n\t\t\t\tvar newMove = this.getMoveCopy(move.id);\n\t\t\t\tnewMove.hasBounced = true;\n\t\t\t\tthis.useMove(newMove, target, source);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tduration: 1\n\t\t},\n\t\trating: 4,\n\t\tnum: -3\n\t},\n\t\"persistent\": {\n\t\tdesc: \"Increases the duration of many field effects by two turns when used by this Pokémon.\",\n\t\tshortDesc: \"The duration of certain field effects is increased by 2 turns if used by this Pokemon.\",\n\t\tid: \"persistent\",\n\t\tisNonstandard: true,\n\t\tname: \"Persistent\",\n\t\t// implemented in the corresponding move\n\t\trating: 4,\n\t\tnum: -4\n\t}\n};\n",
                "new_contents":"/*\n\nRatings and how they work:\n\n-2: Extremely detrimental\n\t  The sort of ability that relegates Pokemon with Uber-level BSTs\n\t  into NU.\n\tex. Slow Start, Truant\n\n-1: Detrimental\n\t  An ability that does more harm than good.\n\tex. Defeatist, Normalize\n\n 0: Useless\n\t  An ability with no net effect on a Pokemon during a battle.\n\tex. Pickup, Illuminate\n\n 1: Ineffective\n\t  An ability that has a minimal effect. Should never be chosen over\n\t  any other ability.\n\tex. Damp, Shell Armor\n\n 2: Situationally useful\n\t  An ability that can be useful in certain situations.\n\tex. Blaze, Insomnia\n\n 3: Useful\n\t  An ability that is generally useful.\n\tex. Volt Absorb, Iron Fist\n\n 4: Very useful\n\t  One of the most popular abilities. The difference between 3 and 4\n\t  can be ambiguous.\n\tex. Technician, Protean\n\n 5: Essential\n\t  The sort of ability that defines metagames.\n\tex. Drizzle, Shadow Tag\n\n*/\n\nexports.BattleAbilities = {\n\t\"adaptability\": {\n\t\tdesc: \"This Pokemon's attacks that receive STAB (Same Type Attack Bonus) are increased from 50% to 100%.\",\n\t\tshortDesc: \"This Pokemon's same-type attack bonus (STAB) is increased from 1.5x to 2x.\",\n\t\tonModifyMove: function(move) {\n\t\t\tmove.stab = 2;\n\t\t},\n\t\tid: \"adaptability\",\n\t\tname: \"Adaptability\",\n\t\trating: 3.5,\n\t\tnum: 91\n\t},\n\t\"aftermath\": {\n\t\tdesc: \"If a contact move knocks out this Pokemon, the opponent receives damage equal to one-fourth of its max HP.\",\n\t\tshortDesc: \"If this Pokemon is KOed with a contact move, that move's user loses 1/4 its max HP.\",\n\t\tid: \"aftermath\",\n\t\tname: \"Aftermath\",\n\t\tonFaint: function(target, source, effect) {\n\t\t\tif (effect && effect.effectType === 'Move' && effect.isContact && source) {\n\t\t\t\tthis.damage(source.maxhp/4, source, target);\n\t\t\t}\n\t\t},\n\t\trating: 3,\n\t\tnum: 106\n\t},\n\t\"aerilate\": {\n\t\tdesc: \"Turns all of this Pokemon's Normal-typed attacks into Flying-type and deal 1.3x damage. Does not affect Hidden Power.\",\n\t\tshortDesc: \"This Pokemon's Normal moves become Flying-type and do 1.3x damage.\",\n\t\tonModifyMove: function(move, pokemon) {\n\t\t\tif (move.type === 'Normal' && move.id !== 'hiddenpower') {\n\t\t\t\tmove.type = 'Flying';\n\t\t\t\tpokemon.addVolatile('aerilate');\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tduration: 1,\n\t\t\tonBasePowerPriority: 8,\n\t\t\tonBasePower: function(basePower, pokemon, target, move) {\n\t\t\t\treturn this.chainModify([0x14CD, 0x1000]);\n\t\t\t}\n\t\t},\n\t\tid: \"aerilate\",\n\t\tname: \"Aerilate\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"airlock\": {\n\t\tdesc: \"While this Pokemon is active, all weather conditions and their effects are disabled.\",\n\t\tshortDesc: \"While this Pokemon is active, all weather conditions and their effects are disabled.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-message', 'The effects of weather disappeared. (placeholder)');\n\t\t},\n\t\tonAnyModifyPokemon: function(pokemon) {\n\t\t\tpokemon.ignore['WeatherTarget'] = true;\n\t\t},\n\t\tonAnyTryWeather: false,\n\t\tid: \"airlock\",\n\t\tname: \"Air Lock\",\n\t\trating: 3,\n\t\tnum: 76\n\t},\n\t\"analytic\": {\n\t\tdesc: \"If the user moves last, the power of that move is increased by 30%.\",\n\t\tshortDesc: \"This Pokemon's attacks do 1.3x damage if it is the last to move in a turn.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (!this.willMove(defender)) {\n\t\t\t\tthis.debug('Analytic boost');\n\t\t\t\treturn this.chainModify([0x14CD, 0x1000]); // The Analytic modifier is slightly higher than the normal 1.3 (0x14CC)\n\t\t\t}\n\t\t},\n\t\tid: \"analytic\",\n\t\tname: \"Analytic\",\n\t\trating: 1,\n\t\tnum: 148\n\t},\n\t\"angerpoint\": {\n\t\tdesc: \"If this Pokemon, or its Substitute, is struck by a Critical Hit, its Attack is boosted to six stages.\",\n\t\tshortDesc: \"If this Pokemon (not a Substitute) is hit by a critical hit, its Attack is boosted by 12.\",\n\t\tonCriticalHit: function(target) {\n\t\t\tif (!target.volatiles['substitute']) {\n\t\t\t\ttarget.setBoost({atk: 6});\n\t\t\t\tthis.add('-setboost',target,'atk',12,'[from] ability: Anger Point');\n\t\t\t}\n\t\t},\n\t\tid: \"angerpoint\",\n\t\tname: \"Anger Point\",\n\t\trating: 2,\n\t\tnum: 83\n\t},\n\t\"anticipation\": {\n\t\tdesc: \"A warning is displayed if an opposing Pokemon has the moves Fissure, Guillotine, Horn Drill, Sheer Cold, or any attacking move from a type that is considered super effective against this Pokemon (including Counter, Mirror Coat, and Metal Burst). Hidden Power, Judgment, Natural Gift and Weather Ball are considered Normal-type moves. Flying Press is considered a Fighting-type move.\",\n\t\tshortDesc: \"On switch-in, this Pokemon shudders if any foe has a super effective or OHKO move.\",\n\t\tonStart: function(pokemon) {\n\t\t\tvar targets = pokemon.side.foe.active;\n\t\t\tfor (var i=0; i<targets.length; i++) {\n\t\t\t\tif (!targets[i] || targets[i].fainted) continue;\n\t\t\t\tfor (var j=0; j<targets[i].moveset.length; j++) {\n\t\t\t\t\tvar move = this.getMove(targets[i].moveset[j].move);\n\t\t\t\t\tif (move.category !== 'Status' && (this.getImmunity(move.type, pokemon) && this.getEffectiveness(move.type, pokemon) > 0 || move.ohko)) {\n\t\t\t\t\t\tthis.add('-message', pokemon.name+' shuddered! (placeholder)');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"anticipation\",\n\t\tname: \"Anticipation\",\n\t\trating: 1,\n\t\tnum: 107\n\t},\n\t\"arenatrap\": {\n\t\tdesc: \"When this Pokemon enters the field, its opponents cannot switch or flee the battle unless they are part Flying-type, have the Levitate ability, are holding Shed Shell, or they use the moves Baton Pass or U-Turn. Flying-type and Levitate Pokemon cannot escape if they are holding Iron Ball or Gravity is in effect. Levitate Pokemon also cannot escape if their ability is disabled through other means, such as Skill Swap or Gastro Acid.\",\n\t\tshortDesc: \"Prevents foes from switching out normally unless they have immunity to Ground.\",\n\t\tonFoeModifyPokemon: function(pokemon) {\n\t\t\tif (pokemon.runImmunity('Ground', false)) {\n\t\t\t\tpokemon.tryTrap();\n\t\t\t}\n\t\t},\n\t\tonFoeMaybeTrapPokemon: function(pokemon) {\n\t\t\tif (pokemon.runImmunity('Ground', false)) {\n\t\t\t\tpokemon.maybeTrapped = true;\n\t\t\t}\n\t\t},\n\t\tid: \"arenatrap\",\n\t\tname: \"Arena Trap\",\n\t\trating: 5,\n\t\tnum: 71\n\t},\n\t\"aromaveil\": {\n\t\tdesc: \"Protects allies from attacks that limit their move choices.\",\n\t\tshortDesc: \"Protects allies from attacks that limit their move choices.\",\n\t\tonAllyTryHit: function(target, source, move) {\n\t\t\tif (move && move.id in {disable:1, encore:1, healblock:1, imprison:1, taunt:1, torment:1}) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tid: \"aromaveil\",\n\t\tname: \"Aroma Veil\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"aurabreak\": {\n\t\tdesc: \"Reverses the effect of Dark Aura and Fairy Aura.\",\n\t\tshortDesc: \"Reverses the effect of Aura abilities.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability', pokemon, 'Aura Break');\n\t\t},\n\t\tid: \"aurabreak\",\n\t\tname: \"Aura Break\",\n\t\trating: 2,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"baddreams\": {\n\t\tdesc: \"If asleep, each of this Pokemon's opponents receives damage equal to one-eighth of its max HP.\",\n\t\tshortDesc: \"Causes sleeping adjacent foes to lose 1/8 of their max HP at the end of each turn.\",\n\t\tonResidualOrder: 26,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tif (!pokemon.hp) return;\n\t\t\tfor (var i=0; i<pokemon.side.foe.active.length; i++) {\n\t\t\t\tvar target = pokemon.side.foe.active[i];\n\t\t\t\tif (!target || !target.hp) continue;\n\t\t\t\tif (target.status === 'slp') {\n\t\t\t\t\tthis.damage(target.maxhp/8, target);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"baddreams\",\n\t\tname: \"Bad Dreams\",\n\t\trating: 2,\n\t\tnum: 123\n\t},\n\t\"battlearmor\": {\n\t\tdesc: \"Critical Hits cannot strike this Pokemon.\",\n\t\tshortDesc: \"This Pokemon cannot be struck by a critical hit.\",\n\t\tonCriticalHit: false,\n\t\tid: \"battlearmor\",\n\t\tname: \"Battle Armor\",\n\t\trating: 1,\n\t\tnum: 4\n\t},\n\t\"bigpecks\": {\n\t\tdesc: \"Prevents the Pokemon's Defense stat from being reduced.\",\n\t\tshortDesc: \"Prevents other Pokemon from lowering this Pokemon's Defense.\",\n\t\tonBoost: function(boost, target, source, effect) {\n\t\t\tif (source && target === source) return;\n\t\t\tif (boost['def'] && boost['def'] < 0) {\n\t\t\t\tboost['def'] = 0;\n\t\t\t\tif (!effect.secondaries) this.add(\"-fail\", target, \"unboost\", \"Defense\", \"[from] ability: Big Pecks\", \"[of] \"+target);\n\t\t\t}\n\t\t},\n\t\tid: \"bigpecks\",\n\t\tname: \"Big Pecks\",\n\t\trating: 1,\n\t\tnum: 145\n\t},\n\t\"blaze\": {\n\t\tdesc: \"When its health reaches one-third or less of its max HP, this Pokemon's Fire-type attacks receive a 50% boost in power.\",\n\t\tshortDesc: \"When this Pokemon has 1/3 or less of its max HP, its Fire attacks do 1.5x damage.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Fire' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Blaze boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Fire' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Blaze boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"blaze\",\n\t\tname: \"Blaze\",\n\t\trating: 2,\n\t\tnum: 66\n\t},\n\t\"bulletproof\": {\n\t\tdesc: \"This Pokemon is protected from some Ball and Bomb moves.\",\n\t\tshortDesc: \"This Pokemon is protected from ball and bomb moves.\",\n\t\tonTryHit: function(pokemon, target, move) {\n\t\t\tif (move.isBullet) {\n\t\t\t\tthis.add('-immune', pokemon, '[msg]', '[from] Bulletproof');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"bulletproof\",\n\t\tname: \"Bulletproof\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"cheekpouch\": {\n\t\tdesc: \"Restores HP when this Pokemon consumes a berry.\",\n\t\tshortDesc: \"Restores HP when this Pokemon consumes a berry.\",\n\t\tonEatItem: function(item, pokemon) {\n\t\t\tthis.heal(pokemon.maxhp/4);\n\t\t},\n\t\tid: \"cheekpouch\",\n\t\tname: \"Cheek Pouch\",\n\t\trating: 2,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"chlorophyll\": {\n\t\tdesc: \"If this Pokemon is active while Sunny Day is in effect, its speed is temporarily doubled.\",\n\t\tshortDesc: \"If Sunny Day is active, this Pokemon's Speed is doubled.\",\n\t\tonModifySpe: function(speMod) {\n\t\t\tif (this.isWeather('sunnyday')) {\n\t\t\t\treturn this.chain(speMod, 2);\n\t\t\t}\n\t\t},\n\t\tid: \"chlorophyll\",\n\t\tname: \"Chlorophyll\",\n\t\trating: 2,\n\t\tnum: 34\n\t},\n\t\"clearbody\": {\n\t\tdesc: \"Opponents cannot reduce this Pokemon's stats; they can, however, modify stat changes with Power Swap, Guard Swap and Heart Swap and inflict stat boosts with Swagger and Flatter. This ability does not prevent self-inflicted stat reductions.\",\n\t\tshortDesc: \"Prevents other Pokemon from lowering this Pokemon's stat stages.\",\n\t\tonBoost: function(boost, target, source, effect) {\n\t\t\tif (source && target === source) return;\n\t\t\tvar showMsg = false;\n\t\t\tfor (var i in boost) {\n\t\t\t\tif (boost[i] < 0) {\n\t\t\t\t\tdelete boost[i];\n\t\t\t\t\tshowMsg = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (showMsg && !effect.secondaries) this.add(\"-fail\", target, \"unboost\", \"[from] ability: Clear Body\", \"[of] \"+target);\n\t\t},\n\t\tid: \"clearbody\",\n\t\tname: \"Clear Body\",\n\t\trating: 2,\n\t\tnum: 29\n\t},\n\t\"cloudnine\": {\n\t\tdesc: \"While this Pokemon is active, all weather conditions and their effects are disabled.\",\n\t\tshortDesc: \"While this Pokemon is active, all weather conditions and their effects are disabled.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-message', 'The effects of weather disappeared. (placeholder)');\n\t\t},\n\t\tonAnyModifyPokemon: function(pokemon) {\n\t\t\tpokemon.ignore['WeatherTarget'] = true;\n\t\t},\n\t\tonAnyTryWeather: false,\n\t\tid: \"cloudnine\",\n\t\tname: \"Cloud Nine\",\n\t\trating: 3,\n\t\tnum: 13\n\t},\n\t\"colorchange\": {\n\t\tdesc: \"This Pokemon's type changes according to the type of the last move that hit this Pokemon.\",\n\t\tshortDesc: \"This Pokemon's type changes to match the type of the last move that hit it.\",\n\t\tonAfterMoveSecondary: function(target, source, move) {\n\t\t\tif (target.isActive && move && move.effectType === 'Move' && move.category !== 'Status') {\n\t\t\t\tif (!target.hasType(move.type)) {\n\t\t\t\t\tif (!target.setType(move.type)) return false;\n\t\t\t\t\tthis.add('-start', target, 'typechange', move.type, '[from] Color Change');\n\t\t\t\t\ttarget.update();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"colorchange\",\n\t\tname: \"Color Change\",\n\t\trating: 2,\n\t\tnum: 16\n\t},\n\t\"competitive\": {\n\t\tdesc: \"Raises the user's Special Attack stat by two stages when a stat is lowered, including the Special Attack stat. This does not include self-induced stat drops like those from Close Combat.\",\n\t\tshortDesc: \"This Pokemon's SpAtk is boosted by 2 for each of its stats that is lowered by a foe.\",\n\t\tonAfterEachBoost: function(boost, target, source) {\n\t\t\tif (!source || target.side === source.side) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar statsLowered = false;\n\t\t\tfor (var i in boost) {\n\t\t\t\tif (boost[i] < 0) {\n\t\t\t\t\tstatsLowered = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (statsLowered) {\n\t\t\t\tthis.boost({spa: 2});\n\t\t\t}\n\t\t},\n\t\tid: \"competitive\",\n\t\tname: \"Competitive\",\n\t\trating: 2,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"compoundeyes\": {\n\t\tdesc: \"The accuracy of this Pokemon's moves receives a 30% increase; for example, a 75% accurate move becomes 97.5% accurate.\",\n\t\tshortDesc: \"This Pokemon's moves have their accuracy boosted to 1.3x.\",\n\t\tonModifyMove: function(move) {\n\t\t\tif (typeof move.accuracy !== 'number') return;\n\t\t\tthis.debug('compoundeyes - enhancing accuracy');\n\t\t\tmove.accuracy *= 1.3;\n\t\t},\n\t\tid: \"compoundeyes\",\n\t\tname: \"Compound Eyes\",\n\t\trating: 3.5,\n\t\tnum: 14\n\t},\n\t\"contrary\": {\n\t\tdesc: \"Stat changes are inverted.\",\n\t\tshortDesc: \"If this Pokemon has a stat boosted it is lowered instead, and vice versa.\",\n\t\tonBoost: function(boost) {\n\t\t\tfor (var i in boost) {\n\t\t\t\tboost[i] *= -1;\n\t\t\t}\n\t\t},\n\t\tid: \"contrary\",\n\t\tname: \"Contrary\",\n\t\trating: 4,\n\t\tnum: 126\n\t},\n\t\"cursedbody\": {\n\t\tdesc: \"30% chance of disabling one of the opponent's moves when attacked. This works even if the attacker is behind a Substitute, but will not activate if the Pokemon with Cursed Body is behind a Substitute.\",\n\t\tshortDesc: \"If this Pokemon is hit by an attack, there is a 30% chance that move gets Disabled.\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (!source || source.volatiles['disable']) return;\n\t\t\tif (source !== target && move && move.effectType === 'Move') {\n\t\t\t\tif (this.random(10) < 3) {\n\t\t\t\t\tsource.addVolatile('disable');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"cursedbody\",\n\t\tname: \"Cursed Body\",\n\t\trating: 2,\n\t\tnum: 130\n\t},\n\t\"cutecharm\": {\n\t\tdesc: \"If an opponent of the opposite gender directly attacks this Pokemon, there is a 30% chance that the opponent will become Attracted to this Pokemon.\",\n\t\tshortDesc: \"30% chance of infatuating Pokemon of the opposite gender if they make contact.\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (move && move.isContact) {\n\t\t\t\tif (this.random(10) < 3) {\n\t\t\t\t\tsource.addVolatile('attract', target);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"cutecharm\",\n\t\tname: \"Cute Charm\",\n\t\trating: 1,\n\t\tnum: 56\n\t},\n\t\"damp\": {\n\t\tdesc: \"While this Pokemon is active, no Pokemon on the field can use Selfdestruct or Explosion.\",\n\t\tshortDesc: \"While this Pokemon is active, Selfdestruct, Explosion, and Aftermath do not work.\",\n\t\tid: \"damp\",\n\t\tonAnyTryMove: function(target, source, effect) {\n\t\t\tif (effect.id === 'selfdestruct' || effect.id === 'explosion') {\n\t\t\t\tthis.attrLastMove('[still]');\n\t\t\t\tthis.add('-activate', this.effectData.target, 'ability: Damp');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tonAnyDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && effect.id === 'aftermath') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tname: \"Damp\",\n\t\trating: 0.5,\n\t\tnum: 6\n\t},\n\t\"darkaura\": {\n\t\tdesc: \"Increases the power of all Dark-type moves in battle to 1.33x.\",\n\t\tshortDesc: \"Increases the power of all Dark-type moves in battle to 1.33x.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability', pokemon, 'Dark Aura');\n\t\t},\n\t\tonBasePowerPriority: 8,\n\t\tonAnyBasePower: function(basePower, attacker, defender, move) {\n\t\t\tvar reverseAura = false;\n\t\t\tfor (var p in attacker.side.active) {\n\t\t\t\tif (attacker.side.active[p] && attacker.side.active[p].ability === 'aurabreak') {\n\t\t\t\t\treverseAura = true;\n\t\t\t\t\tthis.debug('Reversing Dark Aura due to Aura Break');\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var p in defender.side.active) {\n\t\t\t\tif (defender.side.active[p] && defender.side.active[p].ability === 'aurabreak') {\n\t\t\t\t\treverseAura = true;\n\t\t\t\t\tthis.debug('Reversing Dark Aura due to Aura Break');\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (move.type === 'Dark') {\n\t\t\t\treturn this.chainModify(reverseAura? 0.75 : 4/3);\n\t\t\t}\n\t\t},\n\t\tid: \"darkaura\",\n\t\tname: \"Dark Aura\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"defeatist\": {\n\t\tdesc: \"Attack and Special Attack are halved when HP is less than half.\",\n\t\tshortDesc: \"When this Pokemon has 1/2 or less of its max HP, its Attack and Sp. Atk are halved.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk, pokemon) {\n\t\t\tif (pokemon.hp < pokemon.maxhp/2) {\n\t\t\t\treturn this.chainModify(0.5);\n\t\t\t}\n\t\t},\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(atk, pokemon) {\n\t\t\tif (pokemon.hp < pokemon.maxhp/2) {\n\t\t\t\treturn this.chainModify(0.5);\n\t\t\t}\n\t\t},\n\t\tonResidual: function(pokemon) {\n\t\t\tpokemon.update();\n\t\t},\n\t\tid: \"defeatist\",\n\t\tname: \"Defeatist\",\n\t\trating: -1,\n\t\tnum: 129\n\t},\n\t\"defiant\": {\n\t\tdesc: \"Raises the user's Attack stat by two stages when a stat is lowered, including the Attack stat. This does not include self-induced stat drops like those from Close Combat.\",\n\t\tshortDesc: \"This Pokemon's Attack is boosted by 2 for each of its stats that is lowered by a foe.\",\n\t\tonAfterEachBoost: function(boost, target, source) {\n\t\t\tif (!source || target.side === source.side) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar statsLowered = false;\n\t\t\tfor (var i in boost) {\n\t\t\t\tif (boost[i] < 0) {\n\t\t\t\t\tstatsLowered = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (statsLowered) {\n\t\t\t\tthis.boost({atk: 2});\n\t\t\t}\n\t\t},\n\t\tid: \"defiant\",\n\t\tname: \"Defiant\",\n\t\trating: 2,\n\t\tnum: 128\n\t},\n\t\"download\": {\n\t\tdesc: \"If this Pokemon switches into an opponent with equal Defenses or higher Defense than Special Defense, this Pokemon's Special Attack receives a 50% boost. If this Pokemon switches into an opponent with higher Special Defense than Defense, this Pokemon's Attack receive a 50% boost.\",\n\t\tshortDesc: \"On switch-in, Attack or Sp. Atk is boosted by 1 based on the foes' weaker Defense.\",\n\t\tonStart: function (pokemon) {\n\t\t\tvar foeactive = pokemon.side.foe.active;\n\t\t\tvar totaldef = 0;\n\t\t\tvar totalspd = 0;\n\t\t\tfor (var i=0; i<foeactive.length; i++) {\n\t\t\t\tif (!foeactive[i] || foeactive[i].fainted) continue;\n\t\t\t\ttotaldef += foeactive[i].getStat('def', false, true);\n\t\t\t\ttotalspd += foeactive[i].getStat('spd', false, true);\n\t\t\t}\n\t\t\tif (totaldef && totaldef >= totalspd) {\n\t\t\t\tthis.boost({spa:1});\n\t\t\t} else if (totalspd) {\n\t\t\t\tthis.boost({atk:1});\n\t\t\t}\n\t\t},\n\t\tid: \"download\",\n\t\tname: \"Download\",\n\t\trating: 4,\n\t\tnum: 88\n\t},\n\t\"drizzle\": {\n\t\tdesc: \"When this Pokemon enters the battlefield, the weather becomes Rain Dance (for 5 turns normally, or 8 turns while holding Damp Rock).\",\n\t\tshortDesc: \"On switch-in, the weather becomes Rain Dance.\",\n\t\tonStart: function(source) {\n\t\t\tthis.setWeather('raindance');\n\t\t},\n\t\tid: \"drizzle\",\n\t\tname: \"Drizzle\",\n\t\trating: 5,\n\t\tnum: 2\n\t},\n\t\"drought\": {\n\t\tdesc: \"When this Pokemon enters the battlefield, the weather becomes Sunny Day (for 5 turns normally, or 8 turns while holding Heat Rock).\",\n\t\tshortDesc: \"On switch-in, the weather becomes Sunny Day.\",\n\t\tonStart: function(source) {\n\t\t\tthis.setWeather('sunnyday');\n\t\t},\n\t\tid: \"drought\",\n\t\tname: \"Drought\",\n\t\trating: 5,\n\t\tnum: 70\n\t},\n\t\"dryskin\": {\n\t\tdesc: \"This Pokemon absorbs Water attacks and gains a weakness to Fire attacks. If Sunny Day is in effect, this Pokemon takes damage. If Rain Dance is in effect, this Pokemon recovers health.\",\n\t\tshortDesc: \"This Pokemon is healed 1/4 by Water, 1/8 by Rain; is hurt 1.25x by Fire, 1/8 by Sun.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Water') {\n\t\t\t\tif (!this.heal(target.maxhp/4)) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tonBasePowerPriority: 7,\n\t\tonFoeBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (this.effectData.target !== defender) return;\n\t\t\tif (move.type === 'Fire') {\n\t\t\t\treturn this.chainModify(1.25);\n\t\t\t}\n\t\t},\n\t\tonWeather: function(target, source, effect) {\n\t\t\tif (effect.id === 'raindance') {\n\t\t\t\tthis.heal(target.maxhp/8);\n\t\t\t} else if (effect.id === 'sunnyday') {\n\t\t\t\tthis.damage(target.maxhp/8);\n\t\t\t}\n\t\t},\n\t\tid: \"dryskin\",\n\t\tname: \"Dry Skin\",\n\t\trating: 3.5,\n\t\tnum: 87\n\t},\n\t\"earlybird\": {\n\t\tdesc: \"This Pokemon will remain asleep for half as long as it normally would; this includes both opponent-induced sleep and user-induced sleep via Rest.\",\n\t\tshortDesc: \"This Pokemon's sleep status lasts half as long as usual, self-induced or not.\",\n\t\tid: \"earlybird\",\n\t\tname: \"Early Bird\",\n\t\tisHalfSleep: true,\n\t\trating: 2.5,\n\t\tnum: 48\n\t},\n\t\"effectspore\": {\n\t\tdesc: \"If an opponent directly attacks this Pokemon, there is a 30% chance that the opponent will become either poisoned, paralyzed or put to sleep. There is an equal chance to inflict each status.\",\n\t\tshortDesc: \"30% chance of poisoning, paralyzing, or causing sleep on Pokemon making contact.\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (move && move.isContact && !source.status) {\n\t\t\t\tvar r = this.random(100);\n\t\t\t\tif (r < 11) source.setStatus('slp', target);\n\t\t\t\telse if (r < 21) source.setStatus('par', target);\n\t\t\t\telse if (r < 30) source.setStatus('psn', target);\n\t\t\t}\n\t\t},\n\t\tid: \"effectspore\",\n\t\tname: \"Effect Spore\",\n\t\trating: 2,\n\t\tnum: 27\n\t},\n\t\"fairyaura\": {\n\t\tdesc: \"Increases the power of all Fairy-type moves in battle to 1.33x.\",\n\t\tshortDesc: \"Increases the power of all Fairy-type moves in battle to 1.33x.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability', pokemon, 'Fairy Aura');\n\t\t},\n\t\tonBasePowerPriority: 8,\n\t\tonAnyBasePower: function(basePower, attacker, defender, move) {\n\t\t\tvar reverseAura = false;\n\t\t\tfor (var p in attacker.side.active) {\n\t\t\t\tif (attacker.side.active[p] && attacker.side.active[p].ability === 'aurabreak') {\n\t\t\t\t\treverseAura = true;\n\t\t\t\t\tthis.debug('Reversing Fairy Aura due to Aura Break');\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var p in defender.side.active) {\n\t\t\t\tif (defender.side.active[p] && defender.side.active[p].ability === 'aurabreak') {\n\t\t\t\t\treverseAura = true;\n\t\t\t\t\tthis.debug('Reversing Fairy Aura due to Aura Break');\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (move.type === 'Fairy') {\n\t\t\t\treturn this.chainModify(reverseAura? 0.75 : 4/3);\n\t\t\t}\n\t\t},\n\t\tid: \"fairyaura\",\n\t\tname: \"Fairy Aura\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"filter\": {\n\t\tdesc: \"This Pokemon receives one-fourth reduced damage from Super Effective attacks.\",\n\t\tshortDesc: \"This Pokemon receives 3/4 damage from super effective attacks.\",\n\t\tonSourceModifyDamage: function(damage, source, target, move) {\n\t\t\tif (this.getEffectiveness(move, target) > 0) {\n\t\t\t\tthis.debug('Filter neutralize');\n\t\t\t\t\treturn this.chainModify(0.75);\n\t\t\t}\n\t\t},\n\t\tid: \"filter\",\n\t\tname: \"Filter\",\n\t\trating: 3,\n\t\tnum: 111\n\t},\n\t\"flamebody\": {\n\t\tdesc: \"If an opponent directly attacks this Pokemon, there is a 30% chance that the opponent will become burned.\",\n\t\tshortDesc: \"30% chance of burning a Pokemon making contact with this Pokemon.\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (move && move.isContact) {\n\t\t\t\tif (this.random(10) < 3) {\n\t\t\t\t\tsource.trySetStatus('brn', target, move);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"flamebody\",\n\t\tname: \"Flame Body\",\n\t\trating: 2,\n\t\tnum: 49\n\t},\n\t\"flareboost\": {\n\t\tdesc: \"When the user with this ability is burned, its Special Attack is raised by 50%.\",\n\t\tshortDesc: \"When this Pokemon is burned, its special attacks do 1.5x damage.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (attacker.status === 'brn' && move.category === 'Special') {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"flareboost\",\n\t\tname: \"Flare Boost\",\n\t\trating: 3,\n\t\tnum: 138\n\t},\n\t\"flashfire\": {\n\t\tdesc: \"This Pokemon is immune to all Fire-type attacks; additionally, its own Fire-type attacks receive a 50% boost if a Fire-type move hits this Pokemon. Multiple boosts do not occur if this Pokemon is hit with multiple Fire-type attacks.\",\n\t\tshortDesc: \"This Pokemon's Fire attacks do 1.5x damage if hit by one Fire move; Fire immunity.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Fire') {\n\t\t\t\tmove.accuracy = true;\n\t\t\t\tif (!target.addVolatile('flashfire')) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tnoCopy: true, // doesn't get copied by Baton Pass\n\t\t\tonStart: function(target) {\n\t\t\t\tthis.add('-start',target,'ability: Flash Fire');\n\t\t\t},\n\t\t\tonModifyAtkPriority: 5,\n\t\t\tonModifyAtk: function(atk, attacker, defender, move) {\n\t\t\t\tif (move.type === 'Fire') {\n\t\t\t\t\tthis.debug('Flash Fire boost');\n\t\t\t\t\treturn this.chainModify(1.5);\n\t\t\t\t}\n\t\t\t},\n\t\t\tonModifySpAPriority: 5,\n\t\t\tonModifySpA: function(atk, attacker, defender, move) {\n\t\t\t\tif (move.type === 'Fire') {\n\t\t\t\t\tthis.debug('Flash Fire boost');\n\t\t\t\t\treturn this.chainModify(1.5);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"flashfire\",\n\t\tname: \"Flash Fire\",\n\t\trating: 3,\n\t\tnum: 18\n\t},\n\t\"flowergift\": {\n\t\tdesc: \"If this Pokemon is active while Sunny Day is in effect, its Attack and Special Defense stats (as well as its partner's stats in double battles) receive a 50% boost.\",\n\t\tshortDesc: \"If user is Cherrim and Sunny Day is active, it and allies' Attack and Sp. Def are 1.5x.\",\n\t\tonStart: function(pokemon) {\n\t\t\tdelete this.effectData.forme;\n\t\t},\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (!pokemon.isActive || pokemon.speciesid !== 'cherrim') return;\n\t\t\tif (this.isWeather('sunnyday')) {\n\t\t\t\tif (this.effectData.forme !== 'Sunshine') {\n\t\t\t\t\tthis.effectData.forme = 'Sunshine';\n\t\t\t\t\tthis.add('-formechange', pokemon, 'Cherrim-Sunshine');\n\t\t\t\t\tthis.add('-message', pokemon.name+' transformed! (placeholder)');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.effectData.forme) {\n\t\t\t\t\tdelete this.effectData.forme;\n\t\t\t\t\tthis.add('-formechange', pokemon, 'Cherrim');\n\t\t\t\t\tthis.add('-message', pokemon.name+' transformed! (placeholder)');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonModifyAtkPriority: 3,\n\t\tonAllyModifyAtk: function(atk) {\n\t\t\tif (this.effectData.target.template.speciesid !== 'cherrim') return;\n\t\t\tif (this.isWeather('sunnyday')) {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tonModifySpDPriority: 4,\n\t\tonAllyModifySpD: function(spd) {\n\t\t\tif (this.effectData.target.template.speciesid !== 'cherrim') return;\n\t\t\tif (this.isWeather('sunnyday')) {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"flowergift\",\n\t\tname: \"Flower Gift\",\n\t\trating: 3,\n\t\tnum: 122\n\t},\n\t\"flowerveil\": {\n\t\tdesc: \"Prevents lowering of ally Grass-type Pokemon's stats.\",\n\t\tshortDesc: \"Prevents lowering of ally Grass-type Pokemon's stats.\",\n\t\tonAllyBoost: function(boost, target, source, effect) {\n\t\t\tif ((source && target === source) || !target.hasType('Grass')) return;\n\t\t\tvar showMsg = false;\n\t\t\tfor (var i in boost) {\n\t\t\t\tif (boost[i] < 0) {\n\t\t\t\t\tdelete boost[i];\n\t\t\t\t\tshowMsg = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (showMsg && !effect.secondaries) this.add(\"-fail\", target, \"unboost\", \"[from] ability: Flower Veil\", \"[of] \"+target);\n\t\t},\n\t\tid: \"flowerveil\",\n\t\tname: \"Flower Veil\",\n\t\trating: 0,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"forecast\": {\n\t\tdesc: \"This Pokemon's type changes according to the current weather conditions: it becomes Fire-type during Sunny Day, Water-type during Rain Dance, Ice-type during Hail and remains its regular type otherwise.\",\n\t\tshortDesc: \"Castform's type changes to the current weather condition's type, except Sandstorm.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.baseTemplate.species !== 'Castform' || pokemon.transformed) return;\n\t\t\tvar forme = null;\n\t\t\tswitch (this.effectiveWeather()) {\n\t\t\tcase 'sunnyday':\n\t\t\t\tif (pokemon.template.speciesid !== 'castformsunny') forme = 'Castform-Sunny';\n\t\t\t\tbreak;\n\t\t\tcase 'raindance':\n\t\t\t\tif (pokemon.template.speciesid !== 'castformrainy') forme = 'Castform-Rainy';\n\t\t\t\tbreak;\n\t\t\tcase 'hail':\n\t\t\t\tif (pokemon.template.speciesid !== 'castformsnowy') forme = 'Castform-Snowy';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif (pokemon.template.speciesid !== 'castform') forme = 'Castform';\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (pokemon.isActive && forme) {\n\t\t\t\tpokemon.formeChange(forme);\n\t\t\t\tthis.add('-formechange', pokemon, forme);\n\t\t\t\tthis.add('-message', pokemon.name+' transformed! (placeholder)');\n\t\t\t}\n\t\t},\n\t\tid: \"forecast\",\n\t\tname: \"Forecast\",\n\t\trating: 4,\n\t\tnum: 59\n\t},\n\t\"forewarn\": {\n\t\tdesc: \"The move with the highest Base Power in the opponent's moveset is revealed.\",\n\t\tshortDesc: \"On switch-in, this Pokemon is alerted to the foes' move with the highest Base Power.\",\n\t\tonStart: function(pokemon) {\n\t\t\tvar targets = pokemon.side.foe.active;\n\t\t\tvar warnMoves = [];\n\t\t\tvar warnBp = 1;\n\t\t\tfor (var i=0; i<targets.length; i++) {\n\t\t\t\tif (targets[i].fainted) continue;\n\t\t\t\tfor (var j=0; j<targets[i].moveset.length; j++) {\n\t\t\t\t\tvar move = this.getMove(targets[i].moveset[j].move);\n\t\t\t\t\tvar bp = move.basePower;\n\t\t\t\t\tif (move.ohko) bp = 160;\n\t\t\t\t\tif (move.id === 'counter' || move.id === 'metalburst' || move.id === 'mirrorcoat') bp = 120;\n\t\t\t\t\tif (!bp && move.category !== 'Status') bp = 80;\n\t\t\t\t\tif (bp > warnBp) {\n\t\t\t\t\t\twarnMoves = [[move, targets[i]]];\n\t\t\t\t\t\twarnBp = bp;\n\t\t\t\t\t} else if (bp == warnBp) {\n\t\t\t\t\t\twarnMoves.push([move, targets[i]]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!warnMoves.length) return;\n\t\t\tvar warnMove = warnMoves[this.random(warnMoves.length)];\n\t\t\tthis.add('-activate', pokemon, 'ability: Forewarn', warnMove[0], warnMove[1]);\n\t\t},\n\t\tid: \"forewarn\",\n\t\tname: \"Forewarn\",\n\t\trating: 1,\n\t\tnum: 108\n\t},\n\t\"friendguard\": {\n\t\tdesc: \"Reduces the damage received from an ally in a double or triple battle.\",\n\t\tshortDesc: \"This Pokemon's allies receive 3/4 damage from other Pokemon's attacks.\",\n\t\tid: \"friendguard\",\n\t\tname: \"Friend Guard\",\n\t\tonAnyModifyDamage: function(damage, source, target, move) {\n\t\t\tif (target !== this.effectData.target && target.side === this.effectData.target.side) {\n\t\t\t\tthis.debug('Friend Guard weaken');\n\t\t\t\treturn this.chainModify(0.75);\n\t\t\t}\n\t\t},\n\t\trating: 0,\n\t\tnum: 132\n\t},\n\t\"frisk\": {\n\t\tdesc: \"When this Pokemon enters the field, it identifies all the opponent's held items.\",\n\t\tshortDesc: \"On switch-in, this Pokemon identifies the foe's held items.\",\n\t\tonStart: function(pokemon) {\n\t\t\tvar foeactive = pokemon.side.foe.active;\n\t\t\tfor (var i=0; i<foeactive.length; i++) {\n\t\t\t\tif (!foeactive[i] || foeactive[i].fainted) continue;\n\t\t\t\tif (foeactive[i].item) {\n\t\t\t\t\tthis.add('-item', foeactive[i], foeactive[i].getItem().name, '[from] ability: Frisk', '[of] '+pokemon, '[identify]');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"frisk\",\n\t\tname: \"Frisk\",\n\t\trating: 1.5,\n\t\tnum: 119\n\t},\n\t\"furcoat\": {\n\t\tdesc: \"Halves the damage done to this Pokemon by physical attacks.\",\n\t\tshortDesc: \"Halves physical damage done to this Pokemon.\",\n\t\tonModifyAtkPriority: 6,\n\t\tonSourceModifyAtk: function(atk, attacker, defender, move) {\n\t\t\treturn this.chainModify(0.5);\n\t\t},\n\t\tid: \"furcoat\",\n\t\tname: \"Fur Coat\",\n\t\trating: 3.5,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"galewings\": {\n\t\tdesc: \"This Pokemon's Flying-type moves have their priority increased by 1.\",\n\t\tshortDesc: \"Gives priority to Flying-type moves.\",\n\t\tonModifyPriority: function(priority, pokemon, target, move) {\n\t\t\tif (move && move.type === 'Flying') return priority + 1;\n\t\t},\n\t\tid: \"galewings\",\n\t\tname: \"Gale Wings\",\n\t\trating: 4.5,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"gluttony\": {\n\t\tdesc: \"This Pokemon consumes its held berry when its health reaches 50% max HP or lower.\",\n\t\tshortDesc: \"When this Pokemon has 1/2 or less of its max HP, it uses certain Berries early.\",\n\t\tid: \"gluttony\",\n\t\tname: \"Gluttony\",\n\t\trating: 1.5,\n\t\tnum: 82\n\t},\n\t\"gooey\": {\n\t\tdesc: \"Contact with this Pokemon lowers the attacker's Speed stat by 1.\",\n\t\tshortDesc: \"Contact with this Pokemon lowers the attacker's Speed.\",\n\t\tonAfterDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && effect.isContact) this.boost({spe: -1}, source, target);\n\t\t},\n\t\tid: \"gooey\",\n\t\tname: \"Gooey\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"grasspelt\": {\n\t\tdesc: \"This Pokemon's Defense is boosted in Grassy Terrain\",\n\t\tshortDesc: \"This Pokemon's Defense is boosted in Grassy Terrain.\",\n\t\tonModifyDefPriority: 6,\n\t\tonModifyDef: function(pokemon) {\n\t\t\tif (this.isTerrain('grassyterrain')) return this.chainModify(1.5);\n\t\t},\n\t\tid: \"grasspelt\",\n\t\tname: \"Grass Pelt\",\n\t\trating: 2,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"guts\": {\n\t\tdesc: \"When this Pokemon is poisoned (including Toxic), burned, paralyzed or asleep (including self-induced Rest), its Attack stat receives a 50% boost; the burn status' Attack drop is also ignored.\",\n\t\tshortDesc: \"If this Pokemon is statused, its Attack is 1.5x; burn's Attack drop is ignored.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk, pokemon) {\n\t\t\tif (pokemon.status) {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"guts\",\n\t\tname: \"Guts\",\n\t\trating: 3,\n\t\tnum: 62\n\t},\n\t\"harvest\": {\n\t\tdesc: \"When the user uses a held Berry, it has a 50% chance of having it restored at the end of the turn. This chance becomes 100% during Sunny Day.\",\n\t\tshortDesc: \"50% chance this Pokemon's Berry is restored at the end of each turn. 100% in Sun.\",\n\t\tid: \"harvest\",\n\t\tname: \"Harvest\",\n\t\tonResidualOrder: 26,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tif (this.isWeather('sunnyday') || this.random(2) === 0) {\n\t\t\t\tif (pokemon.hp && !pokemon.item && this.getItem(pokemon.lastItem).isBerry) {\n\t\t\t\t\tpokemon.setItem(pokemon.lastItem);\n\t\t\t\t\tthis.add('-item', pokemon, pokemon.getItem(), '[from] ability: Harvest');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\trating: 2,\n\t\tnum: 139\n\t},\n\t\"healer\": {\n\t\tdesc: \"Has a 30% chance of curing an adjacent ally's status ailment at the end of each turn in Double and Triple Battles.\",\n\t\tshortDesc: \"30% chance of curing an adjacent ally's status at the end of each turn.\",\n\t\tid: \"healer\",\n\t\tname: \"Healer\",\n\t\tonResidualOrder: 5,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tvar allyActive = pokemon.side.active;\n\t\t\tif (allyActive.length === 1) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (var i=0; i<allyActive.length; i++) {\n\t\t\t\tif (allyActive[i] && this.isAdjacent(pokemon, allyActive[i]) && allyActive[i].status && this.random(10) < 3) {\n\t\t\t\t\tallyActive[i].cureStatus();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\trating: 0,\n\t\tnum: 131\n\t},\n\t\"heatproof\": {\n\t\tdesc: \"This Pokemon receives half damage from both Fire-type attacks and residual burn damage.\",\n\t\tshortDesc: \"This Pokemon receives half damage from Fire-type attacks and burn damage.\",\n\t\tonBasePowerPriority: 7,\n\t\tonSourceBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (move.type === 'Fire') {\n\t\t\t\treturn this.chainModify(0.5);\n\t\t\t}\n\t\t},\n\t\tonDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && effect.id === 'brn') {\n\t\t\t\treturn damage / 2;\n\t\t\t}\n\t\t},\n\t\tid: \"heatproof\",\n\t\tname: \"Heatproof\",\n\t\trating: 2.5,\n\t\tnum: 85\n\t},\n\t\"heavymetal\": {\n\t\tdesc: \"The user's weight is doubled. This increases user's base power of Heavy Slam and Heat Crash, as well as damage taken from the opponent's Low Kick and Grass Knot, due to these moves being calculated by the target's weight.\",\n\t\tshortDesc: \"This Pokemon's weight is doubled.\",\n\t\tonModifyPokemon: function(pokemon) {\n\t\t\tpokemon.weightkg *= 2;\n\t\t},\n\t\tid: \"heavymetal\",\n\t\tname: \"Heavy Metal\",\n\t\trating: -1,\n\t\tnum: 134\n\t},\n\t\"honeygather\": {\n\t\tdesc: \"If it is not already holding an item, this Pokemon may find and be holding Honey after a battle.\",\n\t\tshortDesc: \"No competitive use.\",\n\t\tid: \"honeygather\",\n\t\tname: \"Honey Gather\",\n\t\trating: 0,\n\t\tnum: 118\n\t},\n\t\"hugepower\": {\n\t\tdesc: \"This Pokemon's Attack stat is doubled. Therefore, if this Pokemon's Attack stat on the status screen is 200, it effectively has an Attack stat of 400; which is then subject to the full range of stat boosts and reductions.\",\n\t\tshortDesc: \"This Pokemon's Attack is doubled.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk) {\n\t\t\treturn this.chainModify(2);\n\t\t},\n\t\tid: \"hugepower\",\n\t\tname: \"Huge Power\",\n\t\trating: 5,\n\t\tnum: 37\n\t},\n\t\"hustle\": {\n\t\tdesc: \"This Pokemon's Attack receives a 50% boost but its Physical attacks receive a 20% drop in Accuracy. For example, a 100% accurate move would become an 80% accurate move. The accuracy of moves that never miss, such as Aerial Ace, remains unaffected.\",\n\t\tshortDesc: \"This Pokemon's Attack is 1.5x and accuracy of its physical attacks is 0.8x.\",\n\t\t// This should be applied directly to the stat as opposed to chaining witht he others\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk) {\n\t\t\treturn this.modify(atk, 1.5);\n\t\t},\n\t\tonModifyMove: function(move) {\n\t\t\tif (move.category === 'Physical' && typeof move.accuracy === 'number') {\n\t\t\t\tmove.accuracy *= 0.8;\n\t\t\t}\n\t\t},\n\t\tid: \"hustle\",\n\t\tname: \"Hustle\",\n\t\trating: 3,\n\t\tnum: 55\n\t},\n\t\"hydration\": {\n\t\tdesc: \"If this Pokemon is active while Rain Dance is in effect, it recovers from poison, paralysis, burn, sleep and freeze at the end of the turn.\",\n\t\tshortDesc: \"This Pokemon has its status cured at the end of each turn if Rain Dance is active.\",\n\t\tonResidualOrder: 5,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tif (pokemon.status && this.isWeather('raindance')) {\n\t\t\t\tthis.debug('hydration');\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tid: \"hydration\",\n\t\tname: \"Hydration\",\n\t\trating: 2,\n\t\tnum: 93\n\t},\n\t\"hypercutter\": {\n\t\tdesc: \"Opponents cannot reduce this Pokemon's Attack stat; they can, however, modify stat changes with Power Swap or Heart Swap and inflict a stat boost with Swagger. This ability does not prevent self-inflicted stat reductions.\",\n\t\tshortDesc: \"Prevents other Pokemon from lowering this Pokemon's Attack.\",\n\t\tonBoost: function(boost, target, source, effect) {\n\t\t\tif (source && target === source) return;\n\t\t\tif (boost['atk'] && boost['atk'] < 0) {\n\t\t\t\tboost['atk'] = 0;\n\t\t\t\tif (!effect.secondaries) this.add(\"-fail\", target, \"unboost\", \"Attack\", \"[from] ability: Hyper Cutter\", \"[of] \"+target);\n\t\t\t}\n\t\t},\n\t\tid: \"hypercutter\",\n\t\tname: \"Hyper Cutter\",\n\t\trating: 1.5,\n\t\tnum: 52\n\t},\n\t\"icebody\": {\n\t\tdesc: \"If active while Hail is in effect, this Pokemon recovers one-sixteenth of its max HP after each turn. If a non-Ice-type Pokemon receives this ability through Skill Swap, Role Play or the Trace ability, it will not take damage from Hail.\",\n\t\tshortDesc: \"If Hail is active, this Pokemon heals 1/16 of its max HP each turn; immunity to Hail.\",\n\t\tonWeather: function(target, source, effect) {\n\t\t\tif (effect.id === 'hail') {\n\t\t\t\tthis.heal(target.maxhp/16);\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'hail') return false;\n\t\t},\n\t\tid: \"icebody\",\n\t\tname: \"Ice Body\",\n\t\trating: 3,\n\t\tnum: 115\n\t},\n\t\"illuminate\": {\n\t\tdesc: \"When this Pokemon is in the first slot of the player's party, it doubles the rate of wild encounters.\",\n\t\tshortDesc: \"No competitive use.\",\n\t\tid: \"illuminate\",\n\t\tname: \"Illuminate\",\n\t\trating: 0,\n\t\tnum: 35\n\t},\n\t\"illusion\": {\n\t\tdesc: \"Illusion will change the appearance of the Pokemon to a different species. This is dependent on the last Pokemon in the player's party. Along with the species itself, Illusion is broken when the user is damaged, but is not broken by Substitute, weather conditions, status ailments, or entry hazards. Illusion will replicate the type of Poke Ball, the species name, and the gender of the Pokemon it is masquerading as.\",\n\t\tshortDesc: \"This Pokemon appears as the last Pokemon in the party until it takes direct damage.\",\n\t\tonBeforeSwitchIn: function(pokemon) {\n\t\t\tpokemon.illusion = null;\n\t\t\tfor (var i=pokemon.side.pokemon.length-1; i>pokemon.position; i--) {\n\t\t\t\tif (!pokemon.side.pokemon[i]) continue;\n\t\t\t\tif (!pokemon.side.pokemon[i].fainted) break;\n\t\t\t}\n\t\t\tif (!pokemon.side.pokemon[i]) return;\n\t\t\tif (pokemon === pokemon.side.pokemon[i]) return;\n\t\t\tpokemon.illusion = pokemon.side.pokemon[i];\n\t\t},\n\t\t// illusion clearing is hardcoded in the damage function\n\t\tid: \"illusion\",\n\t\tname: \"Illusion\",\n\t\trating: 4.5,\n\t\tnum: 149\n\t},\n\t\"immunity\": {\n\t\tdesc: \"This Pokemon cannot become poisoned nor Toxic poisoned.\",\n\t\tshortDesc: \"This Pokemon cannot be poisoned. Gaining this Ability while poisoned cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.status === 'psn' || pokemon.status === 'tox') {\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type) {\n\t\t\tif (type === 'psn') return false;\n\t\t},\n\t\tid: \"immunity\",\n\t\tname: \"Immunity\",\n\t\trating: 1,\n\t\tnum: 17\n\t},\n\t\"imposter\": {\n\t\tdesc: \"As soon as the user comes into battle, it Transforms into its opponent, copying the opponent's stats exactly, with the exception of HP. Imposter copies all stat changes on the target originating from moves and abilities such as Swords Dance and Intimidate, but not from items such as Choice Specs. Imposter will not Transform the user if the opponent is an Illusion or if the opponent is behind a Substitute.\",\n\t\tshortDesc: \"On switch-in, this Pokemon copies the foe it's facing; stats, moves, types, Ability.\",\n\t\tonStart: function(pokemon) {\n\t\t\tvar target = pokemon.side.foe.active[pokemon.side.foe.active.length-1-pokemon.position];\n\t\t\tif (target) {\n\t\t\t\tpokemon.transformInto(target, pokemon);\n\t\t\t}\n\t\t},\n\t\tid: \"imposter\",\n\t\tname: \"Imposter\",\n\t\trating: 5,\n\t\tnum: 150\n\t},\n\t\"infiltrator\": {\n\t\tdesc: \"Ignores Substitute, Reflect, Light Screen, and Safeguard on the target.\",\n\t\tshortDesc: \"This Pokemon's moves ignore the foe's Substitute, Reflect, Light Screen, Safeguard, and Mist.\",\n\t\tonModifyMove: function(move) {\n\t\t\tmove.notSubBlocked = true;\n\t\t\tmove.ignoreScreens = true;\n\t\t},\n\t\tid: \"infiltrator\",\n\t\tname: \"Infiltrator\",\n\t\trating: 2.5,\n\t\tnum: 151\n\t},\n\t\"innerfocus\": {\n\t\tdesc: \"This Pokemon cannot be made to flinch.\",\n\t\tshortDesc: \"This Pokemon cannot be made to flinch.\",\n\t\tonFlinch: false,\n\t\tid: \"innerfocus\",\n\t\tname: \"Inner Focus\",\n\t\trating: 1,\n\t\tnum: 39\n\t},\n\t\"insomnia\": {\n\t\tdesc: \"This Pokemon cannot be put to sleep; this includes both opponent-induced sleep as well as user-induced sleep via Rest.\",\n\t\tshortDesc: \"This Pokemon cannot fall asleep. Gaining this Ability while asleep cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.status === 'slp') {\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'slp') return false;\n\t\t},\n\t\tid: \"insomnia\",\n\t\tname: \"Insomnia\",\n\t\trating: 2,\n\t\tnum: 15\n\t},\n\t\"intimidate\": {\n\t\tdesc: \"When this Pokemon enters the field, the Attack stat of each of its opponents lowers by one stage.\",\n\t\tshortDesc: \"On switch-in, this Pokemon lowers adjacent foes' Attack by 1.\",\n\t\tonStart: function(pokemon) {\n\t\t\tvar foeactive = pokemon.side.foe.active;\n\t\t\tfor (var i=0; i<foeactive.length; i++) {\n\t\t\t\tif (!foeactive[i] || foeactive[i].fainted) continue;\n\t\t\t\tif (foeactive[i].volatiles['substitute']) {\n\t\t\t\t\t// does it give a message?\n\t\t\t\t\tthis.add('-activate',foeactive[i],'Substitute','ability: Intimidate','[of] '+pokemon);\n\t\t\t\t} else {\n\t\t\t\t\tthis.add('-ability',pokemon,'Intimidate','[of] '+foeactive[i]);\n\t\t\t\t\tthis.boost({atk: -1}, foeactive[i], pokemon);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"intimidate\",\n\t\tname: \"Intimidate\",\n\t\trating: 3.5,\n\t\tnum: 22\n\t},\n\t\"ironbarbs\": {\n\t\tdesc: \"All moves that make contact with the Pokemon with Iron Barbs will damage the user by 1/8 of their maximum HP after damage is dealt.\",\n\t\tshortDesc: \"This Pokemon causes other Pokemon making contact to lose 1/8 of their max HP.\",\n\t\tonAfterDamageOrder: 1,\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (source && source !== target && move && move.isContact) {\n\t\t\t\tthis.damage(source.maxhp/8, source, target);\n\t\t\t}\n\t\t},\n\t\tid: \"ironbarbs\",\n\t\tname: \"Iron Barbs\",\n\t\trating: 3,\n\t\tnum: 160\n\t},\n\t\"ironfist\": {\n\t\tdesc: \"This Pokemon receives a 20% power boost for the following attacks: Bullet Punch, Comet Punch, Dizzy Punch, Drain Punch, Dynamicpunch, Fire Punch, Focus Punch, Hammer Arm, Ice Punch, Mach Punch, Mega Punch, Meteor Mash, Shadow Punch, Sky Uppercut, and Thunderpunch. Sucker Punch, which is known Ambush in Japan, is not boosted.\",\n\t\tshortDesc: \"This Pokemon's punch-based attacks do 1.2x damage. Sucker Punch is not boosted.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (move.isPunchAttack) {\n\t\t\t\tthis.debug('Iron Fist boost');\n\t\t\t\treturn this.chainModify(1.2);\n\t\t\t}\n\t\t},\n\t\tid: \"ironfist\",\n\t\tname: \"Iron Fist\",\n\t\trating: 3,\n\t\tnum: 89\n\t},\n\t\"justified\": {\n\t\tdesc: \"Will raise the user's Attack stat one level when hit by any Dark-type moves. Unlike other abilities with immunity to certain typed moves, the user will still receive damage from the attack. Justified will raise Attack one level for each hit of a multi-hit move like Beat Up.\",\n\t\tshortDesc: \"This Pokemon's Attack is boosted by 1 after it is damaged by a Dark-type attack.\",\n\t\tonAfterDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && effect.type === 'Dark') {\n\t\t\t\tthis.boost({atk:1});\n\t\t\t}\n\t\t},\n\t\tid: \"justified\",\n\t\tname: \"Justified\",\n\t\trating: 2,\n\t\tnum: 154\n\t},\n\t\"keeneye\": {\n\t\tdesc: \"This Pokemon's Accuracy cannot be lowered.\",\n\t\tshortDesc: \"Prevents other Pokemon from lowering this Pokemon's accuracy.\",\n\t\tonBoost: function(boost, target, source, effect) {\n\t\t\tif (source && target === source) return;\n\t\t\tif (boost['accuracy'] && boost['accuracy'] < 0) {\n\t\t\t\tboost['accuracy'] = 0;\n\t\t\t\tif (!effect.secondaries) this.add(\"-fail\", target, \"unboost\", \"accuracy\", \"[from] ability: Keen Eye\", \"[of] \"+target);\n\t\t\t}\n\t\t},\n\t\tonModifyMove: function(move) {\n\t\t\tmove.ignoreEvasion = true;\n\t\t},\n\t\tid: \"keeneye\",\n\t\tname: \"Keen Eye\",\n\t\trating: 1,\n\t\tnum: 51\n\t},\n\t\"klutz\": {\n\t\tdesc: \"This Pokemon ignores both the positive and negative effects of its held item, other than the speed-halving and EV-enhancing effects of Macho Brace, Power Anklet, Power Band, Power Belt, Power Bracer, Power Lens, and Power Weight. Fling cannot be used.\",\n\t\tshortDesc: \"This Pokemon's held item has no effect, except Macho Brace. Fling cannot be used.\",\n\t\tonModifyPokemonPriority: 1,\n\t\tonModifyPokemon: function(pokemon) {\n\t\t\tpokemon.ignore['Item'] = true;\n\t\t},\n\t\tid: \"klutz\",\n\t\tname: \"Klutz\",\n\t\trating: 0,\n\t\tnum: 103\n\t},\n\t\"leafguard\": {\n\t\tdesc: \"If this Pokemon is active while Sunny Day is in effect, it cannot become poisoned, burned, paralyzed or put to sleep (other than user-induced Rest). Leaf Guard does not heal status effects that existed before Sunny Day came into effect.\",\n\t\tshortDesc: \"If Sunny Day is active, this Pokemon cannot be statused and Rest will fail for it.\",\n\t\tonSetStatus: function(pokemon) {\n\t\t\tif (this.isWeather('sunnyday')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (move && move.id === 'yawn' && this.isWeather('sunnyday')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tid: \"leafguard\",\n\t\tname: \"Leaf Guard\",\n\t\trating: 1,\n\t\tnum: 102\n\t},\n\t\"levitate\": {\n\t\tdesc: \"This Pokemon is immune to Ground-type attacks, Spikes, Toxic Spikes and the Arena Trap ability; it loses these immunities while holding Iron Ball, after using Ingrain or if Gravity is in effect.\",\n\t\tshortDesc: \"This Pokemon is immune to Ground; Gravity, Ingrain, Smack Down, Iron Ball nullify it.\",\n\t\tonImmunity: function(type) {\n\t\t\tif (type === 'Ground') return false;\n\t\t},\n\t\tid: \"levitate\",\n\t\tname: \"Levitate\",\n\t\trating: 3.5,\n\t\tnum: 26\n\t},\n\t\"lightmetal\": {\n\t\tdesc: \"The user's weight is halved. This decreases the damage taken from Low Kick and Grass Knot, and also lowers user's base power of Heavy Slam and Heat Crash, due these moves being calculated by the target and user's weight.\",\n\t\tshortDesc: \"This Pokemon's weight is halved.\",\n\t\tonModifyPokemon: function(pokemon) {\n\t\t\tpokemon.weightkg /= 2;\n\t\t},\n\t\tid: \"lightmetal\",\n\t\tname: \"Light Metal\",\n\t\trating: 1,\n\t\tnum: 135\n\t},\n\t\"lightningrod\": {\n\t\tdesc: \"During double battles, this Pokemon draws any single-target Electric-type attack to itself. If an opponent uses an Electric-type attack that affects multiple Pokemon, those targets will be hit. This ability does not affect Electric Hidden Power or Judgment. The user is immune to Electric and its Special Attack is increased one stage when hit by one.\",\n\t\tshortDesc: \"This Pokemon draws Electric moves to itself to boost Sp. Atk by 1; Electric immunity.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Electric') {\n\t\t\t\tif (!this.boost({spa:1})) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tonAnyRedirectTargetPriority: 1,\n\t\tonAnyRedirectTarget: function(target, source, source2, move) {\n\t\t\tif (move.type !== 'Electric') return;\n\t\t\tif (this.validTarget(this.effectData.target, source, move.target)) {\n\t\t\t\treturn this.effectData.target;\n\t\t\t}\n\t\t},\n\t\tid: \"lightningrod\",\n\t\tname: \"Lightningrod\",\n\t\trating: 3.5,\n\t\tnum: 32\n\t},\n\t\"limber\": {\n\t\tdesc: \"This Pokemon cannot become paralyzed.\",\n\t\tshortDesc: \"This Pokemon cannot be paralyzed. Gaining this Ability while paralyzed cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.status === 'par') {\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'par') return false;\n\t\t},\n\t\tid: \"limber\",\n\t\tname: \"Limber\",\n\t\trating: 2,\n\t\tnum: 7\n\t},\n\t\"liquidooze\": {\n\t\tdesc: \"When another Pokemon uses Absorb, Drain Punch, Dream Eater, Giga Drain, Leech Life, Leech Seed or Mega Drain against this Pokemon, the attacking Pokemon loses the amount of health that it would have gained.\",\n\t\tshortDesc: \"This Pokemon damages those draining HP from it for as much as they would heal.\",\n\t\tid: \"liquidooze\",\n\t\tonSourceTryHeal: function(damage, target, source, effect) {\n\t\t\tthis.debug(\"Heal is occurring: \"+target+\" <- \"+source+\" :: \"+effect.id);\n\t\t\tvar canOoze = {drain: 1, leechseed: 1};\n\t\t\tif (canOoze[effect.id]) {\n\t\t\t\tthis.damage(damage);\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t},\n\t\tname: \"Liquid Ooze\",\n\t\trating: 1,\n\t\tnum: 64\n\t},\n\t\"magician\": {\n\t\tdesc: \"If this Pokemon is not holding an item, it steals the held item of a target it hits with a move.\",\n\t\tshortDesc: \"This Pokemon steals the held item of a target it hits with a move.\",\n\t\tonHit: function(target, source, move) {\n\t\t\t// We need to hard check if the ability is Magician since the event will be run both ways.\n\t\t\tif (target && target !== source && move && source.ability === 'magician') {\n\t\t\t\tif (source.item) return;\n\t\t\t\tvar yourItem = target.takeItem(source);\n\t\t\t\tif (!yourItem) return;\n\t\t\t\tif (!source.setItem(yourItem)) {\n\t\t\t\t\ttarget.item = yourItem.id; // bypass setItem so we don't break choicelock or anything\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.add('-item', source, yourItem, '[from] ability: Magician', '[of] ' + target);\n\t\t\t}\n\t\t},\n\t\tid: \"magician\",\n\t\tname: \"Magician\",\n\t\trating: 2,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"magicbounce\": {\n\t\tdesc: \"Non-damaging moves are reflected back at the user.\",\n\t\tshortDesc: \"This Pokemon blocks certain status moves and uses the move itself.\",\n\t\tid: \"magicbounce\",\n\t\tname: \"Magic Bounce\",\n\t\tonTryHitPriority: 1,\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target === source) return;\n\t\t\tif (move.hasBounced) return;\n\t\t\tif (typeof move.isBounceable === 'undefined') {\n\t\t\t\tmove.isBounceable = !!(move.category === 'Status' && (move.status || move.boosts || move.volatileStatus === 'confusion' || move.forceSwitch));\n\t\t\t}\n\t\t\tif (move.isBounceable) {\n\t\t\t\tvar newMove = this.getMoveCopy(move.id);\n\t\t\t\tnewMove.hasBounced = true;\n\t\t\t\tthis.useMove(newMove, target, source);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tonAllyTryHitSide: function(target, source, move) {\n\t\t\tif (target.side === source.side) return;\n\t\t\tif (move.hasBounced) return;\n\t\t\tif (typeof move.isBounceable === 'undefined') {\n\t\t\t\tmove.isBounceable = !!(move.category === 'Status' && (move.status || move.boosts || move.volatileStatus === 'confusion' || move.forceSwitch));\n\t\t\t}\n\t\t\tif (move.isBounceable) {\n\t\t\t\tvar newMove = this.getMoveCopy(move.id);\n\t\t\t\tnewMove.hasBounced = true;\n\t\t\t\tthis.useMove(newMove, target, source);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tduration: 1\n\t\t},\n\t\trating: 5,\n\t\tnum: 156\n\t},\n\t\"magicguard\": {\n\t\tdesc: \"Prevents all damage except from direct attacks.\",\n\t\tshortDesc: \"This Pokemon can only be damaged by direct attacks.\",\n\t\tonDamage: function(damage, target, source, effect) {\n\t\t\tif (effect.effectType !== 'Move') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tid: \"magicguard\",\n\t\tname: \"Magic Guard\",\n\t\trating: 4.5,\n\t\tnum: 98\n\t},\n\t\"magmaarmor\": {\n\t\tdesc: \"This Pokemon cannot become frozen.\",\n\t\tshortDesc: \"This Pokemon cannot be frozen. Gaining this Ability while frozen cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.status === 'frz') {\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'frz') return false;\n\t\t},\n\t\tid: \"magmaarmor\",\n\t\tname: \"Magma Armor\",\n\t\trating: 0.5,\n\t\tnum: 40\n\t},\n\t\"magnetpull\": {\n\t\tdesc: \"When this Pokemon enters the field, Steel-type opponents cannot switch out nor flee the battle unless they are holding Shed Shell or use attacks like U-Turn or Baton Pass.\",\n\t\tshortDesc: \"Prevents Steel-type foes from switching out normally.\",\n\t\tonFoeModifyPokemon: function(pokemon) {\n\t\t\tif (pokemon.hasType('Steel')) {\n\t\t\t\tpokemon.tryTrap();\n\t\t\t}\n\t\t},\n\t\tonFoeMaybeTrapPokemon: function(pokemon) {\n\t\t\tif (pokemon.hasType('Steel')) {\n\t\t\t\tpokemon.maybeTrapped = true;\n\t\t\t}\n\t\t},\n\t\tid: \"magnetpull\",\n\t\tname: \"Magnet Pull\",\n\t\trating: 4.5,\n\t\tnum: 42\n\t},\n\t\"marvelscale\": {\n\t\tdesc: \"When this Pokemon becomes burned, poisoned (including Toxic), paralyzed, frozen or put to sleep (including self-induced sleep via Rest), its Defense receives a 50% boost.\",\n\t\tshortDesc: \"If this Pokemon is statused, its Defense is 1.5x.\",\n\t\tonModifyDefPriority: 6,\n\t\tonModifyDef: function(def, pokemon) {\n\t\t\tif (pokemon.status) {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"marvelscale\",\n\t\tname: \"Marvel Scale\",\n\t\trating: 3,\n\t\tnum: 63\n\t},\n\t\"megalauncher\": {\n\t\tdesc: \"Boosts the power of Aura and Pulse moves, such as Aura Sphere and Dark Pulse, by 50%.\",\n\t\tshortDesc: \"Boosts the power of Aura/Pulse moves by 50%.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (move.isPulseMove) {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"megalauncher\",\n\t\tname: \"Mega Launcher\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"minus\": {\n\t\tdesc: \"This Pokemon's Special Attack receives a 50% boost in double battles if a partner has the Plus or Minus ability.\",\n\t\tshortDesc: \"If an ally has the Ability Plus or Minus, this Pokemon's Sp. Atk is 1.5x.\",\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(spa, pokemon) {\n\t\t\tvar allyActive = pokemon.side.active;\n\t\t\tif (allyActive.length === 1) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (var i=0; i<allyActive.length; i++) {\n\t\t\t\tif (allyActive[i] && allyActive[i].position !== pokemon.position && !allyActive[i].fainted && (allyActive[i].ability === 'minus' || allyActive[i].ability === 'plus')) {\n\t\t\t\t\treturn this.chainModify(1.5);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"minus\",\n\t\tname: \"Minus\",\n\t\trating: 0,\n\t\tnum: 58\n\t},\n\t\"moldbreaker\": {\n\t\tdesc: \"When this Pokemon becomes active, it nullifies the abilities of opposing active Pokemon that hinder this Pokemon's attacks. These abilities include Battle Armor, Clear Body, Damp, Dry Skin, Filter, Flash Fire, Flower Gift, Heatproof, Herbivore, Hyper Cutter, Immunity, Inner Focus, Insomnia, Keen Eye, Leaf Guard, Levitate, Lightningrod, Limber, Magma Armor, Marvel Scale, Motor Drive, Oblivious, Own Tempo, Sand Veil, Shell Armor, Shield Dust, Simple, Snow Cloak, Solid Rock, Soundproof, Sticky Hold, Storm Drain, Sturdy, Suction Cups, Tangled Feet, Thick Fat, Unaware, Vital Spirit, Volt Absorb, Water Absorb, Water Veil, White Smoke and Wonder Guard.\",\n\t\tshortDesc: \"This Pokemon's moves ignore the target's Ability if it could modify the effectiveness.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability', pokemon, 'Mold Breaker');\n\t\t},\n\t\tonAllyModifyPokemonPriority: 100,\n\t\tonAllyModifyPokemon: function(pokemon) {\n\t\t\tif (this.activePokemon === this.effectData.target && pokemon !== this.activePokemon) {\n\t\t\t\tpokemon.ignore['Ability'] = 'A';\n\t\t\t}\n\t\t},\n\t\tonFoeModifyPokemonPriority: 100,\n\t\tonFoeModifyPokemon: function(pokemon) {\n\t\t\tif (this.activePokemon === this.effectData.target) {\n\t\t\t\tpokemon.ignore['Ability'] = 'A';\n\t\t\t}\n\t\t},\n\t\tid: \"moldbreaker\",\n\t\tname: \"Mold Breaker\",\n\t\trating: 3,\n\t\tnum: 104\n\t},\n\t\"moody\": {\n\t\tdesc: \"At the end of each turn, the Pokemon raises a random stat that isn't already +6 by two stages, and lowers a random stat that isn't already -6 by one stage. These stats include accuracy and evasion.\",\n\t\tshortDesc: \"Boosts a random stat by 2 and lowers another stat by 1 at the end of each turn.\",\n\t\tonResidualOrder: 26,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tvar stats = [], i = '';\n\t\t\tvar boost = {};\n\t\t\tfor (var i in pokemon.boosts) {\n\t\t\t\tif (pokemon.boosts[i] < 6) {\n\t\t\t\t\tstats.push(i);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (stats.length) {\n\t\t\t\ti = stats[this.random(stats.length)];\n\t\t\t\tboost[i] = 2;\n\t\t\t}\n\t\t\tstats = [];\n\t\t\tfor (var j in pokemon.boosts) {\n\t\t\t\tif (pokemon.boosts[j] > -6 && j !== i) {\n\t\t\t\t\tstats.push(j);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (stats.length) {\n\t\t\t\ti = stats[this.random(stats.length)];\n\t\t\t\tboost[i] = -1;\n\t\t\t}\n\t\t\tthis.boost(boost);\n\t\t},\n\t\tid: \"moody\",\n\t\tname: \"Moody\",\n\t\trating: 5,\n\t\tnum: 141\n\t},\n\t\"motordrive\": {\n\t\tdesc: \"This Pokemon is immune to all Electric-type moves (including Status moves). If hit by an Electric-type attack, its Speed increases by one stage.\",\n\t\tshortDesc: \"This Pokemon's Speed is boosted by 1 if hit by an Electric move; Electric immunity.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Electric') {\n\t\t\t\tif (!this.boost({spe:1})) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"motordrive\",\n\t\tname: \"Motor Drive\",\n\t\trating: 3,\n\t\tnum: 78\n\t},\n\t\"moxie\": {\n\t\tdesc: \"If this Pokemon knocks out another Pokemon with a damaging attack, its Attack is raised by one stage.\",\n\t\tshortDesc: \"This Pokemon's Attack is boosted by 1 if it attacks and faints another Pokemon.\",\n\t\tonSourceFaint: function(target, source, effect) {\n\t\t\tif (effect && effect.effectType === 'Move') {\n\t\t\t\tthis.boost({atk:1}, source);\n\t\t\t}\n\t\t},\n\t\tid: \"moxie\",\n\t\tname: \"Moxie\",\n\t\trating: 4,\n\t\tnum: 153\n\t},\n\t\"multiscale\": {\n\t\tdesc: \"If this Pokemon is at full HP, it takes half damage from attacks.\",\n\t\tshortDesc: \"If this Pokemon is at full HP, it takes half damage from attacks.\",\n\t\tonSourceModifyDamage: function(damage, source, target, move) {\n\t\t\tif (target.hp >= target.maxhp) {\n\t\t\t\tthis.debug('Multiscale weaken');\n\t\t\t\treturn this.chainModify(0.5);\n\t\t\t}\n\t\t},\n\t\tid: \"multiscale\",\n\t\tname: \"Multiscale\",\n\t\trating: 4,\n\t\tnum: 136\n\t},\n\t\"multitype\": {\n\t\tdesc: \"If this Pokemon is Arceus, its type and sprite change to match its held Plate. Either way, this Pokemon is holding a Plate, the Plate cannot be taken (such as by Trick or Thief). This ability cannot be Skill Swapped, Role Played or Traced.\",\n\t\tshortDesc: \"If this Pokemon is Arceus, its type changes to match its held Plate.\",\n\t\t// Multitype's type-changing itself is implemented in statuses.js\n\t\tonTakeItem: function(item) {\n\t\t\tif (item.onPlate) return false;\n\t\t},\n\t\tid: \"multitype\",\n\t\tname: \"Multitype\",\n\t\trating: 4,\n\t\tnum: 121\n\t},\n\t\"mummy\": {\n\t\tdesc: \"When the user is attacked by a contact move, the opposing Pokemon's ability is turned into Mummy as well. Multitype, Wonder Guard and Mummy itself are the only abilities not affected by Mummy. The effect of Mummy is not removed by Mold Breaker, Turboblaze, or Teravolt.\",\n\t\tshortDesc: \"Pokemon making contact with this Pokemon have their Ability changed to Mummy.\",\n\t\tid: \"mummy\",\n\t\tname: \"Mummy\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (source && source !== target && move && move.isContact) {\n\t\t\t\tif (source.setAbility('mummy', source, 'mummy', true)) {\n\t\t\t\t\tthis.add('-ability', source, 'Mummy', '[from] Mummy');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\trating: 1,\n\t\tnum: 152\n\t},\n\t\"naturalcure\": {\n\t\tdesc: \"When this Pokemon switches out of battle, it is cured of poison (including Toxic), paralysis, burn, freeze and sleep (including self-induced Rest).\",\n\t\tshortDesc: \"This Pokemon has its status cured when it switches out.\",\n\t\tonSwitchOut: function(pokemon) {\n\t\t\tpokemon.setStatus('');\n\t\t},\n\t\tid: \"naturalcure\",\n\t\tname: \"Natural Cure\",\n\t\trating: 4,\n\t\tnum: 30\n\t},\n\t\"noguard\": {\n\t\tdesc: \"Every attack used by or against this Pokemon will always hit, even during evasive two-turn moves such as Fly and Dig.\",\n\t\tshortDesc: \"Every move used by or against this Pokemon will always hit.\",\n\t\tonAnyAccuracy: function(accuracy, target, source, move) {\n\t\t\tif (move && (source === this.effectData.target || target === this.effectData.target)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn accuracy;\n\t\t},\n\t\tid: \"noguard\",\n\t\tname: \"No Guard\",\n\t\trating: 4,\n\t\tnum: 99\n\t},\n\t\"normalize\": {\n\t\tdesc: \"Makes all of this Pokemon's attacks Normal-typed.\",\n\t\tshortDesc: \"This Pokemon's moves all become Normal-typed.\",\n\t\tonModifyMove: function(move) {\n\t\t\tif (move.id !== 'struggle') {\n\t\t\t\tmove.type = 'Normal';\n\t\t\t}\n\t\t},\n\t\tid: \"normalize\",\n\t\tname: \"Normalize\",\n\t\trating: -1,\n\t\tnum: 96\n\t},\n\t\"oblivious\": {\n\t\tdesc: \"This Pokemon cannot be infatuated (by Attract or Cute Charm) or taunted. Gaining this Ability while afflicted by either condition cures it.\",\n\t\tshortDesc: \"This Pokemon cannot be infatuated or taunted. Gaining this Ability cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.volatiles['attract']) {\n\t\t\t\tpokemon.removeVolatile('attract');\n\t\t\t\tthis.add(\"-message\", pokemon.name+\" got over its infatuation. (placeholder)\");\n\t\t\t}\n\t\t\tif (pokemon.volatiles['taunt']) {\n\t\t\t\tpokemon.removeVolatile('taunt');\n\t\t\t\t// TODO: Research proper message.\n\t\t\t\tthis.add(\"-message\", pokemon.name+\" got over its taunt. (placeholder)\");\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'attract') {\n\t\t\t\tthis.add('-immune', pokemon, '[from] Oblivious');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tonTryHit: function(pokemon, target, move) {\n\t\t\tif (move.id === 'captivate' || move.id === 'taunt') {\n\t\t\t\tthis.add('-immune', pokemon, '[msg]', '[from] Oblivious');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"oblivious\",\n\t\tname: \"Oblivious\",\n\t\trating: 0.5,\n\t\tnum: 12\n\t},\n\t\"overcoat\": {\n\t\tdesc: \"In battle, the Pokemon does not take damage from weather conditions like Sandstorm or Hail. It is also immune to powder moves.\",\n\t\tshortDesc: \"This Pokemon is immune to residual weather damage, and powder moves.\",\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'sandstorm' || type === 'hail' || type === 'powder') return false;\n\t\t},\n\t\tid: \"overcoat\",\n\t\tname: \"Overcoat\",\n\t\trating: 2,\n\t\tnum: 142\n\t},\n\t\"overgrow\": {\n\t\tdesc: \"When its health reaches one-third or less of its max HP, this Pokemon's Grass-type attacks receive a 50% boost in power.\",\n\t\tshortDesc: \"When this Pokemon has 1/3 or less of its max HP, its Grass attacks do 1.5x damage.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Grass' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Overgrow boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Grass' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Overgrow boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"overgrow\",\n\t\tname: \"Overgrow\",\n\t\trating: 2,\n\t\tnum: 65\n\t},\n\t\"owntempo\": {\n\t\tdesc: \"This Pokemon cannot be confused. Gaining this Ability while confused cures it.\",\n\t\tshortDesc: \"This Pokemon cannot be confused. Gaining this Ability while confused cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.volatiles['confusion']) {\n\t\t\t\tpokemon.removeVolatile('confusion');\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'confusion') {\n\t\t\t\tthis.add('-immune', pokemon, 'confusion');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tid: \"owntempo\",\n\t\tname: \"Own Tempo\",\n\t\trating: 1,\n\t\tnum: 20\n\t},\n\t\"parentalbond\": {\n\t\tdesc: \"Allows the Pokemon to hit twice with the same move in one turn. Second hit has 0.5x base power. Does not affect Status, multihit, or spread moves (in doubles).\",\n\t\tshortDesc: \"Hits twice in one turn. Second hit has 0.5x base power.\",\n\t\tonModifyMove: function(move, pokemon, target) {\n\t\t\tif (move.category !== 'Status' && !move.selfdestruct && !move.multihit && ((target.side && target.side.active.length < 2) || move.target in {any:1, normal:1, randomNormal:1})) {\n\t\t\t\tmove.multihit = 2;\n\t\t\t\tpokemon.addVolatile('parentalbond');\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tduration: 1,\n\t\t\tonBasePowerPriority: 8,\n\t\t\tonBasePower: function(basePower) {\n\t\t\t\tif (this.effectData.hit) {\n\t\t\t\t\treturn this.chainModify(0.5);\n\t\t\t\t} else {\n\t\t\t\t\tthis.effectData.hit = true;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"parentalbond\",\n\t\tname: \"Parental Bond\",\n\t\trating: 4.5,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"pickup\": {\n\t\tdesc: \"If an opponent uses a consumable item, Pickup will give the Pokemon the item used, if it is not holding an item. If multiple Pickup Pokemon are in play, one will pick up a copy of the used Berry, and may or may not use it immediately. Works on Berries, Gems, Absorb Bulb, Focus Sash, Herbs, Cell Battery, Red Card, and anything that is thrown with Fling.\",\n\t\tshortDesc: \"If this Pokemon has no item, it finds one used by an adjacent Pokemon this turn.\",\n\t\tonResidualOrder: 26,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tvar foe = pokemon.side.foe.randomActive();\n\t\t\tif (!foe) return;\n\t\t\tif (!pokemon.item && foe.lastItem && foe.usedItemThisTurn && foe.lastItem !== 'airballoon' && foe.lastItem !== 'ejectbutton') {\n\t\t\t\tpokemon.setItem(foe.lastItem);\n\t\t\t\tfoe.lastItem = '';\n\t\t\t\tvar item = pokemon.getItem();\n\t\t\t\tthis.add('-item', pokemon, item, '[from] Pickup');\n\t\t\t\tif (item.isBerry) pokemon.update();\n\t\t\t}\n\t\t},\n\t\tid: \"pickup\",\n\t\tname: \"Pickup\",\n\t\trating: 0,\n\t\tnum: 53\n\t},\n\t\"pickpocket\": {\n\t\tdesc: \"If this Pokemon has no item, it steals an item off an attacking Pokemon making contact.\",\n\t\tshortDesc: \"If this Pokemon has no item, it steals an item off a Pokemon making contact.\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (source && source !== target && move && move.isContact) {\n\t\t\t\tif (target.item) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar yourItem = source.takeItem(target);\n\t\t\t\tif (!yourItem) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!target.setItem(yourItem)) {\n\t\t\t\t\tsource.item = yourItem.id;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.add('-item', target, yourItem, '[from] ability: Pickpocket');\n\t\t\t}\n\t\t},\n\t\tid: \"pickpocket\",\n\t\tname: \"Pickpocket\",\n\t\trating: 1,\n\t\tnum: 124\n\t},\n\t\"pixilate\": {\n\t\tdesc: \"Turns all of this Pokemon's Normal-typed attacks into Fairy-type and deal 1.3x damage. Does not affect Hidden Power.\",\n\t\tshortDesc: \"This Pokemon's Normal moves become Fairy-type and do 1.3x damage.\",\n\t\tonModifyMove: function(move, pokemon) {\n\t\t\tif (move.type === 'Normal' && move.id !== 'hiddenpower') {\n\t\t\t\tmove.type = 'Fairy';\n\t\t\t\tpokemon.addVolatile('pixilate');\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tduration: 1,\n\t\t\tonBasePowerPriority: 8,\n\t\t\tonBasePower: function(basePower, pokemon, target, move) {\n\t\t\t\treturn this.chainModify([0x14CD, 0x1000]);\n\t\t\t}\n\t\t},\n\t\tid: \"pixilate\",\n\t\tname: \"Pixilate\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"plus\": {\n\t\tdesc: \"This Pokemon's Special Attack receives a 50% boost in double battles if a partner has the Plus or Minus ability.\",\n\t\tshortDesc: \"If an ally has the Ability Plus or Minus, this Pokemon's Sp. Atk is 1.5x.\",\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(spa, pokemon) {\n\t\t\tvar allyActive = pokemon.side.active;\n\t\t\tif (allyActive.length === 1) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfor (var i=0; i<allyActive.length; i++) {\n\t\t\t\tif (allyActive[i] && allyActive[i].position !== pokemon.position && !allyActive[i].fainted && (allyActive[i].ability === 'minus' || allyActive[i].ability === 'plus')) {\n\t\t\t\t\treturn this.chainModify(1.5);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"plus\",\n\t\tname: \"Plus\",\n\t\trating: 0,\n\t\tnum: 57\n\t},\n\t\"poisonheal\": {\n\t\tdesc: \"If this Pokemon becomes poisoned (including Toxic), it will recover 1/8 of its max HP after each turn.\",\n\t\tshortDesc: \"This Pokemon is healed by 1/8 of its max HP each turn when poisoned; no HP loss.\",\n\t\tonDamage: function(damage, target, source, effect) {\n\t\t\tif (effect.id === 'psn' || effect.id === 'tox') {\n\t\t\t\tthis.heal(target.maxhp/8);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tid: \"poisonheal\",\n\t\tname: \"Poison Heal\",\n\t\trating: 4,\n\t\tnum: 90\n\t},\n\t\"poisonpoint\": {\n\t\tdesc: \"If an opponent contact attacks this Pokemon, there is a 30% chance that the opponent will become poisoned.\",\n\t\tshortDesc: \"30% chance of poisoning a Pokemon making contact with this Pokemon.\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (move && move.isContact) {\n\t\t\t\tif (this.random(10) < 3) {\n\t\t\t\t\tsource.trySetStatus('psn', target, move);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"poisonpoint\",\n\t\tname: \"Poison Point\",\n\t\trating: 2,\n\t\tnum: 38\n\t},\n\t\"poisontouch\": {\n\t\tdesc: \"This Pokemon's contact attacks have a 30% chance of poisoning the target.\",\n\t\tshortDesc: \"This Pokemon's contact moves have a 30% chance of poisoning.\",\n\t\t// upokecenter says this is implemented as an added secondary effect\n\t\tonModifyMove: function(move) {\n\t\t\tif (!move || !move.isContact) return;\n\t\t\tif (!move.secondaries) {\n\t\t\t\tmove.secondaries = [];\n\t\t\t}\n\t\t\tmove.secondaries.push({\n\t\t\t\tchance: 30,\n\t\t\t\tstatus: 'psn'\n\t\t\t});\n\t\t},\n\t\tid: \"poisontouch\",\n\t\tname: \"Poison Touch\",\n\t\trating: 2,\n\t\tnum: 143\n\t},\n\t\"prankster\": {\n\t\tdesc: \"This Pokemon's Status moves have their priority increased by 1 stage.\",\n\t\tshortDesc: \"This Pokemon's Status moves have their priority increased by 1.\",\n\t\tonModifyPriority: function(priority, pokemon, target, move) {\n\t\t\tif (move && move.category === 'Status') {\n\t\t\t\treturn priority + 1;\n\t\t\t}\n\t\t},\n\t\tid: \"prankster\",\n\t\tname: \"Prankster\",\n\t\trating: 4.5,\n\t\tnum: 158\n\t},\n\t\"pressure\": {\n\t\tdesc: \"If this Pokemon is the target of a foe's move, that move loses one additional PP.\",\n\t\tshortDesc: \"If this Pokemon is the target of a foe's move, that move loses one additional PP.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability', pokemon, 'Pressure');\n\t\t},\n\t\tonSourceDeductPP: function(pp, target, source) {\n\t\t\tif (target.side === source.side) return;\n\t\t\treturn pp+1;\n\t\t},\n\t\tid: \"pressure\",\n\t\tname: \"Pressure\",\n\t\trating: 1.5,\n\t\tnum: 46\n\t},\n\t\"protean\": {\n\t\tdesc: \"Right before this Pokemon uses a move, it changes its type to match that move. Hidden Power is interpreted as its Hidden Power type, rather than Normal.\",\n\t\tshortDesc: \"Right before this Pokemon uses a move, it changes its type to match that move.\",\n\t\tonBeforeMove: function(pokemon, target, move) {\n\t\t\tif (!move || pokemon.volatiles.mustrecharge) return;\n\t\t\tvar moveType = (move.id === 'hiddenpower' ? pokemon.hpType : move.type);\n\t\t\tif (pokemon.getTypes().join() !== moveType) {\n\t\t\t\tif (!pokemon.setType(moveType)) return false;\n\t\t\t\tthis.add('-start', pokemon, 'typechange', moveType, '[from] Protean');\n\t\t\t}\n\t\t},\n\t\tid: \"protean\",\n\t\tname: \"Protean\",\n\t\trating: 4,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"purepower\": {\n\t\tdesc: \"This Pokemon's Attack stat is doubled. Note that this is the Attack stat itself, not the base Attack stat of its species.\",\n\t\tshortDesc: \"This Pokemon's Attack is doubled.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk) {\n\t\t\treturn this.chainModify(2);\n\t\t},\n\t\tid: \"purepower\",\n\t\tname: \"Pure Power\",\n\t\trating: 5,\n\t\tnum: 74\n\t},\n\t\"quickfeet\": {\n\t\tdesc: \"When this Pokemon is poisoned (including Toxic), burned, paralyzed, asleep (including self-induced Rest) or frozen, its Speed stat receives a 50% boost; the paralysis status' Speed drop is also ignored.\",\n\t\tshortDesc: \"If this Pokemon is statused, its Speed is 1.5x; paralysis' Speed drop is ignored.\",\n\t\tonModifySpe: function(speMod, pokemon) {\n\t\t\tif (pokemon.status) {\n\t\t\t\treturn this.chain(speMod, 1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"quickfeet\",\n\t\tname: \"Quick Feet\",\n\t\trating: 3,\n\t\tnum: 95\n\t},\n\t\"raindish\": {\n\t\tdesc: \"If the weather is Rain Dance, this Pokemon recovers 1/16 of its max HP after each turn.\",\n\t\tshortDesc: \"If the weather is Rain Dance, this Pokemon heals 1/16 of its max HP each turn.\",\n\t\tonWeather: function(target, source, effect) {\n\t\t\tif (effect.id === 'raindance') {\n\t\t\t\tthis.heal(target.maxhp/16);\n\t\t\t}\n\t\t},\n\t\tid: \"raindish\",\n\t\tname: \"Rain Dish\",\n\t\trating: 1.5,\n\t\tnum: 44\n\t},\n\t\"rattled\": {\n\t\tdesc: \"Raises the user's Speed one stage when hit by a Dark-, Bug-, or Ghost-type move.\",\n\t\tshortDesc: \"This Pokemon gets +1 Speed if hit by a Dark-, Bug-, or Ghost-type attack.\",\n\t\tonAfterDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && (effect.type === 'Dark' || effect.type === 'Bug' || effect.type === 'Ghost')) {\n\t\t\t\tthis.boost({spe:1});\n\t\t\t}\n\t\t},\n\t\tid: \"rattled\",\n\t\tname: \"Rattled\",\n\t\trating: 2,\n\t\tnum: 155\n\t},\n\t\"reckless\": {\n\t\tdesc: \"When this Pokemon uses an attack that causes recoil damage, or an attack that has a chance to cause recoil damage such as Jump Kick and High Jump Kick, the attacks's power receives a 20% boost.\",\n\t\tshortDesc: \"This Pokemon's attacks with recoil or crash damage do 1.2x damage; not Struggle.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (move.recoil || move.hasCustomRecoil) {\n\t\t\t\tthis.debug('Reckless boost');\n\t\t\t\treturn this.chainModify(1.2);\n\t\t\t}\n\t\t},\n\t\tid: \"reckless\",\n\t\tname: \"Reckless\",\n\t\trating: 3,\n\t\tnum: 120\n\t},\n\t\"refrigerate\": {\n\t\tdesc: \"Turns all of this Pokemon's Normal-typed attacks into Ice-typed and deal 1.3x damage. Does not affect Hidden Power.\",\n\t\tshortDesc: \"This Pokemon's Normal moves become Ice-type and do 1.3x damage.\",\n\t\tonModifyMove: function(move, pokemon) {\n\t\t\tif (move.type === 'Normal' && move.id !== 'hiddenpower') {\n\t\t\t\tmove.type = 'Ice';\n\t\t\t\tpokemon.addVolatile('refrigerate');\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tduration: 1,\n\t\t\tonBasePowerPriority: 8,\n\t\t\tonBasePower: function(basePower, pokemon, target, move) {\n\t\t\t\treturn this.chainModify([0x14CD, 0x1000]);\n\t\t\t}\n\t\t},\n\t\tid: \"refrigerate\",\n\t\tname: \"Refrigerate\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"regenerator\": {\n\t\tdesc: \"This Pokemon heals 1/3 of its max HP when it switches out.\",\n\t\tshortDesc: \"This Pokemon heals 1/3 of its max HP when it switches out.\",\n\t\tonSwitchOut: function(pokemon) {\n\t\t\tpokemon.heal(pokemon.maxhp/3);\n\t\t},\n\t\tid: \"regenerator\",\n\t\tname: \"Regenerator\",\n\t\trating: 4,\n\t\tnum: 144\n\t},\n\t\"rivalry\": {\n\t\tdesc: \"This Pokemon's attacks do 1.25x damage if their target is the same gender, but 0.75x if their target is the opposite gender.\",\n\t\tshortDesc: \"This Pokemon's attacks do 1.25x on same gender targets; 0.75x on opposite gender.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (attacker.gender && defender.gender) {\n\t\t\t\tif (attacker.gender === defender.gender) {\n\t\t\t\t\tthis.debug('Rivalry boost');\n\t\t\t\t\treturn this.chainModify(1.25);\n\t\t\t\t} else {\n\t\t\t\t\tthis.debug('Rivalry weaken');\n\t\t\t\t\treturn this.chainModify(0.75);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"rivalry\",\n\t\tname: \"Rivalry\",\n\t\trating: 0.5,\n\t\tnum: 79\n\t},\n\t\"rockhead\": {\n\t\tdesc: \"This Pokemon does not receive recoil damage except from Struggle, Life Orb, or crash damage from Jump Kick or High Jump Kick.\",\n\t\tshortDesc: \"This Pokemon does not take recoil damage besides Struggle, Life Orb, crash damage.\",\n\t\tonModifyMove: function(move) {\n\t\t\tdelete move.recoil;\n\t\t},\n\t\tid: \"rockhead\",\n\t\tname: \"Rock Head\",\n\t\trating: 3,\n\t\tnum: 69\n\t},\n\t\"roughskin\": {\n\t\tdesc: \"Causes recoil damage equal to 1/8 of the opponent's max HP if an opponent makes contact.\",\n\t\tshortDesc: \"This Pokemon causes other Pokemon making contact to lose 1/8 of their max HP.\",\n\t\tonAfterDamageOrder: 1,\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (source && source !== target && move && move.isContact) {\n\t\t\t\tthis.damage(source.maxhp/8, source, target);\n\t\t\t}\n\t\t},\n\t\tid: \"roughskin\",\n\t\tname: \"Rough Skin\",\n\t\trating: 3,\n\t\tnum: 24\n\t},\n\t\"runaway\": {\n\t\tdesc: \"Unless this Pokemon is under the effects of a trapping move or ability, such as Mean Look or Shadow Tag, it will escape from wild Pokemon battles without fail.\",\n\t\tshortDesc: \"No competitive use.\",\n\t\tid: \"runaway\",\n\t\tname: \"Run Away\",\n\t\trating: 0,\n\t\tnum: 50\n\t},\n\t\"sandforce\": {\n\t\tdesc: \"Raises the power of this Pokemon's Rock, Ground, and Steel-type moves by 1.3x if the weather is Sandstorm. This Pokemon is also immune to residual Sandstorm damage.\",\n\t\tshortDesc: \"This Pokemon's Rock/Ground/Steel attacks do 1.3x in Sandstorm; immunity to it.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (this.isWeather('sandstorm')) {\n\t\t\t\tif (move.type === 'Rock' || move.type === 'Ground' || move.type === 'Steel') {\n\t\t\t\t\tthis.debug('Sand Force boost');\n\t\t\t\t\treturn this.chainModify([0x14CD, 0x1000]); // The Sand Force modifier is slightly higher than the normal 1.3 (0x14CC)\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'sandstorm') return false;\n\t\t},\n\t\tid: \"sandforce\",\n\t\tname: \"Sand Force\",\n\t\trating: 2,\n\t\tnum: 159\n\t},\n\t\"sandrush\": {\n\t\tdesc: \"This Pokemon's Speed is doubled if the weather is Sandstorm. This Pokemon is also immune to residual Sandstorm damage.\",\n\t\tshortDesc: \"If Sandstorm is active, this Pokemon's Speed is doubled; immunity to Sandstorm.\",\n\t\tonModifySpe: function(speMod, pokemon) {\n\t\t\tif (this.isWeather('sandstorm')) {\n\t\t\t\treturn this.chain(speMod, 2);\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'sandstorm') return false;\n\t\t},\n\t\tid: \"sandrush\",\n\t\tname: \"Sand Rush\",\n\t\trating: 2,\n\t\tnum: 146\n\t},\n\t\"sandstream\": {\n\t\tdesc: \"When this Pokemon enters the battlefield, the weather becomes Sandstorm (for 5 turns normally, or 8 turns while holding Smooth Rock).\",\n\t\tshortDesc: \"On switch-in, the weather becomes Sandstorm.\",\n\t\tonStart: function(source) {\n\t\t\tthis.setWeather('sandstorm');\n\t\t},\n\t\tid: \"sandstream\",\n\t\tname: \"Sand Stream\",\n\t\trating: 4.5,\n\t\tnum: 45\n\t},\n\t\"sandveil\": {\n\t\tdesc: \"This Pokemon's Evasion is boosted by 1.25x if the weather is Sandstorm. This Pokemon is also immune to residual Sandstorm damage.\",\n\t\tshortDesc: \"If Sandstorm is active, this Pokemon's evasion is 1.25x; immunity to Sandstorm.\",\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'sandstorm') return false;\n\t\t},\n\t\tonAccuracy: function(accuracy) {\n\t\t\tif (typeof accuracy !== 'number') return;\n\t\t\tif (this.isWeather('sandstorm')) {\n\t\t\t\tthis.debug('Sand Veil - decreasing accuracy');\n\t\t\t\treturn accuracy * 0.8;\n\t\t\t}\n\t\t},\n\t\tid: \"sandveil\",\n\t\tname: \"Sand Veil\",\n\t\trating: 1.5,\n\t\tnum: 8\n\t},\n\t\"sapsipper\": {\n\t\tdesc: \"This Pokemon is immune to Grass moves. If hit by a Grass move, its Attack is increased by one stage (once for each hit of Bullet Seed). Does not affect Aromatherapy.\",\n\t\tshortDesc: \"This Pokemon's Attack is boosted by 1 if hit by any Grass move; Grass immunity.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Grass') {\n\t\t\t\tif (!this.boost({atk:1})) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"sapsipper\",\n\t\tname: \"Sap Sipper\",\n\t\trating: 3.5,\n\t\tnum: 157\n\t},\n\t\"scrappy\": {\n\t\tdesc: \"This Pokemon has the ability to hit Ghost-type Pokemon with Normal-type and Fighting-type moves. Effectiveness of these moves takes into account the Ghost-type Pokemon's other weaknesses and resistances.\",\n\t\tshortDesc: \"This Pokemon can hit Ghost-types with Normal- and Fighting-type moves.\",\n\t\tonModifyMove: function(move) {\n\t\t\tif (move.type in {'Fighting':1,'Normal':1}) {\n\t\t\t\tmove.affectedByImmunities = false;\n\t\t\t}\n\t\t},\n\t\tid: \"scrappy\",\n\t\tname: \"Scrappy\",\n\t\trating: 3,\n\t\tnum: 113\n\t},\n\t\"serenegrace\": {\n\t\tdesc: \"This Pokemon's moves have their secondary effect chance doubled. For example, if this Pokemon uses Ice Beam, it will have a 20% chance to freeze its target.\",\n\t\tshortDesc: \"This Pokemon's moves have their secondary effect chance doubled.\",\n\t\tonModifyMove: function(move) {\n\t\t\tif (move.secondaries) {\n\t\t\t\tthis.debug('doubling secondary chance');\n\t\t\t\tfor (var i=0; i<move.secondaries.length; i++) {\n\t\t\t\t\tmove.secondaries[i].chance *= 2;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"serenegrace\",\n\t\tname: \"Serene Grace\",\n\t\trating: 4,\n\t\tnum: 32\n\t},\n\t\"shadowtag\": {\n\t\tdesc: \"When this Pokemon enters the field, its non-Ghost-type opponents cannot switch or flee the battle unless they have the same ability, are holding Shed Shell, or they use the moves Baton Pass or U-Turn.\",\n\t\tshortDesc: \"Prevents foes from switching out normally unless they also have this Ability.\",\n\t\tonFoeModifyPokemon: function(pokemon) {\n\t\t\tif (pokemon.ability !== 'shadowtag') {\n\t\t\t\tpokemon.tryTrap();\n\t\t\t}\n\t\t},\n\t\tonFoeMaybeTrapPokemon: function(pokemon) {\n\t\t\tif (pokemon.ability !== 'shadowtag') {\n\t\t\t\tpokemon.maybeTrapped = true;\n\t\t\t}\n\t\t},\n\t\tid: \"shadowtag\",\n\t\tname: \"Shadow Tag\",\n\t\trating: 5,\n\t\tnum: 23\n\t},\n\t\"shedskin\": {\n\t\tdesc: \"At the end of each turn, this Pokemon has a 33% chance to heal itself from poison (including Toxic), paralysis, burn, freeze or sleep (including self-induced Rest).\",\n\t\tshortDesc: \"This Pokemon has a 33% chance to have its status cured at the end of each turn.\",\n\t\tonResidualOrder: 5,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tif (pokemon.hp && pokemon.status && this.random(3) === 0) {\n\t\t\t\tthis.debug('shed skin');\n\t\t\t\tthis.add('-activate', pokemon, 'ability: Shed Skin');\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tid: \"shedskin\",\n\t\tname: \"Shed Skin\",\n\t\trating: 4,\n\t\tnum: 61\n\t},\n\t\"sheerforce\": {\n\t\tdesc: \"Raises the base power of all moves that have any secondary effects by 30%, but the secondary effects are ignored. Some side effects of moves, such as recoil, draining, stat reduction, and switching out usually aren't considered secondary effects. If a Pokemon with Sheer Force is holding a Life Orb and uses an attack that would be boosted by Sheer Force, then the move gains both boosts and the user receives no Life Orb recoil (only if the attack is boosted by Sheer Force).\",\n\t\tshortDesc: \"This Pokemon's attacks with secondary effects do 1.3x damage; nullifies the effects.\",\n\t\tonModifyMove: function(move, pokemon) {\n\t\t\tif (move.secondaries) {\n\t\t\t\tdelete move.secondaries;\n\t\t\t\tmove.negateSecondary = true;\n\t\t\t\tpokemon.addVolatile('sheerforce');\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tduration: 1,\n\t\t\tonBasePowerPriority: 8,\n\t\t\tonBasePower: function(basePower, pokemon, target, move) {\n\t\t\t\treturn this.chainModify([0x14CD, 0x1000]); // The Sheer Force modifier is slightly higher than the normal 1.3 (0x14CC)\n\t\t\t}\n\t\t},\n\t\tid: \"sheerforce\",\n\t\tname: \"Sheer Force\",\n\t\trating: 4,\n\t\tnum: 125\n\t},\n\t\"shellarmor\": {\n\t\tdesc: \"Attacks targeting this Pokemon can't be critical hits.\",\n\t\tshortDesc: \"This Pokemon cannot be struck by a critical hit.\",\n\t\tonCriticalHit: false,\n\t\tid: \"shellarmor\",\n\t\tname: \"Shell Armor\",\n\t\trating: 1,\n\t\tnum: 75\n\t},\n\t\"shielddust\": {\n\t\tdesc: \"If the opponent uses a move that has secondary effects that affect this Pokemon in addition to damage, the move's secondary effects will not trigger (For example, Ice Beam loses its 10% freeze chance).\",\n\t\tshortDesc: \"This Pokemon is not affected by the secondary effect of another Pokemon's attack.\",\n\t\tonTrySecondaryHit: function() {\n\t\t\tthis.debug('Shield Dust prevent secondary');\n\t\t\treturn null;\n\t\t},\n\t\tid: \"shielddust\",\n\t\tname: \"Shield Dust\",\n\t\trating: 2,\n\t\tnum: 19\n\t},\n\t\"simple\": {\n\t\tdesc: \"This Pokemon doubles all of its positive and negative stat modifiers. For example, if this Pokemon uses Curse, its Attack and Defense stats increase by two stages and its Speed stat decreases by two stages.\",\n\t\tshortDesc: \"This Pokemon has its own stat boosts and drops doubled as they happen.\",\n\t\tonBoost: function(boost) {\n\t\t\tfor (var i in boost) {\n\t\t\t\tboost[i] *= 2;\n\t\t\t}\n\t\t},\n\t\tid: \"simple\",\n\t\tname: \"Simple\",\n\t\trating: 4,\n\t\tnum: 86\n\t},\n\t\"skilllink\": {\n\t\tdesc: \"When this Pokemon uses an attack that strikes multiple times in one turn, such as Fury Attack or Spike Cannon, such attacks will always strike for the maximum number of hits.\",\n\t\tshortDesc: \"This Pokemon's multi-hit attacks always hit the maximum number of times.\",\n\t\tonModifyMove: function(move) {\n\t\t\tif (move.multihit && move.multihit.length) {\n\t\t\t\tmove.multihit = move.multihit[1];\n\t\t\t}\n\t\t},\n\t\tid: \"skilllink\",\n\t\tname: \"Skill Link\",\n\t\trating: 4,\n\t\tnum: 92\n\t},\n\t\"slowstart\": {\n\t\tdesc: \"After this Pokemon switches into the battle, its Attack and Speed stats are halved for five turns. For example, if this Pokemon has an Attack stat of 400, its Attack will be 200 until the effects of Slow Start wear off.\",\n\t\tshortDesc: \"On switch-in, this Pokemon's Attack and Speed are halved for 5 turns.\",\n\t\tonStart: function(pokemon) {\n\t\t\tpokemon.addVolatile('slowstart');\n\t\t},\n\t\teffect: {\n\t\t\tduration: 5,\n\t\t\tonStart: function(target) {\n\t\t\t\tthis.add('-start', target, 'Slow Start');\n\t\t\t},\n\t\t\tonModifyAtkPriority: 5,\n\t\t\tonModifyAtk: function(atk, pokemon) {\n\t\t\t\tif (pokemon.ability !== 'slowstart') {\n\t\t\t\t\tpokemon.removeVolatile('slowstart');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn this.chainModify(0.5);\n\t\t\t},\n\t\t\tonModifySpe: function(speMod, pokemon) {\n\t\t\t\tif (pokemon.ability !== 'slowstart') {\n\t\t\t\t\tpokemon.removeVolatile('slowstart');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn this.chain(speMod, 0.5);\n\t\t\t},\n\t\t\tonEnd: function(target) {\n\t\t\t\tthis.add('-end', target, 'Slow Start');\n\t\t\t}\n\t\t},\n\t\tid: \"slowstart\",\n\t\tname: \"Slow Start\",\n\t\trating: -2,\n\t\tnum: 112\n\t},\n\t\"sniper\": {\n\t\tdesc: \"When this Pokemon lands a Critical Hit, the damage is increased to another 1.5x.\",\n\t\tshortDesc: \"If this Pokemon strikes with a critical hit, the damage is increased by 50%\",\n\t\tonModifyDamage: function(damage, source, target, move) {\n\t\t\tif (move.crit) {\n\t\t\t\tthis.debug('Sniper boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"sniper\",\n\t\tname: \"Sniper\",\n\t\trating: 1,\n\t\tnum: 97\n\t},\n\t\"snowcloak\": {\n\t\tdesc: \"This Pokemon's Evasion is boosted by 1.25x if the weather is Hail. This Pokemon is also immune to residual Hail damage.\",\n\t\tshortDesc: \"If Hail is active, this Pokemon's evasion is 1.25x; immunity to Hail.\",\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'hail') return false;\n\t\t},\n\t\tonAccuracy: function(accuracy) {\n\t\t\tif (typeof accuracy !== 'number') return;\n\t\t\tif (this.isWeather('hail')) {\n\t\t\t\tthis.debug('Snow Cloak - decreasing accuracy');\n\t\t\t\treturn accuracy * 0.8;\n\t\t\t}\n\t\t},\n\t\tid: \"snowcloak\",\n\t\tname: \"Snow Cloak\",\n\t\trating: 1,\n\t\tnum: 81\n\t},\n\t\"snowwarning\": {\n\t\tdesc: \"When this Pokemon enters the battlefield, the weather becomes Hail (for 5 turns normally, or 8 turns while holding Icy Rock).\",\n\t\tshortDesc: \"On switch-in, the weather becomes Hail.\",\n\t\tonStart: function(source) {\n\t\t\tthis.setWeather('hail');\n\t\t},\n\t\tid: \"snowwarning\",\n\t\tname: \"Snow Warning\",\n\t\trating: 4,\n\t\tnum: 117\n\t},\n\t\"solarpower\": {\n\t\tdesc: \"If the weather is Sunny Day, this Pokemon's Special Attack is 1.5x, but it loses 1/8 of its max HP at the end of every turn.\",\n\t\tshortDesc: \"If Sunny Day is active, this Pokemon's Sp. Atk is 1.5x and loses 1/8 max HP per turn.\",\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(spa, pokemon) {\n\t\t\tif (this.isWeather('sunnyday')) {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tonWeather: function(target, source, effect) {\n\t\t\tif (effect.id === 'sunnyday') {\n\t\t\t\tthis.damage(target.maxhp/8);\n\t\t\t}\n\t\t},\n\t\tid: \"solarpower\",\n\t\tname: \"Solar Power\",\n\t\trating: 1.5,\n\t\tnum: 94\n\t},\n\t\"solidrock\": {\n\t\tdesc: \"Super-effective attacks only deal 3/4 their usual damage against this Pokemon.\",\n\t\tshortDesc: \"This Pokemon receives 3/4 damage from super effective attacks.\",\n\t\tonSourceModifyDamage: function(damage, source, target, move) {\n\t\t\tif (this.getEffectiveness(move, target) > 0) {\n\t\t\t\tthis.debug('Solid Rock neutralize');\n\t\t\t\treturn this.chainModify(0.75);\n\t\t\t}\n\t\t},\n\t\tid: \"solidrock\",\n\t\tname: \"Solid Rock\",\n\t\trating: 3,\n\t\tnum: 116\n\t},\n\t\"soundproof\": {\n\t\tdesc: \"This Pokemon is immune to the effects of sound-based moves, which are: Bug Buzz, Chatter, Echoed Voice, Grasswhistle, Growl, Heal Bell, Hyper Voice, Metal Sound, Perish Song, Relic Song, Roar, Round, Screech, Sing, Snarl, Snore, Supersonic, and Uproar. This ability doesn't affect Heal Bell.\",\n\t\tshortDesc: \"This Pokemon is immune to sound-based moves, except Heal Bell.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.isSoundBased) {\n\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"soundproof\",\n\t\tname: \"Soundproof\",\n\t\trating: 2,\n\t\tnum: 43\n\t},\n\t\"speedboost\": {\n\t\tdesc: \"At the end of every turn, this Pokemon's Speed increases by one stage (except the turn it switched in).\",\n\t\tshortDesc: \"This Pokemon's Speed is boosted by 1 at the end of each full turn on the field.\",\n\t\tonResidualOrder: 26,\n\t\tonResidualSubOrder: 1,\n\t\tonResidual: function(pokemon) {\n\t\t\tif (pokemon.activeTurns) {\n\t\t\t\tthis.boost({spe:1});\n\t\t\t}\n\t\t},\n\t\tid: \"speedboost\",\n\t\tname: \"Speed Boost\",\n\t\trating: 4.5,\n\t\tnum: 3\n\t},\n\t\"stall\": {\n\t\tdesc: \"This Pokemon moves last among Pokemon using the same or greater priority moves.\",\n\t\tshortDesc: \"This Pokemon moves last among Pokemon using the same or greater priority moves.\",\n\t\tonModifyPriority: function(priority) {\n\t\t\treturn priority - 0.1;\n\t\t},\n\t\tid: \"stall\",\n\t\tname: \"Stall\",\n\t\trating: -1,\n\t\tnum: 100\n\t},\n\t\"stancechange\": {\n\t\tdesc: \"Only affects Aegislash. If this Pokemon uses a Physical or Special move, it changes to Blade forme. If this Pokemon uses King's Shield, it changes to Shield forme.\",\n\t\tshortDesc: \"The Pokemon changes form depending on how it battles.\",\n\t\tonBeforeMovePriority: 10,\n\t\tonBeforeMove: function(attacker, defender, move) {\n\t\t\tif (attacker.template.baseSpecies !== 'Aegislash') return;\n\t\t\tif (move.category === 'Status' && move.id !== 'kingsshield') return;\n\t\t\tvar targetSpecies = (move.id === 'kingsshield'?'Aegislash':'Aegislash-Blade');\n\t\t\tif (attacker.template.species !== targetSpecies && attacker.formeChange(targetSpecies)) {\n\t\t\t\tthis.add('-formechange', attacker, targetSpecies);\n\t\t\t}\n\t\t},\n\t\tid: \"stancechange\",\n\t\tname: \"Stance Change\",\n\t\trating: 4.5,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"static\": {\n\t\tdesc: \"If an opponent contact attacks this Pokemon, there is a 30% chance that the opponent will become paralyzed.\",\n\t\tshortDesc: \"30% chance of paralyzing a Pokemon making contact with this Pokemon.\",\n\t\tonAfterDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && effect.isContact) {\n\t\t\t\tif (this.random(10) < 3) {\n\t\t\t\t\tsource.trySetStatus('par', target, effect);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"static\",\n\t\tname: \"Static\",\n\t\trating: 2,\n\t\tnum: 9\n\t},\n\t\"steadfast\": {\n\t\tdesc: \"If this Pokemon flinches, its Speed increases by one stage.\",\n\t\tshortDesc: \"If this Pokemon flinches, its Speed is boosted by 1.\",\n\t\tonFlinch: function(pokemon) {\n\t\t\tthis.boost({spe: 1});\n\t\t},\n\t\tid: \"steadfast\",\n\t\tname: \"Steadfast\",\n\t\trating: 1,\n\t\tnum: 80\n\t},\n\t\"stench\": {\n\t\tdesc: \"This Pokemon's damaging moves that don't already have a flinch chance gain a 10% chance to cause flinch.\",\n\t\tshortDesc: \"This Pokemon's attacks without a chance to flinch have a 10% chance to flinch.\",\n\t\tonModifyMove: function(move) {\n\t\t\tif (move.category !== \"Status\") {\n\t\t\t\tthis.debug('Adding Stench flinch');\n\t\t\t\tif (!move.secondaries) move.secondaries = [];\n\t\t\t\tfor (var i=0; i<move.secondaries.length; i++) {\n\t\t\t\t\tif (move.secondaries[i].volatileStatus === 'flinch') return;\n\t\t\t\t}\n\t\t\t\tmove.secondaries.push({\n\t\t\t\t\tchance: 10,\n\t\t\t\t\tvolatileStatus: 'flinch'\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tid: \"stench\",\n\t\tname: \"Stench\",\n\t\trating: 0,\n\t\tnum: 1\n\t},\n\t\"stickyhold\": {\n\t\tdesc: \"This Pokemon cannot lose its held item due to another Pokemon's attack.\",\n\t\tshortDesc: \"This Pokemon cannot lose its held item due to another Pokemon's attack.\",\n\t\tonTakeItem: function(item, pokemon, source) {\n\t\t\tif (source && source !== pokemon) return false;\n\t\t},\n\t\tid: \"stickyhold\",\n\t\tname: \"Sticky Hold\",\n\t\trating: 1,\n\t\tnum: 60\n\t},\n\t\"stormdrain\": {\n\t\tdesc: \"During double battles, this Pokemon draws any single-target Water-type attack to itself. If an opponent uses an Water-type attack that affects multiple Pokemon, those targets will be hit. This ability does not affect Water Hidden Power, Judgment or Weather Ball. The user is immune to Water and its Special Attack is increased one stage when hit by one.\",\n\t\tshortDesc: \"This Pokemon draws Water moves to itself to boost Sp. Atk by 1; Water immunity.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Water') {\n\t\t\t\tif (!this.boost({spa:1})) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tonAnyRedirectTargetPriority: 1,\n\t\tonAnyRedirectTarget: function(target, source, source2, move) {\n\t\t\tif (move.type !== 'Water') return;\n\t\t\tif (this.validTarget(this.effectData.target, source, move.target)) {\n\t\t\t\tmove.accuracy = true;\n\t\t\t\treturn this.effectData.target;\n\t\t\t}\n\t\t},\n\t\tid: \"stormdrain\",\n\t\tname: \"Storm Drain\",\n\t\trating: 3.5,\n\t\tnum: 114\n\t},\n\t\"strongjaw\": {\n\t\tdesc: \"This Pokemon receives a 50% power boost for jaw attacks such as Bite and Crunch.\",\n\t\tshortDesc: \"This Pokemon's bite-based attacks do 1.5x damage.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (move.isBiteAttack) {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"strongjaw\",\n\t\tname: \"Strong Jaw\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"sturdy\": {\n\t\tdesc: \"This Pokemon is immune to OHKO moves, and will survive with 1 HP if hit by an attack which would KO it while at full health.\",\n\t\tshortDesc: \"If this Pokemon is at full HP, it lives one hit with at least 1HP. OHKO moves fail on it.\",\n\t\tonDamagePriority: -100,\n\t\tonDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && effect.ohko) {\n\t\t\t\tthis.add('-activate',target,'Sturdy');\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif (target.hp === target.maxhp && damage >= target.hp && effect && effect.effectType === 'Move') {\n\t\t\t\tthis.add('-activate',target,'Sturdy');\n\t\t\t\treturn target.hp - 1;\n\t\t\t}\n\t\t},\n\t\tid: \"sturdy\",\n\t\tname: \"Sturdy\",\n\t\trating: 3,\n\t\tnum: 5\n\t},\n\t\"suctioncups\": {\n\t\tdesc: \"This Pokemon cannot be forced to switch out by another Pokemon's attack or item.\",\n\t\tshortDesc: \"This Pokemon cannot be forced to switch out by another Pokemon's attack or item.\",\n\t\tonDragOutPriority: 1,\n\t\tonDragOut: function(pokemon) {\n\t\t\tthis.add('-activate', pokemon, 'ability: Suction Cups');\n\t\t\treturn null;\n\t\t},\n\t\tid: \"suctioncups\",\n\t\tname: \"Suction Cups\",\n\t\trating: 2.5,\n\t\tnum: 21\n\t},\n\t\"superluck\": {\n\t\tdesc: \"This Pokemon's critical hit ratio is boosted by 1.\",\n\t\tshortDesc: \"This Pokemon's critical hit ratio is boosted by 1.\",\n\t\tonModifyMove: function(move) {\n\t\t\tmove.critRatio++;\n\t\t},\n\t\tid: \"superluck\",\n\t\tname: \"Super Luck\",\n\t\trating: 1,\n\t\tnum: 105\n\t},\n\t\"swarm\": {\n\t\tdesc: \"When its health reaches 1/3 or less of its max HP, this Pokemon's Bug-type attacks do 1.5x damage.\",\n\t\tshortDesc: \"When this Pokemon has 1/3 or less of its max HP, its Bug attacks do 1.5x damage.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Bug' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Swarm boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Bug' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Swarm boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"swarm\",\n\t\tname: \"Swarm\",\n\t\trating: 2,\n\t\tnum: 68\n\t},\n\t\"sweetveil\": {\n\t\tdesc: \"Prevents allies from being put to Sleep.\",\n\t\tshortDesc: \"Prevents allies from being put to Sleep.\",\n\t\tid: \"sweetveil\",\n\t\tname: \"Sweet Veil\",\n\t\tonAllySetStatus: function(status, target, source, effect) {\n\t\t\tif (status.id === 'slp') {\n\t\t\t\tthis.debug('Sweet Veil interrupts sleep');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tonAllyTryHit: function(target, source, move) {\n\t\t\tif (move && move.id === 'yawn') {\n\t\t\t\tthis.debug('Sweet Veil blocking yawn');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\trating: 0,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"swiftswim\": {\n\t\tdesc: \"If the weather is Rain Dance, this Pokemon's Speed is doubled.\",\n\t\tshortDesc: \"If the weather is Rain Dance, this Pokemon's Speed is doubled.\",\n\t\tonModifySpe: function(speMod, pokemon) {\n\t\t\tif (this.isWeather('raindance')) {\n\t\t\t\treturn this.chain(speMod, 2);\n\t\t\t}\n\t\t},\n\t\tid: \"swiftswim\",\n\t\tname: \"Swift Swim\",\n\t\trating: 2,\n\t\tnum: 33\n\t},\n\t\"symbiosis\": {\n\t\tdesc: \"This Pokemon immediately passes its item to an ally after their item is consumed.\",\n\t\tshortDesc: \"This Pokemon passes its item to an ally after their item is consumed.\",\n\t\tonAllyAfterUseItem: function(item, pokemon) {\n\t\t\tvar sourceItem = this.effectData.target.takeItem();\n\t\t\tif (!sourceItem) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (pokemon.setItem(sourceItem)) {\n\t\t\t\tthis.add('-activate', pokemon, 'ability: Symbiosis', sourceItem, '[of] '+this.effectData.target);\n\t\t\t}\n\t\t},\n\t\tid: \"symbiosis\",\n\t\tname: \"Symbiosis\",\n\t\trating: 0,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"synchronize\": {\n\t\tdesc: \"If an opponent burns, poisons or paralyzes this Pokemon, it receives the same condition.\",\n\t\tshortDesc: \"If another Pokemon burns/poisons/paralyzes this Pokemon, it also gets that status.\",\n\t\tonAfterSetStatus: function(status, target, source) {\n\t\t\tif (!source || source === target) return;\n\t\t\tif (status.id === 'slp' || status.id === 'frz') return;\n\t\t\tsource.trySetStatus(status, target);\n\t\t},\n\t\tid: \"synchronize\",\n\t\tname: \"Synchronize\",\n\t\trating: 3,\n\t\tnum: 28\n\t},\n\t\"tangledfeet\": {\n\t\tdesc: \"When this Pokemon is confused, attacks targeting it have a 50% chance of missing.\",\n\t\tshortDesc: \"This Pokemon's evasion is doubled as long as it is confused.\",\n\t\tonAccuracy: function(accuracy, target) {\n\t\t\tif (typeof accuracy !== 'number') return;\n\t\t\tif (target && target.volatiles['confusion']) {\n\t\t\t\tthis.debug('Tangled Feet - decreasing accuracy');\n\t\t\t\treturn accuracy * 0.5;\n\t\t\t}\n\t\t},\n\t\tid: \"tangledfeet\",\n\t\tname: \"Tangled Feet\",\n\t\trating: 1,\n\t\tnum: 77\n\t},\n\t\"technician\": {\n\t\tdesc: \"When this Pokemon uses an attack that has 60 Base Power or less (including Struggle), the move's Base Power receives a 50% boost. For example, a move with 60 Base Power effectively becomes a move with 90 Base Power.\",\n\t\tshortDesc: \"This Pokemon's attacks of 60 Base Power or less do 1.5x damage. Includes Struggle.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (basePower <= 60) {\n\t\t\t\tthis.debug('Technician boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"technician\",\n\t\tname: \"Technician\",\n\t\trating: 4,\n\t\tnum: 101\n\t},\n\t\"telepathy\": {\n\t\tdesc: \"This Pokemon will not take damage from its allies' spread moves in double and triple battles.\",\n\t\tshortDesc: \"This Pokemon does not take damage from its allies' attacks.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target.side === source.side && move.category !== 'Status') {\n\t\t\t\tthis.add('-activate', target, 'ability: Telepathy');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"telepathy\",\n\t\tname: \"Telepathy\",\n\t\trating: 0,\n\t\tnum: 140\n\t},\n\t\"teravolt\": {\n\t\tdesc: \"When this Pokemon becomes active, it nullifies the abilities of opposing active Pokemon that hinder this Pokemon's attacks. These abilities include Battle Armor, Clear Body, Damp, Dry Skin, Filter, Flash Fire, Flower Gift, Heatproof, Hyper Cutter, Immunity, Inner Focus, Insomnia, Keen Eye, Leaf Guard, Levitate, Lightningrod, Limber, Magma Armor, Marvel Scale, Motor Drive, Oblivious, Own Tempo, Sand Veil, Shell Armor, Shield Dust, Simple, Snow Cloak, Solid Rock, Soundproof, Sticky Hold, Storm Drain, Sturdy, Suction Cups, Tangled Feet, Thick Fat, Unaware, Vital Spirit, Volt Absorb, Water Absorb, Water Veil, White Smoke and Wonder Guard.\",\n\t\tshortDesc: \"This Pokemon's moves ignore the target's Ability if it could modify the effectiveness.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability', pokemon, 'Teravolt');\n\t\t},\n\t\tonAllyModifyPokemon: function(pokemon) {\n\t\t\tif (this.activePokemon === this.effectData.target && pokemon !== this.activePokemon) {\n\t\t\t\tpokemon.ignore['Ability'] = 'A';\n\t\t\t}\n\t\t},\n\t\tonFoeModifyPokemon: function(pokemon) {\n\t\t\tif (this.activePokemon === this.effectData.target) {\n\t\t\t\tpokemon.ignore['Ability'] = 'A';\n\t\t\t}\n\t\t},\n\t\tid: \"teravolt\",\n\t\tname: \"Teravolt\",\n\t\trating: 3,\n\t\tnum: 164\n\t},\n\t\"thickfat\": {\n\t\tdesc: \"This Pokemon receives half damage from Ice-type and Fire-type attacks.\",\n\t\tshortDesc: \"This Pokemon receives half damage from Fire- and Ice-type attacks.\",\n\t\tonModifyAtkPriority: 6,\n\t\tonSourceModifyAtk: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Ice' || move.type === 'Fire') {\n\t\t\t\tthis.debug('Thick Fat weaken');\n\t\t\t\treturn this.chainModify(0.5);\n\t\t\t}\n\t\t},\n\t\tonModifySpAPriority: 5,\n\t\tonSourceModifySpA: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Ice' || move.type === 'Fire') {\n\t\t\t\tthis.debug('Thick Fat weaken');\n\t\t\t\treturn this.chainModify(0.5);\n\t\t\t}\n\t\t},\n\t\tid: \"thickfat\",\n\t\tname: \"Thick Fat\",\n\t\trating: 3,\n\t\tnum: 47\n\t},\n\t\"tintedlens\": {\n\t\tdesc: \"This Pokemon's attacks that are not very effective on a target do double damage.\",\n\t\tshortDesc: \"This Pokemon's attacks that are not very effective on a target do double damage.\",\n\t\tonModifyDamage: function(damage, source, target, move) {\n\t\t\tif (this.getEffectiveness(move, target) < 0) {\n\t\t\t\tthis.debug('Tinted Lens boost');\n\t\t\t\treturn this.chainModify(2);\n\t\t\t}\n\t\t},\n\t\tid: \"tintedlens\",\n\t\tname: \"Tinted Lens\",\n\t\trating: 4,\n\t\tnum: 110\n\t},\n\t\"torrent\": {\n\t\tdesc: \"When its health reaches 1/3 or less of its max HP, this Pokemon's Water-type attacks do 1.5x damage.\",\n\t\tshortDesc: \"When this Pokemon has 1/3 or less of its max HP, its Water attacks do 1.5x damage.\",\n\t\tonModifyAtkPriority: 5,\n\t\tonModifyAtk: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Water' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Torrent boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tonModifySpAPriority: 5,\n\t\tonModifySpA: function(atk, attacker, defender, move) {\n\t\t\tif (move.type === 'Water' && attacker.hp <= attacker.maxhp/3) {\n\t\t\t\tthis.debug('Torrent boost');\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"torrent\",\n\t\tname: \"Torrent\",\n\t\trating: 2,\n\t\tnum: 67\n\t},\n\t\"toxicboost\": {\n\t\tdesc: \"When this Pokemon is poisoned, its physical attacks do 1.5x damage.\",\n\t\tshortDesc: \"When this Pokemon is poisoned, its physical attacks do 1.5x damage.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif ((attacker.status === 'psn' || attacker.status === 'tox') && move.category === 'Physical') {\n\t\t\t\treturn this.chainModify(1.5);\n\t\t\t}\n\t\t},\n\t\tid: \"toxicboost\",\n\t\tname: \"Toxic Boost\",\n\t\trating: 3,\n\t\tnum: 137\n\t},\n\t\"toughclaws\": {\n\t\tdesc: \"This Pokemon's contact attacks do 1.33x damage.\",\n\t\tshortDesc: \"This Pokemon's contact attacks do 33% more damage.\",\n\t\tonBasePowerPriority: 8,\n\t\tonBasePower: function(basePower, attacker, defender, move) {\n\t\t\tif (move.isContact) {\n\t\t\t\treturn this.chainModify(1.33);\n\t\t\t}\n\t\t},\n\t\tid: \"toughclaws\",\n\t\tname: \"Tough Claws\",\n\t\trating: 3,\n\t\tnum: -6,\n\t\tgen: 6\n\t},\n\t\"trace\": {\n\t\tdesc: \"When this Pokemon enters the field, it temporarily copies an opponent's ability. This ability remains with this Pokemon until it leaves the field.\",\n\t\tshortDesc: \"On switch-in, or when it can, this Pokemon copies a random adjacent foe's Ability.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tvar target = pokemon.side.foe.randomActive();\n\t\t\tif (!target) return;\n\t\t\tvar ability = this.getAbility(target.ability);\n\t\t\tvar bannedAbilities = {flowergift:1, forecast:1, illusion:1, imposter:1, multitype:1, stancechange:1, trace:1, zenmode:1};\n\t\t\tif (bannedAbilities[target.ability]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.add('-ability',pokemon, ability,'[from] ability: Trace','[of] '+target);\n\t\t\tpokemon.setAbility(ability);\n\t\t},\n\t\tid: \"trace\",\n\t\tname: \"Trace\",\n\t\trating: 3.5,\n\t\tnum: 36\n\t},\n\t\"truant\": {\n\t\tdesc: \"After this Pokemon is switched into battle, it skips every other turn.\",\n\t\tshortDesc: \"This Pokemon skips every other turn instead of using a move.\",\n\t\tonBeforeMove: function(pokemon, target, move) {\n\t\t\tif (pokemon.removeVolatile('truant')) {\n\t\t\t\tthis.add('cant',pokemon,'ability: Truant', move);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tpokemon.addVolatile('truant');\n\t\t},\n\t\tonBeforeMovePriority: 99,\n\t\teffect: {\n\t\t\tduration: 2\n\t\t},\n\t\tid: \"truant\",\n\t\tname: \"Truant\",\n\t\trating: -2,\n\t\tnum: 54\n\t},\n\t\"turboblaze\": {\n\t\tdesc: \"When this Pokemon becomes active, it nullifies the abilities of opposing active Pokemon that hinder this Pokemon's attacks. These abilities include Battle Armor, Clear Body, Damp, Dry Skin, Filter, Flash Fire, Flower Gift, Heatproof, Hyper Cutter, Immunity, Inner Focus, Insomnia, Keen Eye, Leaf Guard, Levitate, Lightningrod, Limber, Magma Armor, Marvel Scale, Motor Drive, Oblivious, Own Tempo, Sand Veil, Shell Armor, Shield Dust, Simple, Snow Cloak, Solid Rock, Soundproof, Sticky Hold, Storm Drain, Sturdy, Suction Cups, Tangled Feet, Thick Fat, Unaware, Vital Spirit, Volt Absorb, Water Absorb, Water Veil, White Smoke and Wonder Guard.\",\n\t\tshortDesc: \"This Pokemon's moves ignore the target's Ability if it could modify the effectiveness.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability', pokemon, 'Turboblaze');\n\t\t},\n\t\tonAllyModifyPokemon: function(pokemon) {\n\t\t\tif (this.activePokemon === this.effectData.target && pokemon !== this.activePokemon) {\n\t\t\t\tpokemon.ignore['Ability'] = 'A';\n\t\t\t}\n\t\t},\n\t\tonFoeModifyPokemon: function(pokemon) {\n\t\t\tif (this.activePokemon === this.effectData.target) {\n\t\t\t\tpokemon.ignore['Ability'] = 'A';\n\t\t\t}\n\t\t},\n\t\tid: \"turboblaze\",\n\t\tname: \"Turboblaze\",\n\t\trating: 3,\n\t\tnum: 163\n\t},\n\t\"unaware\": {\n\t\tdesc: \"This Pokemon ignores an opponent's stat boosts for Attack, Defense, Special Attack and Special Defense. These boosts will still affect Base Power calculation for Punishment and Stored Power.\",\n\t\tshortDesc: \"This Pokemon ignores other Pokemon's stat changes when taking or doing damage.\",\n\t\tid: \"unaware\",\n\t\tname: \"Unaware\",\n\t\tonModifyMove: function(move, user, target) {\n\t\t\tmove.ignoreEvasion = true;\n\t\t\tmove.ignoreDefensive = true;\n\t\t},\n\t\tonSourceModifyMove: function(move, user, target) {\n\t\t\tif (user.ability === 'moldbreaker' || user.ability === 'turboblaze' || user.ability === 'teravolt') return;\n\t\t\tmove.ignoreAccuracy = true;\n\t\t\tmove.ignoreOffensive = true;\n\t\t},\n\t\trating: 3,\n\t\tnum: 109\n\t},\n\t\"unburden\": {\n\t\tdesc: \"Doubles this Pokemon's Speed if it loses its held item (such as by eating Berries, using Gems, or via Thief, Knock Off, etc).\",\n\t\tshortDesc: \"Speed is doubled on held item loss; boost is lost if it switches, gets new item/Ability.\",\n\t\tonUseItem: function(item, pokemon) {\n\t\t\tpokemon.addVolatile('unburden');\n\t\t},\n\t\tonTakeItem: function(item, pokemon) {\n\t\t\tpokemon.addVolatile('unburden');\n\t\t},\n\t\teffect: {\n\t\t\tonModifySpe: function(speMod, pokemon) {\n\t\t\t\tif (pokemon.ability !== 'unburden') {\n\t\t\t\t\tpokemon.removeVolatile('unburden');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!pokemon.item) {\n\t\t\t\t\treturn this.chain(speMod, 2);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"unburden\",\n\t\tname: \"Unburden\",\n\t\trating: 3.5,\n\t\tnum: 84\n\t},\n\t\"unnerve\": {\n\t\tdesc: \"While this Pokemon is active, prevents opposing Pokemon from using their Berries.\",\n\t\tshortDesc: \"While this Pokemon is active, prevents opposing Pokemon from using their Berries.\",\n\t\tonStart: function(pokemon) {\n\t\t\tthis.add('-ability',pokemon,'Unnerve',pokemon.side.foe);\n\t\t},\n\t\tonFoeEatItem: false,\n\t\tid: \"unnerve\",\n\t\tname: \"Unnerve\",\n\t\trating: 1,\n\t\tnum: 127\n\t},\n\t\"victorystar\": {\n\t\tdesc: \"Raises every friendly Pokemon's Accuracy, including this Pokemon's, by 10% (multiplied).\",\n\t\tshortDesc: \"This Pokemon and its allies' moves have their accuracy boosted to 1.1x.\",\n\t\tonAllyModifyMove: function(move) {\n\t\t\tif (typeof move.accuracy === 'number') {\n\t\t\t\tmove.accuracy *= 1.1;\n\t\t\t}\n\t\t},\n\t\tid: \"victorystar\",\n\t\tname: \"Victory Star\",\n\t\trating: 2,\n\t\tnum: 162\n\t},\n\t\"vitalspirit\": {\n\t\tdesc: \"This Pokemon cannot fall asleep (Rest will fail if it tries to use it). Gaining this Ability while asleep cures it.\",\n\t\tshortDesc: \"This Pokemon cannot fall asleep. Gaining this Ability while asleep cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.status === 'slp') {\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type) {\n\t\t\tif (type === 'slp') return false;\n\t\t},\n\t\tid: \"vitalspirit\",\n\t\tname: \"Vital Spirit\",\n\t\trating: 2,\n\t\tnum: 72\n\t},\n\t\"voltabsorb\": {\n\t\tdesc: \"This Pokemon is immune to Electric moves. If hit by an Electric move, it recovers 25% of its max HP.\",\n\t\tshortDesc: \"This Pokemon heals 1/4 of its max HP when hit by Electric moves; Electric immunity.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Electric') {\n\t\t\t\tif (!this.heal(target.maxhp/4)) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"voltabsorb\",\n\t\tname: \"Volt Absorb\",\n\t\trating: 3.5,\n\t\tnum: 10\n\t},\n\t\"waterabsorb\": {\n\t\tdesc: \"This Pokemon is immune to Water moves. If hit by an Water move, it recovers 25% of its max HP.\",\n\t\tshortDesc: \"This Pokemon heals 1/4 of its max HP when hit by Water moves; Water immunity.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target !== source && move.type === 'Water') {\n\t\t\t\tif (!this.heal(target.maxhp/4)) {\n\t\t\t\t\tthis.add('-immune', target, '[msg]');\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"waterabsorb\",\n\t\tname: \"Water Absorb\",\n\t\trating: 3.5,\n\t\tnum: 11\n\t},\n\t\"waterveil\": {\n\t\tdesc: \"This Pokemon cannot become burned. Gaining this Ability while burned cures it.\",\n\t\tshortDesc: \"This Pokemon cannot be burned. Gaining this Ability while burned cures it.\",\n\t\tonUpdate: function(pokemon) {\n\t\t\tif (pokemon.status === 'brn') {\n\t\t\t\tpokemon.cureStatus();\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, pokemon) {\n\t\t\tif (type === 'brn') return false;\n\t\t},\n\t\tid: \"waterveil\",\n\t\tname: \"Water Veil\",\n\t\trating: 1.5,\n\t\tnum: 41\n\t},\n\t\"weakarmor\": {\n\t\tdesc: \"Causes physical moves to lower the Pokemon's Defense and increase its Speed stat by one stage.\",\n\t\tshortDesc: \"If a physical attack hits this Pokemon, Defense is lowered 1 and Speed is boosted 1.\",\n\t\tonAfterDamage: function(damage, target, source, move) {\n\t\t\tif (move.category === 'Physical') {\n\t\t\t\tthis.boost({spe:1, def:-1});\n\t\t\t}\n\t\t},\n\t\tid: \"weakarmor\",\n\t\tname: \"Weak Armor\",\n\t\trating: 0,\n\t\tnum: 133\n\t},\n\t\"whitesmoke\": {\n\t\tdesc: \"Opponents cannot reduce this Pokemon's stats; they can, however, modify stat changes with Power Swap, Guard Swap and Heart Swap and inflict stat boosts with Swagger and Flatter. This ability does not prevent self-inflicted stat reductions. [Field Effect]\ If this Pokemon is in the lead spot, the rate of wild Pokemon battles decreases by 50%.\",\n\t\tshortDesc: \"Prevents other Pokemon from lowering this Pokemon's stat stages.\",\n\t\tonBoost: function(boost, target, source, effect) {\n\t\t\tif (source && target === source) return;\n\t\t\tvar showMsg = false;\n\t\t\tfor (var i in boost) {\n\t\t\t\tif (boost[i] < 0) {\n\t\t\t\t\tdelete boost[i];\n\t\t\t\t\tshowMsg = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (showMsg && !effect.secondaries) this.add(\"-fail\", target, \"unboost\", \"[from] ability: White Smoke\", \"[of] \"+target);\n\t\t},\n\t\tid: \"whitesmoke\",\n\t\tname: \"White Smoke\",\n\t\trating: 2,\n\t\tnum: 73\n\t},\n\t\"wonderguard\": {\n\t\tdesc: \"This Pokemon only receives damage from attacks belonging to types that cause Super Effective to this Pokemon. Wonder Guard does not protect a Pokemon from status ailments (burn, freeze, paralysis, poison, sleep, Toxic or any of their side effects or damage), recoil damage nor the moves Beat Up, Bide, Doom Desire, Fire Fang, Future Sight, Hail, Leech Seed, Sandstorm, Spikes, Stealth Rock and Struggle. Wonder Guard cannot be Skill Swapped nor Role Played. Trace, however, does copy Wonder Guard.\",\n\t\tshortDesc: \"This Pokemon can only be damaged by super effective moves and indirect damage.\",\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (target === source || move.category === 'Status' || move.type === '???' || move.id === 'struggle') return;\n\t\t\tthis.debug('Wonder Guard immunity: '+move.id);\n\t\t\tif (this.getEffectiveness(move, target) <= 0) {\n\t\t\t\tthis.add('-activate', target, 'ability: Wonder Guard');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tid: \"wonderguard\",\n\t\tname: \"Wonder Guard\",\n\t\trating: 5,\n\t\tnum: 25\n\t},\n\t\"wonderskin\": {\n\t\tdesc: \"Causes the chance of a status move working to be halved. It does not affect moves that inflict status as a secondary effect like Thunder's chance to paralyze.\",\n\t\tshortDesc: \"All status moves with a set % accuracy are 50% accurate if used on this Pokemon.\",\n\t\tonAccuracyPriority: 10,\n\t\tonAccuracy: function(accuracy, target, source, move) {\n\t\t\tif (move.category === 'Status' && typeof move.accuracy === 'number') {\n\t\t\t\tthis.debug('Wonder Skin - setting accuracy to 50');\n\t\t\t\treturn 50;\n\t\t\t}\n\t\t},\n\t\tid: \"wonderskin\",\n\t\tname: \"Wonder Skin\",\n\t\trating: 3,\n\t\tnum: 147\n\t},\n\t\"zenmode\": {\n\t\tdesc: \"When Darmanitan's HP drops to below half, it will enter Zen Mode at the end of the turn. If it loses its ability, or recovers HP to above half while in Zen mode, it will change back. This ability only works on Darmanitan, even if it is copied by Role Play, Entrainment, or swapped with Skill Swap.\",\n\t\tshortDesc: \"If this Pokemon is Darmanitan, it changes to Zen Mode whenever it is below half HP.\",\n\t\tonResidualOrder: 27,\n\t\tonResidual: function(pokemon) {\n\t\t\tif (pokemon.baseTemplate.species !== 'Darmanitan') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (pokemon.hp <= pokemon.maxhp/2 && pokemon.template.speciesid==='darmanitan'){\n\t\t\t\tpokemon.addVolatile('zenmode');\n\t\t\t} else if (pokemon.hp > pokemon.maxhp/2 && pokemon.template.speciesid==='darmanitanzen') {\n\t\t\t\tpokemon.removeVolatile('zenmode');\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tonStart: function(pokemon) {\n\t\t\t\tif (pokemon.formeChange('Darmanitan-Zen')) {\n\t\t\t\t\tthis.add('-formechange', pokemon, 'Darmanitan-Zen');\n\t\t\t\t\tthis.add('-message', 'Zen Mode triggered! (placeholder)');\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t\tonEnd: function(pokemon) {\n\t\t\t\tif (pokemon.formeChange('Darmanitan')) {\n\t\t\t\t\tthis.add('-formechange', pokemon, 'Darmanitan');\n\t\t\t\t\tthis.add('-message', 'Zen Mode ended! (placeholder)');\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t\tonUpdate: function(pokemon) {\n\t\t\t\tif (pokemon.ability !== 'zenmode') {\n\t\t\t\t\tpokemon.transformed = false;\n\t\t\t\t\tpokemon.removeVolatile('zenmode');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tid: \"zenmode\",\n\t\tname: \"Zen Mode\",\n\t\trating: -1,\n\t\tnum: 161\n\t},\n\n\t// CAP\n\t\"mountaineer\": {\n\t\tdesc: \"This Pokémon avoids all Rock-type attacks and hazards when switching in.\",\n\t\tshortDesc: \"On switch-in, this Pokemon avoids all Rock-type attacks and Stealth Rock.\",\n\t\tonDamage: function(damage, target, source, effect) {\n\t\t\tif (effect && effect.id === 'stealthrock') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tonImmunity: function(type, target) {\n\t\t\tif (type === 'Rock' && !target.activeTurns) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\tid: \"mountaineer\",\n\t\tisNonstandard: true,\n\t\tname: \"Mountaineer\",\n\t\trating: 3.5,\n\t\tnum: -2\n\t},\n\t\"rebound\": {\n\t\tdesc: \"It can reflect the effect of status moves when switching in.\",\n\t\tshortDesc: \"On switch-in, this Pokemon blocks certain status moves and uses the move itself.\",\n\t\tid: \"rebound\",\n\t\tisNonstandard: true,\n\t\tname: \"Rebound\",\n\t\tonTryHitPriority: 1,\n\t\tonTryHit: function(target, source, move) {\n\t\t\tif (this.effectData.target.activeTurns) return;\n\n\t\t\tif (target === source) return;\n\t\t\tif (move.hasBounced) return;\n\t\t\tif (typeof move.isBounceable === 'undefined') {\n\t\t\t\tmove.isBounceable = !!(move.category === 'Status' && (move.status || move.boosts || move.volatileStatus === 'confusion' || move.forceSwitch));\n\t\t\t}\n\t\t\tif (move.isBounceable) {\n\t\t\t\tvar newMove = this.getMoveCopy(move.id);\n\t\t\t\tnewMove.hasBounced = true;\n\t\t\t\tthis.useMove(newMove, target, source);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\tonAllyTryHitSide: function(target, source, move) {\n\t\t\tif (this.effectData.target.activeTurns) return;\n\n\t\t\tif (target.side === source.side) return;\n\t\t\tif (move.hasBounced) return;\n\t\t\tif (typeof move.isBounceable === 'undefined') {\n\t\t\t\tmove.isBounceable = !!(move.category === 'Status' && (move.status || move.boosts || move.volatileStatus === 'confusion' || move.forceSwitch));\n\t\t\t}\n\t\t\tif (move.isBounceable) {\n\t\t\t\tvar newMove = this.getMoveCopy(move.id);\n\t\t\t\tnewMove.hasBounced = true;\n\t\t\t\tthis.useMove(newMove, target, source);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t\teffect: {\n\t\t\tduration: 1\n\t\t},\n\t\trating: 4,\n\t\tnum: -3\n\t},\n\t\"persistent\": {\n\t\tdesc: \"Increases the duration of many field effects by two turns when used by this Pokémon.\",\n\t\tshortDesc: \"The duration of certain field effects is increased by 2 turns if used by this Pokemon.\",\n\t\tid: \"persistent\",\n\t\tisNonstandard: true,\n\t\tname: \"Persistent\",\n\t\t// implemented in the corresponding move\n\t\trating: 4,\n\t\tnum: -4\n\t}\n};\n",
                "subject": "Fix No Guard",
                "message": "Fix No Guard\n\nFix ability causing multi-target moves to always hit all Pokemon",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "forbiddennightmare/Pokemon-Showdown-1,Ridukuo/Test2,Darkshadow6/git-remote-add-scalingo-git-scalingo.com-pokemoonforums,asdfghjklohhnhn/Pokemon-Showdown,MeliodasBH/Articuno-Land,kuroscafe/Showdown-Boilerplate,sama2/Universe-Pokemon-Showdown,Flareninja/Showdown-Boilerplate,Volcos/SpacialGaze,Legit99/Lightning-Storm-Server,TheManwithskills/DS,MeliodasBH/boarhat,PS-Spectral/Spectral,SerperiorBae/PokemonShowdown2,Kevinxzllz/PS-Openshift-Server,QuiteQuiet/Pokemon-Showdown,UniversalMan12/Universe-Server,TheManwithskills/serenity,MasterFloat/LQP-Server-Showdown,SerperiorBae/Pokemon-Showdown-1,Sora-League/Sora,SubZeroo99/Pokemon-Showdown,AnaRitaTorres/Pokemon-Showdown,Alpha-Devs/Alpha-Server,abulechu/Dropp-Pokemon-Showdown,Kevinxzllz/PS-Openshift-Server,Yggdrasil-League/Yggdrasil,Tesarand/Pokemon-Showdown,sirDonovan/Pokemon-Showdown,lFernanl/Zero-Pokemon-Showdown,yashagl/yash-showdown,EmmaKitty/Pokemon-Showdown,TogeSR/Lumen-Pokemon-Showdown,PrimalGallade45/Dropp-Pokemon-Showdown,MayukhKundu/Pokemon-Domain,LightningStormServer/Lightning-Storm,Thiediev/Pokemon-Showdown,ShowdownHelper/Saffron,ehk12/coregit,MeliodasBH/Articuno-Land,Oiawesome/DPPtServ2,SkyeTheFemaleSylveon/Pokemon-Showdown,Flareninja/Pokemon-Showdown,bai2/Dropp,CharizardtheFireMage/Showdown-Boilerplate,Ecuacion/Pokemon-Showdown,danpantry/Pokemon-Showdown,LustyAsh/EOS-Master,JennyPRO/Jenny,TheDiabolicGift/Showdown-Boilerplate,xfix/Pokemon-Showdown,Flareninja/Sora,miahjennatills/Pokemon-Showdown,jd4564/Pokemon-Showdown,lFernanl/Lumen-Pokemon-Showdown,CreaturePhil/Showdown-Boilerplate,HoeenCoder/SpacialGaze,PS-Spectral/Spectral,xCrystal/Pokemon-Showdown,aakashrajput/Pokemon-Showdown,DarkSuicune/Kakuja-2.0,svivian/Pokemon-Showdown,Tesarand/Pokemon-Showdown,MasterFloat/LQP-Server-Showdown,zek7rom/SpacialGaze,Irraquated/Pokemon-Showdown,Raina4uberz/Light-server,TheManwithskills/Dusk--Showdown,DesoGit/TsunamiPS,svivian/Pokemon-Showdown,UniversalMan12/Universe-Server,AWailOfATail/awoat,TogeSR/Lumen-Pokemon-Showdown,Extradeath/advanced,Legit99/Lightning-Storm-Server,TheManwithskills/Server-2,DesoGit/Tsunami_PS,ScottehMax/Pokemon-Showdown,Gold-Solox/Pokemon-Showdown,piiiikachuuu/Pokemon-Showdown,TheManwithskills/Server-2,SerperiorBae/Pokemon-Showdown,DB898/theregalias,Ransei1/Alt,lAlejandro22/lolipoop,Evil-kun/Pokemon-Showdown,Extradeath/advanced,TheManwithskills/DS,Firestatics/omega,Wando94/Spite,comedianchameleon/test,jd4564/Pokemon-Showdown,EienSeiryuu/Pokemon-Showdown,ZeroParadox/ugh,Checkinator/Pokemon-Showdown,SilverTactic/Dragotica-Pokemon-Showdown,miahjennatills/Pokemon-Showdown,JellalTheMage/Jellals-Server,Mystifi/Exiled,KaitoV4X/Showdown,xCrystal/Pokemon-Showdown,Volcos/SpacialGaze,Raina4uberz/Light-server,PauLucario/LQP-Server-Showdown,AWailOfATail/Pokemon-Showdown,yashagl/pokemon-showdown,ZestOfLife/PSserver,EienSeiryuu/Pokemon-Showdown,Sora-Server/Sora,ZestOfLife/PSserver,BuzzyOG/Pokemon-Showdown,Pikachuun/Pokemon-Showdown-SMCMDM,InvalidDN/Pokemon-Showdown,abrulochp/Dropp-Pokemon-Showdown,Enigami/Pokemon-Showdown,urkerab/Pokemon-Showdown,Mystifi/Exiled,RustServer/Pokemon-Showdown,TheManwithskills/New-boiler-test,Checkinator/Pokemon-Showdown,DesoGit/TsunamiPS,TheManwithskills/Server,aakashrajput/Pokemon-Showdown,JellalTheMage/PS-,JellalTheMage/Jellals-Server,TheFenderStory/Pokemon-Showdown,catanatron/pokemon-rebalance,KewlStatics/Showdown-Template,brettjbush/Pokemon-Showdown,TbirdClanWish/Pokemon-Showdown,hayleysworld/serenityserver,KewlStatics/Showdown-Template,Luobata/Pokemon-Showdown,k3naan/Pokemon-Showdown,superman8900/Pokemon-Showdown,abrulochp/Lumen-Pokemon-Showdown,SilverTactic/Showdown-Boilerplate,urkerab/Pokemon-Showdown,HoeenKid/Pokemon-Showdown-Johto,CrestfallPS/Pokemon-Showdown,SerperiorBae/Bae-Showdown,Nineage/Origin,Pikachuun/Joimmon-Showdown,abulechu/Lumen-Pokemon-Showdown,Atwar/server-epilogueleague.rhcloud.com,TheManwithskills/COC,hayleysworld/serenityserver,LightningStormServer/Lightning-Storm,Darkshadow6/git-remote-add-scalingo-git-scalingo.com-pokemoonforums,Pikachuun/Pokemon-Showdown,AvinashSwaminathan/lotus,Zipzapadam/Server,Lord-Haji/SpacialGaze,Pikachuun/Touhoumon-Showdown,LegendBorned/PS-Boilerplate,SerperiorBae/Bae-Showdown-2,piiiikachuuu/Pokemon-Showdown,Zarel/Pokemon-Showdown,SerperiorBae/Bae-Showdown-2,Werfin96/Ultimate,TheManwithskills/Server,Wando94/Pokemon-Showdown,Ridukuo/Test2,Atwar/http-server-femalehq.rhcloud.com-80.psim.us-,NoahVSGamingYT/Pokemon-Showdown,lAlejandro22/lolipoop,SerperiorBae/Pokemon-Showdown-1,sama2/Lumen-Pokemon-Showdown,TheManwithskills/Creature-phil-boiler,hayleysworld/serenityc9,JennyPRO/Jenny,MayukhKundu/Mudkip-Server,ZeroParadox/ugh,superman8900/Pokemon-Showdown,HoeenCoder/SpacialGaze,MeliodasBH/boarhat,Flareninja/Lumen-Pokemon-Showdown,QuiteQuiet/Pokemon-Showdown,SerperiorBae/Bae-Showdown,CharizardtheFireMage/Showdown-Boilerplate,Irraquated/Showdown-Boilerplate,Adithya4Uberz/The-Tsunami-League,kuroscafe/Paradox,Pikachuun/Pokemon-Showdown-SMCMDM,AustinXII/Pokemon-Showdown,gustavo515/test,Flareninja/Sora,BasedGod7/PH,Irraquated/Pokemon-Showdown,FakeSloth/Infinite,KewlStatics/Shit,hayleysworld/serenityc9,Alpha-Devs/Alpha-Server,sama2/Viridian-Pokemon-Showdown,JellalTheMage/PS-,TheFenderStory/Showdown-Boilerplate,CreaturePhil/Pokemon-Showdown,yashagl/pokemon,TheManwithskills/Dusk--Showdown,PrimalGallade45/Lumen-Pokemon-Showdown,KewlStatics/Pokeindia-Codes,panpawn/Pokemon-Showdown,Darkshadow6/PokeMoon-Creation,gustavo515/final,Breakfastqueen/advanced,Flareninja/Hispano-Pokemon-Showdown,LightningStormServer/Lightning-Storm,SkyeTheFemaleSylveon/Mudkip-Server,Extradeath/psserver,Ridukuo/Test,zczd/enculer,Ransei1/Alt,xfix/Pokemon-Showdown,Legendaryhades/Oblivion,Firestatics/Firestatics46,jumbowhales/Pokemon-Showdown,abrulochp/Lumen-Pokemon-Showdown,ankailou/Pokemon-Showdown,Oiawesome/DPPtServ2,TbirdClanWish/Pokemon-Showdown,comedianchameleon/test,Articuno-I/Pokemon-Showdown,Nineage/Origin,danpantry/Pokemon-Showdown,Neosweiss/Pokemon-Showdown,Sora-Server/Sora,Chespin14/Custom-Platform-Pokemon-Showdown,panpawn/Pokemon-Showdown,Kokonoe-san/Glacia-PS,Ecuacion/Lumen-Pokemon-Showdown,anubhabsen/Pokemon-Showdown,Lauc1an/Perulink-Showdown,SerperiorBae/BaeShowdown,Pokemon-Devs/Pokemon-Showdown,Firestatics/Firestatics46,scotchkorean27/Pokemon-Showdown,ScottehMax/Pokemon-Showdown,Ridukuo/Test,svivian/Pokemon-Showdown,SolarisFox/Pokemon-Showdown,VoltStorm/Server-pokemon-showdown,MayukhKundu/Pokemon-Domain,sama2/Dropp-Pokemon-Showdown,kupochu/Pokemon-Showdown,Firestatics/Omega-Alpha,Lord-Haji/SpacialGaze,yashagl/pokecommunity,kotarou3/Krister-Pokemon-Showdown,TheManwithskills/Server---Thermal,hayleysworld/asdfasdf,ehk12/clone,AustinXII/Pokemon-Showdown,HoeenCoder/SpacialGaze,kupochu/Pokemon-Showdown,Darkshadow6/PokeMoon-Creation,lFernanl/Mudkip-Server,yashagl/pokemon,sama2/Dropp-Pokemon-Showdown,Kenny-/Pokemon-Showdown,comedianchameleon/servertest1,megaslowbro1/Showdown-Server-again,MasterFloat/Pokemon-Showdown,Vacate/Pokemon-Showdown,NoahVSGamingYT/Pokemon-Showdown,SolarisFox/Pokemon-Showdown,SilverTactic/Pokemon-Showdown,Disaster-Area/Pokemon-Showdown,SerperiorBae/Bae-Showdown,Guernouille/Pokemon-Showdown,LustyAsh/EOS-Master,KaitoV4X/Showdown,psnsVGC/Wish-Server,ehk12/bigbangtempclone,BlazingAura/Showdown-Boilerplate,ehk12/bigbangtempclone,yashagl/pokecommunity,Guernouille/Pokemon-Showdown,yashagl/pokemon-showdown,catanatron/pokemon-rebalance,kubetz/Pokemon-Showdown,Enigami/Pokemon-Showdown,AvinashSwaminathan/lotus-v2,Vacate/Pokemon-Showdown,Darkshadow6/git-remote-add-scalingo-git-scalingo.com-pokemoonforums,Nineage/Showdown-Boilerplate,hayleysworld/Pokemon-Showdown,Parukia/Pokemon-Showdown,Zarel/Pokemon-Showdown,AWailOfATail/Pokemon-Showdown,Alpha-Devs/OmegaRuby-Server,yashagl/yash-showdown,cadaeic/Pokemon-Showdown,AustinXII/Pokemon-Showdown,Alpha-Devs/OmegaRuby-Server,TheManwithskills/Server-2,MayukhKundu/Technogear-Final,hayleysworld/harmonia,Atwar/ServerClassroom,Mystifi/Exiled,Fusxfaranto/Pokemon-Showdown,CreaturePhil/Showdown-Boilerplate,MayukhKundu/Flame-Savior,urkerab/Pokemon-Showdown,TheDiabolicGift/Showdown-Boilerplate,Stroke123/POKEMON,Darkshadow6/PokeMoon-Creation,SerperiorBae/Pokemon-Showdown,comedianchameleon/test,MayukhKundu/Flame-Savior,Hidden-Mia/Roleplay-PS,abrulochp/Dropp-Pokemon-Showdown,brettjbush/Pokemon-Showdown,Syurra/Pokemon-Showdown,ankailou/Pokemon-Showdown,jumbowhales/Pokemon-Showdown,abulechu/Lumen-Pokemon-Showdown,TheDiabolicGift/Lumen-Pokemon-Showdown,cadaeic/Pokemon-Showdown,megaslowbro1/Pokemon-Showdown,hayleysworld/serenity,Wando94/Spite,DalleTest/Pokemon-Showdown,Atwar/server-epilogueleague.rhcloud.com,Zipzapadam/Server,gustavo515/test,johtooo/PS,ZestOfLife/FestiveLife,anubhabsen/Pokemon-Showdown,RustServer/Pokemon-Showdown,DesoGit/Tsunami_PS,comedianchameleon/servertest1,ZeroParadox/BlastBurners,AWailOfATail/Pokemon-Showdown,hayleysworld/serenity,Evil-kun/Pokemon-Showdown,javi501/Lumen-Pokemon-Showdown,Kill-The-Noise/BlakJack-Boilerplate,TheManwithskills/New-boiler-test,sama2/Lumen-Pokemon-Showdown,iFaZe/SilverZ,Enigami/Pokemon-Showdown,scotchkorean27/Pokemon-Showdown,gustavo515/batata,SSJGVegito007/Vegito-s-Server,kuroscafe/Showdown-Boilerplate,DarkSuicune/Kakuja-2.0,Parukia/Pokemon-Showdown,lFernanl/Pokemon-Showdown,Irraquated/EOS-Master,SerperiorBae/BaeShowdown,Celecitia/Plux-Pokemon-Showdown,Breakfastqueen/advanced,Johto-Serverr/Werfin-Boilerplate,SilverTactic/Pokemon-Showdown,kuroscafe/Paradox,AvinashSwaminathan/Pokelegends,PauLucario/LQP-Server-Showdown,KewlStatics/Shit,Syurra/Pokemon-Showdown,SilverTactic/Showdown-Boilerplate,lFernanl/Pokemon-Showdown,Flareninja/Showdown-Boilerplate,TheFenderStory/Showdown-Boilerplate,BlazingAura/Showdown-Boilerplate,Pablo000/aaa,SerperiorBae/Pokemon-Showdown,SerperiorBae/Pokemon-Showdown-1,panpawn/Gold-Server,iFaZe/SliverX,Breakfastqueen/advanced,Ecuacion/Lumen-Pokemon-Showdown,gustavo515/batata,Irraquated/Showdown-Boilerplate,SkyeTheFemaleSylveon/Pokemon-Showdown,DarkSuicune/Pokemon-Showdown,Firestatics/Omega-Alpha,HoeenCoder/SpacialGaze,megaslowbro1/Pokemon-Showdown-Server-for-megaslowbro1,BuzzyOG/Pokemon-Showdown,Bryan-0/Pokemon-Showdown,Atwar/ServerClassroom,Irraquated/Pokemon-Showdown,MayukhKundu/Mudkip-Server,KewlStatics/Pokeindia-Codes,BuzzyOG/Pokemon-Showdown,hayleysworld/Showdown-Boilerplate,lFernanl/Lumen-Pokemon-Showdown,Flareninja/Sora,Zarel/Pokemon-Showdown,Git-Worm/City-PS,sama2/Universe-Pokemon-Showdown,Pablo000/aaa,KewlStatics/Alliance,PrimalGallade45/Dropp-Pokemon-Showdown,Adithya4Uberz/The-Tsunami-League,theodelhay/test,gustavo515/gashoro,Lord-Haji/SpacialGaze,Pikachuun/Pokemon-Showdown,Flareninja/Hispano-Pokemon-Showdown,ZestOfLife/FestiveLife,sirDonovan/Pokemon-Showdown,megaslowbro1/Pokemon-Showdown,InvalidDN/Pokemon-Showdown,svivian/Pokemon-Showdown,Articuno-I/Pokemon-Showdown,MasterFloat/Pokemon-Showdown,lFernanl/Zero-Pokemon-Showdown,gustavo515/final,TheDiabolicGift/Lumen-Pokemon-Showdown,CreaturePhil/Showdown-Boilerplate,k3naan/Pokemon-Showdown,Ecuacion/Pokemon-Showdown,SSJGVegito007/Vegito-s-Server,SubZeroo99/Pokemon-Showdown,hayleysworld/Showdown-Boilerplate,ZeroParadox/BlastBurners,ehk12/clone,LegendBorned/PS-Boilerplate,Kill-The-Noise/BlakJack-Boilerplate,Extradeath/psserver,Flareninja/Pokemon-Showdown-1,Psyientist/Showdown-Boilerplate,kubetz/Pokemon-Showdown,Enigami/Pokemon-Showdown,megaslowbro1/Pokemon-Showdown-Server-for-megaslowbro1,xfix/Pokemon-Showdown,abulechu/Dropp-Pokemon-Showdown,xfix/Pokemon-Showdown,hayleysworld/harmonia,AvinashSwaminathan/lotus-v3,xfix/Pokemon-Showdown,azum4roll/Pokemon-Showdown,Kokonoe-san/Glacia-PS,panpawn/Gold-Server,Disaster-Area/Pokemon-Showdown,Flareninja/Pokemon-Showdown-1,Psyientist/Showdown-Boilerplate,TheManwithskills/Server---Thermal,gustavo515/gashoro,arkanox/MistShowdown,zek7rom/SpacialGaze,Firestatics/omega,Celecitia/Plux-Pokemon-Showdown,DesoGit/Tsunami_PS,AnaRitaTorres/Pokemon-Showdown,forbiddennightmare/Pokemon-Showdown-1,sirDonovan/Pokemon-Showdown,aakashrajput/Pokemon-Showdown,Git-Worm/City-PS,SerperiorBae/Bae-Showdown-2,Pikachuun/Joimmon-Showdown,CreaturePhil/Pokemon-Showdown,Irraquated/EOS-Master,AbsolitoSweep/Absol-server,Yggdrasil-League/Yggdrasil,Stroke123/POKEMON,ehk12/coregit,jumbowhales/Pokemon-Showdown,psnsVGC/Wish-Server,UniversalMan12/Universe-Server,Tesarand/Pokemon-Showdown,DB898/theregalias,MayukhKundu/Technogear-Final,hayleysworld/asdfasdf,sama2/Viridian-Pokemon-Showdown,Gold-Solox/Pokemon-Showdown,ShowdownHelper/Saffron,bai2/Dropp,TheFenderStory/Pokemon-Showdown,Flareninja/Lumen-Pokemon-Showdown,SerperiorBae/PokemonShowdown2,Parukia/Pokemon-Showdown,SerperiorBae/BaeShowdown,Sora-League/Sora,Elveman/RPCShowdownServer,xCrystal/Pokemon-Showdown,kotarou3/Krister-Pokemon-Showdown,Sora-League/Sora,Hidden-Mia/Roleplay-PS,lFernanl/Mudkip-Server,Bryan-0/Pokemon-Showdown,ShowdownHelper/Saffron,Sora-Server/Sora,panpawn/Gold-Server,Neosweiss/Pokemon-Showdown,zczd/enculer,Flareninja/Pokemon-Showdown,Adithya4Uberz/KTN,megaslowbro1/Showdown-Server-again,Kill-The-Noise/BlakJack-Boilerplate,hayleysworld/Pokemon-Showdown,TheManwithskills/Creature-phil-boiler,PrimalGallade45/Lumen-Pokemon-Showdown,asdfghjklohhnhn/Pokemon-Showdown,TheManwithskills/serenity,javi501/Lumen-Pokemon-Showdown,SkyeTheFemaleSylveon/Mudkip-Server,SilverTactic/Dragotica-Pokemon-Showdown,Wando94/Pokemon-Showdown,Lauc1an/Perulink-Showdown,DalleTest/Pokemon-Showdown,PS-Spectral/Spectral,FakeSloth/Infinite,azum4roll/Pokemon-Showdown,johtooo/PS,AWailOfATail/awoat,DarkSuicune/Pokemon-Showdown,FakeSloth/wulu,Pokemon-Devs/Pokemon-Showdown,Atwar/http-server-femalehq.rhcloud.com-80.psim.us-,EmmaKitty/Pokemon-Showdown,QuiteQuiet/Pokemon-Showdown,svivian/Pokemon-Showdown,MayukhKundu/Technogear,arkanox/MistShowdown,MayukhKundu/Technogear,theodelhay/test,KewlStatics/Alliance,AbsolitoSweep/Absol-server,TheManwithskills/COC,Elveman/RPCShowdownServer"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10298,
            "row": {
                "commit": "12f7e8abf588fafcdb9dc651b15b2dcd96620220",
                "old_file": "src/u-events-movements.js",
                "new_file": "src/u-events-movements.js",
                "old_contents": "/*\nEVENTS\nswipe\ndrag\npinch/zoom/rotate (later)\n\n\n\n\n*\te.start_drag_y - start coord for drag area\n*\te.end_drag_y - end coord for drag area\n*\n*\te.start_input_y - start coord of touch input event\n*\n*\te.current_y - current coord of input\n*\te._y - calculated new coord of element relative to input\n*\te.offset_y - offset between events - to calcilated direction\n*\n\n\nTODO: Calculate processtime based on element size\n\n*/\n\n\nu.e.resetDragEvents = function(node) {\n\t// u.bug(\"reset drag events:\", node);\n\n\tnode._moves_pick = 0;\n\n\tthis.removeEvent(node, \"mousemove\", this._pick);\n\tthis.removeEvent(node, \"touchmove\", this._pick);\n\n\tthis.removeEvent(node, \"mousemove\", this._drag);\n\tthis.removeEvent(node, \"touchmove\", this._drag);\n\n\tthis.removeEvent(node, \"mouseup\", this._drop);\n\tthis.removeEvent(node, \"touchend\", this._drop);\n\n\t//\tthis.removeEvent(node, \"mouseout\", this._snapback);\n\t//\tthis.removeEvent(node, \"mouseout\", this._drop);\n\t//\tthis.removeEvent(node, \"mouseout\", this._drop_mouse);\n\n\tthis.removeEvent(node, \"mouseup\", this._cancelPick);\n\tthis.removeEvent(node, \"touchend\", this._cancelPick);\n\n\n\tthis.removeEvent(node, \"mouseout\", this._dropOut);\n\t// this.removeEvent(node, \"mouseover\", this._drop_over);\n\n\n\n\tthis.removeEvent(node, \"mousemove\", this._scrollStart);\n\tthis.removeEvent(node, \"touchmove\", this._scrollStart);\n\tthis.removeEvent(node, \"mousemove\", this._scrolling);\n\tthis.removeEvent(node, \"touchmove\", this._scrolling);\n\tthis.removeEvent(node, \"mouseup\", this._scrollEnd);\n\tthis.removeEvent(node, \"touchend\", this._scrollEnd);\n\n}\n\n\n/**\n* Detect overlap between element and target\n* Element is using internal position values _x and _y, allowing to test overlap, before moving element\n*\n* Default allows for partial overlap\n* set strict = true for complete overlap\n*\n* return true if overlap is valid\n*/\n\n// calculate overlap of element and target\n// strict = true to look for complete overlap\n// TODO: rewrite\nu.e.overlap = function(node, boundaries, strict) {\n\n\n\t// if target is array of coordinates\n\tif(boundaries.constructor.toString().match(\"Array\")) {\n//\t\tu.bug(\"boundaries are array\")\n\t\tvar boundaries_start_x = Number(boundaries[0]);\n\t\tvar boundaries_start_y = Number(boundaries[1]);\n\t\tvar boundaries_end_x = Number(boundaries[2]);\n\t\tvar boundaries_end_y = Number(boundaries[3]);\n\t}\n\t// target is element\n\telse if(boundaries.constructor.toString().match(\"HTML\")) {\n//\t\tu.bug(\"boundaries are node\")\n\t\tvar boundaries_start_x = u.absX(boundaries) - u.absX(node);\n\t\tvar boundaries_start_y =  u.absY(boundaries) - u.absY(node);\n\t\tvar boundaries_end_x = Number(boundaries_start_x + boundaries.offsetWidth);\n\t\tvar boundaries_end_y = Number(boundaries_start_y + boundaries.offsetHeight);\n\t}\n\t// else {\n\t// \tu.bug(\"no boundaries:\" + boundaries)\n\t// }\n\n\t// element proporties\n\tvar node_start_x = Number(node._x);\n\tvar node_start_y = Number(node._y);\n\tvar node_end_x = Number(node_start_x + node.offsetWidth);\n\tvar node_end_y = Number(node_start_y + node.offsetHeight);\n\n//\tu.bug(\"nsx: \"+node_start_x+\":nsy: \"+node_start_y+\":nex: \"+node_end_x+\":ney: \"+node_end_y);\n//\tu.bug(\"bsx: \"+boundaries_start_x+\":bsy: \"+boundaries_start_y+\":bex: \"+boundaries_end_x+\":bey: \"+boundaries_end_y);\n\n\t// strict - check boundaries\n\t// all boundaries are kept\n\tif(strict) {\n\t\tif(node_start_x >= boundaries_start_x && node_start_y >= boundaries_start_y && node_end_x <= boundaries_end_x && node_end_y <= boundaries_end_y) {\n\t\t\treturn true;\n\t\t}\n\t\telse {\n\t\t\treturn false;\n\t\t}\n\t} \n\t// not strict - out of scope detection (much simpler algoritm)\n\t// elements are not overlapping\n\telse if(node_end_x < boundaries_start_x || node_start_x > boundaries_end_x || node_end_y < boundaries_start_y || node_start_y > boundaries_end_y) {\n\t\treturn false;\n\t}\n\t// elements are overlapping\n\treturn true;\n}\n\n\n/**\n* Drag element e within boundaries specified\n*\n* node - element to be dragged\n* boundary - boundary of dragged element, states as Node or array of outer boundaries relative to node\n\nOptional parameters\n\n* strict - default = true\n- true: object follow mouse precisely\n- false: animates node to projected end coord based on movement speed\n\n* bouncing - default = false\n- animates node to projected end coord based on movement speed - bouncing off boundaries (bouncing not implemented)\n\n* elastica - default = 0\n- drag over boundary and snap back on release - basically a visuel effect\n\n* dropout - default = true\n- drop element on mouseout (safety feature to avoid loosing drag/node relation)\n\n* CONSIDER: processtime for fallback methods - not implemented\n* processtime - miliseconds between updates. Large elements should be updated less frequent. Default = 50\n\n*\n* Notifies:\n* element.picked\n* element.moved\n* element.dropped\n*/\n//this.drag = function(e, target, strict, snapback, process_time) {\n\n// it is important to do as many calculation beforehand to make event handling as fast as possible\n// if you do too many calculations on each event dragging will be lagging and ... well crappy.\nu.e.drag = function(node, boundaries, _options) {\n\t// u.bug(\"set drag:\", node);\n\n\tnode.e_drag_options = _options ? _options : {};\n\n\tnode.e_drag = true;\n\n//\tnode._moves_counted = 0;\n//\tnode._moves_required = (u.system(\"android, winphone\")) ? 2 : 0;\n//\tnode._moves_required = 5;\n\n\t// check for empty node\n\tif(node.childNodes.length < 2 && node.innerHTML.trim() == \"\") {\n\t\tnode.innerHTML = \"&nbsp;\";\n\t}\n\n\t// radius for movement after mousedown/touchstart before element is \"picked\"\n\t// a simple click will not cause a pick\n\t// shifted from counting move-events because new phones thow 5 moveevent events on a tap (sensitive screen, powerful chips) - now we measure the distance travelled in those movements, to know if the user shows intent of dragging\n\tnode.distance_to_pick = 2;\n\n\t// default values\n\tnode.drag_strict = true;\n\tnode.drag_overflow = false;\n//\tnode.drag_projection = false;\n\tnode.drag_elastica = 0;\n\tnode.drag_dropout = true;\n\n\t// debug displaying of boundaries\n\t// TODO: needs to be updated\n\tnode.show_bounds = false;\n\n\t// default callbacks\n\tnode.callback_ready = \"ready\";\n\tnode.callback_picked = \"picked\";\n\tnode.callback_moved = \"moved\";\n\tnode.callback_dropped = \"dropped\";\n\n\n\t// additional info passed to function as JSON object\n\tif(obj(_options)) {\n\t\tvar _argument;\n\t\tfor(_argument in _options) {\n\n\t\t\tswitch(_argument) {\n\t\t\t\tcase \"strict\"\t\t\t: node.drag_strict\t\t\t= _options[_argument]; break;\n\t\t\t\tcase \"overflow\"\t\t\t: node.drag_overflow\t\t= _options[_argument]; break;\n//\t\t\t\tcase \"projection\"\t\t: node.drag_projection\t\t= _options[_argument]; break;\n\t\t\t\tcase \"elastica\"\t\t\t: node.drag_elastica\t\t= Number(_options[_argument]); break;\n\t\t\t\tcase \"dropout\"\t\t\t: node.drag_dropout\t\t\t= _options[_argument]; break;\n\n\t\t\t\tcase \"show_bounds\"\t\t: node.show_bounds\t\t\t= _options[_argument]; break; // NEEDS HELP\n\n\t\t\t\tcase \"vertical_lock\"\t: node.vertical_lock\t\t= _options[_argument]; break;\n\t\t\t\tcase \"horizontal_lock\"\t: node.horizontal_lock\t\t= _options[_argument]; break;\n\n\t\t\t\tcase \"callback_picked\"\t: node.callback_picked\t\t= _options[_argument]; break;\n\t\t\t\tcase \"callback_moved\"\t: node.callback_moved\t\t= _options[_argument]; break;\n\t\t\t\tcase \"callback_dropped\"\t: node.callback_dropped\t\t= _options[_argument]; break;\n\t\t\t}\n\n\t\t}\n\t}\n\n\n//\tnode.process_time = process_time ? process_time : 0;\n\n\tu.e.setDragBoundaries(node, boundaries);\n\n\tu.e.addStartEvent(node, this._inputStart);\n\n\n\t// notify of movement\n\tif(fun(node[node.callback_ready])) {\n\t\tnode[node.callback_ready](event);\n\t}\n}\n\n\n/**\n* Input picks element - handler\n* Sets default values for following inputDrag\n*\n* Calls return function element.picked to notify of event\n*/\nu.e._pick = function(event) {\n\t// u.bug(\"_pick:\", this, this._x + \" x \" + this._y + \", \" + this.only_horizontal + \", \" + this.only_vertical);\n\n\n\t// reset inital events to avoid unintended bubbling - only reset if pick makes sense\n//\tu.e.resetNestedEvents(this);\n\n\n\t// detect if drag is relevant for element\n\t// if only vertical drag is allowed, only react on vertical movements\n\t// if only horizontal drag is allowed, only react on horizontal movements\n\t// to do this we calculate the vertical and horizontal speeds\n//\tvar init_speed_x = Math.abs(this.start_event_x - u.eventX(event) - u.scrollX());\n//\tvar init_speed_y = Math.abs(this.start_event_y - u.eventY(event) - u.scrollY());\n\tvar init_speed_x = Math.abs(this.start_event_x - u.eventX(event));\n\tvar init_speed_y = Math.abs(this.start_event_y - u.eventY(event));\n\n\t// u.bug(\"this.start_event_x:\" + this.start_event_x + \",this.start_event_y:\" + this.start_event_y)\n\t// u.bug(\"u.eventX:\" + u.eventX(event) + \",u.eventY:\" + u.eventY(event))\n//\tu.bug(\"initial speed:\" + init_speed_x + \"/\" + init_speed_y + \", vert:\" + this.only_vertical + \", hori:\" + this.only_horizontal);\n\n/*\n\nabs(a - b)\n\nx: -2 -> 2 = 4 (-2 - 2)\ny: 2 -> 3 = 1 (2 - 3)\n\nx: 2 -> 5 = 3 (2 - 5)\ny: 1 -> 4 = 3 (1 - 4)\n\nx: 2 -> -4 = 6 (2 - -4)\ny: 1 -> 3 = 2 (1 - 3)\n\nx: 2 -> -4 = 6 (2 - -4)\ny: -3 -> 4 = 7 (-3 - 4)\n\nx: 2 -> 3 = 1 (2 - 3)\ny: 3 -> -2 = 5 (3 - -2)\n\n*/\n\n//\tu.bug(init_speed_x + \", \" + init_speed_y);\n\n\tif(\n\t\t(init_speed_x > init_speed_y && this.only_horizontal) || \n\t\t(init_speed_x < init_speed_y && this.only_vertical) ||\n\t\t(!this.only_vertical && !this.only_horizontal)) {\n\n\t\t// u.bug(\"valid pick:\", this, this._moves_counted + \", \" + this._moves_required);\n\n//\t\tif(this._moves_counted >= this._moves_required) {\n\t\tif((init_speed_x > this.distance_to_pick || init_speed_y > this.distance_to_pick)) {\n\n\t\t\t// reset moves count\n//\t\t\tthis._moves_counted = 0;\n\n//\t\t\tu.bug(\"actual pick:\", this);\n\n\t\t\t// reset inital events to avoid unintended bubbling if pick direction makes sense\n\t\t\tu.e.resetNestedEvents(this);\n\n\t\t\t// kill event to prevent dragging deeper element\n\t\t\t// could possibly be forced into callback to allow for double drag (but don't see point at current time)\n\t\t\tu.e.kill(event);\n\n\t\t\t// detect fixed parent state\n\t\t\tif(u.hasFixedParent(this)) {\n\t\t\t\tthis.has_fixed_parent = true;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.has_fixed_parent = false;\n\t\t\t}\n\n\t\t\t// set initial move timestamp - used to calculate speed\n\t//\t\tthis.move_timestamp = new Date().getTime();\n\t\t\tthis.move_timestamp = event.timeStamp;\n\t\t\tthis.move_last_x = this._x;\n\t\t\tthis.move_last_y = this._y;\n\n\t\t\t// relative to screen - compensate scroll-offset for fixed elements \n\t\t\tif(u.hasFixedParent(this)) {\n\t\t\t\tthis.start_input_x = u.eventX(event) - this._x - u.scrollX(); \n\t\t\t\tthis.start_input_y = u.eventY(event) - this._y - u.scrollY();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.start_input_x = u.eventX(event) - this._x; \n\t\t\t\tthis.start_input_y = u.eventY(event) - this._y;\n\t\t\t}\n\n\n\t\t\t// reset current speed\n\t\t\tthis.current_xps = 0;\n\t\t\tthis.current_yps = 0;\n\n\n\t\t\t// remove transitions if any\n\t\t\tu.a.transition(this, \"none\");\n\n\n\t\t\t// reset events and setting drag events\n\t\t\tu.e.addMoveEvent(this, u.e._drag);\n\t\t\tu.e.addEndEvent(this, u.e._drop);\n\n\t\t\t// notify of pick\n\t\t\tif(fun(this[this.callback_picked])) {\n\t\t\t\tthis[this.callback_picked](event);\n\t\t\t}\n\n\t\t\t// Undesired effect when sliding the presentation, could be enabled for small elements in large scopes using mouse\n\t\t\tif(this.drag_dropout && event.type.match(/mouse/)) {\n\t\t\t\t// u.bug(\"set mouseout event cancel:\", this);\n\t//\t\t\tu.e.addEvent(this, \"mouseout\", u.e._drop_mouse);\n\n\t\t\t\t// u.e._drop_over = function(event) {\n\t\t\t\t// \tu.t.resetTimer(this.t_drop_out);\n\t\t\t\t// \tu.bug(\"_drop_over:\", this, event.target);\n\t\t\t\t// }\n\t\t\t\t// this.__out = function(event) {\n\t\t\t\t//\n\t\t\t\t\t// \tu.bug(\"_drop_out:\", this, event.target);\n\t\t\t\t//\n\t\t\t\t// \t// if(event.target == this) {\n\t\t\t\t// \t// \tthis._drop = u.e._drop;\n\t\t\t\t// \t// \tthis._drop(event);\n\t\t\t\t// \t// }\n\t\t\t\t// \t// else {\n\t\t\t\t// //\t\tevent = {\"type\":\"mouseout\", \"target\":this};\n\t\t\t\t// \t\tthis.t_drop_out = u.t.setTimer(this, u.e._drop_out_is_real, 100, event);\n\t\t\t\t// //\t}\n\t\t\t\t// \t//\n\t\t\t\t// }\n\t\t\t\t// this.__out = function(event) {\n\t\t\t\t//\n\t\t\t\t// \tu.bug(\"_drop_out_is_real:\", this, event.target);\n\t\t\t\t//\n\t\t\t\t// \tthis._drop = u.e._drop;\n\t\t\t\t// \tthis._drop({\"type\":\"mouseout\", \"target\":this});\n\t\t\t\t//\n\t\t\t\t// }\n\t//\t\t\tu.e.hover(this, {\"out\":\"drop_out\"});\n\n\t\t\t\t// map _drag funktion to node to enable drop_out handling\n\t\t\t\tthis._dropOutDrag = u.e._drag;\n\t\t\t\tthis._dropOutDrop = u.e._drop;\n\n//\t\t\t\tu.e.addOverEvent(this, u.e._drop_over);\n\t\t\t\tu.e.addOutEvent(this, u.e._dropOut);\n\t\t\t}\n\n\t\t}\n\t\t// else {\n\t\t// \tthis._moves_counted++;\n\t\t// }\n\n\t}\n\n\n\n\t// Undesired effect when sliding the presentation, could be enabled for small elements in large scopes using mouse\n\t// if(this.drag_dropout && u.e.event_pref == \"mouse\") {\n\t\t// \tu.bug(\"set mouseout event cancel:\", this);\n\t// \tu.e.addEvent(this, \"mouseout\", u.e._drop_mouse);\n\t// }\n\n}\n\n/**\n* Drags element, within boundaries set in inputPick\n* Calls return function element.moved to notify of event\n*/\nu.e._drag = function(event) {\n//\tu.bug(\"_drag:\", this, event.timeStamp, Date.now());\n\n\t// Get current input coordinates relative to starting point\n//\tif(u.hasFixedParent(this)) {\n\tif(this.has_fixed_parent) {\n\t\tthis.current_x = u.eventX(event) - this.start_input_x - u.scrollX();\n\t\tthis.current_y = u.eventY(event) - this.start_input_y - u.scrollY();\n\t}\n\telse {\n\t\tthis.current_x = u.eventX(event) - this.start_input_x;\n\t\tthis.current_y = u.eventY(event) - this.start_input_y;\n\t}\n\n\n\t// TODO: error - when locked, speed is calculated from start drag point, should always be speed since last event\n\t// this.current_xps = Math.round(((this.current_x - this._x) / (event.timeStamp - this.move_timestamp)) * 1000);\n\t// this.current_yps = Math.round(((this.current_y - this._y) / (event.timeStamp - this.move_timestamp)) * 1000);\n\n\t// current speed per second\n\tthis.current_xps = Math.round(((this.current_x - this.move_last_x) / (event.timeStamp - this.move_timestamp)) * 1000);\n\tthis.current_yps = Math.round(((this.current_y - this.move_last_y) / (event.timeStamp - this.move_timestamp)) * 1000);\n//\tu.bug(this.current_x + \":\" + this.move_last_x + \":\" + event.timeStamp + \":\" + this.move_timestamp)\n//\tu.bug(\"this.current_xps:\" + this.current_xps + \" x \" + \"this.current_yps:\" + this.current_yps)\n\n\n\t// Get an idea of the direction, even when acceleration has stopped\n\tthis.last_x_distance_travelled = (this.current_xps) ? this.current_x - this.move_last_x : this.last_x_distance_travelled;\n\tthis.last_y_distance_travelled = (this.current_yps) ? this.current_y - this.move_last_y : this.last_y_distance_travelled;\n\t// u.bug(\"last_x_distance_travelled:\" + this.last_x_distance_travelled, \"last_y_distance_travelled:\" + this.last_y_distance_travelled);\n\n\t// remember current move time for next event\n\tthis.move_timestamp = event.timeStamp;\n\tthis.move_last_x = this.current_x;\n\tthis.move_last_y = this.current_y;\n\n\t// element can only be dragged vertically\n\tif(!this.locked && this.only_vertical) {\n\t\t// only set new y\n\t\tthis._y = this.current_y;\n\t}\n\t// element can only be dragged horizontally\n\telse if(!this.locked && this.only_horizontal) {\n\t\t// only set new x\n\t\tthis._x = this.current_x;\n\t}\n\t// free drag (within boundaries)\n\telse if(!this.locked) {\n\t\tthis._x = this.current_x;\n\t\tthis._y = this.current_y;\n\t}\n\n//\tu.bug(\"locked:\" + this.locked + \", \" + this.only_horizontal + \", \" + this.only_vertical);\n\n\tif(this.e_swipe) {\n\t\t// u.bug(\"swiping:\" + this.locked + \", \" + this.only_horizontal + \", \" + this.only_vertical + \", \" + Math.abs(this.current_xps) + \":\" + Math.abs(this.current_yps));\n\t\t// u.bug(this, this.current_x, this.current_xps, this.move_last_x);\n\n\t\tif(this.only_horizontal) {\n\n//\t\t\tu.bug(\"only_horizontal\")\n\t\t\tif(this.current_xps < 0 || this.current_xps === 0 && this.last_x_distance_travelled < 0) {\n\t\t\t\tthis.swiped = \"left\";\n//\t\t\t\tu.bug(\"id swiped left\")\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.swiped = \"right\";\n//\t\t\t\tu.bug(\"id swiped right\")\n\t\t\t}\n\n\t\t}\n\t\telse if(this.only_vertical) {\n\n\t\t\tif(this.current_yps < 0 || this.current_yps === 0 && this.last_y_distance_travelled < 0) {\n\t\t\t\tthis.swiped = \"up\";\n//\t\t\t\tu.bug(\"id swiped up\")\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.swiped = \"down\";\n//\t\t\t\tu.bug(\"id swiped down\")\n\t\t\t}\n\n\t\t}\n\t\telse {\n\n\t\t\tif(Math.abs(this.current_xps) > Math.abs(this.current_yps)) {\n\t\t\t\tif(this.current_xps < 0) {\n\t\t\t\t\tthis.swiped = \"left\";\n//\t\t\t\t\tu.bug(\"id swiped left\")\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.swiped = \"right\";\n//\t\t\t\t\tu.bug(\"id swiped right\")\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(Math.abs(this.current_xps) < Math.abs(this.current_yps)) {\n\t\t\t\tif(this.current_yps < 0) {\n\t\t\t\t\tthis.swiped = \"up\";\n//\t\t\t\t\tu.bug(\"id swiped up\")\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.swiped = \"down\";\n//\t\t\t\t\tu.bug(\"id swiped down\")\n\t\t\t\t}\n\t\t\t}\n\t\t}\n// \t\t// calc swipes event for locked elements\n// \t\tif((Math.abs(this.current_xps) > Math.abs(this.current_yps) || this.only_horizontal)) {\n// //\t\tif(this.current_xps && (Math.abs(this.current_xps) > Math.abs(this.current_yps) || this.only_horizontal)) {\n// \t\t\tu.bug(\"only_horizontal\")\n// \t\t\tif(this.current_xps < 0) {\n// \t\t\t\tthis.swiped = \"left\";\n// \t\t\t\tu.bug(\"id swiped left\")\n// \t\t\t}\n// \t\t\telse {\n// \t\t\t\tthis.swiped = \"right\";\n// \t\t\t\tu.bug(\"id swiped right\")\n// \t\t\t}\n// \t\t}\n// \t\telse if((Math.abs(this.current_xps) < Math.abs(this.current_yps) || this.only_vertical)) {\n// //\t\telse if(this.current_yps && (Math.abs(this.current_xps) < Math.abs(this.current_yps) || this.only_vertical)) {\n// \t\t\tu.bug(\"only_vertical\")\n// \t\t\tif(this.current_yps < 0) {\n// \t\t\t\tthis.swiped = \"up\";\n// \t\t\t\tu.bug(\"id swiped up\")\n// \t\t\t}\n// \t\t\telse {\n// \t\t\t\tthis.swiped = \"down\";\n// \t\t\t\tu.bug(\"id swiped down\")\n// \t\t\t}\n// \t\t}\n\t}\n\n\n\t// only perform overlap test and movement if the drag element is not locked\n\tif(!this.locked) {\n//\t\tu.bug(\"not locked\")\n\n\t\t// Move element if strict boundaries are kept\n\t\tif(u.e.overlap(this, [this.start_drag_x, this.start_drag_y, this.end_drag_x, this.end_drag_y], true)) {\n//\t\t\tu.bug(\"in scope\");\n\n//\t\t\tu.bug(\"translate:\" + this._x+\",\"+ this._y)\n\t\t\tu.a.translate(this, this._x, this._y);\n\n\t\t}\n\n\t\t// Out of scope\n\n\t\t// elastica - boundaries can be crossed with elastica\n\t\telse if(this.drag_elastica) {\n//\t\t\tu.bug(\"out of scope, with elastica\")\n\n\t\t\t// reset detected swipe\n\t\t\tthis.swiped = false;\n\n\t\t\t// reset speed\n\t\t\tthis.current_xps = 0;\n\t\t\tthis.current_yps = 0;\n\n\n\t\t\tvar offset = false;\n\n\t\t\t// correct overflow\n\t\t\t// if overflow found:\n\t\t\t// - get offset (corrected for allowed offset)\n\t\t\t// - set correct _x (for snapback function on drop)\n\t\t\t// - set temorary element x (calculated by drag, allowed_offset and elestica)\n\t\t\t// right out of scope and not locked vertically\n\t\t\tif(!this.only_vertical && this._x < this.start_drag_x) {\n\t\t\t\toffset = this._x < this.start_drag_x - this.drag_elastica ? - this.drag_elastica : this._x - this.start_drag_x;\n\t\t\t\tthis._x = this.start_drag_x;\n\t\t\t\tthis.current_x = this._x + offset + (Math.round(Math.pow(offset, 2)/this.drag_elastica));\n\t\t\t}\n\t\t\t// left out of scope and not locked vertically\n\t\t\telse if(!this.only_vertical && this._x + this.offsetWidth > this.end_drag_x) {\n\t\t\t\toffset = this._x + this.offsetWidth > this.end_drag_x + this.drag_elastica ? this.drag_elastica : this._x + this.offsetWidth - this.end_drag_x;\n\t\t\t\tthis._x = this.end_drag_x - this.offsetWidth;\n\t\t\t\tthis.current_x = this._x + offset - (Math.round(Math.pow(offset, 2)/this.drag_elastica));\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.current_x = this._x;\n\t\t\t}\n\n\t\t\t// top out of scope\n\t\t\tif(!this.only_horizontal && this._y < this.start_drag_y) {\n\t\t\t\toffset = this._y < this.start_drag_y - this.drag_elastica ? - this.drag_elastica : this._y - this.start_drag_y;\n\t\t\t\tthis._y = this.start_drag_y;\n\t\t\t\tthis.current_y = this._y + offset + (Math.round(Math.pow(offset, 2)/this.drag_elastica));\n//\t\t\t\tu.bug(\"oos0\"+offset);\n\t\t\t}\n\t\t\t// bottom out of scope\n\t\t\telse if(!this.horizontal && this._y + this.offsetHeight > this.end_drag_y) {\n\t\t\t\toffset = (this._y + this.offsetHeight > this.end_drag_y + this.drag_elastica) ? this.drag_elastica : (this._y + this.offsetHeight - this.end_drag_y);\n\t\t\t\tthis._y = this.end_drag_y - this.offsetHeight;\n\t\t\t\tthis.current_y = this._y + offset - (Math.round(Math.pow(offset, 2)/this.drag_elastica));\n//\t\t\t\tu.bug(\"oos1\"+offset);\n\t\t\t}\n\t\t\telse {\n//\t\t\t\tu.bug(\"oos2\"+offset);\n\t\t\t\tthis.current_y = this._y;\n\t\t\t}\n\n\t\t\t// if offset found, move to these coordinates\n\t\t\tif(offset) {\n//\t\t\t\tu.bug(\"offset\"+offset)\n//\t\t\t\tu.bug(\"offset:\" + this._x+\",\"+ this._y)\n\t\t\t\tu.a.translate(this, this.current_x, this.current_y);\n\t\t\t}\n\n\t\t}\n\t\t// correct out of bounds coord\n\t\telse {\n//\t\t\tu.bug(\"out of scope\", \"red\")\n\t\t\t\n\n\t\t\t// reset detected swipe\n\t\t\tthis.swiped = false;\n\n\t\t\t// reset speed\n\t\t\tthis.current_xps = 0;\n\t\t\tthis.current_yps = 0;\n\n\n\t\t\tif(this._x < this.start_drag_x) {\n\t\t\t\tthis._x = this.start_drag_x;\n\t\t\t}\n\t\t\telse if(this._x + this.offsetWidth > this.end_drag_x) {\n\t\t\t\tthis._x = this.end_drag_x - this.offsetWidth;\n\t\t\t}\n\n\t\t\tif(this._y < this.start_drag_y) {\n\t\t\t\tthis._y = this.start_drag_y;\n\t\t\t}\n\t\t\telse if(this._y + this.offsetHeight > this.end_drag_y) { \n\t\t\t\tthis._y = this.end_drag_y - this.offsetHeight;\n\t\t\t}\n\n\t\t\t// set corrected values\n\t\t\tu.a.translate(this, this._x, this._y);\n\t\t}\n\n\t}\n\n\t// notify of movement\n\tif(fun(this[this.callback_moved])) {\n\t\tthis[this.callback_moved](event);\n\t}\n\t// if(fun(this.moved)) {\n\t// \tthis.moved(event);\n\t// }\n\n}\n\n/**\n* Input drops element\n*\n* Calls return function element.dropped to notify of event\n*/\nu.e._drop = function(event) {\n//\tu.bug(\"_drop:\", this, event.type, this.swiped);\n\n\t// reset events to prepare for new drag\n\tu.e.resetEvents(this);\n\n\n\t// return swipe events to handlers\n\tif(this.e_swipe && this.swiped) {\n//\t\tu.bug(\"_drop swiped:\"+this.swiped);\n\n\n\t\t// set appropriate eventAction if it does not exist\n\t\tthis.e_swipe_options.eventAction = \"Swiped \"+ this.swiped;\n\t\t// track event\n\t\tu.stats.event(this, this.e_swipe_options);\n\n\n\t\tif(this.swiped == \"left\" && fun(this.swipedLeft)) {\n\t\t\tthis.swipedLeft(event);\n\t\t}\n\t\telse if(this.swiped == \"right\" && fun(this.swipedRight)) {\n\t\t\tthis.swipedRight(event);\n\t\t}\n\t\telse if(this.swiped == \"down\" && fun(this.swipedDown)) {\n\t\t\tthis.swipedDown(event);\n\t\t}\n\t\telse if(this.swiped == \"up\" && fun(this.swipedUp)) {\n\t\t\tthis.swipedUp(event);\n\t\t}\n//\t\tthis.swiped = false;\n//\t\tu.bug(this.swiped);\n\t\t\n\t}\n\t// else transition element into place\n\t\n\n\n//\telse if(!this.drag_strict && !this.locked && this.start_input_x && this.start_input_y) {\n\n\t// projection is enabled\n\telse if(!this.drag_strict && !this.locked) {\n//\t\tu.bug(\"project ending\")\n//\t\tu.bug(\"if(!this.drag_strict && !this.locked)\");\n\n\t\t// block init values\n\t\t// this.start_input_x = false;\n\t\t// this.start_input_y = false;\n\n\t\t// get projected coords based on current speed (devided by 2 for better visual effect)\n\t\tthis.current_x = Math.round(this._x + (this.current_xps/2));\n\t\tthis.current_y = Math.round(this._y + (this.current_yps/2));\n\n\n\t\t// correct out of scope values for projected coordinates\n\t\tif(this.only_vertical || this.current_x < this.start_drag_x) {\n\t\t\tthis.current_x = this.start_drag_x;\n\t\t}\n\t\telse if(this.current_x + this.offsetWidth > this.end_drag_x) {\n\t\t\tthis.current_x = this.end_drag_x - this.offsetWidth;\n\t\t}\n\t\tif(this.only_horizontal || this.current_y < this.start_drag_y) {\n\t\t\tthis.current_y = this.start_drag_y;\n\t\t}\n\t\telse if(this.current_y + this.offsetHeight > this.end_drag_y) {\n\t\t\tthis.current_y = this.end_drag_y - this.offsetHeight;\n\t\t}\n\n\n\t\t// callback for projection\n\t\tthis.transitioned = function() {\n\t\t\t// this.transitioned = null;\n\t\t\t// u.a.transition(this, \"none\");\n\n\t\t\tif(fun(this.projected)) {\n\t\t\t\tthis.projected(event);\n\t\t\t}\n\t\t}\n\n\n\t\t// if speed is not 0, execute projection\n\t\tif(this.current_xps || this.current_yps) {\n//\t\t\tu.bug(\"speed\")\n\t\t\tu.a.transition(this, \"all 1s cubic-bezier(0,0,0.25,1)\");\n\t\t}\n\t\t// no speed, no transition\n\t\telse {\n//\t\t\tu.bug(\"no speed\")\n//\t\t\tu.a.transition(this, \"all 0.2s cubic-bezier(0,0,0.25,1)\");\n\t\t\tu.a.transition(this, \"none\");\n\t\t\t// console.log(this.transitioned);\n\t\t}\n\n\t\t// execute projection\n\t\tu.a.translate(this, this.current_x, this.current_y);\n\t}\n\t\n\tif(this.e_drag && !this.e_swipe) {\n//\t\tu.bug(\"drop tracked\")\n\n\t\t// set appropriate eventAction if it does not exist\n\t\tthis.e_drag_options.eventAction = u.stringOr(this.e_drag_options.eventAction, \"Dropped\");\n\t\t// track event\n\t\tu.stats.event(this, this.e_drag_options);\n\t\n\t}\n\n\t// notify of drop\n\tif(fun(this[this.callback_dropped])) {\n\t\tthis[this.callback_dropped](event);\n\t}\n\n\n\t// if(fun(this.dropped)) {\n\t// \tthis.dropped(event);\n\t// }\n\n}\n\n// handle drop outs (when dragging is faster than rendering)\n// enhanced drop out function attempting to catch up to mouse on mouseout\n// start a document move listener loop to pass mouse coords back to _drag - until mouseover is invoked again, which\n// means element has caught up with mouse (or mouseup occurs on document)\nu.e._dropOut = function(event) {\n\t//\tu.bug(\"_drop_out:\", this, event.target, event.timeStamp, this.move_timestamp);\n\n\tthis._drop_out_id = u.randomString();\n//\t\tu.ac(node, id);\n\tdocument[\"_DroppedOutNode\" + this._drop_out_id] = this;\n\teval('document[\"_DroppedOutMove' + this._drop_out_id + '\"] = function(event) {document[\"_DroppedOutNode' + this._drop_out_id + '\"]._dropOutDrag(event);}');\n\teval('document[\"_DroppedOutOver' + this._drop_out_id + '\"] = function(event) {u.e.removeEvent(document, \"mousemove\", document[\"_DroppedOutMove' + this._drop_out_id + '\"]);u.e.removeEvent(document, \"mouseup\", document[\"_DroppedOutEnd' + this._drop_out_id + '\"]);u.e.removeEvent(document[\"_DroppedOutNode' + this._drop_out_id + '\"], \"mouseover\", document[\"_DroppedOutOver' + this._drop_out_id + '\"]);}');\n\teval('document[\"_DroppedOutEnd' + this._drop_out_id + '\"] = function(event) {u.e.removeEvent(document, \"mousemove\", document[\"_DroppedOutMove' + this._drop_out_id + '\"]);u.e.removeEvent(document, \"mouseup\", document[\"_DroppedOutEnd' + this._drop_out_id + '\"]);u.e.removeEvent(document[\"_DroppedOutNode' + this._drop_out_id + '\"], \"mouseover\", document[\"_DroppedOutOver' + this._drop_out_id + '\"]);document[\"_DroppedOutNode' + this._drop_out_id + '\"]._dropOutDrop(event);}');\n\tu.e.addEvent(document, \"mousemove\", document[\"_DroppedOutMove\" + this._drop_out_id]);\n\tu.e.addEvent(this, \"mouseover\", document[\"_DroppedOutOver\" + this._drop_out_id]);\n\tu.e.addEvent(document, \"mouseup\", document[\"_DroppedOutEnd\" + this._drop_out_id]);\n\n}\n\n\nu.e._cancelPick = function(event) {\n\t// u.bug(\"_cancelPick:\", this);\n\n\n\tu.e.resetDragEvents(this);\n\n\t// new event\n\tif(fun(this.pickCancelled)) {\n\t\tthis.pickCancelled(event);\n\t}\n\n}\n\n\nu.e.setDragBoundaries = function(node, boundaries) {\n\t// u.bug(\"initDragBoundaries\", node, boundaries);\n\n//\tu.bug(\"boundaries:\" + typeof(boundaries) + \"::\" + boundaries.constructor.toString());\n//\tu.xInObject(boundaries);\n//\talert(boundaries.constructor);\n//\tu.bug(boundaries.scopeName + \",\" + typeof(boundaries))\n\t// use scopeName for old IE\n//\tif(boundaries.constructor.toString().match(\"Array\")) {\n\tif((boundaries.constructor && boundaries.constructor.toString().match(\"Array\")) || (boundaries.scopeName && boundaries.scopeName != \"HTML\")) {\n\n//\t\tu.bug(\"boundaries are array\")\n\n\t\tnode.start_drag_x = Number(boundaries[0]);\n\t\tnode.start_drag_y = Number(boundaries[1]);\n\t\tnode.end_drag_x = Number(boundaries[2]);\n\t\tnode.end_drag_y = Number(boundaries[3]);\n\n\n\t\t// position node absolute top/left in parentNode\n\t\t// if node is already positioned, make sure it is to top/left\n\n\t}\n\t// boundaries is node\n//\telse if(boundaries.constructor.toString().match(\"HTML\")) {\n\telse if((boundaries.constructor && boundaries.constructor.toString().match(\"HTML\")) || (boundaries.scopeName && boundaries.scopeName == \"HTML\")) {\n\n//\t\tu.bug(\"boundaries are node\")\n\n\t\t// TODO: if we need to compensate for padding and absolute positioning, do it here\n\n\t\tif(node.drag_overflow == \"scroll\") {\n\n\t\t\tnode.start_drag_x = node.offsetWidth > boundaries.offsetWidth ? boundaries.offsetWidth - node.offsetWidth : 0;\n\t\t\tnode.start_drag_y = node.offsetHeight > boundaries.offsetHeight ? boundaries.offsetHeight - node.offsetHeight : 0;\n\t\t\tnode.end_drag_x = node.offsetWidth > boundaries.offsetWidth ? node.offsetWidth : boundaries.offsetWidth;\n\t\t\tnode.end_drag_y = node.offsetHeight > boundaries.offsetHeight ? node.offsetHeight : boundaries.offsetHeight;\n\n\t\t}\n\t\telse {\n\n\t\t\tnode.start_drag_x = u.absX(boundaries) - u.absX(node);\n\t\t\tnode.start_drag_y = u.absY(boundaries) - u.absY(node);\n\t\t\tnode.end_drag_x = node.start_drag_x + boundaries.offsetWidth;\n\t\t\tnode.end_drag_y = node.start_drag_y + boundaries.offsetHeight;\n\n\t\t}\n\n\n\t\t// position node top/left absolute in boundary node\n\t\t// if node is already positioned, make sure it is to top/left\n\n\t\t// only change position to absolute on node\n\t\t// - never change on other nodes, to avoid other content changing place\n\n\n\t}\n\n\t// debug tool - shows boundaries\n\tif(node.show_bounds) {\n\t\tvar debug_bounds = u.ae(document.body, \"div\", {\"class\":\"debug_bounds\"})\n\t\tdebug_bounds.style.position = \"absolute\";\n\t\tdebug_bounds.style.background = \"red\"\n\t\tdebug_bounds.style.left = (u.absX(node) + node.start_drag_x - 1) + \"px\";\n\t\tdebug_bounds.style.top = (u.absY(node) + node.start_drag_y - 1) + \"px\";\n\t\tdebug_bounds.style.width = (node.end_drag_x - node.start_drag_x) + \"px\";\n\t\tdebug_bounds.style.height = (node.end_drag_y - node.start_drag_y) + \"px\";\n\t\tdebug_bounds.style.border = \"1px solid white\";\n\t\tdebug_bounds.style.zIndex = 9999;\n\t\tdebug_bounds.style.opacity = .5;\n\t\tif(document.readyState && document.readyState == \"interactive\") {\n\t\t\tdebug_bounds.innerHTML = \"WARNING - injected on DOMLoaded\"; \n\t\t}\n\t\tu.bug(\"node: \", node, \" in (\" + u.absX(node) + \",\" + u.absY(node) + \"), (\" + (u.absX(node)+node.offsetWidth) + \",\" + (u.absY(node)+node.offsetHeight) +\")\");\n\t\tu.bug(\"boundaries: (\" + node.start_drag_x + \",\" + node.start_drag_y + \"), (\" + node.end_drag_x + \", \" + node.end_drag_y + \")\");\n\t}\n\n\n\tnode._x = node._x ? node._x : 0;\n\tnode._y = node._y ? node._y : 0;\n\n\n\t// If in overflow scroll mode\n\t// – make calculations to only apply scrolling if dragged node is bigger than container boundary\n\tif(node.drag_overflow == \"scroll\" && (boundaries.constructor && boundaries.constructor.toString().match(\"HTML\")) || (boundaries.scopeName && boundaries.scopeName == \"HTML\")) {\n\n\t\t// u.bug(\"start_drag_x:\"+ node.start_drag_x, \"end_drag_x:\" + node.end_drag_x, \"start_drag_y:\" + node.start_drag_y, \"end_drag_y:\" + node.end_drag_y, \"node.offsetWidth:\" + node.offsetWidth, \"node.offsetHeight:\" + node.offsetHeight, \"boundaries.offsetWidth:\" + boundaries.offsetWidth, \"boundaries.offsetHeight:\" + boundaries.offsetHeight)\n\n\t\tnode.locked = ((node.end_drag_x - node.start_drag_x <= boundaries.offsetWidth) && (node.end_drag_y - node.start_drag_y <= boundaries.offsetHeight));\n\n\t\tnode.only_vertical = (node.vertical_lock || (!node.locked && node.end_drag_x - node.start_drag_x <= boundaries.offsetWidth));\n\t\tnode.only_horizontal = (node.horizontal_lock || (!node.locked && node.end_drag_y - node.start_drag_y <= boundaries.offsetHeight));\n\n\t\t// console.log(\"LOCKED:\" + node.locked);\n\t\t// console.log(\"LOCKED only_vertical:\" + node.only_vertical);\n\t\t// console.log(\"LOCKED only_horizontal:\" + node.only_horizontal);\n\t}\n\t// offsetHeight and Width may change during a rotation, so better to save starting point values\n\t// dragging locked (only event catching)\n\telse {\n\n\t\tnode.locked = ((node.end_drag_x - node.start_drag_x == node.offsetWidth) && (node.end_drag_y - node.start_drag_y == node.offsetHeight));\n\n\t\t// is the drag one-dimentional\n\t//\tnode.only_vertical = (!node.locked && node.end_drag_x - node.start_drag_x == node.offsetWidth);\n\t//\tnode.only_horizontal = (!node.locked && node.end_drag_y - node.start_drag_y == node.offsetHeight);\n\n\t\tnode.only_vertical = (node.vertical_lock || (!node.locked && node.end_drag_x - node.start_drag_x == node.offsetWidth));\n\t\tnode.only_horizontal = (node.horizontal_lock || (!node.locked && node.end_drag_y - node.start_drag_y == node.offsetHeight));\n\t\t\n\t}\n\n\n}\n\n\nu.e.setDragPosition = function(node, x, y) {\n\t\n\tnode.current_xps = 0;\n\tnode.current_yps = 0;\n\tnode._x = x;\n\tnode._y = y;\n\n\n\t// set corrected values\n\tu.a.translate(node, node._x, node._y);\n\n\n\t// notify of movement\n\tif(fun(node[node.callback_moved])) {\n\t\tnode[node.callback_moved](event);\n\t}\n\n}\n\n\n/**\nSwipe\n\tswipe returns are automatically defined by boundaries, linear horizontal boundaries can only return left/right etc.\n\tdetect swipe movements\n\tnotify swipe\n* Notifies:\n* element.picked\n* element.moved\n* element.dropped\n*\n* ? element.swipedUp\n* ? element.swipedRight\n* ? element.swipedDown\n* ? element.swipedLeft\n*/\nu.e.swipe = function(node, boundaries, _options) {\n\n\tnode.e_swipe_options = _options ? _options : {};\n\n\tnode.e_swipe = true;\n\n\tu.e.drag(node, boundaries, _options);\n}\n\n\n",
                "new_contents": "/*\nEVENTS\nswipe\ndrag\npinch/zoom/rotate (later)\n\n\n\n\n*\te.start_drag_y - start coord for drag area\n*\te.end_drag_y - end coord for drag area\n*\n*\te.start_input_y - start coord of touch input event\n*\n*\te.current_y - current coord of input\n*\te._y - calculated new coord of element relative to input\n*\te.offset_y - offset between events - to calcilated direction\n*\n\n\nTODO: Calculate processtime based on element size\n\n*/\n\n\nu.e.resetDragEvents = function(node) {\n\t// u.bug(\"reset drag events:\", node);\n\n\tnode._moves_pick = 0;\n\n\tthis.removeEvent(node, \"mousemove\", this._pick);\n\tthis.removeEvent(node, \"touchmove\", this._pick);\n\n\tthis.removeEvent(node, \"mousemove\", this._drag);\n\tthis.removeEvent(node, \"touchmove\", this._drag);\n\n\tthis.removeEvent(node, \"mouseup\", this._drop);\n\tthis.removeEvent(node, \"touchend\", this._drop);\n\n\t//\tthis.removeEvent(node, \"mouseout\", this._snapback);\n\t//\tthis.removeEvent(node, \"mouseout\", this._drop);\n\t//\tthis.removeEvent(node, \"mouseout\", this._drop_mouse);\n\n\tthis.removeEvent(node, \"mouseup\", this._cancelPick);\n\tthis.removeEvent(node, \"touchend\", this._cancelPick);\n\n\n\tthis.removeEvent(node, \"mouseout\", this._dropOut);\n\t// this.removeEvent(node, \"mouseover\", this._drop_over);\n\n\n\n\tthis.removeEvent(node, \"mousemove\", this._scrollStart);\n\tthis.removeEvent(node, \"touchmove\", this._scrollStart);\n\tthis.removeEvent(node, \"mousemove\", this._scrolling);\n\tthis.removeEvent(node, \"touchmove\", this._scrolling);\n\tthis.removeEvent(node, \"mouseup\", this._scrollEnd);\n\tthis.removeEvent(node, \"touchend\", this._scrollEnd);\n\n}\n\n\n/**\n* Detect overlap between element and target\n* Element is using internal position values _x and _y, allowing to test overlap, before moving element\n*\n* Default allows for partial overlap\n* set strict = true for complete overlap\n*\n* return true if overlap is valid\n*/\n\n// calculate overlap of element and target\n// strict = true to look for complete overlap\n// TODO: rewrite\nu.e.overlap = function(node, boundaries, strict) {\n\n\n\t// if target is array of coordinates\n\tif(boundaries.constructor.toString().match(\"Array\")) {\n//\t\tu.bug(\"boundaries are array\")\n\t\tvar boundaries_start_x = Number(boundaries[0]);\n\t\tvar boundaries_start_y = Number(boundaries[1]);\n\t\tvar boundaries_end_x = Number(boundaries[2]);\n\t\tvar boundaries_end_y = Number(boundaries[3]);\n\t}\n\t// target is element\n\telse if(boundaries.constructor.toString().match(\"HTML\")) {\n//\t\tu.bug(\"boundaries are node\")\n\t\tvar boundaries_start_x = u.absX(boundaries) - u.absX(node);\n\t\tvar boundaries_start_y =  u.absY(boundaries) - u.absY(node);\n\t\tvar boundaries_end_x = Number(boundaries_start_x + boundaries.offsetWidth);\n\t\tvar boundaries_end_y = Number(boundaries_start_y + boundaries.offsetHeight);\n\t}\n\t// else {\n\t// \tu.bug(\"no boundaries:\" + boundaries)\n\t// }\n\n\t// element proporties\n\tvar node_start_x = Number(node._x);\n\tvar node_start_y = Number(node._y);\n\tvar node_end_x = Number(node_start_x + node.offsetWidth);\n\tvar node_end_y = Number(node_start_y + node.offsetHeight);\n\n//\tu.bug(\"nsx: \"+node_start_x+\":nsy: \"+node_start_y+\":nex: \"+node_end_x+\":ney: \"+node_end_y);\n//\tu.bug(\"bsx: \"+boundaries_start_x+\":bsy: \"+boundaries_start_y+\":bex: \"+boundaries_end_x+\":bey: \"+boundaries_end_y);\n\n\t// strict - check boundaries\n\t// all boundaries are kept\n\tif(strict) {\n\t\tif(node_start_x >= boundaries_start_x && node_start_y >= boundaries_start_y && node_end_x <= boundaries_end_x && node_end_y <= boundaries_end_y) {\n\t\t\treturn true;\n\t\t}\n\t\telse {\n\t\t\treturn false;\n\t\t}\n\t} \n\t// not strict - out of scope detection (much simpler algoritm)\n\t// elements are not overlapping\n\telse if(node_end_x < boundaries_start_x || node_start_x > boundaries_end_x || node_end_y < boundaries_start_y || node_start_y > boundaries_end_y) {\n\t\treturn false;\n\t}\n\t// elements are overlapping\n\treturn true;\n}\n\n\n/**\n* Drag element e within boundaries specified\n*\n* node - element to be dragged\n* boundary - boundary of dragged element, states as Node or array of outer boundaries relative to node\n\nOptional parameters\n\n* strict - default = true\n- true: object follow mouse precisely\n- false: animates node to projected end coord based on movement speed\n\n* bouncing - default = false\n- animates node to projected end coord based on movement speed - bouncing off boundaries (bouncing not implemented)\n\n* elastica - default = 0\n- drag over boundary and snap back on release - basically a visuel effect\n\n* dropout - default = true\n- drop element on mouseout (safety feature to avoid loosing drag/node relation)\n\n* CONSIDER: processtime for fallback methods - not implemented\n* processtime - miliseconds between updates. Large elements should be updated less frequent. Default = 50\n\n*\n* Notifies:\n* element.picked\n* element.moved\n* element.dropped\n*/\n//this.drag = function(e, target, strict, snapback, process_time) {\n\n// it is important to do as many calculation beforehand to make event handling as fast as possible\n// if you do too many calculations on each event dragging will be lagging and ... well crappy.\nu.e.drag = function(node, boundaries, _options) {\n\t// u.bug(\"set drag:\", node);\n\n\tnode.e_drag_options = _options ? _options : {};\n\n\tnode.e_drag = true;\n\n//\tnode._moves_counted = 0;\n//\tnode._moves_required = (u.system(\"android, winphone\")) ? 2 : 0;\n//\tnode._moves_required = 5;\n\n\t// check for empty node\n\tif(node.childNodes.length < 2 && node.innerHTML.trim() == \"\") {\n\t\tnode.innerHTML = \"&nbsp;\";\n\t}\n\n\t// radius for movement after mousedown/touchstart before element is \"picked\"\n\t// a simple click will not cause a pick\n\t// shifted from counting move-events because new phones thow 5 moveevent events on a tap (sensitive screen, powerful chips) - now we measure the distance travelled in those movements, to know if the user shows intent of dragging\n\tnode.distance_to_pick = 2;\n\n\t// default values\n\tnode.drag_strict = true;\n\tnode.drag_overflow = false;\n//\tnode.drag_projection = false;\n\tnode.drag_elastica = 0;\n\tnode.drag_dropout = true;\n\n\t// debug displaying of boundaries\n\t// TODO: needs to be updated\n\tnode.show_bounds = false;\n\n\t// default callbacks\n\tnode.callback_ready = \"ready\";\n\tnode.callback_picked = \"picked\";\n\tnode.callback_moved = \"moved\";\n\tnode.callback_dropped = \"dropped\";\n\n\n\t// additional info passed to function as JSON object\n\tif(obj(_options)) {\n\t\tvar _argument;\n\t\tfor(_argument in _options) {\n\n\t\t\tswitch(_argument) {\n\t\t\t\tcase \"strict\"\t\t\t: node.drag_strict\t\t\t= _options[_argument]; break;\n\t\t\t\tcase \"overflow\"\t\t\t: node.drag_overflow\t\t= _options[_argument]; break;\n//\t\t\t\tcase \"projection\"\t\t: node.drag_projection\t\t= _options[_argument]; break;\n\t\t\t\tcase \"elastica\"\t\t\t: node.drag_elastica\t\t= Number(_options[_argument]); break;\n\t\t\t\tcase \"dropout\"\t\t\t: node.drag_dropout\t\t\t= _options[_argument]; break;\n\n\t\t\t\tcase \"show_bounds\"\t\t: node.show_bounds\t\t\t= _options[_argument]; break; // NEEDS HELP\n\n\t\t\t\tcase \"vertical_lock\"\t: node.vertical_lock\t\t= _options[_argument]; break;\n\t\t\t\tcase \"horizontal_lock\"\t: node.horizontal_lock\t\t= _options[_argument]; break;\n\n\t\t\t\tcase \"callback_picked\"\t: node.callback_picked\t\t= _options[_argument]; break;\n\t\t\t\tcase \"callback_moved\"\t: node.callback_moved\t\t= _options[_argument]; break;\n\t\t\t\tcase \"callback_dropped\"\t: node.callback_dropped\t\t= _options[_argument]; break;\n\t\t\t}\n\n\t\t}\n\t}\n\n\n//\tnode.process_time = process_time ? process_time : 0;\n\n\tu.e.setDragBoundaries(node, boundaries);\n\n\tu.e.addStartEvent(node, this._inputStart);\n\n\n\t// notify of movement\n\tif(fun(node[node.callback_ready])) {\n\t\tnode[node.callback_ready]();\n\t}\n}\n\n\n/**\n* Input picks element - handler\n* Sets default values for following inputDrag\n*\n* Calls return function element.picked to notify of event\n*/\nu.e._pick = function(event) {\n\t// u.bug(\"_pick:\", this, this._x + \" x \" + this._y + \", \" + this.only_horizontal + \", \" + this.only_vertical);\n\n\n\t// reset inital events to avoid unintended bubbling - only reset if pick makes sense\n//\tu.e.resetNestedEvents(this);\n\n\n\t// detect if drag is relevant for element\n\t// if only vertical drag is allowed, only react on vertical movements\n\t// if only horizontal drag is allowed, only react on horizontal movements\n\t// to do this we calculate the vertical and horizontal speeds\n//\tvar init_speed_x = Math.abs(this.start_event_x - u.eventX(event) - u.scrollX());\n//\tvar init_speed_y = Math.abs(this.start_event_y - u.eventY(event) - u.scrollY());\n\tvar init_speed_x = Math.abs(this.start_event_x - u.eventX(event));\n\tvar init_speed_y = Math.abs(this.start_event_y - u.eventY(event));\n\n\t// u.bug(\"this.start_event_x:\" + this.start_event_x + \",this.start_event_y:\" + this.start_event_y)\n\t// u.bug(\"u.eventX:\" + u.eventX(event) + \",u.eventY:\" + u.eventY(event))\n//\tu.bug(\"initial speed:\" + init_speed_x + \"/\" + init_speed_y + \", vert:\" + this.only_vertical + \", hori:\" + this.only_horizontal);\n\n/*\n\nabs(a - b)\n\nx: -2 -> 2 = 4 (-2 - 2)\ny: 2 -> 3 = 1 (2 - 3)\n\nx: 2 -> 5 = 3 (2 - 5)\ny: 1 -> 4 = 3 (1 - 4)\n\nx: 2 -> -4 = 6 (2 - -4)\ny: 1 -> 3 = 2 (1 - 3)\n\nx: 2 -> -4 = 6 (2 - -4)\ny: -3 -> 4 = 7 (-3 - 4)\n\nx: 2 -> 3 = 1 (2 - 3)\ny: 3 -> -2 = 5 (3 - -2)\n\n*/\n\n//\tu.bug(init_speed_x + \", \" + init_speed_y);\n\n\tif(\n\t\t(init_speed_x > init_speed_y && this.only_horizontal) || \n\t\t(init_speed_x < init_speed_y && this.only_vertical) ||\n\t\t(!this.only_vertical && !this.only_horizontal)) {\n\n\t\t// u.bug(\"valid pick:\", this, this._moves_counted + \", \" + this._moves_required);\n\n//\t\tif(this._moves_counted >= this._moves_required) {\n\t\tif((init_speed_x > this.distance_to_pick || init_speed_y > this.distance_to_pick)) {\n\n\t\t\t// reset moves count\n//\t\t\tthis._moves_counted = 0;\n\n//\t\t\tu.bug(\"actual pick:\", this);\n\n\t\t\t// reset inital events to avoid unintended bubbling if pick direction makes sense\n\t\t\tu.e.resetNestedEvents(this);\n\n\t\t\t// kill event to prevent dragging deeper element\n\t\t\t// could possibly be forced into callback to allow for double drag (but don't see point at current time)\n\t\t\tu.e.kill(event);\n\n\t\t\t// detect fixed parent state\n\t\t\tif(u.hasFixedParent(this)) {\n\t\t\t\tthis.has_fixed_parent = true;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.has_fixed_parent = false;\n\t\t\t}\n\n\t\t\t// set initial move timestamp - used to calculate speed\n\t//\t\tthis.move_timestamp = new Date().getTime();\n\t\t\tthis.move_timestamp = event.timeStamp;\n\t\t\tthis.move_last_x = this._x;\n\t\t\tthis.move_last_y = this._y;\n\n\t\t\t// relative to screen - compensate scroll-offset for fixed elements \n\t\t\tif(u.hasFixedParent(this)) {\n\t\t\t\tthis.start_input_x = u.eventX(event) - this._x - u.scrollX(); \n\t\t\t\tthis.start_input_y = u.eventY(event) - this._y - u.scrollY();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.start_input_x = u.eventX(event) - this._x; \n\t\t\t\tthis.start_input_y = u.eventY(event) - this._y;\n\t\t\t}\n\n\n\t\t\t// reset current speed\n\t\t\tthis.current_xps = 0;\n\t\t\tthis.current_yps = 0;\n\n\n\t\t\t// remove transitions if any\n\t\t\tu.a.transition(this, \"none\");\n\n\n\t\t\t// reset events and setting drag events\n\t\t\tu.e.addMoveEvent(this, u.e._drag);\n\t\t\tu.e.addEndEvent(this, u.e._drop);\n\n\t\t\t// notify of pick\n\t\t\tif(fun(this[this.callback_picked])) {\n\t\t\t\tthis[this.callback_picked](event);\n\t\t\t}\n\n\t\t\t// Undesired effect when sliding the presentation, could be enabled for small elements in large scopes using mouse\n\t\t\tif(this.drag_dropout && event.type.match(/mouse/)) {\n\t\t\t\t// u.bug(\"set mouseout event cancel:\", this);\n\t//\t\t\tu.e.addEvent(this, \"mouseout\", u.e._drop_mouse);\n\n\t\t\t\t// u.e._drop_over = function(event) {\n\t\t\t\t// \tu.t.resetTimer(this.t_drop_out);\n\t\t\t\t// \tu.bug(\"_drop_over:\", this, event.target);\n\t\t\t\t// }\n\t\t\t\t// this.__out = function(event) {\n\t\t\t\t//\n\t\t\t\t\t// \tu.bug(\"_drop_out:\", this, event.target);\n\t\t\t\t//\n\t\t\t\t// \t// if(event.target == this) {\n\t\t\t\t// \t// \tthis._drop = u.e._drop;\n\t\t\t\t// \t// \tthis._drop(event);\n\t\t\t\t// \t// }\n\t\t\t\t// \t// else {\n\t\t\t\t// //\t\tevent = {\"type\":\"mouseout\", \"target\":this};\n\t\t\t\t// \t\tthis.t_drop_out = u.t.setTimer(this, u.e._drop_out_is_real, 100, event);\n\t\t\t\t// //\t}\n\t\t\t\t// \t//\n\t\t\t\t// }\n\t\t\t\t// this.__out = function(event) {\n\t\t\t\t//\n\t\t\t\t// \tu.bug(\"_drop_out_is_real:\", this, event.target);\n\t\t\t\t//\n\t\t\t\t// \tthis._drop = u.e._drop;\n\t\t\t\t// \tthis._drop({\"type\":\"mouseout\", \"target\":this});\n\t\t\t\t//\n\t\t\t\t// }\n\t//\t\t\tu.e.hover(this, {\"out\":\"drop_out\"});\n\n\t\t\t\t// map _drag funktion to node to enable drop_out handling\n\t\t\t\tthis._dropOutDrag = u.e._drag;\n\t\t\t\tthis._dropOutDrop = u.e._drop;\n\n//\t\t\t\tu.e.addOverEvent(this, u.e._drop_over);\n\t\t\t\tu.e.addOutEvent(this, u.e._dropOut);\n\t\t\t}\n\n\t\t}\n\t\t// else {\n\t\t// \tthis._moves_counted++;\n\t\t// }\n\n\t}\n\n\n\n\t// Undesired effect when sliding the presentation, could be enabled for small elements in large scopes using mouse\n\t// if(this.drag_dropout && u.e.event_pref == \"mouse\") {\n\t\t// \tu.bug(\"set mouseout event cancel:\", this);\n\t// \tu.e.addEvent(this, \"mouseout\", u.e._drop_mouse);\n\t// }\n\n}\n\n/**\n* Drags element, within boundaries set in inputPick\n* Calls return function element.moved to notify of event\n*/\nu.e._drag = function(event) {\n//\tu.bug(\"_drag:\", this, event.timeStamp, Date.now());\n\n\t// Get current input coordinates relative to starting point\n//\tif(u.hasFixedParent(this)) {\n\tif(this.has_fixed_parent) {\n\t\tthis.current_x = u.eventX(event) - this.start_input_x - u.scrollX();\n\t\tthis.current_y = u.eventY(event) - this.start_input_y - u.scrollY();\n\t}\n\telse {\n\t\tthis.current_x = u.eventX(event) - this.start_input_x;\n\t\tthis.current_y = u.eventY(event) - this.start_input_y;\n\t}\n\n\n\t// TODO: error - when locked, speed is calculated from start drag point, should always be speed since last event\n\t// this.current_xps = Math.round(((this.current_x - this._x) / (event.timeStamp - this.move_timestamp)) * 1000);\n\t// this.current_yps = Math.round(((this.current_y - this._y) / (event.timeStamp - this.move_timestamp)) * 1000);\n\n\t// current speed per second\n\tthis.current_xps = Math.round(((this.current_x - this.move_last_x) / (event.timeStamp - this.move_timestamp)) * 1000);\n\tthis.current_yps = Math.round(((this.current_y - this.move_last_y) / (event.timeStamp - this.move_timestamp)) * 1000);\n//\tu.bug(this.current_x + \":\" + this.move_last_x + \":\" + event.timeStamp + \":\" + this.move_timestamp)\n//\tu.bug(\"this.current_xps:\" + this.current_xps + \" x \" + \"this.current_yps:\" + this.current_yps)\n\n\n\t// Get an idea of the direction, even when acceleration has stopped\n\tthis.last_x_distance_travelled = (this.current_xps) ? this.current_x - this.move_last_x : this.last_x_distance_travelled;\n\tthis.last_y_distance_travelled = (this.current_yps) ? this.current_y - this.move_last_y : this.last_y_distance_travelled;\n\t// u.bug(\"last_x_distance_travelled:\" + this.last_x_distance_travelled, \"last_y_distance_travelled:\" + this.last_y_distance_travelled);\n\n\t// remember current move time for next event\n\tthis.move_timestamp = event.timeStamp;\n\tthis.move_last_x = this.current_x;\n\tthis.move_last_y = this.current_y;\n\n\t// element can only be dragged vertically\n\tif(!this.locked && this.only_vertical) {\n\t\t// only set new y\n\t\tthis._y = this.current_y;\n\t}\n\t// element can only be dragged horizontally\n\telse if(!this.locked && this.only_horizontal) {\n\t\t// only set new x\n\t\tthis._x = this.current_x;\n\t}\n\t// free drag (within boundaries)\n\telse if(!this.locked) {\n\t\tthis._x = this.current_x;\n\t\tthis._y = this.current_y;\n\t}\n\n//\tu.bug(\"locked:\" + this.locked + \", \" + this.only_horizontal + \", \" + this.only_vertical);\n\n\tif(this.e_swipe) {\n\t\t// u.bug(\"swiping:\" + this.locked + \", \" + this.only_horizontal + \", \" + this.only_vertical + \", \" + Math.abs(this.current_xps) + \":\" + Math.abs(this.current_yps));\n\t\t// u.bug(this, this.current_x, this.current_xps, this.move_last_x);\n\n\t\tif(this.only_horizontal) {\n\n//\t\t\tu.bug(\"only_horizontal\")\n\t\t\tif(this.current_xps < 0 || this.current_xps === 0 && this.last_x_distance_travelled < 0) {\n\t\t\t\tthis.swiped = \"left\";\n//\t\t\t\tu.bug(\"id swiped left\")\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.swiped = \"right\";\n//\t\t\t\tu.bug(\"id swiped right\")\n\t\t\t}\n\n\t\t}\n\t\telse if(this.only_vertical) {\n\n\t\t\tif(this.current_yps < 0 || this.current_yps === 0 && this.last_y_distance_travelled < 0) {\n\t\t\t\tthis.swiped = \"up\";\n//\t\t\t\tu.bug(\"id swiped up\")\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.swiped = \"down\";\n//\t\t\t\tu.bug(\"id swiped down\")\n\t\t\t}\n\n\t\t}\n\t\telse {\n\n\t\t\tif(Math.abs(this.current_xps) > Math.abs(this.current_yps)) {\n\t\t\t\tif(this.current_xps < 0) {\n\t\t\t\t\tthis.swiped = \"left\";\n//\t\t\t\t\tu.bug(\"id swiped left\")\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.swiped = \"right\";\n//\t\t\t\t\tu.bug(\"id swiped right\")\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(Math.abs(this.current_xps) < Math.abs(this.current_yps)) {\n\t\t\t\tif(this.current_yps < 0) {\n\t\t\t\t\tthis.swiped = \"up\";\n//\t\t\t\t\tu.bug(\"id swiped up\")\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.swiped = \"down\";\n//\t\t\t\t\tu.bug(\"id swiped down\")\n\t\t\t\t}\n\t\t\t}\n\t\t}\n// \t\t// calc swipes event for locked elements\n// \t\tif((Math.abs(this.current_xps) > Math.abs(this.current_yps) || this.only_horizontal)) {\n// //\t\tif(this.current_xps && (Math.abs(this.current_xps) > Math.abs(this.current_yps) || this.only_horizontal)) {\n// \t\t\tu.bug(\"only_horizontal\")\n// \t\t\tif(this.current_xps < 0) {\n// \t\t\t\tthis.swiped = \"left\";\n// \t\t\t\tu.bug(\"id swiped left\")\n// \t\t\t}\n// \t\t\telse {\n// \t\t\t\tthis.swiped = \"right\";\n// \t\t\t\tu.bug(\"id swiped right\")\n// \t\t\t}\n// \t\t}\n// \t\telse if((Math.abs(this.current_xps) < Math.abs(this.current_yps) || this.only_vertical)) {\n// //\t\telse if(this.current_yps && (Math.abs(this.current_xps) < Math.abs(this.current_yps) || this.only_vertical)) {\n// \t\t\tu.bug(\"only_vertical\")\n// \t\t\tif(this.current_yps < 0) {\n// \t\t\t\tthis.swiped = \"up\";\n// \t\t\t\tu.bug(\"id swiped up\")\n// \t\t\t}\n// \t\t\telse {\n// \t\t\t\tthis.swiped = \"down\";\n// \t\t\t\tu.bug(\"id swiped down\")\n// \t\t\t}\n// \t\t}\n\t}\n\n\n\t// only perform overlap test and movement if the drag element is not locked\n\tif(!this.locked) {\n//\t\tu.bug(\"not locked\")\n\n\t\t// Move element if strict boundaries are kept\n\t\tif(u.e.overlap(this, [this.start_drag_x, this.start_drag_y, this.end_drag_x, this.end_drag_y], true)) {\n//\t\t\tu.bug(\"in scope\");\n\n//\t\t\tu.bug(\"translate:\" + this._x+\",\"+ this._y)\n\t\t\tu.a.translate(this, this._x, this._y);\n\n\t\t}\n\n\t\t// Out of scope\n\n\t\t// elastica - boundaries can be crossed with elastica\n\t\telse if(this.drag_elastica) {\n//\t\t\tu.bug(\"out of scope, with elastica\")\n\n\t\t\t// reset detected swipe\n\t\t\tthis.swiped = false;\n\n\t\t\t// reset speed\n\t\t\tthis.current_xps = 0;\n\t\t\tthis.current_yps = 0;\n\n\n\t\t\tvar offset = false;\n\n\t\t\t// correct overflow\n\t\t\t// if overflow found:\n\t\t\t// - get offset (corrected for allowed offset)\n\t\t\t// - set correct _x (for snapback function on drop)\n\t\t\t// - set temorary element x (calculated by drag, allowed_offset and elestica)\n\t\t\t// right out of scope and not locked vertically\n\t\t\tif(!this.only_vertical && this._x < this.start_drag_x) {\n\t\t\t\toffset = this._x < this.start_drag_x - this.drag_elastica ? - this.drag_elastica : this._x - this.start_drag_x;\n\t\t\t\tthis._x = this.start_drag_x;\n\t\t\t\tthis.current_x = this._x + offset + (Math.round(Math.pow(offset, 2)/this.drag_elastica));\n\t\t\t}\n\t\t\t// left out of scope and not locked vertically\n\t\t\telse if(!this.only_vertical && this._x + this.offsetWidth > this.end_drag_x) {\n\t\t\t\toffset = this._x + this.offsetWidth > this.end_drag_x + this.drag_elastica ? this.drag_elastica : this._x + this.offsetWidth - this.end_drag_x;\n\t\t\t\tthis._x = this.end_drag_x - this.offsetWidth;\n\t\t\t\tthis.current_x = this._x + offset - (Math.round(Math.pow(offset, 2)/this.drag_elastica));\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.current_x = this._x;\n\t\t\t}\n\n\t\t\t// top out of scope\n\t\t\tif(!this.only_horizontal && this._y < this.start_drag_y) {\n\t\t\t\toffset = this._y < this.start_drag_y - this.drag_elastica ? - this.drag_elastica : this._y - this.start_drag_y;\n\t\t\t\tthis._y = this.start_drag_y;\n\t\t\t\tthis.current_y = this._y + offset + (Math.round(Math.pow(offset, 2)/this.drag_elastica));\n//\t\t\t\tu.bug(\"oos0\"+offset);\n\t\t\t}\n\t\t\t// bottom out of scope\n\t\t\telse if(!this.horizontal && this._y + this.offsetHeight > this.end_drag_y) {\n\t\t\t\toffset = (this._y + this.offsetHeight > this.end_drag_y + this.drag_elastica) ? this.drag_elastica : (this._y + this.offsetHeight - this.end_drag_y);\n\t\t\t\tthis._y = this.end_drag_y - this.offsetHeight;\n\t\t\t\tthis.current_y = this._y + offset - (Math.round(Math.pow(offset, 2)/this.drag_elastica));\n//\t\t\t\tu.bug(\"oos1\"+offset);\n\t\t\t}\n\t\t\telse {\n//\t\t\t\tu.bug(\"oos2\"+offset);\n\t\t\t\tthis.current_y = this._y;\n\t\t\t}\n\n\t\t\t// if offset found, move to these coordinates\n\t\t\tif(offset) {\n//\t\t\t\tu.bug(\"offset\"+offset)\n//\t\t\t\tu.bug(\"offset:\" + this._x+\",\"+ this._y)\n\t\t\t\tu.a.translate(this, this.current_x, this.current_y);\n\t\t\t}\n\n\t\t}\n\t\t// correct out of bounds coord\n\t\telse {\n//\t\t\tu.bug(\"out of scope\", \"red\")\n\t\t\t\n\n\t\t\t// reset detected swipe\n\t\t\tthis.swiped = false;\n\n\t\t\t// reset speed\n\t\t\tthis.current_xps = 0;\n\t\t\tthis.current_yps = 0;\n\n\n\t\t\tif(this._x < this.start_drag_x) {\n\t\t\t\tthis._x = this.start_drag_x;\n\t\t\t}\n\t\t\telse if(this._x + this.offsetWidth > this.end_drag_x) {\n\t\t\t\tthis._x = this.end_drag_x - this.offsetWidth;\n\t\t\t}\n\n\t\t\tif(this._y < this.start_drag_y) {\n\t\t\t\tthis._y = this.start_drag_y;\n\t\t\t}\n\t\t\telse if(this._y + this.offsetHeight > this.end_drag_y) { \n\t\t\t\tthis._y = this.end_drag_y - this.offsetHeight;\n\t\t\t}\n\n\t\t\t// set corrected values\n\t\t\tu.a.translate(this, this._x, this._y);\n\t\t}\n\n\t}\n\n\t// notify of movement\n\tif(fun(this[this.callback_moved])) {\n\t\tthis[this.callback_moved](event);\n\t}\n\t// if(fun(this.moved)) {\n\t// \tthis.moved(event);\n\t// }\n\n}\n\n/**\n* Input drops element\n*\n* Calls return function element.dropped to notify of event\n*/\nu.e._drop = function(event) {\n//\tu.bug(\"_drop:\", this, event.type, this.swiped);\n\n\t// reset events to prepare for new drag\n\tu.e.resetEvents(this);\n\n\n\t// return swipe events to handlers\n\tif(this.e_swipe && this.swiped) {\n//\t\tu.bug(\"_drop swiped:\"+this.swiped);\n\n\n\t\t// set appropriate eventAction if it does not exist\n\t\tthis.e_swipe_options.eventAction = \"Swiped \"+ this.swiped;\n\t\t// track event\n\t\tu.stats.event(this, this.e_swipe_options);\n\n\n\t\tif(this.swiped == \"left\" && fun(this.swipedLeft)) {\n\t\t\tthis.swipedLeft(event);\n\t\t}\n\t\telse if(this.swiped == \"right\" && fun(this.swipedRight)) {\n\t\t\tthis.swipedRight(event);\n\t\t}\n\t\telse if(this.swiped == \"down\" && fun(this.swipedDown)) {\n\t\t\tthis.swipedDown(event);\n\t\t}\n\t\telse if(this.swiped == \"up\" && fun(this.swipedUp)) {\n\t\t\tthis.swipedUp(event);\n\t\t}\n//\t\tthis.swiped = false;\n//\t\tu.bug(this.swiped);\n\t\t\n\t}\n\t// else transition element into place\n\t\n\n\n//\telse if(!this.drag_strict && !this.locked && this.start_input_x && this.start_input_y) {\n\n\t// projection is enabled\n\telse if(!this.drag_strict && !this.locked) {\n//\t\tu.bug(\"project ending\")\n//\t\tu.bug(\"if(!this.drag_strict && !this.locked)\");\n\n\t\t// block init values\n\t\t// this.start_input_x = false;\n\t\t// this.start_input_y = false;\n\n\t\t// get projected coords based on current speed (devided by 2 for better visual effect)\n\t\tthis.current_x = Math.round(this._x + (this.current_xps/2));\n\t\tthis.current_y = Math.round(this._y + (this.current_yps/2));\n\n\n\t\t// correct out of scope values for projected coordinates\n\t\tif(this.only_vertical || this.current_x < this.start_drag_x) {\n\t\t\tthis.current_x = this.start_drag_x;\n\t\t}\n\t\telse if(this.current_x + this.offsetWidth > this.end_drag_x) {\n\t\t\tthis.current_x = this.end_drag_x - this.offsetWidth;\n\t\t}\n\t\tif(this.only_horizontal || this.current_y < this.start_drag_y) {\n\t\t\tthis.current_y = this.start_drag_y;\n\t\t}\n\t\telse if(this.current_y + this.offsetHeight > this.end_drag_y) {\n\t\t\tthis.current_y = this.end_drag_y - this.offsetHeight;\n\t\t}\n\n\n\t\t// callback for projection\n\t\tthis.transitioned = function() {\n\t\t\t// this.transitioned = null;\n\t\t\t// u.a.transition(this, \"none\");\n\n\t\t\tif(fun(this.projected)) {\n\t\t\t\tthis.projected(event);\n\t\t\t}\n\t\t}\n\n\n\t\t// if speed is not 0, execute projection\n\t\tif(this.current_xps || this.current_yps) {\n//\t\t\tu.bug(\"speed\")\n\t\t\tu.a.transition(this, \"all 1s cubic-bezier(0,0,0.25,1)\");\n\t\t}\n\t\t// no speed, no transition\n\t\telse {\n//\t\t\tu.bug(\"no speed\")\n//\t\t\tu.a.transition(this, \"all 0.2s cubic-bezier(0,0,0.25,1)\");\n\t\t\tu.a.transition(this, \"none\");\n\t\t\t// console.log(this.transitioned);\n\t\t}\n\n\t\t// execute projection\n\t\tu.a.translate(this, this.current_x, this.current_y);\n\t}\n\t\n\tif(this.e_drag && !this.e_swipe) {\n//\t\tu.bug(\"drop tracked\")\n\n\t\t// set appropriate eventAction if it does not exist\n\t\tthis.e_drag_options.eventAction = u.stringOr(this.e_drag_options.eventAction, \"Dropped\");\n\t\t// track event\n\t\tu.stats.event(this, this.e_drag_options);\n\t\n\t}\n\n\t// notify of drop\n\tif(fun(this[this.callback_dropped])) {\n\t\tthis[this.callback_dropped](event);\n\t}\n\n\n\t// if(fun(this.dropped)) {\n\t// \tthis.dropped(event);\n\t// }\n\n}\n\n// handle drop outs (when dragging is faster than rendering)\n// enhanced drop out function attempting to catch up to mouse on mouseout\n// start a document move listener loop to pass mouse coords back to _drag - until mouseover is invoked again, which\n// means element has caught up with mouse (or mouseup occurs on document)\nu.e._dropOut = function(event) {\n\t//\tu.bug(\"_drop_out:\", this, event.target, event.timeStamp, this.move_timestamp);\n\n\tthis._drop_out_id = u.randomString();\n//\t\tu.ac(node, id);\n\tdocument[\"_DroppedOutNode\" + this._drop_out_id] = this;\n\teval('document[\"_DroppedOutMove' + this._drop_out_id + '\"] = function(event) {document[\"_DroppedOutNode' + this._drop_out_id + '\"]._dropOutDrag(event);}');\n\teval('document[\"_DroppedOutOver' + this._drop_out_id + '\"] = function(event) {u.e.removeEvent(document, \"mousemove\", document[\"_DroppedOutMove' + this._drop_out_id + '\"]);u.e.removeEvent(document, \"mouseup\", document[\"_DroppedOutEnd' + this._drop_out_id + '\"]);u.e.removeEvent(document[\"_DroppedOutNode' + this._drop_out_id + '\"], \"mouseover\", document[\"_DroppedOutOver' + this._drop_out_id + '\"]);}');\n\teval('document[\"_DroppedOutEnd' + this._drop_out_id + '\"] = function(event) {u.e.removeEvent(document, \"mousemove\", document[\"_DroppedOutMove' + this._drop_out_id + '\"]);u.e.removeEvent(document, \"mouseup\", document[\"_DroppedOutEnd' + this._drop_out_id + '\"]);u.e.removeEvent(document[\"_DroppedOutNode' + this._drop_out_id + '\"], \"mouseover\", document[\"_DroppedOutOver' + this._drop_out_id + '\"]);document[\"_DroppedOutNode' + this._drop_out_id + '\"]._dropOutDrop(event);}');\n\tu.e.addEvent(document, \"mousemove\", document[\"_DroppedOutMove\" + this._drop_out_id]);\n\tu.e.addEvent(this, \"mouseover\", document[\"_DroppedOutOver\" + this._drop_out_id]);\n\tu.e.addEvent(document, \"mouseup\", document[\"_DroppedOutEnd\" + this._drop_out_id]);\n\n}\n\n\nu.e._cancelPick = function(event) {\n\t// u.bug(\"_cancelPick:\", this);\n\n\n\tu.e.resetDragEvents(this);\n\n\t// new event\n\tif(fun(this.pickCancelled)) {\n\t\tthis.pickCancelled(event);\n\t}\n\n}\n\n\nu.e.setDragBoundaries = function(node, boundaries) {\n\t// u.bug(\"initDragBoundaries\", node, boundaries);\n\n//\tu.bug(\"boundaries:\" + typeof(boundaries) + \"::\" + boundaries.constructor.toString());\n//\tu.xInObject(boundaries);\n//\talert(boundaries.constructor);\n//\tu.bug(boundaries.scopeName + \",\" + typeof(boundaries))\n\t// use scopeName for old IE\n//\tif(boundaries.constructor.toString().match(\"Array\")) {\n\tif((boundaries.constructor && boundaries.constructor.toString().match(\"Array\")) || (boundaries.scopeName && boundaries.scopeName != \"HTML\")) {\n\n//\t\tu.bug(\"boundaries are array\")\n\n\t\tnode.start_drag_x = Number(boundaries[0]);\n\t\tnode.start_drag_y = Number(boundaries[1]);\n\t\tnode.end_drag_x = Number(boundaries[2]);\n\t\tnode.end_drag_y = Number(boundaries[3]);\n\n\n\t\t// position node absolute top/left in parentNode\n\t\t// if node is already positioned, make sure it is to top/left\n\n\t}\n\t// boundaries is node\n//\telse if(boundaries.constructor.toString().match(\"HTML\")) {\n\telse if((boundaries.constructor && boundaries.constructor.toString().match(\"HTML\")) || (boundaries.scopeName && boundaries.scopeName == \"HTML\")) {\n\n//\t\tu.bug(\"boundaries are node\")\n\n\t\t// TODO: if we need to compensate for padding and absolute positioning, do it here\n\n\t\tif(node.drag_overflow == \"scroll\") {\n\n\t\t\tnode.start_drag_x = node.offsetWidth > boundaries.offsetWidth ? boundaries.offsetWidth - node.offsetWidth : 0;\n\t\t\tnode.start_drag_y = node.offsetHeight > boundaries.offsetHeight ? boundaries.offsetHeight - node.offsetHeight : 0;\n\t\t\tnode.end_drag_x = node.offsetWidth > boundaries.offsetWidth ? node.offsetWidth : boundaries.offsetWidth;\n\t\t\tnode.end_drag_y = node.offsetHeight > boundaries.offsetHeight ? node.offsetHeight : boundaries.offsetHeight;\n\n\t\t}\n\t\telse {\n\n\t\t\tnode.start_drag_x = u.absX(boundaries) - u.absX(node);\n\t\t\tnode.start_drag_y = u.absY(boundaries) - u.absY(node);\n\t\t\tnode.end_drag_x = node.start_drag_x + boundaries.offsetWidth;\n\t\t\tnode.end_drag_y = node.start_drag_y + boundaries.offsetHeight;\n\n\t\t}\n\n\n\t\t// position node top/left absolute in boundary node\n\t\t// if node is already positioned, make sure it is to top/left\n\n\t\t// only change position to absolute on node\n\t\t// - never change on other nodes, to avoid other content changing place\n\n\n\t}\n\n\t// debug tool - shows boundaries\n\tif(node.show_bounds) {\n\t\tvar debug_bounds = u.ae(document.body, \"div\", {\"class\":\"debug_bounds\"})\n\t\tdebug_bounds.style.position = \"absolute\";\n\t\tdebug_bounds.style.background = \"red\"\n\t\tdebug_bounds.style.left = (u.absX(node) + node.start_drag_x - 1) + \"px\";\n\t\tdebug_bounds.style.top = (u.absY(node) + node.start_drag_y - 1) + \"px\";\n\t\tdebug_bounds.style.width = (node.end_drag_x - node.start_drag_x) + \"px\";\n\t\tdebug_bounds.style.height = (node.end_drag_y - node.start_drag_y) + \"px\";\n\t\tdebug_bounds.style.border = \"1px solid white\";\n\t\tdebug_bounds.style.zIndex = 9999;\n\t\tdebug_bounds.style.opacity = .5;\n\t\tif(document.readyState && document.readyState == \"interactive\") {\n\t\t\tdebug_bounds.innerHTML = \"WARNING - injected on DOMLoaded\"; \n\t\t}\n\t\tu.bug(\"node: \", node, \" in (\" + u.absX(node) + \",\" + u.absY(node) + \"), (\" + (u.absX(node)+node.offsetWidth) + \",\" + (u.absY(node)+node.offsetHeight) +\")\");\n\t\tu.bug(\"boundaries: (\" + node.start_drag_x + \",\" + node.start_drag_y + \"), (\" + node.end_drag_x + \", \" + node.end_drag_y + \")\");\n\t}\n\n\n\tnode._x = node._x ? node._x : 0;\n\tnode._y = node._y ? node._y : 0;\n\n\n\t// If in overflow scroll mode\n\t// – make calculations to only apply scrolling if dragged node is bigger than container boundary\n\tif(node.drag_overflow == \"scroll\" && (boundaries.constructor && boundaries.constructor.toString().match(\"HTML\")) || (boundaries.scopeName && boundaries.scopeName == \"HTML\")) {\n\n\t\t// u.bug(\"start_drag_x:\"+ node.start_drag_x, \"end_drag_x:\" + node.end_drag_x, \"start_drag_y:\" + node.start_drag_y, \"end_drag_y:\" + node.end_drag_y, \"node.offsetWidth:\" + node.offsetWidth, \"node.offsetHeight:\" + node.offsetHeight, \"boundaries.offsetWidth:\" + boundaries.offsetWidth, \"boundaries.offsetHeight:\" + boundaries.offsetHeight)\n\n\t\tnode.locked = ((node.end_drag_x - node.start_drag_x <= boundaries.offsetWidth) && (node.end_drag_y - node.start_drag_y <= boundaries.offsetHeight));\n\n\t\tnode.only_vertical = (node.vertical_lock || (!node.locked && node.end_drag_x - node.start_drag_x <= boundaries.offsetWidth));\n\t\tnode.only_horizontal = (node.horizontal_lock || (!node.locked && node.end_drag_y - node.start_drag_y <= boundaries.offsetHeight));\n\n\t\t// console.log(\"LOCKED:\" + node.locked);\n\t\t// console.log(\"LOCKED only_vertical:\" + node.only_vertical);\n\t\t// console.log(\"LOCKED only_horizontal:\" + node.only_horizontal);\n\t}\n\t// offsetHeight and Width may change during a rotation, so better to save starting point values\n\t// dragging locked (only event catching)\n\telse {\n\n\t\tnode.locked = ((node.end_drag_x - node.start_drag_x == node.offsetWidth) && (node.end_drag_y - node.start_drag_y == node.offsetHeight));\n\n\t\t// is the drag one-dimentional\n\t//\tnode.only_vertical = (!node.locked && node.end_drag_x - node.start_drag_x == node.offsetWidth);\n\t//\tnode.only_horizontal = (!node.locked && node.end_drag_y - node.start_drag_y == node.offsetHeight);\n\n\t\tnode.only_vertical = (node.vertical_lock || (!node.locked && node.end_drag_x - node.start_drag_x == node.offsetWidth));\n\t\tnode.only_horizontal = (node.horizontal_lock || (!node.locked && node.end_drag_y - node.start_drag_y == node.offsetHeight));\n\t\t\n\t}\n\n\n}\n\n\nu.e.setDragPosition = function(node, x, y) {\n\t\n\tnode.current_xps = 0;\n\tnode.current_yps = 0;\n\tnode._x = x;\n\tnode._y = y;\n\n\n\t// set corrected values\n\tu.a.translate(node, node._x, node._y);\n\n\n\t// notify of movement\n\tif(fun(node[node.callback_moved])) {\n\t\tnode[node.callback_moved](event);\n\t}\n\n}\n\n\n/**\nSwipe\n\tswipe returns are automatically defined by boundaries, linear horizontal boundaries can only return left/right etc.\n\tdetect swipe movements\n\tnotify swipe\n* Notifies:\n* element.picked\n* element.moved\n* element.dropped\n*\n* ? element.swipedUp\n* ? element.swipedRight\n* ? element.swipedDown\n* ? element.swipedLeft\n*/\nu.e.swipe = function(node, boundaries, _options) {\n\n\tnode.e_swipe_options = _options ? _options : {};\n\n\tnode.e_swipe = true;\n\n\tu.e.drag(node, boundaries, _options);\n}\n\n\n",
                "subject": "No event on ready",
                "message": "No event on ready\n",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "parentnode/manipulator"
            },
            "truncated_cells": []
        },
        {
            "row_idx": 10299,
            "row": {
                "commit": "a07199e04d253374a95930b2cc25a3b649d8f811",
                "old_file": "src/Form.js",
                "new_file": "src/Form.js",
                "old_contents": "import React from 'react';\r\nimport InputContainer from './InputContainer';\r\nimport ValidatedInput from './ValidatedInput';\r\nimport RadioGroup from './RadioGroup';\r\n\r\nimport Validator from './Validator';\r\nimport FileValidator from './FileValidator';\r\n\r\nfunction getInputErrorMessage(input, ruleName) {\r\n    let errorHelp = input.props.errorHelp;\r\n\r\n    if (typeof errorHelp === 'object') {\r\n        return errorHelp[ruleName];\r\n    } else {\r\n        return errorHelp;\r\n    }\r\n}\r\n\r\nexport default class Form extends InputContainer {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            isValid: true,\r\n            invalidInputs: {}\r\n        };\r\n    }\r\n\r\n    componentWillMount() {\r\n        super.componentWillMount();\r\n\r\n        this._validators = {};\r\n    }\r\n\r\n    registerInput(input) {\r\n        super.registerInput(input);\r\n\r\n        if (typeof input.props.validate === 'string') {\r\n            this._validators[input.props.name] = this._compileValidationRules(input, input.props.validate);\r\n        }\r\n    }\r\n\r\n    unregisterInput(input) {\r\n        super.unregisterInput(input);\r\n\r\n        delete this._validators[input.props.name];\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <form ref=\"form\"\r\n                  onSubmit={this._handleSubmit.bind(this)}\r\n                  action=\"#\"\r\n                  className={this.props.className}>\r\n                {this._renderChildren(this.props.children)}\r\n            </form>\r\n        );\r\n    }\r\n\r\n    getValues() {\r\n        return Object.keys(this._inputs).reduce((values, name) => {\r\n            values[name] = this._getValue(name);\r\n\r\n            return values;\r\n        }, {});\r\n    }\r\n\r\n    submit() {\r\n        this._handleSubmit();\r\n    }\r\n\r\n    _renderChildren(children) {\r\n        if (typeof children !== 'object' || children === null) {\r\n            return children;\r\n        }\r\n\r\n        let childrenCount = React.Children.count(children);\r\n\r\n        if (childrenCount > 1) {\r\n            return React.Children.map(children, child => this._renderChild(child));\r\n        } else if (childrenCount === 1) {\r\n            return this._renderChild(Array.isArray(children) ? children[0] : children);\r\n        }\r\n    }\r\n\r\n    _renderChild(child) {\r\n        if (typeof child !== 'object' || child === null) {\r\n            return child;\r\n        }\r\n\r\n        let model = this.props.model || {};\r\n\r\n        if (child.type === ValidatedInput ||\r\n            child.type === RadioGroup || (\r\n                child.type &&\r\n                child.type.prototype !== null && (\r\n                    child.type.prototype instanceof ValidatedInput ||\r\n                    child.type.prototype instanceof RadioGroup\r\n                )\r\n            )\r\n        ) {\r\n            let name = child.props && child.props.name;\r\n\r\n            if (!name) {\r\n                throw new Error('Can not add input without \"name\" attribute');\r\n            }\r\n\r\n            let newProps = {\r\n                _registerInput  : this.registerInput.bind(this),\r\n                _unregisterInput: this.unregisterInput.bind(this)\r\n            };\r\n\r\n            let evtName = child.props.validationEvent ?\r\n                    child.props.validationEvent : this.props.validationEvent;\r\n\r\n            let origCallback = child.props[evtName];\r\n\r\n            newProps[evtName] = e => {\r\n                this._validateInput(name);\r\n\r\n                return origCallback && origCallback(e);\r\n            };\r\n\r\n            if (name in model) {\r\n                if (child.props.type === 'checkbox') {\r\n                    newProps.defaultChecked = model[name];\r\n                } else {\r\n                    newProps.defaultValue = model[name];\r\n                }\r\n            }\r\n\r\n            let error = this._hasError(name);\r\n\r\n            if (error) {\r\n                newProps.bsStyle = 'error';\r\n\r\n                if (typeof error === 'string') {\r\n                    newProps.help = error;\r\n                } else if (child.props.errorHelp) {\r\n                    newProps.help = child.props.errorHelp;\r\n                }\r\n            }\r\n\r\n            return React.cloneElement(child, newProps);\r\n        } else {\r\n            return React.cloneElement(child, {}, this._renderChildren(child.props && child.props.children));\r\n        }\r\n    }\r\n\r\n    _validateInput(name) {\r\n        this._validateOne(name, this.getValues());\r\n    }\r\n\r\n    _hasError(iptName) {\r\n        return this.state.invalidInputs[iptName];\r\n    }\r\n\r\n    _setError(iptName, isError, errText) {\r\n        if (isError && errText &&\r\n            typeof errText !== 'string' &&\r\n            typeof errText !== 'boolean')\r\n        {\r\n            errText = errText + '';\r\n        }\r\n\r\n        // set value to either bool or error description string\r\n        this.setState({\r\n            invalidInputs: Object.assign(\r\n                this.state.invalidInputs,\r\n                {\r\n                    [iptName]: isError ? errText || true : false\r\n                }\r\n            )\r\n        });\r\n    }\r\n\r\n    _validateOne(iptName, context) {\r\n        let input = this._inputs[iptName];\r\n\r\n        if (Array.isArray(input)) {\r\n            console.warn('Multiple inputs use the same name \"' + iptName + '\"');\r\n\r\n            return false;\r\n        }\r\n\r\n        let value = context[iptName];\r\n        let isValid = true;\r\n        let validate = input.props.validate;\r\n        let result, error;\r\n\r\n        if (typeof this.props.validateOne === 'function') {\r\n            result = this.props.validateOne(iptName, value, context);\r\n        } else if (typeof validate === 'function') {\r\n            result = validate(value, context);\r\n        } else if (typeof validate === 'string') {\r\n            result = this._validators[iptName](value);\r\n        } else {\r\n            result = true;\r\n        }\r\n\r\n        // if result is !== true, it is considered an error\r\n        // it can be either bool or string error\r\n        if (result !== true) {\r\n            isValid = false;\r\n\r\n            if (typeof result === 'string') {\r\n                error = result;\r\n            }\r\n        }\r\n\r\n        this._setError(iptName, !isValid, error);\r\n\r\n        return isValid;\r\n    }\r\n\r\n    _validateAll(context) {\r\n        let isValid = true;\r\n        let errors = [];\r\n\r\n        if (typeof this.props.validateAll === 'function') {\r\n            let result = this.props.validateAll(context);\r\n\r\n            if (result !== true) {\r\n                isValid = false;\r\n\r\n                Object.keys(result).forEach(iptName => {\r\n                    errors.push(iptName);\r\n\r\n                    this._setError(iptName, true, result[iptName]);\r\n                });\r\n            }\r\n        } else {\r\n            Object.keys(this._inputs).forEach(iptName => {\r\n                if (!this._validateOne(iptName, context)) {\r\n                    isValid = false;\r\n                    errors.push(iptName);\r\n                }\r\n            });\r\n        }\r\n\r\n        return {\r\n            isValid: isValid,\r\n            errors: errors\r\n        };\r\n    }\r\n\r\n    _compileValidationRules(input, ruleProp) {\r\n        let rules = ruleProp.split(',').map(rule => {\r\n            let params = rule.split(':');\r\n            let name = params.shift();\r\n            let inverse = name[0] === '!';\r\n\r\n            if (inverse) {\r\n                name = name.substr(1);\r\n            }\r\n\r\n            return { name, inverse, params };\r\n        });\r\n\r\n        let validator = (input.props && input.props.type) === 'file' ? FileValidator : Validator;\r\n\r\n        return val => {\r\n            let result = true;\r\n\r\n            rules.forEach(rule => {\r\n                if (typeof validator[rule.name] !== 'function') {\r\n                    throw new Error('Invalid input validation rule \"' + rule.name + '\"');\r\n                }\r\n\r\n                let ruleResult = validator[rule.name](val, ...rule.params);\r\n\r\n                if (rule.inverse) {\r\n                    ruleResult = !ruleResult;\r\n                }\r\n\r\n                if (result === true && ruleResult !== true) {\r\n                    result = getInputErrorMessage(input, rule.name) ||\r\n                        getInputErrorMessage(this, rule.name) || false;\r\n                }\r\n            });\r\n\r\n            return result;\r\n        };\r\n    }\r\n\r\n    _getValue(iptName) {\r\n        let input = this._inputs[iptName];\r\n\r\n        if (Array.isArray(input)) {\r\n            console.warn('Multiple inputs use the same name \"' + iptName + '\"');\r\n\r\n            return false;\r\n        }\r\n\r\n        let value;\r\n\r\n        if (input.props.type === 'checkbox') {\r\n            value = input.getChecked();\r\n        } else if (input.props.type === 'file') {\r\n            value = input.getInputDOMNode().files;\r\n        } else {\r\n            value = input.getValue();\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    _handleSubmit(e) {\r\n        if (e) {\r\n            e.preventDefault();\r\n        }\r\n\r\n        let values = this.getValues();\r\n\r\n        let { isValid, errors } = this._validateAll(values);\r\n\r\n        if (isValid) {\r\n            this.props.onValidSubmit(values);\r\n        } else {\r\n            this.props.onInvalidSubmit(errors, values);\r\n        }\r\n    }\r\n}\r\n\r\nForm.propTypes = {\r\n    className      : React.PropTypes.string,\r\n    model          : React.PropTypes.object,\r\n    onValidSubmit  : React.PropTypes.func.isRequired,\r\n    onInvalidSubmit: React.PropTypes.func,\r\n    validateOne    : React.PropTypes.func,\r\n    validateAll    : React.PropTypes.func,\r\n    validationEvent: React.PropTypes.oneOf([\r\n        'onChange', 'onBlur', 'onFocus'\r\n    ]),\r\n    errorHelp      : React.PropTypes.oneOfType([\r\n        React.PropTypes.string,\r\n        React.PropTypes.object\r\n    ])\r\n};\r\n\r\nForm.defaultProps = {\r\n    model          : {},\r\n    validationEvent: 'onChange',\r\n    onInvalidSubmit: () => {}\r\n};\r\n",
                "new_contents": "import React from 'react';\r\nimport InputContainer from './InputContainer';\r\nimport ValidatedInput from './ValidatedInput';\r\nimport RadioGroup from './RadioGroup';\r\n\r\nimport Validator from './Validator';\r\nimport FileValidator from './FileValidator';\r\nimport createFragment from 'react-addons-create-fragment'\r\n\r\nfunction getInputErrorMessage(input, ruleName) {\r\n    let errorHelp = input.props.errorHelp;\r\n\r\n    if (typeof errorHelp === 'object') {\r\n        return errorHelp[ruleName];\r\n    } else {\r\n        return errorHelp;\r\n    }\r\n}\r\n\r\nexport default class Form extends InputContainer {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            isValid: true,\r\n            invalidInputs: {}\r\n        };\r\n    }\r\n\r\n    componentWillMount() {\r\n        super.componentWillMount();\r\n\r\n        this._validators = {};\r\n    }\r\n\r\n    registerInput(input) {\r\n        super.registerInput(input);\r\n\r\n        if (typeof input.props.validate === 'string') {\r\n            this._validators[input.props.name] = this._compileValidationRules(input, input.props.validate);\r\n        }\r\n    }\r\n\r\n    unregisterInput(input) {\r\n        super.unregisterInput(input);\r\n\r\n        delete this._validators[input.props.name];\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <form ref=\"form\"\r\n                  onSubmit={this._handleSubmit.bind(this)}\r\n                  action=\"#\"\r\n                  className={this.props.className}>\r\n                {this._renderChildren(this.props.children)}\r\n            </form>\r\n        );\r\n    }\r\n\r\n    getValues() {\r\n        return Object.keys(this._inputs).reduce((values, name) => {\r\n            values[name] = this._getValue(name);\r\n\r\n            return values;\r\n        }, {});\r\n    }\r\n\r\n    submit() {\r\n        this._handleSubmit();\r\n    }\r\n\r\n    _renderChildren(children) {\r\n        if (typeof children !== 'object' || children === null) {\r\n            return children;\r\n        }\r\n\r\n        let childrenCount = React.Children.count(children);\r\n\r\n        if (childrenCount > 1) {\r\n            return React.Children.map(children, child => this._renderChild(child));\r\n        } else if (childrenCount === 1) {\r\n            return this._renderChild(Array.isArray(children) ? children[0] : children);\r\n        }\r\n    }\r\n\r\n    _renderChild(child) {\r\n        if (typeof child !== 'object' || child === null) {\r\n            return child;\r\n        }\r\n\r\n        let model = this.props.model || {};\r\n\r\n        if (child.type === ValidatedInput ||\r\n            child.type === RadioGroup || (\r\n                child.type &&\r\n                child.type.prototype !== null && (\r\n                    child.type.prototype instanceof ValidatedInput ||\r\n                    child.type.prototype instanceof RadioGroup\r\n                )\r\n            )\r\n        ) {\r\n            let name = child.props && child.props.name;\r\n\r\n            if (!name) {\r\n                throw new Error('Can not add input without \"name\" attribute');\r\n            }\r\n\r\n            let newProps = {\r\n                _registerInput  : this.registerInput.bind(this),\r\n                _unregisterInput: this.unregisterInput.bind(this)\r\n            };\r\n\r\n            let evtName = child.props.validationEvent ?\r\n                    child.props.validationEvent : this.props.validationEvent;\r\n\r\n            let origCallback = child.props[evtName];\r\n\r\n            newProps[evtName] = e => {\r\n                this._validateInput(name);\r\n\r\n                return origCallback && origCallback(e);\r\n            };\r\n\r\n            if (name in model) {\r\n                if (child.props.type === 'checkbox') {\r\n                    newProps.defaultChecked = model[name];\r\n                } else {\r\n                    newProps.defaultValue = model[name];\r\n                }\r\n            }\r\n\r\n            let error = this._hasError(name);\r\n\r\n            if (error) {\r\n                newProps.bsStyle = 'error';\r\n\r\n                if (typeof error === 'string') {\r\n                    newProps.help = error;\r\n                } else if (child.props.errorHelp) {\r\n                    newProps.help = createFragment(child.props.errorHelp);\r\n                }\r\n            }\r\n\r\n            return React.cloneElement(child, newProps);\r\n        } else {\r\n            return React.cloneElement(child, {}, this._renderChildren(child.props && child.props.children));\r\n        }\r\n    }\r\n\r\n    _validateInput(name) {\r\n        this._validateOne(name, this.getValues());\r\n    }\r\n\r\n    _hasError(iptName) {\r\n        return this.state.invalidInputs[iptName];\r\n    }\r\n\r\n    _setError(iptName, isError, errText) {\r\n        if (isError && errText &&\r\n            typeof errText !== 'string' &&\r\n            typeof errText !== 'boolean')\r\n        {\r\n            errText = errText + '';\r\n        }\r\n\r\n        // set value to either bool or error description string\r\n        this.setState({\r\n            invalidInputs: Object.assign(\r\n                this.state.invalidInputs,\r\n                {\r\n                    [iptName]: isError ? errText || true : false\r\n                }\r\n            )\r\n        });\r\n    }\r\n\r\n    _validateOne(iptName, context) {\r\n        let input = this._inputs[iptName];\r\n\r\n        if (Array.isArray(input)) {\r\n            console.warn('Multiple inputs use the same name \"' + iptName + '\"');\r\n\r\n            return false;\r\n        }\r\n\r\n        let value = context[iptName];\r\n        let isValid = true;\r\n        let validate = input.props.validate;\r\n        let result, error;\r\n\r\n        if (typeof this.props.validateOne === 'function') {\r\n            result = this.props.validateOne(iptName, value, context);\r\n        } else if (typeof validate === 'function') {\r\n            result = validate(value, context);\r\n        } else if (typeof validate === 'string') {\r\n            result = this._validators[iptName](value);\r\n        } else {\r\n            result = true;\r\n        }\r\n\r\n        // if result is !== true, it is considered an error\r\n        // it can be either bool or string error\r\n        if (result !== true) {\r\n            isValid = false;\r\n\r\n            if (typeof result === 'string') {\r\n                error = result;\r\n            }\r\n        }\r\n\r\n        this._setError(iptName, !isValid, error);\r\n\r\n        return isValid;\r\n    }\r\n\r\n    _validateAll(context) {\r\n        let isValid = true;\r\n        let errors = [];\r\n\r\n        if (typeof this.props.validateAll === 'function') {\r\n            let result = this.props.validateAll(context);\r\n\r\n            if (result !== true) {\r\n                isValid = false;\r\n\r\n                Object.keys(result).forEach(iptName => {\r\n                    errors.push(iptName);\r\n\r\n                    this._setError(iptName, true, result[iptName]);\r\n                });\r\n            }\r\n        } else {\r\n            Object.keys(this._inputs).forEach(iptName => {\r\n                if (!this._validateOne(iptName, context)) {\r\n                    isValid = false;\r\n                    errors.push(iptName);\r\n                }\r\n            });\r\n        }\r\n\r\n        return {\r\n            isValid: isValid,\r\n            errors: errors\r\n        };\r\n    }\r\n\r\n    _compileValidationRules(input, ruleProp) {\r\n        let rules = ruleProp.split(',').map(rule => {\r\n            let params = rule.split(':');\r\n            let name = params.shift();\r\n            let inverse = name[0] === '!';\r\n\r\n            if (inverse) {\r\n                name = name.substr(1);\r\n            }\r\n\r\n            return { name, inverse, params };\r\n        });\r\n\r\n        let validator = (input.props && input.props.type) === 'file' ? FileValidator : Validator;\r\n\r\n        return val => {\r\n            let result = true;\r\n\r\n            rules.forEach(rule => {\r\n                if (typeof validator[rule.name] !== 'function') {\r\n                    throw new Error('Invalid input validation rule \"' + rule.name + '\"');\r\n                }\r\n\r\n                let ruleResult = validator[rule.name](val, ...rule.params);\r\n\r\n                if (rule.inverse) {\r\n                    ruleResult = !ruleResult;\r\n                }\r\n\r\n                if (result === true && ruleResult !== true) {\r\n                    result = getInputErrorMessage(input, rule.name) ||\r\n                        getInputErrorMessage(this, rule.name) || false;\r\n                }\r\n            });\r\n\r\n            return result;\r\n        };\r\n    }\r\n\r\n    _getValue(iptName) {\r\n        let input = this._inputs[iptName];\r\n\r\n        if (Array.isArray(input)) {\r\n            console.warn('Multiple inputs use the same name \"' + iptName + '\"');\r\n\r\n            return false;\r\n        }\r\n\r\n        let value;\r\n\r\n        if (input.props.type === 'checkbox') {\r\n            value = input.getChecked();\r\n        } else if (input.props.type === 'file') {\r\n            value = input.getInputDOMNode().files;\r\n        } else {\r\n            value = input.getValue();\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    _handleSubmit(e) {\r\n        if (e) {\r\n            e.preventDefault();\r\n        }\r\n\r\n        let values = this.getValues();\r\n\r\n        let { isValid, errors } = this._validateAll(values);\r\n\r\n        if (isValid) {\r\n            this.props.onValidSubmit(values);\r\n        } else {\r\n            this.props.onInvalidSubmit(errors, values);\r\n        }\r\n    }\r\n}\r\n\r\nForm.propTypes = {\r\n    className      : React.PropTypes.string,\r\n    model          : React.PropTypes.object,\r\n    onValidSubmit  : React.PropTypes.func.isRequired,\r\n    onInvalidSubmit: React.PropTypes.func,\r\n    validateOne    : React.PropTypes.func,\r\n    validateAll    : React.PropTypes.func,\r\n    validationEvent: React.PropTypes.oneOf([\r\n        'onChange', 'onBlur', 'onFocus'\r\n    ]),\r\n    errorHelp      : React.PropTypes.oneOfType([\r\n        React.PropTypes.string,\r\n        React.PropTypes.object\r\n    ])\r\n};\r\n\r\nForm.defaultProps = {\r\n    model          : {},\r\n    validationEvent: 'onChange',\r\n    onInvalidSubmit: () => {}\r\n};\r\n",
                "subject": "Wrap errorHelp object in createFragment",
                "message": "Wrap errorHelp object in createFragment",
                "lang": "JavaScript",
                "license": "mit",
                "repos": "heilhead/react-bootstrap-validation"
            },
            "truncated_cells": []
        }
    ],
    "num_rows_total": 100000,
    "num_rows_per_page": 100,
    "partial": true
}